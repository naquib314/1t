{"version":3,"file":"LineUpJS.js","mappings":"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D,MAAM,GAAGqR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA3N,IAAIipB,KCEN,GAAek5B,GAVK,IAAI7lD,MAAM,GAAGqR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA3N,IAAIipB,KCIN,GAAek5B,GAZK,IAAI7lD,MAAM,GAAGqR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA3N,IAAIipB,KCEN,GAAek5B,GAZK,IAAI7lD,MAAM,GAAGqR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA3N,IAAIipB,KCEN,GAAek5B,GAZK,IAAI7lD,MAAM,GAAGqR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA3N,IAAIipB,KCEN,GAAek5B,GAZK,IAAI7lD,MAAM,GAAGqR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA3N,IAAIipB,KCEN,GAAek5B,GAZK,IAAI7lD,MAAM,GAAGqR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA3N,IAAIipB,KCEN,GAAek5B,GAZK,IAAI7lD,MAAM,GAAGqR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA3N,IAAIipB,KCEN,GAAek5B,GAZK,IAAI7lD,MAAM,GAAGqR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA3N,IAAIipB,KCEN,GAAek5B,GAZK,IAAI7lD,MAAM,GAAGqR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA3N,IAAIipB,KCEN,GAAek5B,GAZK,IAAI7lD,MAAM,GAAGqR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA3N,IAAIipB,KC8BN,kBAgCE,WAA4BjR,GAAA,KAAAA,KAAAA,EAC1B3Y,KAAK8C,MAAQ4hD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","sources":["webpack://LineUpJS/webpack/universalModuleDefinition","webpack://LineUpJS/./.yarn/cache/fast-deep-equal-npm-3.1.3-790edcfcf5-e21a9d8d84.zip/node_modules/fast-deep-equal/index.js","webpack://LineUpJS/./.yarn/cache/lodash.get-npm-4.4.2-7bda64ed87-e403047ddb.zip/node_modules/lodash.get/index.js","webpack://LineUpJS/./.yarn/cache/reflect-metadata-npm-0.1.13-c525998e20-798d379a7b.zip/node_modules/reflect-metadata/Reflect.js","webpack://LineUpJS/webpack/bootstrap","webpack://LineUpJS/webpack/runtime/compat get default export","webpack://LineUpJS/webpack/runtime/define property getters","webpack://LineUpJS/webpack/runtime/hasOwnProperty shorthand","webpack://LineUpJS/webpack/runtime/make namespace object","webpack://LineUpJS/./src/internal/interable.ts","webpack://LineUpJS/./src/internal/worker.ts","webpack://LineUpJS/./src/internal/math.ts","webpack://LineUpJS/./src/internal/utils.ts","webpack://LineUpJS/./.yarn/cache/d3-dispatch-npm-2.0.0-1417ab6cc8-cf473676ae.zip/node_modules/d3-dispatch/src/dispatch.js","webpack://LineUpJS/./src/internal/AEventDispatcher.ts","webpack://LineUpJS/./src/model/annotations.ts","webpack://LineUpJS/./src/model/interfaces.ts","webpack://LineUpJS/./src/model/Column.ts","webpack://LineUpJS/./src/model/ValueColumn.ts","webpack://LineUpJS/./src/model/INumberColumn.ts","webpack://LineUpJS/./src/model/CompositeColumn.ts","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/colors.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/categorical/category10.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/categorical/Set3.js","webpack://LineUpJS/./src/internal/OrderedSet.ts","webpack://LineUpJS/./src/model/internal.ts","webpack://LineUpJS/./src/styles/index.ts","webpack://LineUpJS/./src/model/AggregateGroupColumn.ts","webpack://LineUpJS/./src/model/CategoricalColorMappingFunction.ts","webpack://LineUpJS/./src/model/missing.ts","webpack://LineUpJS/./src/model/internalCategorical.ts","webpack://LineUpJS/./src/model/CategoricalColumn.ts","webpack://LineUpJS/./src/model/SetColumn.ts","webpack://LineUpJS/./src/model/Ranking.ts","webpack://LineUpJS/./src/internal/debounce.ts","webpack://LineUpJS/./src/model/RankColumn.ts","webpack://LineUpJS/./src/model/SelectionColumn.ts","webpack://LineUpJS/./src/model/ActionColumn.ts","webpack://LineUpJS/./src/model/StringColumn.ts","webpack://LineUpJS/./src/model/AnnotateColumn.ts","webpack://LineUpJS/./src/model/BooleanColumn.ts","webpack://LineUpJS/./src/model/ArrayColumn.ts","webpack://LineUpJS/./src/model/BooleansColumn.ts","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-c4d3c8f994.zip/node_modules/d3-format/src/formatDecimal.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-c4d3c8f994.zip/node_modules/d3-format/src/exponent.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-c4d3c8f994.zip/node_modules/d3-format/src/formatSpecifier.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-c4d3c8f994.zip/node_modules/d3-format/src/formatPrefixAuto.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-c4d3c8f994.zip/node_modules/d3-format/src/formatRounded.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-c4d3c8f994.zip/node_modules/d3-format/src/formatTypes.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-c4d3c8f994.zip/node_modules/d3-format/src/identity.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-c4d3c8f994.zip/node_modules/d3-format/src/locale.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-c4d3c8f994.zip/node_modules/d3-format/src/defaultLocale.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-c4d3c8f994.zip/node_modules/d3-format/src/formatGroup.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-c4d3c8f994.zip/node_modules/d3-format/src/formatNumerals.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-c4d3c8f994.zip/node_modules/d3-format/src/formatTrim.js","webpack://LineUpJS/./.yarn/cache/d3-array-npm-2.12.1-104e51ecda-97853b7b52.zip/node_modules/d3-array/src/ticks.js","webpack://LineUpJS/./.yarn/cache/d3-array-npm-2.12.1-104e51ecda-97853b7b52.zip/node_modules/d3-array/src/ascending.js","webpack://LineUpJS/./.yarn/cache/d3-array-npm-2.12.1-104e51ecda-97853b7b52.zip/node_modules/d3-array/src/bisector.js","webpack://LineUpJS/./.yarn/cache/d3-array-npm-2.12.1-104e51ecda-97853b7b52.zip/node_modules/d3-array/src/bisect.js","webpack://LineUpJS/./.yarn/cache/d3-array-npm-2.12.1-104e51ecda-97853b7b52.zip/node_modules/d3-array/src/number.js","webpack://LineUpJS/./.yarn/cache/d3-color-npm-2.0.0-e7f04a5d87-b887354aa3.zip/node_modules/d3-color/src/define.js","webpack://LineUpJS/./.yarn/cache/d3-color-npm-2.0.0-e7f04a5d87-b887354aa3.zip/node_modules/d3-color/src/color.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-4a2018ac34.zip/node_modules/d3-interpolate/src/basis.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-4a2018ac34.zip/node_modules/d3-interpolate/src/constant.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-4a2018ac34.zip/node_modules/d3-interpolate/src/color.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-4a2018ac34.zip/node_modules/d3-interpolate/src/rgb.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-4a2018ac34.zip/node_modules/d3-interpolate/src/array.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-4a2018ac34.zip/node_modules/d3-interpolate/src/date.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-4a2018ac34.zip/node_modules/d3-interpolate/src/number.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-4a2018ac34.zip/node_modules/d3-interpolate/src/object.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-4a2018ac34.zip/node_modules/d3-interpolate/src/basisClosed.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-4a2018ac34.zip/node_modules/d3-interpolate/src/string.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-4a2018ac34.zip/node_modules/d3-interpolate/src/numberArray.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-4a2018ac34.zip/node_modules/d3-interpolate/src/value.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-4a2018ac34.zip/node_modules/d3-interpolate/src/round.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-f77e73f0fb.zip/node_modules/d3-scale/src/number.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-f77e73f0fb.zip/node_modules/d3-scale/src/continuous.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-f77e73f0fb.zip/node_modules/d3-scale/src/constant.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-f77e73f0fb.zip/node_modules/d3-scale/src/init.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-f77e73f0fb.zip/node_modules/d3-scale/src/log.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-f77e73f0fb.zip/node_modules/d3-scale/src/nice.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-f77e73f0fb.zip/node_modules/d3-scale/src/linear.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-f77e73f0fb.zip/node_modules/d3-scale/src/tickFormat.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-c4d3c8f994.zip/node_modules/d3-format/src/precisionPrefix.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-c4d3c8f994.zip/node_modules/d3-format/src/precisionRound.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-c4d3c8f994.zip/node_modules/d3-format/src/precisionFixed.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-f77e73f0fb.zip/node_modules/d3-scale/src/pow.js","webpack://LineUpJS/./src/model/MappingFunction.ts","webpack://LineUpJS/./src/model/internalNumber.ts","webpack://LineUpJS/./src/model/NumberColumn.ts","webpack://LineUpJS/./src/model/BoxPlotColumn.ts","webpack://LineUpJS/./src/model/MapColumn.ts","webpack://LineUpJS/./src/model/CategoricalMapColumn.ts","webpack://LineUpJS/./src/model/CategoricalsColumn.ts","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-d1c7b9658c.zip/node_modules/d3-time/src/interval.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-d1c7b9658c.zip/node_modules/d3-time/src/duration.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-d1c7b9658c.zip/node_modules/d3-time/src/utcWeek.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-d1c7b9658c.zip/node_modules/d3-time/src/utcDay.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-d1c7b9658c.zip/node_modules/d3-time/src/week.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-d1c7b9658c.zip/node_modules/d3-time/src/day.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-d1c7b9658c.zip/node_modules/d3-time/src/year.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-d1c7b9658c.zip/node_modules/d3-time/src/utcYear.js","webpack://LineUpJS/./.yarn/cache/d3-time-format-npm-3.0.0-0803464fb3-c20c1667db.zip/node_modules/d3-time-format/src/locale.js","webpack://LineUpJS/./.yarn/cache/d3-time-format-npm-3.0.0-0803464fb3-c20c1667db.zip/node_modules/d3-time-format/src/defaultLocale.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-d1c7b9658c.zip/node_modules/d3-time/src/month.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-d1c7b9658c.zip/node_modules/d3-time/src/hour.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-d1c7b9658c.zip/node_modules/d3-time/src/minute.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-d1c7b9658c.zip/node_modules/d3-time/src/second.js","webpack://LineUpJS/./src/model/internalDate.ts","webpack://LineUpJS/./src/model/DateColumn.ts","webpack://LineUpJS/./src/model/DatesColumn.ts","webpack://LineUpJS/./src/model/DatesMapColumn.ts","webpack://LineUpJS/./src/model/GroupColumn.ts","webpack://LineUpJS/./src/model/HierarchyColumn.ts","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/ramp.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-single/Blues.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-single/Greens.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-single/Greys.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-single/Oranges.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-single/Purples.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-single/Reds.js","webpack://LineUpJS/./.yarn/cache/d3-color-npm-2.0.0-e7f04a5d87-b887354aa3.zip/node_modules/d3-color/src/math.js","webpack://LineUpJS/./.yarn/cache/d3-color-npm-2.0.0-e7f04a5d87-b887354aa3.zip/node_modules/d3-color/src/cubehelix.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-4a2018ac34.zip/node_modules/d3-interpolate/src/cubehelix.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-multi/rainbow.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-multi/cubehelix.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-multi/viridis.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-multi/YlOrRd.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-multi/YlOrBr.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-multi/BuGn.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-multi/BuPu.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-multi/GnBu.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-multi/OrRd.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-multi/PuBuGn.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-multi/PuBu.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-multi/PuRd.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-multi/RdPu.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-multi/YlGnBu.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/sequential-multi/YlGn.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/diverging/BrBG.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/diverging/PRGn.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/diverging/PiYG.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/diverging/PuOr.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/diverging/RdBu.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/diverging/RdGy.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/diverging/RdYlBu.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/diverging/RdYlGn.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/diverging/Spectral.js","webpack://LineUpJS/./src/model/ColorMappingFunction.ts","webpack://LineUpJS/./src/model/ImpositionCompositeColumn.ts","webpack://LineUpJS/./src/model/NumbersColumn.ts","webpack://LineUpJS/./src/model/ImpositionBoxPlotColumn.ts","webpack://LineUpJS/./src/model/ImpositionCompositesColumn.ts","webpack://LineUpJS/./src/model/CompositeNumberColumn.ts","webpack://LineUpJS/./src/model/ReduceColumn.ts","webpack://LineUpJS/./src/model/StackColumn.ts","webpack://LineUpJS/./src/model/MultiLevelCompositeColumn.ts","webpack://LineUpJS/./src/model/NestedColumn.ts","webpack://LineUpJS/./src/model/NumberMapColumn.ts","webpack://LineUpJS/./src/model/OrdinalColumn.ts","webpack://LineUpJS/./src/model/ScriptColumn.ts","webpack://LineUpJS/./src/model/StringMapColumn.ts","webpack://LineUpJS/./src/model/StringsColumn.ts","webpack://LineUpJS/./src/model/LinkColumn.ts","webpack://LineUpJS/./src/model/LinkMapColumn.ts","webpack://LineUpJS/./src/model/LinksColumn.ts","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.2-f44b303345-aa1217c807.zip/node_modules/lineupengine/build/src/abortAble.js","webpack://LineUpJS/./src/provider/interfaces.ts","webpack://LineUpJS/./src/internal/accessor.ts","webpack://LineUpJS/./src/provider/utils.ts","webpack://LineUpJS/./src/provider/internal.ts","webpack://LineUpJS/./src/provider/ADataProvider.ts","webpack://LineUpJS/./src/model/models.ts","webpack://LineUpJS/./src/provider/ACommonDataProvider.ts","webpack://LineUpJS/./src/provider/sort.ts","webpack://LineUpJS/./src/internal/scheduler.ts","webpack://LineUpJS/./src/provider/tasks.ts","webpack://LineUpJS/./src/provider/DirectRenderTasks.ts","webpack://LineUpJS/./src/model/IArrayColumn.ts","webpack://LineUpJS/./src/model/ICategoricalColumn.ts","webpack://LineUpJS/./src/model/IDateColumn.ts","webpack://LineUpJS/./src/provider/ScheduledTasks.ts","webpack://LineUpJS/./src/provider/LocalDataProvider.ts","webpack://LineUpJS/./src/renderer/interfaces.ts","webpack://LineUpJS/./src/constants.ts","webpack://LineUpJS/./src/renderer/utils.ts","webpack://LineUpJS/./src/renderer/ActionRenderer.ts","webpack://LineUpJS/./src/renderer/AggregateGroupRenderer.ts","webpack://LineUpJS/./src/ui/missing.ts","webpack://LineUpJS/./src/renderer/missing.ts","webpack://LineUpJS/./src/renderer/StringCellRenderer.ts","webpack://LineUpJS/./src/renderer/AnnotationRenderer.ts","webpack://LineUpJS/./src/renderer/impose.ts","webpack://LineUpJS/./src/renderer/BarCellRenderer.ts","webpack://LineUpJS/./src/renderer/DefaultCellRenderer.ts","webpack://LineUpJS/./src/renderer/BooleanCellRenderer.ts","webpack://LineUpJS/./src/renderer/BoxplotCellRenderer.ts","webpack://LineUpJS/./src/renderer/BrightnessCellRenderer.ts","webpack://LineUpJS/./src/renderer/CategoricalCellRenderer.ts","webpack://LineUpJS/./src/renderer/CategoricalHeatmapCellRenderer.ts","webpack://LineUpJS/./src/renderer/CategoricalStackedDistributionlCellRenderer.ts","webpack://LineUpJS/./src/renderer/CircleCellRenderer.ts","webpack://LineUpJS/./src/renderer/DotCellRenderer.ts","webpack://LineUpJS/./src/renderer/GroupCellRenderer.ts","webpack://LineUpJS/./src/renderer/ANumbersCellRenderer.ts","webpack://LineUpJS/./src/renderer/HeatmapCellRenderer.ts","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getWindow.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/instanceOf.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/math.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getBoundingClientRect.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getWindowScroll.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getNodeName.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getDocumentElement.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getWindowScrollBarX.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getComputedStyle.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/isScrollParent.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getCompositeRect.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getNodeScroll.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getHTMLElementScroll.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getLayoutRect.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getParentNode.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getScrollParent.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/listScrollParents.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/isTableElement.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getOffsetParent.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/enums.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/orderModifiers.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/createPopper.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/debounce.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/mergeByName.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/modifiers/eventListeners.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/getBasePlacement.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/getVariation.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/getMainAxisFromPlacement.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/computeOffsets.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/modifiers/computeStyles.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/modifiers/applyStyles.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/getOppositePlacement.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/getOppositeVariationPlacement.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/contains.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/rectToClientRect.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getClippingRect.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getViewportRect.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/dom-utils/getDocumentRect.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/mergePaddingObject.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/getFreshSideObject.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/expandToHashMap.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/detectOverflow.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/within.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/modifiers/preventOverflow.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/getAltAxis.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/modifiers/arrow.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/modifiers/hide.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/popper.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/modifiers/popperOffsets.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/modifiers/offset.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/modifiers/flip.js","webpack://LineUpJS/./.yarn/cache/@popperjs-core-npm-2.11.5-a338f16bd4-fd7f9dca3f.zip/node_modules/@popperjs/core/lib/utils/computeAutoPlacement.js","webpack://LineUpJS/./src/ui/dialogs/ADialog.ts","webpack://LineUpJS/./src/ui/dialogs/APopup.ts","webpack://LineUpJS/./src/ui/dialogs/InputNumberDialog.ts","webpack://LineUpJS/./src/internal/drag.ts","webpack://LineUpJS/./src/renderer/histogram.ts","webpack://LineUpJS/./src/renderer/HistogramCellRenderer.ts","webpack://LineUpJS/./src/renderer/ImageCellRenderer.ts","webpack://LineUpJS/./src/renderer/AAggregatedGroupRenderer.ts","webpack://LineUpJS/./src/renderer/MultiLevelCellRenderer.ts","webpack://LineUpJS/./src/renderer/InterleavingCellRenderer.ts","webpack://LineUpJS/./src/renderer/LinkCellRenderer.ts","webpack://LineUpJS/./src/renderer/MapBarCellRenderer.ts","webpack://LineUpJS/./src/renderer/TableCellRenderer.ts","webpack://LineUpJS/./src/renderer/LinkMapCellRenderer.ts","webpack://LineUpJS/./src/renderer/LoadingCellRenderer.ts","webpack://LineUpJS/./src/renderer/RankCellRenderer.ts","webpack://LineUpJS/./src/renderer/SelectionRenderer.ts","webpack://LineUpJS/./src/renderer/SetCellRenderer.ts","webpack://LineUpJS/./src/renderer/SparklineCellRenderer.ts","webpack://LineUpJS/./src/renderer/UpSetCellRenderer.ts","webpack://LineUpJS/./src/renderer/VerticalBarCellRenderer.ts","webpack://LineUpJS/./src/renderer/DateCellRenderer.ts","webpack://LineUpJS/./src/ui/dialogs/InputDateDialog.ts","webpack://LineUpJS/./src/renderer/DateHistogramCellRenderer.ts","webpack://LineUpJS/./src/renderer/StringHistogramCellRenderer.ts","webpack://LineUpJS/./src/renderer/ViolinPlotCellRenderer.ts","webpack://LineUpJS/./src/renderer/TickCellRenderer.ts","webpack://LineUpJS/./src/renderer/CategoricalTickCellRenderer.ts","webpack://LineUpJS/./src/renderer/renderers.ts","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/categorical/Accent.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/categorical/Dark2.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/categorical/Pastel1.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/categorical/Pastel2.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/categorical/Set1.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-9fe5b4c1d9.zip/node_modules/d3-scale-chromatic/src/categorical/Set2.js","webpack://LineUpJS/./src/ui/dialogs/CategoricalColorMappingDialog.ts","webpack://LineUpJS/./src/ui/dialogs/CategoricalFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/CategoricalMappingFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/ChangeRendererDialog.ts","webpack://LineUpJS/./src/ui/dialogs/ColorMappingDialog.ts","webpack://LineUpJS/./src/internal/dnd.ts","webpack://LineUpJS/./src/ui/toolbarResolvers.ts","webpack://LineUpJS/./src/ui/headerTooltip.ts","webpack://LineUpJS/./src/ui/dialogs/MoreColumnOptionsDialog.ts","webpack://LineUpJS/./src/ui/header.ts","webpack://LineUpJS/./src/ui/dialogs/CompositeChildrenDialog.ts","webpack://LineUpJS/./src/ui/dialogs/CutOffHierarchyDialog.ts","webpack://LineUpJS/./src/ui/dialogs/DateFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/EditPatternDialog.ts","webpack://LineUpJS/./src/ui/dialogs/GroupDialog.ts","webpack://LineUpJS/./src/ui/dialogs/MappingLineDialog.ts","webpack://LineUpJS/./src/ui/dialogs/MappingDialog.ts","webpack://LineUpJS/./src/ui/dialogs/NumberFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/utils.ts","webpack://LineUpJS/./src/ui/dialogs/ReduceDialog.ts","webpack://LineUpJS/./src/ui/dialogs/RenameDialog.ts","webpack://LineUpJS/./src/ui/dialogs/ScriptEditDialog.ts","webpack://LineUpJS/./src/ui/dialogs/SearchDialog.ts","webpack://LineUpJS/./src/ui/dialogs/ShowTopNDialog.ts","webpack://LineUpJS/./src/ui/dialogs/SortDialog.ts","webpack://LineUpJS/./src/ui/dialogs/StringFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/WeightsEditDialog.ts","webpack://LineUpJS/./src/ui/dialogs/SelectionFilterDialog.ts","webpack://LineUpJS/./src/ui/toolbar.ts","webpack://LineUpJS/./src/ui/dialogs/groupNumber.ts","webpack://LineUpJS/./src/ui/dialogs/groupString.ts","webpack://LineUpJS/./src/ui/dialogs/groupDate.ts","webpack://LineUpJS/./src/config.ts","webpack://LineUpJS/./src/internal/merge.ts","webpack://LineUpJS/./.yarn/cache/detect-browser-npm-5.3.0-184a56bcc6-dd6e08d55d.zip/node_modules/detect-browser/es/index.js","webpack://LineUpJS/./src/browser.ts","webpack://LineUpJS/./src/ui/dialogs/DialogManager.ts","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.2-f44b303345-aa1217c807.zip/node_modules/lineupengine/build/src/animation/index.js","webpack://LineUpJS/./src/ui/ALineUp.ts","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.2-f44b303345-aa1217c807.zip/node_modules/lineupengine/build/src/animation/KeyFinder.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.2-f44b303345-aa1217c807.zip/node_modules/lineupengine/build/src/internal/index.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.2-f44b303345-aa1217c807.zip/node_modules/lineupengine/build/src/internal/scroll.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.2-f44b303345-aa1217c807.zip/node_modules/lineupengine/build/src/logic.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.2-f44b303345-aa1217c807.zip/node_modules/lineupengine/build/src/mixin/IMixin.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.2-f44b303345-aa1217c807.zip/node_modules/lineupengine/build/src/styles/index.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.2-f44b303345-aa1217c807.zip/node_modules/lineupengine/build/src/ARowRenderer.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.2-f44b303345-aa1217c807.zip/node_modules/lineupengine/build/src/style/StyleManager.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.2-f44b303345-aa1217c807.zip/node_modules/lineupengine/build/src/style/GridStyleManager.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.2-f44b303345-aa1217c807.zip/node_modules/lineupengine/build/src/table/MultiTableRowRenderer.js","webpack://LineUpJS/./src/ui/domElementCache.ts","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.2-f44b303345-aa1217c807.zip/node_modules/lineupengine/build/src/mixin/PrefetchMixin.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.2-f44b303345-aa1217c807.zip/node_modules/lineupengine/build/src/table/internal/ACellAdapter.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.2-f44b303345-aa1217c807.zip/node_modules/lineupengine/build/src/table/ACellTableSection.js","webpack://LineUpJS/./src/ui/animation.ts","webpack://LineUpJS/./src/ui/RenderColumn.ts","webpack://LineUpJS/./src/ui/MultiLevelRenderColumn.ts","webpack://LineUpJS/./src/ui/SelectionManager.ts","webpack://LineUpJS/./src/ui/EngineRanking.ts","webpack://LineUpJS/./src/ui/interfaces.ts","webpack://LineUpJS/./src/ui/SlopeGraph.ts","webpack://LineUpJS/./src/ui/SelectionIndicator.ts","webpack://LineUpJS/./src/ui/EngineRenderer.ts","webpack://LineUpJS/./src/ui/dialogs/ChooseRankingDialog.ts","webpack://LineUpJS/./src/ui/panel/SearchBox.ts","webpack://LineUpJS/./src/ui/dialogs/RenameRankingDialog.ts","webpack://LineUpJS/./src/ui/dialogs/MoreRankingOptionsDialog.ts","webpack://LineUpJS/./src/ui/dialogs/AddonDialog.ts","webpack://LineUpJS/./src/ui/panel/Hierarchy.ts","webpack://LineUpJS/./src/ui/panel/SidePanelEntryVis.ts","webpack://LineUpJS/./src/ui/panel/SidePanelRanking.ts","webpack://LineUpJS/./src/ui/panel/SidePanel.ts","webpack://LineUpJS/./src/ui/LineUp.ts","webpack://LineUpJS/./src/ui/taggle/rules.ts","webpack://LineUpJS/./src/ui/taggle/TaggleRenderer.ts","webpack://LineUpJS/./src/ui/taggle/Taggle.ts","webpack://LineUpJS/./src/builder/column/ColumnBuilder.ts","webpack://LineUpJS/./src/builder/LineUpBuilder.ts","webpack://LineUpJS/./src/builder/RankingBuilder.ts","webpack://LineUpJS/./src/builder/column/CategoricalColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/NumberColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/StringColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/DateColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/HierarchyColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/ActionsColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/BooleanColumnBuilder.ts","webpack://LineUpJS/./src/builder/DataBuilder.ts","webpack://LineUpJS/./src/builder/adapter/column.ts","webpack://LineUpJS/./src/builder/adapter/ranking.ts","webpack://LineUpJS/./src/builder/adapter/utils.ts","webpack://LineUpJS/./src/builder/adapter/lineup.ts","webpack://LineUpJS/./src/model/index.ts","webpack://LineUpJS/./src/provider/RemoteDataProvider.ts","webpack://LineUpJS/./src/index.ts","webpack://LineUpJS/./src/bundle.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"LineUpJS\"] = factory();\n\telse\n\t\troot[\"LineUpJS\"] = factory();\n})(globalThis, () => {\nreturn ","'use strict';\n\n// do not edit .js files directly - edit src/index.jst\n\n\n\nmodule.exports = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    if (a.constructor !== b.constructor) return false;\n\n    var length, i, keys;\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (!equal(a[i], b[i])) return false;\n      return true;\n    }\n\n\n\n    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\n    if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\n    if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\n\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) return false;\n\n    for (i = length; i-- !== 0;)\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      var key = keys[i];\n\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  }\n\n  // true if both NaN, false otherwise\n  return a!==a && b!==b;\n};\n","/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the `TypeError` message for \"Functions\" methods. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/** `Object#toString` result references. */\nvar funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    symbolTag = '[object Symbol]';\n\n/** Used to match property names within property paths. */\nvar reIsDeepProp = /\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,\n    reIsPlainProp = /^\\w*$/,\n    reLeadingDot = /^\\./,\n    rePropName = /[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g;\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to match backslashes in property paths. */\nvar reEscapeChar = /\\\\(\\\\)?/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\n/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype,\n    funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/** Built-in value references. */\nvar Symbol = root.Symbol,\n    splice = arrayProto.splice;\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map'),\n    nativeCreate = getNative(Object, 'create');\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolToString = symbolProto ? symbolProto.toString : undefined;\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n}\n\n/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  return this.has(key) && delete this.__data__[key];\n}\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);\n}\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n}\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  return true;\n}\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  return getMapData(this, key)['delete'](key);\n}\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  getMapData(this, key).set(key, value);\n  return this;\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `_.get` without support for default values.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @returns {*} Returns the resolved value.\n */\nfunction baseGet(object, path) {\n  path = isKey(path, object) ? [path] : castPath(path);\n\n  var index = 0,\n      length = path.length;\n\n  while (object != null && index < length) {\n    object = object[toKey(path[index++])];\n  }\n  return (index && index == length) ? object : undefined;\n}\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\n/**\n * The base implementation of `_.toString` which doesn't convert nullish\n * values to empty strings.\n *\n * @private\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n */\nfunction baseToString(value) {\n  // Exit early for strings to avoid a performance hit in some environments.\n  if (typeof value == 'string') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return symbolToString ? symbolToString.call(value) : '';\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\n/**\n * Casts `value` to a path array if it's not one.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {Array} Returns the cast property path array.\n */\nfunction castPath(value) {\n  return isArray(value) ? value : stringToPath(value);\n}\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\n/**\n * Checks if `value` is a property name and not a property path.\n *\n * @private\n * @param {*} value The value to check.\n * @param {Object} [object] The object to query keys on.\n * @returns {boolean} Returns `true` if `value` is a property name, else `false`.\n */\nfunction isKey(value, object) {\n  if (isArray(value)) {\n    return false;\n  }\n  var type = typeof value;\n  if (type == 'number' || type == 'symbol' || type == 'boolean' ||\n      value == null || isSymbol(value)) {\n    return true;\n  }\n  return reIsPlainProp.test(value) || !reIsDeepProp.test(value) ||\n    (object != null && value in Object(object));\n}\n\n/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\n/**\n * Converts `string` to a property path array.\n *\n * @private\n * @param {string} string The string to convert.\n * @returns {Array} Returns the property path array.\n */\nvar stringToPath = memoize(function(string) {\n  string = toString(string);\n\n  var result = [];\n  if (reLeadingDot.test(string)) {\n    result.push('');\n  }\n  string.replace(rePropName, function(match, number, quote, string) {\n    result.push(quote ? string.replace(reEscapeChar, '$1') : (number || match));\n  });\n  return result;\n});\n\n/**\n * Converts `value` to a string key if it's not a string or symbol.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {string|symbol} Returns the key.\n */\nfunction toKey(value) {\n  if (typeof value == 'string' || isSymbol(value)) {\n    return value;\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to process.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\n/**\n * Creates a function that memoizes the result of `func`. If `resolver` is\n * provided, it determines the cache key for storing the result based on the\n * arguments provided to the memoized function. By default, the first argument\n * provided to the memoized function is used as the map cache key. The `func`\n * is invoked with the `this` binding of the memoized function.\n *\n * **Note:** The cache is exposed as the `cache` property on the memoized\n * function. Its creation may be customized by replacing the `_.memoize.Cache`\n * constructor with one whose instances implement the\n * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)\n * method interface of `delete`, `get`, `has`, and `set`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to have its output memoized.\n * @param {Function} [resolver] The function to resolve the cache key.\n * @returns {Function} Returns the new memoized function.\n * @example\n *\n * var object = { 'a': 1, 'b': 2 };\n * var other = { 'c': 3, 'd': 4 };\n *\n * var values = _.memoize(_.values);\n * values(object);\n * // => [1, 2]\n *\n * values(other);\n * // => [3, 4]\n *\n * object.a = 2;\n * values(object);\n * // => [1, 2]\n *\n * // Modify the result cache.\n * values.cache.set(object, ['a', 'b']);\n * values(object);\n * // => ['a', 'b']\n *\n * // Replace `_.memoize.Cache`.\n * _.memoize.Cache = WeakMap;\n */\nfunction memoize(func, resolver) {\n  if (typeof func != 'function' || (resolver && typeof resolver != 'function')) {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  var memoized = function() {\n    var args = arguments,\n        key = resolver ? resolver.apply(this, args) : args[0],\n        cache = memoized.cache;\n\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    var result = func.apply(this, args);\n    memoized.cache = cache.set(key, result);\n    return result;\n  };\n  memoized.cache = new (memoize.Cache || MapCache);\n  return memoized;\n}\n\n// Assign cache to `_.memoize`.\nmemoize.Cache = MapCache;\n\n/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 8-9 which returns 'object' for typed array and other constructors.\n  var tag = isObject(value) ? objectToString.call(value) : '';\n  return tag == funcTag || tag == genTag;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && objectToString.call(value) == symbolTag);\n}\n\n/**\n * Converts `value` to a string. An empty string is returned for `null`\n * and `undefined` values. The sign of `-0` is preserved.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n * @example\n *\n * _.toString(null);\n * // => ''\n *\n * _.toString(-0);\n * // => '-0'\n *\n * _.toString([1, 2, 3]);\n * // => '1,2,3'\n */\nfunction toString(value) {\n  return value == null ? '' : baseToString(value);\n}\n\n/**\n * Gets the value at `path` of `object`. If the resolved value is\n * `undefined`, the `defaultValue` is returned in its place.\n *\n * @static\n * @memberOf _\n * @since 3.7.0\n * @category Object\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @param {*} [defaultValue] The value returned for `undefined` resolved values.\n * @returns {*} Returns the resolved value.\n * @example\n *\n * var object = { 'a': [{ 'b': { 'c': 3 } }] };\n *\n * _.get(object, 'a[0].b.c');\n * // => 3\n *\n * _.get(object, ['a', '0', 'b', 'c']);\n * // => 3\n *\n * _.get(object, 'a.b.c', 'default');\n * // => 'default'\n */\nfunction get(object, path, defaultValue) {\n  var result = object == null ? undefined : baseGet(object, path);\n  return result === undefined ? defaultValue : result;\n}\n\nmodule.exports = get;\n","/*! *****************************************************************************\nCopyright (C) Microsoft. All rights reserved.\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\n\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\nMERCHANTABLITY OR NON-INFRINGEMENT.\n\nSee the Apache Version 2.0 License for specific language governing permissions\nand limitations under the License.\n***************************************************************************** */\nvar Reflect;\n(function (Reflect) {\n    // Metadata Proposal\n    // https://rbuckton.github.io/reflect-metadata/\n    (function (factory) {\n        var root = typeof global === \"object\" ? global :\n            typeof self === \"object\" ? self :\n                typeof this === \"object\" ? this :\n                    Function(\"return this;\")();\n        var exporter = makeExporter(Reflect);\n        if (typeof root.Reflect === \"undefined\") {\n            root.Reflect = Reflect;\n        }\n        else {\n            exporter = makeExporter(root.Reflect, exporter);\n        }\n        factory(exporter);\n        function makeExporter(target, previous) {\n            return function (key, value) {\n                if (typeof target[key] !== \"function\") {\n                    Object.defineProperty(target, key, { configurable: true, writable: true, value: value });\n                }\n                if (previous)\n                    previous(key, value);\n            };\n        }\n    })(function (exporter) {\n        var hasOwn = Object.prototype.hasOwnProperty;\n        // feature test for Symbol support\n        var supportsSymbol = typeof Symbol === \"function\";\n        var toPrimitiveSymbol = supportsSymbol && typeof Symbol.toPrimitive !== \"undefined\" ? Symbol.toPrimitive : \"@@toPrimitive\";\n        var iteratorSymbol = supportsSymbol && typeof Symbol.iterator !== \"undefined\" ? Symbol.iterator : \"@@iterator\";\n        var supportsCreate = typeof Object.create === \"function\"; // feature test for Object.create support\n        var supportsProto = { __proto__: [] } instanceof Array; // feature test for __proto__ support\n        var downLevel = !supportsCreate && !supportsProto;\n        var HashMap = {\n            // create an object in dictionary mode (a.k.a. \"slow\" mode in v8)\n            create: supportsCreate\n                ? function () { return MakeDictionary(Object.create(null)); }\n                : supportsProto\n                    ? function () { return MakeDictionary({ __proto__: null }); }\n                    : function () { return MakeDictionary({}); },\n            has: downLevel\n                ? function (map, key) { return hasOwn.call(map, key); }\n                : function (map, key) { return key in map; },\n            get: downLevel\n                ? function (map, key) { return hasOwn.call(map, key) ? map[key] : undefined; }\n                : function (map, key) { return map[key]; },\n        };\n        // Load global or shim versions of Map, Set, and WeakMap\n        var functionPrototype = Object.getPrototypeOf(Function);\n        var usePolyfill = typeof process === \"object\" && process.env && process.env[\"REFLECT_METADATA_USE_MAP_POLYFILL\"] === \"true\";\n        var _Map = !usePolyfill && typeof Map === \"function\" && typeof Map.prototype.entries === \"function\" ? Map : CreateMapPolyfill();\n        var _Set = !usePolyfill && typeof Set === \"function\" && typeof Set.prototype.entries === \"function\" ? Set : CreateSetPolyfill();\n        var _WeakMap = !usePolyfill && typeof WeakMap === \"function\" ? WeakMap : CreateWeakMapPolyfill();\n        // [[Metadata]] internal slot\n        // https://rbuckton.github.io/reflect-metadata/#ordinary-object-internal-methods-and-internal-slots\n        var Metadata = new _WeakMap();\n        /**\n         * Applies a set of decorators to a property of a target object.\n         * @param decorators An array of decorators.\n         * @param target The target object.\n         * @param propertyKey (Optional) The property key to decorate.\n         * @param attributes (Optional) The property descriptor for the target key.\n         * @remarks Decorators are applied in reverse order.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Example = Reflect.decorate(decoratorsArray, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.decorate(decoratorsArray, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.decorate(decoratorsArray, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Object.defineProperty(Example, \"staticMethod\",\n         *         Reflect.decorate(decoratorsArray, Example, \"staticMethod\",\n         *             Object.getOwnPropertyDescriptor(Example, \"staticMethod\")));\n         *\n         *     // method (on prototype)\n         *     Object.defineProperty(Example.prototype, \"method\",\n         *         Reflect.decorate(decoratorsArray, Example.prototype, \"method\",\n         *             Object.getOwnPropertyDescriptor(Example.prototype, \"method\")));\n         *\n         */\n        function decorate(decorators, target, propertyKey, attributes) {\n            if (!IsUndefined(propertyKey)) {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsObject(attributes) && !IsUndefined(attributes) && !IsNull(attributes))\n                    throw new TypeError();\n                if (IsNull(attributes))\n                    attributes = undefined;\n                propertyKey = ToPropertyKey(propertyKey);\n                return DecorateProperty(decorators, target, propertyKey, attributes);\n            }\n            else {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsConstructor(target))\n                    throw new TypeError();\n                return DecorateConstructor(decorators, target);\n            }\n        }\n        exporter(\"decorate\", decorate);\n        // 4.1.2 Reflect.metadata(metadataKey, metadataValue)\n        // https://rbuckton.github.io/reflect-metadata/#reflect.metadata\n        /**\n         * A default metadata decorator factory that can be used on a class, class member, or parameter.\n         * @param metadataKey The key for the metadata entry.\n         * @param metadataValue The value for the metadata entry.\n         * @returns A decorator function.\n         * @remarks\n         * If `metadataKey` is already defined for the target and target key, the\n         * metadataValue for that key will be overwritten.\n         * @example\n         *\n         *     // constructor\n         *     @Reflect.metadata(key, value)\n         *     class Example {\n         *     }\n         *\n         *     // property (on constructor, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticProperty;\n         *     }\n         *\n         *     // property (on prototype, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         property;\n         *     }\n         *\n         *     // method (on constructor)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticMethod() { }\n         *     }\n         *\n         *     // method (on prototype)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         method() { }\n         *     }\n         *\n         */\n        function metadata(metadataKey, metadataValue) {\n            function decorator(target, propertyKey) {\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsUndefined(propertyKey) && !IsPropertyKey(propertyKey))\n                    throw new TypeError();\n                OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n            }\n            return decorator;\n        }\n        exporter(\"metadata\", metadata);\n        /**\n         * Define a unique metadata entry on the target.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param metadataValue A value that contains attached metadata.\n         * @param target The target object on which to define metadata.\n         * @param propertyKey (Optional) The property key for the target.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"method\");\n         *\n         *     // decorator factory as metadata-producing annotation.\n         *     function MyAnnotation(options): Decorator {\n         *         return (target, key?) => Reflect.defineMetadata(\"custom:annotation\", options, target, key);\n         *     }\n         *\n         */\n        function defineMetadata(metadataKey, metadataValue, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n        }\n        exporter(\"defineMetadata\", defineMetadata);\n        /**\n         * Gets a value indicating whether the target object or its prototype chain has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object or its prototype chain; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasMetadata\", hasMetadata);\n        /**\n         * Gets a value indicating whether the target object has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasOwnMetadata\", hasOwnMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object or its prototype chain.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getMetadata\", getMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getOwnMetadata\", getOwnMetadata);\n        /**\n         * Gets the metadata keys defined on the target object or its prototype chain.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getMetadataKeys\", getMetadataKeys);\n        /**\n         * Gets the unique metadata keys defined on the target object.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryOwnMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getOwnMetadataKeys\", getOwnMetadataKeys);\n        /**\n         * Deletes the metadata entry from the target object with the provided key.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata entry was found and deleted; otherwise, false.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function deleteMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            var metadataMap = GetOrCreateMetadataMap(target, propertyKey, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return false;\n            if (!metadataMap.delete(metadataKey))\n                return false;\n            if (metadataMap.size > 0)\n                return true;\n            var targetMetadata = Metadata.get(target);\n            targetMetadata.delete(propertyKey);\n            if (targetMetadata.size > 0)\n                return true;\n            Metadata.delete(target);\n            return true;\n        }\n        exporter(\"deleteMetadata\", deleteMetadata);\n        function DecorateConstructor(decorators, target) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsConstructor(decorated))\n                        throw new TypeError();\n                    target = decorated;\n                }\n            }\n            return target;\n        }\n        function DecorateProperty(decorators, target, propertyKey, descriptor) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target, propertyKey, descriptor);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsObject(decorated))\n                        throw new TypeError();\n                    descriptor = decorated;\n                }\n            }\n            return descriptor;\n        }\n        function GetOrCreateMetadataMap(O, P, Create) {\n            var targetMetadata = Metadata.get(O);\n            if (IsUndefined(targetMetadata)) {\n                if (!Create)\n                    return undefined;\n                targetMetadata = new _Map();\n                Metadata.set(O, targetMetadata);\n            }\n            var metadataMap = targetMetadata.get(P);\n            if (IsUndefined(metadataMap)) {\n                if (!Create)\n                    return undefined;\n                metadataMap = new _Map();\n                targetMetadata.set(P, metadataMap);\n            }\n            return metadataMap;\n        }\n        // 3.1.1.1 OrdinaryHasMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasmetadata\n        function OrdinaryHasMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return true;\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryHasMetadata(MetadataKey, parent, P);\n            return false;\n        }\n        // 3.1.2.1 OrdinaryHasOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasownmetadata\n        function OrdinaryHasOwnMetadata(MetadataKey, O, P) {\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return false;\n            return ToBoolean(metadataMap.has(MetadataKey));\n        }\n        // 3.1.3.1 OrdinaryGetMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetmetadata\n        function OrdinaryGetMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return OrdinaryGetOwnMetadata(MetadataKey, O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryGetMetadata(MetadataKey, parent, P);\n            return undefined;\n        }\n        // 3.1.4.1 OrdinaryGetOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetownmetadata\n        function OrdinaryGetOwnMetadata(MetadataKey, O, P) {\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return undefined;\n            return metadataMap.get(MetadataKey);\n        }\n        // 3.1.5.1 OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarydefineownmetadata\n        function OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P) {\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ true);\n            metadataMap.set(MetadataKey, MetadataValue);\n        }\n        // 3.1.6.1 OrdinaryMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarymetadatakeys\n        function OrdinaryMetadataKeys(O, P) {\n            var ownKeys = OrdinaryOwnMetadataKeys(O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (parent === null)\n                return ownKeys;\n            var parentKeys = OrdinaryMetadataKeys(parent, P);\n            if (parentKeys.length <= 0)\n                return ownKeys;\n            if (ownKeys.length <= 0)\n                return parentKeys;\n            var set = new _Set();\n            var keys = [];\n            for (var _i = 0, ownKeys_1 = ownKeys; _i < ownKeys_1.length; _i++) {\n                var key = ownKeys_1[_i];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            for (var _a = 0, parentKeys_1 = parentKeys; _a < parentKeys_1.length; _a++) {\n                var key = parentKeys_1[_a];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            return keys;\n        }\n        // 3.1.7.1 OrdinaryOwnMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryownmetadatakeys\n        function OrdinaryOwnMetadataKeys(O, P) {\n            var keys = [];\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return keys;\n            var keysObj = metadataMap.keys();\n            var iterator = GetIterator(keysObj);\n            var k = 0;\n            while (true) {\n                var next = IteratorStep(iterator);\n                if (!next) {\n                    keys.length = k;\n                    return keys;\n                }\n                var nextValue = IteratorValue(next);\n                try {\n                    keys[k] = nextValue;\n                }\n                catch (e) {\n                    try {\n                        IteratorClose(iterator);\n                    }\n                    finally {\n                        throw e;\n                    }\n                }\n                k++;\n            }\n        }\n        // 6 ECMAScript Data Typ0es and Values\n        // https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values\n        function Type(x) {\n            if (x === null)\n                return 1 /* Null */;\n            switch (typeof x) {\n                case \"undefined\": return 0 /* Undefined */;\n                case \"boolean\": return 2 /* Boolean */;\n                case \"string\": return 3 /* String */;\n                case \"symbol\": return 4 /* Symbol */;\n                case \"number\": return 5 /* Number */;\n                case \"object\": return x === null ? 1 /* Null */ : 6 /* Object */;\n                default: return 6 /* Object */;\n            }\n        }\n        // 6.1.1 The Undefined Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-undefined-type\n        function IsUndefined(x) {\n            return x === undefined;\n        }\n        // 6.1.2 The Null Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-null-type\n        function IsNull(x) {\n            return x === null;\n        }\n        // 6.1.5 The Symbol Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-symbol-type\n        function IsSymbol(x) {\n            return typeof x === \"symbol\";\n        }\n        // 6.1.7 The Object Type\n        // https://tc39.github.io/ecma262/#sec-object-type\n        function IsObject(x) {\n            return typeof x === \"object\" ? x !== null : typeof x === \"function\";\n        }\n        // 7.1 Type Conversion\n        // https://tc39.github.io/ecma262/#sec-type-conversion\n        // 7.1.1 ToPrimitive(input [, PreferredType])\n        // https://tc39.github.io/ecma262/#sec-toprimitive\n        function ToPrimitive(input, PreferredType) {\n            switch (Type(input)) {\n                case 0 /* Undefined */: return input;\n                case 1 /* Null */: return input;\n                case 2 /* Boolean */: return input;\n                case 3 /* String */: return input;\n                case 4 /* Symbol */: return input;\n                case 5 /* Number */: return input;\n            }\n            var hint = PreferredType === 3 /* String */ ? \"string\" : PreferredType === 5 /* Number */ ? \"number\" : \"default\";\n            var exoticToPrim = GetMethod(input, toPrimitiveSymbol);\n            if (exoticToPrim !== undefined) {\n                var result = exoticToPrim.call(input, hint);\n                if (IsObject(result))\n                    throw new TypeError();\n                return result;\n            }\n            return OrdinaryToPrimitive(input, hint === \"default\" ? \"number\" : hint);\n        }\n        // 7.1.1.1 OrdinaryToPrimitive(O, hint)\n        // https://tc39.github.io/ecma262/#sec-ordinarytoprimitive\n        function OrdinaryToPrimitive(O, hint) {\n            if (hint === \"string\") {\n                var toString_1 = O.toString;\n                if (IsCallable(toString_1)) {\n                    var result = toString_1.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            else {\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var toString_2 = O.toString;\n                if (IsCallable(toString_2)) {\n                    var result = toString_2.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            throw new TypeError();\n        }\n        // 7.1.2 ToBoolean(argument)\n        // https://tc39.github.io/ecma262/2016/#sec-toboolean\n        function ToBoolean(argument) {\n            return !!argument;\n        }\n        // 7.1.12 ToString(argument)\n        // https://tc39.github.io/ecma262/#sec-tostring\n        function ToString(argument) {\n            return \"\" + argument;\n        }\n        // 7.1.14 ToPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-topropertykey\n        function ToPropertyKey(argument) {\n            var key = ToPrimitive(argument, 3 /* String */);\n            if (IsSymbol(key))\n                return key;\n            return ToString(key);\n        }\n        // 7.2 Testing and Comparison Operations\n        // https://tc39.github.io/ecma262/#sec-testing-and-comparison-operations\n        // 7.2.2 IsArray(argument)\n        // https://tc39.github.io/ecma262/#sec-isarray\n        function IsArray(argument) {\n            return Array.isArray\n                ? Array.isArray(argument)\n                : argument instanceof Object\n                    ? argument instanceof Array\n                    : Object.prototype.toString.call(argument) === \"[object Array]\";\n        }\n        // 7.2.3 IsCallable(argument)\n        // https://tc39.github.io/ecma262/#sec-iscallable\n        function IsCallable(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Call]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.4 IsConstructor(argument)\n        // https://tc39.github.io/ecma262/#sec-isconstructor\n        function IsConstructor(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Construct]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.7 IsPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-ispropertykey\n        function IsPropertyKey(argument) {\n            switch (Type(argument)) {\n                case 3 /* String */: return true;\n                case 4 /* Symbol */: return true;\n                default: return false;\n            }\n        }\n        // 7.3 Operations on Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-objects\n        // 7.3.9 GetMethod(V, P)\n        // https://tc39.github.io/ecma262/#sec-getmethod\n        function GetMethod(V, P) {\n            var func = V[P];\n            if (func === undefined || func === null)\n                return undefined;\n            if (!IsCallable(func))\n                throw new TypeError();\n            return func;\n        }\n        // 7.4 Operations on Iterator Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-iterator-objects\n        function GetIterator(obj) {\n            var method = GetMethod(obj, iteratorSymbol);\n            if (!IsCallable(method))\n                throw new TypeError(); // from Call\n            var iterator = method.call(obj);\n            if (!IsObject(iterator))\n                throw new TypeError();\n            return iterator;\n        }\n        // 7.4.4 IteratorValue(iterResult)\n        // https://tc39.github.io/ecma262/2016/#sec-iteratorvalue\n        function IteratorValue(iterResult) {\n            return iterResult.value;\n        }\n        // 7.4.5 IteratorStep(iterator)\n        // https://tc39.github.io/ecma262/#sec-iteratorstep\n        function IteratorStep(iterator) {\n            var result = iterator.next();\n            return result.done ? false : result;\n        }\n        // 7.4.6 IteratorClose(iterator, completion)\n        // https://tc39.github.io/ecma262/#sec-iteratorclose\n        function IteratorClose(iterator) {\n            var f = iterator[\"return\"];\n            if (f)\n                f.call(iterator);\n        }\n        // 9.1 Ordinary Object Internal Methods and Internal Slots\n        // https://tc39.github.io/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots\n        // 9.1.1.1 OrdinaryGetPrototypeOf(O)\n        // https://tc39.github.io/ecma262/#sec-ordinarygetprototypeof\n        function OrdinaryGetPrototypeOf(O) {\n            var proto = Object.getPrototypeOf(O);\n            if (typeof O !== \"function\" || O === functionPrototype)\n                return proto;\n            // TypeScript doesn't set __proto__ in ES5, as it's non-standard.\n            // Try to determine the superclass constructor. Compatible implementations\n            // must either set __proto__ on a subclass constructor to the superclass constructor,\n            // or ensure each class has a valid `constructor` property on its prototype that\n            // points back to the constructor.\n            // If this is not the same as Function.[[Prototype]], then this is definately inherited.\n            // This is the case when in ES6 or when using __proto__ in a compatible browser.\n            if (proto !== functionPrototype)\n                return proto;\n            // If the super prototype is Object.prototype, null, or undefined, then we cannot determine the heritage.\n            var prototype = O.prototype;\n            var prototypeProto = prototype && Object.getPrototypeOf(prototype);\n            if (prototypeProto == null || prototypeProto === Object.prototype)\n                return proto;\n            // If the constructor was not a function, then we cannot determine the heritage.\n            var constructor = prototypeProto.constructor;\n            if (typeof constructor !== \"function\")\n                return proto;\n            // If we have some kind of self-reference, then we cannot determine the heritage.\n            if (constructor === O)\n                return proto;\n            // we have a pretty good guess at the heritage.\n            return constructor;\n        }\n        // naive Map shim\n        function CreateMapPolyfill() {\n            var cacheSentinel = {};\n            var arraySentinel = [];\n            var MapIterator = /** @class */ (function () {\n                function MapIterator(keys, values, selector) {\n                    this._index = 0;\n                    this._keys = keys;\n                    this._values = values;\n                    this._selector = selector;\n                }\n                MapIterator.prototype[\"@@iterator\"] = function () { return this; };\n                MapIterator.prototype[iteratorSymbol] = function () { return this; };\n                MapIterator.prototype.next = function () {\n                    var index = this._index;\n                    if (index >= 0 && index < this._keys.length) {\n                        var result = this._selector(this._keys[index], this._values[index]);\n                        if (index + 1 >= this._keys.length) {\n                            this._index = -1;\n                            this._keys = arraySentinel;\n                            this._values = arraySentinel;\n                        }\n                        else {\n                            this._index++;\n                        }\n                        return { value: result, done: false };\n                    }\n                    return { value: undefined, done: true };\n                };\n                MapIterator.prototype.throw = function (error) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    throw error;\n                };\n                MapIterator.prototype.return = function (value) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    return { value: value, done: true };\n                };\n                return MapIterator;\n            }());\n            return /** @class */ (function () {\n                function Map() {\n                    this._keys = [];\n                    this._values = [];\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                }\n                Object.defineProperty(Map.prototype, \"size\", {\n                    get: function () { return this._keys.length; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Map.prototype.has = function (key) { return this._find(key, /*insert*/ false) >= 0; };\n                Map.prototype.get = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    return index >= 0 ? this._values[index] : undefined;\n                };\n                Map.prototype.set = function (key, value) {\n                    var index = this._find(key, /*insert*/ true);\n                    this._values[index] = value;\n                    return this;\n                };\n                Map.prototype.delete = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    if (index >= 0) {\n                        var size = this._keys.length;\n                        for (var i = index + 1; i < size; i++) {\n                            this._keys[i - 1] = this._keys[i];\n                            this._values[i - 1] = this._values[i];\n                        }\n                        this._keys.length--;\n                        this._values.length--;\n                        if (key === this._cacheKey) {\n                            this._cacheKey = cacheSentinel;\n                            this._cacheIndex = -2;\n                        }\n                        return true;\n                    }\n                    return false;\n                };\n                Map.prototype.clear = function () {\n                    this._keys.length = 0;\n                    this._values.length = 0;\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                };\n                Map.prototype.keys = function () { return new MapIterator(this._keys, this._values, getKey); };\n                Map.prototype.values = function () { return new MapIterator(this._keys, this._values, getValue); };\n                Map.prototype.entries = function () { return new MapIterator(this._keys, this._values, getEntry); };\n                Map.prototype[\"@@iterator\"] = function () { return this.entries(); };\n                Map.prototype[iteratorSymbol] = function () { return this.entries(); };\n                Map.prototype._find = function (key, insert) {\n                    if (this._cacheKey !== key) {\n                        this._cacheIndex = this._keys.indexOf(this._cacheKey = key);\n                    }\n                    if (this._cacheIndex < 0 && insert) {\n                        this._cacheIndex = this._keys.length;\n                        this._keys.push(key);\n                        this._values.push(undefined);\n                    }\n                    return this._cacheIndex;\n                };\n                return Map;\n            }());\n            function getKey(key, _) {\n                return key;\n            }\n            function getValue(_, value) {\n                return value;\n            }\n            function getEntry(key, value) {\n                return [key, value];\n            }\n        }\n        // naive Set shim\n        function CreateSetPolyfill() {\n            return /** @class */ (function () {\n                function Set() {\n                    this._map = new _Map();\n                }\n                Object.defineProperty(Set.prototype, \"size\", {\n                    get: function () { return this._map.size; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Set.prototype.has = function (value) { return this._map.has(value); };\n                Set.prototype.add = function (value) { return this._map.set(value, value), this; };\n                Set.prototype.delete = function (value) { return this._map.delete(value); };\n                Set.prototype.clear = function () { this._map.clear(); };\n                Set.prototype.keys = function () { return this._map.keys(); };\n                Set.prototype.values = function () { return this._map.values(); };\n                Set.prototype.entries = function () { return this._map.entries(); };\n                Set.prototype[\"@@iterator\"] = function () { return this.keys(); };\n                Set.prototype[iteratorSymbol] = function () { return this.keys(); };\n                return Set;\n            }());\n        }\n        // naive WeakMap shim\n        function CreateWeakMapPolyfill() {\n            var UUID_SIZE = 16;\n            var keys = HashMap.create();\n            var rootKey = CreateUniqueKey();\n            return /** @class */ (function () {\n                function WeakMap() {\n                    this._key = CreateUniqueKey();\n                }\n                WeakMap.prototype.has = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.has(table, this._key) : false;\n                };\n                WeakMap.prototype.get = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.get(table, this._key) : undefined;\n                };\n                WeakMap.prototype.set = function (target, value) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ true);\n                    table[this._key] = value;\n                    return this;\n                };\n                WeakMap.prototype.delete = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? delete table[this._key] : false;\n                };\n                WeakMap.prototype.clear = function () {\n                    // NOTE: not a real clear, just makes the previous data unreachable\n                    this._key = CreateUniqueKey();\n                };\n                return WeakMap;\n            }());\n            function CreateUniqueKey() {\n                var key;\n                do\n                    key = \"@@WeakMap@@\" + CreateUUID();\n                while (HashMap.has(keys, key));\n                keys[key] = true;\n                return key;\n            }\n            function GetOrCreateWeakMapTable(target, create) {\n                if (!hasOwn.call(target, rootKey)) {\n                    if (!create)\n                        return undefined;\n                    Object.defineProperty(target, rootKey, { value: HashMap.create() });\n                }\n                return target[rootKey];\n            }\n            function FillRandomBytes(buffer, size) {\n                for (var i = 0; i < size; ++i)\n                    buffer[i] = Math.random() * 0xff | 0;\n                return buffer;\n            }\n            function GenRandomBytes(size) {\n                if (typeof Uint8Array === \"function\") {\n                    if (typeof crypto !== \"undefined\")\n                        return crypto.getRandomValues(new Uint8Array(size));\n                    if (typeof msCrypto !== \"undefined\")\n                        return msCrypto.getRandomValues(new Uint8Array(size));\n                    return FillRandomBytes(new Uint8Array(size), size);\n                }\n                return FillRandomBytes(new Array(size), size);\n            }\n            function CreateUUID() {\n                var data = GenRandomBytes(UUID_SIZE);\n                // mark as random - RFC 4122 § 4.4\n                data[6] = data[6] & 0x4f | 0x40;\n                data[8] = data[8] & 0xbf | 0x80;\n                var result = \"\";\n                for (var offset = 0; offset < UUID_SIZE; ++offset) {\n                    var byte = data[offset];\n                    if (offset === 4 || offset === 6 || offset === 8)\n                        result += \"-\";\n                    if (byte < 16)\n                        result += \"0\";\n                    result += byte.toString(16).toLowerCase();\n                }\n                return result;\n            }\n        }\n        // uses a heuristic used by v8 and chakra to force an object into dictionary mode.\n        function MakeDictionary(obj) {\n            obj.__ = undefined;\n            delete obj.__;\n            return obj;\n        }\n    });\n})(Reflect || (Reflect = {}));\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export interface IForEachAble<T> extends Iterable<T> {\n  forEach(callback: (v: T, i: number) => void): void;\n}\n\n/**\n * @internal\n */\nexport function isForEachAble<T>(v: IForEachAble<T> | any): v is IForEachAble<T> {\n  return typeof v.forEach === 'function';\n}\n\n/**\n * generalized version of Array function similar to Scala ISeq\n */\nexport interface ISequence<T> extends IForEachAble<T> {\n  readonly length: number;\n  filter(callback: (v: T, i: number) => boolean): ISequence<T>;\n  map<U>(callback: (v: T, i: number) => U): ISequence<U>;\n\n  some(callback: (v: T, i: number) => boolean): boolean;\n  every(callback: (v: T, i: number) => boolean): boolean;\n  reduce<U>(callback: (acc: U, v: T, i: number) => U, initial: U): U;\n}\n\n/**\n * @internal\n */\nexport function isSeqEmpty(seq: ISequence<any>) {\n  return seq.every(() => false); // more efficient than counting length\n}\n\n/**\n * helper function for faster access to avoid function calls\n * @internal\n */\nexport function isIndicesAble<T>(it: Iterable<T>): it is ArrayLike<T> & Iterable<T> {\n  return (\n    Array.isArray(it) ||\n    it instanceof Uint8Array ||\n    it instanceof Uint16Array ||\n    it instanceof Uint32Array ||\n    it instanceof Float32Array ||\n    it instanceof Int8Array ||\n    it instanceof Int16Array ||\n    it instanceof Int32Array ||\n    it instanceof Float64Array\n  );\n}\n\ndeclare type ISequenceBase<T> = ISequence<T> | (ArrayLike<T> & Iterable<T>);\n\n/**\n * sequence implementation that does the operation lazily on the fly\n */\nclass LazyFilter<T> implements ISequence<T> {\n  private _length = -1;\n\n  constructor(private readonly it: ISequenceBase<T>, private readonly filters: ((v: T, i: number) => boolean)[]) {}\n\n  get length() {\n    // cached\n    if (this._length >= 0) {\n      return this._length;\n    }\n    let l = 0;\n    this.forEach(() => l++);\n    this._length = l;\n    return l;\n  }\n\n  filter(callback: (v: T, i: number) => boolean): ISequence<T> {\n    // propagate filter\n    return new LazyFilter(this.it, this.filters.concat(callback));\n  }\n\n  map<U>(callback: (v: T, i: number) => U): ISequence<U> {\n    // create lazy map out of myself\n    return new LazyMap1(this, callback);\n  }\n\n  forEach(callback: (v: T, i: number) => void) {\n    if (isIndicesAble(this.it)) {\n      // fast array version\n      outer: for (let i = 0; i < this.it.length; ++i) {\n        const v = this.it[i];\n        for (const f of this.filters) {\n          if (!f(v, i)) {\n            continue outer;\n          }\n        }\n        callback(v, i);\n      }\n      return;\n    }\n\n    // iterator version\n    let valid = 0;\n    const it = this.it[Symbol.iterator]();\n    let v = it.next();\n    let i = 0;\n    outer: while (!v.done) {\n      for (const f of this.filters) {\n        if (f(v.value, i)) {\n          continue;\n        }\n        v = it.next();\n        i++;\n        continue outer;\n      }\n      callback(v.value, valid++);\n      v = it.next();\n      i++;\n    }\n  }\n\n  [Symbol.iterator]() {\n    const it = this.it[Symbol.iterator]();\n    const next = () => {\n      let v = it.next();\n      let i = -1;\n      outer: while (!v.done) {\n        i++;\n        for (const f of this.filters) {\n          if (f(v.value, i)) {\n            continue;\n          }\n          // invalid go to next\n          v = it.next();\n          continue outer;\n        }\n        return v;\n      }\n      return v;\n    };\n    return { next };\n  }\n\n  some(callback: (v: T, i: number) => boolean) {\n    if (isIndicesAble(this.it)) {\n      // fast array version\n      outer: for (let i = 0; i < this.it.length; ++i) {\n        const v = this.it[i];\n        for (const f of this.filters) {\n          if (!f(v, i)) {\n            continue outer;\n          }\n        }\n        if (callback(v, i)) {\n          return true;\n        }\n      }\n      return false;\n    }\n\n    let valid = 0;\n    const it = this.it[Symbol.iterator]();\n    let v = it.next();\n    let i = 0;\n    outer: while (!v.done) {\n      for (const f of this.filters) {\n        if (f(v.value, i)) {\n          continue;\n        }\n        v = it.next();\n        i++;\n        continue outer;\n      }\n      if (callback(v.value, valid++)) {\n        return true;\n      }\n      v = it.next();\n      i++;\n    }\n    return false;\n  }\n\n  every(callback: (v: T, i: number) => boolean) {\n    if (isIndicesAble(this.it)) {\n      // fast array version\n      outer: for (let i = 0; i < this.it.length; ++i) {\n        const v = this.it[i];\n        for (const f of this.filters) {\n          if (!f(v, i)) {\n            continue outer;\n          }\n        }\n        if (!callback(v, i)) {\n          return false;\n        }\n      }\n      return true;\n    }\n\n    let valid = 0;\n    const it = this.it[Symbol.iterator]();\n    let v = it.next();\n    let i = 0;\n    outer: while (!v.done) {\n      for (const f of this.filters) {\n        if (f(v.value, i)) {\n          continue;\n        }\n        v = it.next();\n        i++;\n        continue outer;\n      }\n      if (!callback(v.value, valid++)) {\n        return false;\n      }\n      v = it.next();\n      i++;\n    }\n    return true;\n  }\n\n  reduce<U>(callback: (acc: U, v: T, i: number) => U, initial: U) {\n    if (isIndicesAble(this.it)) {\n      // fast array version\n      let acc = initial;\n      let j = 0;\n      outer: for (let i = 0; i < this.it.length; ++i) {\n        const v = this.it[i];\n        for (const f of this.filters) {\n          if (!f(v, i)) {\n            continue outer;\n          }\n        }\n        acc = callback(acc, v, j++);\n      }\n      return acc;\n    }\n\n    let valid = 0;\n    const it = this.it[Symbol.iterator]();\n    let v = it.next();\n    let i = 0;\n    let r = initial;\n    outer: while (!v.done) {\n      for (const f of this.filters) {\n        if (f(v.value, i)) {\n          continue;\n        }\n        v = it.next();\n        i++;\n        continue outer;\n      }\n      r = callback(r, v.value, valid++);\n      v = it.next();\n      i++;\n    }\n    return r;\n  }\n}\n\n/**\n * lazy mapping operation\n */\nabstract class ALazyMap<T, T2> implements ISequence<T2> {\n  constructor(protected readonly it: ISequenceBase<T>) {}\n\n  get length() {\n    return this.it.length;\n  }\n\n  filter(callback: (v: T2, i: number) => boolean): ISequence<T2> {\n    return new LazyFilter(this, [callback]);\n  }\n\n  abstract map<U>(callback: (v: T2, i: number) => U): ISequence<U>;\n  protected abstract mapV(v: T, i: number): T2;\n\n  forEach(callback: (v: T2, i: number) => void) {\n    if (isIndicesAble(this.it)) {\n      for (let i = 0; i < this.it.length; ++i) {\n        callback(this.mapV(this.it[i], i), i);\n      }\n      return;\n    }\n    const it = this.it[Symbol.iterator]();\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      callback(this.mapV(v.value, i), i);\n    }\n  }\n\n  [Symbol.iterator]() {\n    const it = this.it[Symbol.iterator]();\n    let i = 0;\n    const next = () => {\n      const v = it.next();\n      if (v.done) {\n        return {\n          value: undefined as unknown as T2,\n          done: true,\n        };\n      }\n      const value = this.mapV(v.value, i);\n      i++;\n      return {\n        value,\n        done: false,\n      };\n    };\n    return { next };\n  }\n\n  some(callback: (v: T2, i: number) => boolean) {\n    if (isIndicesAble(this.it)) {\n      for (let i = 0; i < this.it.length; ++i) {\n        if (callback(this.mapV(this.it[i], i), i)) {\n          return true;\n        }\n      }\n      return false;\n    }\n\n    const it = this.it[Symbol.iterator]();\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      if (callback(this.mapV(v.value, i), i)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  every(callback: (v: T2, i: number) => boolean) {\n    if (isIndicesAble(this.it)) {\n      for (let i = 0; i < this.it.length; ++i) {\n        if (!callback(this.mapV(this.it[i], i), i)) {\n          return false;\n        }\n      }\n      return true;\n    }\n\n    const it = this.it[Symbol.iterator]();\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      if (!callback(this.mapV(v.value, i), i)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  reduce<U>(callback: (acc: U, v: T2, i: number) => U, initial: U) {\n    if (isIndicesAble(this.it)) {\n      let acc = initial;\n      for (let i = 0; i < this.it.length; ++i) {\n        acc = callback(acc, this.mapV(this.it[i], i), i);\n      }\n      return acc;\n    }\n\n    const it = this.it[Symbol.iterator]();\n    let acc = initial;\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      acc = callback(acc, this.mapV(v.value, i), i);\n    }\n    return acc;\n  }\n}\n\nclass LazyMap1<T1, T2> extends ALazyMap<T1, T2> implements ISequence<T2> {\n  constructor(it: ISequenceBase<T1>, protected readonly map12: (v: T1, i: number) => T2) {\n    super(it);\n  }\n\n  protected mapV(v: T1, i: number) {\n    return this.map12(v, i);\n  }\n\n  map<U>(callback: (v: T2, i: number) => U): ISequence<U> {\n    return new LazyMap2(this.it, this.map12, callback);\n  }\n}\n\nclass LazyMap2<T1, T2, T3> extends ALazyMap<T1, T3> implements ISequence<T3> {\n  constructor(\n    it: ISequenceBase<T1>,\n    private readonly map12: (v: T1, i: number) => T2,\n    private readonly map23: (v: T2, i: number) => T3\n  ) {\n    super(it);\n  }\n\n  map<U>(callback: (v: T3, i: number) => U): ISequence<U> {\n    return new LazyMap3(this.it, this.map12, this.map23, callback);\n  }\n\n  protected mapV(v: T1, i: number) {\n    return this.map23(this.map12(v, i), i);\n  }\n}\n\nclass LazyMap3<T1, T2, T3, T4> extends ALazyMap<T1, T4> implements ISequence<T4> {\n  constructor(\n    it: ISequenceBase<T1>,\n    private readonly map12: (v: T1, i: number) => T2,\n    private readonly map23: (v: T2, i: number) => T3,\n    private readonly map34: (v: T3, i: number) => T4\n  ) {\n    super(it);\n  }\n\n  map<U>(callback: (v: T4, i: number) => U): ISequence<U> {\n    const map1U = (v: T1, i: number) => callback(this.map34(this.map23(this.map12(v, i), i), i), i);\n    return new LazyMap1(this.it, map1U);\n  }\n\n  protected mapV(v: T1, i: number) {\n    return this.map34(this.map23(this.map12(v, i), i), i);\n  }\n}\n\nclass LazySeq<T> implements ISequence<T> {\n  private _arr: ISequenceBase<T> | null = null;\n\n  constructor(private readonly iterable: Iterable<T>) {}\n\n  get arr() {\n    if (this._arr) {\n      return this._arr;\n    }\n    if (isIndicesAble(this.iterable)) {\n      this._arr = this.iterable;\n    } else {\n      this._arr = Array.from(this.iterable);\n    }\n    return this._arr!;\n  }\n\n  [Symbol.iterator]() {\n    return this.iterable[Symbol.iterator]();\n  }\n\n  filter(callback: (v: T, i: number) => boolean) {\n    return new LazyFilter(this.arr, [callback]);\n  }\n\n  map<U>(callback: (v: T, i: number) => U) {\n    return new LazyMap1(this.arr, callback);\n  }\n\n  forEach(callback: (v: T, i: number) => void) {\n    if (isIndicesAble(this.iterable)) {\n      for (let i = 0; i < this.iterable.length; ++i) {\n        callback(this.iterable[i], i);\n      }\n      return;\n    }\n    const it = this[Symbol.iterator]();\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      callback(v.value, i);\n    }\n  }\n\n  some(callback: (v: T, i: number) => boolean) {\n    if (isIndicesAble(this.iterable)) {\n      for (let i = 0; i < this.iterable.length; ++i) {\n        if (callback(this.iterable[i], i)) {\n          return true;\n        }\n      }\n      return false;\n    }\n\n    const it = this[Symbol.iterator]();\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      if (callback(v.value, i)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  every(callback: (v: T, i: number) => boolean) {\n    if (isIndicesAble(this.iterable)) {\n      for (let i = 0; i < this.iterable.length; ++i) {\n        if (!callback(this.iterable[i], i)) {\n          return false;\n        }\n      }\n      return true;\n    }\n\n    const it = this[Symbol.iterator]();\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      if (!callback(v.value, i)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  reduce<U>(callback: (acc: U, v: T, i: number) => U, initial: U) {\n    if (isIndicesAble(this.iterable)) {\n      let acc = initial;\n      for (let i = 0; i < this.iterable.length; ++i) {\n        acc = callback(acc, this.iterable[i], i);\n      }\n      return acc;\n    }\n\n    const it = this[Symbol.iterator]();\n    let acc = initial;\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      acc = callback(acc, v.value, i);\n    }\n    return acc;\n  }\n\n  get length() {\n    const it = this.iterable;\n    if (isIndicesAble(it)) {\n      return it.length;\n    }\n    if (it instanceof Set || it instanceof Map) {\n      return it.size;\n    }\n    return this.arr.length;\n  }\n}\n\n/**\n * @internal\n */\nexport function lazySeq<T>(iterable: Iterable<T>): ISequence<T> {\n  return new LazySeq(iterable);\n}\n\nclass ConcatSequence<T> implements ISequence<T> {\n  constructor(private readonly seqs: ISequence<ISequence<T>>) {\n    //\n  }\n\n  [Symbol.iterator]() {\n    const seqs = Array.from(this.seqs);\n    let it = seqs.shift()![Symbol.iterator]();\n    const next = (): { value: T; done: boolean } => {\n      const v = it.next();\n      if (!v.done) {\n        return v as { value: T; done: boolean };\n      }\n      if (seqs.length === 0) {\n        // last last\n        return v;\n      }\n      // next iterator and compute next element\n      it = seqs.shift()![Symbol.iterator]();\n      return next();\n    };\n    return { next };\n  }\n\n  filter(callback: (v: T, i: number) => boolean): ISequence<T> {\n    return new LazyFilter(this, [callback]);\n  }\n\n  map<U>(callback: (v: T, i: number) => U): ISequence<U> {\n    return new LazyMap1(this, callback);\n  }\n\n  forEach(callback: (v: T, i: number) => void) {\n    this.seqs.forEach((s) => s.forEach(callback));\n  }\n\n  some(callback: (v: T, i: number) => boolean) {\n    return this.seqs.some((s) => s.some(callback));\n  }\n\n  every(callback: (v: T, i: number) => boolean) {\n    return this.seqs.every((s) => s.every(callback));\n  }\n\n  reduce<U>(callback: (acc: U, v: T, i: number) => U, initial: U) {\n    return this.seqs.reduce((acc, s) => s.reduce(callback, acc), initial);\n  }\n\n  get length() {\n    return this.seqs.reduce((a, b) => a + b.length, 0);\n  }\n}\n\n/**\n * @internal\n */\nexport function concatSeq<T>(seqs: ISequence<ISequence<T>>): ISequence<T>;\nexport function concatSeq<T>(seq1: ISequence<T>, seq2: ISequence<T>, ...seqs: ISequence<T>[]): ISequence<T>;\nexport function concatSeq<T>(\n  seq1: ISequence<T>[] | ISequence<T>,\n  seq2?: ISequence<T>,\n  ...seqs: ISequence<T>[]\n): ISequence<T> {\n  if (seq2) {\n    return new ConcatSequence([seq1 as ISequence<T>, seq2].concat(seqs));\n  }\n  return new ConcatSequence(seq1 as ISequence<T>[]);\n}\n","import type {\n  IWorkerMessage,\n  INumberStatsMessageRequest,\n  IAdvancedBoxPlotData,\n  ICategoricalStatistics,\n  IDateStatistics,\n  IStatistics,\n  ICategoricalStatsMessageRequest,\n  IDateStatsMessageRequest,\n  IBoxPlotStatsMessageRequest,\n} from './';\nimport type { UIntTypedArray, IndicesArray } from '../model';\nimport type { IStringStatsMessageRequest } from './math';\nimport type { IStringStatistics } from './mathInterfaces';\n\n/**\n * @internal\n */\nexport interface IPoorManWorkerScopeEventMap {\n  message: MessageEvent;\n  error: ErrorEvent;\n}\n\ndeclare type IPoorManTransferAble = ArrayBuffer | MessagePort | ImageBitmap;\n\n/**\n * @internal\n */\nexport interface IPoorManWorkerScope {\n  onmessage: ((this: IPoorManWorkerScope, ev: MessageEvent) => any) | null;\n  onerror: ((this: IPoorManWorkerScope, ev: ErrorEvent) => any) | null;\n  close(): void;\n  postMessage(message: any, transfer?: IPoorManTransferAble[]): void;\n  addEventListener<K extends keyof IPoorManWorkerScopeEventMap>(\n    type: K,\n    listener: (this: IPoorManWorkerScope, ev: IPoorManWorkerScopeEventMap[K]) => any,\n    options?: boolean | AddEventListenerOptions\n  ): void;\n  removeEventListener<K extends keyof IPoorManWorkerScopeEventMap>(\n    type: K,\n    listener: (this: IPoorManWorkerScope, ev: IPoorManWorkerScopeEventMap[K]) => any,\n    options?: boolean | AddEventListenerOptions\n  ): void;\n}\n\n// function workerMain(self: IPoorManWorkerScope) {\n//   self.addEventListener('message', (evt) => {\n//     self.postMessage(`Worker: ${evt.data} - Polo`);\n//   });\n// }\n\n/**\n * @internal\n */\nexport function toFunctionBody(f: () => any) {\n  const source = f.toString();\n  return source.slice(source.indexOf('{') + 1, source.lastIndexOf('}'));\n}\n\n/**\n * create a blob out of the given function or string\n * @internal\n */\nexport function createWorkerCodeBlob(fs: (string | (() => any))[]) {\n  const sources = fs.map((d) => d.toString()).join('\\n\\n');\n\n  const blob = new Blob([sources], { type: 'application/javascript' });\n  return URL.createObjectURL(blob);\n}\n\nconst MIN_WORKER_THREADS = 1;\nconst MAX_WORKER_THREADS = Math.max(navigator.hardwareConcurrency - 1, 1); // keep one for the ui\n\nconst THREAD_CLEANUP_TIME = 10000; // 10s\n\ninterface ITaskWorker {\n  /**\n   * worker index\n   */\n  index: number;\n  /**\n   * worker itself\n   */\n  worker: Worker;\n  /**\n   * set of active task numbers\n   */\n  tasks: Set<number>;\n  /**\n   * list of references that are stored on this worker\n   */\n  refs: Set<string>;\n}\n\n/**\n * task scheduler based on web worker\n * @internal\n */\nexport class WorkerTaskScheduler {\n  private readonly workers: ITaskWorker[] = [];\n  private cleanUpWorkerTimer = -1;\n  /**\n   * worker task id\n   */\n  private workerTaskCounter = 0;\n\n  constructor(private readonly blob: string) {\n    for (let i = 0; i < MIN_WORKER_THREADS; ++i) {\n      const w = new Worker(blob);\n      this.workers.push({ worker: w, tasks: new Set(), refs: new Set(), index: i });\n    }\n  }\n\n  terminate() {\n    this.workers.splice(0, this.workers.length).forEach((w) => w.worker.terminate());\n  }\n\n  private readonly cleanUpWorker = () => {\n    // delete workers when they are not needed anymore and empty\n    while (this.workers.length > MIN_WORKER_THREADS) {\n      const toFree = this.workers.findIndex((d) => d.tasks.size === 0);\n      if (toFree < 0) {\n        break;\n      }\n      const w = this.workers.splice(toFree, 1)[0]!;\n      w.worker.terminate();\n    }\n    // maybe reschedule\n    this.finishedTask();\n  };\n\n  private checkOutWorker() {\n    if (this.cleanUpWorkerTimer >= 0) {\n      clearTimeout(this.cleanUpWorkerTimer);\n      this.cleanUpWorkerTimer = -1;\n    }\n\n    const emptyWorker = this.workers.find((d) => d.tasks.size === 0);\n\n    if (emptyWorker) {\n      return emptyWorker;\n    }\n\n    if (this.workers.length >= MAX_WORKER_THREADS) {\n      // find the one with the fewest tasks\n      return this.workers.reduce(\n        (a, b) => (a == null || a.tasks.size > b.tasks.size ? b : a),\n        null as ITaskWorker | null\n      )!;\n    }\n\n    // create new one\n    const r: ITaskWorker = {\n      worker: new Worker(this.blob),\n      tasks: new Set<number>(),\n      refs: new Set(),\n      index: this.workers.length,\n    };\n    this.workers.push(r);\n    return r;\n  }\n\n  private finishedTask() {\n    if (this.cleanUpWorkerTimer === -1 && this.workers.length > MIN_WORKER_THREADS) {\n      this.cleanUpWorkerTimer = setTimeout(this.cleanUpWorker, THREAD_CLEANUP_TIME) as unknown as number;\n    }\n  }\n\n  pushStats(\n    type: 'numberStats',\n    args: Partial<INumberStatsMessageRequest>,\n    refData: string,\n    data: Float64Array,\n    refIndices?: string,\n    indices?: IndicesArray\n  ): Promise<IStatistics>;\n  pushStats(\n    type: 'boxplotStats',\n    args: Partial<IBoxPlotStatsMessageRequest>,\n    refData: string,\n    data: Float64Array,\n    refIndices?: string,\n    indices?: IndicesArray\n  ): Promise<IAdvancedBoxPlotData>;\n  pushStats(\n    type: 'categoricalStats',\n    args: Partial<ICategoricalStatsMessageRequest>,\n    refData: string,\n    data: UIntTypedArray,\n    refIndices?: string,\n    indices?: IndicesArray\n  ): Promise<ICategoricalStatistics>;\n  pushStats(\n    type: 'dateStats',\n    args: Partial<IDateStatsMessageRequest>,\n    refData: string,\n    data: Float64Array,\n    refIndices?: string,\n    indices?: IndicesArray\n  ): Promise<IDateStatistics>;\n  pushStats(\n    type: 'stringStats',\n    args: Partial<IStringStatsMessageRequest>,\n    refData: string,\n    data: readonly string[],\n    refIndices?: string,\n    indices?: IndicesArray\n  ): Promise<IStringStatistics>;\n  pushStats(\n    type: 'numberStats' | 'boxplotStats' | 'categoricalStats' | 'dateStats' | 'stringStats',\n    args: any,\n    refData: string,\n    data: Float32Array | UIntTypedArray | Float64Array | readonly string[],\n    refIndices?: string,\n    indices?: IndicesArray\n  ) {\n    return new Promise((resolve) => {\n      const uid = this.workerTaskCounter++;\n      const { worker, tasks, refs } = this.checkOutWorker();\n\n      const receiver = (msg: MessageEvent) => {\n        const r = msg.data as IWorkerMessage;\n        if (r.uid !== uid || r.type !== type) {\n          return;\n        }\n        // console.log('worker', index, uid, 'finish', r);\n        worker.removeEventListener('message', receiver);\n        tasks.delete(uid);\n        this.finishedTask();\n        resolve((r as any).stats);\n      };\n\n      worker.addEventListener('message', receiver);\n\n      tasks.add(uid);\n\n      const msg: any = Object.assign(\n        {\n          type,\n          uid,\n          refData,\n          refIndices: refIndices || null,\n        },\n        args\n      );\n\n      if (!refData || !refs.has(refData)) {\n        // need to transfer to worker\n        msg.data = data;\n        if (refData) {\n          // save that this worker has this ref\n          refs.add(refData);\n        }\n        // console.log(index, 'set ref (i)', refData);\n      }\n      if (indices && (!refIndices || !refs.has(refIndices))) {\n        // need to transfer\n        msg.indices = indices!;\n        if (refIndices) {\n          refs.add(refIndices);\n        }\n        // console.log(index, 'set ref (i)', refIndices);\n      }\n      // console.log('worker', index, uid, msg);\n\n      worker.postMessage(msg);\n    });\n  }\n\n  push<M, R>(type: string, args: M, transferAbles: ArrayBuffer[]): Promise<R>;\n  push<M, R, T>(type: string, args: M, transferAbles: ArrayBuffer[], toResult: (r: R) => T): Promise<T>;\n  push<M, R, T>(type: string, args: M, transferAbles: ArrayBuffer[], toResult?: (r: R) => T): Promise<T> {\n    return new Promise<T>((resolve) => {\n      const uid = this.workerTaskCounter++;\n      const { worker, tasks } = this.checkOutWorker();\n\n      const receiver = (msg: MessageEvent) => {\n        const r = msg.data as IWorkerMessage;\n        if (r.uid !== uid || r.type !== type) {\n          return;\n        }\n        // console.log('worker', index, uid, 'finish', r);\n        worker.removeEventListener('message', receiver);\n        tasks.delete(uid);\n        this.finishedTask();\n        resolve(toResult ? toResult(r as any) : (r as any));\n      };\n\n      worker.addEventListener('message', receiver);\n      tasks.add(uid);\n      const msg = Object.assign(\n        {\n          type,\n          uid,\n        },\n        args\n      );\n      // console.log('worker', index, uid, msg);\n\n      worker.postMessage(msg, transferAbles);\n    });\n  }\n\n  setRef(ref: string, data: Float32Array | UIntTypedArray | Int32Array | Float64Array | IndicesArray) {\n    for (const w of this.workers) {\n      w.refs.add(ref);\n    }\n    this.broadCast('setRef', {\n      ref,\n      data,\n    });\n  }\n\n  deleteRef(ref: string, startsWith = false) {\n    const uid = this.workerTaskCounter++;\n    const msg = {\n      type: 'deleteRef',\n      uid,\n      ref,\n      startsWith,\n    };\n    for (const w of this.workers) {\n      // console.log(w.index, 'delete ref', ref, startsWith);\n      w.worker.postMessage(msg);\n      if (!startsWith) {\n        w.refs.delete(ref);\n        continue;\n      }\n      for (const r of Array.from(w.refs)) {\n        if (r.startsWith(ref)) {\n          w.refs.delete(r);\n        }\n      }\n    }\n  }\n\n  deleteRefs() {\n    const uid = this.workerTaskCounter++;\n    const msg = {\n      type: 'deleteRef',\n      uid,\n      ref: '',\n      startsWith: true,\n    };\n    for (const w of this.workers) {\n      // console.log(w.index, 'delete refs');\n      w.worker.postMessage(msg);\n      w.refs.clear();\n    }\n  }\n\n  broadCast<T>(type: string, args: T) {\n    const uid = this.workerTaskCounter++;\n    // don't store in tasks queue since there is no response\n    const msg = Object.assign(\n      {\n        type,\n        uid,\n      },\n      args\n    );\n    // console.log('broadcast', msg);\n    for (const w of this.workers) {\n      w.worker.postMessage(msg);\n    }\n  }\n}\n","import type { ICategory, IndicesArray, UIntTypedArray } from '../model';\nimport { IForEachAble, ISequence, isIndicesAble } from './interable';\nimport { createWorkerCodeBlob, IPoorManWorkerScope, toFunctionBody } from './worker';\nimport type {\n  IAdvancedBoxPlotData,\n  IStatistics,\n  INumberBin,\n  IDateBin,\n  IDateStatistics,\n  ICategoricalStatistics,\n  ICategoricalBin,\n  IDateHistGranularity,\n  IStringStatistics,\n} from './mathInterfaces';\n\n/**\n * computes the optimal number of bins for a given array length\n * @internal\n * @param {number} length\n * @returns {number}\n */\nexport function getNumberOfBins(length: number) {\n  if (length === 0) {\n    return 1;\n  }\n  // as by default used in d3 the Sturges' formula\n  return Math.ceil(Math.log(length) / Math.LN2) + 1;\n}\n\n/**\n * @internal\n */\nexport function min(values: number[]): number;\nexport function min<T>(values: T[], acc: (v: T) => number): number;\nexport function min<T>(values: T[], acc?: (v: T) => number) {\n  let min = Number.POSITIVE_INFINITY;\n  for (const d of values) {\n    const v = acc ? acc(d) : (d as any as number);\n    if (v < min) {\n      min = v;\n    }\n  }\n  return min;\n}\n\n/**\n * @internal\n */\nexport function max(values: number[]): number;\nexport function max<T>(values: T[], acc: (v: T) => number): number;\nexport function max<T>(values: T[], acc?: (v: T) => number) {\n  let max = Number.NEGATIVE_INFINITY;\n  for (const d of values) {\n    const v = acc ? acc(d) : (d as any as number);\n    if (v > max) {\n      max = v;\n    }\n  }\n  return max;\n}\n\n/**\n * @internal\n */\nexport function extent(values: number[]): [number, number];\nexport function extent<T>(values: T[], acc: (v: T) => number): [number, number];\nexport function extent<T>(values: T[], acc?: (v: T) => number) {\n  let max = Number.NEGATIVE_INFINITY;\n  let min = Number.POSITIVE_INFINITY;\n  for (const d of values) {\n    const v = acc ? acc(d) : (d as any as number);\n    if (v < min) {\n      min = v;\n    }\n    if (v > max) {\n      max = v;\n    }\n  }\n  return [min, max];\n}\n\n/**\n * @internal\n */\nexport function range(length: number) {\n  const r: number[] = new Array(length);\n  for (let i = 0; i < length; ++i) {\n    r[i] = i;\n  }\n  return r;\n}\n\n/**\n * an empty range\n * @internal\n */\nexport function empty(length: number) {\n  const r: null[] = new Array(length);\n  r.fill(null);\n  return r;\n}\n\n/**\n * computes the X quantile assumes the values are sorted\n * @internal\n */\nexport function quantile(values: ArrayLike<number>, quantile: number, length = values.length) {\n  if (length === 0) {\n    return NaN;\n  }\n  const target = (length - 1) * quantile;\n  const index = Math.floor(target);\n  if (index === target) {\n    return values[index];\n  }\n  const v = values[index];\n  const vAfter = values[index + 1];\n  return v + (vAfter - v) * (target - index); // shift by change\n}\n\n/**\n * @internal\n */\nexport function median(values: number[]): number;\nexport function median<T>(values: T[], acc: (v: T) => number): number;\nexport function median<T>(values: T[], acc?: (v: T) => number) {\n  const arr = acc ? values.map(acc) : (values as any as number[]).slice();\n  arr.sort((a, b) => (a < b ? -1 : a > b ? 1 : 0));\n  return quantile(arr, 0.5);\n}\n\nfunction pushAll<T>(push: (v: T) => void) {\n  return (vs: IForEachAble<T>) => {\n    if (!isIndicesAble(vs)) {\n      vs.forEach(push);\n      return;\n    }\n\n    for (let j = 0; j < vs.length; ++j) {\n      push(vs[j]);\n    }\n  };\n}\n\n/**\n * common interface for a builder pattern\n * @internal\n */\nexport interface IBuilder<T, R> {\n  /**\n   * push an entry\n   */\n  push(v: T): void;\n  /**\n   * push multiple values at once\n   */\n  pushAll(vs: IForEachAble<T>): void;\n\n  /**\n   * build the result\n   */\n  build(): R;\n}\n\nconst GAUSSIAN_CONST = Math.sqrt(2 * Math.PI);\n\n// See <http://en.wikipedia.org/wiki/Kernel_(statistics)>.\nfunction gaussian(u: number) {\n  return Math.exp(-0.5 * u * u) / GAUSSIAN_CONST;\n}\n\nfunction toSampleVariance(variance: number, len: number) {\n  return (variance * len) / (len - 1);\n}\n\n/**\n *\n * The [\"normal reference distribution\"\n * rule-of-thumb](https://stat.ethz.ch/R-manual/R-devel/library/MASS/html/bandwidth.nrd.html),\n * a commonly used version of [Silverman's\n * rule-of-thumb](https://en.wikipedia.org/wiki/Kernel_density_estimation#A_rule-of-thumb_bandwidth_estimator).\n */\nfunction nrd(iqr: number, variance: number, len: number) {\n  let s = Math.sqrt(toSampleVariance(variance, len));\n  if (typeof iqr === 'number') {\n    s = Math.min(s, iqr / 1.34);\n  }\n  return 1.06 * s * Math.pow(len, -0.2);\n}\n\nfunction computeVariance(s: ArrayLike<number>, len: number, mean: number): number {\n  let variance = 0;\n  for (let i = 0; i < len; i++) {\n    const v = s[i];\n    variance += (v - mean) * (v - mean);\n  }\n  variance /= len;\n  return variance;\n}\n\nfunction computeKDE(\n  s: ArrayLike<number>,\n  len: number,\n  points: number,\n  min: number,\n  max: number,\n  variance: number,\n  iqr: number\n): { v: number; p: number }[] {\n  const bandwidth = nrd(iqr, variance, len);\n  const computePoint = (x: number) => {\n    let i = 0;\n    let sum = 0;\n    for (i = 0; i < len; i++) {\n      const v = s[i];\n      sum += gaussian((x - v) / bandwidth);\n    }\n    return sum / bandwidth / len;\n  };\n  const step = (max - min) / (points - 1);\n  return Array.from({ length: points }, (_, i) => {\n    const v = i === points - 1 ? max : min + i * step;\n    return {\n      v,\n      p: computePoint(v),\n    };\n  });\n}\n\n/**\n * @internal\n */\nexport function boxplotBuilder(\n  fixedLength?: number,\n  kdePoints?: number\n): IBuilder<number, IAdvancedBoxPlotData> & { buildArr: (s: Float32Array | Float64Array) => IAdvancedBoxPlotData } {\n  let min = Number.POSITIVE_INFINITY;\n  let max = Number.NEGATIVE_INFINITY;\n  let sum = 0;\n  let length = 0;\n  let missing = 0;\n  const kdePointCount = kdePoints ?? 100;\n\n  // if fixed size use the typed array else a regular array\n  const values: number[] = [];\n  const vs: Float64Array | null = fixedLength != null ? new Float64Array(fixedLength) : null;\n\n  const push = (v: number) => {\n    length += 1;\n    if (v == null || Number.isNaN(v)) {\n      missing += 1;\n      return;\n    }\n    if (v < min) {\n      min = v;\n    }\n    if (v > max) {\n      max = v;\n    }\n    sum += v;\n  };\n\n  const pushAndSave = (v: number) => {\n    push(v);\n    if (vs) {\n      vs[length] = v;\n    } else {\n      values.push(v);\n    }\n  };\n\n  const invalid = {\n    min: NaN,\n    max: NaN,\n    mean: NaN,\n    missing,\n    count: length,\n    whiskerHigh: NaN,\n    whiskerLow: NaN,\n    outlier: [],\n    median: NaN,\n    q1: NaN,\n    q3: NaN,\n    kdePoints: [],\n  };\n\n  const buildImpl = (s: ArrayLike<number>) => {\n    const valid = length - missing;\n    const median = quantile(s, 0.5, valid)!;\n    const q1 = quantile(s, 0.25, valid)!;\n    const q3 = quantile(s, 0.75, valid)!;\n\n    const iqr = q3 - q1;\n    const left = q1 - 1.5 * iqr;\n    const right = q3 + 1.5 * iqr;\n    const mean = sum / valid;\n    const variance = computeVariance(s, valid, mean);\n\n    let outlier: number[] = [];\n    // look for the closest value which is bigger than the computed left\n    let whiskerLow = left;\n\n    for (let i = 0; i < valid; ++i) {\n      const v = s[i];\n      if (left < v) {\n        whiskerLow = v;\n        break;\n      }\n      // outlier\n      outlier.push(v);\n    }\n    // look for the closest value which is smaller than the computed right\n    let whiskerHigh = right;\n    const reversedOutliers: number[] = [];\n    for (let i = valid - 1; i >= 0; --i) {\n      const v = s[i];\n      if (v < right) {\n        whiskerHigh = v;\n        break;\n      }\n      // outlier\n      reversedOutliers.push(v);\n    }\n\n    outlier = outlier.concat(reversedOutliers.reverse());\n\n    const kdePoints: { v: number; p: number }[] = computeKDE(s, valid, kdePointCount, min, max, variance, iqr);\n\n    return {\n      min,\n      max,\n      count: length,\n      missing,\n      mean: sum / valid,\n      whiskerHigh,\n      whiskerLow,\n      outlier,\n      median,\n      q1,\n      q3,\n      kdePoints,\n    };\n  };\n\n  const build = () => {\n    const valid = length - missing;\n\n    if (valid === 0) {\n      return invalid;\n    }\n\n    const s = vs ? vs.sort() : Float64Array.from(values).sort();\n    return buildImpl(s);\n  };\n\n  const buildArr = (vs: Float64Array) => {\n    const s = vs.slice().sort();\n\n    for (let j = 0; j < vs.length; ++j) {\n      push(vs[j]);\n    }\n    // missing are the last\n    return buildImpl(s);\n  };\n\n  return {\n    push: pushAndSave,\n    build,\n    buildArr,\n    pushAll: pushAll(pushAndSave),\n  };\n}\n\n/**\n * @internal\n */\nexport function numberStatsBuilder(domain: [number, number], numberOfBins: number): IBuilder<number, IStatistics> {\n  const hist: INumberBin[] = [];\n\n  let x0 = domain[0];\n  const range = domain[1] - domain[0];\n  const binWidth = range / numberOfBins;\n  for (let i = 0; i < numberOfBins; ++i, x0 += binWidth) {\n    hist.push({\n      x0,\n      x1: x0 + binWidth,\n      count: 0,\n    });\n  }\n\n  const bin1 = domain[0] + binWidth;\n  const binN = domain[1] - binWidth;\n\n  const toBin = (v: number) => {\n    if (v < bin1) {\n      return 0;\n    }\n    if (v >= binN) {\n      return numberOfBins - 1;\n    }\n    if (numberOfBins === 3) {\n      return 1;\n    }\n    let low = 1;\n    let high = numberOfBins - 1;\n    // binary search\n    while (low < high) {\n      const center = Math.floor((high + low) / 2);\n      if (v < hist[center].x1) {\n        high = center;\n      } else {\n        low = center + 1;\n      }\n    }\n    return low;\n  };\n\n  // filter out NaN\n  let min = Number.POSITIVE_INFINITY;\n  let max = Number.NEGATIVE_INFINITY;\n  let sum = 0;\n  let length = 0;\n  let missing = 0;\n\n  const push = (v: number) => {\n    length += 1;\n    if (v == null || Number.isNaN(v)) {\n      missing += 1;\n      return;\n    }\n    if (v < min) {\n      min = v;\n    }\n    if (v > max) {\n      max = v;\n    }\n    sum += v;\n\n    hist[toBin(v)].count++;\n  };\n\n  const build = () => {\n    const valid = length - missing;\n    if (valid === 0) {\n      return {\n        count: missing,\n        missing,\n        min: NaN,\n        max: NaN,\n        mean: NaN,\n        hist,\n        maxBin: 0,\n      };\n    }\n    return {\n      count: length,\n      min,\n      max,\n      mean: sum / valid,\n      missing,\n      hist,\n      maxBin: hist.reduce((a, b) => Math.max(a, b.count), 0),\n    };\n  };\n\n  return { push, build, pushAll: pushAll(push) };\n}\n\n/**\n * guesses the histogram granularity to use based on min and max date\n */\nfunction computeGranularity(\n  min: Date | null,\n  max: Date | null\n): { histGranularity: IDateHistGranularity; hist: IDateBin[] } {\n  if (min == null || max == null) {\n    return { histGranularity: 'year', hist: [] };\n  }\n  const hist: IDateBin[] = [];\n\n  if (max.getFullYear() - min.getFullYear() >= 2) {\n    // more than two years difference\n    const minYear = min.getFullYear();\n    const maxYear = max.getFullYear();\n    for (let i = minYear; i <= maxYear; ++i) {\n      hist.push({\n        x0: new Date(i, 0, 1),\n        x1: new Date(i + 1, 0, 1),\n        count: 0,\n      });\n    }\n    return { hist, histGranularity: 'year' };\n  }\n\n  if (max.getTime() - min.getTime() <= 1000 * 60 * 60 * 24 * 31) {\n    // less than a month use day\n    let x0 = new Date(min.getFullYear(), min.getMonth(), min.getDate());\n    while (x0 <= max) {\n      const x1 = new Date(x0);\n      x1.setDate(x1.getDate() + 1);\n      hist.push({\n        x0,\n        x1,\n        count: 0,\n      });\n      x0 = x1;\n    }\n    return { hist, histGranularity: 'day' };\n  }\n\n  // by month\n  let x0 = new Date(min.getFullYear(), min.getMonth(), 1);\n  while (x0 <= max) {\n    const x1 = new Date(x0);\n    x1.setMonth(x1.getMonth() + 1);\n    hist.push({\n      x0,\n      x1,\n      count: 0,\n    });\n    x0 = x1;\n  }\n  return { hist, histGranularity: 'month' };\n}\n\nfunction pushDateHist(hist: IDateBin[], v: Date, count = 1) {\n  if (v < hist[0].x1) {\n    hist[0].count += count;\n    return;\n  }\n  const l = hist.length - 1;\n  if (v > hist[l].x0) {\n    hist[l].count += count;\n    return;\n  }\n  if (l === 2) {\n    hist[1].count += count;\n    return;\n  }\n\n  let low = 1;\n  let high = l;\n  // binary search\n  while (low < high) {\n    const center = Math.floor((high + low) / 2);\n    if (v < hist[center].x1) {\n      high = center;\n    } else {\n      low = center + 1;\n    }\n  }\n  hist[low].count += count;\n}\n/**\n * @internal\n */\nexport function dateStatsBuilder(template?: IDateStatistics): IBuilder<Date | null, IDateStatistics> {\n  let min: Date | null = null;\n  let max: Date | null = null;\n  let count = 0;\n  let missing = 0;\n\n  // yyyymmdd, count\n  const byDay = new Map<number, { x: Date; count: number }>();\n  const templateHist = template ? template.hist.map((d) => ({ x0: d.x0, x1: d.x1, count: 0 })) : null;\n\n  const push = (v: Date | null) => {\n    count += 1;\n    if (!v || v == null) {\n      missing += 1;\n      return;\n    }\n    if (min == null || v < min) {\n      min = v;\n    }\n    if (max == null || v > max) {\n      max = v;\n    }\n    if (templateHist) {\n      pushDateHist(templateHist, v, 1);\n      return;\n    }\n    const key = v.getFullYear() * 10000 + v.getMonth() * 100 + v.getDate();\n    if (byDay.has(key)) {\n      byDay.get(key)!.count++;\n    } else {\n      byDay.set(key, { count: 1, x: v });\n    }\n  };\n\n  const build = () => {\n    if (templateHist) {\n      return {\n        min,\n        max,\n        missing,\n        count,\n        maxBin: templateHist.reduce((acc, h) => Math.max(acc, h.count), 0),\n        hist: templateHist,\n        histGranularity: template!.histGranularity,\n      };\n    }\n    // copy template else derive\n    const { histGranularity, hist } = computeGranularity(min, max);\n\n    byDay.forEach((v) => pushDateHist(hist, v.x, v.count));\n\n    return {\n      min,\n      max,\n      missing,\n      count,\n      maxBin: hist.reduce((acc, h) => Math.max(acc, h.count), 0),\n      hist,\n      histGranularity,\n    };\n  };\n\n  return { push, build, pushAll: pushAll(push) };\n}\n\n/**\n * computes a categorical histogram\n * @param arr the data array\n * @param categories the list of known categories\n * @returns {{hist: {cat: string, y: number}[]}}\n * @internal\n */\nexport function categoricalStatsBuilder(\n  categories: { name: string }[]\n): IBuilder<{ name: string } | null, ICategoricalStatistics> {\n  const m = new Map<string, ICategoricalBin>();\n  categories.forEach((cat) => m.set(cat.name, { cat: cat.name, count: 0 }));\n\n  let missing = 0;\n  let count = 0;\n\n  const push = (v: ICategory | null) => {\n    count += 1;\n    if (v == null) {\n      missing += 1;\n    } else {\n      const entry = m.get(v.name);\n      if (entry) {\n        entry.count++;\n      } else {\n        m.set(v.name, { cat: v.name, count: 1 });\n      }\n    }\n  };\n\n  const build = () => {\n    const entries: ICategoricalBin[] = categories.map((d) => m.get(d.name)!);\n    const maxBin = entries.reduce((a, b) => Math.max(a, b.count), Number.NEGATIVE_INFINITY);\n\n    return {\n      maxBin,\n      hist: entries,\n      count,\n      missing,\n    };\n  };\n\n  return { push, build, pushAll: pushAll(push) };\n}\n\n/**\n * computes a string statistics\n * @internal\n */\nexport function stringStatsBuilder(topN: number | readonly string[]): IBuilder<string | null, IStringStatistics> {\n  let missing = 0;\n  let count = 0;\n  const m = new Map<string, { value: string; count: number }>();\n  if (Array.isArray(topN)) {\n    for (const t of topN) {\n      m.set(t, { value: t, count: 0 });\n    }\n  }\n\n  const push = (v: string | null) => {\n    count += 1;\n    if (v == null) {\n      missing += 1;\n    } else {\n      const entry = m.get(v);\n      if (entry) {\n        entry.count++;\n      } else {\n        m.set(v, { value: v, count: 1 });\n      }\n    }\n  };\n\n  const build = (): IStringStatistics => {\n    const byFrequency = Array.isArray(topN)\n      ? topN.map((d) => m.get(d)!)\n      : Array.from(m.values()).sort((a, b) => {\n          if (a.count === b.count) {\n            return a.value.localeCompare(b.value);\n          }\n          return b.count - a.count;\n        });\n    return {\n      count,\n      missing,\n      topN: byFrequency.slice(0, Math.min(byFrequency.length, Array.isArray(topN) ? topN.length : (topN as number))),\n      unique: m.size,\n    };\n  };\n\n  return { push, build, pushAll: pushAll(push) };\n}\n\n/**\n * round to the given commas similar to d3.round\n * @param {number} v\n * @param {number} precision\n * @returns {number}\n * @internal\n */\nexport function round(v: number, precision = 0) {\n  if (precision === 0) {\n    return Math.round(v);\n  }\n  const scale = Math.pow(10, precision);\n  return Math.round(v * scale) / scale;\n}\n\n/**\n * compares two number whether they are similar up to delta\n * @param {number} a first number\n * @param {number} b second number\n * @param {number} delta\n * @returns {boolean} a and b are similar\n * @internal\n */\nexport function similar(a: number, b: number, delta = 0.5) {\n  if (a === b) {\n    return true;\n  }\n  return Math.abs(a - b) < delta;\n}\n\n/**\n * @internal\n */\nexport function isPromiseLike<T>(value: any): value is PromiseLike<T> {\n  return value instanceof Promise || typeof value.then === 'function';\n}\n\n/**\n * @internal\n */\nexport function createIndexArray(length: number, dataSize = length) {\n  if (dataSize <= 255) {\n    return new Uint8Array(length);\n  }\n  if (dataSize <= 65535) {\n    return new Uint16Array(length);\n  }\n  return new Uint32Array(length);\n}\n\n/**\n * @internal\n */\nexport function toIndexArray(arr: ISequence<number> | IndicesArray, maxDataIndex?: number): UIntTypedArray {\n  if (arr instanceof Uint8Array || arr instanceof Uint16Array || arr instanceof Uint32Array) {\n    return arr.slice();\n  }\n  const l = maxDataIndex != null ? maxDataIndex : arr.length;\n  if (l <= 255) {\n    return Uint8Array.from(arr);\n  }\n  if (l <= 65535) {\n    return Uint16Array.from(arr);\n  }\n  return Uint32Array.from(arr);\n}\n\nfunction createLike(template: IndicesArray, total: number, maxDataIndex?: number) {\n  if (template instanceof Uint8Array) {\n    return new Uint8Array(total);\n  }\n  if (template instanceof Uint16Array) {\n    return new Uint16Array(total);\n  }\n  if (template instanceof Uint32Array) {\n    return new Uint32Array(total);\n  }\n  return createIndexArray(total, maxDataIndex);\n}\n\n/**\n * @internal\n */\nexport function joinIndexArrays(groups: IndicesArray[], maxDataIndex?: number) {\n  switch (groups.length) {\n    case 0:\n      return [];\n    case 1:\n      return groups[0];\n    default:\n      const total = groups.reduce((a, b) => a + b.length, 0);\n      const r = createLike(groups[0], total, maxDataIndex);\n      let shift = 0;\n      for (const g of groups) {\n        r.set(g, shift);\n        shift += g.length;\n      }\n      return r;\n  }\n}\n\nfunction asc(a: any, b: any) {\n  return a < b ? -1 : a > b ? 1 : 0;\n}\n\nfunction desc(a: any, b: any) {\n  return a < b ? 1 : a > b ? -1 : 0;\n}\n\nexport declare type ILookUpArray =\n  | Uint8Array\n  | Uint16Array\n  | Uint32Array\n  | Int8Array\n  | Int16Array\n  | Int32Array\n  | string[]\n  | Float32Array\n  | Float64Array;\n\n/**\n * sort the given index array based on the lookup array\n * @internal\n */\nexport function sortComplex(indices: UIntTypedArray | number[], comparators: { asc: boolean; lookup: ILookUpArray }[]) {\n  if (indices.length < 2) {\n    return indices;\n  }\n\n  switch (comparators.length) {\n    case 0:\n      // sort by indices\n      return indices.sort();\n    case 1:\n      const c = comparators[0]!.asc ? asc : desc;\n      const cLookup = comparators[0]!.lookup;\n      return indices.sort((a, b) => {\n        const r = c(cLookup[a]!, cLookup[b]!);\n        return r !== 0 ? r : a - b;\n      });\n    case 2:\n      const c1 = comparators[0]!.asc ? asc : desc;\n      const c1Lookup = comparators[0]!.lookup;\n      const c2 = comparators[1]!.asc ? asc : desc;\n      const c2Lookup = comparators[1]!.lookup;\n      return indices.sort((a, b) => {\n        let r = c1(c1Lookup[a], c1Lookup[b]);\n        r = r !== 0 ? r : c2(c2Lookup[a], c2Lookup[b]);\n        return r !== 0 ? r : a - b;\n      });\n    default:\n      const l = comparators.length;\n      const fs = comparators.map((d) => (d.asc ? asc : desc));\n      return indices.sort((a, b) => {\n        for (let i = 0; i < l; ++i) {\n          const l = comparators[i].lookup;\n          const r = fs[i](l[a], l[b]);\n          if (r !== 0) {\n            return r;\n          }\n        }\n        return a - b;\n      });\n  }\n}\n\n// note the whole worker thing is in this one file to be able to copy the code\n\n/**\n * base worker message\n * @internal\n */\nexport interface IWorkerMessage {\n  type: string;\n  uid: number;\n}\n\n/**\n * @internal\n */\nexport interface IStatsWorkerMessage extends IWorkerMessage {\n  /**\n   * reference key for the indices array\n   */\n  refIndices: string | null;\n  indices?: UIntTypedArray;\n\n  /**\n   * reference key for the data indices\n   */\n  refData: string;\n  data?: UIntTypedArray | Float32Array | Int32Array | Float64Array | readonly string[];\n}\n\n/**\n * @internal\n */\nexport interface ISortMessageRequest {\n  type: 'sort';\n  uid: number;\n\n  ref: string;\n  indices: UIntTypedArray;\n  sortOrders?: { asc: boolean; lookup: ILookUpArray }[];\n}\n\n/**\n * @internal\n */\nexport interface ISortMessageResponse {\n  type: 'sort';\n\n  ref: string;\n  order: IndicesArray;\n}\n\n/**\n * @internal\n */\nexport interface IDeleteRefMessageRequest {\n  type: 'deleteRef';\n\n  ref: string;\n  startsWith?: boolean;\n}\n\n/**\n * @internal\n */\nexport interface ISetRefMessageRequest {\n  type: 'setRef';\n  uid: number;\n\n  ref: string;\n  data: UIntTypedArray | Float32Array | Int32Array | Float64Array | readonly string[] | null;\n}\n\n/**\n * @internal\n */\nexport interface IDateStatsMessageRequest {\n  type: 'dateStats';\n  uid: number;\n\n  refIndices: string | null;\n  indices?: UIntTypedArray;\n\n  refData: string;\n  data?: UIntTypedArray;\n\n  template?: IDateStatistics;\n}\n\n/**\n * @internal\n */\nexport interface IDateStatsMessageResponse {\n  type: 'dateStats';\n  uid: number;\n\n  stats: IDateStatistics;\n}\n\n/**\n * @internal\n */\nexport interface INumberStatsMessageRequest {\n  type: 'numberStats';\n  uid: number;\n\n  refIndices: string | null;\n  indices?: UIntTypedArray;\n\n  refData: string;\n  data?: Float64Array;\n\n  domain: [number, number];\n  numberOfBins: number;\n}\n\n/**\n * @internal\n */\nexport interface INumberStatsMessageResponse {\n  type: 'numberStats';\n  uid: number;\n\n  stats: IStatistics;\n}\n\n/**\n * @internal\n */\nexport interface IBoxPlotStatsMessageRequest {\n  type: 'boxplotStats';\n  uid: number;\n\n  refIndices: string | null;\n  indices?: UIntTypedArray;\n\n  refData: string;\n  data?: Float64Array;\n}\n\n/**\n * @internal\n */\nexport interface IBoxPlotStatsMessageResponse {\n  type: 'boxplotStats';\n  uid: number;\n\n  stats: IAdvancedBoxPlotData;\n}\n\n/**\n * @internal\n */\nexport interface ICategoricalStatsMessageRequest {\n  type: 'categoricalStats';\n  uid: number;\n\n  refIndices: string | null;\n  indices?: UIntTypedArray;\n\n  refData: string;\n  data?: UIntTypedArray;\n\n  categories: string[];\n}\n\n/**\n * @internal\n */\nexport interface ICategoricalStatsMessageResponse {\n  type: 'categoricalStats';\n  uid: number;\n\n  stats: ICategoricalStatistics;\n}\n\n/**\n * @internal\n */\nexport interface IStringStatsMessageRequest {\n  type: 'stringStats';\n  uid: number;\n\n  refIndices: string | null;\n  indices?: UIntTypedArray;\n\n  refData: string;\n  data?: readonly string[];\n\n  topN: number | readonly string[];\n}\n\n/**\n * @internal\n */\nexport interface IStringStatsMessageResponse {\n  type: 'stringStats';\n  uid: number;\n\n  stats: IStringStatistics;\n}\n\n/**\n * helper to build a value cache for dates, use dateValueCache2Value to convert back\n * @internal\n */\nexport function dateValueCacheBuilder(length: number) {\n  const vs = new Float64Array(length);\n  let i = 0;\n  return {\n    push: (d: Date | null) => (vs[i++] = d == null ? NaN : d.getTime()),\n    cache: vs,\n  };\n}\n\n/**\n * @internal\n */\nexport function dateValueCache2Value(v: number) {\n  return Number.isNaN(v) ? null : new Date(v);\n}\n\n/**\n * @internal\n */\nexport function categoricalValueCacheBuilder(length: number, categories: { name: string }[]) {\n  const vs = createIndexArray(length, categories.length + 1);\n  const name2index = new Map<string, number>();\n  for (let i = 0; i < categories.length; ++i) {\n    name2index.set(categories[i].name, i + 1); // shift by one for missing = 0\n  }\n  let i = 0;\n  return {\n    push: (d: { name: string } | null) => (vs[i++] = d == null ? 0 : name2index.get(d.name) || 0),\n    cache: vs,\n  };\n}\n\n/**\n * @internal\n */\nexport function categoricalValueCache2Value<T extends { name: string }>(v: number, categories: T[]) {\n  return v === 0 ? null : categories[v - 1];\n}\n\nfunction sortWorkerMain() {\n  // eslint-disable-next-line no-restricted-globals\n  const workerSelf = self as any as IPoorManWorkerScope;\n\n  // stored refs to avoid duplicate copy\n  const refs = new Map<string, UIntTypedArray | Float32Array | Int32Array | Float64Array | readonly string[]>();\n\n  const sort = (r: ISortMessageRequest) => {\n    if (r.sortOrders) {\n      sortComplex(r.indices, r.sortOrders);\n    }\n    const order = r.indices;\n\n    workerSelf.postMessage(\n      {\n        type: r.type,\n        uid: r.uid,\n        ref: r.ref,\n        order,\n      } as ISortMessageResponse,\n      [r.indices.buffer]\n    );\n  };\n\n  const setRef = (r: ISetRefMessageRequest) => {\n    if (r.data) {\n      refs.set(r.ref, r.data);\n    } else {\n      refs.delete(r.ref);\n    }\n  };\n\n  const deleteRef = (r: IDeleteRefMessageRequest) => {\n    if (!r.startsWith) {\n      refs.delete(r.ref);\n      return;\n    }\n\n    for (const key of Array.from(refs.keys())) {\n      if (key.startsWith(r.ref)) {\n        refs.delete(key);\n      }\n    }\n  };\n\n  const resolveRefs = <T extends UIntTypedArray | Float32Array | Float64Array | Int32Array | readonly string[]>(\n    r: IStatsWorkerMessage\n  ) => {\n    // resolve refs or save the new data\n\n    const data: T = r.data ? (r.data as any as T) : (refs.get(r.refData)! as any as T);\n    const indices = r.indices ? r.indices : r.refIndices ? (refs.get(r.refIndices)! as UIntTypedArray) : undefined;\n    if (r.refData) {\n      refs.set(r.refData, data);\n    }\n    if (r.refIndices) {\n      refs.set(r.refIndices, indices!);\n    }\n    return { data, indices };\n  };\n\n  const dateStats = (r: IDateStatsMessageRequest) => {\n    const { data, indices } = resolveRefs<Int32Array>(r);\n\n    const b = dateStatsBuilder(r.template);\n    if (indices) {\n      for (let ii = 0; ii < indices.length; ++ii) {\n        const v = data[indices[ii]];\n        b.push(dateValueCache2Value(v));\n      }\n    } else {\n      for (let i = 0; i < data.length; ++i) {\n        b.push(dateValueCache2Value(data[i]));\n      }\n    }\n    workerSelf.postMessage({\n      type: r.type,\n      uid: r.uid,\n      stats: b.build(),\n    } as IDateStatsMessageResponse);\n  };\n\n  const categoricalStats = (r: ICategoricalStatsMessageRequest) => {\n    const { data, indices } = resolveRefs<UIntTypedArray>(r);\n\n    const cats = r.categories.map((name) => ({ name }));\n    const b = categoricalStatsBuilder(cats);\n    if (indices) {\n      for (let ii = 0; ii < indices.length; ++ii) {\n        b.push(categoricalValueCache2Value(data[indices[ii]], cats));\n      }\n    } else {\n      for (let i = 0; i < data.length; ++i) {\n        b.push(categoricalValueCache2Value(data[i], cats));\n      }\n    }\n\n    workerSelf.postMessage({\n      type: r.type,\n      uid: r.uid,\n      stats: b.build(),\n    } as ICategoricalStatsMessageResponse);\n  };\n\n  const stringStats = (r: IStringStatsMessageRequest) => {\n    const { data, indices } = resolveRefs<readonly string[]>(r);\n\n    const b = stringStatsBuilder(r.topN ?? 10);\n    if (indices) {\n      for (let ii = 0; ii < indices.length; ++ii) {\n        b.push(data[indices[ii]]);\n      }\n    } else {\n      for (let i = 0; i < data.length; ++i) {\n        b.push(data[i]);\n      }\n    }\n\n    workerSelf.postMessage({\n      type: r.type,\n      uid: r.uid,\n      stats: b.build(),\n    } as IStringStatsMessageResponse);\n  };\n\n  const numberStats = (r: INumberStatsMessageRequest) => {\n    const { data, indices } = resolveRefs<Float64Array>(r);\n\n    const b = numberStatsBuilder(r.domain ?? [0, 1], r.numberOfBins);\n\n    if (indices) {\n      for (let ii = 0; ii < indices.length; ++ii) {\n        b.push(data[indices[ii]]);\n      }\n    } else {\n      for (let i = 0; i < data.length; ++i) {\n        b.push(data[i]);\n      }\n    }\n\n    workerSelf.postMessage({\n      type: r.type,\n      uid: r.uid,\n      stats: b.build(),\n    } as INumberStatsMessageResponse);\n  };\n\n  const boxplotStats = (r: IBoxPlotStatsMessageRequest) => {\n    const { data, indices } = resolveRefs<Float64Array>(r);\n\n    const b = boxplotBuilder(indices ? indices.length : undefined);\n\n    let stats: IAdvancedBoxPlotData;\n    if (!indices) {\n      stats = b.buildArr(data);\n    } else {\n      for (let ii = 0; ii < indices.length; ++ii) {\n        b.push(data[indices[ii]]);\n      }\n      stats = b.build();\n    }\n\n    workerSelf.postMessage({\n      type: r.type,\n      uid: r.uid,\n      stats,\n    } as IBoxPlotStatsMessageResponse);\n  };\n\n  // message type to handler function\n  const msgHandlers: { [key: string]: (r: any) => void } = {\n    sort,\n    setRef,\n    deleteRef,\n    dateStats,\n    categoricalStats,\n    numberStats,\n    boxplotStats,\n    stringStats,\n  };\n\n  workerSelf.addEventListener('message', (evt) => {\n    const r = evt.data;\n    if (typeof r.uid !== 'number' || typeof r.type !== 'string') {\n      return;\n    }\n    const h = msgHandlers[r.type];\n    if (h) {\n      h(r);\n    }\n  });\n}\n\n/**\n * copy source code of a worker and create a blob out of it\n * to avoid webpack imports all the code functions need to be in this file\n * @internal\n */\nexport function createWorkerBlob() {\n  return createWorkerCodeBlob([\n    pushAll.toString(),\n    quantile.toString(),\n    numberStatsBuilder.toString(),\n    boxplotBuilder.toString(),\n    computeGranularity.toString(),\n    pushDateHist.toString(),\n    dateStatsBuilder.toString(),\n    categoricalStatsBuilder.toString(),\n    stringStatsBuilder.toString(),\n    createIndexArray.toString(),\n    asc.toString(),\n    desc.toString(),\n    sortComplex.toString(),\n    dateValueCache2Value.toString(),\n    categoricalValueCache2Value.toString(),\n    toFunctionBody(sortWorkerMain),\n  ]);\n}\n","import * as equalImpl from 'fast-deep-equal';\n\n// keep here to have a \"real\" export for webpack not just interfaces\n\n/**\n * deep equal comparison\n */\nexport function equal(a: any, b: any): boolean {\n  const f = typeof equalImpl === 'function' ? equalImpl : (equalImpl as any).default;\n  return f(a, b);\n}\n\n/** @internal */\nexport function equalArrays<T>(a: T[], b: T[]) {\n  if (a.length !== b.length) {\n    return false;\n  }\n  return a.every((ai, i) => ai === b[i]);\n}\n\n/**\n * converts a given id to css compatible one\n * @param id\n * @return {string|void}\n * @internal\n */\nexport function fixCSS(id: string) {\n  return id.replace(/[\\s!#$%&'()*+,./:;<=>?@[\\\\\\]^`{|}~]+/g, '_'); //replace non css stuff to _\n}\n\n/**\n * clear node clearing\n * @param node\n * @internal\n */\nexport function clear<T extends Node>(node: T) {\n  while (node.lastChild) {\n    node.removeChild(node.lastChild);\n  }\n  return node;\n}\n\n/**\n * @internal\n * to avoid [].concat(...) which doesn't work for large arrays\n * @param arrs\n */\nexport function concat<T>(arrs: (T[] | T)[]): T[] {\n  const r: T[] = [];\n  for (const a of arrs) {\n    if (!Array.isArray(a)) {\n      r.push(a);\n      continue;\n    }\n    for (const ai of a) {\n      r.push(ai);\n    }\n  }\n  return r;\n}\n\n/**\n * generates a label for the given sort method\n * @internal\n * @param method sort method\n */\nexport function getSortLabel(method: string) {\n  switch (method) {\n    case 'min':\n      return 'Minimum';\n    case 'max':\n      return 'Maximum';\n    case 'median':\n      return 'Median';\n    case 'mean':\n      return 'Mean';\n    case 'q1':\n      return '25% Quantile';\n    case 'q3':\n      return '75% Quantile';\n    default:\n      return String(method);\n  }\n}\n","var noop = {value: () => {}};\n\nfunction dispatch() {\n  for (var i = 0, n = arguments.length, _ = {}, t; i < n; ++i) {\n    if (!(t = arguments[i] + \"\") || (t in _) || /[\\s.]/.test(t)) throw new Error(\"illegal type: \" + t);\n    _[t] = [];\n  }\n  return new Dispatch(_);\n}\n\nfunction Dispatch(_) {\n  this._ = _;\n}\n\nfunction parseTypenames(typenames, types) {\n  return typenames.trim().split(/^|\\s+/).map(function(t) {\n    var name = \"\", i = t.indexOf(\".\");\n    if (i >= 0) name = t.slice(i + 1), t = t.slice(0, i);\n    if (t && !types.hasOwnProperty(t)) throw new Error(\"unknown type: \" + t);\n    return {type: t, name: name};\n  });\n}\n\nDispatch.prototype = dispatch.prototype = {\n  constructor: Dispatch,\n  on: function(typename, callback) {\n    var _ = this._,\n        T = parseTypenames(typename + \"\", _),\n        t,\n        i = -1,\n        n = T.length;\n\n    // If no callback was specified, return the callback of the given type and name.\n    if (arguments.length < 2) {\n      while (++i < n) if ((t = (typename = T[i]).type) && (t = get(_[t], typename.name))) return t;\n      return;\n    }\n\n    // If a type was specified, set the callback for the given type and name.\n    // Otherwise, if a null callback was specified, remove callbacks of the given name.\n    if (callback != null && typeof callback !== \"function\") throw new Error(\"invalid callback: \" + callback);\n    while (++i < n) {\n      if (t = (typename = T[i]).type) _[t] = set(_[t], typename.name, callback);\n      else if (callback == null) for (t in _) _[t] = set(_[t], typename.name, null);\n    }\n\n    return this;\n  },\n  copy: function() {\n    var copy = {}, _ = this._;\n    for (var t in _) copy[t] = _[t].slice();\n    return new Dispatch(copy);\n  },\n  call: function(type, that) {\n    if ((n = arguments.length - 2) > 0) for (var args = new Array(n), i = 0, n, t; i < n; ++i) args[i] = arguments[i + 2];\n    if (!this._.hasOwnProperty(type)) throw new Error(\"unknown type: \" + type);\n    for (t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  },\n  apply: function(type, that, args) {\n    if (!this._.hasOwnProperty(type)) throw new Error(\"unknown type: \" + type);\n    for (var t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  }\n};\n\nfunction get(type, name) {\n  for (var i = 0, n = type.length, c; i < n; ++i) {\n    if ((c = type[i]).name === name) {\n      return c.value;\n    }\n  }\n}\n\nfunction set(type, name, callback) {\n  for (var i = 0, n = type.length; i < n; ++i) {\n    if (type[i].name === name) {\n      type[i] = noop, type = type.slice(0, i).concat(type.slice(i + 1));\n      break;\n    }\n  }\n  if (callback != null) type.push({name: name, value: callback});\n  return type;\n}\n\nexport default dispatch;\n","import { dispatch, Dispatch } from 'd3-dispatch';\n\n/**\n * helper function to suffix the given event types\n * @internal\n */\nexport function suffix(suffix: string, ...prefix: string[]) {\n  return prefix.map((p) => `${p}${suffix}`);\n}\n\nexport interface IEventContext {\n  /**\n   * who is sending this event\n   */\n  readonly source: AEventDispatcher;\n\n  /**\n   * who was sending this event in case of forwarding\n   */\n  readonly origin: AEventDispatcher;\n  /**\n   * the event type\n   */\n  readonly type: string;\n  /**\n   * in case of multi propagation the 'main' event type, aka the first one\n   */\n  readonly primaryType: string;\n  /**\n   * the arguments to the listener\n   */\n  readonly args: any[];\n}\n\nexport interface IEventListener {\n  (this: IEventContext, ...args: any[]): any;\n}\n\nexport interface IEventHandler {\n  on(type: string | string[], listener: IEventListener | null): this;\n}\n\nconst __DEBUG = false;\n\n/**\n * base class for event dispatching using d3 event mechanism, thus .suffix is supported for multiple registrations\n */\nexport default class AEventDispatcher implements IEventHandler {\n  private readonly listeners: Dispatch<any>;\n  private readonly listenerEvents: Set<string>;\n  private readonly forwarder: (...args: any[]) => void;\n\n  constructor() {\n    const events = this.createEventList();\n    this.listenerEvents = new Set(events);\n    this.listeners = dispatch(...events);\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    this.forwarder = function (this: IEventContext, ...args: any[]) {\n      that.fireImpl(this.type, this.primaryType, this.origin, ...args);\n    };\n  }\n\n  on(type: string | string[], listener: IEventListener | null): this {\n    if (Array.isArray(type)) {\n      type.forEach((d) => {\n        if (this.listenerEvents.has(d.split('.')[0])) {\n          this.listenersChanged(d, Boolean(listener!));\n          this.listeners.on(d, listener!);\n        } else if (__DEBUG && !d.includes('.')) {\n          console.warn(this, 'invalid event type', d);\n        }\n      });\n    } else if (this.listenerEvents.has((type as string).split('.')[0])) {\n      this.listenersChanged(type as string, Boolean(listener!));\n      this.listeners.on(type as string, listener!);\n    } else if (__DEBUG && !type.includes('.')) {\n      console.warn(this, 'invalid event type', type);\n    }\n    return this;\n  }\n\n  /**\n   * helper function that will be called upon a listener has changed\n   * @param _type event type\n   * @param _active registered or de registered\n   */\n  protected listenersChanged(_type: string, _active: boolean) {\n    // hook\n  }\n\n  /**\n   * return the list of events to be able to dispatch\n   * @return {Array} by default no events\n   */\n  protected createEventList(): string[] {\n    return [];\n  }\n\n  protected fire(type: string | string[], ...args: any[]) {\n    const primaryType = Array.isArray(type) ? type[0] : type;\n    this.fireImpl(type, primaryType, this, ...args);\n  }\n\n  private fireImpl(type: string | string[], primaryType: string, origin: AEventDispatcher, ...args: any[]) {\n    const fireImpl = (t: string) => {\n      if (!this.listenerEvents.has(t)) {\n        if (__DEBUG) {\n          console.warn(this, 'invalid event type', t);\n        }\n        return;\n      }\n      //local context per event, set a this argument\n      const context: IEventContext = {\n        source: this, //who is sending this event,\n        origin,\n        type: t, //the event type\n        primaryType, //in case of multi propagation the 'main' event type\n        args, //the arguments to the listener\n      };\n      this.listeners.apply(t, context, args);\n    };\n    if (Array.isArray(type)) {\n      type.forEach(fireImpl);\n    } else {\n      fireImpl(type as string);\n    }\n  }\n\n  /**\n   * forwards one or more events from a given dispatcher to the current one\n   * i.e. when one of the given events is fired in 'from' it will be forwarded to all my listeners\n   * @param {IEventHandler} from the event dispatcher to forward from\n   * @param {string[]} types the event types to forward\n   */\n  protected forward(from: IEventHandler, ...types: string[]) {\n    from.on(types, this.forwarder);\n  }\n\n  /**\n   * removes the forwarding declarations\n   * @param {IEventHandler} from the originated dispatcher\n   * @param {string[]} types event types to forward\n   */\n  protected unforward(from: IEventHandler, ...types: string[]) {\n    from.on(types, null);\n  }\n}\n","import 'reflect-metadata';\nimport type Column from './Column';\nimport type { IColumnDesc, IColumnConstructor } from './interfaces';\n\nconst supportType = Symbol.for('SupportType');\nconst category = Symbol.for('Category');\n\nexport function SupportType() {\n  return Reflect.metadata(supportType, true);\n}\n\nexport function SortByDefault(order: 'ascending' | 'descending' = 'ascending') {\n  if (order === 'descending') {\n    return Reflect.metadata(Symbol.for('sortDescendingByDefault'), true);\n  }\n  return (d: any) => d;\n}\n\nexport function isSortingAscByDefault(col: Column) {\n  const clazz = (col as any).constructor;\n  return !Reflect.hasMetadata(Symbol.for('sortDescendingByDefault'), clazz);\n}\n\nexport class Categories {\n  readonly string = { label: 'label', order: 1, name: 'string', featureLevel: 'basic' };\n  readonly categorical = { label: 'categorical', order: 2, name: 'categorical', featureLevel: 'basic' };\n  readonly number = { label: 'numerical', order: 3, name: 'number', featureLevel: 'basic' };\n  readonly date = { label: 'date', order: 4, name: 'date', featureLevel: 'basic' };\n  readonly array = { label: 'matrix', order: 5, name: 'array', featureLevel: 'advanced' };\n  readonly map = { label: 'map', order: 6, name: 'map', featureLevel: 'advanced' };\n  readonly composite = { label: 'combined', order: 7, name: 'composite', featureLevel: 'advanced' };\n  readonly support = { label: 'support', order: 8, name: 'support', featureLevel: 'advanced' };\n  readonly other = { label: 'others', order: 9, name: 'other', featureLevel: 'advanced' };\n}\n\nexport const categories = new Categories();\n\nexport function Category(cat: keyof Categories) {\n  return Reflect.metadata(category, cat);\n}\n\nexport function getSortType(col: Column): 'abc' | 'num' | undefined {\n  const cat = categoryOf(col);\n  const type = col.desc.type;\n  if (cat === categories.string || cat === categories.categorical) {\n    return 'abc';\n  }\n  if (cat === categories.number || type === 'rank' || isSortingAscByDefault(col)) {\n    return 'num';\n  }\n  const numbers = new Set(['rank', 'number', 'numbers', 'ordinal', 'boxplot', 'script', 'reduce', 'stack']);\n  return numbers.has(type) ? 'num' : undefined;\n}\n\nexport function toolbar(...keys: string[]) {\n  return Reflect.metadata(Symbol.for('toolbarIcon'), keys);\n}\n\nexport function dialogAddons(key: string, ...keys: string[]) {\n  return Reflect.metadata(Symbol.for(`toolbarDialogAddon${key}`), keys);\n}\n\nexport function isSupportType(col: Column) {\n  const clazz = (col as any).constructor;\n  return Reflect.hasMetadata(supportType, clazz);\n}\n\nexport interface IColumnCategory {\n  label: string;\n  name: string;\n  order: number;\n  featureLevel: 'basic' | 'advanced';\n}\n\nexport function categoryOf(col: IColumnConstructor | Column): IColumnCategory {\n  const cat = (Reflect.getMetadata(\n    category,\n    typeof col === 'function' ? col : Object.getPrototypeOf(col).constructor\n  ) ?? 'other') as keyof Categories;\n  return (categories[cat] ?? categories.other) as IColumnCategory;\n}\n\nexport function categoryOfDesc(\n  col: IColumnDesc | string,\n  models: { [key: string]: IColumnConstructor }\n): IColumnCategory {\n  const type = typeof col === 'string' ? col : col.type;\n  const clazz = models[type];\n  return clazz ? categoryOf(clazz) : (categories.other as IColumnCategory);\n}\n","import type Column from './Column';\nimport type Ranking from './Ranking';\nimport type CompositeColumn from './CompositeColumn';\nimport type { IColorMappingFunction, IMappingFunction } from './INumberColumn';\nimport type { ICategoricalColorMappingFunction, ICategory } from './ICategoricalColumn';\nimport type { IScriptMappingFunctionType } from './MappingFunction';\n\nexport interface IColumnConstructor {\n  new (id: string, desc: Readonly<IColumnDesc> & any, factory: ITypeFactory): Column;\n}\n\nexport interface IStyleColumn {\n  /**\n   * column description\n   */\n  description: string;\n\n  /**\n   * column summary line (subtitle)\n   */\n  summary: string;\n  /**\n   * whether to render the description as HTML (unsafe)\n   * @default false\n   */\n  summaryAsHTML?: boolean;\n\n  /**\n   * color of this column\n   * @deprecated not used anymore\n   */\n  color: string;\n\n  /**\n   * frozen column\n   * @default isSupportType\n   */\n  frozen: boolean;\n\n  /**\n   * whether the column can be removed or not\n   * @default false\n   */\n  fixed: boolean;\n\n  /**\n   * default renderer to use\n   */\n  renderer: string;\n\n  /**\n   * default group renderer to use\n   */\n  groupRenderer: string;\n\n  /**\n   * default summary renderer to use\n   */\n  summaryRenderer: string;\n\n  /**\n   * initial width of the column\n   * @default 100 or 200 for strings\n   */\n  width: number;\n\n  /**\n   * is this column visible by default\n   * @default true\n   */\n  visible: boolean;\n}\n\nexport interface IColumnDesc extends Partial<IStyleColumn> {\n  /**\n   * label of the column\n   */\n  label: string;\n\n  /**\n   * whether to render the label as HTML (unsafe)\n   * @default false\n   */\n  labelAsHTML?: boolean;\n\n  /**\n   * the column type\n   */\n  type: string;\n}\n\nexport interface IValueColumnDesc<T> extends IColumnDesc {\n  /**\n   * is the data lazy loaded and not yet available\n   * @default false\n   */\n  lazyLoaded?: boolean;\n\n  /**\n   * value accessor of this column\n   * @param row the current row\n   * @param desc the description of this column\n   */\n  accessor?(row: IDataRow, desc: Readonly<IValueColumnDesc<T>>): T;\n}\n\nexport interface IFlatColumn {\n  readonly col: Column;\n  readonly offset: number;\n  readonly width: number;\n}\n\nexport interface IColumnParent {\n  remove(col: Column): boolean;\n\n  insert(col: Column, index?: number): Column | null;\n\n  insertBefore(col: Column, reference: Column): Column | null;\n\n  insertAfter(col: Column, reference: Column): Column | null;\n\n  move(col: Column, index?: number): Column | null;\n\n  moveBefore(col: Column, reference: Column): Column | null;\n  moveAfter(col: Column, reference: Column): Column | null;\n\n  findMyRanker(): Ranking | null;\n\n  readonly fqid: string;\n\n  indexOf(col: Column): number;\n\n  at(index: number): Column;\n\n  readonly fqpath: string;\n}\n\nexport interface IColumnMetaData {\n  label: string;\n  summary: string;\n  description: string;\n}\n\nexport declare type ICompareValue = string | number | null;\n\n/**\n * a data row for rendering\n */\nexport interface IDataRow {\n  /**\n   * the value\n   */\n  readonly v: any;\n  /**\n   * the underlying data index\n   */\n  readonly i: number;\n}\n\nexport interface IGroup {\n  name: string;\n  color: string;\n  parent?: Readonly<IGroupParent> | null;\n}\n\nexport declare type IndicesArray = (ReadonlyArray<number> | UIntTypedArray) & ArrayLike<number>;\n\nexport interface IOrderedGroup extends IGroup {\n  order: IndicesArray;\n}\n\nexport const defaultGroup: IGroup = {\n  name: 'Default',\n  color: 'gray',\n};\n\nexport const othersGroup: IGroup = {\n  name: 'Others',\n  color: 'gray',\n};\n\nexport interface IGroupParent extends IGroup {\n  subGroups: (Readonly<IGroupParent> | Readonly<IGroup>)[];\n}\n\nexport interface IGroupItem {\n  readonly dataIndex: number;\n  readonly group: Readonly<IOrderedGroup>;\n  readonly relativeIndex: number;\n}\n\nexport declare type IGroupData = Readonly<IOrderedGroup>;\n\nexport function isGroup(item: IGroupData | IGroupItem): item is IGroupData {\n  return item && (item as IGroupItem).group == null; // use .group as separator\n}\n\nexport declare type UIntTypedArray = Uint8Array | Uint16Array | Uint32Array;\n\nexport enum ECompareValueType {\n  BINARY,\n  COUNT, // count max to the number of rows\n  UINT8,\n  UINT16,\n  UINT32,\n  INT8,\n  INT16,\n  INT32,\n  FLOAT,\n  FLOAT_ASC,\n  DOUBLE,\n  DOUBLE_ASC,\n  STRING,\n}\n\nexport interface ITypedDump {\n  readonly type: string;\n  [key: string]: any;\n}\n\nexport interface IColumnDump {\n  id: string;\n  width?: number;\n  desc: any;\n  label?: string;\n  summary?: string;\n  renderer?: string;\n  /**\n   * @deprecated\n   */\n  rendererType?: string;\n  groupRenderer?: string;\n  summaryRenderer?: string;\n\n  // type specific\n  [key: string]: any;\n}\n\nexport interface IRankingDump {\n  /**\n   * columsn of this ranking\n   */\n  columns?: IColumnDump[];\n\n  /**\n   * sort criteria\n   */\n  sortCriteria?: { asc: boolean; sortBy: string }[];\n\n  /**\n   * group sort criteria\n   */\n  groupSortCriteria?: { asc: boolean; sortBy: string }[];\n\n  /**\n   * uids of group columns\n   */\n  groupColumns?: string[];\n\n  /**\n   * compatibility\n   * @deprecated\n   */\n  sortColumn?: { sortBy: string; asc: boolean };\n}\n\nexport interface ITypeFactory {\n  (dump: IColumnDump): Column;\n\n  colorMappingFunction(dump?: ITypedDump | string | ((v: number) => string)): IColorMappingFunction;\n  mappingFunction(dump?: ITypedDump | IScriptMappingFunctionType): IMappingFunction;\n  categoricalColorMappingFunction(\n    dump: ITypedDump | undefined,\n    categories: ICategory[]\n  ): ICategoricalColorMappingFunction;\n}\n\nexport interface IMultiLevelColumn extends CompositeColumn {\n  getCollapsed(): boolean;\n\n  setCollapsed(value: boolean): void;\n\n  /**\n   * whether to show nested summaries or not\n   */\n  isShowNestedSummaries(): boolean;\n}\n\nexport function isMultiLevelColumn(col: Column): col is IMultiLevelColumn {\n  return typeof (col as IMultiLevelColumn).getCollapsed === 'function';\n}\n\nexport interface ISortCriteria {\n  readonly col: Column;\n  readonly asc: boolean;\n}\n","import { AEventDispatcher, ISequence, similar, fixCSS, IEventListener } from '../internal';\nimport { isSortingAscByDefault } from './annotations';\nimport {\n  IColumnDump,\n  ISortCriteria,\n  defaultGroup,\n  ECompareValueType,\n  IColumnDesc,\n  IDataRow,\n  IGroup,\n  IColumnParent,\n  IColumnMetaData,\n  IFlatColumn,\n  ICompareValue,\n  ITypeFactory,\n} from './interfaces';\nimport type Ranking from './Ranking';\n\n/**\n * default color that should be used\n * @type {string}\n */\nexport const DEFAULT_COLOR = '#C1C1C1';\n\n/**\n * emitted when the width property changes\n * @asMemberOf Column\n * @event\n */\nexport declare function widthChanged(previous: number, current: number): void;\n\n/**\n * emitted when the label property changes\n * @asMemberOf Column\n * @event\n */\nexport declare function labelChanged(previous: string, current: string): void;\n\n/**\n * emitted when the meta data property changes\n * @asMemberOf Column\n * @event\n */\nexport declare function metaDataChanged(previous: IColumnMetaData, current: IColumnMetaData): void;\n\n/**\n * emitted when state of the column is dirty\n * @asMemberOf Column\n * @event\n */\nexport declare function dirty(): void;\n\n/**\n * emitted when state of the column related to its header is dirty\n * @asMemberOf Column\n * @event\n */\nexport declare function dirtyHeader(): void;\n\n/**\n * emitted when state of the column related to its values is dirty\n * @asMemberOf Column\n * @event\n */\nexport declare function dirtyValues(): void;\n\n/**\n * emitted when state of the column related to cached values (hist, compare, ...) is dirty\n * @asMemberOf Column\n * @event\n */\nexport declare function dirtyCaches(): void;\n\n/**\n * emitted when the renderer type property changes\n * @asMemberOf Column\n * @event\n */\nexport declare function rendererTypeChanged(previous: string, current: string): void;\n\n/**\n * emitted when the group renderer property changes\n * @asMemberOf Column\n * @event\n */\nexport declare function groupRendererChanged(previous: string, current: string): void;\n\n/**\n * emitted when the pattern property changes\n * @asMemberOf Column\n * @event\n */\nexport declare function summaryRendererChanged(previous: string, current: string): void;\n\n/**\n * emitted when the visibility of this column changes\n * @asMemberOf Column\n * @event\n */\nexport declare function visibilityChanged(previous: boolean, current: boolean): void;\n\n/**\n * a column in LineUp\n */\nexport default class Column extends AEventDispatcher {\n  /**\n   * magic variable for showing all columns\n   * @type {number}\n   */\n  static readonly FLAT_ALL_COLUMNS = -1;\n\n  static readonly EVENT_WIDTH_CHANGED = 'widthChanged';\n  static readonly EVENT_LABEL_CHANGED = 'labelChanged';\n  static readonly EVENT_METADATA_CHANGED = 'metaDataChanged';\n  static readonly EVENT_DIRTY = 'dirty';\n  static readonly EVENT_DIRTY_HEADER = 'dirtyHeader';\n  static readonly EVENT_DIRTY_VALUES = 'dirtyValues';\n  static readonly EVENT_DIRTY_CACHES = 'dirtyCaches';\n  static readonly EVENT_RENDERER_TYPE_CHANGED = 'rendererTypeChanged';\n  static readonly EVENT_GROUP_RENDERER_TYPE_CHANGED = 'groupRendererChanged';\n  static readonly EVENT_SUMMARY_RENDERER_TYPE_CHANGED = 'summaryRendererChanged';\n  static readonly EVENT_VISIBILITY_CHANGED = 'visibilityChanged';\n\n  /**\n   * the id of this column\n   */\n  private uid: string;\n\n  /**\n   * width of the column\n   * @type {number}\n   * @private\n   */\n  private width = 100;\n\n  /**\n   * parent column of this column, set when added to a ranking or combined column\n   */\n  parent: Readonly<IColumnParent> | null = null;\n\n  private metadata: Readonly<IColumnMetaData>;\n  private renderer: string;\n  private groupRenderer: string;\n  private summaryRenderer: string;\n  private visible: boolean;\n\n  constructor(id: string, public readonly desc: Readonly<IColumnDesc>) {\n    super();\n    this.uid = fixCSS(id);\n    this.renderer = this.desc.renderer || this.desc.type;\n    this.groupRenderer = this.desc.groupRenderer || this.desc.type;\n    this.summaryRenderer = this.desc.summaryRenderer || this.desc.type;\n    this.width = this.desc.width != null && this.desc.width > 0 ? this.desc.width : 100;\n    this.visible = this.desc.visible !== false;\n\n    this.metadata = {\n      label: desc.label || this.id,\n      summary: desc.summary || '',\n      description: desc.description || '',\n    };\n  }\n\n  get fixed() {\n    return Boolean(this.desc.fixed);\n  }\n\n  get frozen() {\n    return Boolean(this.desc.frozen);\n  }\n\n  get id() {\n    return this.uid;\n  }\n\n  assignNewId(idGenerator: () => string) {\n    this.uid = fixCSS(idGenerator());\n  }\n\n  get label() {\n    return this.metadata.label;\n  }\n\n  get description() {\n    return this.metadata.description;\n  }\n\n  /**\n   * returns the fully qualified id i.e. path the parent\n   * @returns {string}\n   */\n  get fqid() {\n    return this.parent ? `${this.parent.fqid}_${this.id}` : this.id;\n  }\n\n  get fqpath() {\n    return this.parent ? `${this.parent.fqpath}@${this.parent.indexOf(this)}` : '';\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        Column.EVENT_WIDTH_CHANGED,\n        Column.EVENT_LABEL_CHANGED,\n        Column.EVENT_METADATA_CHANGED,\n        Column.EVENT_VISIBILITY_CHANGED,\n        Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED,\n        Column.EVENT_RENDERER_TYPE_CHANGED,\n        Column.EVENT_GROUP_RENDERER_TYPE_CHANGED,\n        Column.EVENT_DIRTY,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n      ]);\n  }\n\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  getWidth() {\n    return this.width;\n  }\n\n  hide() {\n    this.setVisible(false);\n  }\n\n  show() {\n    this.setVisible(true);\n  }\n\n  isVisible() {\n    return this.visible;\n  }\n\n  getVisible() {\n    return this.isVisible();\n  }\n\n  setVisible(value: boolean) {\n    if (this.visible === value) {\n      return;\n    }\n    this.fire(\n      [Column.EVENT_VISIBILITY_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.visible,\n      (this.visible = value)\n    );\n  }\n\n  /**\n   * visitor pattern for flattening the columns\n   * @param {IFlatColumn} r the result array\n   * @param {number} offset left offset\n   * @param {number} _levelsToGo how many levels down\n   * @param {number} _padding padding between columns\n   * @returns {number} the used width by this column\n   */\n  flatten(r: IFlatColumn[], offset: number, _levelsToGo = 0, _padding = 0): number {\n    const w = this.getWidth();\n    r.push({ col: this, offset, width: w });\n    return w;\n  }\n\n  setWidth(value: number) {\n    if (similar(this.width, value, 0.5)) {\n      return;\n    }\n    this.fire(\n      [Column.EVENT_WIDTH_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.width,\n      (this.width = value)\n    );\n  }\n\n  setWidthImpl(value: number) {\n    this.width = value;\n  }\n\n  setMetaData(value: Readonly<IColumnMetaData>) {\n    if (\n      value.label === this.label &&\n      this.description === value.description &&\n      this.metadata.summary === value.summary\n    ) {\n      return;\n    }\n    const bak = this.getMetaData();\n    //copy to avoid reference\n    this.metadata = {\n      label: value.label,\n      summary: value.summary,\n      description: value.description,\n    };\n\n    this.fire(\n      [Column.EVENT_LABEL_CHANGED, Column.EVENT_METADATA_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY],\n      bak,\n      this.getMetaData()\n    );\n  }\n\n  getMetaData(): Readonly<IColumnMetaData> {\n    return Object.assign({}, this.metadata);\n  }\n\n  /**\n   * triggers that the ranking is sorted by this column\n   * @param ascending ascending order?\n   * @param priority sorting priority\n   * @returns {boolean} was successful\n   */\n  sortByMe(ascending = isSortingAscByDefault(this), priority = 0) {\n    const r = this.findMyRanker();\n    if (r) {\n      return r.sortBy(this, ascending, priority);\n    }\n    return false;\n  }\n\n  groupByMe(): boolean {\n    const r = this.findMyRanker();\n    if (r) {\n      return r.toggleGrouping(this);\n    }\n    return false;\n  }\n\n  /**\n   *\n   * @return {number}\n   */\n  isGroupedBy(): number {\n    const r = this.findMyRanker();\n    if (!r) {\n      return -1;\n    }\n    return r.getGroupCriteria().indexOf(this);\n  }\n\n  /**\n   * toggles the sorting order of this column in the ranking\n   * @returns {boolean} was successful\n   */\n  toggleMySorting() {\n    const r = this.findMyRanker();\n    if (r) {\n      return r.toggleSorting(this);\n    }\n    return false;\n  }\n\n  private isSortedByMeImpl(selector: (r: Ranking) => ISortCriteria[]): {\n    asc: 'asc' | 'desc' | undefined;\n    priority: number | undefined;\n  } {\n    const ranker = this.findMyRanker();\n    if (!ranker) {\n      return { asc: undefined, priority: undefined };\n    }\n    const criterias = selector(ranker);\n    const index = criterias.findIndex((c) => c.col === this);\n    if (index < 0) {\n      return { asc: undefined, priority: undefined };\n    }\n    return {\n      asc: criterias[index].asc ? 'asc' : 'desc',\n      priority: index,\n    };\n  }\n\n  isSortedByMe() {\n    return this.isSortedByMeImpl((r) => r.getSortCriteria());\n  }\n\n  groupSortByMe(ascending = isSortingAscByDefault(this), priority = 0) {\n    const r = this.findMyRanker();\n    if (r) {\n      return r.groupSortBy(this, ascending, priority);\n    }\n    return false;\n  }\n\n  toggleMyGroupSorting() {\n    const r = this.findMyRanker();\n    if (r) {\n      return r.toggleGroupSorting(this);\n    }\n    return false;\n  }\n\n  isGroupSortedByMe() {\n    return this.isSortedByMeImpl((r) => r.getGroupSortCriteria());\n  }\n\n  /**\n   * removes the column from the ranking\n   * @returns {boolean} was successful\n   */\n  removeMe() {\n    if (this.fixed) {\n      return false;\n    }\n    if (this.parent) {\n      return this.parent.remove(this);\n    }\n    return false;\n  }\n\n  /**\n   * called when the columns added to a ranking\n   */\n  attach(parent: IColumnParent) {\n    this.parent = parent;\n  }\n\n  /**\n   * called when the column is removed from the ranking\n   */\n  detach() {\n    this.parent = null;\n  }\n\n  /**\n   * inserts the given column after itself\n   * @param col the column to insert\n   * @returns {boolean} was successful\n   */\n  insertAfterMe(col: Column) {\n    if (this.parent) {\n      return this.parent.insertAfter(col, this) != null;\n    }\n    return false;\n  }\n\n  /**\n   * inserts the given column before itself\n   * @param col the column to insert\n   * @returns {boolean} was successful\n   */\n  insertBeforeMe(col: Column) {\n    if (this.parent) {\n      return this.parent.insertBefore(col, this) != null;\n    }\n    return false;\n  }\n\n  /**\n   * returns the next sibling\n   * @returns {Column | null}\n   */\n  nextSibling(): Column | null {\n    if (this.parent) {\n      const index = this.parent.indexOf(this);\n      return index < 0 ? null : this.parent.at(index + 1) ?? null;\n    }\n    return null;\n  }\n\n  /**\n   * returns the previous sibling\n   * @returns {Column | null}\n   */\n  previousSibling(): Column | null {\n    if (this.parent) {\n      const index = this.parent.indexOf(this);\n      return index < 1 ? null : this.parent.at(index - 1) ?? null;\n    }\n    return null;\n  }\n\n  /**\n   * finds the underlying ranking column\n   * @returns {Ranking|null} my current ranking\n   */\n  findMyRanker(): Ranking | null {\n    if (this.parent) {\n      return this.parent.findMyRanker();\n    }\n    return null;\n  }\n\n  /**\n   * dumps this column to JSON compatible format\n   * @param toDescRef helper mapping function\n   * @returns {any} dump of this column\n   */\n  dump(toDescRef: (desc: any) => any): any {\n    const r: IColumnDump = {\n      id: this.id,\n      desc: toDescRef(this.desc),\n      width: this.width,\n    };\n    if (this.label !== (this.desc.label || this.id)) {\n      r.label = this.label;\n    }\n    if (this.metadata.summary) {\n      r.summary = this.metadata.summary;\n    }\n    if (this.getRenderer() !== this.desc.type) {\n      r.renderer = this.getRenderer();\n    }\n    if (this.getGroupRenderer() !== this.desc.type) {\n      r.groupRenderer = this.getGroupRenderer();\n    }\n    if (this.getSummaryRenderer() !== this.desc.type) {\n      r.summaryRenderer = this.getSummaryRenderer();\n    }\n    return r;\n  }\n\n  /**\n   * restore the column content from a dump\n   * @param dump column dump\n   * @param _factory helper for creating columns\n   */\n  restore(dump: IColumnDump, _factory: ITypeFactory) {\n    this.uid = dump.id;\n    this.width = dump.width || this.width;\n    this.metadata = {\n      label: dump.label || this.label,\n      summary: dump.summary || '',\n      description: this.description,\n    };\n    if (dump.renderer || dump.rendererType) {\n      this.renderer = dump.renderer || dump.rendererType || this.renderer;\n    }\n    if (dump.groupRenderer) {\n      this.groupRenderer = dump.groupRenderer;\n    }\n    if (dump.summaryRenderer) {\n      this.summaryRenderer = dump.summaryRenderer;\n    }\n  }\n\n  /**\n   * return the label of a given row for the current column\n   * @param row the current row\n   * @return {string} the label of this column at the specified row\n   */\n  getLabel(row: IDataRow): string {\n    const v = this.getValue(row);\n    return v == null ? '' : String(v);\n  }\n\n  /**\n   * return the value of a given row for the current column\n   * @param _row the current row\n   * @return the value of this column at the specified row\n   */\n  getValue(_row: IDataRow): any | null {\n    return ''; //no value\n  }\n\n  /**\n   * returns the value to be used when exporting\n   * @param format format hint\n   */\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    return format === 'text' ? this.getLabel(row) : this.getValue(row);\n  }\n\n  getColor(_row: IDataRow) {\n    return DEFAULT_COLOR;\n  }\n\n  toCompareValue(_row: IDataRow, _valueCache?: any): ICompareValue | ICompareValue[] {\n    return 0;\n  }\n\n  toCompareValueType(): ECompareValueType | ECompareValueType[] {\n    return ECompareValueType.UINT8;\n  }\n\n  /**\n   * group the given row into a bin/group\n   * @param _row\n   * @return {IGroup}\n   */\n  group(_row: IDataRow, _valueCache?: any): IGroup {\n    return Object.assign({}, defaultGroup);\n  }\n\n  toCompareGroupValue(\n    _rows: ISequence<IDataRow>,\n    group: IGroup,\n    _valueCache?: ISequence<any>\n  ): ICompareValue | ICompareValue[] {\n    return group.name.toLowerCase();\n  }\n\n  toCompareGroupValueType(): ECompareValueType | ECompareValueType[] {\n    return ECompareValueType.STRING;\n  }\n\n  /**\n   * flag whether any filter is applied\n   * @return {boolean}\n   */\n  isFiltered() {\n    return false;\n  }\n\n  /**\n   * clear the filter\n   * @return {boolean} whether the filtered needed to be reset\n   */\n  clearFilter() {\n    // hook to clear the filter\n    return false;\n  }\n\n  /**\n   * predicate whether the current row should be included\n   * @param row\n   * @return {boolean}\n   */\n  filter(row: IDataRow, _valueCache?: any) {\n    return row != null;\n  }\n\n  /**\n   * determines the renderer type that should be used to render this column. By default the same type as the column itself\n   * @return {string}\n   */\n  getRenderer(): string {\n    return this.renderer;\n  }\n\n  getGroupRenderer(): string {\n    return this.groupRenderer;\n  }\n\n  getSummaryRenderer(): string {\n    return this.summaryRenderer;\n  }\n\n  setRenderer(renderer: string) {\n    if (renderer === this.renderer) {\n      // nothing changes\n      return;\n    }\n    this.fire(\n      [Column.EVENT_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.renderer,\n      (this.renderer = renderer)\n    );\n  }\n\n  setGroupRenderer(renderer: string) {\n    if (renderer === this.groupRenderer) {\n      // nothing changes\n      return;\n    }\n    this.fire(\n      [Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.groupRenderer,\n      (this.groupRenderer = renderer)\n    );\n  }\n\n  setSummaryRenderer(renderer: string) {\n    if (renderer === this.summaryRenderer) {\n      // nothing changes\n      return;\n    }\n    this.fire(\n      [Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY],\n      this.summaryRenderer,\n      (this.summaryRenderer = renderer)\n    );\n  }\n\n  /**\n   * marks the header, values, or both as dirty such that the values are reevaluated\n   * @param type specify in more detail what is dirty, by default whole column\n   */\n  markDirty(type: 'header' | 'values' | 'all' = 'all') {\n    switch (type) {\n      case 'header':\n        return this.fire([Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY]);\n      case 'values':\n        return this.fire([Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY]);\n      default:\n        return this.fire([\n          Column.EVENT_DIRTY_HEADER,\n          Column.EVENT_DIRTY_VALUES,\n          Column.EVENT_DIRTY_CACHES,\n          Column.EVENT_DIRTY,\n        ]);\n    }\n  }\n}\n","import Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  dirtyCaches,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n} from './Column';\nimport type { IValueColumnDesc, IDataRow, ITypeFactory } from './interfaces';\nimport type { IEventListener, ISequence } from '../internal';\n\n/**\n * emitted when the data of this column has been loaded\n * @asMemberOf ValueColumn\n * @event\n */\nexport declare function dataLoaded(previous: boolean, current: boolean): void;\n\n/**\n * a column having an accessor to get the cell value\n */\nexport default class ValueColumn<T> extends Column {\n  static readonly EVENT_DATA_LOADED = 'dataLoaded';\n\n  static readonly RENDERER_LOADING = 'loading';\n\n  private readonly accessor: (row: IDataRow, desc: Readonly<IValueColumnDesc<T>>) => T;\n\n  /**\n   * is the data available\n   * @type {boolean}\n   */\n  private loaded: boolean;\n\n  constructor(id: string, desc: Readonly<IValueColumnDesc<T>>) {\n    super(id, desc);\n    //find accessor\n    this.accessor = desc.accessor! || (() => null);\n    this.loaded = desc.lazyLoaded !== true;\n  }\n\n  onDataUpdate(_rows: ISequence<IDataRow>): void {\n    // hook for listening to data updates\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([ValueColumn.EVENT_DATA_LOADED]);\n  }\n\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getLabel(row: IDataRow) {\n    if (!this.isLoaded()) {\n      return '';\n    }\n    const v = this.getValue(row);\n    return v == null ? '' : String(v);\n  }\n\n  getRaw(row: IDataRow): T | null {\n    if (!this.isLoaded()) {\n      return null;\n    }\n    return this.accessor(row, this.desc);\n  }\n\n  getValue(row: IDataRow): T | null {\n    return this.getRaw(row);\n  }\n\n  isLoaded() {\n    return this.loaded;\n  }\n\n  setLoaded(loaded: boolean) {\n    if (this.loaded === loaded) {\n      return;\n    }\n    this.fire(\n      [\n        ValueColumn.EVENT_DATA_LOADED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.loaded,\n      (this.loaded = loaded)\n    );\n  }\n\n  getRenderer(): string {\n    if (!this.isLoaded()) {\n      return ValueColumn.RENDERER_LOADING;\n    }\n    return super.getRenderer();\n  }\n\n  /**\n   * patch the dump such that the loaded attribute is defined (for lazy loading columns)\n   * @param toDescRef\n   * @returns {any}\n   */\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.loaded = this.loaded;\n\n    if (!this.loaded && r.renderer === ValueColumn.RENDERER_LOADING) {\n      delete r.renderer;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    if (dump.loaded !== undefined) {\n      this.loaded = dump.loaded;\n    }\n    super.restore(dump, factory);\n  }\n}\n","import type { IAdvancedBoxPlotData, IBoxPlotData, IForEachAble } from '../internal';\nimport Column from './Column';\nimport type { IArrayColumn } from './IArrayColumn';\nimport type { IColumnDesc, IDataRow, ITypedDump, ITypeFactory } from './interfaces';\n\nexport interface IColorMappingFunction {\n  apply(v: number): string;\n\n  toJSON(): ITypedDump | string;\n\n  clone(): IColorMappingFunction;\n\n  eq(other: IColorMappingFunction): boolean;\n}\n\nexport interface IColorMappingFunctionConstructor {\n  new (dump: ITypedDump | string, factory: ITypeFactory): IColorMappingFunction;\n}\n\nexport interface IMappingFunction {\n  //new(domain: number[]);\n\n  apply(v: number): number;\n\n  toJSON(): ITypedDump;\n\n  domain: number[];\n\n  clone(): IMappingFunction;\n\n  eq(other: IMappingFunction): boolean;\n\n  getRange(formatter: (v: number) => string): [string, string];\n}\n\nexport interface IMappingFunctionConstructor {\n  new (dump: ITypedDump): IMappingFunction;\n}\n\nexport interface IMapAbleDesc {\n  /**\n   * dump of mapping function\n   */\n  map?: ITypedDump;\n  /**\n   * either map or domain should be available\n   */\n  domain?: [number | null, number | null];\n  /**\n   * @default [0,1]\n   */\n  range?: [number, number];\n\n  /**\n   * @deprecated use colorMapping instead\n   */\n  color?: string;\n\n  /**\n   * color mapping\n   */\n  colorMapping?: string | ((v: number) => string) | ITypedDump;\n}\n\nexport interface IMapAbleColumn extends INumberColumn {\n  getOriginalMapping(): IMappingFunction;\n\n  getMapping(): IMappingFunction;\n\n  setMapping(mapping: IMappingFunction): void;\n\n  getColorMapping(): IColorMappingFunction;\n\n  setColorMapping(mapping: IColorMappingFunction): void;\n\n  getFilter(): INumberFilter;\n\n  setFilter(value: INumberFilter | null): void;\n\n  getRange(): [string, string];\n}\n\nexport function isMapAbleColumn(col: Column): col is IMapAbleColumn;\nexport function isMapAbleColumn(col: IColumnDesc): col is IMapAbleDesc & IColumnDesc;\nexport function isMapAbleColumn(col: Column | IColumnDesc) {\n  return (\n    (col instanceof Column && typeof (col as IMapAbleColumn).getMapping === 'function') ||\n    (!(col instanceof Column) &&\n      isNumberColumn(col) &&\n      ((col as IColumnDesc).type.startsWith('number') || (col as IColumnDesc).type.startsWith('boxplot')))\n  );\n}\n\nexport interface INumberColumn extends Column {\n  getNumber(row: IDataRow): number;\n\n  getRawNumber(row: IDataRow): number;\n\n  iterNumber(row: IDataRow): IForEachAble<number>;\n  iterRawNumber(row: IDataRow): IForEachAble<number>;\n\n  getNumberFormat(): (v: number) => string;\n}\n\nexport interface INumberDesc extends IMapAbleDesc {\n  /**\n   * d3 formatting option\n   * @default .3n\n   */\n  numberFormat?: string;\n\n  /**\n   * The accuracy defines the deviation of values to the applied filter boundary.\n   * Use an accuracy closer to 0 for columns with smaller numbers (e.g., 1e-9).\n   * @default 0.001\n   */\n  filterAccuracy?: number;\n}\n\n/**\n * checks whether the given column or description is a number column, i.e. the value is a number\n * @param col\n * @returns {boolean}\n */\nexport function isNumberColumn(col: Column): col is INumberColumn;\nexport function isNumberColumn(col: IColumnDesc): col is INumberDesc & IColumnDesc;\nexport function isNumberColumn(col: Column | IColumnDesc) {\n  return (\n    (col instanceof Column && typeof (col as INumberColumn).getNumber === 'function') ||\n    (!(col instanceof Column) && (col as IColumnDesc).type.match(/(number|stack|ordinal)/) != null)\n  );\n}\n\nexport enum ESortMethod {\n  min = 'min',\n  max = 'max',\n  median = 'median',\n  q1 = 'q1',\n  q3 = 'q3',\n}\n\nexport interface IBoxPlotColumn extends INumberColumn, IMapAbleColumn {\n  getBoxPlotData(row: IDataRow): IBoxPlotData | null;\n\n  getMapping(): IMappingFunction;\n\n  getRawBoxPlotData(row: IDataRow): IBoxPlotData | null;\n\n  getSortMethod(): string;\n\n  setSortMethod(sortMethod: string): void;\n}\n\nexport function isBoxPlotColumn(col: Column): col is IBoxPlotColumn {\n  return typeof (col as IBoxPlotColumn).getBoxPlotData === 'function';\n}\n\nexport enum EAdvancedSortMethod {\n  min = 'min',\n  max = 'max',\n  median = 'median',\n  q1 = 'q1',\n  q3 = 'q3',\n  mean = 'mean',\n}\n\nexport interface IAdvancedBoxPlotColumn extends IBoxPlotColumn {\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null;\n\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null;\n}\n\nexport interface INumbersColumn extends IAdvancedBoxPlotColumn, IArrayColumn<number> {\n  getNumbers(row: IDataRow): number[];\n\n  getRawNumbers(row: IDataRow): number[];\n}\n\nexport function isNumbersColumn(col: Column): col is INumbersColumn {\n  return isBoxPlotColumn(col) && typeof (col as INumbersColumn).getNumbers === 'function';\n}\n\nexport interface INumberFilter {\n  min: number;\n  max: number;\n  filterMissing: boolean;\n}\n","import { suffix, IEventListener } from '../internal';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport { Category, toolbar } from './annotations';\nimport type { IDataRow, IColumnParent, IFlatColumn, ITypeFactory } from './interfaces';\nimport { isNumberColumn } from './INumberColumn';\nimport ValueColumn from './ValueColumn';\n\n/**\n * emitted when the filter property changes\n * @asMemberOf CompositeColumn\n * @event\n */\nexport declare function filterChanged(previous: any | null, current: any | null): void;\n\n/**\n * emitted when a column has been added\n * @asMemberOf CompositeColumn\n * @event\n */\nexport declare function addColumn(col: Column, index: number): void;\n\n/**\n * emitted when a column has been moved within this composite columm\n * @asMemberOf CompositeColumn\n * @event\n */\nexport declare function moveColumn(col: Column, index: number, oldIndex: number): void;\n\n/**\n * emitted when a column has been removed\n * @asMemberOf CompositeColumn\n * @event\n */\nexport declare function removeColumn(col: Column, index: number): void;\n\n/**\n * implementation of a combine column, standard operations how to select\n */\n@toolbar('compositeContained', 'splitCombined')\n@Category('composite')\nexport default class CompositeColumn extends Column implements IColumnParent {\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\n  static readonly EVENT_ADD_COLUMN = 'addColumn';\n  static readonly EVENT_MOVE_COLUMN = 'moveColumn';\n  static readonly EVENT_REMOVE_COLUMN = 'removeColumn';\n\n  protected readonly _children: Column[] = [];\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        CompositeColumn.EVENT_FILTER_CHANGED,\n        CompositeColumn.EVENT_ADD_COLUMN,\n        CompositeColumn.EVENT_MOVE_COLUMN,\n        CompositeColumn.EVENT_REMOVE_COLUMN,\n      ]);\n  }\n\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  assignNewId(idGenerator: () => string) {\n    super.assignNewId(idGenerator);\n    this._children.forEach((c) => c.assignNewId(idGenerator));\n  }\n\n  get children() {\n    return this._children.slice();\n  }\n\n  get length() {\n    return this._children.length;\n  }\n\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\n    let w = 0;\n    //no more levels or just this one\n    if (levelsToGo === 0 || levelsToGo <= Column.FLAT_ALL_COLUMNS) {\n      w = this.getWidth();\n      r.push({ col: this, offset, width: w });\n      if (levelsToGo === 0) {\n        return w;\n      }\n    }\n    //push children\n    this._children.forEach((c) => {\n      if (c.isVisible() && levelsToGo <= Column.FLAT_ALL_COLUMNS) {\n        c.flatten(r, offset, levelsToGo - 1, padding);\n      }\n    });\n    return w;\n  }\n\n  dump(toDescRef: (desc: any) => any) {\n    const r = super.dump(toDescRef);\n    r.children = this._children.map((d) => d.dump(toDescRef));\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    dump.children.forEach((child: any) => {\n      const c = factory(child);\n      if (c) {\n        this.push(c);\n      }\n    });\n    super.restore(dump, factory);\n  }\n\n  /**\n   * inserts a column at a the given position\n   * @param col\n   * @param index\n   * @returns {any}\n   */\n  insert(col: Column, index: number): Column | null {\n    if (!isNumberColumn(col) && this.canJustAddNumbers) {\n      //indicator it is a number type\n      return null;\n    }\n    this._children.splice(index, 0, col);\n    //listen and propagate events\n    return this.insertImpl(col, index);\n  }\n\n  move(col: Column, index: number): Column | null {\n    if (col.parent !== this) {\n      //not moving\n      return null;\n    }\n    const old = this._children.indexOf(col);\n    if (index === old) {\n      // no move needed\n      return col;\n    }\n    //delete first\n    this._children.splice(old, 1);\n    // adapt target index based on previous index, i.e shift by one\n    this._children.splice(old < index ? index - 1 : index, 0, col);\n    //listen and propagate events\n    return this.moveImpl(col, index, old);\n  }\n\n  protected insertImpl(col: Column, index: number) {\n    col.attach(this);\n    this.forward(\n      col,\n      ...suffix(\n        '.combine',\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n        CompositeColumn.EVENT_FILTER_CHANGED,\n        Column.EVENT_RENDERER_TYPE_CHANGED,\n        Column.EVENT_GROUP_RENDERER_TYPE_CHANGED\n      )\n    );\n    this.fire(\n      [\n        CompositeColumn.EVENT_ADD_COLUMN,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      col,\n      index\n    );\n    return col;\n  }\n\n  protected moveImpl(col: Column, index: number, oldIndex: number) {\n    this.fire(\n      [\n        CompositeColumn.EVENT_MOVE_COLUMN,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n        Column.EVENT_RENDERER_TYPE_CHANGED,\n        Column.EVENT_GROUP_RENDERER_TYPE_CHANGED,\n      ],\n      col,\n      index,\n      oldIndex\n    );\n    return col;\n  }\n\n  push(col: Column) {\n    return this.insert(col, this._children.length);\n  }\n\n  at(index: number) {\n    return this._children[index];\n  }\n\n  indexOf(col: Column) {\n    return this._children.indexOf(col);\n  }\n\n  insertAfter(col: Column, ref: Column) {\n    const i = this.indexOf(ref);\n    if (i < 0) {\n      return null;\n    }\n    return this.insert(col, i + 1);\n  }\n\n  moveAfter(col: Column, ref: Column) {\n    const i = this.indexOf(ref);\n    if (i < 0) {\n      return null;\n    }\n    return this.move(col, i + 1);\n  }\n\n  insertBefore(col: Column, ref: Column) {\n    const i = this.indexOf(ref);\n    if (i < 0) {\n      return null;\n    }\n    return this.insert(col, i);\n  }\n\n  moveBefore(col: Column, ref: Column) {\n    const i = this.indexOf(ref);\n    if (i < 0) {\n      return null;\n    }\n    return this.move(col, i);\n  }\n\n  remove(col: Column) {\n    const i = this._children.indexOf(col);\n    if (i < 0) {\n      return false;\n    }\n    this._children.splice(i, 1); //remove and deregister listeners\n    return this.removeImpl(col, i);\n  }\n\n  protected removeImpl(col: Column, index: number) {\n    col.detach();\n    this.unforward(\n      col,\n      ...suffix(\n        '.combine',\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n        CompositeColumn.EVENT_FILTER_CHANGED\n      )\n    );\n    this.fire(\n      [\n        CompositeColumn.EVENT_REMOVE_COLUMN,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      col,\n      index\n    );\n    return true;\n  }\n\n  isFiltered() {\n    return this._children.some((d) => d.isFiltered());\n  }\n\n  clearFilter() {\n    return this._children.map((d) => d.clearFilter()).some((d) => d);\n  }\n\n  filter(row: IDataRow) {\n    return this._children.every((d) => d.filter(row));\n  }\n\n  isLoaded(): boolean {\n    return this._children.every(\n      (c) =>\n        !(c instanceof ValueColumn || c instanceof CompositeColumn) ||\n        (c as ValueColumn<any> | CompositeColumn).isLoaded()\n    );\n  }\n\n  get canJustAddNumbers() {\n    return false;\n  }\n}\n","export default function(specifier) {\n  var n = specifier.length / 6 | 0, colors = new Array(n), i = 0;\n  while (i < n) colors[i] = \"#\" + specifier.slice(i * 6, ++i * 6);\n  return colors;\n}\n","import colors from \"../colors.js\";\n\nexport default colors(\"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f\");\n","/**\n * a set that preserves the insertion order\n * @internal\n */\nexport default class OrderedSet<T> implements Iterable<T> {\n  readonly [Symbol.toStringTag] = Symbol('OrderedSet');\n  private readonly set = new Set<T>();\n  private readonly list: T[] = [];\n\n  constructor(values: Iterable<T> = []) {\n    this.addAll(Array.isArray(values) ? values : Array.from(values));\n  }\n\n  get size() {\n    return this.set.size;\n  }\n\n  clear() {\n    this.set.clear();\n    this.list.splice(0, this.list.length);\n  }\n\n  addAll(values: T[]) {\n    values.forEach((v) => this.add(v));\n    return this;\n  }\n\n  add(value: T) {\n    if (this.set.has(value)) {\n      return this;\n    }\n    this.set.add(value);\n    this.list.push(value);\n    return this;\n  }\n\n  has(value: T) {\n    return this.set.has(value);\n  }\n\n  delete(value: T) {\n    const r = this.set.delete(value);\n    if (!r) {\n      return false;\n    }\n    const index = this.list.indexOf(value);\n    console.assert(index >= 0);\n    this.list.splice(index, 1);\n    return true;\n  }\n\n  deleteAll(values: T[]) {\n    return values.reduce((acc, act) => this.delete(act) && acc, true);\n  }\n\n  forEach(callbackfn: (value: T, value2: T, set: Set<T>) => void, thisArg?: any) {\n    this.list.forEach(function (this: any, v: T) {\n      callbackfn.call(this, v, v, this);\n    }, thisArg);\n  }\n\n  [Symbol.iterator]() {\n    return this.list[Symbol.iterator]();\n  }\n}\n","import { schemeCategory10, schemeSet3 } from 'd3-scale-chromatic';\nimport { OrderedSet } from '../internal';\nimport Column, { DEFAULT_COLOR } from './Column';\nimport { defaultGroup, ECompareValueType, IGroup, IGroupParent, IndicesArray, IOrderedGroup } from './interfaces';\n\n/** @internal */\nexport function integrateDefaults<T>(desc: T, defaults: Partial<T> = {}) {\n  Object.keys(defaults).forEach((key) => {\n    const typed = key as keyof T;\n    if (typeof desc[typed] === 'undefined') {\n      (desc as any)[typed] = defaults[typed];\n    }\n  });\n  return desc;\n}\n\n/** @internal */\nexport function patternFunction(pattern: string, ...args: string[]): (value: string) => string {\n  // eslint-disable-next-line no-new-func\n  return new Function(\n    'value',\n    ...args,\n    `\n  const escapedValue = encodeURIComponent(String(value));\n  return \\`${pattern}\\`;\n `\n  ) as any;\n}\n\n/** @internal */\nexport function joinGroups(groups: IGroup[]): IGroup {\n  if (groups.length === 0) {\n    return { ...defaultGroup }; //copy\n  }\n  if (groups.length === 1 && !groups[0].parent) {\n    return { ...groups[0] }; //copy\n  }\n  // create a chain\n  const parents: IGroupParent[] = [];\n  for (const group of groups) {\n    const gparents: IGroupParent[] = [];\n    let g = group;\n    while (g.parent) {\n      // add all parents of this groups\n      gparents.unshift(g.parent);\n      g = g.parent;\n    }\n    parents.push(...gparents);\n    parents.push(Object.assign({ subGroups: [] }, group));\n  }\n  parents.slice(1).forEach((g, i) => {\n    g.parent = parents[i];\n    g.name = `${parents[i].name} ∩ ${g.name}`;\n    g.color = g.color !== DEFAULT_COLOR ? g.color : g.parent.color;\n    parents[i].subGroups = [g];\n  });\n\n  return parents[parents.length - 1];\n}\n\nexport function duplicateGroup<T extends IOrderedGroup | IGroupParent>(group: T) {\n  const clone = Object.assign({}, group) as T;\n  delete (clone as IOrderedGroup).order;\n  if (isGroupParent(clone)) {\n    clone.subGroups = [];\n  }\n  if (clone.parent) {\n    clone.parent = duplicateGroup(clone.parent);\n    clone.parent!.subGroups.push(clone);\n  }\n  return clone;\n}\n\n/** @internal */\nexport function toGroupID(group: IGroup) {\n  return group.name;\n}\n\n/** @internal */\nexport function isOrderedGroup(g: IOrderedGroup | Readonly<IGroupParent>): g is IOrderedGroup {\n  return (g as IOrderedGroup).order != null;\n}\n\n/** @internal */\nfunction isGroupParent(g: IGroup | Readonly<IGroupParent>): g is IGroupParent {\n  return (g as IGroupParent).subGroups != null;\n}\n\n/**\n * unify the parents of the given groups by reusing the same group parent if possible\n * @param groups\n */\nexport function unifyParents<T extends IOrderedGroup>(groups: T[]) {\n  if (groups.length <= 1) {\n    return groups;\n  }\n\n  const toPath = (group: T) => {\n    const path: (IGroupParent | T)[] = [group];\n    let p = group.parent;\n    while (p) {\n      path.unshift(p);\n      p = p.parent;\n    }\n    return path;\n  };\n  const paths = groups.map(toPath);\n\n  const isSame = (a: IGroupParent, b: IGroupParent | T) => {\n    return b.name === a.name && b.parent === a.parent && isGroupParent(b) && b.subGroups.length > 0;\n  };\n\n  const removeDuplicates = (level: (IGroupParent | T)[], i: number) => {\n    const real: (IGroupParent | T)[] = [];\n    while (level.length > 0) {\n      const node = level.shift()!;\n      if (!isGroupParent(node) || node.subGroups.length === 0) {\n        // cannot share leaves\n        real.push(node);\n        continue;\n      }\n      const root = { ...node };\n      real.push(root);\n      // remove duplicates that directly follow\n      while (level.length > 0 && isSame(root, level[0]!)) {\n        root.subGroups.push(...(level.shift()! as IGroupParent).subGroups);\n      }\n      for (const child of root.subGroups) {\n        (child as IGroupParent | T).parent = root;\n      }\n      // cleanup children duplicates\n      root.subGroups = removeDuplicates(root.subGroups as (IGroupParent | T)[], i + 1);\n    }\n    return real;\n  };\n\n  removeDuplicates(\n    paths.map((p) => p[0]),\n    0\n  );\n\n  return groups;\n}\n\n/** @internal */\nexport function groupRoots(groups: IOrderedGroup[]) {\n  const roots = new OrderedSet<IOrderedGroup | Readonly<IGroupParent>>();\n  for (const group of groups) {\n    let root: IOrderedGroup | Readonly<IGroupParent> = group;\n    while (root.parent) {\n      root = root.parent;\n    }\n    roots.add(root);\n  }\n  return Array.from(roots);\n}\n\n/**\n * Traverse the tree of given groups in depth first search (DFS)\n *\n * @param groups Groups to traverse\n * @param f Function to check each group. Traversing subgroups can be stopped when returning `false`.\n *\n * @internal\n */\nexport function traverseGroupsDFS(groups: IOrderedGroup[], f: (v: IGroup | IGroupParent) => boolean | void) {\n  const traverse = (v: IGroup | IGroupParent) => {\n    if (f(v) === false) {\n      return;\n    }\n    if (isGroupParent(v)) {\n      v.subGroups.forEach(traverse);\n    }\n  };\n  const roots = groupRoots(groups);\n  roots.forEach(traverse);\n}\n\n// based on https://github.com/d3/d3-scale-chromatic#d3-scale-chromatic\nconst colors = schemeCategory10.concat(schemeSet3);\n\n/** @internal */\nexport const MAX_COLORS = colors.length;\n\n/** @internal */\nexport function colorPool() {\n  let act = 0;\n  return () => colors[act++ % colors.length];\n}\n\n/**\n * @internal\n */\nexport function mapIndices<T>(arr: IndicesArray, callback: (value: number, i: number) => T): T[] {\n  const r: T[] = [];\n  for (let i = 0; i < arr.length; ++i) {\n    r.push(callback(arr[i], i));\n  }\n  return r;\n}\n\n/**\n * @internal\n */\nexport function everyIndices(arr: IndicesArray, callback: (value: number, i: number) => boolean): boolean {\n  for (let i = 0; i < arr.length; ++i) {\n    if (!callback(arr[i], i)) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * @internal\n */\nexport function filterIndices(arr: IndicesArray, callback: (value: number, i: number) => boolean): number[] {\n  const r: number[] = [];\n  for (let i = 0; i < arr.length; ++i) {\n    if (callback(arr[i], i)) {\n      r.push(arr[i]);\n    }\n  }\n  return r;\n}\n\n/**\n * @internal\n */\nexport function forEachIndices(arr: IndicesArray, callback: (value: number, i: number) => void) {\n  for (let i = 0; i < arr.length; ++i) {\n    callback(arr[i], i);\n  }\n}\n\n/**\n * @internal\n */\nexport function chooseUIntByDataLength(dataLength?: number | null) {\n  if (dataLength == null || (typeof dataLength !== 'number' && !Number.isNaN(dataLength))) {\n    return ECompareValueType.UINT32; // worst case\n  }\n  if (dataLength <= 255) {\n    return ECompareValueType.UINT8;\n  }\n  if (dataLength <= 65535) {\n    return ECompareValueType.UINT16;\n  }\n  return ECompareValueType.UINT32;\n}\n\nexport function getAllToolbarActions(col: Column) {\n  const actions = new OrderedSet<string>();\n\n  // walk up the prototype chain\n  let obj = col as any;\n  const toolbarIcon = Symbol.for('toolbarIcon');\n  do {\n    const m = Reflect.getOwnMetadata(toolbarIcon, obj.constructor) as string[];\n    if (m) {\n      for (const mi of m) {\n        actions.add(mi);\n      }\n    }\n    obj = Object.getPrototypeOf(obj);\n  } while (obj);\n  return Array.from(actions);\n}\n\nexport function getAllToolbarDialogAddons(col: Column, key: string) {\n  const actions = new OrderedSet<string>();\n\n  // walk up the prototype chain\n  let obj = col as any;\n  const symbol = Symbol.for(`toolbarDialogAddon${key}`);\n  do {\n    const m = Reflect.getOwnMetadata(symbol, obj.constructor) as string[];\n    if (m) {\n      for (const mi of m) {\n        actions.add(mi);\n      }\n    }\n    obj = Object.getPrototypeOf(obj);\n  } while (obj);\n  return Array.from(actions);\n}\n","const styles = new Map<string, string>();\n// {\n//   const r = /^[$]([\\w]+): ([\\w #.()'\\/,-]+)( !default)?;/gmi;\n//   const s = String(vars);\n\n//   let m: RegExpMatchArray | null = r.exec(s);\n//   while (m != null) {\n//     styles.set(m[1], m[2]);\n//     m = r.exec(s);\n//   }\n// }\n\n/** @internal */\nexport default function getStyle(key: string, defaultValue = '') {\n  if (key[0] === '$') {\n    key = key.slice(1);\n  }\n  if (styles.has(key)) {\n    return styles.get(key)!;\n  }\n  return defaultValue;\n}\n/** @internal */\nexport const SELECTED_COLOR = getStyle('lu_selected_color', '#ffa500');\n/** @internal */\nexport const COLUMN_PADDING = Number.parseInt(getStyle('lu_engine_grip_gap', '5px'), 10);\n/** @internal */\nexport const FILTERED_OPACITY = Number.parseFloat(getStyle('lu_filtered_opacity', '0.2'));\n/** @internal */\nexport const DASH = {\n  width: Number.parseInt(getStyle('lu_missing_dash_width', '2px'), 10),\n  height: Number.parseInt(getStyle('lu_missing_dash_height', '10px'), 10),\n  color: getStyle('lu_missing_dash_color', '#dbdbdb'),\n};\n/** @internal */\nexport const UPSET = {\n  color: getStyle('lu_renderer_upset_color'),\n  inactive: Number.parseFloat(getStyle('lu_renderer_upset_inactive_opacity', '0.1')),\n};\n/** @internal */\nexport const DOT = {\n  color: getStyle('lu_renderer_dot_color', 'gray'),\n  size: Number.parseInt(getStyle('lu_renderer_dot_size', '5px'), 10),\n  opacity: Number.parseFloat(getStyle('lu_renderer_dot_opacity', '0.5')),\n  opacitySingle: Number.parseFloat(getStyle('lu_renderer_dot_opacity', '1')),\n};\n/** @internal */\nexport const TICK = {\n  color: getStyle('lu_renderer_tick_color', 'gray'),\n  size: Number.parseInt(getStyle('lu_renderer_tick_size', '3px'), 10),\n  opacity: Number.parseFloat(getStyle('lu_renderer_tick_opacity', '1')),\n};\n/** @internal */\nexport const BOX_PLOT = {\n  box: getStyle('lu_renderer_boxplot_box', '#e0e0e0'),\n  stroke: getStyle('lu_renderer_boxplot_stroke', 'black'),\n  sort: getStyle('lu_renderer_boxplot_sort_indicator', '#ffa500'),\n  outlier: getStyle('lu_renderer_boxplot_outlier', '#e0e0e0'),\n};\n/** @internal */\nexport const AGGREGATE = {\n  width: Number.parseInt(getStyle('lu_aggregate_square_bracket_width', '4px'), 10),\n  strokeWidth: Number.parseInt(getStyle('lu_aggregate_square_bracket_stroke_width', '2px'), 10),\n  color: getStyle('lu_aggregate_square_bracket_stroke_color', '#000'),\n  levelOffset: Number.parseInt(getStyle('lu_aggregate_level_offset', '2px'), 10),\n  levelWidth: Number.parseInt(getStyle('lu_aggregate_level_width', '22px'), 10),\n};\n/** @internal */\nexport const SLOPEGRAPH_WIDTH = Number.parseInt(getStyle('lu_slope_width', '200px'), 10);\n/** @internal */\nexport const CANVAS_HEIGHT = 4;\n\n/** @internal */\nexport const CSS_PREFIX = getStyle('lu_css_prefix', 'lu');\n/** @internal */\nexport const ENGINE_CSS_PREFIX = 'le';\n\n/** @internal */\nexport const RESIZE_SPACE = Number.parseInt(getStyle('lu_engine_resize_space', '50px'), 10);\n/** @internal */\nexport const RESIZE_ANIMATION_DURATION = Number.parseInt(getStyle('lu_engine_resize_animation_duration', '1000ms'), 10);\n\n/** @internal */\nexport const AGGREGATION_LEVEL_WIDTH = Number.parseInt(getStyle('lu_aggregate_level_width', '22px'), 10);\n\n/** @internal */\nexport function cssClass(suffix?: string) {\n  return suffix ? `${CSS_PREFIX}-${suffix}` : CSS_PREFIX;\n}\n/** @internal */\nexport function engineCssClass(suffix?: string) {\n  return suffix ? `${ENGINE_CSS_PREFIX}-${suffix}` : ENGINE_CSS_PREFIX;\n}\n\n/** @internal */\nexport function aria(text: string) {\n  return `<span class=\"${cssClass('aria')}\" aria-hidden=\"true\">${text}</span>`;\n}\n","import { Category, SupportType, toolbar } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type { IGroup, IColumnDesc } from './interfaces';\nimport type Ranking from './Ranking';\nimport type { IEventListener } from '../internal';\nimport { integrateDefaults } from './internal';\nimport { AGGREGATION_LEVEL_WIDTH } from '../styles';\n\nexport enum EAggregationState {\n  COLLAPSE = 'collapse',\n  EXPAND = 'expand',\n  EXPAND_TOP_N = 'expand_top',\n}\n\n/**\n * factory for creating a description creating a rank column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createAggregateDesc(label = 'Aggregate Groups') {\n  return { type: 'aggregate', label, fixed: true };\n}\n\nexport interface IAggregateGroupColumnDesc extends IColumnDesc {\n  isAggregated(ranking: Ranking, group: IGroup): EAggregationState;\n\n  setAggregated(ranking: Ranking, group: IGroup, value: EAggregationState): void;\n}\n\n/**\n * emitted upon changing of the aggregate attribute\n * @param value -1 = no, 0 = fully aggregated, N = show top N\n * @asMemberOf AggregateGroupColumn\n * @event\n */\nexport declare function aggregate(ranking: Ranking, group: IGroup, value: boolean, state: EAggregationState): void;\n\n/**\n * a checkbox column for selections\n */\n@toolbar('setShowTopN', 'rename')\n@SupportType()\n@Category('support')\nexport default class AggregateGroupColumn extends Column {\n  static readonly EVENT_AGGREGATE = 'aggregate';\n\n  constructor(id: string, desc: Readonly<IAggregateGroupColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: AGGREGATION_LEVEL_WIDTH * 2,\n      })\n    );\n  }\n\n  get frozen() {\n    return this.desc.frozen !== false;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([AggregateGroupColumn.EVENT_AGGREGATE]);\n  }\n\n  on(type: typeof AggregateGroupColumn.EVENT_AGGREGATE, listener: typeof aggregate | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  isAggregated(group: IGroup) {\n    const ranking = this.findMyRanker()!;\n    if ((this.desc as IAggregateGroupColumnDesc).isAggregated) {\n      return (this.desc as IAggregateGroupColumnDesc).isAggregated(ranking, group);\n    }\n    return false;\n  }\n\n  setAggregated(group: IGroup, value: boolean | EAggregationState) {\n    const n: EAggregationState =\n      typeof value === 'boolean' ? (value ? EAggregationState.EXPAND : EAggregationState.COLLAPSE) : value;\n    const ranking = this.findMyRanker()!;\n    const current =\n      (this.desc as IAggregateGroupColumnDesc).isAggregated &&\n      (this.desc as IAggregateGroupColumnDesc).isAggregated(ranking, group);\n    if (current === n) {\n      return true;\n    }\n\n    if ((this.desc as IAggregateGroupColumnDesc).setAggregated) {\n      (this.desc as IAggregateGroupColumnDesc).setAggregated(ranking, group, n);\n    }\n    this.fire(AggregateGroupColumn.EVENT_AGGREGATE, ranking, group, n !== EAggregationState.COLLAPSE, n);\n    return false;\n  }\n}\n","import type { ICategory, ICategoricalColorMappingFunction } from './ICategoricalColumn';\nimport type { ITypedDump } from './interfaces';\nimport { DEFAULT_COLOR } from './Column';\n\nexport const DEFAULT_CATEGORICAL_COLOR_FUNCTION: ICategoricalColorMappingFunction = {\n  apply: (v) => (v ? v.color : DEFAULT_COLOR),\n  toJSON: () => null,\n  clone: () => DEFAULT_CATEGORICAL_COLOR_FUNCTION,\n  eq: (other) => other === DEFAULT_CATEGORICAL_COLOR_FUNCTION,\n};\n\nexport class ReplacementColorMappingFunction implements ICategoricalColorMappingFunction {\n  public readonly map: ReadonlyMap<string, string>;\n  constructor(map: Map<ICategory | string, string>) {\n    this.map = new Map(\n      Array.from(map.entries()).map(([k, v]) => [typeof k === 'string' ? k : k.name, v] as [string, string])\n    );\n  }\n\n  apply(v: ICategory) {\n    return this.map.has(v.name) ? this.map.get(v.name)! : DEFAULT_CATEGORICAL_COLOR_FUNCTION.apply(v);\n  }\n\n  toJSON() {\n    const r: any = {};\n    this.map.forEach((v, k) => (r[k] = v));\n    return {\n      type: 'replace',\n      map: r,\n    };\n  }\n\n  clone() {\n    return new ReplacementColorMappingFunction(new Map(this.map.entries()));\n  }\n\n  eq(other: ICategoricalColorMappingFunction): boolean {\n    if (!(other instanceof ReplacementColorMappingFunction)) {\n      return false;\n    }\n    if (other.map.size !== this.map.size) {\n      return false;\n    }\n    return Array.from(this.map.keys()).every((k) => this.map.get(k) === other.map.get(k));\n  }\n\n  static restore(dump: any, categories: ICategory[]) {\n    if (dump.type === 'replace') {\n      // new dump format\n      dump = dump.map;\n    }\n    const lookup = new Map(categories.map((d) => [d.name, d]));\n    const r = new Map<ICategory, string>();\n    for (const key of Object.keys(dump)) {\n      if (lookup.has(key)) {\n        r.set(lookup.get(key)!, dump[key]);\n      }\n    }\n    return new ReplacementColorMappingFunction(r);\n  }\n}\n\n/**\n * @internal\n */\nexport function restoreCategoricalColorMapping(\n  dump: ITypedDump | null | undefined,\n  categories: ICategory[]\n): ICategoricalColorMappingFunction {\n  if (!dump) {\n    return DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n  return ReplacementColorMappingFunction.restore(dump, categories);\n}\n","import type { IGroup } from './interfaces';\n\nexport function isMissingValue(v: any): boolean {\n  if (\n    v == null ||\n    v === undefined ||\n    v === '' ||\n    v === 'NA' ||\n    v === 'na' ||\n    v === 'Na' ||\n    v === 'nA' ||\n    v === 'NaN' ||\n    (typeof v === 'number' && Number.isNaN(v))\n  ) {\n    return true;\n  }\n  if (!Array.isArray(v)) {\n    return false;\n  }\n  for (const vi of v) {\n    if (!isMissingValue(vi)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function isUnknown(v?: number | null) {\n  return v == null || v === undefined || Number.isNaN(v);\n}\n\nexport const FIRST_IS_NAN = -1;\nexport const FIRST_IS_MISSING = 1;\n\nexport const missingGroup: IGroup = {\n  name: 'Missing values',\n  color: 'gray',\n};\n","import { ISequence, isSeqEmpty, empty } from '../internal';\nimport { colorPool } from './internal';\nimport type {\n  ICategoricalColumn,\n  ICategoricalDesc,\n  ICategoricalFilter,\n  ICategoricalsColumn,\n  ICategory,\n  ISetCategoricalFilter,\n} from './ICategoricalColumn';\nimport { DEFAULT_COLOR } from './Column';\nimport type { ICompareValue, IDataRow } from './interfaces';\nimport { FIRST_IS_MISSING } from './missing';\n\n/** @internal */\nexport function toCategory(\n  cat: string | Partial<ICategory>,\n  value: number,\n  nextColor: () => string = () => DEFAULT_COLOR\n) {\n  if (typeof cat === 'string') {\n    //just the category value\n    return { name: cat, label: cat, color: nextColor(), value };\n  }\n  const name = cat.name == null ? String(cat.value) : cat.name;\n  return {\n    name,\n    label: cat.label || name,\n    color: cat.color || nextColor(),\n    value: cat.value != null ? cat.value : value,\n  };\n}\n\n/** @internal */\nexport function toCompareCategoryValue(v: ICategory | null) {\n  if (v == null) {\n    return NaN;\n  }\n  return v.value;\n}\n\nfunction findMostFrequent(\n  rows: ISequence<ICategory | null>,\n  valueCache?: ISequence<ICategory | null>\n): { cat: ICategory | null; count: number } {\n  const hist = new Map<ICategory | null, number>();\n\n  if (valueCache) {\n    valueCache.forEach((cat) => {\n      hist.set(cat, (hist.get(cat) || 0) + 1);\n    });\n  } else {\n    rows.forEach((cat) => {\n      hist.set(cat, (hist.get(cat) || 0) + 1);\n    });\n  }\n\n  if (hist.size === 0) {\n    return {\n      cat: null,\n      count: 0,\n    };\n  }\n  let topCat: ICategory | null = null;\n  let topCount = 0;\n  hist.forEach((count, cat) => {\n    if (count > topCount) {\n      topCat = cat;\n      topCount = count;\n    }\n  });\n  return {\n    cat: topCat,\n    count: topCount,\n  };\n}\n\n/** @internal */\nexport function toMostFrequentCategoricals(rows: ISequence<IDataRow>, col: ICategoricalsColumn): (ICategory | null)[] {\n  if (isSeqEmpty(rows)) {\n    return empty(col.dataLength!);\n  }\n  const maps = empty(col.dataLength!).map(() => new Map<ICategory | null, number>());\n  rows.forEach((row) => {\n    const vs = col.getCategories(row);\n    if (!vs) {\n      return;\n    }\n    for (let i = 0; i < maps.length; ++i) {\n      const hist = maps[i];\n      const cat = vs[i] || null;\n      hist.set(cat, (hist.get(cat) || 0) + 1);\n    }\n  });\n\n  return maps.map((hist) => {\n    if (hist.size === 0) {\n      return null;\n    }\n    let topCat: ICategory | null = null;\n    let topCount = 0;\n    hist.forEach((count, cat) => {\n      if (count > topCount) {\n        topCat = cat;\n        topCount = count;\n      }\n    });\n    return topCat;\n  });\n}\n\n/** @internal */\nexport function toGroupCompareCategoryValue(\n  rows: ISequence<IDataRow>,\n  col: ICategoricalColumn,\n  valueCache?: ISequence<ICategory | null>\n): ICompareValue[] {\n  if (isSeqEmpty(rows)) {\n    return [NaN, null];\n  }\n  const mostFrequent = findMostFrequent(\n    rows.map((d) => col.getCategory(d)),\n    valueCache\n  );\n  if (mostFrequent.cat == null) {\n    return [NaN, null];\n  }\n  return [mostFrequent.cat.value, mostFrequent.cat.name.toLowerCase()];\n}\n\n/** @internal */\nexport function compareCategory(a: ICategory | null, b: ICategory | null) {\n  const aNull = a == null || Number.isNaN(a.value);\n  const bNull = b == null || Number.isNaN(b.value);\n  if (aNull || a == null) {\n    return bNull ? 0 : FIRST_IS_MISSING;\n  }\n  if (bNull || b == null) {\n    return -FIRST_IS_MISSING;\n  }\n  if (a.value === b.value) {\n    return a.label.toLowerCase().localeCompare(b.label.toLowerCase());\n  }\n  return a.value - b.value;\n}\n\nexport function toCategories(desc: Pick<ICategoricalDesc, 'categories'>) {\n  if (!desc.categories) {\n    return [];\n  }\n  const nextColor = colorPool();\n  const l = desc.categories.length - 1;\n  const cats = desc.categories.map((cat, i) => toCategory(cat, i / l, nextColor));\n  return cats.sort(compareCategory);\n}\n\n/** @internal */\nfunction isEmptyFilter(f: ICategoricalFilter | null) {\n  return f == null || (!f.filterMissing && (f.filter == null || f.filter === ''));\n}\n\n/** @internal */\nexport function isEqualCategoricalFilter(a: ICategoricalFilter | null, b: ICategoricalFilter | null) {\n  if (a === b) {\n    return true;\n  }\n  if (a == null || b == null) {\n    return isEmptyFilter(a) === isEmptyFilter(b);\n  }\n  if (\n    a.filterMissing !== b.filterMissing ||\n    typeof a.filter !== typeof b.filter ||\n    Array.isArray(a.filter) !== Array.isArray(b.filter)\n  ) {\n    return false;\n  }\n  if (Array.isArray(a.filter)) {\n    return arrayEquals(a.filter, b.filter as string[]);\n  }\n  return String(a.filter) === String(b.filter);\n}\n\n/** @internal */\nexport function isEqualSetCategoricalFilter(a: ISetCategoricalFilter | null, b: ISetCategoricalFilter | null) {\n  if (!isEqualCategoricalFilter(a, b)) {\n    return false;\n  }\n  const am = a && a.mode ? a.mode : 'every';\n  const bm = b && b.mode ? b.mode : 'every';\n  return am === bm;\n}\n\nfunction arrayEquals<T>(a: T[], b: T[]) {\n  const al = a != null ? a.length : 0;\n  const bl = b != null ? b.length : 0;\n  if (al !== bl) {\n    return false;\n  }\n  if (al === 0) {\n    return true;\n  }\n  return a.every((ai, i) => ai === b[i]);\n}\n\n/** @internal */\nexport function isCategoryIncluded(filter: ICategoricalFilter | null, category: ICategory | null) {\n  if (filter == null) {\n    return true;\n  }\n  if (category == null || Number.isNaN(category.value)) {\n    return !filter.filterMissing;\n  }\n  const filterObj = filter.filter;\n  if (Array.isArray(filterObj)) {\n    //array mode\n    return filterObj.includes(category.name);\n  }\n  if (typeof filterObj === 'string' && filterObj.length > 0) {\n    //search mode\n    return category.name.toLowerCase().includes(filterObj.toLowerCase());\n  }\n  if (filterObj instanceof RegExp) {\n    //regex match mode\n    return filterObj.test(category.name);\n  }\n  return true;\n}\n","import type { IEventListener, ISequence } from '../internal';\nimport { Category, toolbar } from './annotations';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  groupRendererChanged,\n  labelChanged,\n  metaDataChanged,\n  rendererTypeChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n  DEFAULT_COLOR,\n} from './Column';\nimport type {\n  ICategoricalColumn,\n  ICategoricalColumnDesc,\n  ICategoricalFilter,\n  ICategory,\n  ICategoricalColorMappingFunction,\n} from './ICategoricalColumn';\nimport { IDataRow, IGroup, ICompareValue, ITypeFactory, ECompareValueType } from './interfaces';\nimport { missingGroup } from './missing';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport {\n  toCategories,\n  isCategoryIncluded,\n  isEqualCategoricalFilter,\n  toCompareCategoryValue,\n  toGroupCompareCategoryValue,\n  compareCategory,\n} from './internalCategorical';\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf CategoricalColumn\n * @event\n */\nexport declare function colorMappingChanged_CC(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf CategoricalColumn\n * @event\n */\nexport declare function filterChanged_CC(previous: ICategoricalFilter | null, current: ICategoricalFilter | null): void;\n\n/**\n * column for categorical values\n */\n@toolbar(\n  'rename',\n  'clone',\n  'sort',\n  'sortBy',\n  'group',\n  'groupBy',\n  'sortGroupBy',\n  'filterCategorical',\n  'colorMappedCategorical'\n)\n@Category('categorical')\nexport default class CategoricalColumn extends ValueColumn<string> implements ICategoricalColumn {\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\n  static readonly EVENT_COLOR_MAPPING_CHANGED = 'colorMappingChanged';\n\n  readonly categories: ICategory[];\n\n  private colorMapping: ICategoricalColorMappingFunction;\n\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\n  /**\n   * set of categories to show\n   * @type {null}\n   * @private\n   */\n  private currentFilter: ICategoricalFilter | null = null;\n  private readonly categoryOrder: ICategoricalColumnDesc['categoryOrder'];\n\n  constructor(id: string, desc: Readonly<ICategoricalColumnDesc>) {\n    super(id, desc);\n    this.categories = toCategories(desc);\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\n    this.categoryOrder = desc.categoryOrder || 'given';\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n\n  onDataUpdate(rows: ISequence<IDataRow>): void {\n    super.onDataUpdate(rows);\n    if (Array.isArray((this.desc as ICategoricalColumnDesc).categories) && this.categoryOrder === 'given') {\n      return;\n    }\n    // derive hist\n    const categories = new Map<string, { name: string; count: number }>();\n    rows.forEach((row) => {\n      const value = super.getValue(row);\n      if (!value) {\n        return;\n      }\n      const sValue = String(value);\n      const entry = categories.get(sValue);\n      if (!entry) {\n        categories.set(sValue, { name: sValue, count: 1 });\n      } else {\n        entry.count++;\n      }\n    });\n\n    if (!Array.isArray((this.desc as ICategoricalColumnDesc).categories)) {\n      // derive\n      const categoryNames = Array.from(categories.keys());\n      categoryNames.sort();\n      this.categories.splice(0, this.categories.length, ...toCategories({ categories: categoryNames }));\n      this.categories.forEach((d) => this.lookup.set(d.name, d));\n    }\n    this.sortCategories(categories);\n  }\n\n  private sortCategories(hist: ReadonlyMap<string, { name: string; count: number }>) {\n    // patch values of categories\n    for (const cat of this.categories) {\n      cat.value = hist.get(cat.name)?.count ?? 0;\n    }\n    // sort\n    if (typeof this.categoryOrder === 'function') {\n      this.categories.splice(0, this.categories.length, ...this.categoryOrder(this.categories));\n    } else if (this.categoryOrder === 'large-to-small') {\n      // revert order of value\n      for (const cat of this.categories) {\n        cat.value = -1 * cat.value;\n      }\n      this.categories.sort(compareCategory);\n    } else if (this.categoryOrder === 'small-to-large') {\n      this.categories.sort(compareCategory);\n    }\n    // patch the ICategory.value to match the new order\n    this.categories.forEach((cat, i) => {\n      cat.value = i / this.categories.length;\n    });\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([CategoricalColumn.EVENT_FILTER_CHANGED, CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED]);\n  }\n\n  on(type: typeof CategoricalColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_CC | null): this;\n  on(type: typeof CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_CC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow) {\n    const v = this.getCategory(row);\n    return v ? v.name : null;\n  }\n\n  getCategory(row: IDataRow) {\n    const v = super.getValue(row);\n    if (!v) {\n      return null;\n    }\n    const vs = String(v);\n    return this.lookup.has(vs) ? this.lookup.get(vs)! : null;\n  }\n\n  get dataLength() {\n    return this.categories.length;\n  }\n\n  get labels() {\n    return this.categories.map((d) => d.label);\n  }\n\n  getLabel(row: IDataRow) {\n    const v = this.getCategory(row);\n    return v ? v.label : '';\n  }\n\n  getCategories(row: IDataRow) {\n    const v = this.getCategory(row);\n    return [v];\n  }\n\n  getValues(row: IDataRow) {\n    const v = this.getCategory(row);\n    return this.categories.map((d) => d === v);\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getValues(row).map(String);\n  }\n\n  getMap(row: IDataRow) {\n    const cats = this.categories;\n    return this.getValues(row).map((value, i) => ({ key: cats[i].label, value }));\n  }\n\n  getMapLabel(row: IDataRow) {\n    const cats = this.categories;\n    return this.getLabels(row).map((value, i) => ({ key: cats[i].label, value }));\n  }\n\n  getSet(row: IDataRow) {\n    const cat = this.getCategory(row);\n    const r = new Set<ICategory>();\n    if (cat) {\n      r.add(cat);\n    }\n    return r;\n  }\n\n  iterCategory(row: IDataRow) {\n    return [this.getCategory(row)];\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.filter = this.currentFilter;\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\n\n    if (typeof dump.filter === 'undefined') {\n      this.currentFilter = null;\n      return;\n    }\n    const bak = dump.filter;\n    if (typeof bak === 'string' || Array.isArray(bak)) {\n      this.currentFilter = { filter: bak, filterMissing: false };\n    } else {\n      this.currentFilter = bak;\n    }\n  }\n\n  getColor(row: IDataRow) {\n    const v = this.getCategory(row);\n    return v ? this.colorMapping.apply(v) : DEFAULT_COLOR;\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY,\n      ],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  isFiltered() {\n    return this.currentFilter != null;\n  }\n\n  filter(row: IDataRow, valueCache?: any): boolean {\n    return isCategoryIncluded(this.currentFilter, valueCache !== undefined ? valueCache : this.getCategory(row));\n  }\n\n  getFilter() {\n    return this.currentFilter == null ? null : Object.assign({}, this.currentFilter);\n  }\n\n  setFilter(filter: ICategoricalFilter | null) {\n    if (isEqualCategoricalFilter(this.currentFilter, filter)) {\n      return;\n    }\n    this.fire(\n      [CategoricalColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.currentFilter,\n      (this.currentFilter = filter)\n    );\n  }\n\n  clearFilter() {\n    const was = this.isFiltered();\n    this.setFilter(null);\n    return was;\n  }\n\n  toCompareValue(row: IDataRow, valueCache?: any) {\n    return toCompareCategoryValue(valueCache !== undefined ? valueCache : this.getCategory(row));\n  }\n\n  toCompareValueType(): ECompareValueType {\n    return ECompareValueType.FLOAT_ASC;\n  }\n\n  group(row: IDataRow, valueCache?: any): IGroup {\n    const cat = valueCache !== undefined ? valueCache : this.getCategory(row);\n    if (!cat) {\n      return Object.assign({}, missingGroup);\n    }\n    return { name: cat.label, color: cat.color };\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, _group: IGroup, valueCache?: ISequence<any>): ICompareValue[] {\n    return toGroupCompareCategoryValue(rows, this, valueCache);\n  }\n\n  toCompareGroupValueType() {\n    return [ECompareValueType.FLOAT, ECompareValueType.STRING];\n  }\n\n  getGroupRenderer() {\n    const current = super.getGroupRenderer();\n    if (current === this.desc.type && this.isGroupedBy() >= 0) {\n      // still the default and the stratification criteria\n      return 'catdistributionbar';\n    }\n    return current;\n  }\n}\n","import { Category, toolbar } from './annotations';\nimport CategoricalColumn from './CategoricalColumn';\nimport Column, {\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  widthChanged,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n  DEFAULT_COLOR,\n} from './Column';\nimport type { IArrayColumn } from './IArrayColumn';\nimport type {\n  ICategoricalDesc,\n  ISetCategoricalFilter,\n  ICategory,\n  ISetColumn,\n  ICategoricalColorMappingFunction,\n} from './ICategoricalColumn';\nimport { IDataRow, ECompareValueType, IValueColumnDesc, IGroup, ITypeFactory } from './interfaces';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport type { IEventListener } from '../internal';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\nimport { toCategories, isCategoryIncluded, isEqualSetCategoricalFilter } from './internalCategorical';\nimport { chooseUIntByDataLength, integrateDefaults } from './internal';\n\nexport interface ISetDesc extends ICategoricalDesc {\n  separator?: string;\n}\n\nexport declare type ISetColumnDesc = ISetDesc & IValueColumnDesc<string[]>;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf SetColumn\n * @event\n */\nexport declare function colorMappingChanged_SSC(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf SetColumn\n * @event\n */\nexport declare function filterChanged_SSC(\n  previous: ISetCategoricalFilter | null,\n  current: ISetCategoricalFilter | null\n): void;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterCategorical', 'colorMappedCategorical', 'group', 'groupBy')\n@Category('categorical')\nexport default class SetColumn extends ValueColumn<string[]> implements IArrayColumn<boolean>, ISetColumn {\n  static readonly EVENT_FILTER_CHANGED = CategoricalColumn.EVENT_FILTER_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  readonly categories: ICategory[];\n\n  private readonly separator: RegExp;\n\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\n\n  private colorMapping: ICategoricalColorMappingFunction;\n  /**\n   * set of categories to show\n   * @type {null}\n   * @private\n   */\n  private currentFilter: ISetCategoricalFilter | null = null;\n\n  constructor(id: string, desc: Readonly<ISetColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'upset',\n        groupRenderer: 'upset',\n        summaryRenderer: 'categorical',\n      })\n    );\n    this.separator = new RegExp(desc.separator || ';');\n    this.categories = toCategories(desc);\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([SetColumn.EVENT_COLOR_MAPPING_CHANGED, SetColumn.EVENT_FILTER_CHANGED]);\n  }\n\n  on(type: typeof SetColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_SSC | null): this;\n  on(type: typeof SetColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_SSC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  get labels() {\n    return this.categories.map((d) => d.label);\n  }\n\n  get dataLength() {\n    return this.categories.length;\n  }\n\n  getValue(row: IDataRow): string[] | null {\n    const v = this.getSortedSet(row);\n    if (v.length === 0) {\n      return null;\n    }\n    return v.map((d) => d.name);\n  }\n\n  getLabel(row: IDataRow) {\n    return `(${this.getSortedSet(row)\n      .map((d) => d.label)\n      .join(',')})`;\n  }\n\n  private normalize(v: any) {\n    if (typeof v === 'string') {\n      return v.split(this.separator).map((s) => s.trim());\n    }\n    if (Array.isArray(v)) {\n      return v.map((v) => String(v).trim());\n    }\n    if (v instanceof Set) {\n      return Array.from(v).map(String);\n    }\n    return [];\n  }\n\n  getSet(row: IDataRow) {\n    const sv = this.normalize(super.getValue(row));\n    const r = new Set<ICategory>();\n    sv.forEach((n) => {\n      const cat = this.lookup.get(n);\n      if (cat) {\n        r.add(cat);\n      }\n    });\n    return r;\n  }\n\n  getSortedSet(row: IDataRow) {\n    return Array.from(this.getSet(row)).sort((a, b) =>\n      a.value === b.value ? a.label.localeCompare(b.label) : a.value - b.value\n    );\n  }\n\n  getCategories(row: IDataRow) {\n    return this.getSortedSet(row);\n  }\n\n  getColors(row: IDataRow) {\n    return this.getSortedSet(row).map((d) => this.colorMapping.apply(d));\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    return CategoricalColumn.prototype.setColorMapping.call(this, mapping);\n  }\n\n  getValues(row: IDataRow) {\n    const s = this.getSet(row);\n    return this.categories.map((d) => s.has(d));\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getValues(row).map(String);\n  }\n\n  getMap(row: IDataRow) {\n    return this.getSortedSet(row).map((d) => ({ key: d.label, value: true }));\n  }\n\n  getMapLabel(row: IDataRow) {\n    return this.getSortedSet(row).map((d) => ({ key: d.label, value: 'true' }));\n  }\n\n  iterCategory(row: IDataRow) {\n    const r = this.getSet(row);\n    if (r.size > 0) {\n      return Array.from(r);\n    }\n    return [null];\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.filter = this.currentFilter;\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\n    if (!('filter' in dump)) {\n      this.currentFilter = null;\n      return;\n    }\n    const bak = dump.filter;\n    if (typeof bak === 'string' || Array.isArray(bak)) {\n      this.currentFilter = { filter: bak, filterMissing: false, mode: 'some' };\n    } else {\n      this.currentFilter = bak;\n    }\n  }\n\n  isFiltered() {\n    return this.currentFilter != null;\n  }\n\n  filter(row: IDataRow): boolean {\n    if (!this.currentFilter) {\n      return true;\n    }\n    const v = Array.from(this.getSet(row));\n    if (v.length === 0) {\n      return isCategoryIncluded(this.currentFilter, null);\n    }\n    if (this.currentFilter.mode === 'every') {\n      return v.every((s) => isCategoryIncluded(this.currentFilter, s));\n    }\n    return v.some((s) => isCategoryIncluded(this.currentFilter, s));\n  }\n\n  getFilter(): ISetCategoricalFilter | null {\n    return this.currentFilter == null ? null : Object.assign({}, this.currentFilter);\n  }\n\n  setFilter(filter: ISetCategoricalFilter | null) {\n    if (isEqualSetCategoricalFilter(this.currentFilter, filter)) {\n      return;\n    }\n    this.fire(\n      [CategoricalColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.currentFilter,\n      (this.currentFilter = filter)\n    );\n  }\n\n  clearFilter() {\n    return CategoricalColumn.prototype.clearFilter.call(this);\n  }\n\n  toCompareValue(row: IDataRow) {\n    const v = this.getSet(row);\n\n    const vs = [v.size];\n    for (const cat of this.categories) {\n      vs.push(v.has(cat) ? 1 : 0);\n    }\n    return vs;\n  }\n\n  toCompareValueType() {\n    return [chooseUIntByDataLength(this.categories.length)].concat(this.categories.map(() => ECompareValueType.BINARY));\n  }\n\n  group(row: IDataRow): IGroup {\n    const v = this.getSet(row);\n    const cardinality = v.size;\n    const categories = this.categories.filter((c) => v.has(c));\n\n    // by cardinality and then by intersection\n\n    const g: IGroup = {\n      name: categories.length === 0 ? 'None' : categories.map((d) => d.name).join(', '),\n      color: categories.length === 1 ? categories[0].color : DEFAULT_COLOR,\n    };\n\n    g.parent = {\n      name: `#${cardinality}`,\n      color: DEFAULT_COLOR,\n      subGroups: [g],\n    };\n\n    return g;\n  }\n}\n","import { equalArrays, fixCSS, IEventListener, suffix, joinIndexArrays, AEventDispatcher } from '../internal';\nimport { isSortingAscByDefault } from './annotations';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  labelChanged,\n  visibilityChanged,\n  widthChanged,\n} from './Column';\nimport CompositeColumn from './CompositeColumn';\nimport {\n  IRankingDump,\n  defaultGroup,\n  IndicesArray,\n  IOrderedGroup,\n  IDataRow,\n  IColumnParent,\n  IFlatColumn,\n  ISortCriteria,\n  UIntTypedArray,\n  IGroupParent,\n  ITypeFactory,\n  IGroup,\n} from './interfaces';\nimport { groupRoots, traverseGroupsDFS } from './internal';\nimport AggregateGroupColumn from './AggregateGroupColumn';\nimport SetColumn from './SetColumn';\nimport { AGGREGATION_LEVEL_WIDTH } from '../styles';\n\nexport enum EDirtyReason {\n  UNKNOWN = 'unknown',\n  FILTER_CHANGED = 'filter',\n  SORT_CRITERIA_CHANGED = 'sort_changed',\n  SORT_CRITERIA_DIRTY = 'sort_dirty',\n  GROUP_CRITERIA_CHANGED = 'group_changed',\n  GROUP_CRITERIA_DIRTY = 'group_dirty',\n  GROUP_SORT_CRITERIA_CHANGED = 'group_sort_changed',\n  GROUP_SORT_CRITERIA_DIRTY = 'group_sort_dirty',\n}\n\n/**\n * emitted when a column has been added\n * @asMemberOf Ranking\n * @event\n */\nexport declare function addColumn(col: Column, index: number): void;\n\n/**\n * emitted when a column has been moved within this composite column\n * @asMemberOf Ranking\n * @event\n */\nexport declare function moveColumn(col: Column, index: number, oldIndex: number): void;\n\n/**\n * emitted when a column has been removed\n * @asMemberOf Ranking\n * @event\n */\nexport declare function removeColumn(col: Column, index: number): void;\n/**\n * emitted when the sort criteria property changes\n * @asMemberOf Ranking\n * @event\n */\nexport declare function sortCriteriaChanged(previous: ISortCriteria[], current: ISortCriteria[]): void;\n/**\n * emitted when the sort criteria property changes\n * @asMemberOf Ranking\n * @event\n */\nexport declare function groupCriteriaChanged(previous: Column[], current: Column[]): void;\n/**\n * emitted when the sort criteria property changes\n * @asMemberOf Ranking\n * @event\n */\nexport declare function groupSortCriteriaChanged(previous: ISortCriteria[], current: ISortCriteria[]): void;\n/**\n * emitted when the sort criteria property changes\n * @asMemberOf Ranking\n * @event\n */\nexport declare function dirtyOrder(reason?: EDirtyReason[]): void;\n/**\n * @asMemberOf Ranking\n * @event\n */\nexport declare function orderChanged(\n  previous: number[],\n  current: number[],\n  previousGroups: IOrderedGroup[],\n  currentGroups: IOrderedGroup[],\n  dirtyReason: EDirtyReason[]\n): void;\n/**\n * @asMemberOf Ranking\n * @event\n */\nexport declare function groupsChanged(\n  previous: number[],\n  current: number[],\n  previousGroups: IOrderedGroup[],\n  currentGroups: IOrderedGroup[]\n): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf NumberColumn\n * @event\n */\nexport declare function filterChanged(previous: any | null, current: any | null): void;\n/**\n * a ranking\n */\nexport default class Ranking extends AEventDispatcher implements IColumnParent {\n  static readonly EVENT_WIDTH_CHANGED = Column.EVENT_WIDTH_CHANGED;\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\n  static readonly EVENT_LABEL_CHANGED = Column.EVENT_LABEL_CHANGED;\n  static readonly EVENT_ADD_COLUMN = CompositeColumn.EVENT_ADD_COLUMN;\n  static readonly EVENT_MOVE_COLUMN = CompositeColumn.EVENT_MOVE_COLUMN;\n  static readonly EVENT_REMOVE_COLUMN = CompositeColumn.EVENT_REMOVE_COLUMN;\n  static readonly EVENT_DIRTY = Column.EVENT_DIRTY;\n  static readonly EVENT_DIRTY_HEADER = Column.EVENT_DIRTY_HEADER;\n  static readonly EVENT_DIRTY_VALUES = Column.EVENT_DIRTY_VALUES;\n  static readonly EVENT_DIRTY_CACHES = Column.EVENT_DIRTY_CACHES;\n  static readonly EVENT_COLUMN_VISIBILITY_CHANGED = Column.EVENT_VISIBILITY_CHANGED;\n  static readonly EVENT_SORT_CRITERIA_CHANGED = 'sortCriteriaChanged';\n  static readonly EVENT_GROUP_CRITERIA_CHANGED = 'groupCriteriaChanged';\n  static readonly EVENT_GROUP_SORT_CRITERIA_CHANGED = 'groupSortCriteriaChanged';\n  static readonly EVENT_DIRTY_ORDER = 'dirtyOrder';\n  static readonly EVENT_ORDER_CHANGED = 'orderChanged';\n  static readonly EVENT_GROUPS_CHANGED = 'groupsChanged';\n\n  private static readonly FORWARD_COLUMN_EVENTS = suffix(\n    '.ranking',\n    Column.EVENT_VISIBILITY_CHANGED,\n    Column.EVENT_DIRTY_VALUES,\n    Column.EVENT_DIRTY_CACHES,\n    Column.EVENT_DIRTY_HEADER,\n    Column.EVENT_DIRTY,\n    Column.EVENT_VISIBILITY_CHANGED,\n    Ranking.EVENT_FILTER_CHANGED\n  );\n  private static readonly COLUMN_GROUP_SORT_DIRTY = suffix(\n    '.groupOrder',\n    Column.EVENT_DIRTY_CACHES,\n    'sortMethodChanged'\n  );\n  private static readonly COLUMN_SORT_DIRTY = suffix('.order', Column.EVENT_DIRTY_CACHES);\n  private static readonly COLUMN_GROUP_DIRTY = suffix('.group', Column.EVENT_DIRTY_CACHES, 'groupingChanged');\n\n  private label: string;\n\n  private readonly sortCriteria: ISortCriteria[] = [];\n  private readonly groupColumns: Column[] = [];\n  private readonly groupSortCriteria: ISortCriteria[] = [];\n\n  /**\n   * columns of this ranking\n   * @type {Array}\n   * @private\n   */\n  private readonly columns: Column[] = [];\n\n  readonly dirtyOrder = (reason?: EDirtyReason[]) => {\n    this.fire([Ranking.EVENT_DIRTY_ORDER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], reason);\n  };\n  private readonly dirtyOrderSortDirty = () => this.dirtyOrder([EDirtyReason.SORT_CRITERIA_DIRTY]);\n  private readonly dirtyOrderGroupDirty = () => this.dirtyOrder([EDirtyReason.GROUP_CRITERIA_DIRTY]);\n  private readonly dirtyOrderGroupSortDirty = () => this.dirtyOrder([EDirtyReason.GROUP_SORT_CRITERIA_DIRTY]);\n  private readonly dirtyOrderFiltering = () => this.dirtyOrder([EDirtyReason.FILTER_CHANGED]);\n\n  /**\n   * the current ordering as an sorted array of indices\n   * @type {Array}\n   */\n  private groups: IOrderedGroup[] = [Object.assign({ order: [] as number[] }, defaultGroup)];\n  private order: IndicesArray = [];\n  private index2pos: IndicesArray = [];\n\n  constructor(public id: string) {\n    super();\n    this.id = fixCSS(id);\n    this.label = `Ranking ${id.startsWith('rank') ? id.slice(4) : id}`;\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        Ranking.EVENT_WIDTH_CHANGED,\n        Ranking.EVENT_FILTER_CHANGED,\n        Ranking.EVENT_LABEL_CHANGED,\n        Ranking.EVENT_GROUPS_CHANGED,\n        Ranking.EVENT_ADD_COLUMN,\n        Ranking.EVENT_REMOVE_COLUMN,\n        Ranking.EVENT_GROUP_CRITERIA_CHANGED,\n        Ranking.EVENT_MOVE_COLUMN,\n        Ranking.EVENT_DIRTY,\n        Ranking.EVENT_DIRTY_HEADER,\n        Ranking.EVENT_DIRTY_VALUES,\n        Ranking.EVENT_DIRTY_CACHES,\n        Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED,\n        Ranking.EVENT_COLUMN_VISIBILITY_CHANGED,\n        Ranking.EVENT_SORT_CRITERIA_CHANGED,\n        Ranking.EVENT_DIRTY_ORDER,\n        Ranking.EVENT_ORDER_CHANGED,\n      ]);\n  }\n\n  on(type: typeof Ranking.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Ranking.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof Ranking.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Ranking.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof Ranking.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof Ranking.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Ranking.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Ranking.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Ranking.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Ranking.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Ranking.EVENT_COLUMN_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: typeof Ranking.EVENT_SORT_CRITERIA_CHANGED, listener: typeof sortCriteriaChanged | null): this;\n  on(type: typeof Ranking.EVENT_GROUP_CRITERIA_CHANGED, listener: typeof groupCriteriaChanged | null): this;\n  on(type: typeof Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED, listener: typeof groupSortCriteriaChanged | null): this;\n  on(type: typeof Ranking.EVENT_DIRTY_ORDER, listener: typeof dirtyOrder | null): this;\n  on(type: typeof Ranking.EVENT_ORDER_CHANGED, listener: typeof orderChanged | null): this;\n  on(type: typeof Ranking.EVENT_GROUPS_CHANGED, listener: typeof groupsChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  assignNewId(idGenerator: () => string) {\n    this.id = fixCSS(idGenerator());\n    this.columns.forEach((c) => c.assignNewId(idGenerator));\n  }\n\n  getLabel() {\n    return this.label;\n  }\n\n  setLabel(value: string) {\n    if (value === this.label) {\n      return;\n    }\n    this.fire(Ranking.EVENT_LABEL_CHANGED, this.label, (this.label = value));\n  }\n\n  setGroups(groups: IOrderedGroup[], index2pos: IndicesArray, dirtyReason: EDirtyReason[]) {\n    const old = this.order;\n    const oldGroups = this.groups;\n    this.groups = groups;\n    this.index2pos = index2pos;\n    this.order = joinIndexArrays(groups.map((d) => d.order));\n    // replace with subarrays to save memory\n    if (groups.length > 1) {\n      this.unifyGroups(groups);\n    } else if (groups.length === 1) {\n      // propagate to the top\n      let p = groups[0].parent;\n      while (p) {\n        (p as any as IOrderedGroup).order = this.order;\n        p = p.parent;\n      }\n    }\n    this.fire(\n      [Ranking.EVENT_ORDER_CHANGED, Ranking.EVENT_GROUPS_CHANGED, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY],\n      old,\n      this.order,\n      oldGroups,\n      groups,\n      dirtyReason\n    );\n  }\n\n  private unifyGroups(groups: IOrderedGroup[]) {\n    let offset = 0;\n    const order = this.order as UIntTypedArray;\n    const offsets = new Map<\n      Readonly<IGroupParent> | IOrderedGroup,\n      {\n        offset: number;\n        size: number;\n      }\n    >();\n    for (const group of groups) {\n      const size = group.order.length;\n      group.order = order.subarray(offset, offset + size);\n      offsets.set(group, { offset, size });\n      offset += size;\n    }\n    // propagate also to the top with views\n    const roots = groupRoots(groups);\n    const resolve = (\n      g: Readonly<IGroupParent> | IOrderedGroup\n    ): {\n      offset: number;\n      size: number;\n    } => {\n      if (offsets.has(g)) {\n        // leaf\n        return offsets.get(g)!;\n      }\n      const subs = (g as IGroupParent).subGroups.map((gi) => resolve(gi as Readonly<IGroupParent> | IOrderedGroup));\n      const offset = subs.length > 0 ? subs[0].offset : 0;\n      const size = subs.reduce((a, b) => a + b.size, 0);\n      const r = { offset, size };\n      offsets.set(g, r);\n      (g as any as IOrderedGroup).order = order.subarray(offset, offset + size);\n      return r;\n    };\n    for (const root of roots) {\n      resolve(root);\n    }\n  }\n\n  getRank(dataIndex: number) {\n    if (dataIndex < 0 || dataIndex > this.index2pos.length) {\n      return -1;\n    }\n    const v = this.index2pos[dataIndex];\n    return v != null && !Number.isNaN(v) && v > 0 ? v : -1;\n  }\n\n  getOrder() {\n    return this.order;\n  }\n\n  getOrderLength() {\n    return this.order.length;\n  }\n\n  getGroups() {\n    return this.groups.slice();\n  }\n\n  /**\n   * Returns the flat group tree in depth first search (DFS).\n   */\n  getFlatGroups() {\n    const r: Readonly<IGroup | IGroupParent>[] = [];\n    traverseGroupsDFS(this.groups, (v) => {\n      r.push(v);\n    });\n    return r;\n  }\n\n  dump(toDescRef: (desc: any) => any): IRankingDump {\n    const r: IRankingDump = {};\n    r.columns = this.columns.map((d) => d.dump(toDescRef));\n    r.sortCriteria = this.sortCriteria.map((s) => ({ asc: s.asc, sortBy: s.col!.id }));\n    r.groupSortCriteria = this.groupSortCriteria.map((s) => ({ asc: s.asc, sortBy: s.col!.id }));\n    r.groupColumns = this.groupColumns.map((d) => d.id);\n    return r;\n  }\n\n  restore(dump: IRankingDump, factory: ITypeFactory) {\n    this.clear();\n    (dump.columns || []).forEach((child: any) => {\n      const c = factory(child);\n      if (c) {\n        this.push(c);\n      }\n    });\n    // compatibility case\n    if (dump.sortColumn && dump.sortColumn.sortBy) {\n      const help = this.columns.find((d) => d.id === dump.sortColumn!.sortBy);\n      if (help) {\n        this.sortBy(help, dump.sortColumn.asc);\n      }\n    }\n    if (dump.groupColumns) {\n      const groupColumns = dump.groupColumns\n        .map((id: string) => this.columns.find((d) => d.id === id))\n        .filter((d) => d != null) as Column[];\n      this.setGroupCriteria(groupColumns);\n    }\n\n    const restoreSortCriteria = (dumped: any) => {\n      return dumped\n        .map((s: { asc: boolean; sortBy: string }) => {\n          return {\n            asc: s.asc,\n            col: this.columns.find((d) => d.id === s.sortBy) || null,\n          };\n        })\n        .filter((s: any) => s.col);\n    };\n\n    if (dump.sortCriteria) {\n      this.setSortCriteria(restoreSortCriteria(dump.sortCriteria));\n    }\n\n    if (dump.groupSortCriteria) {\n      this.setGroupSortCriteria(restoreSortCriteria(dump.groupSortCriteria));\n    }\n  }\n\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\n    let acc = offset; // + this.getWidth() + padding;\n    if (levelsToGo > 0 || levelsToGo <= Column.FLAT_ALL_COLUMNS) {\n      this.columns.forEach((c) => {\n        if (c.getVisible() && levelsToGo <= Column.FLAT_ALL_COLUMNS) {\n          acc += c.flatten(r, acc, levelsToGo - 1, padding) + padding;\n        }\n      });\n    }\n    return acc - offset;\n  }\n\n  getPrimarySortCriteria(): ISortCriteria | null {\n    if (this.sortCriteria.length === 0) {\n      return null;\n    }\n    return this.sortCriteria[0];\n  }\n\n  getSortCriteria(): ISortCriteria[] {\n    return this.sortCriteria.map((d) => Object.assign({}, d));\n  }\n\n  getGroupSortCriteria(): ISortCriteria[] {\n    return this.groupSortCriteria.map((d) => Object.assign({}, d));\n  }\n\n  toggleSorting(col: Column) {\n    return this.setSortCriteria(this.toggleSortingLogic(col, this.sortCriteria));\n  }\n\n  private toggleSortingLogic(col: Column, sortCriteria: ISortCriteria[]) {\n    const newSort = sortCriteria.slice();\n    const current = newSort.findIndex((d) => d.col === col);\n    const defaultAsc = isSortingAscByDefault(col);\n\n    if (current < 0) {\n      newSort.splice(0, newSort.length, { col, asc: defaultAsc });\n    } else if (newSort[current].asc === defaultAsc) {\n      // asc -> desc, or desc -> asc\n      newSort.splice(current, 1, { col, asc: !defaultAsc });\n    } else {\n      // remove\n      newSort.splice(current, 1);\n    }\n    return newSort;\n  }\n\n  toggleGrouping(col: Column) {\n    const old = this.groupColumns.indexOf(col);\n    if (old >= 0) {\n      const newGroupings = this.groupColumns.slice();\n      newGroupings.splice(old, 1);\n      return this.setGroupCriteria(newGroupings);\n    }\n    return this.setGroupCriteria([col]);\n  }\n\n  getGroupCriteria() {\n    return this.groupColumns.slice();\n  }\n\n  /**\n   * replaces, moves, or remove the given column in the sorting hierarchy\n   * @param col {Column}\n   * @param priority {number} when priority < 0 remove the column only else replace at the given priority\n   */\n  sortBy(col: Column, ascending = false, priority = 0) {\n    if (col.findMyRanker() !== this) {\n      return false; //not one of mine\n    }\n    return this.setSortCriteria(\n      this.hierarchyLogic(\n        this.sortCriteria,\n        this.sortCriteria.findIndex((d) => d.col === col),\n        { col, asc: ascending },\n        priority\n      )\n    );\n  }\n\n  /**\n   * replaces, moves, or remove the given column in the group sorting hierarchy\n   * @param col {Column}\n   * @param priority {number} when priority < 0 remove the column only else replace at the given priority\n   */\n  groupSortBy(col: Column, ascending = false, priority = 0) {\n    if (col.findMyRanker() !== this) {\n      return false; //not one of mine\n    }\n    return this.setGroupSortCriteria(\n      this.hierarchyLogic(\n        this.groupSortCriteria,\n        this.groupSortCriteria.findIndex((d) => d.col === col),\n        { col, asc: ascending },\n        priority\n      )\n    );\n  }\n\n  private hierarchyLogic<T>(entries: T[], index: number, entry: T, priority: number) {\n    entries = entries.slice();\n    if (index >= 0) {\n      // move at the other position\n      entries.splice(index, 1);\n      if (priority >= 0) {\n        entries.splice(Math.min(priority, entries.length), 0, entry);\n      }\n    } else if (priority >= 0) {\n      entries[Math.min(priority, entries.length)] = entry;\n    }\n    return entries;\n  }\n\n  /**\n   * replaces, moves, or remove the given column in the grouping hierarchy\n   * @param col {Column}\n   * @param priority {number} when priority < 0 remove the column only else replace at the given priority\n   */\n  groupBy(col: Column, priority = 0): boolean {\n    if (col.findMyRanker() !== this) {\n      return false; //not one of mine\n    }\n    return this.setGroupCriteria(this.hierarchyLogic(this.groupColumns, this.groupColumns.indexOf(col), col, priority));\n  }\n\n  setSortCriteria(value: ISortCriteria | ISortCriteria[]) {\n    const values = Array.isArray(value) ? value.slice() : [value];\n    const bak = this.sortCriteria.slice();\n\n    if (equalCriteria(values, bak)) {\n      return false;\n    }\n\n    // update listener\n    bak.forEach((d) => {\n      d.col.on(Ranking.COLUMN_SORT_DIRTY, null!);\n    });\n\n    values.forEach((d) => {\n      d.col.on(Ranking.COLUMN_SORT_DIRTY, this.dirtyOrderSortDirty);\n    });\n    this.sortCriteria.splice(0, this.sortCriteria.length, ...values.slice());\n    this.triggerResort(bak);\n    return true;\n  }\n\n  setGroupCriteria(column: Column[] | Column) {\n    const cols = Array.isArray(column) ? column : [column];\n\n    if (equalArrays(this.groupColumns, cols)) {\n      return true; //same\n    }\n    this.groupColumns.forEach((groupColumn) => {\n      groupColumn.on(Ranking.COLUMN_GROUP_DIRTY, null);\n    });\n\n    const bak = this.groupColumns.slice();\n    this.groupColumns.splice(0, this.groupColumns.length, ...cols);\n\n    this.groupColumns.forEach((groupColumn) => {\n      groupColumn.on(Ranking.COLUMN_GROUP_DIRTY, this.dirtyOrderGroupDirty);\n    });\n\n    this.fire(\n      [\n        Ranking.EVENT_GROUP_CRITERIA_CHANGED,\n        Ranking.EVENT_DIRTY_ORDER,\n        Ranking.EVENT_DIRTY_HEADER,\n        Ranking.EVENT_DIRTY_VALUES,\n        Ranking.EVENT_DIRTY_CACHES,\n        Ranking.EVENT_DIRTY,\n      ],\n      bak,\n      this.getGroupCriteria()\n    );\n\n    this.autoAdaptAggregationColumn();\n\n    return true;\n  }\n\n  private autoAdaptAggregationColumn() {\n    // set column auto adds two levels\n    const length = this.groupColumns.reduce((acc, c) => acc + (c instanceof SetColumn ? 2 : 1), 0);\n    const col = this.children.find((d) => d instanceof AggregateGroupColumn);\n    if (!col) {\n      return;\n    }\n    const targetWidth = length * AGGREGATION_LEVEL_WIDTH;\n    if (targetWidth > col.getWidth()) {\n      col.setWidth(targetWidth);\n    }\n  }\n\n  toggleGroupSorting(col: Column) {\n    return this.setGroupSortCriteria(this.toggleSortingLogic(col, this.groupSortCriteria));\n  }\n\n  setGroupSortCriteria(value: ISortCriteria | ISortCriteria[]) {\n    const values = Array.isArray(value) ? value.slice() : [value];\n    const bak = this.groupSortCriteria.slice();\n\n    if (equalCriteria(values, bak)) {\n      return false;\n    }\n\n    bak.forEach((d) => {\n      d.col.on(Ranking.COLUMN_GROUP_SORT_DIRTY, null!);\n    });\n\n    values.forEach((d) => {\n      d.col.on(Ranking.COLUMN_GROUP_SORT_DIRTY, this.dirtyOrderGroupSortDirty);\n    });\n    this.groupSortCriteria.splice(0, this.groupSortCriteria.length, ...values.slice());\n    this.triggerGroupResort(bak);\n    return true;\n  }\n\n  private triggerGroupResort(bak: ISortCriteria | ISortCriteria[] | null) {\n    const sortCriterias = this.getGroupSortCriteria();\n    const bakMulti = Array.isArray(bak) ? bak : sortCriterias;\n    this.fire(\n      [\n        Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED,\n        Ranking.EVENT_DIRTY_ORDER,\n        Ranking.EVENT_DIRTY_HEADER,\n        Ranking.EVENT_DIRTY_VALUES,\n        Ranking.EVENT_DIRTY,\n      ],\n      bakMulti,\n      sortCriterias\n    );\n  }\n\n  private triggerResort(bak: ISortCriteria | ISortCriteria[] | null) {\n    const sortCriterias = this.getSortCriteria();\n    const bakMulti = Array.isArray(bak) ? bak : sortCriterias;\n    this.fire(\n      [\n        Ranking.EVENT_SORT_CRITERIA_CHANGED,\n        Ranking.EVENT_DIRTY_ORDER,\n        Ranking.EVENT_DIRTY_HEADER,\n        Ranking.EVENT_DIRTY_VALUES,\n        Ranking.EVENT_DIRTY,\n      ],\n      bakMulti,\n      sortCriterias\n    );\n  }\n\n  get children() {\n    return this.columns.slice();\n  }\n\n  get length() {\n    return this.columns.length;\n  }\n\n  insert(col: Column, index: number = this.columns.length) {\n    this.columns.splice(index, 0, col);\n    col.attach(this);\n    this.forward(col, ...Ranking.FORWARD_COLUMN_EVENTS);\n    col.on(`${Ranking.EVENT_FILTER_CHANGED}.order`, this.dirtyOrderFiltering);\n    col.on(`${Column.EVENT_VISIBILITY_CHANGED}.ranking`, (oldValue, newValue) =>\n      this.fire(\n        [\n          Ranking.EVENT_COLUMN_VISIBILITY_CHANGED,\n          Ranking.EVENT_DIRTY_HEADER,\n          Ranking.EVENT_DIRTY_VALUES,\n          Ranking.EVENT_DIRTY,\n        ],\n        col,\n        oldValue,\n        newValue\n      )\n    );\n\n    this.fire(\n      [Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY],\n      col,\n      index\n    );\n\n    if (col.isFiltered()) {\n      this.dirtyOrderFiltering();\n    }\n    return col;\n  }\n\n  move(col: Column, index: number = this.columns.length) {\n    if (col.parent !== this) {\n      // not a move operation!\n      console.error('invalid move operation: ', col);\n      return null;\n    }\n    const old = this.columns.indexOf(col);\n    if (index === old) {\n      // no move needed\n      return col;\n    }\n    //delete first\n    this.columns.splice(old, 1);\n    // adapt target index based on previous index, i.e shift by one\n    this.columns.splice(old < index ? index - 1 : index, 0, col);\n\n    this.fire(\n      [Ranking.EVENT_MOVE_COLUMN, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY],\n      col,\n      index,\n      old\n    );\n    return col;\n  }\n\n  moveAfter(col: Column, reference: Column) {\n    const i = this.columns.indexOf(reference);\n    if (i < 0) {\n      return null;\n    }\n    return this.move(col, i + 1);\n  }\n\n  moveBefore(col: Column, reference: Column) {\n    const i = this.columns.indexOf(reference);\n    if (i < 0) {\n      return null;\n    }\n    return this.move(col, i);\n  }\n\n  get fqpath() {\n    return '';\n  }\n\n  findByPath(fqpath: string): Column {\n    let p: IColumnParent | Column = this as any;\n    const indices = fqpath.split('@').map(Number).slice(1); //ignore the first entry = ranking\n    while (indices.length > 0) {\n      const i = indices.shift()!;\n      p = (p as IColumnParent).at(i);\n    }\n    return p as Column;\n  }\n\n  indexOf(col: Column) {\n    return this.columns.indexOf(col);\n  }\n\n  at(index: number) {\n    return this.columns[index];\n  }\n\n  insertAfter(col: Column, ref: Column) {\n    const i = this.columns.indexOf(ref);\n    if (i < 0) {\n      return null;\n    }\n    return this.insert(col, i + 1);\n  }\n\n  insertBefore(col: Column, ref: Column) {\n    const i = this.columns.indexOf(ref);\n    if (i < 0) {\n      return null;\n    }\n    return this.insert(col, i);\n  }\n\n  push(col: Column) {\n    return this.insert(col);\n  }\n\n  remove(col: Column) {\n    const i = this.columns.indexOf(col);\n    if (i < 0) {\n      return false;\n    }\n\n    this.unforward(col, ...Ranking.FORWARD_COLUMN_EVENTS);\n\n    const isSortCriteria = this.sortCriteria.findIndex((d) => d.col === col);\n    const sortCriteriaChanged = isSortCriteria >= 0;\n    if (sortCriteriaChanged) {\n      this.sortCriteria.splice(isSortCriteria, 1);\n    }\n\n    const isGroupSortCriteria = this.groupSortCriteria.findIndex((d) => d.col === col);\n    const groupSortCriteriaChanged = isGroupSortCriteria >= 0;\n    if (groupSortCriteriaChanged) {\n      this.groupSortCriteria.splice(isGroupSortCriteria, 1);\n    }\n\n    let newGrouping: Column[] | null = null;\n    const isGroupColumn = this.groupColumns.indexOf(col);\n    if (isGroupColumn >= 0) {\n      // was my grouping criteria\n      newGrouping = this.groupColumns.slice();\n      newGrouping.splice(isGroupColumn, 1);\n    }\n\n    col.detach();\n    this.columns.splice(i, 1);\n\n    this.fire(\n      [Ranking.EVENT_REMOVE_COLUMN, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY],\n      col,\n      i\n    );\n\n    if (newGrouping) {\n      this.setGroupCriteria(newGrouping);\n    } else if (sortCriteriaChanged) {\n      this.triggerResort(null);\n    } else if (groupSortCriteriaChanged) {\n      this.triggerGroupResort(null);\n    } else if (col.isFiltered()) {\n      this.dirtyOrderFiltering();\n    }\n\n    return true;\n  }\n\n  clear() {\n    if (this.columns.length === 0) {\n      return;\n    }\n    this.sortCriteria.forEach((d) => {\n      d.col.on(`${Column.EVENT_DIRTY_CACHES}.order`, null!);\n    });\n    this.sortCriteria.splice(0, this.sortCriteria.length);\n    this.groupSortCriteria.forEach((d) => {\n      d.col.on(Ranking.COLUMN_GROUP_SORT_DIRTY, null!);\n    });\n    this.groupSortCriteria.splice(0, this.groupSortCriteria.length);\n\n    this.groupColumns.forEach((d) => {\n      d.on(Ranking.COLUMN_GROUP_DIRTY, null!);\n    });\n    this.groupColumns.splice(0, this.groupColumns.length);\n\n    this.columns.forEach((col) => {\n      this.unforward(col, ...Ranking.FORWARD_COLUMN_EVENTS);\n      col.detach();\n    });\n    const removed = this.columns.splice(0, this.columns.length);\n    this.fire(\n      [\n        Ranking.EVENT_REMOVE_COLUMN,\n        Ranking.EVENT_DIRTY_ORDER,\n        Ranking.EVENT_DIRTY_HEADER,\n        Ranking.EVENT_DIRTY_VALUES,\n        Ranking.EVENT_DIRTY,\n      ],\n      removed\n    );\n  }\n\n  get flatColumns(): Column[] {\n    const r: IFlatColumn[] = [];\n    this.flatten(r, 0, Column.FLAT_ALL_COLUMNS);\n    return r.map((d) => d.col);\n  }\n\n  find(idOrFilter: string | ((col: Column) => boolean)) {\n    const filter = typeof idOrFilter === 'string' ? (col: Column) => col.id === idOrFilter : idOrFilter;\n    const r = this.flatColumns;\n    for (const v of r) {\n      if (filter(v)) {\n        return v;\n      }\n    }\n    return null;\n  }\n\n  isFiltered() {\n    return this.columns.some((d) => d.isFiltered());\n  }\n\n  filter(row: IDataRow) {\n    return this.columns.every((d) => d.filter(row));\n  }\n\n  clearFilters() {\n    return this.columns.map((d) => d.clearFilter()).some((d) => d);\n  }\n\n  findMyRanker() {\n    return this;\n  }\n\n  get fqid() {\n    return this.id;\n  }\n\n  /**\n   * marks the header, values, or both as dirty such that the values are reevaluated\n   * @param type specify in more detail what is dirty, by default whole column\n   */\n  markDirty(type: 'header' | 'values' | 'all' = 'all') {\n    switch (type) {\n      case 'header':\n        return this.fire([Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY]);\n      case 'values':\n        return this.fire([Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY]);\n      default:\n        return this.fire([\n          Column.EVENT_DIRTY_HEADER,\n          Column.EVENT_DIRTY_VALUES,\n          Column.EVENT_DIRTY_CACHES,\n          Column.EVENT_DIRTY,\n        ]);\n    }\n  }\n}\n\nfunction equalCriteria(a: ISortCriteria[], b: ISortCriteria[]) {\n  if (a.length !== b.length) {\n    return false;\n  }\n  return a.every((ai, i) => {\n    const bi = b[i];\n    return ai.col === bi.col && ai.asc === bi.asc;\n  });\n}\n","/**\n * @internal\n */\nexport interface IDebounceContext {\n  /**\n   * aka this\n   */\n  self: any;\n  args: any[];\n}\n\n/**\n * create a delayed call, can be called multiple times but only the last one at most delayed by timeToDelay will be executed\n * @param {(...args: any[]) => void} callback the callback to call\n * @param {number} timeToDelay delay the call in milliseconds\n * @param choose optional function to merge call context\n * @return {(...args: any[]) => any} a function that can be called with the same interface as the callback but delayed\n * @internal\n */\nexport default function debounce(\n  callback: (...args: any[]) => void,\n  timeToDelay = 100,\n  choose?: (current: IDebounceContext, next: IDebounceContext) => IDebounceContext\n) {\n  let tm = -1;\n  let ctx: IDebounceContext | null = null;\n\n  return function (this: any, ...args: any[]) {\n    if (tm >= 0) {\n      clearTimeout(tm);\n      tm = -1;\n    }\n\n    const next = { self: this, args };\n    // compute current context\n    ctx = ctx && choose ? choose(ctx, next) : next;\n\n    tm = setTimeout(() => {\n      console.assert(ctx != null);\n      callback.apply(ctx!.self, ctx!.args);\n      ctx = null;\n    }, timeToDelay) as unknown as number;\n  };\n}\n","import { Category, SupportType } from './annotations';\nimport Column from './Column';\nimport type { IDataRow, IColumnDesc } from './interfaces';\nimport { integrateDefaults } from './internal';\n\n/**\n * factory for creating a description creating a rank column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createRankDesc(label = 'Rank') {\n  return { type: 'rank', label };\n}\n\n/**\n * a rank column\n */\n@SupportType()\n@Category('support')\nexport default class RankColumn extends Column {\n  constructor(id: string, desc: IColumnDesc) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 50,\n      })\n    );\n  }\n\n  getLabel(row: IDataRow) {\n    return String(this.getValue(row));\n  }\n\n  getRaw(row: IDataRow) {\n    const ranking = this.findMyRanker();\n    if (!ranking) {\n      return -1;\n    }\n    return ranking.getRank(row.i);\n  }\n\n  getValue(row: IDataRow) {\n    const r = this.getRaw(row);\n    return r === -1 ? null : r;\n  }\n\n  get frozen() {\n    return this.desc.frozen !== false;\n  }\n}\n","import { Category, SupportType, toolbar } from './annotations';\nimport { IndicesArray, IDataRow, IGroup, ECompareValueType, IValueColumnDesc, ITypeFactory } from './interfaces';\nimport type {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport Column from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport type { IEventListener } from '../internal';\nimport { integrateDefaults } from './internal';\n\n/**\n * factory for creating a description creating a rank column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createSelectionDesc(label = 'Selections') {\n  return { type: 'selection', label, fixed: true };\n}\n\nexport interface ISelectionColumnDesc extends IValueColumnDesc<boolean> {\n  /**\n   * setter for selecting/deselecting the given row\n   */\n  setter(index: number, value: boolean): void;\n\n  /**\n   * setter for selecting/deselecting the given row\n   */\n  setterAll(indices: IndicesArray, value: boolean): void;\n}\n\n/**\n * emitted when rows are selected\n * @asMemberOf SelectionColumn\n * @param dataIndex the (de)selected row\n * @param value true if selected else false\n * @param dataIndices in case of multiple rows are selected\n * @event\n */\nexport declare function select_SEC(dataIndex: number, value: boolean, dataIndices?: IndicesArray): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf SelectionColumn\n * @event\n */\nexport declare function filterChanged_SEC(previous: Set<number> | null, current: Set<number> | null): void;\n\n/**\n * a checkbox column for selections\n */\n@SupportType()\n@toolbar('sort', 'sortBy', 'group', 'groupBy', 'invertSelection', 'filterSelection')\n@Category('support')\nexport default class SelectionColumn extends ValueColumn<boolean> {\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\n  static readonly EVENT_SELECT = 'select';\n\n  private static SELECTED_GROUP: IGroup = {\n    name: 'Selected',\n    color: 'orange',\n  };\n  private static NOT_SELECTED_GROUP: IGroup = {\n    name: 'Unselected',\n    color: 'gray',\n  };\n\n  private currentFilter: Set<number> | null = null;\n\n  constructor(id: string, desc: Readonly<ISelectionColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 50,\n      })\n    );\n  }\n\n  get frozen() {\n    return this.desc.frozen !== false;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([SelectionColumn.EVENT_SELECT, SelectionColumn.EVENT_FILTER_CHANGED]);\n  }\n\n  on(type: typeof SelectionColumn.EVENT_SELECT, listener: typeof select_SEC | null): this;\n  on(type: typeof SelectionColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_SEC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  setValue(row: IDataRow, value: boolean) {\n    const old = this.getValue(row);\n    if (old === value) {\n      return true;\n    }\n    return this.setImpl(row, value);\n  }\n\n  setValues(rows: IndicesArray, value: boolean) {\n    if (rows.length === 0) {\n      return false;\n    }\n    if ((this.desc as ISelectionColumnDesc).setterAll) {\n      (this.desc as ISelectionColumnDesc).setterAll(rows, value);\n    }\n    this.fire(SelectionColumn.EVENT_SELECT, rows[0], value, rows);\n    return true;\n  }\n\n  private setImpl(row: IDataRow, value: boolean) {\n    if ((this.desc as ISelectionColumnDesc).setter) {\n      (this.desc as ISelectionColumnDesc).setter(row.i, value);\n    }\n    this.fire(SelectionColumn.EVENT_SELECT, row.i, value);\n    return true;\n  }\n\n  toggleValue(row: IDataRow) {\n    const old = this.getValue(row);\n    this.setImpl(row, !old);\n    return !old;\n  }\n\n  toCompareValue(row: IDataRow) {\n    const v = this.getValue(row) === true;\n    return v ? 1 : 0;\n  }\n\n  toCompareValueType() {\n    return ECompareValueType.BINARY;\n  }\n\n  group(row: IDataRow) {\n    const isSelected = this.getValue(row);\n    return Object.assign({}, isSelected ? SelectionColumn.SELECTED_GROUP : SelectionColumn.NOT_SELECTED_GROUP);\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.filter = this.currentFilter ? Array.from(this.currentFilter).sort((a, b) => a - b) : null;\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.filter) {\n      const filter = dump.filter;\n      this.currentFilter = new Set(filter);\n    } else {\n      this.currentFilter = null;\n    }\n  }\n\n  isFiltered() {\n    return this.currentFilter != null;\n  }\n\n  filter(row: IDataRow) {\n    if (!this.isFiltered()) {\n      return true;\n    }\n    const filter = this.currentFilter!;\n    return filter.has(row.i);\n  }\n\n  getFilter(): number[] | null {\n    return this.currentFilter == null ? null : Array.from(this.currentFilter);\n  }\n\n  setFilter(filter: number[] | null) {\n    const newValue = filter ? new Set(filter) : null;\n    if (areSameSets(newValue, this.currentFilter)) {\n      return;\n    }\n    this.fire(\n      [SelectionColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.currentFilter,\n      (this.currentFilter = newValue)\n    );\n  }\n\n  clearFilter() {\n    const was = this.isFiltered();\n    this.setFilter(null);\n    return was;\n  }\n}\n\nfunction areSameSets(a: Set<number> | null, b: Set<number> | null) {\n  const aL = a != null ? a.size : 0;\n  const bL = b != null ? b.size : 0;\n  if (aL !== bL) {\n    return false;\n  }\n  if (aL === 0 || bL === 0) {\n    return true;\n  }\n  return Array.from(a).every((d) => b.has(d));\n}\n","import { Category, SupportType } from './annotations';\nimport type { IDataRow, IColumnDesc, IGroup } from './interfaces';\nimport Column from './Column';\n\nexport interface IAction {\n  name: string;\n  icon?: string;\n  className?: string;\n\n  action(row: IDataRow): void;\n}\n\nexport interface IGroupAction {\n  name: string;\n  icon?: string;\n  className?: string;\n\n  action(group: IGroup, rows: IDataRow[]): void;\n}\n\n/**\n * utility for creating an action description with optional label\n * @param label\n * @param actions\n * @param groupActions\n * @returns {{type: string, label: string}}\n */\nexport function createActionDesc(\n  label = 'actions',\n  actions: Readonly<IAction>[] = [],\n  groupActions: Readonly<IGroupAction>[] = []\n) {\n  return { type: 'actions', label, actions, groupActions, fixed: true };\n}\n\nexport interface IActionDesc {\n  actions?: Readonly<IAction>[];\n  groupActions?: Readonly<IGroupAction>[];\n}\n\nexport declare type IActionColumnDesc = IColumnDesc & IActionDesc;\n\n/**\n * a default column with no values\n */\n@SupportType()\n@Category('support')\nexport default class ActionColumn extends Column {\n  readonly actions: IAction[];\n  readonly groupActions: IGroupAction[];\n\n  constructor(id: string, desc: Readonly<IActionColumnDesc>) {\n    super(id, desc);\n\n    this.actions = desc.actions || [];\n    this.groupActions = desc.groupActions || [];\n  }\n\n  getLabel() {\n    return '';\n  }\n\n  getValue() {\n    return '';\n  }\n\n  compare() {\n    return 0; //can't compare\n  }\n}\n","import { Category, toolbar, dialogAddons } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport {\n  defaultGroup,\n  IDataRow,\n  IGroup,\n  ECompareValueType,\n  IValueColumnDesc,\n  othersGroup,\n  ITypeFactory,\n} from './interfaces';\nimport { missingGroup, isMissingValue } from './missing';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport { equal, IEventListener, ISequence, isSeqEmpty } from '../internal';\nimport { integrateDefaults } from './internal';\n\nexport enum EAlignment {\n  left = 'left',\n  center = 'center',\n  right = 'right',\n}\n\nexport enum EStringGroupCriteriaType {\n  value = 'value',\n  startsWith = 'startsWith',\n  regex = 'regex',\n}\n\nexport interface IStringGroupCriteria {\n  type: EStringGroupCriteriaType;\n  values: (string | RegExp)[];\n}\n\nexport interface IStringDesc {\n  /**\n   * column alignment: left, center, right\n   * @default left\n   */\n  alignment?: EAlignment;\n\n  /**\n   * escape html tags\n   */\n  escape?: boolean;\n}\n\nexport declare type IStringColumnDesc = IStringDesc & IValueColumnDesc<string>;\n\nexport interface IStringFilter {\n  filter: string | RegExp | null;\n  filterMissing: boolean;\n}\n\n/**\n * emitted when the filter property changes\n * @asMemberOf StringColumn\n * @event\n */\nexport declare function filterChanged_SC(previous: string | RegExp | null, current: string | RegExp | null): void;\n\n/**\n * emitted when the grouping property changes\n * @asMemberOf StringColumn\n * @event\n */\nexport declare function groupingChanged_SC(previous: (RegExp | string)[][], current: (RegExp | string)[][]): void;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'search', 'groupBy', 'sortGroupBy', 'filterString')\n@dialogAddons('group', 'groupString')\n@Category('string')\nexport default class StringColumn extends ValueColumn<string> {\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\n  static readonly EVENT_GROUPING_CHANGED = 'groupingChanged';\n\n  //magic key for filtering missing ones\n  private static readonly FILTER_MISSING = '__FILTER_MISSING';\n  private currentFilter: IStringFilter | null = null;\n\n  readonly alignment: EAlignment;\n  readonly escape: boolean;\n\n  private currentGroupCriteria: IStringGroupCriteria = {\n    type: EStringGroupCriteriaType.startsWith,\n    values: [],\n  };\n\n  constructor(id: string, desc: Readonly<IStringColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 200,\n      })\n    );\n    this.alignment = desc.alignment ?? EAlignment.left;\n    this.escape = desc.escape !== false;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([StringColumn.EVENT_GROUPING_CHANGED, StringColumn.EVENT_FILTER_CHANGED]);\n  }\n\n  on(type: typeof StringColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_SC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof StringColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged_SC | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow): string | null {\n    const v: any = super.getValue(row);\n    return isMissingValue(v) ? null : String(v);\n  }\n\n  getLabel(row: IDataRow) {\n    return this.getValue(row) || '';\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    if (this.currentFilter instanceof RegExp) {\n      r.filter = `REGEX:${(this.currentFilter as RegExp).source}`;\n    } else {\n      r.filter = this.currentFilter;\n    }\n    if (this.currentGroupCriteria) {\n      const { type, values } = this.currentGroupCriteria;\n      r.groupCriteria = {\n        type,\n        values: values.map((value) =>\n          value instanceof RegExp && type === EStringGroupCriteriaType.regex ? value.source : value\n        ),\n      };\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.filter) {\n      const filter = dump.filter;\n      if (typeof filter === 'string') {\n        // compatibility case\n        if (filter.startsWith('REGEX:')) {\n          this.currentFilter = {\n            filter: new RegExp(filter.slice(6), 'm'),\n            filterMissing: false,\n          };\n        } else if (filter === StringColumn.FILTER_MISSING) {\n          this.currentFilter = {\n            filter: null,\n            filterMissing: true,\n          };\n        } else {\n          this.currentFilter = {\n            filter,\n            filterMissing: false,\n          };\n        }\n      } else {\n        this.currentFilter = {\n          filter:\n            filter.filter && (filter.filter as string).startsWith('REGEX:')\n              ? new RegExp(filter.slice(6), 'm')\n              : filter.filter || '',\n          filterMissing: filter.filterMissing === true,\n        };\n      }\n    } else {\n      this.currentFilter = null;\n    }\n\n    // tslint:disable-next-line: early-exit\n    if (dump.groupCriteria) {\n      const { type, values } = dump.groupCriteria as IStringGroupCriteria;\n      this.currentGroupCriteria = {\n        type,\n        values: values.map((value) =>\n          type === EStringGroupCriteriaType.regex ? new RegExp(value as string, 'm') : value\n        ),\n      };\n    }\n  }\n\n  isFiltered() {\n    return this.currentFilter != null;\n  }\n\n  filter(row: IDataRow) {\n    if (!this.isFiltered()) {\n      return true;\n    }\n    const r = this.getLabel(row);\n    const filter = this.currentFilter!;\n    const ff = filter.filter;\n\n    if (r == null || r.trim() === '') {\n      return !filter.filterMissing;\n    }\n    if (!ff) {\n      return true;\n    }\n    if (ff instanceof RegExp) {\n      return r !== '' && r.match(ff) != null; // You can not use RegExp.test(), because of https://stackoverflow.com/a/6891667\n    }\n    return r !== '' && r.toLowerCase().includes(ff.toLowerCase());\n  }\n\n  getFilter() {\n    return this.currentFilter;\n  }\n\n  setFilter(filter: IStringFilter | null) {\n    if (filter === this.currentFilter) {\n      return;\n    }\n    const current = this.currentFilter || { filter: null, filterMissing: false };\n    const target = filter || { filter: null, filterMissing: false };\n    if (\n      current.filterMissing === target.filterMissing &&\n      (current.filter === target.filter ||\n        (current.filter instanceof RegExp &&\n          target.filter instanceof RegExp &&\n          current.filter.source === target.filter.source))\n    ) {\n      return;\n    }\n    this.fire(\n      [StringColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.currentFilter,\n      (this.currentFilter = filter)\n    );\n  }\n\n  clearFilter() {\n    const was = this.isFiltered();\n    this.setFilter(null);\n    return was;\n  }\n\n  getGroupCriteria(): IStringGroupCriteria {\n    return this.currentGroupCriteria;\n  }\n\n  setGroupCriteria(value: IStringGroupCriteria) {\n    if (equal(this.currentGroupCriteria, value) || value == null) {\n      return;\n    }\n    const bak = this.getGroupCriteria();\n    this.currentGroupCriteria = value;\n    this.fire([StringColumn.EVENT_GROUPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, value);\n  }\n\n  group(row: IDataRow): IGroup {\n    if (this.getValue(row) == null) {\n      return Object.assign({}, missingGroup);\n    }\n\n    if (!this.currentGroupCriteria) {\n      return Object.assign({}, othersGroup);\n    }\n    const value = this.getLabel(row);\n\n    if (!value) {\n      return Object.assign({}, missingGroup);\n    }\n\n    const { type, values } = this.currentGroupCriteria;\n    if (type === EStringGroupCriteriaType.value) {\n      return {\n        name: value,\n        color: defaultGroup.color,\n      };\n    }\n    if (type === EStringGroupCriteriaType.startsWith) {\n      for (const groupValue of values) {\n        if (typeof groupValue !== 'string' || !value.startsWith(groupValue)) {\n          continue;\n        }\n        return {\n          name: groupValue,\n          color: defaultGroup.color,\n        };\n      }\n      return Object.assign({}, othersGroup);\n    }\n    for (const groupValue of values) {\n      if (!(groupValue instanceof RegExp) || !groupValue.test(value)) {\n        continue;\n      }\n      return {\n        name: groupValue.source,\n        color: defaultGroup.color,\n      };\n    }\n    return Object.assign({}, othersGroup);\n  }\n\n  toCompareValue(row: IDataRow) {\n    const v = this.getValue(row);\n    return v === '' || v == null ? null : v.toLowerCase();\n  }\n\n  toCompareValueType() {\n    return ECompareValueType.STRING;\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, _group: IGroup, valueCache?: ISequence<any>) {\n    if (isSeqEmpty(rows)) {\n      return null;\n    }\n    // take the smallest one\n    if (valueCache) {\n      return valueCache.reduce((acc, v) => (acc == null || v < acc ? v : acc), null as null | string);\n    }\n    return rows.reduce((acc, d) => {\n      const v = this.getValue(d);\n      return acc == null || (v != null && v < acc) ? v : acc;\n    }, null as null | string);\n  }\n\n  toCompareGroupValueType() {\n    return ECompareValueType.STRING;\n  }\n}\n","import Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport StringColumn from './StringColumn';\nimport type { IEventListener } from '../internal';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\n\n/**\n * emitted when the filter property changes\n * @asMemberOf AnnotateColumn\n * @event\n */\nexport declare function filterChanged_AC(previous: string | RegExp | null, current: string | RegExp | null): void;\n\n/**\n * emitted when the grouping property changes\n * @asMemberOf AnnotateColumn\n * @event\n */\nexport declare function groupingChanged_AC(previous: (RegExp | string)[][], current: (RegExp | string)[][]): void;\n\n/**\n * emitted when the value of a row changes\n * @asMemberOf AnnotateColumn\n * @event\n */\nexport declare function valueChanged(dataIndex: number, previous: string, current: string): void;\n\n/**\n * a string column in which the values can be edited locally\n */\nexport default class AnnotateColumn extends StringColumn {\n  static readonly EVENT_VALUE_CHANGED = 'valueChanged';\n\n  private readonly annotations = new Map<number, string>();\n\n  protected createEventList() {\n    return super.createEventList().concat([AnnotateColumn.EVENT_VALUE_CHANGED]);\n  }\n\n  on(type: typeof AnnotateColumn.EVENT_VALUE_CHANGED, listener: typeof valueChanged | null): this;\n  on(type: typeof StringColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_AC | null): this;\n  on(type: typeof StringColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged_AC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow) {\n    if (this.annotations.has(row.i)) {\n      return this.annotations.get(row.i)!;\n    }\n    return super.getValue(row);\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.annotations = {};\n    this.annotations.forEach((v, k) => {\n      r.annotations[k] = v;\n    });\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (!dump.annotations) {\n      return;\n    }\n    Object.keys(dump.annotations).forEach((k) => {\n      this.annotations.set(Number(k), dump.annotations[k]);\n    });\n  }\n\n  setValue(row: IDataRow, value: string) {\n    const old = this.getValue(row);\n    if (old === value) {\n      return true;\n    }\n    if (value === '' || value == null) {\n      this.annotations.delete(row.i);\n    } else {\n      this.annotations.set(row.i, value);\n    }\n    this.fire(\n      [AnnotateColumn.EVENT_VALUE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY],\n      row.i,\n      old,\n      value\n    );\n    return true;\n  }\n}\n","import { Category, toolbar } from './annotations';\nimport CategoricalColumn from './CategoricalColumn';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport type {\n  ICategoricalColumn,\n  ICategory,\n  ICategoricalColorMappingFunction,\n  ICategoricalFilter,\n} from './ICategoricalColumn';\nimport { IDataRow, ECompareValueType, IValueColumnDesc, ITypeFactory } from './interfaces';\nimport type { IEventListener } from '../internal';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\nimport { integrateDefaults } from './internal';\nimport { missingGroup } from './missing';\nimport { isCategoryIncluded, isEqualCategoricalFilter } from './internalCategorical';\n\nexport interface IBooleanDesc {\n  /**\n   * string to show for true\n   * @default ✓\n   */\n  trueMarker?: string;\n  /**\n   * string to show for false\n   * @default (empty)\n   */\n  falseMarker?: string;\n}\n\nexport declare type IBooleanColumnDesc = IValueColumnDesc<boolean> & IBooleanDesc;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf BooleanColumn\n * @event\n */\nexport declare function colorMappingChanged_BC(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf BooleanColumn\n * @event\n */\nexport declare function filterChanged_BC(previous: ICategoricalFilter | null, current: ICategoricalFilter | null): void;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'group', 'groupBy', 'filterCategorical', 'colorMappedCategorical')\n@Category('categorical')\nexport default class BooleanColumn extends ValueColumn<boolean> implements ICategoricalColumn {\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\n  static readonly EVENT_COLOR_MAPPING_CHANGED = 'colorMappingChanged';\n\n  static readonly GROUP_TRUE = { name: 'True', color: '#444444' };\n  static readonly GROUP_FALSE = { name: 'False', color: '#dddddd' };\n\n  private currentFilter: ICategoricalFilter | null = null;\n\n  private colorMapping: ICategoricalColorMappingFunction;\n  readonly categories: ICategory[];\n\n  constructor(id: string, desc: Readonly<IBooleanColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 30,\n        renderer: 'categorical',\n        groupRenderer: 'categorical',\n        summaryRenderer: 'categorical',\n      })\n    );\n    this.categories = [\n      {\n        name: desc.trueMarker ?? '✓',\n        color: BooleanColumn.GROUP_TRUE.color,\n        label: BooleanColumn.GROUP_TRUE.name,\n        value: 0,\n      },\n      {\n        name: desc.falseMarker ?? '',\n        color: BooleanColumn.GROUP_FALSE.color,\n        label: BooleanColumn.GROUP_FALSE.name,\n        value: 1,\n      },\n    ];\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([BooleanColumn.EVENT_COLOR_MAPPING_CHANGED, BooleanColumn.EVENT_FILTER_CHANGED]);\n  }\n\n  on(type: typeof BooleanColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_BC | null): this;\n  on(type: typeof BooleanColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_BC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  get dataLength() {\n    return this.categories.length;\n  }\n\n  get labels() {\n    return this.categories.map((d) => d.label);\n  }\n\n  getValue(row: IDataRow) {\n    const v: any = super.getValue(row);\n    if (typeof v === 'undefined' || v == null) {\n      return null;\n    }\n    return v === true || v === 'true' || v === 'yes' || v === 'x';\n  }\n\n  getCategoryOfBoolean(v: boolean | null) {\n    return v == null ? null : this.categories[v ? 0 : 1];\n  }\n\n  getCategory(row: IDataRow) {\n    const v = this.getValue(row);\n    return v == null ? null : this.categories[v ? 0 : 1];\n  }\n\n  getCategories(row: IDataRow) {\n    return [this.getCategory(row)];\n  }\n\n  iterCategory(row: IDataRow) {\n    return [this.getCategory(row)];\n  }\n\n  getColor(row: IDataRow) {\n    return CategoricalColumn.prototype.getColor.call(this, row);\n  }\n\n  getLabel(row: IDataRow) {\n    return CategoricalColumn.prototype.getLabel.call(this, row);\n  }\n\n  getLabels(row: IDataRow) {\n    return CategoricalColumn.prototype.getLabels.call(this, row);\n  }\n\n  getValues(row: IDataRow) {\n    return CategoricalColumn.prototype.getValues.call(this, row);\n  }\n\n  getMap(row: IDataRow) {\n    return CategoricalColumn.prototype.getMap.call(this, row);\n  }\n\n  getMapLabel(row: IDataRow) {\n    return CategoricalColumn.prototype.getMapLabel.call(this, row);\n  }\n\n  getSet(row: IDataRow) {\n    const v = this.getValue(row);\n    const r = new Set<ICategory>();\n    if (v != null) {\n      r.add(this.categories[v ? 0 : 1]);\n    }\n    return r;\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.colorMapping = this.colorMapping.toJSON();\n    if (this.currentFilter != null) {\n      r.filter = this.currentFilter;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\n    if (typeof dump.filter === 'boolean') {\n      this.currentFilter = {\n        filter: [this.getCategoryOfBoolean(dump.filter)!.name],\n        filterMissing: false,\n      };\n    } else if (typeof dump.filter !== 'undefined') {\n      this.currentFilter = dump.filter;\n    }\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY,\n      ],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  isFiltered() {\n    return this.currentFilter != null;\n  }\n\n  filter(row: IDataRow) {\n    return isCategoryIncluded(this.currentFilter, this.getCategory(row));\n  }\n\n  getFilter() {\n    return this.currentFilter == null ? null : Object.assign({}, this.currentFilter);\n  }\n\n  setFilter(filter: boolean | null | ICategoricalFilter) {\n    const f: ICategoricalFilter | null =\n      typeof filter === 'boolean'\n        ? { filter: [this.getCategoryOfBoolean(filter)!.name], filterMissing: false }\n        : filter;\n    if (isEqualCategoricalFilter(this.currentFilter, f)) {\n      return;\n    }\n    this.fire(\n      [BooleanColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.currentFilter,\n      (this.currentFilter = f)\n    );\n  }\n\n  clearFilter() {\n    const was = this.isFiltered();\n    this.setFilter(null);\n    return was;\n  }\n\n  toCompareValue(row: IDataRow) {\n    const v = this.getValue(row);\n    if (v == null) {\n      return NaN;\n    }\n    return v ? 1 : 0;\n  }\n\n  toCompareValueType(): ECompareValueType {\n    return ECompareValueType.BINARY;\n  }\n\n  group(row: IDataRow) {\n    const v = this.getValue(row);\n    if (v == null) {\n      return Object.assign({}, missingGroup);\n    }\n    return Object.assign({}, v ? BooleanColumn.GROUP_TRUE : BooleanColumn.GROUP_FALSE);\n  }\n}\n","import { Category } from './annotations';\nimport ValueColumn from './ValueColumn';\nimport { empty } from '../internal';\nimport type { IArrayColumn, IArrayDesc } from './IArrayColumn';\nimport type { IDataRow, IValueColumnDesc } from './interfaces';\n\nexport interface IArrayColumnDesc<T> extends IArrayDesc, IValueColumnDesc<T[]> {\n  // dummy\n}\n\n@Category('array')\nexport default class ArrayColumn<T> extends ValueColumn<T[]> implements IArrayColumn<T> {\n  private readonly _dataLength: number | null;\n\n  private readonly originalLabels: string[];\n\n  constructor(id: string, desc: Readonly<IArrayColumnDesc<T>>) {\n    super(id, desc);\n    this._dataLength = desc.dataLength == null || Number.isNaN(desc.dataLength) ? null : desc.dataLength;\n    this.originalLabels =\n      desc.labels || empty(this._dataLength == null ? 0 : this._dataLength).map((_d, i) => `Column ${i}`);\n  }\n\n  get labels() {\n    return this.originalLabels;\n  }\n\n  get dataLength() {\n    return this._dataLength;\n  }\n\n  getValue(row: IDataRow) {\n    const r = this.getValues(row);\n    return r.every((d) => d === null) ? null : r;\n  }\n\n  getValues(row: IDataRow) {\n    const r = super.getValue(row);\n    return r == null ? [] : r;\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getValues(row).map(String);\n  }\n\n  getLabel(row: IDataRow): string {\n    const v = this.getLabels(row);\n    if (v.length === 0) {\n      return '';\n    }\n    return v.toString();\n  }\n\n  getMap(row: IDataRow) {\n    const labels = this.labels;\n    return this.getValues(row).map((value, i) => ({ key: labels[i], value }));\n  }\n\n  getMapLabel(row: IDataRow) {\n    const labels = this.labels;\n    return this.getLabels(row).map((value, i) => ({ key: labels[i], value }));\n  }\n}\n","import ArrayColumn, { IArrayColumnDesc } from './ArrayColumn';\nimport type { ISetColumn, ICategoricalColorMappingFunction } from './ICategoricalColumn';\nimport type { IDataRow, ITypeFactory, ECompareValueType } from './interfaces';\nimport CategoricalColumn from './CategoricalColumn';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\nimport type ValueColumn from './ValueColumn';\nimport type { dataLoaded } from './ValueColumn';\nimport {\n  DEFAULT_COLOR,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n  dirtyCaches,\n} from './Column';\nimport type Column from './Column';\nimport type { IEventListener } from '../internal';\nimport { chooseUIntByDataLength, integrateDefaults } from './internal';\nimport { toCategory } from './internalCategorical';\nimport { toolbar } from './annotations';\n\nexport declare type IBooleansColumnDesc = IArrayColumnDesc<boolean>;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf BooleansColumn\n * @event\n */\nexport declare function colorMappingChanged_BCS(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n@toolbar('rename', 'clone', 'sort', 'sortBy')\nexport default class BooleansColumn extends ArrayColumn<boolean> implements ISetColumn {\n  static readonly EVENT_COLOR_MAPPING_CHANGED = CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  private colorMapping: ICategoricalColorMappingFunction;\n\n  constructor(id: string, desc: Readonly<IBooleansColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'upset',\n      })\n    );\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n\n  get categories() {\n    return this.labels.map((d, i) => toCategory(d, i));\n  }\n\n  getSet(row: IDataRow) {\n    const vs = this.getValues(row);\n    return new Set(this.categories.filter((_, i) => vs[i]));\n  }\n\n  toCompareValue(row: IDataRow) {\n    const v = this.getValue(row);\n    if (v == null) {\n      return NaN;\n    }\n    return v.reduce((a, b) => a + (b ? 1 : 0), 0);\n  }\n\n  toCompareValueType(): ECompareValueType {\n    return chooseUIntByDataLength(this.dataLength);\n  }\n\n  getCategories(row: IDataRow) {\n    const categories = this.categories;\n    return super.getValues(row).map((v, i) => {\n      return v ? categories[i]! : null;\n    });\n  }\n\n  iterCategory(row: IDataRow) {\n    return this.getCategories(row);\n  }\n\n  getColors(row: IDataRow) {\n    return this.getCategories(row).map((d) => (d ? this.colorMapping.apply(d) : DEFAULT_COLOR));\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([BooleansColumn.EVENT_COLOR_MAPPING_CHANGED]);\n  }\n\n  on(type: typeof BooleansColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_BCS | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    return CategoricalColumn.prototype.setColorMapping.call(this, mapping);\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\n  }\n}\n","export default function(x) {\n  return Math.abs(x = Math.round(x)) >= 1e21\n      ? x.toLocaleString(\"en\").replace(/,/g, \"\")\n      : x.toString(10);\n}\n\n// Computes the decimal coefficient and exponent of the specified number x with\n// significant digits p, where x is positive and p is in [1, 21] or undefined.\n// For example, formatDecimalParts(1.23) returns [\"123\", 0].\nexport function formatDecimalParts(x, p) {\n  if ((i = (x = p ? x.toExponential(p - 1) : x.toExponential()).indexOf(\"e\")) < 0) return null; // NaN, ±Infinity\n  var i, coefficient = x.slice(0, i);\n\n  // The string returned by toExponential either has the form \\d\\.\\d+e[-+]\\d+\n  // (e.g., 1.2e+3) or the form \\de[-+]\\d+ (e.g., 1e+3).\n  return [\n    coefficient.length > 1 ? coefficient[0] + coefficient.slice(2) : coefficient,\n    +x.slice(i + 1)\n  ];\n}\n","import {formatDecimalParts} from \"./formatDecimal.js\";\n\nexport default function(x) {\n  return x = formatDecimalParts(Math.abs(x)), x ? x[1] : NaN;\n}\n","// [[fill]align][sign][symbol][0][width][,][.precision][~][type]\nvar re = /^(?:(.)?([<>=^]))?([+\\-( ])?([$#])?(0)?(\\d+)?(,)?(\\.\\d+)?(~)?([a-z%])?$/i;\n\nexport default function formatSpecifier(specifier) {\n  if (!(match = re.exec(specifier))) throw new Error(\"invalid format: \" + specifier);\n  var match;\n  return new FormatSpecifier({\n    fill: match[1],\n    align: match[2],\n    sign: match[3],\n    symbol: match[4],\n    zero: match[5],\n    width: match[6],\n    comma: match[7],\n    precision: match[8] && match[8].slice(1),\n    trim: match[9],\n    type: match[10]\n  });\n}\n\nformatSpecifier.prototype = FormatSpecifier.prototype; // instanceof\n\nexport function FormatSpecifier(specifier) {\n  this.fill = specifier.fill === undefined ? \" \" : specifier.fill + \"\";\n  this.align = specifier.align === undefined ? \">\" : specifier.align + \"\";\n  this.sign = specifier.sign === undefined ? \"-\" : specifier.sign + \"\";\n  this.symbol = specifier.symbol === undefined ? \"\" : specifier.symbol + \"\";\n  this.zero = !!specifier.zero;\n  this.width = specifier.width === undefined ? undefined : +specifier.width;\n  this.comma = !!specifier.comma;\n  this.precision = specifier.precision === undefined ? undefined : +specifier.precision;\n  this.trim = !!specifier.trim;\n  this.type = specifier.type === undefined ? \"\" : specifier.type + \"\";\n}\n\nFormatSpecifier.prototype.toString = function() {\n  return this.fill\n      + this.align\n      + this.sign\n      + this.symbol\n      + (this.zero ? \"0\" : \"\")\n      + (this.width === undefined ? \"\" : Math.max(1, this.width | 0))\n      + (this.comma ? \",\" : \"\")\n      + (this.precision === undefined ? \"\" : \".\" + Math.max(0, this.precision | 0))\n      + (this.trim ? \"~\" : \"\")\n      + this.type;\n};\n","import {formatDecimalParts} from \"./formatDecimal.js\";\n\nexport var prefixExponent;\n\nexport default function(x, p) {\n  var d = formatDecimalParts(x, p);\n  if (!d) return x + \"\";\n  var coefficient = d[0],\n      exponent = d[1],\n      i = exponent - (prefixExponent = Math.max(-8, Math.min(8, Math.floor(exponent / 3))) * 3) + 1,\n      n = coefficient.length;\n  return i === n ? coefficient\n      : i > n ? coefficient + new Array(i - n + 1).join(\"0\")\n      : i > 0 ? coefficient.slice(0, i) + \".\" + coefficient.slice(i)\n      : \"0.\" + new Array(1 - i).join(\"0\") + formatDecimalParts(x, Math.max(0, p + i - 1))[0]; // less than 1y!\n}\n","import {formatDecimalParts} from \"./formatDecimal.js\";\n\nexport default function(x, p) {\n  var d = formatDecimalParts(x, p);\n  if (!d) return x + \"\";\n  var coefficient = d[0],\n      exponent = d[1];\n  return exponent < 0 ? \"0.\" + new Array(-exponent).join(\"0\") + coefficient\n      : coefficient.length > exponent + 1 ? coefficient.slice(0, exponent + 1) + \".\" + coefficient.slice(exponent + 1)\n      : coefficient + new Array(exponent - coefficient.length + 2).join(\"0\");\n}\n","import formatDecimal from \"./formatDecimal.js\";\nimport formatPrefixAuto from \"./formatPrefixAuto.js\";\nimport formatRounded from \"./formatRounded.js\";\n\nexport default {\n  \"%\": (x, p) => (x * 100).toFixed(p),\n  \"b\": (x) => Math.round(x).toString(2),\n  \"c\": (x) => x + \"\",\n  \"d\": formatDecimal,\n  \"e\": (x, p) => x.toExponential(p),\n  \"f\": (x, p) => x.toFixed(p),\n  \"g\": (x, p) => x.toPrecision(p),\n  \"o\": (x) => Math.round(x).toString(8),\n  \"p\": (x, p) => formatRounded(x * 100, p),\n  \"r\": formatRounded,\n  \"s\": formatPrefixAuto,\n  \"X\": (x) => Math.round(x).toString(16).toUpperCase(),\n  \"x\": (x) => Math.round(x).toString(16)\n};\n","export default function(x) {\n  return x;\n}\n","import exponent from \"./exponent.js\";\nimport formatGroup from \"./formatGroup.js\";\nimport formatNumerals from \"./formatNumerals.js\";\nimport formatSpecifier from \"./formatSpecifier.js\";\nimport formatTrim from \"./formatTrim.js\";\nimport formatTypes from \"./formatTypes.js\";\nimport {prefixExponent} from \"./formatPrefixAuto.js\";\nimport identity from \"./identity.js\";\n\nvar map = Array.prototype.map,\n    prefixes = [\"y\",\"z\",\"a\",\"f\",\"p\",\"n\",\"µ\",\"m\",\"\",\"k\",\"M\",\"G\",\"T\",\"P\",\"E\",\"Z\",\"Y\"];\n\nexport default function(locale) {\n  var group = locale.grouping === undefined || locale.thousands === undefined ? identity : formatGroup(map.call(locale.grouping, Number), locale.thousands + \"\"),\n      currencyPrefix = locale.currency === undefined ? \"\" : locale.currency[0] + \"\",\n      currencySuffix = locale.currency === undefined ? \"\" : locale.currency[1] + \"\",\n      decimal = locale.decimal === undefined ? \".\" : locale.decimal + \"\",\n      numerals = locale.numerals === undefined ? identity : formatNumerals(map.call(locale.numerals, String)),\n      percent = locale.percent === undefined ? \"%\" : locale.percent + \"\",\n      minus = locale.minus === undefined ? \"−\" : locale.minus + \"\",\n      nan = locale.nan === undefined ? \"NaN\" : locale.nan + \"\";\n\n  function newFormat(specifier) {\n    specifier = formatSpecifier(specifier);\n\n    var fill = specifier.fill,\n        align = specifier.align,\n        sign = specifier.sign,\n        symbol = specifier.symbol,\n        zero = specifier.zero,\n        width = specifier.width,\n        comma = specifier.comma,\n        precision = specifier.precision,\n        trim = specifier.trim,\n        type = specifier.type;\n\n    // The \"n\" type is an alias for \",g\".\n    if (type === \"n\") comma = true, type = \"g\";\n\n    // The \"\" type, and any invalid type, is an alias for \".12~g\".\n    else if (!formatTypes[type]) precision === undefined && (precision = 12), trim = true, type = \"g\";\n\n    // If zero fill is specified, padding goes after sign and before digits.\n    if (zero || (fill === \"0\" && align === \"=\")) zero = true, fill = \"0\", align = \"=\";\n\n    // Compute the prefix and suffix.\n    // For SI-prefix, the suffix is lazily computed.\n    var prefix = symbol === \"$\" ? currencyPrefix : symbol === \"#\" && /[boxX]/.test(type) ? \"0\" + type.toLowerCase() : \"\",\n        suffix = symbol === \"$\" ? currencySuffix : /[%p]/.test(type) ? percent : \"\";\n\n    // What format function should we use?\n    // Is this an integer type?\n    // Can this type generate exponential notation?\n    var formatType = formatTypes[type],\n        maybeSuffix = /[defgprs%]/.test(type);\n\n    // Set the default precision if not specified,\n    // or clamp the specified precision to the supported range.\n    // For significant precision, it must be in [1, 21].\n    // For fixed precision, it must be in [0, 20].\n    precision = precision === undefined ? 6\n        : /[gprs]/.test(type) ? Math.max(1, Math.min(21, precision))\n        : Math.max(0, Math.min(20, precision));\n\n    function format(value) {\n      var valuePrefix = prefix,\n          valueSuffix = suffix,\n          i, n, c;\n\n      if (type === \"c\") {\n        valueSuffix = formatType(value) + valueSuffix;\n        value = \"\";\n      } else {\n        value = +value;\n\n        // Determine the sign. -0 is not less than 0, but 1 / -0 is!\n        var valueNegative = value < 0 || 1 / value < 0;\n\n        // Perform the initial formatting.\n        value = isNaN(value) ? nan : formatType(Math.abs(value), precision);\n\n        // Trim insignificant zeros.\n        if (trim) value = formatTrim(value);\n\n        // If a negative value rounds to zero after formatting, and no explicit positive sign is requested, hide the sign.\n        if (valueNegative && +value === 0 && sign !== \"+\") valueNegative = false;\n\n        // Compute the prefix and suffix.\n        valuePrefix = (valueNegative ? (sign === \"(\" ? sign : minus) : sign === \"-\" || sign === \"(\" ? \"\" : sign) + valuePrefix;\n        valueSuffix = (type === \"s\" ? prefixes[8 + prefixExponent / 3] : \"\") + valueSuffix + (valueNegative && sign === \"(\" ? \")\" : \"\");\n\n        // Break the formatted value into the integer “value” part that can be\n        // grouped, and fractional or exponential “suffix” part that is not.\n        if (maybeSuffix) {\n          i = -1, n = value.length;\n          while (++i < n) {\n            if (c = value.charCodeAt(i), 48 > c || c > 57) {\n              valueSuffix = (c === 46 ? decimal + value.slice(i + 1) : value.slice(i)) + valueSuffix;\n              value = value.slice(0, i);\n              break;\n            }\n          }\n        }\n      }\n\n      // If the fill character is not \"0\", grouping is applied before padding.\n      if (comma && !zero) value = group(value, Infinity);\n\n      // Compute the padding.\n      var length = valuePrefix.length + value.length + valueSuffix.length,\n          padding = length < width ? new Array(width - length + 1).join(fill) : \"\";\n\n      // If the fill character is \"0\", grouping is applied after padding.\n      if (comma && zero) value = group(padding + value, padding.length ? width - valueSuffix.length : Infinity), padding = \"\";\n\n      // Reconstruct the final output based on the desired alignment.\n      switch (align) {\n        case \"<\": value = valuePrefix + value + valueSuffix + padding; break;\n        case \"=\": value = valuePrefix + padding + value + valueSuffix; break;\n        case \"^\": value = padding.slice(0, length = padding.length >> 1) + valuePrefix + value + valueSuffix + padding.slice(length); break;\n        default: value = padding + valuePrefix + value + valueSuffix; break;\n      }\n\n      return numerals(value);\n    }\n\n    format.toString = function() {\n      return specifier + \"\";\n    };\n\n    return format;\n  }\n\n  function formatPrefix(specifier, value) {\n    var f = newFormat((specifier = formatSpecifier(specifier), specifier.type = \"f\", specifier)),\n        e = Math.max(-8, Math.min(8, Math.floor(exponent(value) / 3))) * 3,\n        k = Math.pow(10, -e),\n        prefix = prefixes[8 + e / 3];\n    return function(value) {\n      return f(k * value) + prefix;\n    };\n  }\n\n  return {\n    format: newFormat,\n    formatPrefix: formatPrefix\n  };\n}\n","import formatLocale from \"./locale.js\";\n\nvar locale;\nexport var format;\nexport var formatPrefix;\n\ndefaultLocale({\n  thousands: \",\",\n  grouping: [3],\n  currency: [\"$\", \"\"]\n});\n\nexport default function defaultLocale(definition) {\n  locale = formatLocale(definition);\n  format = locale.format;\n  formatPrefix = locale.formatPrefix;\n  return locale;\n}\n","export default function(grouping, thousands) {\n  return function(value, width) {\n    var i = value.length,\n        t = [],\n        j = 0,\n        g = grouping[0],\n        length = 0;\n\n    while (i > 0 && g > 0) {\n      if (length + g + 1 > width) g = Math.max(1, width - length);\n      t.push(value.substring(i -= g, i + g));\n      if ((length += g + 1) > width) break;\n      g = grouping[j = (j + 1) % grouping.length];\n    }\n\n    return t.reverse().join(thousands);\n  };\n}\n","export default function(numerals) {\n  return function(value) {\n    return value.replace(/[0-9]/g, function(i) {\n      return numerals[+i];\n    });\n  };\n}\n","// Trims insignificant zeros, e.g., replaces 1.2000k with 1.2k.\nexport default function(s) {\n  out: for (var n = s.length, i = 1, i0 = -1, i1; i < n; ++i) {\n    switch (s[i]) {\n      case \".\": i0 = i1 = i; break;\n      case \"0\": if (i0 === 0) i0 = i; i1 = i; break;\n      default: if (!+s[i]) break out; if (i0 > 0) i0 = 0; break;\n    }\n  }\n  return i0 > 0 ? s.slice(0, i0) + s.slice(i1 + 1) : s;\n}\n","var e10 = Math.sqrt(50),\n    e5 = Math.sqrt(10),\n    e2 = Math.sqrt(2);\n\nexport default function(start, stop, count) {\n  var reverse,\n      i = -1,\n      n,\n      ticks,\n      step;\n\n  stop = +stop, start = +start, count = +count;\n  if (start === stop && count > 0) return [start];\n  if (reverse = stop < start) n = start, start = stop, stop = n;\n  if ((step = tickIncrement(start, stop, count)) === 0 || !isFinite(step)) return [];\n\n  if (step > 0) {\n    let r0 = Math.round(start / step), r1 = Math.round(stop / step);\n    if (r0 * step < start) ++r0;\n    if (r1 * step > stop) --r1;\n    ticks = new Array(n = r1 - r0 + 1);\n    while (++i < n) ticks[i] = (r0 + i) * step;\n  } else {\n    step = -step;\n    let r0 = Math.round(start * step), r1 = Math.round(stop * step);\n    if (r0 / step < start) ++r0;\n    if (r1 / step > stop) --r1;\n    ticks = new Array(n = r1 - r0 + 1);\n    while (++i < n) ticks[i] = (r0 + i) / step;\n  }\n\n  if (reverse) ticks.reverse();\n\n  return ticks;\n}\n\nexport function tickIncrement(start, stop, count) {\n  var step = (stop - start) / Math.max(0, count),\n      power = Math.floor(Math.log(step) / Math.LN10),\n      error = step / Math.pow(10, power);\n  return power >= 0\n      ? (error >= e10 ? 10 : error >= e5 ? 5 : error >= e2 ? 2 : 1) * Math.pow(10, power)\n      : -Math.pow(10, -power) / (error >= e10 ? 10 : error >= e5 ? 5 : error >= e2 ? 2 : 1);\n}\n\nexport function tickStep(start, stop, count) {\n  var step0 = Math.abs(stop - start) / Math.max(0, count),\n      step1 = Math.pow(10, Math.floor(Math.log(step0) / Math.LN10)),\n      error = step0 / step1;\n  if (error >= e10) step1 *= 10;\n  else if (error >= e5) step1 *= 5;\n  else if (error >= e2) step1 *= 2;\n  return stop < start ? -step1 : step1;\n}\n","export default function(a, b) {\n  return a < b ? -1 : a > b ? 1 : a >= b ? 0 : NaN;\n}\n","import ascending from \"./ascending.js\";\n\nexport default function(f) {\n  let delta = f;\n  let compare = f;\n\n  if (f.length === 1) {\n    delta = (d, x) => f(d) - x;\n    compare = ascendingComparator(f);\n  }\n\n  function left(a, x, lo, hi) {\n    if (lo == null) lo = 0;\n    if (hi == null) hi = a.length;\n    while (lo < hi) {\n      const mid = (lo + hi) >>> 1;\n      if (compare(a[mid], x) < 0) lo = mid + 1;\n      else hi = mid;\n    }\n    return lo;\n  }\n\n  function right(a, x, lo, hi) {\n    if (lo == null) lo = 0;\n    if (hi == null) hi = a.length;\n    while (lo < hi) {\n      const mid = (lo + hi) >>> 1;\n      if (compare(a[mid], x) > 0) hi = mid;\n      else lo = mid + 1;\n    }\n    return lo;\n  }\n\n  function center(a, x, lo, hi) {\n    if (lo == null) lo = 0;\n    if (hi == null) hi = a.length;\n    const i = left(a, x, lo, hi - 1);\n    return i > lo && delta(a[i - 1], x) > -delta(a[i], x) ? i - 1 : i;\n  }\n\n  return {left, center, right};\n}\n\nfunction ascendingComparator(f) {\n  return (d, x) => ascending(f(d), x);\n}\n","import ascending from \"./ascending.js\";\nimport bisector from \"./bisector.js\";\nimport number from \"./number.js\";\n\nconst ascendingBisect = bisector(ascending);\nexport const bisectRight = ascendingBisect.right;\nexport const bisectLeft = ascendingBisect.left;\nexport const bisectCenter = bisector(number).center;\nexport default bisectRight;\n","export default function(x) {\n  return x === null ? NaN : +x;\n}\n\nexport function* numbers(values, valueof) {\n  if (valueof === undefined) {\n    for (let value of values) {\n      if (value != null && (value = +value) >= value) {\n        yield value;\n      }\n    }\n  } else {\n    let index = -1;\n    for (let value of values) {\n      if ((value = valueof(value, ++index, values)) != null && (value = +value) >= value) {\n        yield value;\n      }\n    }\n  }\n}\n","export default function(constructor, factory, prototype) {\n  constructor.prototype = factory.prototype = prototype;\n  prototype.constructor = constructor;\n}\n\nexport function extend(parent, definition) {\n  var prototype = Object.create(parent.prototype);\n  for (var key in definition) prototype[key] = definition[key];\n  return prototype;\n}\n","import define, {extend} from \"./define.js\";\n\nexport function Color() {}\n\nexport var darker = 0.7;\nexport var brighter = 1 / darker;\n\nvar reI = \"\\\\s*([+-]?\\\\d+)\\\\s*\",\n    reN = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*\",\n    reP = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*\",\n    reHex = /^#([0-9a-f]{3,8})$/,\n    reRgbInteger = new RegExp(\"^rgb\\\\(\" + [reI, reI, reI] + \"\\\\)$\"),\n    reRgbPercent = new RegExp(\"^rgb\\\\(\" + [reP, reP, reP] + \"\\\\)$\"),\n    reRgbaInteger = new RegExp(\"^rgba\\\\(\" + [reI, reI, reI, reN] + \"\\\\)$\"),\n    reRgbaPercent = new RegExp(\"^rgba\\\\(\" + [reP, reP, reP, reN] + \"\\\\)$\"),\n    reHslPercent = new RegExp(\"^hsl\\\\(\" + [reN, reP, reP] + \"\\\\)$\"),\n    reHslaPercent = new RegExp(\"^hsla\\\\(\" + [reN, reP, reP, reN] + \"\\\\)$\");\n\nvar named = {\n  aliceblue: 0xf0f8ff,\n  antiquewhite: 0xfaebd7,\n  aqua: 0x00ffff,\n  aquamarine: 0x7fffd4,\n  azure: 0xf0ffff,\n  beige: 0xf5f5dc,\n  bisque: 0xffe4c4,\n  black: 0x000000,\n  blanchedalmond: 0xffebcd,\n  blue: 0x0000ff,\n  blueviolet: 0x8a2be2,\n  brown: 0xa52a2a,\n  burlywood: 0xdeb887,\n  cadetblue: 0x5f9ea0,\n  chartreuse: 0x7fff00,\n  chocolate: 0xd2691e,\n  coral: 0xff7f50,\n  cornflowerblue: 0x6495ed,\n  cornsilk: 0xfff8dc,\n  crimson: 0xdc143c,\n  cyan: 0x00ffff,\n  darkblue: 0x00008b,\n  darkcyan: 0x008b8b,\n  darkgoldenrod: 0xb8860b,\n  darkgray: 0xa9a9a9,\n  darkgreen: 0x006400,\n  darkgrey: 0xa9a9a9,\n  darkkhaki: 0xbdb76b,\n  darkmagenta: 0x8b008b,\n  darkolivegreen: 0x556b2f,\n  darkorange: 0xff8c00,\n  darkorchid: 0x9932cc,\n  darkred: 0x8b0000,\n  darksalmon: 0xe9967a,\n  darkseagreen: 0x8fbc8f,\n  darkslateblue: 0x483d8b,\n  darkslategray: 0x2f4f4f,\n  darkslategrey: 0x2f4f4f,\n  darkturquoise: 0x00ced1,\n  darkviolet: 0x9400d3,\n  deeppink: 0xff1493,\n  deepskyblue: 0x00bfff,\n  dimgray: 0x696969,\n  dimgrey: 0x696969,\n  dodgerblue: 0x1e90ff,\n  firebrick: 0xb22222,\n  floralwhite: 0xfffaf0,\n  forestgreen: 0x228b22,\n  fuchsia: 0xff00ff,\n  gainsboro: 0xdcdcdc,\n  ghostwhite: 0xf8f8ff,\n  gold: 0xffd700,\n  goldenrod: 0xdaa520,\n  gray: 0x808080,\n  green: 0x008000,\n  greenyellow: 0xadff2f,\n  grey: 0x808080,\n  honeydew: 0xf0fff0,\n  hotpink: 0xff69b4,\n  indianred: 0xcd5c5c,\n  indigo: 0x4b0082,\n  ivory: 0xfffff0,\n  khaki: 0xf0e68c,\n  lavender: 0xe6e6fa,\n  lavenderblush: 0xfff0f5,\n  lawngreen: 0x7cfc00,\n  lemonchiffon: 0xfffacd,\n  lightblue: 0xadd8e6,\n  lightcoral: 0xf08080,\n  lightcyan: 0xe0ffff,\n  lightgoldenrodyellow: 0xfafad2,\n  lightgray: 0xd3d3d3,\n  lightgreen: 0x90ee90,\n  lightgrey: 0xd3d3d3,\n  lightpink: 0xffb6c1,\n  lightsalmon: 0xffa07a,\n  lightseagreen: 0x20b2aa,\n  lightskyblue: 0x87cefa,\n  lightslategray: 0x778899,\n  lightslategrey: 0x778899,\n  lightsteelblue: 0xb0c4de,\n  lightyellow: 0xffffe0,\n  lime: 0x00ff00,\n  limegreen: 0x32cd32,\n  linen: 0xfaf0e6,\n  magenta: 0xff00ff,\n  maroon: 0x800000,\n  mediumaquamarine: 0x66cdaa,\n  mediumblue: 0x0000cd,\n  mediumorchid: 0xba55d3,\n  mediumpurple: 0x9370db,\n  mediumseagreen: 0x3cb371,\n  mediumslateblue: 0x7b68ee,\n  mediumspringgreen: 0x00fa9a,\n  mediumturquoise: 0x48d1cc,\n  mediumvioletred: 0xc71585,\n  midnightblue: 0x191970,\n  mintcream: 0xf5fffa,\n  mistyrose: 0xffe4e1,\n  moccasin: 0xffe4b5,\n  navajowhite: 0xffdead,\n  navy: 0x000080,\n  oldlace: 0xfdf5e6,\n  olive: 0x808000,\n  olivedrab: 0x6b8e23,\n  orange: 0xffa500,\n  orangered: 0xff4500,\n  orchid: 0xda70d6,\n  palegoldenrod: 0xeee8aa,\n  palegreen: 0x98fb98,\n  paleturquoise: 0xafeeee,\n  palevioletred: 0xdb7093,\n  papayawhip: 0xffefd5,\n  peachpuff: 0xffdab9,\n  peru: 0xcd853f,\n  pink: 0xffc0cb,\n  plum: 0xdda0dd,\n  powderblue: 0xb0e0e6,\n  purple: 0x800080,\n  rebeccapurple: 0x663399,\n  red: 0xff0000,\n  rosybrown: 0xbc8f8f,\n  royalblue: 0x4169e1,\n  saddlebrown: 0x8b4513,\n  salmon: 0xfa8072,\n  sandybrown: 0xf4a460,\n  seagreen: 0x2e8b57,\n  seashell: 0xfff5ee,\n  sienna: 0xa0522d,\n  silver: 0xc0c0c0,\n  skyblue: 0x87ceeb,\n  slateblue: 0x6a5acd,\n  slategray: 0x708090,\n  slategrey: 0x708090,\n  snow: 0xfffafa,\n  springgreen: 0x00ff7f,\n  steelblue: 0x4682b4,\n  tan: 0xd2b48c,\n  teal: 0x008080,\n  thistle: 0xd8bfd8,\n  tomato: 0xff6347,\n  turquoise: 0x40e0d0,\n  violet: 0xee82ee,\n  wheat: 0xf5deb3,\n  white: 0xffffff,\n  whitesmoke: 0xf5f5f5,\n  yellow: 0xffff00,\n  yellowgreen: 0x9acd32\n};\n\ndefine(Color, color, {\n  copy: function(channels) {\n    return Object.assign(new this.constructor, this, channels);\n  },\n  displayable: function() {\n    return this.rgb().displayable();\n  },\n  hex: color_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: color_formatHex,\n  formatHsl: color_formatHsl,\n  formatRgb: color_formatRgb,\n  toString: color_formatRgb\n});\n\nfunction color_formatHex() {\n  return this.rgb().formatHex();\n}\n\nfunction color_formatHsl() {\n  return hslConvert(this).formatHsl();\n}\n\nfunction color_formatRgb() {\n  return this.rgb().formatRgb();\n}\n\nexport default function color(format) {\n  var m, l;\n  format = (format + \"\").trim().toLowerCase();\n  return (m = reHex.exec(format)) ? (l = m[1].length, m = parseInt(m[1], 16), l === 6 ? rgbn(m) // #ff0000\n      : l === 3 ? new Rgb((m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), ((m & 0xf) << 4) | (m & 0xf), 1) // #f00\n      : l === 8 ? rgba(m >> 24 & 0xff, m >> 16 & 0xff, m >> 8 & 0xff, (m & 0xff) / 0xff) // #ff000000\n      : l === 4 ? rgba((m >> 12 & 0xf) | (m >> 8 & 0xf0), (m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), (((m & 0xf) << 4) | (m & 0xf)) / 0xff) // #f000\n      : null) // invalid hex\n      : (m = reRgbInteger.exec(format)) ? new Rgb(m[1], m[2], m[3], 1) // rgb(255, 0, 0)\n      : (m = reRgbPercent.exec(format)) ? new Rgb(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, 1) // rgb(100%, 0%, 0%)\n      : (m = reRgbaInteger.exec(format)) ? rgba(m[1], m[2], m[3], m[4]) // rgba(255, 0, 0, 1)\n      : (m = reRgbaPercent.exec(format)) ? rgba(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, m[4]) // rgb(100%, 0%, 0%, 1)\n      : (m = reHslPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, 1) // hsl(120, 50%, 50%)\n      : (m = reHslaPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, m[4]) // hsla(120, 50%, 50%, 1)\n      : named.hasOwnProperty(format) ? rgbn(named[format]) // eslint-disable-line no-prototype-builtins\n      : format === \"transparent\" ? new Rgb(NaN, NaN, NaN, 0)\n      : null;\n}\n\nfunction rgbn(n) {\n  return new Rgb(n >> 16 & 0xff, n >> 8 & 0xff, n & 0xff, 1);\n}\n\nfunction rgba(r, g, b, a) {\n  if (a <= 0) r = g = b = NaN;\n  return new Rgb(r, g, b, a);\n}\n\nexport function rgbConvert(o) {\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Rgb;\n  o = o.rgb();\n  return new Rgb(o.r, o.g, o.b, o.opacity);\n}\n\nexport function rgb(r, g, b, opacity) {\n  return arguments.length === 1 ? rgbConvert(r) : new Rgb(r, g, b, opacity == null ? 1 : opacity);\n}\n\nexport function Rgb(r, g, b, opacity) {\n  this.r = +r;\n  this.g = +g;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Rgb, rgb, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  rgb: function() {\n    return this;\n  },\n  displayable: function() {\n    return (-0.5 <= this.r && this.r < 255.5)\n        && (-0.5 <= this.g && this.g < 255.5)\n        && (-0.5 <= this.b && this.b < 255.5)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  hex: rgb_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: rgb_formatHex,\n  formatRgb: rgb_formatRgb,\n  toString: rgb_formatRgb\n}));\n\nfunction rgb_formatHex() {\n  return \"#\" + hex(this.r) + hex(this.g) + hex(this.b);\n}\n\nfunction rgb_formatRgb() {\n  var a = this.opacity; a = isNaN(a) ? 1 : Math.max(0, Math.min(1, a));\n  return (a === 1 ? \"rgb(\" : \"rgba(\")\n      + Math.max(0, Math.min(255, Math.round(this.r) || 0)) + \", \"\n      + Math.max(0, Math.min(255, Math.round(this.g) || 0)) + \", \"\n      + Math.max(0, Math.min(255, Math.round(this.b) || 0))\n      + (a === 1 ? \")\" : \", \" + a + \")\");\n}\n\nfunction hex(value) {\n  value = Math.max(0, Math.min(255, Math.round(value) || 0));\n  return (value < 16 ? \"0\" : \"\") + value.toString(16);\n}\n\nfunction hsla(h, s, l, a) {\n  if (a <= 0) h = s = l = NaN;\n  else if (l <= 0 || l >= 1) h = s = NaN;\n  else if (s <= 0) h = NaN;\n  return new Hsl(h, s, l, a);\n}\n\nexport function hslConvert(o) {\n  if (o instanceof Hsl) return new Hsl(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Hsl;\n  if (o instanceof Hsl) return o;\n  o = o.rgb();\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      min = Math.min(r, g, b),\n      max = Math.max(r, g, b),\n      h = NaN,\n      s = max - min,\n      l = (max + min) / 2;\n  if (s) {\n    if (r === max) h = (g - b) / s + (g < b) * 6;\n    else if (g === max) h = (b - r) / s + 2;\n    else h = (r - g) / s + 4;\n    s /= l < 0.5 ? max + min : 2 - max - min;\n    h *= 60;\n  } else {\n    s = l > 0 && l < 1 ? 0 : h;\n  }\n  return new Hsl(h, s, l, o.opacity);\n}\n\nexport function hsl(h, s, l, opacity) {\n  return arguments.length === 1 ? hslConvert(h) : new Hsl(h, s, l, opacity == null ? 1 : opacity);\n}\n\nfunction Hsl(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Hsl, hsl, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb: function() {\n    var h = this.h % 360 + (this.h < 0) * 360,\n        s = isNaN(h) || isNaN(this.s) ? 0 : this.s,\n        l = this.l,\n        m2 = l + (l < 0.5 ? l : 1 - l) * s,\n        m1 = 2 * l - m2;\n    return new Rgb(\n      hsl2rgb(h >= 240 ? h - 240 : h + 120, m1, m2),\n      hsl2rgb(h, m1, m2),\n      hsl2rgb(h < 120 ? h + 240 : h - 120, m1, m2),\n      this.opacity\n    );\n  },\n  displayable: function() {\n    return (0 <= this.s && this.s <= 1 || isNaN(this.s))\n        && (0 <= this.l && this.l <= 1)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  formatHsl: function() {\n    var a = this.opacity; a = isNaN(a) ? 1 : Math.max(0, Math.min(1, a));\n    return (a === 1 ? \"hsl(\" : \"hsla(\")\n        + (this.h || 0) + \", \"\n        + (this.s || 0) * 100 + \"%, \"\n        + (this.l || 0) * 100 + \"%\"\n        + (a === 1 ? \")\" : \", \" + a + \")\");\n  }\n}));\n\n/* From FvD 13.37, CSS Color Module Level 3 */\nfunction hsl2rgb(h, m1, m2) {\n  return (h < 60 ? m1 + (m2 - m1) * h / 60\n      : h < 180 ? m2\n      : h < 240 ? m1 + (m2 - m1) * (240 - h) / 60\n      : m1) * 255;\n}\n","export function basis(t1, v0, v1, v2, v3) {\n  var t2 = t1 * t1, t3 = t2 * t1;\n  return ((1 - 3 * t1 + 3 * t2 - t3) * v0\n      + (4 - 6 * t2 + 3 * t3) * v1\n      + (1 + 3 * t1 + 3 * t2 - 3 * t3) * v2\n      + t3 * v3) / 6;\n}\n\nexport default function(values) {\n  var n = values.length - 1;\n  return function(t) {\n    var i = t <= 0 ? (t = 0) : t >= 1 ? (t = 1, n - 1) : Math.floor(t * n),\n        v1 = values[i],\n        v2 = values[i + 1],\n        v0 = i > 0 ? values[i - 1] : 2 * v1 - v2,\n        v3 = i < n - 1 ? values[i + 2] : 2 * v2 - v1;\n    return basis((t - i / n) * n, v0, v1, v2, v3);\n  };\n}\n","export default x => () => x;\n","import constant from \"./constant.js\";\n\nfunction linear(a, d) {\n  return function(t) {\n    return a + t * d;\n  };\n}\n\nfunction exponential(a, b, y) {\n  return a = Math.pow(a, y), b = Math.pow(b, y) - a, y = 1 / y, function(t) {\n    return Math.pow(a + t * b, y);\n  };\n}\n\nexport function hue(a, b) {\n  var d = b - a;\n  return d ? linear(a, d > 180 || d < -180 ? d - 360 * Math.round(d / 360) : d) : constant(isNaN(a) ? b : a);\n}\n\nexport function gamma(y) {\n  return (y = +y) === 1 ? nogamma : function(a, b) {\n    return b - a ? exponential(a, b, y) : constant(isNaN(a) ? b : a);\n  };\n}\n\nexport default function nogamma(a, b) {\n  var d = b - a;\n  return d ? linear(a, d) : constant(isNaN(a) ? b : a);\n}\n","import {rgb as colorRgb} from \"d3-color\";\nimport basis from \"./basis.js\";\nimport basisClosed from \"./basisClosed.js\";\nimport nogamma, {gamma} from \"./color.js\";\n\nexport default (function rgbGamma(y) {\n  var color = gamma(y);\n\n  function rgb(start, end) {\n    var r = color((start = colorRgb(start)).r, (end = colorRgb(end)).r),\n        g = color(start.g, end.g),\n        b = color(start.b, end.b),\n        opacity = nogamma(start.opacity, end.opacity);\n    return function(t) {\n      start.r = r(t);\n      start.g = g(t);\n      start.b = b(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n\n  rgb.gamma = rgbGamma;\n\n  return rgb;\n})(1);\n\nfunction rgbSpline(spline) {\n  return function(colors) {\n    var n = colors.length,\n        r = new Array(n),\n        g = new Array(n),\n        b = new Array(n),\n        i, color;\n    for (i = 0; i < n; ++i) {\n      color = colorRgb(colors[i]);\n      r[i] = color.r || 0;\n      g[i] = color.g || 0;\n      b[i] = color.b || 0;\n    }\n    r = spline(r);\n    g = spline(g);\n    b = spline(b);\n    color.opacity = 1;\n    return function(t) {\n      color.r = r(t);\n      color.g = g(t);\n      color.b = b(t);\n      return color + \"\";\n    };\n  };\n}\n\nexport var rgbBasis = rgbSpline(basis);\nexport var rgbBasisClosed = rgbSpline(basisClosed);\n","import value from \"./value.js\";\nimport numberArray, {isNumberArray} from \"./numberArray.js\";\n\nexport default function(a, b) {\n  return (isNumberArray(b) ? numberArray : genericArray)(a, b);\n}\n\nexport function genericArray(a, b) {\n  var nb = b ? b.length : 0,\n      na = a ? Math.min(nb, a.length) : 0,\n      x = new Array(na),\n      c = new Array(nb),\n      i;\n\n  for (i = 0; i < na; ++i) x[i] = value(a[i], b[i]);\n  for (; i < nb; ++i) c[i] = b[i];\n\n  return function(t) {\n    for (i = 0; i < na; ++i) c[i] = x[i](t);\n    return c;\n  };\n}\n","export default function(a, b) {\n  var d = new Date;\n  return a = +a, b = +b, function(t) {\n    return d.setTime(a * (1 - t) + b * t), d;\n  };\n}\n","export default function(a, b) {\n  return a = +a, b = +b, function(t) {\n    return a * (1 - t) + b * t;\n  };\n}\n","import value from \"./value.js\";\n\nexport default function(a, b) {\n  var i = {},\n      c = {},\n      k;\n\n  if (a === null || typeof a !== \"object\") a = {};\n  if (b === null || typeof b !== \"object\") b = {};\n\n  for (k in b) {\n    if (k in a) {\n      i[k] = value(a[k], b[k]);\n    } else {\n      c[k] = b[k];\n    }\n  }\n\n  return function(t) {\n    for (k in i) c[k] = i[k](t);\n    return c;\n  };\n}\n","import {basis} from \"./basis.js\";\n\nexport default function(values) {\n  var n = values.length;\n  return function(t) {\n    var i = Math.floor(((t %= 1) < 0 ? ++t : t) * n),\n        v0 = values[(i + n - 1) % n],\n        v1 = values[i % n],\n        v2 = values[(i + 1) % n],\n        v3 = values[(i + 2) % n];\n    return basis((t - i / n) * n, v0, v1, v2, v3);\n  };\n}\n","import number from \"./number.js\";\n\nvar reA = /[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g,\n    reB = new RegExp(reA.source, \"g\");\n\nfunction zero(b) {\n  return function() {\n    return b;\n  };\n}\n\nfunction one(b) {\n  return function(t) {\n    return b(t) + \"\";\n  };\n}\n\nexport default function(a, b) {\n  var bi = reA.lastIndex = reB.lastIndex = 0, // scan index for next number in b\n      am, // current match in a\n      bm, // current match in b\n      bs, // string preceding current number in b, if any\n      i = -1, // index in s\n      s = [], // string constants and placeholders\n      q = []; // number interpolators\n\n  // Coerce inputs to strings.\n  a = a + \"\", b = b + \"\";\n\n  // Interpolate pairs of numbers in a & b.\n  while ((am = reA.exec(a))\n      && (bm = reB.exec(b))) {\n    if ((bs = bm.index) > bi) { // a string precedes the next number in b\n      bs = b.slice(bi, bs);\n      if (s[i]) s[i] += bs; // coalesce with previous string\n      else s[++i] = bs;\n    }\n    if ((am = am[0]) === (bm = bm[0])) { // numbers in a & b match\n      if (s[i]) s[i] += bm; // coalesce with previous string\n      else s[++i] = bm;\n    } else { // interpolate non-matching numbers\n      s[++i] = null;\n      q.push({i: i, x: number(am, bm)});\n    }\n    bi = reB.lastIndex;\n  }\n\n  // Add remains of b.\n  if (bi < b.length) {\n    bs = b.slice(bi);\n    if (s[i]) s[i] += bs; // coalesce with previous string\n    else s[++i] = bs;\n  }\n\n  // Special optimization for only a single match.\n  // Otherwise, interpolate each of the numbers and rejoin the string.\n  return s.length < 2 ? (q[0]\n      ? one(q[0].x)\n      : zero(b))\n      : (b = q.length, function(t) {\n          for (var i = 0, o; i < b; ++i) s[(o = q[i]).i] = o.x(t);\n          return s.join(\"\");\n        });\n}\n","export default function(a, b) {\n  if (!b) b = [];\n  var n = a ? Math.min(b.length, a.length) : 0,\n      c = b.slice(),\n      i;\n  return function(t) {\n    for (i = 0; i < n; ++i) c[i] = a[i] * (1 - t) + b[i] * t;\n    return c;\n  };\n}\n\nexport function isNumberArray(x) {\n  return ArrayBuffer.isView(x) && !(x instanceof DataView);\n}\n","import {color} from \"d3-color\";\nimport rgb from \"./rgb.js\";\nimport {genericArray} from \"./array.js\";\nimport date from \"./date.js\";\nimport number from \"./number.js\";\nimport object from \"./object.js\";\nimport string from \"./string.js\";\nimport constant from \"./constant.js\";\nimport numberArray, {isNumberArray} from \"./numberArray.js\";\n\nexport default function(a, b) {\n  var t = typeof b, c;\n  return b == null || t === \"boolean\" ? constant(b)\n      : (t === \"number\" ? number\n      : t === \"string\" ? ((c = color(b)) ? (b = c, rgb) : string)\n      : b instanceof color ? rgb\n      : b instanceof Date ? date\n      : isNumberArray(b) ? numberArray\n      : Array.isArray(b) ? genericArray\n      : typeof b.valueOf !== \"function\" && typeof b.toString !== \"function\" || isNaN(b) ? object\n      : number)(a, b);\n}\n","export default function(a, b) {\n  return a = +a, b = +b, function(t) {\n    return Math.round(a * (1 - t) + b * t);\n  };\n}\n","export default function number(x) {\n  return +x;\n}\n","import {bisect} from \"d3-array\";\nimport {interpolate as interpolateValue, interpolateNumber, interpolateRound} from \"d3-interpolate\";\nimport constant from \"./constant.js\";\nimport number from \"./number.js\";\n\nvar unit = [0, 1];\n\nexport function identity(x) {\n  return x;\n}\n\nfunction normalize(a, b) {\n  return (b -= (a = +a))\n      ? function(x) { return (x - a) / b; }\n      : constant(isNaN(b) ? NaN : 0.5);\n}\n\nfunction clamper(a, b) {\n  var t;\n  if (a > b) t = a, a = b, b = t;\n  return function(x) { return Math.max(a, Math.min(b, x)); };\n}\n\n// normalize(a, b)(x) takes a domain value x in [a,b] and returns the corresponding parameter t in [0,1].\n// interpolate(a, b)(t) takes a parameter t in [0,1] and returns the corresponding range value x in [a,b].\nfunction bimap(domain, range, interpolate) {\n  var d0 = domain[0], d1 = domain[1], r0 = range[0], r1 = range[1];\n  if (d1 < d0) d0 = normalize(d1, d0), r0 = interpolate(r1, r0);\n  else d0 = normalize(d0, d1), r0 = interpolate(r0, r1);\n  return function(x) { return r0(d0(x)); };\n}\n\nfunction polymap(domain, range, interpolate) {\n  var j = Math.min(domain.length, range.length) - 1,\n      d = new Array(j),\n      r = new Array(j),\n      i = -1;\n\n  // Reverse descending domains.\n  if (domain[j] < domain[0]) {\n    domain = domain.slice().reverse();\n    range = range.slice().reverse();\n  }\n\n  while (++i < j) {\n    d[i] = normalize(domain[i], domain[i + 1]);\n    r[i] = interpolate(range[i], range[i + 1]);\n  }\n\n  return function(x) {\n    var i = bisect(domain, x, 1, j) - 1;\n    return r[i](d[i](x));\n  };\n}\n\nexport function copy(source, target) {\n  return target\n      .domain(source.domain())\n      .range(source.range())\n      .interpolate(source.interpolate())\n      .clamp(source.clamp())\n      .unknown(source.unknown());\n}\n\nexport function transformer() {\n  var domain = unit,\n      range = unit,\n      interpolate = interpolateValue,\n      transform,\n      untransform,\n      unknown,\n      clamp = identity,\n      piecewise,\n      output,\n      input;\n\n  function rescale() {\n    var n = Math.min(domain.length, range.length);\n    if (clamp !== identity) clamp = clamper(domain[0], domain[n - 1]);\n    piecewise = n > 2 ? polymap : bimap;\n    output = input = null;\n    return scale;\n  }\n\n  function scale(x) {\n    return x == null || isNaN(x = +x) ? unknown : (output || (output = piecewise(domain.map(transform), range, interpolate)))(transform(clamp(x)));\n  }\n\n  scale.invert = function(y) {\n    return clamp(untransform((input || (input = piecewise(range, domain.map(transform), interpolateNumber)))(y)));\n  };\n\n  scale.domain = function(_) {\n    return arguments.length ? (domain = Array.from(_, number), rescale()) : domain.slice();\n  };\n\n  scale.range = function(_) {\n    return arguments.length ? (range = Array.from(_), rescale()) : range.slice();\n  };\n\n  scale.rangeRound = function(_) {\n    return range = Array.from(_), interpolate = interpolateRound, rescale();\n  };\n\n  scale.clamp = function(_) {\n    return arguments.length ? (clamp = _ ? true : identity, rescale()) : clamp !== identity;\n  };\n\n  scale.interpolate = function(_) {\n    return arguments.length ? (interpolate = _, rescale()) : interpolate;\n  };\n\n  scale.unknown = function(_) {\n    return arguments.length ? (unknown = _, scale) : unknown;\n  };\n\n  return function(t, u) {\n    transform = t, untransform = u;\n    return rescale();\n  };\n}\n\nexport default function continuous() {\n  return transformer()(identity, identity);\n}\n","export default function constants(x) {\n  return function() {\n    return x;\n  };\n}\n","export function initRange(domain, range) {\n  switch (arguments.length) {\n    case 0: break;\n    case 1: this.range(domain); break;\n    default: this.range(range).domain(domain); break;\n  }\n  return this;\n}\n\nexport function initInterpolator(domain, interpolator) {\n  switch (arguments.length) {\n    case 0: break;\n    case 1: {\n      if (typeof domain === \"function\") this.interpolator(domain);\n      else this.range(domain);\n      break;\n    }\n    default: {\n      this.domain(domain);\n      if (typeof interpolator === \"function\") this.interpolator(interpolator);\n      else this.range(interpolator);\n      break;\n    }\n  }\n  return this;\n}\n","import {ticks} from \"d3-array\";\nimport {format} from \"d3-format\";\nimport nice from \"./nice.js\";\nimport {copy, transformer} from \"./continuous.js\";\nimport {initRange} from \"./init.js\";\n\nfunction transformLog(x) {\n  return Math.log(x);\n}\n\nfunction transformExp(x) {\n  return Math.exp(x);\n}\n\nfunction transformLogn(x) {\n  return -Math.log(-x);\n}\n\nfunction transformExpn(x) {\n  return -Math.exp(-x);\n}\n\nfunction pow10(x) {\n  return isFinite(x) ? +(\"1e\" + x) : x < 0 ? 0 : x;\n}\n\nfunction powp(base) {\n  return base === 10 ? pow10\n      : base === Math.E ? Math.exp\n      : function(x) { return Math.pow(base, x); };\n}\n\nfunction logp(base) {\n  return base === Math.E ? Math.log\n      : base === 10 && Math.log10\n      || base === 2 && Math.log2\n      || (base = Math.log(base), function(x) { return Math.log(x) / base; });\n}\n\nfunction reflect(f) {\n  return function(x) {\n    return -f(-x);\n  };\n}\n\nexport function loggish(transform) {\n  var scale = transform(transformLog, transformExp),\n      domain = scale.domain,\n      base = 10,\n      logs,\n      pows;\n\n  function rescale() {\n    logs = logp(base), pows = powp(base);\n    if (domain()[0] < 0) {\n      logs = reflect(logs), pows = reflect(pows);\n      transform(transformLogn, transformExpn);\n    } else {\n      transform(transformLog, transformExp);\n    }\n    return scale;\n  }\n\n  scale.base = function(_) {\n    return arguments.length ? (base = +_, rescale()) : base;\n  };\n\n  scale.domain = function(_) {\n    return arguments.length ? (domain(_), rescale()) : domain();\n  };\n\n  scale.ticks = function(count) {\n    var d = domain(),\n        u = d[0],\n        v = d[d.length - 1],\n        r;\n\n    if (r = v < u) i = u, u = v, v = i;\n\n    var i = logs(u),\n        j = logs(v),\n        p,\n        k,\n        t,\n        n = count == null ? 10 : +count,\n        z = [];\n\n    if (!(base % 1) && j - i < n) {\n      i = Math.floor(i), j = Math.ceil(j);\n      if (u > 0) for (; i <= j; ++i) {\n        for (k = 1, p = pows(i); k < base; ++k) {\n          t = p * k;\n          if (t < u) continue;\n          if (t > v) break;\n          z.push(t);\n        }\n      } else for (; i <= j; ++i) {\n        for (k = base - 1, p = pows(i); k >= 1; --k) {\n          t = p * k;\n          if (t < u) continue;\n          if (t > v) break;\n          z.push(t);\n        }\n      }\n      if (z.length * 2 < n) z = ticks(u, v, n);\n    } else {\n      z = ticks(i, j, Math.min(j - i, n)).map(pows);\n    }\n\n    return r ? z.reverse() : z;\n  };\n\n  scale.tickFormat = function(count, specifier) {\n    if (specifier == null) specifier = base === 10 ? \".0e\" : \",\";\n    if (typeof specifier !== \"function\") specifier = format(specifier);\n    if (count === Infinity) return specifier;\n    if (count == null) count = 10;\n    var k = Math.max(1, base * count / scale.ticks().length); // TODO fast estimate?\n    return function(d) {\n      var i = d / pows(Math.round(logs(d)));\n      if (i * base < base - 0.5) i *= base;\n      return i <= k ? specifier(d) : \"\";\n    };\n  };\n\n  scale.nice = function() {\n    return domain(nice(domain(), {\n      floor: function(x) { return pows(Math.floor(logs(x))); },\n      ceil: function(x) { return pows(Math.ceil(logs(x))); }\n    }));\n  };\n\n  return scale;\n}\n\nexport default function log() {\n  var scale = loggish(transformer()).domain([1, 10]);\n\n  scale.copy = function() {\n    return copy(scale, log()).base(scale.base());\n  };\n\n  initRange.apply(scale, arguments);\n\n  return scale;\n}\n","export default function nice(domain, interval) {\n  domain = domain.slice();\n\n  var i0 = 0,\n      i1 = domain.length - 1,\n      x0 = domain[i0],\n      x1 = domain[i1],\n      t;\n\n  if (x1 < x0) {\n    t = i0, i0 = i1, i1 = t;\n    t = x0, x0 = x1, x1 = t;\n  }\n\n  domain[i0] = interval.floor(x0);\n  domain[i1] = interval.ceil(x1);\n  return domain;\n}\n","import {ticks, tickIncrement} from \"d3-array\";\nimport continuous, {copy} from \"./continuous.js\";\nimport {initRange} from \"./init.js\";\nimport tickFormat from \"./tickFormat.js\";\n\nexport function linearish(scale) {\n  var domain = scale.domain;\n\n  scale.ticks = function(count) {\n    var d = domain();\n    return ticks(d[0], d[d.length - 1], count == null ? 10 : count);\n  };\n\n  scale.tickFormat = function(count, specifier) {\n    var d = domain();\n    return tickFormat(d[0], d[d.length - 1], count == null ? 10 : count, specifier);\n  };\n\n  scale.nice = function(count) {\n    if (count == null) count = 10;\n\n    var d = domain();\n    var i0 = 0;\n    var i1 = d.length - 1;\n    var start = d[i0];\n    var stop = d[i1];\n    var prestep;\n    var step;\n    var maxIter = 10;\n\n    if (stop < start) {\n      step = start, start = stop, stop = step;\n      step = i0, i0 = i1, i1 = step;\n    }\n    \n    while (maxIter-- > 0) {\n      step = tickIncrement(start, stop, count);\n      if (step === prestep) {\n        d[i0] = start\n        d[i1] = stop\n        return domain(d);\n      } else if (step > 0) {\n        start = Math.floor(start / step) * step;\n        stop = Math.ceil(stop / step) * step;\n      } else if (step < 0) {\n        start = Math.ceil(start * step) / step;\n        stop = Math.floor(stop * step) / step;\n      } else {\n        break;\n      }\n      prestep = step;\n    }\n\n    return scale;\n  };\n\n  return scale;\n}\n\nexport default function linear() {\n  var scale = continuous();\n\n  scale.copy = function() {\n    return copy(scale, linear());\n  };\n\n  initRange.apply(scale, arguments);\n\n  return linearish(scale);\n}\n","import {tickStep} from \"d3-array\";\nimport {format, formatPrefix, formatSpecifier, precisionFixed, precisionPrefix, precisionRound} from \"d3-format\";\n\nexport default function tickFormat(start, stop, count, specifier) {\n  var step = tickStep(start, stop, count),\n      precision;\n  specifier = formatSpecifier(specifier == null ? \",f\" : specifier);\n  switch (specifier.type) {\n    case \"s\": {\n      var value = Math.max(Math.abs(start), Math.abs(stop));\n      if (specifier.precision == null && !isNaN(precision = precisionPrefix(step, value))) specifier.precision = precision;\n      return formatPrefix(specifier, value);\n    }\n    case \"\":\n    case \"e\":\n    case \"g\":\n    case \"p\":\n    case \"r\": {\n      if (specifier.precision == null && !isNaN(precision = precisionRound(step, Math.max(Math.abs(start), Math.abs(stop))))) specifier.precision = precision - (specifier.type === \"e\");\n      break;\n    }\n    case \"f\":\n    case \"%\": {\n      if (specifier.precision == null && !isNaN(precision = precisionFixed(step))) specifier.precision = precision - (specifier.type === \"%\") * 2;\n      break;\n    }\n  }\n  return format(specifier);\n}\n","import exponent from \"./exponent.js\";\n\nexport default function(step, value) {\n  return Math.max(0, Math.max(-8, Math.min(8, Math.floor(exponent(value) / 3))) * 3 - exponent(Math.abs(step)));\n}\n","import exponent from \"./exponent.js\";\n\nexport default function(step, max) {\n  step = Math.abs(step), max = Math.abs(max) - step;\n  return Math.max(0, exponent(max) - exponent(step)) + 1;\n}\n","import exponent from \"./exponent.js\";\n\nexport default function(step) {\n  return Math.max(0, -exponent(Math.abs(step)));\n}\n","import {linearish} from \"./linear.js\";\nimport {copy, identity, transformer} from \"./continuous.js\";\nimport {initRange} from \"./init.js\";\n\nfunction transformPow(exponent) {\n  return function(x) {\n    return x < 0 ? -Math.pow(-x, exponent) : Math.pow(x, exponent);\n  };\n}\n\nfunction transformSqrt(x) {\n  return x < 0 ? -Math.sqrt(-x) : Math.sqrt(x);\n}\n\nfunction transformSquare(x) {\n  return x < 0 ? -x * x : x * x;\n}\n\nexport function powish(transform) {\n  var scale = transform(identity, identity),\n      exponent = 1;\n\n  function rescale() {\n    return exponent === 1 ? transform(identity, identity)\n        : exponent === 0.5 ? transform(transformSqrt, transformSquare)\n        : transform(transformPow(exponent), transformPow(1 / exponent));\n  }\n\n  scale.exponent = function(_) {\n    return arguments.length ? (exponent = +_, rescale()) : exponent;\n  };\n\n  return linearish(scale);\n}\n\nexport default function pow() {\n  var scale = powish(transformer());\n\n  scale.copy = function() {\n    return copy(scale, pow()).exponent(scale.exponent());\n  };\n\n  initRange.apply(scale, arguments);\n\n  return scale;\n}\n\nexport function sqrt() {\n  return pow.apply(null, arguments).exponent(0.5);\n}\n","import { scaleLinear, scaleLog, scalePow, scaleSqrt } from 'd3-scale';\nimport { similar } from '../internal';\nimport type { ITypeFactory, ITypedDump } from './interfaces';\nimport type { IMappingFunction, IMapAbleDesc, IMappingFunctionConstructor } from './INumberColumn';\n\n/**\n * interface of a d3 scale\n */\nexport interface IScale {\n  (v: number): number;\n\n  invert(r: number): number;\n\n  domain(): number[];\n\n  domain(domain: number[]): this;\n\n  range(): number[];\n\n  range(range: number[]): this;\n}\n\nfunction toScale(type = 'linear'): IScale {\n  switch (type) {\n    case 'log':\n      return scaleLog().clamp(true);\n    case 'sqrt':\n      return scaleSqrt().clamp(true);\n    case 'pow1.1':\n      return scalePow().exponent(1.1).clamp(true);\n    case 'pow2':\n      return scalePow().exponent(2).clamp(true);\n    case 'pow3':\n      return scalePow().exponent(3).clamp(true);\n    default:\n      return scaleLinear().clamp(true);\n  }\n}\n\nfunction isSame(a: number[], b: number[]) {\n  if (a.length !== b.length) {\n    return false;\n  }\n  return a.every((ai, i) => similar(ai, b[i], 0.0001));\n}\n\nfunction fixDomain(domain: number[], type: string) {\n  if (type === 'log' && domain[0] === 0) {\n    domain[0] = 0.0000001; //0 is bad\n  }\n  // replace Null with NaN since D3 converts them to 0\n  if (domain[0] == null) {\n    domain[0] = Number.NaN;\n  }\n  if (domain[1] == null) {\n    domain[1] = Number.NaN;\n  }\n  return domain;\n}\n\n/**\n * a mapping function based on a d3 scale (linear, sqrt, log)\n */\nexport class ScaleMappingFunction implements IMappingFunction {\n  private s: IScale;\n  private readonly type: string;\n\n  constructor();\n  constructor(dump: ITypedDump);\n  constructor(domain: number[], type: string, range: number[]);\n  constructor(domain: ITypedDump | number[] = [0, 1], type = 'linear', range: number[] = [0, 1]) {\n    if (!domain || Array.isArray(domain)) {\n      this.type = type;\n      this.s = toScale(type)\n        .domain(fixDomain((domain as number[]) ?? [0, 1], this.type))\n        .range(range);\n    } else {\n      const dump = domain;\n      this.type = dump.type;\n      this.s = toScale(dump.type).domain(fixDomain(dump.domain, dump.type)).range(dump.range);\n    }\n  }\n\n  get domain() {\n    return this.s.domain();\n  }\n\n  set domain(domain: number[]) {\n    this.s.domain(fixDomain(domain, this.type));\n  }\n\n  get range() {\n    return this.s.range();\n  }\n\n  set range(range: number[]) {\n    this.s.range(range);\n  }\n\n  getRange(format: (v: number) => string): [string, string] {\n    return [format(this.invert(0)), format(this.invert(1))];\n  }\n\n  apply(v: number): number {\n    return this.s(v);\n  }\n\n  invert(r: number) {\n    return this.s.invert(r);\n  }\n\n  get scaleType() {\n    return this.type;\n  }\n\n  toJSON() {\n    return {\n      type: this.type,\n      domain: this.domain,\n      range: this.range,\n    };\n  }\n\n  eq(other: IMappingFunction): boolean {\n    if (!(other instanceof ScaleMappingFunction)) {\n      return false;\n    }\n    const that = other as ScaleMappingFunction;\n    return that.type === this.type && isSame(this.domain, that.domain) && isSame(this.range, that.range);\n  }\n\n  clone() {\n    return new ScaleMappingFunction(this.domain, this.type, this.range);\n  }\n}\n\nexport interface IScriptMappingFunctionContext {\n  value_min: number;\n  value_max: number;\n  value_range: number;\n  value_domain: number[];\n  linear(v: number, min: number, max: number): number;\n}\n\nexport interface IScriptMappingFunctionType {\n  (this: IScriptMappingFunctionContext, value: number): number;\n}\n\n/**\n * a mapping function based on a custom user function using 'value' as the current value\n */\nexport class ScriptMappingFunction implements IMappingFunction {\n  private readonly f: IScriptMappingFunctionType;\n  public domain: number[];\n  public readonly code: string;\n\n  constructor();\n  constructor(dump: ITypedDump);\n  constructor(domain: number[], code?: string | IScriptMappingFunctionType);\n  constructor(\n    domain: ITypedDump | number[] = [0, 1],\n    code: string | IScriptMappingFunctionType = 'return this.linear(value,this.value_min,this.value_max);'\n  ) {\n    if (!domain || Array.isArray(domain)) {\n      this.domain = (domain as number[]) ?? [0, 1];\n    } else {\n      const dump = domain;\n      this.domain = dump.domain;\n      code = dump.code;\n    }\n    this.code = typeof code === 'string' ? code : code.toString();\n    // eslint-disable-next-line no-new-func\n    this.f = typeof code === 'function' ? code : (new Function('value', code) as any);\n  }\n\n  getRange(): [string, string] {\n    return ['?', '?'];\n  }\n\n  apply(v: number): number {\n    const min = this.domain[0],\n      max = this.domain[this.domain.length - 1];\n    const r = this.f.call(\n      {\n        value_min: min,\n        value_max: max,\n        value_range: max - min,\n        value_domain: this.domain.slice(),\n        linear: (v: number, mi: number, ma: number) => (v - mi) / (ma - mi),\n      },\n      v\n    );\n\n    if (typeof r === 'number') {\n      return Math.max(Math.min(r, 1), 0);\n    }\n    return NaN;\n  }\n\n  toJSON() {\n    return {\n      type: 'script',\n      code: this.code,\n      domain: this.domain,\n    };\n  }\n\n  eq(other: IMappingFunction): boolean {\n    if (!(other instanceof ScriptMappingFunction)) {\n      return false;\n    }\n    const that = other as ScriptMappingFunction;\n    return that.code === this.code || that.f === this.f;\n  }\n\n  clone() {\n    return new ScriptMappingFunction(this.domain, this.f);\n  }\n}\n\n/**\n * @internal\n */\nexport function createMappingFunction(types: { [key: string]: IMappingFunctionConstructor }) {\n  return (dump: ITypedDump | IScriptMappingFunctionType): IMappingFunction => {\n    if (typeof dump === 'function') {\n      return new ScriptMappingFunction([0, 1], dump);\n    }\n    if (!dump || !dump.type) {\n      return new ScaleMappingFunction();\n    }\n    const type = types[dump.type];\n    if (!type) {\n      console.warn('invalid mapping type dump', dump);\n      return new ScaleMappingFunction(dump.domain || [0, 1], 'linear', dump.range || [0, 1]);\n    }\n    return new type(dump);\n  };\n}\n\n/** @internal */\nexport function restoreMapping(desc: IMapAbleDesc, factory: ITypeFactory): IMappingFunction {\n  if (desc.map) {\n    return factory.mappingFunction(desc.map);\n  }\n  return new ScaleMappingFunction(fixDomain(desc.domain || [0, 1], 'linear'), 'linear', desc.range || [0, 1]);\n}\n\nexport function mappingFunctions() {\n  return {\n    script: ScriptMappingFunction,\n    linear: ScaleMappingFunction,\n    log: ScaleMappingFunction,\n    'pow1.1': ScaleMappingFunction,\n    pow2: ScaleMappingFunction,\n    pow3: ScaleMappingFunction,\n  };\n}\n","import { format } from 'd3-format';\nimport { IBoxPlotData, similar, ISequence, IAdvancedBoxPlotData, boxplotBuilder } from '../internal';\nimport type { IDataRow } from './interfaces';\nimport type { IBoxPlotColumn, INumberFilter, INumberColumn } from './INumberColumn';\nimport { FIRST_IS_NAN } from './missing';\n\n/** @internal */\nexport const DEFAULT_FORMATTER = format('.3n');\n\n/** @internal */\nexport function compareBoxPlot(col: IBoxPlotColumn, a: IDataRow, b: IDataRow) {\n  const aVal = col.getBoxPlotData(a);\n  const bVal = col.getBoxPlotData(b);\n  const method = col.getSortMethod() as keyof IBoxPlotData;\n  if (aVal == null) {\n    return bVal == null ? 0 : FIRST_IS_NAN;\n  }\n  if (bVal == null) {\n    return FIRST_IS_NAN * -1;\n  }\n  return numberCompare(aVal[method] as number, bVal[method] as number);\n}\n\nexport function toCompareBoxPlotValue(col: IBoxPlotColumn, row: IDataRow) {\n  const v = col.getBoxPlotData(row);\n  const method = col.getSortMethod() as keyof IBoxPlotData;\n  return v == null ? NaN : (v[method] as number);\n}\n\nexport function getBoxPlotNumber(col: IBoxPlotColumn, row: IDataRow, mode: 'raw' | 'normalized'): number {\n  const data = mode === 'normalized' ? col.getBoxPlotData(row) : col.getRawBoxPlotData(row);\n  if (data == null) {\n    return NaN;\n  }\n  return data[col.getSortMethod() as keyof IBoxPlotData] as number;\n}\n/**\n * save number comparison\n * @param a\n * @param b\n * @param aMissing\n * @param bMissing\n * @return {number}\n * @internal\n */\nexport function numberCompare(a: number | null, b: number | null, aMissing = false, bMissing = false) {\n  aMissing = aMissing || a == null || Number.isNaN(a);\n  bMissing = bMissing || b == null || Number.isNaN(b);\n  if (aMissing) {\n    //NaN are smaller\n    return bMissing ? 0 : FIRST_IS_NAN;\n  }\n  if (bMissing) {\n    return FIRST_IS_NAN * -1;\n  }\n  return a! - b!;\n}\n\n/** @internal */\nexport function noNumberFilter() {\n  return { min: Number.NEGATIVE_INFINITY, max: Number.POSITIVE_INFINITY, filterMissing: false };\n}\n\n/** @internal */\nexport function isEqualNumberFilter(a: INumberFilter, b: INumberFilter, delta = 0.001) {\n  return similar(a.min, b.min, delta) && similar(a.max, b.max, delta) && a.filterMissing === b.filterMissing;\n}\n\n/** @internal */\nexport function isNumberIncluded(filter: INumberFilter | null, value: number) {\n  if (!filter) {\n    return true;\n  }\n  if (Number.isNaN(value)) {\n    return !filter.filterMissing;\n  }\n  return !((isFinite(filter.min) && value < filter.min) || (isFinite(filter.max) && value > filter.max));\n}\n\n/** @internal */\nexport function isDummyNumberFilter(filter: INumberFilter) {\n  return !filter.filterMissing && !isFinite(filter.min) && !isFinite(filter.max);\n}\n\n/** @internal */\nexport function restoreNumberFilter(v: INumberFilter): INumberFilter {\n  return {\n    min: v.min != null && isFinite(v.min) ? v.min : Number.NEGATIVE_INFINITY,\n    max: v.max != null && isFinite(v.max) ? v.max : Number.POSITIVE_INFINITY,\n    filterMissing: v.filterMissing,\n  };\n}\n\n/** @internal */\nexport function medianIndex(rows: ISequence<IDataRow>, col: INumberColumn) {\n  //return the median row\n  const data = rows.map((r, i) => ({ r, i, v: col.getNumber(r) }));\n  const sorted = Array.from(data.filter((r) => !Number.isNaN(r.v))).sort((a, b) => numberCompare(a.v, b.v));\n  const index = sorted[Math.floor(sorted.length / 2.0)];\n  if (index === undefined) {\n    return { index: 0, row: sorted[0]!.r }; //error case\n  }\n  return { index: index.i, row: index.r };\n}\n\n/** @internal */\nexport function toCompareGroupValue(\n  rows: ISequence<IDataRow>,\n  col: INumberColumn,\n  sortMethod: keyof IAdvancedBoxPlotData,\n  valueCache?: ISequence<number>\n) {\n  const b = boxplotBuilder();\n  if (valueCache) {\n    b.pushAll(valueCache);\n  } else {\n    b.pushAll(rows.map((d) => col.getNumber(d)));\n  }\n  const vs = b.build();\n  return vs[sortMethod] as number;\n}\n","import { format } from 'd3-format';\nimport { equalArrays, IEventListener, ISequence } from '../internal';\nimport { Category, dialogAddons, SortByDefault, toolbar } from './annotations';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  groupRendererChanged,\n  labelChanged,\n  metaDataChanged,\n  rendererTypeChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n  DEFAULT_COLOR,\n} from './Column';\nimport { IDataRow, IGroup, ECompareValueType, IValueColumnDesc, ITypeFactory } from './interfaces';\nimport {\n  INumberColumn,\n  EAdvancedSortMethod,\n  INumberDesc,\n  INumberFilter,\n  IMappingFunction,\n  IColorMappingFunction,\n  IMapAbleColumn,\n} from './INumberColumn';\nimport { restoreMapping } from './MappingFunction';\nimport { isMissingValue, isUnknown, missingGroup } from './missing';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport {\n  noNumberFilter,\n  isDummyNumberFilter,\n  restoreNumberFilter,\n  toCompareGroupValue,\n  isEqualNumberFilter,\n  isNumberIncluded,\n} from './internalNumber';\nimport { integrateDefaults } from './internal';\n\nexport declare type INumberColumnDesc = INumberDesc & IValueColumnDesc<number>;\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf NumberColumn\n * @event\n */\nexport declare function mappingChanged_NC(previous: IMappingFunction, current: IMappingFunction): void;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf NumberColumn\n * @event\n */\nexport declare function colorMappingChanged_NC(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf NumberColumn\n * @event\n */\nexport declare function filterChanged_NC(previous: INumberFilter | null, current: INumberFilter | null): void;\n\n/**\n * emitted when the sort method property changes\n * @asMemberOf NumberColumn\n * @event\n */\nexport declare function sortMethodChanged_NC(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\n\n/**\n * emitted when the grouping property changes\n * @asMemberOf NumberColumn\n * @event\n */\nexport declare function groupingChanged_NC(previous: number[], current: number[]): void;\n\n/**\n * a number column mapped from an original input scale to an output range\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'groupBy', 'sortGroupBy', 'filterNumber', 'colorMapped', 'editMapping')\n@dialogAddons('sortGroup', 'sortNumber')\n@dialogAddons('group', 'groupNumber')\n@Category('number')\n@SortByDefault('descending')\nexport default class NumberColumn extends ValueColumn<number> implements INumberColumn, IMapAbleColumn {\n  static readonly EVENT_MAPPING_CHANGED = 'mappingChanged';\n  static readonly EVENT_COLOR_MAPPING_CHANGED = 'colorMappingChanged';\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\n  static readonly EVENT_SORTMETHOD_CHANGED = 'sortMethodChanged';\n  static readonly EVENT_GROUPING_CHANGED = 'groupingChanged';\n\n  private mapping: IMappingFunction;\n  private colorMapping: IColorMappingFunction;\n  private original: IMappingFunction;\n  private deriveMapping: readonly boolean[];\n\n  /**\n   * currently active filter\n   * @private\n   */\n  private currentFilter: INumberFilter = noNumberFilter();\n\n  /**\n   * The accuracy defines the deviation of values to the applied filter boundary.\n   * Use an accuracy closer to 0 for columns with smaller numbers (e.g., 1e-9).\n   * @private\n   */\n  private readonly filterAccuracy: number = 0.001;\n\n  private readonly numberFormat: (n: number) => string = format('.2f');\n\n  private currentGroupThresholds: number[] = [];\n  private groupSortMethod: EAdvancedSortMethod = EAdvancedSortMethod.median;\n\n  constructor(id: string, desc: INumberColumnDesc, factory: ITypeFactory) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        groupRenderer: 'boxplot',\n        summaryRenderer: 'histogram',\n      })\n    );\n\n    this.mapping = restoreMapping(desc, factory);\n    this.original = this.mapping.clone();\n    this.deriveMapping = this.mapping.domain.map((d) => d == null || Number.isNaN(d));\n\n    this.colorMapping = factory.colorMappingFunction(desc.colorMapping || desc.color);\n\n    if (desc.numberFormat) {\n      this.numberFormat = format(desc.numberFormat);\n    }\n\n    if (desc.filterAccuracy) {\n      this.filterAccuracy = desc.filterAccuracy;\n    }\n  }\n\n  getNumberFormat() {\n    return this.numberFormat;\n  }\n\n  onDataUpdate(rows: ISequence<IDataRow>): void {\n    super.onDataUpdate(rows);\n    if (!this.deriveMapping.some(Boolean)) {\n      return;\n    }\n    // hook for listening to data updates\n    const minMax = rows\n      .map((row) => this.getRawValue(row))\n      .reduce(\n        (acc, v) => {\n          if (v == null || Number.isNaN(v)) {\n            return acc;\n          }\n          if (v < acc.min) {\n            acc.min = v;\n          }\n          if (v > acc.max) {\n            acc.max = v;\n          }\n          return acc;\n        },\n        { min: Number.POSITIVE_INFINITY, max: Number.NEGATIVE_INFINITY }\n      );\n\n    const domain = this.mapping.domain.slice();\n    if (this.deriveMapping[0]) {\n      domain[0] = minMax.min;\n    }\n    if (this.deriveMapping[this.deriveMapping.length - 1]) {\n      domain[domain.length - 1] = minMax.max;\n    }\n    this.mapping.domain = domain;\n    (this.original as IMappingFunction).domain = domain;\n  }\n\n  dump(toDescRef: (desc: any) => any) {\n    const r = super.dump(toDescRef);\n    r.map = this.mapping.toJSON();\n    r.colorMapping = this.colorMapping.toJSON();\n    r.filter = isDummyNumberFilter(this.currentFilter) ? null : this.currentFilter;\n    r.groupSortMethod = this.groupSortMethod;\n    if (this.currentGroupThresholds) {\n      r.stratifyThresholds = this.currentGroupThresholds;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.map || dump.domain) {\n      this.mapping = restoreMapping(dump, factory);\n    }\n    if (dump.colorMapping) {\n      this.colorMapping = factory.colorMappingFunction(dump.colorMapping);\n    }\n    if (dump.groupSortMethod) {\n      this.groupSortMethod = dump.groupSortMethod;\n    }\n    if (dump.filter) {\n      this.currentFilter = restoreNumberFilter(dump.filter);\n    }\n    if (dump.stratifyThresholds) {\n      this.currentGroupThresholds = dump.stratifyThresholds;\n    }\n    if (dump.stratifyThreshholds) {\n      this.currentGroupThresholds = dump.stratifyThreshholds;\n    }\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        NumberColumn.EVENT_MAPPING_CHANGED,\n        NumberColumn.EVENT_COLOR_MAPPING_CHANGED,\n        NumberColumn.EVENT_FILTER_CHANGED,\n        NumberColumn.EVENT_SORTMETHOD_CHANGED,\n        NumberColumn.EVENT_GROUPING_CHANGED,\n      ]);\n  }\n\n  on(type: typeof NumberColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_NC | null): this;\n  on(type: typeof NumberColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_NC | null): this;\n  on(type: typeof NumberColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_NC | null): this;\n  on(type: typeof NumberColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_NC | null): this;\n  on(type: typeof NumberColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged_NC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getLabel(row: IDataRow) {\n    if ((this.desc as any).numberFormat) {\n      const raw = this.getRawValue(row);\n      //if a dedicated format and a number use the formatter in any case\n      if (Number.isNaN(raw)) {\n        return 'NaN';\n      }\n      if (!isFinite(raw)) {\n        return raw.toString();\n      }\n      return this.numberFormat(raw);\n    }\n    const v = super.getValue(row);\n    //keep non number if it is not a number else convert using formatter\n    if (typeof v === 'number') {\n      return this.numberFormat(+v);\n    }\n    return String(v);\n  }\n\n  getRange() {\n    return this.mapping.getRange(this.numberFormat);\n  }\n\n  getRawValue(row: IDataRow) {\n    const v: any = super.getValue(row);\n    if (isMissingValue(v)) {\n      return NaN;\n    }\n    return +v;\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\n  }\n\n  getValue(row: IDataRow) {\n    const v = this.getNumber(row);\n    if (Number.isNaN(v)) {\n      return null;\n    }\n    return v;\n  }\n\n  getNumber(row: IDataRow) {\n    const v = this.getRawValue(row);\n    if (Number.isNaN(v)) {\n      return NaN;\n    }\n    return this.mapping.apply(v);\n  }\n\n  iterNumber(row: IDataRow) {\n    return [this.getNumber(row)];\n  }\n\n  iterRawNumber(row: IDataRow) {\n    return [this.getRawNumber(row)];\n  }\n\n  getRawNumber(row: IDataRow) {\n    return this.getRawValue(row);\n  }\n\n  toCompareValue(row: IDataRow, valueCache?: any) {\n    return valueCache != null ? valueCache : this.getNumber(row);\n  }\n\n  toCompareValueType() {\n    return ECompareValueType.FLOAT;\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, _group: IGroup, valueCache?: ISequence<any>): number {\n    return toCompareGroupValue(rows, this, this.groupSortMethod, valueCache);\n  }\n\n  toCompareGroupValueType() {\n    return ECompareValueType.FLOAT;\n  }\n\n  getOriginalMapping() {\n    return this.original.clone();\n  }\n\n  getMapping() {\n    return this.mapping.clone();\n  }\n\n  setMapping(mapping: IMappingFunction) {\n    if (this.mapping.eq(mapping)) {\n      return;\n    }\n    this.deriveMapping = [];\n    this.fire(\n      [\n        NumberColumn.EVENT_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY,\n      ],\n      this.mapping.clone(),\n      (this.mapping = mapping)\n    );\n  }\n\n  getColor(row: IDataRow) {\n    const v = this.getNumber(row);\n    if (Number.isNaN(v)) {\n      return DEFAULT_COLOR;\n    }\n    return this.colorMapping.apply(v);\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        NumberColumn.EVENT_COLOR_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY,\n      ],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  isFiltered() {\n    return !isDummyNumberFilter(this.currentFilter);\n  }\n\n  getFilter(): INumberFilter {\n    return Object.assign({}, this.currentFilter);\n  }\n\n  setFilter(value: INumberFilter | null) {\n    value = value || { min: Number.NEGATIVE_INFINITY, max: Number.POSITIVE_INFINITY, filterMissing: false };\n    if (isEqualNumberFilter(value, this.currentFilter, this.filterAccuracy)) {\n      return;\n    }\n    const bak = this.getFilter();\n    this.currentFilter.min = isUnknown(value.min) ? Number.NEGATIVE_INFINITY : value.min;\n    this.currentFilter.max = isUnknown(value.max) ? Number.POSITIVE_INFINITY : value.max;\n    this.currentFilter.filterMissing = value.filterMissing;\n    this.fire(\n      [NumberColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      bak,\n      this.getFilter()\n    );\n  }\n\n  /**\n   * filter the current row if any filter is set\n   * @param row\n   * @returns {boolean}\n   */\n  filter(row: IDataRow) {\n    return isNumberIncluded(this.currentFilter, this.getRawNumber(row));\n  }\n\n  clearFilter() {\n    const was = this.isFiltered();\n    this.setFilter(null);\n    return was;\n  }\n\n  getGroupThresholds() {\n    return this.currentGroupThresholds.slice();\n  }\n\n  setGroupThresholds(value: number[]) {\n    if (equalArrays(this.currentGroupThresholds, value)) {\n      return;\n    }\n    const bak = this.getGroupThresholds();\n    this.currentGroupThresholds = value.slice();\n    this.fire([NumberColumn.EVENT_GROUPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, value);\n  }\n\n  group(row: IDataRow): IGroup {\n    const value = this.getRawNumber(row);\n    if (Number.isNaN(value)) {\n      return Object.assign({}, missingGroup);\n    }\n\n    let threshold = this.currentGroupThresholds;\n    if (threshold.length === 0) {\n      // default threshold\n      const d = this.mapping.domain;\n      threshold = [(d[1] - d[0]) / 2];\n    }\n\n    const thresholdIndex = threshold.findIndex((t) => value <= t);\n    // group by thresholds / bins\n    switch (thresholdIndex) {\n      case -1:\n        //bigger than the last threshold\n        return {\n          name: `${this.label} > ${this.numberFormat(threshold[threshold.length - 1])}`,\n          color: this.colorMapping.apply(1),\n        };\n      case 0:\n        //smallest\n        return {\n          name: `${this.label} <= ${this.numberFormat(threshold[0])}`,\n          color: this.colorMapping.apply(0),\n        };\n      default:\n        return {\n          name: `${this.numberFormat(threshold[thresholdIndex - 1])} <= ${this.label} <= ${this.numberFormat(\n            threshold[thresholdIndex]\n          )}`,\n          color: this.colorMapping.apply(\n            this.mapping.apply((threshold[thresholdIndex - 1] + threshold[thresholdIndex]) / 2)\n          ),\n        };\n    }\n  }\n\n  getSortMethod() {\n    return this.groupSortMethod;\n  }\n\n  setSortMethod(sortMethod: EAdvancedSortMethod) {\n    if (this.groupSortMethod === sortMethod) {\n      return;\n    }\n    this.fire([NumberColumn.EVENT_SORTMETHOD_CHANGED], this.groupSortMethod, (this.groupSortMethod = sortMethod));\n    // sort by me if not already sorted by me\n    if (!this.isGroupSortedByMe().asc) {\n      this.toggleMyGroupSorting();\n    }\n  }\n}\n","import { format } from 'd3-format';\nimport type { IBoxPlotData, IEventListener, ISequence } from '../internal';\nimport { Category, dialogAddons, SortByDefault, toolbar } from './annotations';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  groupRendererChanged,\n  labelChanged,\n  metaDataChanged,\n  rendererTypeChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n} from './Column';\nimport { IDataRow, ECompareValueType, IValueColumnDesc, ITypeFactory } from './interfaces';\nimport {\n  ESortMethod,\n  IBoxPlotColumn,\n  INumberDesc,\n  INumberFilter,\n  IColorMappingFunction,\n  IMappingFunction,\n} from './INumberColumn';\nimport { restoreMapping } from './MappingFunction';\nimport NumberColumn from './NumberColumn';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport {\n  DEFAULT_FORMATTER,\n  noNumberFilter,\n  toCompareBoxPlotValue,\n  getBoxPlotNumber,\n  isDummyNumberFilter,\n  restoreNumberFilter,\n} from './internalNumber';\n\nexport interface IBoxPlotDesc extends INumberDesc {\n  sort?: ESortMethod;\n}\n\nexport declare type IBoxPlotColumnDesc = IBoxPlotDesc & IValueColumnDesc<IBoxPlotData>;\n\n/**\n * emitted when the sort method property changes\n * @asMemberOf BoxPlotColumn\n * @event\n */\nexport declare function sortMethodChanged_BPC(previous: ESortMethod, current: ESortMethod): void;\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf BoxPlotColumn\n * @event\n */\nexport declare function mappingChanged_BPC(previous: IMappingFunction, current: IMappingFunction): void;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf BoxPlotColumn\n * @event\n */\nexport declare function colorMappingChanged_BPC(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf BoxPlotColumn\n * @event\n */\nexport declare function filterChanged_BPC(previous: INumberFilter | null, current: INumberFilter | null): void;\n\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterNumber', 'colorMapped', 'editMapping')\n@dialogAddons('sort', 'sortBoxPlot')\n@Category('array')\n@SortByDefault('descending')\nexport default class BoxPlotColumn extends ValueColumn<IBoxPlotData> implements IBoxPlotColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\n  static readonly EVENT_SORTMETHOD_CHANGED = NumberColumn.EVENT_SORTMETHOD_CHANGED;\n  static readonly EVENT_FILTER_CHANGED = NumberColumn.EVENT_FILTER_CHANGED;\n\n  private readonly numberFormat: (n: number) => string = DEFAULT_FORMATTER;\n\n  private sort: ESortMethod;\n\n  private mapping: IMappingFunction;\n  private colorMapping: IColorMappingFunction;\n  private original: Readonly<IMappingFunction>;\n  private deriveMapping: readonly boolean[];\n\n  /**\n   * currently active filter\n   * @type {{min: number, max: number}}\n   * @private\n   */\n  private currentFilter: INumberFilter = noNumberFilter();\n\n  constructor(id: string, desc: Readonly<IBoxPlotColumnDesc>, factory: ITypeFactory) {\n    super(id, desc);\n    this.mapping = restoreMapping(desc, factory);\n    this.original = this.mapping.clone();\n    this.deriveMapping = this.mapping.domain.map((d) => d == null || Number.isNaN(d));\n    this.colorMapping = factory.colorMappingFunction(desc.colorMapping);\n\n    if (desc.numberFormat) {\n      this.numberFormat = format(desc.numberFormat);\n    }\n\n    this.sort = desc.sort || ESortMethod.min;\n  }\n\n  onDataUpdate(rows: ISequence<IDataRow>): void {\n    super.onDataUpdate(rows);\n    if (!this.deriveMapping.some(Boolean)) {\n      return;\n    }\n    // hook for listening to data updates\n    const minMax = rows\n      .map((row) => this.getRawValue(row))\n      .reduce(\n        (acc, v) => {\n          if (v == null) {\n            return acc;\n          }\n          if (v.min < acc.min) {\n            acc.min = v.min;\n          }\n          if (v.max > acc.max) {\n            acc.max = v.max;\n          }\n          return acc;\n        },\n        { min: Number.POSITIVE_INFINITY, max: Number.NEGATIVE_INFINITY }\n      );\n\n    const domain = this.mapping.domain.slice();\n    if (this.deriveMapping[0]) {\n      domain[0] = minMax.min;\n    }\n    if (this.deriveMapping[this.deriveMapping.length - 1]) {\n      domain[domain.length - 1] = minMax.max;\n    }\n    this.mapping.domain = domain;\n    (this.original as IMappingFunction).domain = domain;\n  }\n\n  getNumberFormat() {\n    return this.numberFormat;\n  }\n\n  toCompareValue(row: IDataRow): number {\n    return toCompareBoxPlotValue(this, row);\n  }\n\n  toCompareValueType() {\n    return ECompareValueType.FLOAT;\n  }\n\n  getBoxPlotData(row: IDataRow): IBoxPlotData | null {\n    return this.getValue(row);\n  }\n\n  getRange() {\n    return this.mapping.getRange(this.numberFormat);\n  }\n\n  getRawBoxPlotData(row: IDataRow): IBoxPlotData | null {\n    return this.getRawValue(row);\n  }\n\n  getRawValue(row: IDataRow) {\n    return super.getValue(row);\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\n  }\n\n  getValue(row: IDataRow) {\n    const v = this.getRawValue(row);\n    if (v == null) {\n      return null;\n    }\n    const r: IBoxPlotData = {\n      min: this.mapping.apply(v.min),\n      max: this.mapping.apply(v.max),\n      median: this.mapping.apply(v.median),\n      q1: this.mapping.apply(v.q1),\n      q3: this.mapping.apply(v.q3),\n    };\n    if (v.outlier) {\n      Object.assign(r, {\n        outlier: v.outlier.map((d) => this.mapping.apply(d)),\n      });\n    }\n    if (v.whiskerLow != null) {\n      Object.assign(r, {\n        whiskerLow: this.mapping.apply(v.whiskerLow),\n      });\n    }\n    if (v.whiskerHigh != null) {\n      Object.assign(r, {\n        whiskerHigh: this.mapping.apply(v.whiskerHigh),\n      });\n    }\n    return r;\n  }\n\n  getNumber(row: IDataRow): number {\n    return getBoxPlotNumber(this, row, 'normalized');\n  }\n\n  getRawNumber(row: IDataRow): number {\n    return getBoxPlotNumber(this, row, 'raw');\n  }\n\n  iterNumber(row: IDataRow) {\n    return [this.getNumber(row)];\n  }\n\n  iterRawNumber(row: IDataRow) {\n    return [this.getRawNumber(row)];\n  }\n\n  getLabel(row: IDataRow): string {\n    const v = this.getRawValue(row);\n    if (v == null) {\n      return '';\n    }\n    const f = this.numberFormat;\n    return `BoxPlot(min = ${f(v.min)}, q1 = ${f(v.q1)}, median = ${f(v.median)}, q3 = ${f(v.q3)}, max = ${f(v.max)})`;\n  }\n\n  getSortMethod() {\n    return this.sort;\n  }\n\n  setSortMethod(sort: ESortMethod) {\n    if (this.sort === sort) {\n      return;\n    }\n    this.fire(BoxPlotColumn.EVENT_SORTMETHOD_CHANGED, this.sort, (this.sort = sort));\n    // sort by me if not already sorted by me\n    if (!this.isSortedByMe().asc) {\n      this.sortByMe();\n    }\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.sortMethod = this.getSortMethod();\n    r.filter = !isDummyNumberFilter(this.currentFilter) ? this.currentFilter : null;\n    r.map = this.mapping.toJSON();\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.sortMethod) {\n      this.sort = dump.sortMethod;\n    }\n    if (dump.filter) {\n      this.currentFilter = restoreNumberFilter(dump.filter);\n    }\n    if (dump.map || dump.domain) {\n      this.mapping = restoreMapping(dump, factory);\n    }\n    if (dump.colorMapping) {\n      this.colorMapping = factory.colorMappingFunction(dump.colorMapping);\n    }\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        BoxPlotColumn.EVENT_SORTMETHOD_CHANGED,\n        BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED,\n        BoxPlotColumn.EVENT_MAPPING_CHANGED,\n        BoxPlotColumn.EVENT_FILTER_CHANGED,\n      ]);\n  }\n\n  on(type: typeof BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_BPC | null): this;\n  on(type: typeof BoxPlotColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_BPC | null): this;\n  on(type: typeof BoxPlotColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_BPC | null): this;\n  on(type: typeof BoxPlotColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_BPC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getOriginalMapping() {\n    return this.original.clone();\n  }\n\n  getMapping() {\n    return this.mapping.clone();\n  }\n\n  setMapping(mapping: IMappingFunction) {\n    if (this.mapping.eq(mapping)) {\n      return;\n    }\n    this.deriveMapping = [];\n    this.fire(\n      [\n        BoxPlotColumn.EVENT_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.mapping.clone(),\n      (this.mapping = mapping)\n    );\n  }\n\n  getColor(row: IDataRow) {\n    return NumberColumn.prototype.getColor.call(this, row);\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  isFiltered() {\n    return NumberColumn.prototype.isFiltered.call(this);\n  }\n\n  getFilter(): INumberFilter {\n    return NumberColumn.prototype.getFilter.call(this);\n  }\n\n  setFilter(value: INumberFilter | null) {\n    NumberColumn.prototype.setFilter.call(this, value);\n  }\n\n  filter(row: IDataRow) {\n    return NumberColumn.prototype.filter.call(this, row);\n  }\n\n  clearFilter() {\n    return NumberColumn.prototype.clearFilter.call(this);\n  }\n}\n","import { Category } from './annotations';\nimport type { IKeyValue, IMapColumn } from './IArrayColumn';\nimport type { IDataRow, IValueColumnDesc } from './interfaces';\nimport ValueColumn from './ValueColumn';\nimport { integrateDefaults } from './internal';\n\nexport type IMapColumnDesc<T> = IValueColumnDesc<IKeyValue<T>[]>;\n\n@Category('map')\nexport default class MapColumn<T> extends ValueColumn<IKeyValue<T>[]> implements IMapColumn<T> {\n  constructor(id: string, desc: Readonly<IMapColumnDesc<T>>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 200,\n      })\n    );\n  }\n\n  getValue(row: IDataRow) {\n    const r = this.getMap(row);\n    return r.length === 0 ? null : r;\n  }\n\n  getLabels(row: IDataRow): IKeyValue<string>[] {\n    const v = this.getMap(row);\n    return v.map(({ key, value }) => ({ key, value: String(value) }));\n  }\n\n  getMap(row: IDataRow) {\n    return toKeyValue<T>(super.getValue(row));\n  }\n\n  getMapLabel(row: IDataRow) {\n    return this.getLabels(row);\n  }\n\n  getLabel(row: IDataRow) {\n    const v = this.getLabels(row);\n    return `{${v.map(({ key, value }) => `${key}: ${value}`).join(', ')}}`;\n  }\n}\n\nfunction byKey(a: IKeyValue<any>, b: IKeyValue<any>) {\n  if (a === b) {\n    return 0;\n  }\n  return a.key.localeCompare(b.key);\n}\n\nfunction toKeyValue<T>(v?: Map<string, T> | { [key: string]: T } | IKeyValue<T>[]): IKeyValue<T>[] {\n  if (!v) {\n    return [];\n  }\n  if (v instanceof Map) {\n    return Array.from(v.entries())\n      .map(([key, value]) => ({ key, value }))\n      .sort(byKey);\n  }\n  if (Array.isArray(v)) {\n    return v; // keep original order\n  }\n  // object\n  return Object.keys(v)\n    .map((key) => ({ key, value: v[key] }))\n    .sort(byKey);\n}\n","import type {\n  ICategoricalDesc,\n  ICategory,\n  ICategoricalLikeColumn,\n  ICategoricalColorMappingFunction,\n} from './ICategoricalColumn';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport MapColumn, { IMapColumnDesc } from './MapColumn';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\nimport CategoricalColumn from './CategoricalColumn';\nimport type ValueColumn from './ValueColumn';\nimport type { dataLoaded } from './ValueColumn';\nimport {\n  DEFAULT_COLOR,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n  dirtyCaches,\n} from './Column';\nimport type Column from './Column';\nimport type { IEventListener, ISequence } from '../internal';\nimport { toolbar } from './annotations';\nimport { toCategories } from './internalCategorical';\n\nexport declare type ICategoricalMapColumnDesc = ICategoricalDesc & IMapColumnDesc<string | null>;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf CategoricalMapColumn\n * @event\n */\nexport declare function colorMappingChanged_CMC(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n@toolbar('rename', 'colorMappedCategorical')\nexport default class CategoricalMapColumn extends MapColumn<string | null> implements ICategoricalLikeColumn {\n  static readonly EVENT_COLOR_MAPPING_CHANGED = CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  readonly categories: ICategory[];\n\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\n\n  private colorMapping: ICategoricalColorMappingFunction;\n\n  constructor(id: string, desc: Readonly<ICategoricalMapColumnDesc>) {\n    super(id, desc);\n    this.categories = toCategories(desc);\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n\n  onDataUpdate(rows: ISequence<IDataRow>): void {\n    super.onDataUpdate(rows);\n    if ((this.desc as ICategoricalMapColumnDesc).categories) {\n      return;\n    }\n    // derive\n    const categories = new Set<string>();\n    rows.forEach((row) => {\n      const value = super.getValue(row);\n      if (!value || !Array.isArray(value) || value.length === 0) {\n        return;\n      }\n      for (const kv of value) {\n        if (!kv || !kv.value) {\n          continue;\n        }\n        categories.add(String(kv.value));\n      }\n    });\n    this.categories.splice(0, this.categories.length, ...toCategories({ categories: Array.from(categories) }));\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([CategoricalMapColumn.EVENT_COLOR_MAPPING_CHANGED]);\n  }\n\n  on(\n    type: typeof CategoricalMapColumn.EVENT_COLOR_MAPPING_CHANGED,\n    listener: typeof colorMappingChanged_CMC | null\n  ): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  private parseValue(v: any) {\n    if (!v) {\n      return null;\n    }\n    const vs = String(v);\n    return this.lookup.has(vs) ? this.lookup.get(vs)! : null;\n  }\n\n  getCategoryMap(row: IDataRow) {\n    return super.getMap(row).map(({ key, value }) => ({\n      key,\n      value: this.parseValue(value),\n    }));\n  }\n\n  getCategories(row: IDataRow) {\n    return this.getCategoryMap(row).map((d) => d.value);\n  }\n\n  getColors(row: IDataRow) {\n    return this.getCategoryMap(row).map(({ key, value }) => ({\n      key,\n      value: value ? this.colorMapping.apply(value) : DEFAULT_COLOR,\n    }));\n  }\n\n  getValue(row: IDataRow) {\n    const r = this.getCategoryMap(row);\n    return r.length === 0\n      ? null\n      : r.map(({ key, value }) => ({\n          key,\n          value: value ? value.name : null,\n        }));\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getCategoryMap(row).map(({ key, value }) => ({\n      key,\n      value: value ? value.label : '',\n    }));\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    return CategoricalColumn.prototype.setColorMapping.call(this, mapping);\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\n  }\n\n  iterCategory(row: IDataRow) {\n    return this.getCategories(row);\n  }\n}\n","import ArrayColumn, { IArrayColumnDesc } from './ArrayColumn';\nimport type {\n  ICategoricalDesc,\n  ICategory,\n  ICategoricalColorMappingFunction,\n  ICategoricalsColumn,\n} from './ICategoricalColumn';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport { toolbar } from './annotations';\nimport CategoricalColumn from './CategoricalColumn';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport type Column from './Column';\nimport {\n  DEFAULT_COLOR,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n  dirtyCaches,\n} from './Column';\nimport type { IEventListener, ISequence } from '../internal';\nimport { toCategories } from './internalCategorical';\n\nexport declare type ICategoricalsColumnDesc = ICategoricalDesc & IArrayColumnDesc<string | null>;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf CategoricalsColumn\n * @event\n */\nexport declare function colorMappingChanged_CCS(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'colorMappedCategorical')\nexport default class CategoricalsColumn extends ArrayColumn<string | null> implements ICategoricalsColumn {\n  static readonly EVENT_COLOR_MAPPING_CHANGED = CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  readonly categories: ICategory[];\n\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\n\n  private colorMapping: ICategoricalColorMappingFunction;\n\n  constructor(id: string, desc: Readonly<ICategoricalsColumnDesc>) {\n    super(id, desc);\n    this.categories = toCategories(desc);\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n\n  onDataUpdate(rows: ISequence<IDataRow>): void {\n    super.onDataUpdate(rows);\n    if ((this.desc as ICategoricalsColumnDesc).categories) {\n      return;\n    }\n    // derive\n    const categories = new Set<string>();\n    rows.forEach((row) => {\n      const value = super.getValue(row);\n      if (!value || !Array.isArray(value) || value.length === 0) {\n        return;\n      }\n      for (const kv of value) {\n        if (!kv) {\n          continue;\n        }\n        categories.add(String(kv));\n      }\n    });\n    this.categories.splice(0, this.categories.length, ...toCategories({ categories: Array.from(categories) }));\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([CategoricalsColumn.EVENT_COLOR_MAPPING_CHANGED]);\n  }\n\n  on(\n    type: typeof CategoricalsColumn.EVENT_COLOR_MAPPING_CHANGED,\n    listener: typeof colorMappingChanged_CCS | null\n  ): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getCategories(row: IDataRow) {\n    return super.getValues(row).map((v) => {\n      if (!v) {\n        return null;\n      }\n      const vs = String(v);\n      return this.lookup.has(vs) ? this.lookup.get(vs)! : null;\n    });\n  }\n\n  getColors(row: IDataRow) {\n    return this.getCategories(row).map((d) => (d ? this.colorMapping.apply(d) : DEFAULT_COLOR));\n  }\n\n  iterCategory(row: IDataRow) {\n    return this.getCategories(row);\n  }\n\n  getValues(row: IDataRow) {\n    return this.getCategories(row).map((v) => (v ? v.name : null));\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getCategories(row).map((v) => (v ? v.label : ''));\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    return CategoricalColumn.prototype.setColorMapping.call(this, mapping);\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\n  }\n}\n","var t0 = new Date,\n    t1 = new Date;\n\nexport default function newInterval(floori, offseti, count, field) {\n\n  function interval(date) {\n    return floori(date = arguments.length === 0 ? new Date : new Date(+date)), date;\n  }\n\n  interval.floor = function(date) {\n    return floori(date = new Date(+date)), date;\n  };\n\n  interval.ceil = function(date) {\n    return floori(date = new Date(date - 1)), offseti(date, 1), floori(date), date;\n  };\n\n  interval.round = function(date) {\n    var d0 = interval(date),\n        d1 = interval.ceil(date);\n    return date - d0 < d1 - date ? d0 : d1;\n  };\n\n  interval.offset = function(date, step) {\n    return offseti(date = new Date(+date), step == null ? 1 : Math.floor(step)), date;\n  };\n\n  interval.range = function(start, stop, step) {\n    var range = [], previous;\n    start = interval.ceil(start);\n    step = step == null ? 1 : Math.floor(step);\n    if (!(start < stop) || !(step > 0)) return range; // also handles Invalid Date\n    do range.push(previous = new Date(+start)), offseti(start, step), floori(start);\n    while (previous < start && start < stop);\n    return range;\n  };\n\n  interval.filter = function(test) {\n    return newInterval(function(date) {\n      if (date >= date) while (floori(date), !test(date)) date.setTime(date - 1);\n    }, function(date, step) {\n      if (date >= date) {\n        if (step < 0) while (++step <= 0) {\n          while (offseti(date, -1), !test(date)) {} // eslint-disable-line no-empty\n        } else while (--step >= 0) {\n          while (offseti(date, +1), !test(date)) {} // eslint-disable-line no-empty\n        }\n      }\n    });\n  };\n\n  if (count) {\n    interval.count = function(start, end) {\n      t0.setTime(+start), t1.setTime(+end);\n      floori(t0), floori(t1);\n      return Math.floor(count(t0, t1));\n    };\n\n    interval.every = function(step) {\n      step = Math.floor(step);\n      return !isFinite(step) || !(step > 0) ? null\n          : !(step > 1) ? interval\n          : interval.filter(field\n              ? function(d) { return field(d) % step === 0; }\n              : function(d) { return interval.count(0, d) % step === 0; });\n    };\n  }\n\n  return interval;\n}\n","export const durationSecond = 1000;\nexport const durationMinute = durationSecond * 60;\nexport const durationHour = durationMinute * 60;\nexport const durationDay = durationHour * 24;\nexport const durationWeek = durationDay * 7;\nexport const durationMonth = durationDay * 30;\nexport const durationYear = durationDay * 365;\n","import interval from \"./interval.js\";\nimport {durationWeek} from \"./duration.js\";\n\nfunction utcWeekday(i) {\n  return interval(function(date) {\n    date.setUTCDate(date.getUTCDate() - (date.getUTCDay() + 7 - i) % 7);\n    date.setUTCHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setUTCDate(date.getUTCDate() + step * 7);\n  }, function(start, end) {\n    return (end - start) / durationWeek;\n  });\n}\n\nexport var utcSunday = utcWeekday(0);\nexport var utcMonday = utcWeekday(1);\nexport var utcTuesday = utcWeekday(2);\nexport var utcWednesday = utcWeekday(3);\nexport var utcThursday = utcWeekday(4);\nexport var utcFriday = utcWeekday(5);\nexport var utcSaturday = utcWeekday(6);\n\nexport var utcSundays = utcSunday.range;\nexport var utcMondays = utcMonday.range;\nexport var utcTuesdays = utcTuesday.range;\nexport var utcWednesdays = utcWednesday.range;\nexport var utcThursdays = utcThursday.range;\nexport var utcFridays = utcFriday.range;\nexport var utcSaturdays = utcSaturday.range;\n","import interval from \"./interval.js\";\nimport {durationDay} from \"./duration.js\";\n\nvar utcDay = interval(function(date) {\n  date.setUTCHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setUTCDate(date.getUTCDate() + step);\n}, function(start, end) {\n  return (end - start) / durationDay;\n}, function(date) {\n  return date.getUTCDate() - 1;\n});\n\nexport default utcDay;\nexport var utcDays = utcDay.range;\n","import interval from \"./interval.js\";\nimport {durationMinute, durationWeek} from \"./duration.js\";\n\nfunction weekday(i) {\n  return interval(function(date) {\n    date.setDate(date.getDate() - (date.getDay() + 7 - i) % 7);\n    date.setHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setDate(date.getDate() + step * 7);\n  }, function(start, end) {\n    return (end - start - (end.getTimezoneOffset() - start.getTimezoneOffset()) * durationMinute) / durationWeek;\n  });\n}\n\nexport var sunday = weekday(0);\nexport var monday = weekday(1);\nexport var tuesday = weekday(2);\nexport var wednesday = weekday(3);\nexport var thursday = weekday(4);\nexport var friday = weekday(5);\nexport var saturday = weekday(6);\n\nexport var sundays = sunday.range;\nexport var mondays = monday.range;\nexport var tuesdays = tuesday.range;\nexport var wednesdays = wednesday.range;\nexport var thursdays = thursday.range;\nexport var fridays = friday.range;\nexport var saturdays = saturday.range;\n","import interval from \"./interval.js\";\nimport {durationDay, durationMinute} from \"./duration.js\";\n\nvar day = interval(\n  date => date.setHours(0, 0, 0, 0),\n  (date, step) => date.setDate(date.getDate() + step),\n  (start, end) => (end - start - (end.getTimezoneOffset() - start.getTimezoneOffset()) * durationMinute) / durationDay,\n  date => date.getDate() - 1\n);\n\nexport default day;\nexport var days = day.range;\n","import interval from \"./interval.js\";\n\nvar year = interval(function(date) {\n  date.setMonth(0, 1);\n  date.setHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setFullYear(date.getFullYear() + step);\n}, function(start, end) {\n  return end.getFullYear() - start.getFullYear();\n}, function(date) {\n  return date.getFullYear();\n});\n\n// An optimized implementation for this simple case.\nyear.every = function(k) {\n  return !isFinite(k = Math.floor(k)) || !(k > 0) ? null : interval(function(date) {\n    date.setFullYear(Math.floor(date.getFullYear() / k) * k);\n    date.setMonth(0, 1);\n    date.setHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setFullYear(date.getFullYear() + step * k);\n  });\n};\n\nexport default year;\nexport var years = year.range;\n","import interval from \"./interval.js\";\n\nvar utcYear = interval(function(date) {\n  date.setUTCMonth(0, 1);\n  date.setUTCHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setUTCFullYear(date.getUTCFullYear() + step);\n}, function(start, end) {\n  return end.getUTCFullYear() - start.getUTCFullYear();\n}, function(date) {\n  return date.getUTCFullYear();\n});\n\n// An optimized implementation for this simple case.\nutcYear.every = function(k) {\n  return !isFinite(k = Math.floor(k)) || !(k > 0) ? null : interval(function(date) {\n    date.setUTCFullYear(Math.floor(date.getUTCFullYear() / k) * k);\n    date.setUTCMonth(0, 1);\n    date.setUTCHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setUTCFullYear(date.getUTCFullYear() + step * k);\n  });\n};\n\nexport default utcYear;\nexport var utcYears = utcYear.range;\n","import {\n  timeDay,\n  timeSunday,\n  timeMonday,\n  timeThursday,\n  timeYear,\n  utcDay,\n  utcSunday,\n  utcMonday,\n  utcThursday,\n  utcYear\n} from \"d3-time\";\n\nfunction localDate(d) {\n  if (0 <= d.y && d.y < 100) {\n    var date = new Date(-1, d.m, d.d, d.H, d.M, d.S, d.L);\n    date.setFullYear(d.y);\n    return date;\n  }\n  return new Date(d.y, d.m, d.d, d.H, d.M, d.S, d.L);\n}\n\nfunction utcDate(d) {\n  if (0 <= d.y && d.y < 100) {\n    var date = new Date(Date.UTC(-1, d.m, d.d, d.H, d.M, d.S, d.L));\n    date.setUTCFullYear(d.y);\n    return date;\n  }\n  return new Date(Date.UTC(d.y, d.m, d.d, d.H, d.M, d.S, d.L));\n}\n\nfunction newDate(y, m, d) {\n  return {y: y, m: m, d: d, H: 0, M: 0, S: 0, L: 0};\n}\n\nexport default function formatLocale(locale) {\n  var locale_dateTime = locale.dateTime,\n      locale_date = locale.date,\n      locale_time = locale.time,\n      locale_periods = locale.periods,\n      locale_weekdays = locale.days,\n      locale_shortWeekdays = locale.shortDays,\n      locale_months = locale.months,\n      locale_shortMonths = locale.shortMonths;\n\n  var periodRe = formatRe(locale_periods),\n      periodLookup = formatLookup(locale_periods),\n      weekdayRe = formatRe(locale_weekdays),\n      weekdayLookup = formatLookup(locale_weekdays),\n      shortWeekdayRe = formatRe(locale_shortWeekdays),\n      shortWeekdayLookup = formatLookup(locale_shortWeekdays),\n      monthRe = formatRe(locale_months),\n      monthLookup = formatLookup(locale_months),\n      shortMonthRe = formatRe(locale_shortMonths),\n      shortMonthLookup = formatLookup(locale_shortMonths);\n\n  var formats = {\n    \"a\": formatShortWeekday,\n    \"A\": formatWeekday,\n    \"b\": formatShortMonth,\n    \"B\": formatMonth,\n    \"c\": null,\n    \"d\": formatDayOfMonth,\n    \"e\": formatDayOfMonth,\n    \"f\": formatMicroseconds,\n    \"g\": formatYearISO,\n    \"G\": formatFullYearISO,\n    \"H\": formatHour24,\n    \"I\": formatHour12,\n    \"j\": formatDayOfYear,\n    \"L\": formatMilliseconds,\n    \"m\": formatMonthNumber,\n    \"M\": formatMinutes,\n    \"p\": formatPeriod,\n    \"q\": formatQuarter,\n    \"Q\": formatUnixTimestamp,\n    \"s\": formatUnixTimestampSeconds,\n    \"S\": formatSeconds,\n    \"u\": formatWeekdayNumberMonday,\n    \"U\": formatWeekNumberSunday,\n    \"V\": formatWeekNumberISO,\n    \"w\": formatWeekdayNumberSunday,\n    \"W\": formatWeekNumberMonday,\n    \"x\": null,\n    \"X\": null,\n    \"y\": formatYear,\n    \"Y\": formatFullYear,\n    \"Z\": formatZone,\n    \"%\": formatLiteralPercent\n  };\n\n  var utcFormats = {\n    \"a\": formatUTCShortWeekday,\n    \"A\": formatUTCWeekday,\n    \"b\": formatUTCShortMonth,\n    \"B\": formatUTCMonth,\n    \"c\": null,\n    \"d\": formatUTCDayOfMonth,\n    \"e\": formatUTCDayOfMonth,\n    \"f\": formatUTCMicroseconds,\n    \"g\": formatUTCYearISO,\n    \"G\": formatUTCFullYearISO,\n    \"H\": formatUTCHour24,\n    \"I\": formatUTCHour12,\n    \"j\": formatUTCDayOfYear,\n    \"L\": formatUTCMilliseconds,\n    \"m\": formatUTCMonthNumber,\n    \"M\": formatUTCMinutes,\n    \"p\": formatUTCPeriod,\n    \"q\": formatUTCQuarter,\n    \"Q\": formatUnixTimestamp,\n    \"s\": formatUnixTimestampSeconds,\n    \"S\": formatUTCSeconds,\n    \"u\": formatUTCWeekdayNumberMonday,\n    \"U\": formatUTCWeekNumberSunday,\n    \"V\": formatUTCWeekNumberISO,\n    \"w\": formatUTCWeekdayNumberSunday,\n    \"W\": formatUTCWeekNumberMonday,\n    \"x\": null,\n    \"X\": null,\n    \"y\": formatUTCYear,\n    \"Y\": formatUTCFullYear,\n    \"Z\": formatUTCZone,\n    \"%\": formatLiteralPercent\n  };\n\n  var parses = {\n    \"a\": parseShortWeekday,\n    \"A\": parseWeekday,\n    \"b\": parseShortMonth,\n    \"B\": parseMonth,\n    \"c\": parseLocaleDateTime,\n    \"d\": parseDayOfMonth,\n    \"e\": parseDayOfMonth,\n    \"f\": parseMicroseconds,\n    \"g\": parseYear,\n    \"G\": parseFullYear,\n    \"H\": parseHour24,\n    \"I\": parseHour24,\n    \"j\": parseDayOfYear,\n    \"L\": parseMilliseconds,\n    \"m\": parseMonthNumber,\n    \"M\": parseMinutes,\n    \"p\": parsePeriod,\n    \"q\": parseQuarter,\n    \"Q\": parseUnixTimestamp,\n    \"s\": parseUnixTimestampSeconds,\n    \"S\": parseSeconds,\n    \"u\": parseWeekdayNumberMonday,\n    \"U\": parseWeekNumberSunday,\n    \"V\": parseWeekNumberISO,\n    \"w\": parseWeekdayNumberSunday,\n    \"W\": parseWeekNumberMonday,\n    \"x\": parseLocaleDate,\n    \"X\": parseLocaleTime,\n    \"y\": parseYear,\n    \"Y\": parseFullYear,\n    \"Z\": parseZone,\n    \"%\": parseLiteralPercent\n  };\n\n  // These recursive directive definitions must be deferred.\n  formats.x = newFormat(locale_date, formats);\n  formats.X = newFormat(locale_time, formats);\n  formats.c = newFormat(locale_dateTime, formats);\n  utcFormats.x = newFormat(locale_date, utcFormats);\n  utcFormats.X = newFormat(locale_time, utcFormats);\n  utcFormats.c = newFormat(locale_dateTime, utcFormats);\n\n  function newFormat(specifier, formats) {\n    return function(date) {\n      var string = [],\n          i = -1,\n          j = 0,\n          n = specifier.length,\n          c,\n          pad,\n          format;\n\n      if (!(date instanceof Date)) date = new Date(+date);\n\n      while (++i < n) {\n        if (specifier.charCodeAt(i) === 37) {\n          string.push(specifier.slice(j, i));\n          if ((pad = pads[c = specifier.charAt(++i)]) != null) c = specifier.charAt(++i);\n          else pad = c === \"e\" ? \" \" : \"0\";\n          if (format = formats[c]) c = format(date, pad);\n          string.push(c);\n          j = i + 1;\n        }\n      }\n\n      string.push(specifier.slice(j, i));\n      return string.join(\"\");\n    };\n  }\n\n  function newParse(specifier, Z) {\n    return function(string) {\n      var d = newDate(1900, undefined, 1),\n          i = parseSpecifier(d, specifier, string += \"\", 0),\n          week, day;\n      if (i != string.length) return null;\n\n      // If a UNIX timestamp is specified, return it.\n      if (\"Q\" in d) return new Date(d.Q);\n      if (\"s\" in d) return new Date(d.s * 1000 + (\"L\" in d ? d.L : 0));\n\n      // If this is utcParse, never use the local timezone.\n      if (Z && !(\"Z\" in d)) d.Z = 0;\n\n      // The am-pm flag is 0 for AM, and 1 for PM.\n      if (\"p\" in d) d.H = d.H % 12 + d.p * 12;\n\n      // If the month was not specified, inherit from the quarter.\n      if (d.m === undefined) d.m = \"q\" in d ? d.q : 0;\n\n      // Convert day-of-week and week-of-year to day-of-year.\n      if (\"V\" in d) {\n        if (d.V < 1 || d.V > 53) return null;\n        if (!(\"w\" in d)) d.w = 1;\n        if (\"Z\" in d) {\n          week = utcDate(newDate(d.y, 0, 1)), day = week.getUTCDay();\n          week = day > 4 || day === 0 ? utcMonday.ceil(week) : utcMonday(week);\n          week = utcDay.offset(week, (d.V - 1) * 7);\n          d.y = week.getUTCFullYear();\n          d.m = week.getUTCMonth();\n          d.d = week.getUTCDate() + (d.w + 6) % 7;\n        } else {\n          week = localDate(newDate(d.y, 0, 1)), day = week.getDay();\n          week = day > 4 || day === 0 ? timeMonday.ceil(week) : timeMonday(week);\n          week = timeDay.offset(week, (d.V - 1) * 7);\n          d.y = week.getFullYear();\n          d.m = week.getMonth();\n          d.d = week.getDate() + (d.w + 6) % 7;\n        }\n      } else if (\"W\" in d || \"U\" in d) {\n        if (!(\"w\" in d)) d.w = \"u\" in d ? d.u % 7 : \"W\" in d ? 1 : 0;\n        day = \"Z\" in d ? utcDate(newDate(d.y, 0, 1)).getUTCDay() : localDate(newDate(d.y, 0, 1)).getDay();\n        d.m = 0;\n        d.d = \"W\" in d ? (d.w + 6) % 7 + d.W * 7 - (day + 5) % 7 : d.w + d.U * 7 - (day + 6) % 7;\n      }\n\n      // If a time zone is specified, all fields are interpreted as UTC and then\n      // offset according to the specified time zone.\n      if (\"Z\" in d) {\n        d.H += d.Z / 100 | 0;\n        d.M += d.Z % 100;\n        return utcDate(d);\n      }\n\n      // Otherwise, all fields are in local time.\n      return localDate(d);\n    };\n  }\n\n  function parseSpecifier(d, specifier, string, j) {\n    var i = 0,\n        n = specifier.length,\n        m = string.length,\n        c,\n        parse;\n\n    while (i < n) {\n      if (j >= m) return -1;\n      c = specifier.charCodeAt(i++);\n      if (c === 37) {\n        c = specifier.charAt(i++);\n        parse = parses[c in pads ? specifier.charAt(i++) : c];\n        if (!parse || ((j = parse(d, string, j)) < 0)) return -1;\n      } else if (c != string.charCodeAt(j++)) {\n        return -1;\n      }\n    }\n\n    return j;\n  }\n\n  function parsePeriod(d, string, i) {\n    var n = periodRe.exec(string.slice(i));\n    return n ? (d.p = periodLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\n  }\n\n  function parseShortWeekday(d, string, i) {\n    var n = shortWeekdayRe.exec(string.slice(i));\n    return n ? (d.w = shortWeekdayLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\n  }\n\n  function parseWeekday(d, string, i) {\n    var n = weekdayRe.exec(string.slice(i));\n    return n ? (d.w = weekdayLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\n  }\n\n  function parseShortMonth(d, string, i) {\n    var n = shortMonthRe.exec(string.slice(i));\n    return n ? (d.m = shortMonthLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\n  }\n\n  function parseMonth(d, string, i) {\n    var n = monthRe.exec(string.slice(i));\n    return n ? (d.m = monthLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\n  }\n\n  function parseLocaleDateTime(d, string, i) {\n    return parseSpecifier(d, locale_dateTime, string, i);\n  }\n\n  function parseLocaleDate(d, string, i) {\n    return parseSpecifier(d, locale_date, string, i);\n  }\n\n  function parseLocaleTime(d, string, i) {\n    return parseSpecifier(d, locale_time, string, i);\n  }\n\n  function formatShortWeekday(d) {\n    return locale_shortWeekdays[d.getDay()];\n  }\n\n  function formatWeekday(d) {\n    return locale_weekdays[d.getDay()];\n  }\n\n  function formatShortMonth(d) {\n    return locale_shortMonths[d.getMonth()];\n  }\n\n  function formatMonth(d) {\n    return locale_months[d.getMonth()];\n  }\n\n  function formatPeriod(d) {\n    return locale_periods[+(d.getHours() >= 12)];\n  }\n\n  function formatQuarter(d) {\n    return 1 + ~~(d.getMonth() / 3);\n  }\n\n  function formatUTCShortWeekday(d) {\n    return locale_shortWeekdays[d.getUTCDay()];\n  }\n\n  function formatUTCWeekday(d) {\n    return locale_weekdays[d.getUTCDay()];\n  }\n\n  function formatUTCShortMonth(d) {\n    return locale_shortMonths[d.getUTCMonth()];\n  }\n\n  function formatUTCMonth(d) {\n    return locale_months[d.getUTCMonth()];\n  }\n\n  function formatUTCPeriod(d) {\n    return locale_periods[+(d.getUTCHours() >= 12)];\n  }\n\n  function formatUTCQuarter(d) {\n    return 1 + ~~(d.getUTCMonth() / 3);\n  }\n\n  return {\n    format: function(specifier) {\n      var f = newFormat(specifier += \"\", formats);\n      f.toString = function() { return specifier; };\n      return f;\n    },\n    parse: function(specifier) {\n      var p = newParse(specifier += \"\", false);\n      p.toString = function() { return specifier; };\n      return p;\n    },\n    utcFormat: function(specifier) {\n      var f = newFormat(specifier += \"\", utcFormats);\n      f.toString = function() { return specifier; };\n      return f;\n    },\n    utcParse: function(specifier) {\n      var p = newParse(specifier += \"\", true);\n      p.toString = function() { return specifier; };\n      return p;\n    }\n  };\n}\n\nvar pads = {\"-\": \"\", \"_\": \" \", \"0\": \"0\"},\n    numberRe = /^\\s*\\d+/, // note: ignores next directive\n    percentRe = /^%/,\n    requoteRe = /[\\\\^$*+?|[\\]().{}]/g;\n\nfunction pad(value, fill, width) {\n  var sign = value < 0 ? \"-\" : \"\",\n      string = (sign ? -value : value) + \"\",\n      length = string.length;\n  return sign + (length < width ? new Array(width - length + 1).join(fill) + string : string);\n}\n\nfunction requote(s) {\n  return s.replace(requoteRe, \"\\\\$&\");\n}\n\nfunction formatRe(names) {\n  return new RegExp(\"^(?:\" + names.map(requote).join(\"|\") + \")\", \"i\");\n}\n\nfunction formatLookup(names) {\n  return new Map(names.map((name, i) => [name.toLowerCase(), i]));\n}\n\nfunction parseWeekdayNumberSunday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 1));\n  return n ? (d.w = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekdayNumberMonday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 1));\n  return n ? (d.u = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekNumberSunday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.U = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekNumberISO(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.V = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekNumberMonday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.W = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseFullYear(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 4));\n  return n ? (d.y = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseYear(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.y = +n[0] + (+n[0] > 68 ? 1900 : 2000), i + n[0].length) : -1;\n}\n\nfunction parseZone(d, string, i) {\n  var n = /^(Z)|([+-]\\d\\d)(?::?(\\d\\d))?/.exec(string.slice(i, i + 6));\n  return n ? (d.Z = n[1] ? 0 : -(n[2] + (n[3] || \"00\")), i + n[0].length) : -1;\n}\n\nfunction parseQuarter(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 1));\n  return n ? (d.q = n[0] * 3 - 3, i + n[0].length) : -1;\n}\n\nfunction parseMonthNumber(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.m = n[0] - 1, i + n[0].length) : -1;\n}\n\nfunction parseDayOfMonth(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.d = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseDayOfYear(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 3));\n  return n ? (d.m = 0, d.d = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseHour24(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.H = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseMinutes(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.M = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseSeconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.S = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseMilliseconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 3));\n  return n ? (d.L = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseMicroseconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 6));\n  return n ? (d.L = Math.floor(n[0] / 1000), i + n[0].length) : -1;\n}\n\nfunction parseLiteralPercent(d, string, i) {\n  var n = percentRe.exec(string.slice(i, i + 1));\n  return n ? i + n[0].length : -1;\n}\n\nfunction parseUnixTimestamp(d, string, i) {\n  var n = numberRe.exec(string.slice(i));\n  return n ? (d.Q = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseUnixTimestampSeconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i));\n  return n ? (d.s = +n[0], i + n[0].length) : -1;\n}\n\nfunction formatDayOfMonth(d, p) {\n  return pad(d.getDate(), p, 2);\n}\n\nfunction formatHour24(d, p) {\n  return pad(d.getHours(), p, 2);\n}\n\nfunction formatHour12(d, p) {\n  return pad(d.getHours() % 12 || 12, p, 2);\n}\n\nfunction formatDayOfYear(d, p) {\n  return pad(1 + timeDay.count(timeYear(d), d), p, 3);\n}\n\nfunction formatMilliseconds(d, p) {\n  return pad(d.getMilliseconds(), p, 3);\n}\n\nfunction formatMicroseconds(d, p) {\n  return formatMilliseconds(d, p) + \"000\";\n}\n\nfunction formatMonthNumber(d, p) {\n  return pad(d.getMonth() + 1, p, 2);\n}\n\nfunction formatMinutes(d, p) {\n  return pad(d.getMinutes(), p, 2);\n}\n\nfunction formatSeconds(d, p) {\n  return pad(d.getSeconds(), p, 2);\n}\n\nfunction formatWeekdayNumberMonday(d) {\n  var day = d.getDay();\n  return day === 0 ? 7 : day;\n}\n\nfunction formatWeekNumberSunday(d, p) {\n  return pad(timeSunday.count(timeYear(d) - 1, d), p, 2);\n}\n\nfunction dISO(d) {\n  var day = d.getDay();\n  return (day >= 4 || day === 0) ? timeThursday(d) : timeThursday.ceil(d);\n}\n\nfunction formatWeekNumberISO(d, p) {\n  d = dISO(d);\n  return pad(timeThursday.count(timeYear(d), d) + (timeYear(d).getDay() === 4), p, 2);\n}\n\nfunction formatWeekdayNumberSunday(d) {\n  return d.getDay();\n}\n\nfunction formatWeekNumberMonday(d, p) {\n  return pad(timeMonday.count(timeYear(d) - 1, d), p, 2);\n}\n\nfunction formatYear(d, p) {\n  return pad(d.getFullYear() % 100, p, 2);\n}\n\nfunction formatYearISO(d, p) {\n  d = dISO(d);\n  return pad(d.getFullYear() % 100, p, 2);\n}\n\nfunction formatFullYear(d, p) {\n  return pad(d.getFullYear() % 10000, p, 4);\n}\n\nfunction formatFullYearISO(d, p) {\n  var day = d.getDay();\n  d = (day >= 4 || day === 0) ? timeThursday(d) : timeThursday.ceil(d);\n  return pad(d.getFullYear() % 10000, p, 4);\n}\n\nfunction formatZone(d) {\n  var z = d.getTimezoneOffset();\n  return (z > 0 ? \"-\" : (z *= -1, \"+\"))\n      + pad(z / 60 | 0, \"0\", 2)\n      + pad(z % 60, \"0\", 2);\n}\n\nfunction formatUTCDayOfMonth(d, p) {\n  return pad(d.getUTCDate(), p, 2);\n}\n\nfunction formatUTCHour24(d, p) {\n  return pad(d.getUTCHours(), p, 2);\n}\n\nfunction formatUTCHour12(d, p) {\n  return pad(d.getUTCHours() % 12 || 12, p, 2);\n}\n\nfunction formatUTCDayOfYear(d, p) {\n  return pad(1 + utcDay.count(utcYear(d), d), p, 3);\n}\n\nfunction formatUTCMilliseconds(d, p) {\n  return pad(d.getUTCMilliseconds(), p, 3);\n}\n\nfunction formatUTCMicroseconds(d, p) {\n  return formatUTCMilliseconds(d, p) + \"000\";\n}\n\nfunction formatUTCMonthNumber(d, p) {\n  return pad(d.getUTCMonth() + 1, p, 2);\n}\n\nfunction formatUTCMinutes(d, p) {\n  return pad(d.getUTCMinutes(), p, 2);\n}\n\nfunction formatUTCSeconds(d, p) {\n  return pad(d.getUTCSeconds(), p, 2);\n}\n\nfunction formatUTCWeekdayNumberMonday(d) {\n  var dow = d.getUTCDay();\n  return dow === 0 ? 7 : dow;\n}\n\nfunction formatUTCWeekNumberSunday(d, p) {\n  return pad(utcSunday.count(utcYear(d) - 1, d), p, 2);\n}\n\nfunction UTCdISO(d) {\n  var day = d.getUTCDay();\n  return (day >= 4 || day === 0) ? utcThursday(d) : utcThursday.ceil(d);\n}\n\nfunction formatUTCWeekNumberISO(d, p) {\n  d = UTCdISO(d);\n  return pad(utcThursday.count(utcYear(d), d) + (utcYear(d).getUTCDay() === 4), p, 2);\n}\n\nfunction formatUTCWeekdayNumberSunday(d) {\n  return d.getUTCDay();\n}\n\nfunction formatUTCWeekNumberMonday(d, p) {\n  return pad(utcMonday.count(utcYear(d) - 1, d), p, 2);\n}\n\nfunction formatUTCYear(d, p) {\n  return pad(d.getUTCFullYear() % 100, p, 2);\n}\n\nfunction formatUTCYearISO(d, p) {\n  d = UTCdISO(d);\n  return pad(d.getUTCFullYear() % 100, p, 2);\n}\n\nfunction formatUTCFullYear(d, p) {\n  return pad(d.getUTCFullYear() % 10000, p, 4);\n}\n\nfunction formatUTCFullYearISO(d, p) {\n  var day = d.getUTCDay();\n  d = (day >= 4 || day === 0) ? utcThursday(d) : utcThursday.ceil(d);\n  return pad(d.getUTCFullYear() % 10000, p, 4);\n}\n\nfunction formatUTCZone() {\n  return \"+0000\";\n}\n\nfunction formatLiteralPercent() {\n  return \"%\";\n}\n\nfunction formatUnixTimestamp(d) {\n  return +d;\n}\n\nfunction formatUnixTimestampSeconds(d) {\n  return Math.floor(+d / 1000);\n}\n","import formatLocale from \"./locale.js\";\n\nvar locale;\nexport var timeFormat;\nexport var timeParse;\nexport var utcFormat;\nexport var utcParse;\n\ndefaultLocale({\n  dateTime: \"%x, %X\",\n  date: \"%-m/%-d/%Y\",\n  time: \"%-I:%M:%S %p\",\n  periods: [\"AM\", \"PM\"],\n  days: [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"],\n  shortDays: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"],\n  months: [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"],\n  shortMonths: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"]\n});\n\nexport default function defaultLocale(definition) {\n  locale = formatLocale(definition);\n  timeFormat = locale.format;\n  timeParse = locale.parse;\n  utcFormat = locale.utcFormat;\n  utcParse = locale.utcParse;\n  return locale;\n}\n","import interval from \"./interval.js\";\n\nvar month = interval(function(date) {\n  date.setDate(1);\n  date.setHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setMonth(date.getMonth() + step);\n}, function(start, end) {\n  return end.getMonth() - start.getMonth() + (end.getFullYear() - start.getFullYear()) * 12;\n}, function(date) {\n  return date.getMonth();\n});\n\nexport default month;\nexport var months = month.range;\n","import interval from \"./interval.js\";\nimport {durationHour, durationMinute, durationSecond} from \"./duration.js\";\n\nvar hour = interval(function(date) {\n  date.setTime(date - date.getMilliseconds() - date.getSeconds() * durationSecond - date.getMinutes() * durationMinute);\n}, function(date, step) {\n  date.setTime(+date + step * durationHour);\n}, function(start, end) {\n  return (end - start) / durationHour;\n}, function(date) {\n  return date.getHours();\n});\n\nexport default hour;\nexport var hours = hour.range;\n","import interval from \"./interval.js\";\nimport {durationMinute, durationSecond} from \"./duration.js\";\n\nvar minute = interval(function(date) {\n  date.setTime(date - date.getMilliseconds() - date.getSeconds() * durationSecond);\n}, function(date, step) {\n  date.setTime(+date + step * durationMinute);\n}, function(start, end) {\n  return (end - start) / durationMinute;\n}, function(date) {\n  return date.getMinutes();\n});\n\nexport default minute;\nexport var minutes = minute.range;\n","import interval from \"./interval.js\";\nimport {durationSecond} from \"./duration.js\";\n\nvar second = interval(function(date) {\n  date.setTime(date - date.getMilliseconds());\n}, function(date, step) {\n  date.setTime(+date + step * durationSecond);\n}, function(start, end) {\n  return (end - start) / durationSecond;\n}, function(date) {\n  return date.getUTCSeconds();\n});\n\nexport default second;\nexport var seconds = second.range;\n","import { timeDay, timeHour, timeMinute, timeMonth, timeSecond, timeWeek } from 'd3-time';\nimport { timeFormat } from 'd3-time-format';\nimport { equal, ISequence, isSeqEmpty } from '../internal';\nimport type { INumberFilter } from './INumberColumn';\nimport { isNumberIncluded } from './internalNumber';\nimport type { IDateColumn, IDateGrouper } from './IDateColumn';\nimport type { IDataRow } from './interfaces';\n\n/** @internal */\nexport {\n  isDummyNumberFilter as isDummyDateFilter,\n  isEqualNumberFilter as isEqualDateFilter,\n  noNumberFilter as noDateFilter,\n  restoreNumberFilter as restoreDateFilter,\n} from './internalNumber';\n\n/** @internal */\nexport function isDateIncluded(filter: INumberFilter | null, value: Date | null) {\n  if (!filter) {\n    return true;\n  }\n  if (value == null || !(value instanceof Date)) {\n    return !filter.filterMissing;\n  }\n  return isNumberIncluded(filter, value!.getTime());\n}\n\n/**\n * shifts the given date such that it is on 23:59:59, or 00:00:00\n * @internal\n */\nexport function shiftFilterDateDay(date: number, type: 'min' | 'max') {\n  const d = new Date(date);\n  if (type === 'max') {\n    d.setHours(23);\n    d.setMinutes(59);\n    d.setSeconds(59);\n    d.setMilliseconds(999);\n  } else {\n    d.setHours(0);\n    d.setMinutes(0);\n    d.setSeconds(0);\n    d.setMilliseconds(0);\n  }\n  return d.getTime();\n}\n\n/**\n * @internal\n */\nexport function defaultDateGrouper(): IDateGrouper {\n  return { granularity: 'month', circular: false };\n}\n\n/**\n * @internal\n */\nexport function isDefaultDateGrouper(grouper: IDateGrouper) {\n  return equal(defaultDateGrouper(), grouper);\n}\n\n/**\n * convert the given date to the desired grouper\n * @internal\n */\nexport function toDateGroup(grouper: IDateGrouper, value: Date): { value: number; name: string } {\n  switch (grouper.granularity) {\n    case 'century':\n      const centuryP = Math.floor(value.getFullYear() / 100);\n      if (grouper.circular) {\n        const century = centuryP % 10;\n        return {\n          value: century,\n          name: `*${century}00`,\n        };\n      }\n      return {\n        value: centuryP,\n        name: `${centuryP}00`,\n      };\n    case 'decade':\n      const decadeP = Math.floor(value.getFullYear() / 10);\n      if (grouper.circular) {\n        const decade = decadeP % 10;\n        return {\n          value: decade,\n          name: `**${decade}0`,\n        };\n      }\n      return {\n        value: decadeP,\n        name: `${decadeP}0`,\n      };\n    case 'year':\n      if (grouper.circular) {\n        const year = value.getFullYear() % 10;\n        return {\n          value: year,\n          name: `***${year}`,\n        };\n      }\n      return {\n        value: value.getFullYear(),\n        name: String(value.getFullYear()),\n      };\n    case 'month':\n      if (grouper.circular) {\n        return {\n          value: value.getMonth(),\n          name: timeFormat('%B')(value),\n        };\n      }\n      return {\n        value: timeMonth(value).getTime(),\n        name: timeFormat('%B %Y')(value),\n      };\n    case 'week':\n      if (grouper.circular) {\n        return {\n          value: value.getMonth(),\n          name: timeFormat('%W')(value),\n        };\n      }\n      return {\n        value: timeWeek(value).getTime(),\n        name: timeFormat('%W %Y')(value),\n      };\n    case 'day_of_week':\n      if (grouper.circular) {\n        return {\n          value: value.getDay(),\n          name: timeFormat('%A')(value),\n        };\n      }\n      return {\n        value: timeDay(value).getTime(),\n        name: timeFormat('%x')(value),\n      };\n    case 'day_of_month':\n      if (grouper.circular) {\n        return {\n          value: value.getDate(),\n          name: timeFormat('%d')(value),\n        };\n      }\n      return {\n        value: timeDay(value).getTime(),\n        name: timeFormat('%x')(value),\n      };\n    case 'day_of_year':\n      if (grouper.circular) {\n        // %j = day of year\n        const v = timeFormat('%j')(value);\n        return {\n          value: Number.parseInt(v, 10),\n          name: v,\n        };\n      }\n      return {\n        value: timeDay(value).getTime(),\n        name: timeFormat('%x')(value),\n      };\n    case 'hour':\n      if (grouper.circular) {\n        return {\n          value: value.getHours(),\n          name: timeFormat('%A')(value),\n        };\n      }\n      return {\n        value: timeHour(value).getTime(),\n        name: timeFormat('%x')(value),\n      };\n    case 'minute':\n      if (grouper.circular) {\n        return {\n          value: value.getMinutes(),\n          name: timeFormat('%A')(value),\n        };\n      }\n      return {\n        value: timeMinute(value).getTime(),\n        name: timeFormat('%x')(value),\n      };\n    case 'second':\n      if (grouper.circular) {\n        return {\n          value: value.getSeconds(),\n          name: timeFormat('%A')(value),\n        };\n      }\n      return {\n        value: timeSecond(value).getTime(),\n        name: timeFormat('%x')(value),\n      };\n  }\n}\n\n/**\n * @internal\n */\nexport function chooseAggregatedDate(\n  rows: ISequence<IDataRow>,\n  grouper: IDateGrouper | null,\n  col: IDateColumn,\n  valueCache?: ISequence<Date | null>\n): { value: number | null; name: string } {\n  const vs = (valueCache ? valueCache : rows.map((d) => col.getDate(d))).filter(\n    (d) => d instanceof Date\n  ) as ISequence<Date>;\n  if (isSeqEmpty(vs)) {\n    return { value: null, name: '' };\n  }\n  const median = trueMedian(vs.map((d) => d.getTime()))!;\n  if (!grouper) {\n    return { value: median, name: new Date(median).toString() };\n  }\n  return toDateGroup(grouper, new Date(median));\n}\n\nfunction trueMedian(dates: ISequence<number>) {\n  // to avoid interpolating between the centers do it manually\n  const s = Float64Array.from(dates);\n  if (s.length === 1) {\n    return s[0];\n  }\n\n  s.sort();\n  return s[Math.floor(s.length / 2)];\n}\n","import { timeFormat, timeParse } from 'd3-time-format';\nimport { ISequence, equal, IEventListener } from '../internal';\nimport { Category, dialogAddons, toolbar } from './annotations';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  groupRendererChanged,\n  labelChanged,\n  metaDataChanged,\n  rendererTypeChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n  DEFAULT_COLOR,\n} from './Column';\nimport type { IDateColumn, IDateDesc, IDateFilter, IDateGrouper } from './IDateColumn';\nimport { defaultGroup, IDataRow, IGroup, ECompareValueType, IValueColumnDesc, ITypeFactory } from './interfaces';\nimport { isMissingValue, isUnknown, missingGroup } from './missing';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport {\n  noDateFilter,\n  defaultDateGrouper,\n  isDummyDateFilter,\n  isDefaultDateGrouper,\n  restoreDateFilter,\n  isEqualDateFilter,\n  isDateIncluded,\n  toDateGroup,\n  chooseAggregatedDate,\n} from './internalDate';\nimport { integrateDefaults } from './internal';\n\nexport declare type IDateColumnDesc = IValueColumnDesc<Date> & IDateDesc;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf DateColumn\n * @event\n */\nexport declare function filterChanged_DC(previous: IDateFilter | null, current: IDateFilter | null): void;\n\n/**\n * emitted when the grouping property changes\n * @asMemberOf DateColumn\n * @event\n */\nexport declare function groupingChanged_DC(previous: IDateGrouper | null, current: IDateGrouper | null): void;\n\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'groupBy', 'sortGroupBy', 'filterDate')\n@dialogAddons('group', 'groupDate')\n@Category('date')\nexport default class DateColumn extends ValueColumn<Date> implements IDateColumn {\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\n  static readonly EVENT_GROUPING_CHANGED = 'groupingChanged';\n\n  static readonly DEFAULT_DATE_FORMAT = '%x';\n\n  private readonly format: (date: Date | null) => string;\n  private readonly parse: (date: string) => Date | null;\n\n  /**\n   * currently active filter\n   * @type {{min: number, max: number}}\n   * @private\n   */\n  private currentFilter: IDateFilter = noDateFilter();\n  private currentGrouper: IDateGrouper = defaultDateGrouper();\n\n  constructor(id: string, desc: Readonly<IDateColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        groupRenderer: 'datehistogram',\n        summaryRenderer: 'datehistogram',\n      })\n    );\n    const f = timeFormat(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\n    this.format = (v) => (v instanceof Date ? f(v) : '');\n    this.parse = desc.dateParse\n      ? timeParse(desc.dateParse)\n      : timeParse(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\n  }\n\n  getFormatter() {\n    return this.format;\n  }\n\n  dump(toDescRef: (desc: any) => any) {\n    const r = super.dump(toDescRef);\n    r.filter = isDummyDateFilter(this.currentFilter) ? null : this.currentFilter;\n    if (this.currentGrouper && !isDefaultDateGrouper(this.currentGrouper)) {\n      r.grouper = this.currentGrouper;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.filter) {\n      this.currentFilter = restoreDateFilter(dump.filter);\n    }\n    if (dump.grouper) {\n      this.currentGrouper = dump.grouper;\n    }\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([DateColumn.EVENT_FILTER_CHANGED, DateColumn.EVENT_GROUPING_CHANGED]);\n  }\n\n  on(type: typeof DateColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_DC | null): this;\n  on(type: typeof DateColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged_DC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow): Date | null {\n    return this.getDate(row);\n  }\n\n  getDate(row: IDataRow) {\n    const v = super.getValue(row);\n    if (isMissingValue(v)) {\n      return null;\n    }\n    if (v instanceof Date) {\n      return v;\n    }\n    return this.parse(String(v));\n  }\n\n  iterDate(row: IDataRow) {\n    return [this.getDate(row)];\n  }\n\n  getLabel(row: IDataRow) {\n    const v = this.getValue(row);\n    return this.format(v);\n  }\n\n  isFiltered() {\n    return !isDummyDateFilter(this.currentFilter);\n  }\n\n  clearFilter() {\n    const was = this.isFiltered();\n    this.setFilter(null);\n    return was;\n  }\n\n  getFilter(): IDateFilter {\n    return Object.assign({}, this.currentFilter);\n  }\n\n  setFilter(value: IDateFilter | null) {\n    value = value || { min: Number.NEGATIVE_INFINITY, max: Number.POSITIVE_INFINITY, filterMissing: false };\n    if (isEqualDateFilter(value, this.currentFilter)) {\n      return;\n    }\n    const bak = this.getFilter();\n    this.currentFilter.min = isUnknown(value.min) ? Number.NEGATIVE_INFINITY : value.min;\n    this.currentFilter.max = isUnknown(value.max) ? Number.POSITIVE_INFINITY : value.max;\n    this.currentFilter.filterMissing = value.filterMissing;\n    this.fire([DateColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, this.getFilter());\n  }\n\n  /**\n   * filter the current row if any filter is set\n   * @param row\n   * @returns {boolean}\n   */\n  filter(row: IDataRow, valueCache?: any) {\n    return isDateIncluded(this.currentFilter, valueCache !== undefined ? valueCache : this.getDate(row));\n  }\n\n  toCompareValue(row: IDataRow, valueCache?: any) {\n    const v = valueCache !== undefined ? valueCache : this.getValue(row);\n    if (!(v instanceof Date)) {\n      return NaN;\n    }\n    return v.getTime();\n  }\n\n  toCompareValueType() {\n    return ECompareValueType.DOUBLE_ASC;\n  }\n\n  getDateGrouper() {\n    return Object.assign({}, this.currentGrouper);\n  }\n\n  setDateGrouper(value: IDateGrouper) {\n    if (equal(this.currentGrouper, value)) {\n      return;\n    }\n    const bak = this.getDateGrouper();\n    this.currentGrouper = Object.assign({}, value);\n    this.fire([DateColumn.EVENT_GROUPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, value);\n  }\n\n  group(row: IDataRow, valueCache?: any): IGroup {\n    const v = valueCache !== undefined ? valueCache : this.getDate(row);\n    if (!v || !(v instanceof Date)) {\n      return Object.assign({}, missingGroup);\n    }\n    if (!this.currentGrouper) {\n      return Object.assign({}, defaultGroup);\n    }\n    const g = toDateGroup(this.currentGrouper, v);\n    return {\n      name: g.name,\n      color: DEFAULT_COLOR,\n    };\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, _group: IGroup, valueCache?: ISequence<any>): number {\n    const v = chooseAggregatedDate(rows, this.currentGrouper, this, valueCache).value;\n    return v == null ? NaN : v;\n  }\n\n  toCompareGroupValueType() {\n    return ECompareValueType.DOUBLE_ASC;\n  }\n}\n","import { timeFormat, timeParse } from 'd3-time-format';\nimport { median, min, max, IEventListener } from '../internal';\nimport { dialogAddons, toolbar } from './annotations';\nimport ArrayColumn, { IArrayColumnDesc } from './ArrayColumn';\nimport type {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type Column from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport type { IDateDesc, IDatesColumn, IDateFilter } from './IDateColumn';\nimport { IDataRow, ECompareValueType, ITypeFactory } from './interfaces';\nimport { isMissingValue } from './missing';\nimport DateColumn from './DateColumn';\nimport { noDateFilter, isDummyDateFilter, restoreDateFilter } from './internalDate';\nimport { chooseUIntByDataLength, integrateDefaults } from './internal';\n\nexport enum EDateSort {\n  min = 'min',\n  max = 'max',\n  median = 'median',\n}\n\nexport interface IDatesDesc extends IDateDesc {\n  sort?: EDateSort;\n}\n\nexport declare type IDatesColumnDesc = IDatesDesc & IArrayColumnDesc<Date>;\n\n/**\n * emitted when the sort method property changes\n * @asMemberOf DatesColumn\n * @event\n */\nexport declare function sortMethodChanged_DCS(previous: EDateSort, current: EDateSort): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf DatesColumn\n * @event\n */\nexport declare function filterChanged_DCS(previous: IDateFilter | null, current: IDateFilter | null): void;\n\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterDate')\n@dialogAddons('sort', 'sortDates')\nexport default class DatesColumn extends ArrayColumn<Date | null> implements IDatesColumn {\n  static readonly EVENT_SORTMETHOD_CHANGED = 'sortMethodChanged';\n  static readonly EVENT_FILTER_CHANGED = DateColumn.EVENT_FILTER_CHANGED;\n\n  private readonly format: (date: Date | null) => string;\n  private readonly parse: (date: string) => Date | null;\n  private sort: EDateSort;\n  private currentFilter: IDateFilter = noDateFilter();\n\n  constructor(id: string, desc: Readonly<IDatesColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'datehistogram',\n        groupRenderer: 'datehistogram',\n        summaryRenderer: 'datehistogram',\n      })\n    );\n    const f = timeFormat(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\n    this.format = (v) => (v instanceof Date ? f(v) : '');\n    this.parse = desc.dateParse\n      ? timeParse(desc.dateParse)\n      : timeParse(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\n    this.sort = desc.sort || EDateSort.median;\n  }\n\n  getFormatter() {\n    return this.format;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([DatesColumn.EVENT_SORTMETHOD_CHANGED, DatesColumn.EVENT_FILTER_CHANGED]);\n  }\n\n  on(type: typeof DatesColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_DCS | null): this;\n  on(type: typeof DatesColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_DCS | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow): (Date | null)[] | null {\n    const r = this.getDates(row);\n    return r.every((d) => d == null) ? null : r;\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getDates(row).map((v) => (v instanceof Date ? this.format(v) : ''));\n  }\n\n  getDates(row: IDataRow): (Date | null)[] {\n    return super.getValues(row).map((v) => {\n      if (isMissingValue(v)) {\n        return null;\n      }\n      if (v instanceof Date) {\n        return v;\n      }\n      return this.parse(String(v));\n    });\n  }\n\n  getDate(row: IDataRow) {\n    const av = this.getDates(row).filter(Boolean);\n    if (av.length === 0) {\n      return null;\n    }\n    return new Date(compute(av, this.sort));\n  }\n\n  iterDate(row: IDataRow) {\n    return this.getDates(row);\n  }\n\n  getSortMethod() {\n    return this.sort;\n  }\n\n  setSortMethod(sort: EDateSort) {\n    if (this.sort === sort) {\n      return;\n    }\n    this.fire([DatesColumn.EVENT_SORTMETHOD_CHANGED], this.sort, (this.sort = sort));\n    // sort by me if not already sorted by me\n    if (!this.isSortedByMe().asc) {\n      this.sortByMe();\n    }\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.sortMethod = this.getSortMethod();\n    r.filter = !isDummyDateFilter(this.currentFilter) ? this.currentFilter : null;\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.sortMethod) {\n      this.sort = dump.sortMethod;\n    }\n    if (dump.filter) {\n      this.currentFilter = restoreDateFilter(dump.filter);\n    }\n  }\n\n  toCompareValue(row: IDataRow) {\n    const vs = this.getDates(row).filter(Boolean);\n    if (!vs) {\n      return [0, 0];\n    }\n    return [vs.length, compute(vs, this.sort)];\n  }\n\n  toCompareValueType() {\n    return [chooseUIntByDataLength(this.dataLength), ECompareValueType.DOUBLE_ASC];\n  }\n\n  isFiltered() {\n    return DateColumn.prototype.isFiltered.call(this);\n  }\n\n  getFilter(): IDateFilter {\n    return DateColumn.prototype.getFilter.call(this);\n  }\n\n  setFilter(value: IDateFilter | null) {\n    DateColumn.prototype.setFilter.call(this, value);\n  }\n\n  filter(row: IDataRow) {\n    return DateColumn.prototype.filter.call(this, row);\n  }\n\n  clearFilter() {\n    return DateColumn.prototype.clearFilter.call(this);\n  }\n}\n\nfunction compute(arr: Date[], sort: EDateSort) {\n  switch (sort) {\n    case EDateSort.min:\n      return min(arr, (d) => d.getTime())!;\n    case EDateSort.max:\n      return max(arr, (d) => d.getTime())!;\n    case EDateSort.median:\n      return median(arr, (d) => d.getTime())!;\n  }\n}\n","import { timeFormat, timeParse } from 'd3-time-format';\nimport type { IDateColumn, IDateFilter } from './IDateColumn';\nimport type { IKeyValue } from './IArrayColumn';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport MapColumn, { IMapColumnDesc } from './MapColumn';\nimport { isMissingValue } from './missing';\nimport DatesColumn, { EDateSort, IDatesDesc } from './DatesColumn';\nimport DateColumn from './DateColumn';\nimport { dialogAddons, toolbar } from './annotations';\nimport type {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type Column from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport type { IEventListener } from '../internal';\nimport { noDateFilter, isDummyDateFilter, restoreDateFilter } from './internalDate';\nimport { integrateDefaults } from './internal';\n\nexport declare type IDateMapColumnDesc = IDatesDesc & IMapColumnDesc<Date | null>;\n\n/**\n * emitted when the sort method property changes\n * @asMemberOf DatesMapColumn\n * @event\n */\nexport declare function sortMethodChanged_DMC(previous: EDateSort, current: EDateSort): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf DatesMapColumn\n * @event\n */\nexport declare function filterChanged_DMC(previous: IDateFilter | null, current: IDateFilter | null): void;\n\n@toolbar('rename', 'filterDate')\n@dialogAddons('sort', 'sortDates')\nexport default class DatesMapColumn extends MapColumn<Date | null> implements IDateColumn {\n  static readonly EVENT_SORTMETHOD_CHANGED = DatesColumn.EVENT_SORTMETHOD_CHANGED;\n  static readonly EVENT_FILTER_CHANGED = DateColumn.EVENT_FILTER_CHANGED;\n\n  private readonly format: (date: Date | null) => string;\n  private readonly parse: (date: string) => Date | null;\n  private sort: EDateSort;\n  private currentFilter: IDateFilter = noDateFilter();\n\n  constructor(id: string, desc: Readonly<IDateMapColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'default',\n      })\n    );\n    const f = timeFormat(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\n    this.format = (v) => (v instanceof Date ? f(v) : '');\n    this.parse = desc.dateParse\n      ? timeParse(desc.dateParse)\n      : timeParse(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\n    this.sort = desc.sort || EDateSort.median;\n  }\n\n  getFormatter() {\n    return this.format;\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([DatesMapColumn.EVENT_SORTMETHOD_CHANGED, DatesMapColumn.EVENT_FILTER_CHANGED]);\n  }\n\n  on(type: typeof DatesMapColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_DMC | null): this;\n  on(type: typeof DatesMapColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_DMC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  private parseValue(v: any) {\n    if (isMissingValue(v)) {\n      return null;\n    }\n    if (v instanceof Date) {\n      return v;\n    }\n    return this.parse(String(v));\n  }\n\n  getDateMap(row: IDataRow) {\n    return super.getMap(row).map(({ key, value }) => ({\n      key,\n      value: this.parseValue(value),\n    }));\n  }\n\n  iterDate(row: IDataRow) {\n    return this.getDates(row);\n  }\n\n  getValue(row: IDataRow) {\n    const r = this.getDateMap(row);\n\n    return r.every((d) => d == null) ? null : r;\n  }\n\n  getLabels(row: IDataRow): IKeyValue<string>[] {\n    return this.getDateMap(row).map(({ key, value }) => ({\n      key,\n      value: value instanceof Date ? this.format(value) : '',\n    }));\n  }\n\n  getDates(row: IDataRow): (Date | null)[] {\n    return this.getDateMap(row).map((v) => v.value);\n  }\n\n  getDate(row: IDataRow) {\n    return DatesColumn.prototype.getDate.call(this, row);\n  }\n\n  getSortMethod() {\n    return this.sort;\n  }\n\n  setSortMethod(sort: EDateSort) {\n    return DatesColumn.prototype.setSortMethod.call(this, sort);\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.sortMethod = this.getSortMethod();\n    r.filter = !isDummyDateFilter(this.currentFilter) ? this.currentFilter : null;\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.sortMethod) {\n      this.sort = dump.sortMethod;\n    }\n    if (dump.filter) {\n      this.currentFilter = restoreDateFilter(dump.filter);\n    }\n  }\n\n  isFiltered() {\n    return DateColumn.prototype.isFiltered.call(this);\n  }\n\n  getFilter(): IDateFilter {\n    return DateColumn.prototype.getFilter.call(this);\n  }\n\n  setFilter(value: IDateFilter | null) {\n    DateColumn.prototype.setFilter.call(this, value);\n  }\n\n  filter(row: IDataRow) {\n    return DateColumn.prototype.filter.call(this, row);\n  }\n\n  clearFilter() {\n    return DateColumn.prototype.clearFilter.call(this);\n  }\n}\n","import { Category, SupportType, toolbar, dialogAddons } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport { IDataRow, IGroup, ECompareValueType } from './interfaces';\nimport { missingGroup } from './missing';\nimport type { IEventListener, ISequence } from '../internal';\n\nexport function createGroupDesc(label = 'Group Name') {\n  return { type: 'group', label };\n}\n\nexport enum EGroupSortMethod {\n  name = 'name',\n  count = 'count',\n}\n\n/**\n * emitted when the sort method property changes\n * @asMemberOf GroupColumn\n * @event\n */\nexport declare function sortMethodChanged(previous: EGroupSortMethod, current: EGroupSortMethod): void;\n\n@SupportType()\n@toolbar('rename', 'sortGroupBy')\n@dialogAddons('sortGroup', 'sortGroups')\n@Category('support')\nexport default class GroupColumn extends Column {\n  static readonly EVENT_SORTMETHOD_CHANGED = 'sortMethodChanged';\n\n  private groupSortMethod: EGroupSortMethod = EGroupSortMethod.name;\n\n  get frozen() {\n    return this.desc.frozen !== false;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([GroupColumn.EVENT_SORTMETHOD_CHANGED]);\n  }\n\n  on(type: typeof GroupColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getLabel() {\n    return '';\n  }\n\n  getValue() {\n    return '';\n  }\n\n  getSortMethod() {\n    return this.groupSortMethod;\n  }\n\n  setSortMethod(sortMethod: EGroupSortMethod) {\n    if (this.groupSortMethod === sortMethod) {\n      return;\n    }\n    this.fire(GroupColumn.EVENT_SORTMETHOD_CHANGED, this.groupSortMethod, (this.groupSortMethod = sortMethod));\n    // sort by me if not already sorted by me\n    if (!this.isGroupSortedByMe().asc) {\n      this.toggleMyGroupSorting();\n    }\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, group: IGroup) {\n    if (this.groupSortMethod === 'count') {\n      return rows.length;\n    }\n    return group.name === missingGroup.name ? null : group.name.toLowerCase();\n  }\n\n  toCompareGroupValueType() {\n    return this.groupSortMethod === 'count' ? ECompareValueType.COUNT : ECompareValueType.STRING;\n  }\n}\n","import { Category, toolbar } from './annotations';\nimport CategoricalColumn from './CategoricalColumn';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  dirtyCaches,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  DEFAULT_COLOR,\n} from './Column';\nimport type { ICategoricalColumn, ICategory, ICategoricalColorMappingFunction } from './ICategoricalColumn';\nimport type { IDataRow, IGroup, IValueColumnDesc, ITypeFactory } from './interfaces';\nimport { colorPool, integrateDefaults } from './internal';\nimport { missingGroup } from './missing';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport type { IEventListener } from '../internal';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\n\nexport interface ICategoryNode extends ICategory {\n  children: Readonly<ICategoryNode>[];\n}\n\nexport interface IPartialCategoryNode extends Partial<ICategory> {\n  children: IPartialCategoryNode[];\n}\n\nexport interface IHierarchyDesc {\n  hierarchy: IPartialCategoryNode;\n  hierarchySeparator?: string;\n}\n\nexport declare type IHierarchyColumnDesc = IHierarchyDesc & IValueColumnDesc<string>;\n\nexport interface ICategoryInternalNode extends ICategory {\n  path: string;\n  children: Readonly<ICategoryInternalNode>[];\n}\n\nexport interface ICutOffNode {\n  node: Readonly<ICategoryInternalNode>;\n  maxDepth: number;\n}\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf HierarchyColumn\n * @event\n */\nexport declare function colorMappingChanged_HC(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n/**\n * emitted when the cut off property changes\n * @asMemberOf HierarchyColumn\n * @event\n */\nexport declare function cutOffChanged(previous: ICutOffNode, current: ICutOffNode): void;\n\n/**\n * column for hierarchical categorical values\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'cutoff', 'group', 'groupBy', 'colorMappedCategorical')\n@Category('categorical')\nexport default class HierarchyColumn extends ValueColumn<string> implements ICategoricalColumn {\n  static readonly EVENT_CUTOFF_CHANGED = 'cutOffChanged';\n  static readonly EVENT_COLOR_MAPPING_CHANGED = 'colorMappingChanged';\n\n  private readonly hierarchySeparator: string;\n  readonly hierarchy: Readonly<ICategoryInternalNode>;\n\n  private currentNode: Readonly<ICategoryInternalNode>;\n  private currentMaxDepth = Number.POSITIVE_INFINITY;\n  private currentLeaves: Readonly<ICategoryInternalNode>[] = [];\n  private readonly currentLeavesNameCache = new Map<string, Readonly<ICategoryInternalNode>>();\n  private readonly currentLeavesPathCache = new Map<string, Readonly<ICategoryInternalNode>>();\n\n  private colorMapping: ICategoricalColorMappingFunction;\n\n  constructor(id: string, desc: Readonly<IHierarchyColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'categorical',\n      })\n    );\n    this.hierarchySeparator = desc.hierarchySeparator || '.';\n    this.hierarchy = this.initHierarchy(desc.hierarchy);\n    this.currentNode = this.hierarchy;\n    this.currentLeaves = computeLeaves(this.currentNode, this.currentMaxDepth);\n    this.updateCaches();\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n\n  private initHierarchy(root: IPartialCategoryNode) {\n    const colors = colorPool();\n    const s = this.hierarchySeparator;\n    const add = (prefix: string, node: IPartialCategoryNode): ICategoryInternalNode => {\n      const name = node.name == null ? String(node.value) : node.name;\n      const children = (node.children || []).map((child: IPartialCategoryNode | string): ICategoryInternalNode => {\n        if (typeof child === 'string') {\n          const path = prefix + child;\n          return {\n            path,\n            name: child,\n            label: path,\n            color: colors(),\n            value: 0,\n            children: [],\n          };\n        }\n        const r = add(`${prefix}${name}${s}`, child);\n        if (!r.color) {\n          //hack to inject the next color\n          (r as any).color = colors();\n        }\n        return r;\n      });\n      const path = prefix + name;\n      const label = node.label ? node.label : path;\n      return { path, name, children, label, color: node.color!, value: 0 };\n    };\n    return add('', root);\n  }\n\n  get categories() {\n    return this.currentLeaves;\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([HierarchyColumn.EVENT_COLOR_MAPPING_CHANGED, HierarchyColumn.EVENT_CUTOFF_CHANGED]);\n  }\n\n  on(type: typeof HierarchyColumn.EVENT_CUTOFF_CHANGED, listener: typeof cutOffChanged | null): this;\n  on(type: typeof HierarchyColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_HC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.colorMapping = this.colorMapping.toJSON();\n    if (isFinite(this.currentMaxDepth)) {\n      r.maxDepth = this.currentMaxDepth;\n    }\n    if (this.currentNode !== this.hierarchy) {\n      r.cutOffNode = this.currentNode.path;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\n    if (typeof dump.maxDepth !== 'undefined') {\n      this.currentMaxDepth = dump.maxDepth;\n    }\n    if (typeof dump.cutOffNode !== 'undefined') {\n      const path = dump.cutOffNode.split(this.hierarchySeparator);\n      let node: Readonly<ICategoryInternalNode> | null = this.hierarchy;\n\n      const findName = (act: string) => {\n        return (d: { name: string }) => d.name === act;\n      };\n\n      let act = path.shift();\n      while (act && node) {\n        if (node.name !== act) {\n          node = null;\n          break;\n        }\n        const next = path.shift();\n        if (!next) {\n          break;\n        }\n        act = next;\n        node = node.children.find(findName(act)) || null;\n      }\n      this.currentNode = node || this.hierarchy;\n    }\n\n    if (typeof dump.maxDepth !== 'undefined' || typeof dump.cutOffNode !== 'undefined') {\n      this.currentLeaves = computeLeaves(this.currentNode, this.currentMaxDepth);\n      this.updateCaches();\n    }\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY,\n      ],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  getCutOff(): ICutOffNode {\n    return {\n      node: this.currentNode,\n      maxDepth: this.currentMaxDepth,\n    };\n  }\n\n  setCutOff(value: ICutOffNode) {\n    const maxDepth = value.maxDepth == null ? Number.POSITIVE_INFINITY : value.maxDepth;\n    if (this.currentNode === value.node && this.currentMaxDepth === maxDepth) {\n      return;\n    }\n    const bak = this.getCutOff();\n    this.currentNode = value.node;\n    this.currentMaxDepth = maxDepth;\n    this.currentLeaves = computeLeaves(value.node, maxDepth);\n    this.updateCaches();\n    this.fire(\n      [HierarchyColumn.EVENT_CUTOFF_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      bak,\n      this.getCutOff()\n    );\n  }\n\n  getCategory(row: IDataRow) {\n    let v = super.getValue(row);\n    if (v == null || v === '') {\n      return null;\n    }\n    v = v.trim();\n    if (this.currentLeavesNameCache.has(v)) {\n      return this.currentLeavesNameCache.get(v)!;\n    }\n    if (this.currentLeavesPathCache.has(v)) {\n      return this.currentLeavesPathCache.get(v)!;\n    }\n    return (\n      this.currentLeaves.find((n) => {\n        //direct hit or is a child of it\n        return n.path === v || n.name === v || v!.startsWith(n.path + this.hierarchySeparator);\n      }) || null\n    );\n  }\n\n  get dataLength() {\n    return this.currentLeaves.length;\n  }\n\n  get labels() {\n    return this.currentLeaves.map((d) => d.label);\n  }\n\n  getValue(row: IDataRow) {\n    const v = this.getCategory(row);\n    return v ? v.name : null;\n  }\n\n  getCategories(row: IDataRow) {\n    return [this.getCategory(row)];\n  }\n\n  iterCategory(row: IDataRow) {\n    return [this.getCategory(row)];\n  }\n\n  getLabel(row: IDataRow) {\n    return CategoricalColumn.prototype.getLabel.call(this, row);\n  }\n\n  getColor(row: IDataRow) {\n    return CategoricalColumn.prototype.getColor.call(this, row);\n  }\n\n  getLabels(row: IDataRow) {\n    return CategoricalColumn.prototype.getLabels.call(this, row);\n  }\n\n  getValues(row: IDataRow) {\n    return CategoricalColumn.prototype.getValues.call(this, row);\n  }\n\n  getMap(row: IDataRow) {\n    return CategoricalColumn.prototype.getMap.call(this, row);\n  }\n\n  getMapLabel(row: IDataRow) {\n    return CategoricalColumn.prototype.getMapLabel.call(this, row);\n  }\n\n  getSet(row: IDataRow) {\n    return CategoricalColumn.prototype.getSet.call(this, row);\n  }\n\n  toCompareValue(row: IDataRow) {\n    return CategoricalColumn.prototype.toCompareValue.call(this, row);\n  }\n\n  toCompareValueType() {\n    return CategoricalColumn.prototype.toCompareValueType.call(this);\n  }\n\n  group(row: IDataRow): IGroup {\n    const base = this.getCategory(row);\n    if (!base) {\n      return Object.assign({}, missingGroup);\n    }\n    return { name: base.label, color: base.color };\n  }\n\n  private updateCaches() {\n    this.currentLeavesPathCache.clear();\n    this.currentLeavesNameCache.clear();\n\n    this.currentLeaves.forEach((n) => {\n      this.currentLeavesPathCache.set(n.path, n);\n      this.currentLeavesNameCache.set(n.name, n);\n    });\n  }\n}\n\nfunction computeLeaves(node: ICategoryInternalNode, maxDepth = Number.POSITIVE_INFINITY) {\n  const leaves: ICategoryInternalNode[] = [];\n  //depth first\n  const visit = (node: ICategoryInternalNode, depth: number) => {\n    //hit or end\n    if (depth >= maxDepth || node.children.length === 0) {\n      leaves.push(node);\n    } else {\n      // go down\n      node.children.forEach((c) => visit(c, depth + 1));\n    }\n  };\n  visit(node, 0);\n  return leaves;\n}\n\nexport function resolveInnerNodes(node: ICategoryInternalNode) {\n  //breath first\n  const queue: ICategoryInternalNode[] = [node];\n  let index = 0;\n  while (index < queue.length) {\n    const next = queue[index++];\n    for (const n of next.children) {\n      queue.push(n);\n    }\n  }\n  return queue;\n}\n\nexport function isHierarchical(categories: (string | Partial<ICategory>)[]) {\n  if (categories.length === 0 || typeof categories[0] === 'string') {\n    return false;\n  }\n  // check if any has a given parent name\n  return categories.some((c) => (c as any).parent != null);\n}\n\nexport function deriveHierarchy(categories: (Partial<ICategory> & { parent: string | null })[]) {\n  const lookup = new Map<string, ICategoryNode>();\n  categories.forEach((c) => {\n    const p = c.parent || '';\n    // set and fill up proxy\n    const item = Object.assign(\n      {\n        children: [],\n        label: c.name!,\n        name: c.name!,\n        color: DEFAULT_COLOR,\n        value: 0,\n      } as ICategoryNode,\n      lookup.get(c.name!) || {},\n      c\n    );\n    lookup.set(c.name!, item);\n\n    if (!lookup.has(p)) {\n      // create proxy\n      lookup.set(p, { name: p, children: [], label: p, value: 0, color: DEFAULT_COLOR });\n    }\n    lookup.get(p)!.children.push(item);\n  });\n  const root = lookup.get('')!;\n  console.assert(root !== undefined, 'hierarchy with no root');\n  if (root.children.length === 1) {\n    return root.children[0];\n  }\n  return root;\n}\n","import {interpolateRgbBasis} from \"d3-interpolate\";\n\nexport default scheme => interpolateRgbBasis(scheme[scheme.length - 1]);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"deebf79ecae13182bd\",\n  \"eff3ffbdd7e76baed62171b5\",\n  \"eff3ffbdd7e76baed63182bd08519c\",\n  \"eff3ffc6dbef9ecae16baed63182bd08519c\",\n  \"eff3ffc6dbef9ecae16baed64292c62171b5084594\",\n  \"f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594\",\n  \"f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e5f5e0a1d99b31a354\",\n  \"edf8e9bae4b374c476238b45\",\n  \"edf8e9bae4b374c47631a354006d2c\",\n  \"edf8e9c7e9c0a1d99b74c47631a354006d2c\",\n  \"edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32\",\n  \"f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32\",\n  \"f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"f0f0f0bdbdbd636363\",\n  \"f7f7f7cccccc969696525252\",\n  \"f7f7f7cccccc969696636363252525\",\n  \"f7f7f7d9d9d9bdbdbd969696636363252525\",\n  \"f7f7f7d9d9d9bdbdbd969696737373525252252525\",\n  \"fffffff0f0f0d9d9d9bdbdbd969696737373525252252525\",\n  \"fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fee6cefdae6be6550d\",\n  \"feeddefdbe85fd8d3cd94701\",\n  \"feeddefdbe85fd8d3ce6550da63603\",\n  \"feeddefdd0a2fdae6bfd8d3ce6550da63603\",\n  \"feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04\",\n  \"fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04\",\n  \"fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"efedf5bcbddc756bb1\",\n  \"f2f0f7cbc9e29e9ac86a51a3\",\n  \"f2f0f7cbc9e29e9ac8756bb154278f\",\n  \"f2f0f7dadaebbcbddc9e9ac8756bb154278f\",\n  \"f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486\",\n  \"fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486\",\n  \"fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fee0d2fc9272de2d26\",\n  \"fee5d9fcae91fb6a4acb181d\",\n  \"fee5d9fcae91fb6a4ade2d26a50f15\",\n  \"fee5d9fcbba1fc9272fb6a4ade2d26a50f15\",\n  \"fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d\",\n  \"fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d\",\n  \"fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d\"\n).map(colors);\n\nexport default ramp(scheme);\n","export const radians = Math.PI / 180;\nexport const degrees = 180 / Math.PI;\n","import define, {extend} from \"./define.js\";\nimport {Color, rgbConvert, Rgb, darker, brighter} from \"./color.js\";\nimport {degrees, radians} from \"./math.js\";\n\nvar A = -0.14861,\n    B = +1.78277,\n    C = -0.29227,\n    D = -0.90649,\n    E = +1.97294,\n    ED = E * D,\n    EB = E * B,\n    BC_DA = B * C - D * A;\n\nfunction cubehelixConvert(o) {\n  if (o instanceof Cubehelix) return new Cubehelix(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Rgb)) o = rgbConvert(o);\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      l = (BC_DA * b + ED * r - EB * g) / (BC_DA + ED - EB),\n      bl = b - l,\n      k = (E * (g - l) - C * bl) / D,\n      s = Math.sqrt(k * k + bl * bl) / (E * l * (1 - l)), // NaN if l=0 or l=1\n      h = s ? Math.atan2(k, bl) * degrees - 120 : NaN;\n  return new Cubehelix(h < 0 ? h + 360 : h, s, l, o.opacity);\n}\n\nexport default function cubehelix(h, s, l, opacity) {\n  return arguments.length === 1 ? cubehelixConvert(h) : new Cubehelix(h, s, l, opacity == null ? 1 : opacity);\n}\n\nexport function Cubehelix(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Cubehelix, cubehelix, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb: function() {\n    var h = isNaN(this.h) ? 0 : (this.h + 120) * radians,\n        l = +this.l,\n        a = isNaN(this.s) ? 0 : this.s * l * (1 - l),\n        cosh = Math.cos(h),\n        sinh = Math.sin(h);\n    return new Rgb(\n      255 * (l + a * (A * cosh + B * sinh)),\n      255 * (l + a * (C * cosh + D * sinh)),\n      255 * (l + a * (E * cosh)),\n      this.opacity\n    );\n  }\n}));\n","import {cubehelix as colorCubehelix} from \"d3-color\";\nimport color, {hue} from \"./color.js\";\n\nfunction cubehelix(hue) {\n  return (function cubehelixGamma(y) {\n    y = +y;\n\n    function cubehelix(start, end) {\n      var h = hue((start = colorCubehelix(start)).h, (end = colorCubehelix(end)).h),\n          s = color(start.s, end.s),\n          l = color(start.l, end.l),\n          opacity = color(start.opacity, end.opacity);\n      return function(t) {\n        start.h = h(t);\n        start.s = s(t);\n        start.l = l(Math.pow(t, y));\n        start.opacity = opacity(t);\n        return start + \"\";\n      };\n    }\n\n    cubehelix.gamma = cubehelixGamma;\n\n    return cubehelix;\n  })(1);\n}\n\nexport default cubehelix(hue);\nexport var cubehelixLong = cubehelix(color);\n","import {cubehelix} from \"d3-color\";\nimport {interpolateCubehelixLong} from \"d3-interpolate\";\n\nexport var warm = interpolateCubehelixLong(cubehelix(-100, 0.75, 0.35), cubehelix(80, 1.50, 0.8));\n\nexport var cool = interpolateCubehelixLong(cubehelix(260, 0.75, 0.35), cubehelix(80, 1.50, 0.8));\n\nvar c = cubehelix();\n\nexport default function(t) {\n  if (t < 0 || t > 1) t -= Math.floor(t);\n  var ts = Math.abs(t - 0.5);\n  c.h = 360 * t - 100;\n  c.s = 1.5 - 1.5 * ts;\n  c.l = 0.8 - 0.9 * ts;\n  return c + \"\";\n}\n","import {cubehelix} from \"d3-color\";\nimport {interpolateCubehelixLong} from \"d3-interpolate\";\n\nexport default interpolateCubehelixLong(cubehelix(300, 0.5, 0.0), cubehelix(-240, 0.5, 1.0));\n","import colors from \"../colors.js\";\n\nfunction ramp(range) {\n  var n = range.length;\n  return function(t) {\n    return range[Math.max(0, Math.min(n - 1, Math.floor(t * n)))];\n  };\n}\n\nexport default ramp(colors(\"44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725\"));\n\nexport var magma = ramp(colors(\"00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf\"));\n\nexport var inferno = ramp(colors(\"00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4\"));\n\nexport var plasma = ramp(colors(\"0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921\"));\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"ffeda0feb24cf03b20\",\n  \"ffffb2fecc5cfd8d3ce31a1c\",\n  \"ffffb2fecc5cfd8d3cf03b20bd0026\",\n  \"ffffb2fed976feb24cfd8d3cf03b20bd0026\",\n  \"ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026\",\n  \"ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026\",\n  \"ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fff7bcfec44fd95f0e\",\n  \"ffffd4fed98efe9929cc4c02\",\n  \"ffffd4fed98efe9929d95f0e993404\",\n  \"ffffd4fee391fec44ffe9929d95f0e993404\",\n  \"ffffd4fee391fec44ffe9929ec7014cc4c028c2d04\",\n  \"ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04\",\n  \"ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e5f5f999d8c92ca25f\",\n  \"edf8fbb2e2e266c2a4238b45\",\n  \"edf8fbb2e2e266c2a42ca25f006d2c\",\n  \"edf8fbccece699d8c966c2a42ca25f006d2c\",\n  \"edf8fbccece699d8c966c2a441ae76238b45005824\",\n  \"f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824\",\n  \"f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e0ecf49ebcda8856a7\",\n  \"edf8fbb3cde38c96c688419d\",\n  \"edf8fbb3cde38c96c68856a7810f7c\",\n  \"edf8fbbfd3e69ebcda8c96c68856a7810f7c\",\n  \"edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b\",\n  \"f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b\",\n  \"f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e0f3dba8ddb543a2ca\",\n  \"f0f9e8bae4bc7bccc42b8cbe\",\n  \"f0f9e8bae4bc7bccc443a2ca0868ac\",\n  \"f0f9e8ccebc5a8ddb57bccc443a2ca0868ac\",\n  \"f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e\",\n  \"f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e\",\n  \"f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fee8c8fdbb84e34a33\",\n  \"fef0d9fdcc8afc8d59d7301f\",\n  \"fef0d9fdcc8afc8d59e34a33b30000\",\n  \"fef0d9fdd49efdbb84fc8d59e34a33b30000\",\n  \"fef0d9fdd49efdbb84fc8d59ef6548d7301f990000\",\n  \"fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000\",\n  \"fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"ece2f0a6bddb1c9099\",\n  \"f6eff7bdc9e167a9cf02818a\",\n  \"f6eff7bdc9e167a9cf1c9099016c59\",\n  \"f6eff7d0d1e6a6bddb67a9cf1c9099016c59\",\n  \"f6eff7d0d1e6a6bddb67a9cf3690c002818a016450\",\n  \"fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450\",\n  \"fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"ece7f2a6bddb2b8cbe\",\n  \"f1eef6bdc9e174a9cf0570b0\",\n  \"f1eef6bdc9e174a9cf2b8cbe045a8d\",\n  \"f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d\",\n  \"f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b\",\n  \"fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b\",\n  \"fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e7e1efc994c7dd1c77\",\n  \"f1eef6d7b5d8df65b0ce1256\",\n  \"f1eef6d7b5d8df65b0dd1c77980043\",\n  \"f1eef6d4b9dac994c7df65b0dd1c77980043\",\n  \"f1eef6d4b9dac994c7df65b0e7298ace125691003f\",\n  \"f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f\",\n  \"f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fde0ddfa9fb5c51b8a\",\n  \"feebe2fbb4b9f768a1ae017e\",\n  \"feebe2fbb4b9f768a1c51b8a7a0177\",\n  \"feebe2fcc5c0fa9fb5f768a1c51b8a7a0177\",\n  \"feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177\",\n  \"fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177\",\n  \"fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"edf8b17fcdbb2c7fb8\",\n  \"ffffcca1dab441b6c4225ea8\",\n  \"ffffcca1dab441b6c42c7fb8253494\",\n  \"ffffccc7e9b47fcdbb41b6c42c7fb8253494\",\n  \"ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84\",\n  \"ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84\",\n  \"ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"f7fcb9addd8e31a354\",\n  \"ffffccc2e69978c679238443\",\n  \"ffffccc2e69978c67931a354006837\",\n  \"ffffccd9f0a3addd8e78c67931a354006837\",\n  \"ffffccd9f0a3addd8e78c67941ab5d238443005a32\",\n  \"ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32\",\n  \"ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"d8b365f5f5f55ab4ac\",\n  \"a6611adfc27d80cdc1018571\",\n  \"a6611adfc27df5f5f580cdc1018571\",\n  \"8c510ad8b365f6e8c3c7eae55ab4ac01665e\",\n  \"8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e\",\n  \"8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e\",\n  \"8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e\",\n  \"5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30\",\n  \"5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"af8dc3f7f7f77fbf7b\",\n  \"7b3294c2a5cfa6dba0008837\",\n  \"7b3294c2a5cff7f7f7a6dba0008837\",\n  \"762a83af8dc3e7d4e8d9f0d37fbf7b1b7837\",\n  \"762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837\",\n  \"762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837\",\n  \"762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837\",\n  \"40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b\",\n  \"40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e9a3c9f7f7f7a1d76a\",\n  \"d01c8bf1b6dab8e1864dac26\",\n  \"d01c8bf1b6daf7f7f7b8e1864dac26\",\n  \"c51b7de9a3c9fde0efe6f5d0a1d76a4d9221\",\n  \"c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221\",\n  \"c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221\",\n  \"c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221\",\n  \"8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419\",\n  \"8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"998ec3f7f7f7f1a340\",\n  \"5e3c99b2abd2fdb863e66101\",\n  \"5e3c99b2abd2f7f7f7fdb863e66101\",\n  \"542788998ec3d8daebfee0b6f1a340b35806\",\n  \"542788998ec3d8daebf7f7f7fee0b6f1a340b35806\",\n  \"5427888073acb2abd2d8daebfee0b6fdb863e08214b35806\",\n  \"5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806\",\n  \"2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08\",\n  \"2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"ef8a62f7f7f767a9cf\",\n  \"ca0020f4a58292c5de0571b0\",\n  \"ca0020f4a582f7f7f792c5de0571b0\",\n  \"b2182bef8a62fddbc7d1e5f067a9cf2166ac\",\n  \"b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac\",\n  \"b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac\",\n  \"b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac\",\n  \"67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061\",\n  \"67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"ef8a62ffffff999999\",\n  \"ca0020f4a582bababa404040\",\n  \"ca0020f4a582ffffffbababa404040\",\n  \"b2182bef8a62fddbc7e0e0e09999994d4d4d\",\n  \"b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d\",\n  \"b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d\",\n  \"b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d\",\n  \"67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a\",\n  \"67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fc8d59ffffbf91bfdb\",\n  \"d7191cfdae61abd9e92c7bb6\",\n  \"d7191cfdae61ffffbfabd9e92c7bb6\",\n  \"d73027fc8d59fee090e0f3f891bfdb4575b4\",\n  \"d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4\",\n  \"d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4\",\n  \"d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4\",\n  \"a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695\",\n  \"a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fc8d59ffffbf91cf60\",\n  \"d7191cfdae61a6d96a1a9641\",\n  \"d7191cfdae61ffffbfa6d96a1a9641\",\n  \"d73027fc8d59fee08bd9ef8b91cf601a9850\",\n  \"d73027fc8d59fee08bffffbfd9ef8b91cf601a9850\",\n  \"d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850\",\n  \"d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850\",\n  \"a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837\",\n  \"a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fc8d59ffffbf99d594\",\n  \"d7191cfdae61abdda42b83ba\",\n  \"d7191cfdae61ffffbfabdda42b83ba\",\n  \"d53e4ffc8d59fee08be6f59899d5943288bd\",\n  \"d53e4ffc8d59fee08bffffbfe6f59899d5943288bd\",\n  \"d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd\",\n  \"d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd\",\n  \"9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2\",\n  \"9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2\"\n).map(colors);\n\nexport default ramp(scheme);\n","import {\n  interpolateBlues,\n  interpolateGreens,\n  interpolateGreys,\n  interpolateOranges,\n  interpolatePurples,\n  interpolateReds,\n  interpolateCool,\n  interpolateCubehelixDefault,\n  interpolateWarm,\n  interpolatePlasma,\n  interpolateMagma,\n  interpolateViridis,\n  interpolateInferno,\n  interpolateYlOrRd,\n  interpolateYlOrBr,\n  interpolateBuGn,\n  interpolateBuPu,\n  interpolateGnBu,\n  interpolateOrRd,\n  interpolatePuBuGn,\n  interpolatePuBu,\n  interpolatePuRd,\n  interpolateRdPu,\n  interpolateYlGnBu,\n  interpolateYlGn,\n  interpolateRainbow,\n  interpolateBrBG,\n  interpolatePRGn,\n  interpolatePiYG,\n  interpolatePuOr,\n  interpolateRdBu,\n  interpolateRdGy,\n  interpolateRdYlBu,\n  interpolateRdYlGn,\n  interpolateSpectral,\n} from 'd3-scale-chromatic';\nimport { equal } from '../internal';\nimport { scaleLinear } from 'd3-scale';\nimport { DEFAULT_COLOR } from './Column';\nimport type { ITypedDump, ITypeFactory } from './interfaces';\nimport type { IColorMappingFunction, IColorMappingFunctionConstructor } from './INumberColumn';\n\nexport class SequentialColorFunction implements IColorMappingFunction {\n  public static readonly FUNCTIONS: { [key: string]: (v: number) => string } = {\n    interpolateBlues,\n    interpolateGreens,\n    interpolateGreys,\n    interpolateOranges,\n    interpolatePurples,\n    interpolateReds,\n    interpolateCool,\n    interpolateCubehelixDefault,\n    interpolateWarm,\n    interpolatePlasma,\n    interpolateMagma,\n    interpolateViridis,\n    interpolateInferno,\n    interpolateYlOrRd,\n    interpolateYlOrBr,\n    interpolateBuGn,\n    interpolateBuPu,\n    interpolateGnBu,\n    interpolateOrRd,\n    interpolatePuBuGn,\n    interpolatePuBu,\n    interpolatePuRd,\n    interpolateRdPu,\n    interpolateYlGnBu,\n    interpolateYlGn,\n    interpolateRainbow,\n  };\n\n  public readonly apply: (v: number) => string;\n\n  constructor(public readonly name: string) {\n    this.apply = SequentialColorFunction.FUNCTIONS[name] || interpolateBlues;\n  }\n\n  toJSON() {\n    return this.name;\n  }\n\n  clone() {\n    return this; // no clone needed since not parameterized\n  }\n\n  eq(other: IColorMappingFunction): boolean {\n    return other instanceof SequentialColorFunction && other.name === this.name;\n  }\n}\n\nexport class DivergentColorFunction implements IColorMappingFunction {\n  public static readonly FUNCTIONS: { [key: string]: (v: number) => string } = {\n    interpolateBrBG,\n    interpolatePRGn,\n    interpolatePiYG,\n    interpolatePuOr,\n    interpolateRdBu,\n    interpolateRdGy,\n    interpolateRdYlBu,\n    interpolateRdYlGn,\n    interpolateSpectral,\n  };\n\n  public readonly apply: (v: number) => string;\n\n  constructor(public readonly name: string) {\n    this.apply = DivergentColorFunction.FUNCTIONS[name] || interpolateBlues;\n  }\n\n  toJSON() {\n    return this.name;\n  }\n\n  clone() {\n    return this; // no clone needed since not parameterized\n  }\n\n  eq(other: IColorMappingFunction): boolean {\n    return other instanceof DivergentColorFunction && other.name === this.name;\n  }\n}\n\nexport class UnknownColorFunction implements IColorMappingFunction {\n  constructor(public readonly apply: (v: number) => string) {}\n\n  toJSON() {\n    return this.apply.toString();\n  }\n\n  clone() {\n    return this; // no clone needed since not parameterized\n  }\n\n  eq(other: IColorMappingFunction): boolean {\n    return other instanceof UnknownColorFunction && other.apply === this.apply;\n  }\n}\n\nexport class SolidColorFunction implements IColorMappingFunction {\n  constructor(public readonly color: string) {}\n\n  apply() {\n    return this.color;\n  }\n\n  toJSON() {\n    return this.color;\n  }\n\n  clone() {\n    return this; // no clone needed since not parameterized\n  }\n\n  eq(other: IColorMappingFunction): boolean {\n    return other instanceof SolidColorFunction && other.color === this.color;\n  }\n}\n\nexport class QuantizedColorFunction implements IColorMappingFunction {\n  public readonly base: IColorMappingFunction;\n  public readonly steps: number;\n\n  constructor(dump: ITypedDump, factory: ITypeFactory);\n  constructor(base: IColorMappingFunction, steps: number);\n  constructor(base: IColorMappingFunction | ITypedDump, steps: number | ITypeFactory) {\n    if (typeof (base as any).apply === 'function') {\n      this.base = base as IColorMappingFunction;\n      this.steps = steps == null ? 5 : (steps as number);\n    } else {\n      const dump = base as ITypedDump;\n      this.base = (steps as ITypeFactory).colorMappingFunction(dump.base);\n      this.steps = dump.steps;\n    }\n  }\n\n  apply(v: number) {\n    return this.base.apply(quantize(v, this.steps));\n  }\n\n  toJSON() {\n    return {\n      type: 'quantized',\n      base: this.base.toJSON(),\n      steps: this.steps,\n    };\n  }\n\n  clone(): QuantizedColorFunction {\n    return new QuantizedColorFunction(this.base.clone(), this.steps);\n  }\n\n  eq(other: IColorMappingFunction): boolean {\n    return other instanceof QuantizedColorFunction && other.base.eq(this.base) && other.steps === this.steps;\n  }\n}\n\nexport class CustomColorMappingFunction implements IColorMappingFunction {\n  private readonly scale = scaleLinear<string>();\n  public readonly entries: { value: number; color: string }[];\n\n  constructor(dump: ITypedDump);\n  constructor(entries: { value: number; color: string }[]);\n  constructor(entries: ITypedDump | { value: number; color: string }[]) {\n    this.entries = Array.isArray(entries) ? entries : entries.entries;\n    this.scale\n      .domain(this.entries.map((d) => d.value))\n      .range(this.entries.map((d) => d.color))\n      .clamp(true);\n  }\n\n  apply(v: number) {\n    return this.scale(v);\n  }\n\n  toJSON() {\n    return {\n      type: 'custom',\n      entries: this.entries,\n    };\n  }\n\n  clone() {\n    return new CustomColorMappingFunction(this.entries.slice());\n  }\n\n  eq(other: IColorMappingFunction): boolean {\n    return other instanceof CustomColorMappingFunction && equal(this.entries, other.entries);\n  }\n}\n\n/**\n * @internal\n */\nexport function quantize(v: number, steps: number) {\n  const perStep = 1 / steps;\n  if (v <= perStep) {\n    return 0;\n  }\n  if (v >= 1 - perStep) {\n    return 1;\n  }\n  for (let acc = 0; acc < 1; acc += perStep) {\n    if (v < acc) {\n      return acc - perStep / 2; // center\n    }\n  }\n  return v;\n}\n\nexport function colorMappingFunctions() {\n  const types: any = {\n    [DEFAULT_COLOR]: SolidColorFunction,\n    quantized: QuantizedColorFunction,\n    custom: CustomColorMappingFunction,\n  };\n  for (const key of Object.keys(SequentialColorFunction.FUNCTIONS)) {\n    types[key] = SequentialColorFunction;\n  }\n  for (const key of Object.keys(DivergentColorFunction.FUNCTIONS)) {\n    types[key] = DivergentColorFunction;\n  }\n  return types;\n}\n\nexport const DEFAULT_COLOR_FUNCTION = new SolidColorFunction(DEFAULT_COLOR);\n\n/**\n * @internal\n */\nexport function createColorMappingFunction(\n  types: { [type: string]: IColorMappingFunctionConstructor },\n  factory: ITypeFactory\n) {\n  return (dump: ITypedDump | string | ((v: number) => string)): IColorMappingFunction => {\n    if (!dump) {\n      return DEFAULT_COLOR_FUNCTION;\n    }\n    if (typeof dump === 'function') {\n      return new UnknownColorFunction(dump);\n    }\n    const typeName = typeof dump === 'string' ? dump : dump.type;\n    const type = types[typeName];\n    if (type) {\n      return new type(dump, factory);\n    }\n    if (Array.isArray(dump)) {\n      return new CustomColorMappingFunction(dump);\n    }\n    return new SolidColorFunction(dump.toString());\n  };\n}\n","import { suffix, IEventListener, ISequence } from '../internal';\nimport { toolbar, SortByDefault } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n  DEFAULT_COLOR,\n} from './Column';\nimport CompositeColumn, { addColumn, filterChanged, moveColumn, removeColumn } from './CompositeColumn';\nimport type { IDataRow, IGroup, IColumnDesc } from './interfaces';\nimport {\n  isNumberColumn,\n  INumberColumn,\n  isMapAbleColumn,\n  IColorMappingFunction,\n  IMappingFunction,\n  IMapAbleColumn,\n  INumberFilter,\n} from './INumberColumn';\nimport NumberColumn from './NumberColumn';\nimport { DEFAULT_FORMATTER, noNumberFilter } from './internalNumber';\nimport { ScaleMappingFunction } from './MappingFunction';\nimport { DEFAULT_COLOR_FUNCTION } from './ColorMappingFunction';\nimport { integrateDefaults } from './internal';\n\n/**\n *  factory for creating a description creating a max column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createImpositionDesc(label = 'Imposition') {\n  return { type: 'imposition', label };\n}\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf ImpositionCompositeColumn\n * @event\n */\nexport declare function mappingChanged_ICC(previous: IMappingFunction, current: IMappingFunction): void;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf ImpositionCompositeColumn\n * @event\n */\nexport declare function colorMappingChanged_ICC(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * implementation of a combine column, standard operations how to select\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterNumber', 'colorMapped', 'editMapping')\n@SortByDefault('descending')\nexport default class ImpositionCompositeColumn extends CompositeColumn implements INumberColumn, IMapAbleColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  constructor(id: string, desc: Readonly<IColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'number',\n        groupRenderer: 'boxplot',\n        summaryRenderer: 'histogram',\n      })\n    );\n  }\n\n  get label() {\n    const l = super.getMetaData().label;\n    const c = this._children;\n    if (l !== 'Imposition' || c.length === 0) {\n      return l;\n    }\n    if (c.length === 1) {\n      return c[0].label;\n    }\n    const w = this.wrapper;\n    const rest = this.rest;\n    return `${w ? w.label : '?'} (${rest.map((c) => c.label).join(', ')})`;\n  }\n\n  private get wrapper(): INumberColumn | null {\n    return (this._children.find(isNumberColumn) as INumberColumn) ?? null;\n  }\n\n  private get rest() {\n    const w = this.wrapper;\n    return this._children.filter((d) => d !== w);\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([ImpositionCompositeColumn.EVENT_MAPPING_CHANGED, ImpositionCompositeColumn.EVENT_COLOR_MAPPING_CHANGED]);\n  }\n\n  on(\n    type: typeof ImpositionCompositeColumn.EVENT_COLOR_MAPPING_CHANGED,\n    listener: typeof colorMappingChanged_ICC | null\n  ): this;\n  on(type: typeof ImpositionCompositeColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_ICC | null): this;\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  getLabel(row: IDataRow) {\n    const c = this._children;\n    if (c.length === 0) {\n      return '';\n    }\n    if (c.length === 1) {\n      return c[0].getLabel(row);\n    }\n    const w = this.wrapper;\n    const rest = this.rest;\n    return `${w ? w.getLabel(row) : '?'} (${rest.map((c) => `${c.label} = ${c.getLabel(row)}`).join(', ')})`;\n  }\n\n  getColor(row: IDataRow) {\n    const c = this._children;\n    switch (c.length) {\n      case 0:\n        return DEFAULT_COLOR;\n      case 1:\n        return c[0].getColor(row);\n      default:\n        return this.rest[0].getColor(row);\n    }\n  }\n\n  getNumberFormat() {\n    const w = this.wrapper;\n    return w ? w.getNumberFormat() : DEFAULT_FORMATTER;\n  }\n\n  getValue(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getValue(row) : NaN;\n  }\n\n  getNumber(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getNumber(row) : NaN;\n  }\n\n  getRawNumber(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getRawNumber(row) : NaN;\n  }\n\n  iterNumber(row: IDataRow) {\n    return [this.getNumber(row)];\n  }\n\n  iterRawNumber(row: IDataRow) {\n    return [this.getRawNumber(row)];\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      const value = this.getRawNumber(row);\n      if (Number.isNaN(value)) {\n        return null;\n      }\n      return {\n        label: this.getLabel(row),\n        color: this.getColor(row),\n        value,\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n\n  getMapping() {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.getMapping() : new ScaleMappingFunction();\n  }\n\n  getOriginalMapping() {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.getOriginalMapping() : new ScaleMappingFunction();\n  }\n\n  setMapping(mapping: IMappingFunction): void {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.setMapping(mapping) : undefined;\n  }\n\n  getColorMapping() {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.getColorMapping() : DEFAULT_COLOR_FUNCTION;\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.setColorMapping(mapping) : undefined;\n  }\n\n  getFilter() {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.getFilter() : noNumberFilter();\n  }\n\n  setFilter(value: INumberFilter | null): void {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.setFilter(value) : undefined;\n  }\n\n  getRange(): [string, string] {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.getRange() : ['0', '1'];\n  }\n\n  toCompareValue(row: IDataRow) {\n    return NumberColumn.prototype.toCompareValue.call(this, row);\n  }\n\n  toCompareValueType() {\n    return NumberColumn.prototype.toCompareValueType.call(this);\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, group: IGroup) {\n    return NumberColumn.prototype.toCompareGroupValue.call(this, rows, group);\n  }\n\n  toCompareGroupValueType() {\n    return NumberColumn.prototype.toCompareGroupValueType.call(this);\n  }\n\n  insert(col: Column, index: number): Column | null {\n    if (this._children.length === 1 && !this.wrapper && !isNumberColumn(col)) {\n      // at least one has to be a number column\n      return null;\n    }\n    if (this._children.length >= 2) {\n      // limit to two\n      return null;\n    }\n    return super.insert(col, index);\n  }\n\n  protected insertImpl(col: Column, index: number) {\n    if (isNumberColumn(col)) {\n      this.forward(col, ...suffix('.impose', NumberColumn.EVENT_MAPPING_CHANGED));\n    }\n    if (isMapAbleColumn(col)) {\n      this.forward(col, ...suffix('.impose', NumberColumn.EVENT_COLOR_MAPPING_CHANGED));\n    }\n    return super.insertImpl(col, index);\n  }\n\n  protected removeImpl(child: Column, index: number) {\n    if (isNumberColumn(child)) {\n      this.unforward(child, ...suffix('.impose', NumberColumn.EVENT_MAPPING_CHANGED));\n    }\n    if (isMapAbleColumn(child)) {\n      this.unforward(child, ...suffix('.impose', NumberColumn.EVENT_COLOR_MAPPING_CHANGED));\n    }\n    return super.removeImpl(child, index);\n  }\n}\n","import { format } from 'd3-format';\nimport { boxplotBuilder, IAdvancedBoxPlotData, IEventListener, ISequence } from '../internal';\nimport { dialogAddons, SortByDefault, toolbar } from './annotations';\nimport ArrayColumn, { IArrayColumnDesc } from './ArrayColumn';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  groupRendererChanged,\n  labelChanged,\n  metaDataChanged,\n  rendererTypeChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n} from './Column';\nimport type { IArrayDesc } from './IArrayColumn';\nimport { IDataRow, ECompareValueType, ITypeFactory } from './interfaces';\nimport {\n  DEFAULT_FORMATTER,\n  getBoxPlotNumber,\n  isDummyNumberFilter,\n  noNumberFilter,\n  restoreNumberFilter,\n  toCompareBoxPlotValue,\n} from './internalNumber';\nimport {\n  EAdvancedSortMethod,\n  IColorMappingFunction,\n  IMappingFunction,\n  INumberDesc,\n  INumberFilter,\n  INumbersColumn,\n} from './INumberColumn';\nimport { restoreMapping } from './MappingFunction';\nimport { isMissingValue } from './missing';\nimport NumberColumn from './NumberColumn';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport { integrateDefaults } from './internal';\n\nexport interface INumbersDesc extends IArrayDesc, INumberDesc {\n  readonly sort?: EAdvancedSortMethod;\n}\n\nexport declare type INumbersColumnDesc = INumbersDesc & IArrayColumnDesc<number>;\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf NumbersColumn\n * @event\n */\nexport declare function mappingChanged_NCS(previous: IMappingFunction, current: IMappingFunction): void;\n/**\n * emitted when the color mapping property changes\n * @asMemberOf NumbersColumn\n * @event\n */\nexport declare function colorMappingChanged_NCS(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * emitted when the sort method property changes\n * @asMemberOf NumbersColumn\n * @event\n */\nexport declare function sortMethodChanged_NCS(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf NumbersColumn\n * @event\n */\nexport declare function filterChanged_NCS(previous: INumberFilter | null, current: INumberFilter | null): void;\n\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterNumber', 'colorMapped', 'editMapping')\n@dialogAddons('sort', 'sortNumbers')\n@SortByDefault('descending')\nexport default class NumbersColumn extends ArrayColumn<number> implements INumbersColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\n  static readonly EVENT_SORTMETHOD_CHANGED = NumberColumn.EVENT_SORTMETHOD_CHANGED;\n  static readonly EVENT_FILTER_CHANGED = NumberColumn.EVENT_FILTER_CHANGED;\n\n  static readonly CENTER = 0;\n\n  private readonly numberFormat: (n: number) => string = DEFAULT_FORMATTER;\n\n  private sort: EAdvancedSortMethod;\n  private mapping: IMappingFunction;\n  private original: IMappingFunction;\n  private colorMapping: IColorMappingFunction;\n  private deriveMapping: readonly boolean[];\n  /**\n   * currently active filter\n   * @type {{min: number, max: number}}\n   * @private\n   */\n  private currentFilter: INumberFilter = noNumberFilter();\n\n  constructor(id: string, desc: Readonly<INumbersColumnDesc>, factory: ITypeFactory) {\n    super(\n      id,\n      integrateDefaults(\n        desc,\n        Object.assign(\n          {\n            renderer: 'heatmap',\n            groupRenderer: 'heatmap',\n            summaryRenderer: 'histogram',\n          },\n          desc.dataLength != null && !Number.isNaN(desc.dataLength)\n            ? {\n                // better initialize the default with based on the data length\n                width: Math.min(Math.max(100, desc.dataLength! * 10), 500),\n              }\n            : {}\n        )\n      )\n    );\n    this.mapping = restoreMapping(desc, factory);\n    this.original = this.mapping.clone();\n    this.deriveMapping = this.mapping.domain.map((d) => d == null || Number.isNaN(d));\n    this.colorMapping = factory.colorMappingFunction(desc.colorMapping || desc.color);\n\n    if (desc.numberFormat) {\n      this.numberFormat = format(desc.numberFormat);\n    }\n\n    this.sort = desc.sort || EAdvancedSortMethod.median;\n  }\n\n  onDataUpdate(rows: ISequence<IDataRow>): void {\n    super.onDataUpdate(rows);\n    if (!this.deriveMapping.some(Boolean)) {\n      return;\n    }\n    // hook for listening to data updates\n    const minMax = rows\n      .map((row) => this.getRawValue(row))\n      .reduce(\n        (acc, v) => {\n          if (v == null || !Array.isArray(v)) {\n            return acc;\n          }\n          for (const vi of v) {\n            if (vi == null || Number.isNaN(vi)) {\n              continue;\n            }\n            if (vi < acc.min) {\n              acc.min = vi;\n            }\n            if (vi > acc.max) {\n              acc.max = vi;\n            }\n          }\n          return acc;\n        },\n        { min: Number.POSITIVE_INFINITY, max: Number.NEGATIVE_INFINITY }\n      );\n\n    const domain = this.mapping.domain.slice();\n    if (this.deriveMapping[0]) {\n      domain[0] = minMax.min;\n    }\n    if (this.deriveMapping[this.deriveMapping.length - 1]) {\n      domain[domain.length - 1] = minMax.max;\n    }\n    this.mapping.domain = domain;\n    (this.original as IMappingFunction).domain = domain;\n  }\n\n  getNumberFormat() {\n    return this.numberFormat;\n  }\n\n  toCompareValue(row: IDataRow): number {\n    return toCompareBoxPlotValue(this, row);\n  }\n\n  toCompareValueType() {\n    return ECompareValueType.FLOAT;\n  }\n\n  getRawNumbers(row: IDataRow) {\n    return this.getRawValue(row);\n  }\n\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\n    const data = this.getRawValue(row);\n    if (data == null) {\n      return null;\n    }\n    const b = boxplotBuilder();\n    for (const d of data) {\n      b.push(isMissingValue(d) ? NaN : this.mapping.apply(d));\n    }\n    return b.build();\n  }\n\n  getRange() {\n    return this.mapping.getRange(this.numberFormat);\n  }\n\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\n    const data = this.getRawValue(row);\n    if (data == null) {\n      return null;\n    }\n    const b = boxplotBuilder();\n    for (const d of data) {\n      b.push(isMissingValue(d) ? NaN : d);\n    }\n    return b.build();\n  }\n\n  getNumbers(row: IDataRow) {\n    return this.getValues(row);\n  }\n\n  getNumber(row: IDataRow): number {\n    return getBoxPlotNumber(this, row, 'normalized');\n  }\n\n  getRawNumber(row: IDataRow): number {\n    return getBoxPlotNumber(this, row, 'raw');\n  }\n\n  getValue(row: IDataRow) {\n    const v = this.getValues(row);\n    return v.every(Number.isNaN) ? null : v;\n  }\n\n  getValues(row: IDataRow) {\n    return this.getRawValue(row).map((d) => (Number.isNaN(d) ? NaN : this.mapping.apply(d)));\n  }\n\n  iterNumber(row: IDataRow) {\n    const v = this.getNumbers(row);\n    if (v.every(Number.isNaN)) {\n      // missing row\n      return [NaN];\n    }\n    return v;\n  }\n\n  iterRawNumber(row: IDataRow) {\n    const v = this.getRawNumbers(row);\n    if (v.every(Number.isNaN)) {\n      // missing row\n      return [NaN];\n    }\n    return v;\n  }\n\n  getRawValue(row: IDataRow) {\n    const r = super.getRaw(row);\n    return r == null ? [] : r.map((d) => (isMissingValue(d) ? NaN : +d));\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getRawValue(row).map(this.numberFormat);\n  }\n\n  getSortMethod() {\n    return this.sort;\n  }\n\n  setSortMethod(sort: EAdvancedSortMethod) {\n    if (this.sort === sort) {\n      return;\n    }\n    this.fire(\n      [\n        NumbersColumn.EVENT_SORTMETHOD_CHANGED,\n        NumberColumn.EVENT_DIRTY_HEADER,\n        NumberColumn.EVENT_DIRTY_VALUES,\n        NumbersColumn.EVENT_DIRTY_CACHES,\n        NumberColumn.EVENT_DIRTY,\n      ],\n      this.sort,\n      (this.sort = sort)\n    );\n    // sort by me if not already sorted by me\n    if (!this.isSortedByMe().asc) {\n      this.sortByMe();\n    }\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.sortMethod = this.getSortMethod();\n    r.filter = !isDummyNumberFilter(this.currentFilter) ? this.currentFilter : null;\n    r.map = this.mapping.toJSON();\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.sortMethod) {\n      this.sort = dump.sortMethod;\n    }\n    if (dump.filter) {\n      this.currentFilter = restoreNumberFilter(dump.filter);\n    }\n    if (dump.map || dump.domain) {\n      this.mapping = restoreMapping(dump, factory);\n    }\n    if (dump.colorMapping) {\n      this.colorMapping = factory.colorMappingFunction(dump.colorMapping);\n    }\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        NumbersColumn.EVENT_COLOR_MAPPING_CHANGED,\n        NumbersColumn.EVENT_MAPPING_CHANGED,\n        NumbersColumn.EVENT_SORTMETHOD_CHANGED,\n        NumbersColumn.EVENT_FILTER_CHANGED,\n      ]);\n  }\n\n  on(type: typeof NumbersColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_NCS | null): this;\n  on(type: typeof NumbersColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_NCS | null): this;\n  on(type: typeof NumbersColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_NCS | null): this;\n  on(type: typeof NumbersColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_NCS | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getOriginalMapping() {\n    return this.original.clone();\n  }\n\n  getMapping() {\n    return this.mapping.clone();\n  }\n\n  setMapping(mapping: IMappingFunction) {\n    if (this.mapping.eq(mapping)) {\n      return;\n    }\n    this.deriveMapping = [];\n    this.fire(\n      [\n        NumbersColumn.EVENT_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.mapping.clone(),\n      (this.mapping = mapping)\n    );\n  }\n\n  getColor(row: IDataRow) {\n    return NumberColumn.prototype.getColor.call(this, row);\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        NumbersColumn.EVENT_COLOR_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  isFiltered() {\n    return NumberColumn.prototype.isFiltered.call(this);\n  }\n\n  getFilter(): INumberFilter {\n    return NumberColumn.prototype.getFilter.call(this);\n  }\n\n  setFilter(value: INumberFilter | null) {\n    NumberColumn.prototype.setFilter.call(this, value);\n  }\n\n  filter(row: IDataRow) {\n    return NumberColumn.prototype.filter.call(this, row);\n  }\n\n  clearFilter() {\n    return NumberColumn.prototype.clearFilter.call(this);\n  }\n}\n","import { suffix, IBoxPlotData, ISequence, IEventListener } from '../internal';\nimport { toolbar, SortByDefault, dialogAddons } from './annotations';\nimport BoxPlotColumn from './BoxPlotColumn';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n  DEFAULT_COLOR,\n} from './Column';\nimport CompositeColumn, { addColumn, filterChanged, moveColumn, removeColumn } from './CompositeColumn';\nimport type { IDataRow, IGroup, IColumnDesc } from './interfaces';\nimport {\n  ESortMethod,\n  IBoxPlotColumn,\n  INumberFilter,\n  isBoxPlotColumn,\n  IMappingFunction,\n  IColorMappingFunction,\n  isMapAbleColumn,\n} from './INumberColumn';\nimport { ScaleMappingFunction } from './MappingFunction';\nimport NumbersColumn from './NumbersColumn';\nimport { DEFAULT_COLOR_FUNCTION } from './ColorMappingFunction';\nimport { DEFAULT_FORMATTER, noNumberFilter } from './internalNumber';\nimport { integrateDefaults } from './internal';\n\n/**\n *  factory for creating a description creating a max column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createImpositionBoxPlotDesc(label = 'Imposition') {\n  return { type: 'impositions', label };\n}\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf ImpositionBoxPlotColumn\n * @event\n */\nexport declare function mappingChanged_IPBC(previous: IMappingFunction, current: IMappingFunction): void;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf ImpositionBoxPlotColumn\n * @event\n */\nexport declare function colorMappingChanged_IPBC(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * implementation of a combine column, standard operations how to select\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterNumber', 'colorMapped', 'editMapping')\n@dialogAddons('sort', 'sortBoxPlot')\n@SortByDefault('descending')\nexport default class ImpositionBoxPlotColumn extends CompositeColumn implements IBoxPlotColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumbersColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumbersColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  constructor(id: string, desc: Readonly<IColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'boxplot',\n        groupRenderer: 'boxplot',\n        summaryRenderer: 'boxplot',\n      })\n    );\n  }\n\n  get label() {\n    const l = super.getMetaData().label;\n    const c = this._children;\n    if (l !== 'Imposition' || c.length === 0) {\n      return l;\n    }\n    if (c.length === 1) {\n      return c[0].label;\n    }\n    const w = this.wrapper;\n    const rest = this.rest;\n    return `${w ? w.label : '?'} (${rest.map((c) => c.label).join(', ')})`;\n  }\n\n  private get wrapper(): IBoxPlotColumn | null {\n    return this._children.find(isBoxPlotColumn) ?? null;\n  }\n\n  private get rest() {\n    const w = this.wrapper;\n    return this._children.filter((d) => d !== w);\n  }\n\n  getLabel(row: IDataRow) {\n    const c = this._children;\n    if (c.length === 0) {\n      return '';\n    }\n    if (c.length === 1) {\n      return c[0].getLabel(row);\n    }\n    const w = this.wrapper;\n    const rest = this.rest;\n    return `${w ? w.getLabel(row) : '?'} (${rest.map((c) => `${c.label} = ${c.getLabel(row)}`)})`;\n  }\n\n  getColor(row: IDataRow) {\n    const c = this._children;\n    switch (c.length) {\n      case 0:\n        return DEFAULT_COLOR;\n      case 1:\n        return c[0].getColor(row);\n      default:\n        return this.rest[0].getColor(row);\n    }\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([ImpositionBoxPlotColumn.EVENT_MAPPING_CHANGED, ImpositionBoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED]);\n  }\n\n  on(\n    type: typeof ImpositionBoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED,\n    listener: typeof colorMappingChanged_IPBC | null\n  ): this;\n  on(type: typeof ImpositionBoxPlotColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_IPBC | null): this;\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  getNumberFormat() {\n    const w = this.wrapper;\n    return w ? w.getNumberFormat() : DEFAULT_FORMATTER;\n  }\n\n  getValue(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getValue(row) : null;\n  }\n\n  getNumber(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getNumber(row) : NaN;\n  }\n\n  getRawNumber(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getRawNumber(row) : NaN;\n  }\n\n  iterNumber(row: IDataRow) {\n    return [this.getNumber(row)];\n  }\n\n  iterRawNumber(row: IDataRow) {\n    return [this.getRawNumber(row)];\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      const value = this.getRawNumber(row);\n      if (Number.isNaN(value)) {\n        return null;\n      }\n      return {\n        label: this.getLabel(row),\n        color: this.getColor(row),\n        value,\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n\n  getBoxPlotData(row: IDataRow): IBoxPlotData | null {\n    const w = this.wrapper;\n    return w ? w.getBoxPlotData(row) : null;\n  }\n\n  getRawBoxPlotData(row: IDataRow): IBoxPlotData | null {\n    const w = this.wrapper;\n    return w ? w.getRawBoxPlotData(row) : null;\n  }\n\n  getMapping() {\n    const w = this.wrapper;\n    return w ? w.getMapping() : new ScaleMappingFunction();\n  }\n\n  getOriginalMapping() {\n    const w = this.wrapper;\n    return w ? w.getOriginalMapping() : new ScaleMappingFunction();\n  }\n\n  getSortMethod() {\n    const w = this.wrapper;\n    return w ? w.getSortMethod() : ESortMethod.min;\n  }\n\n  setSortMethod(value: ESortMethod) {\n    const w = this.wrapper;\n    return w ? w.setSortMethod(value) : undefined;\n  }\n\n  setMapping(mapping: IMappingFunction): void {\n    const w = this.wrapper;\n    return w ? w.setMapping(mapping) : undefined;\n  }\n\n  getColorMapping() {\n    const w = this.wrapper;\n    return w ? w.getColorMapping() : DEFAULT_COLOR_FUNCTION;\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    const w = this.wrapper;\n    return w ? w.setColorMapping(mapping) : undefined;\n  }\n\n  getFilter() {\n    const w = this.wrapper;\n    return w ? w.getFilter() : noNumberFilter();\n  }\n\n  setFilter(value: INumberFilter | null): void {\n    const w = this.wrapper;\n    return w ? w.setFilter(value) : undefined;\n  }\n\n  getRange(): [string, string] {\n    const w = this.wrapper;\n    return w ? w.getRange() : ['0', '1'];\n  }\n\n  toCompareValue(row: IDataRow) {\n    return BoxPlotColumn.prototype.toCompareValue.call(this, row);\n  }\n\n  toCompareValueType() {\n    return BoxPlotColumn.prototype.toCompareValueType.call(this);\n  }\n\n  group(row: IDataRow) {\n    return BoxPlotColumn.prototype.group.call(this, row);\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, group: IGroup) {\n    return BoxPlotColumn.prototype.toCompareGroupValue.call(this, rows, group);\n  }\n\n  toCompareGroupValueType() {\n    return BoxPlotColumn.prototype.toCompareGroupValueType.call(this);\n  }\n\n  insert(col: Column, index: number): Column | null {\n    if (this._children.length === 1 && !this.wrapper && !isBoxPlotColumn(col)) {\n      // at least one has to be a number column\n      return null;\n    }\n    if (this._children.length >= 2) {\n      // limit to two\n      return null;\n    }\n    return super.insert(col, index);\n  }\n\n  protected insertImpl(col: Column, index: number) {\n    if (isBoxPlotColumn(col)) {\n      this.forward(\n        col,\n        ...suffix('.impose', BoxPlotColumn.EVENT_MAPPING_CHANGED, BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED)\n      );\n    } else if (isMapAbleColumn(col)) {\n      this.forward(col, ...suffix('.impose', BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED));\n    }\n    return super.insertImpl(col, index);\n  }\n\n  protected removeImpl(child: Column, index: number) {\n    if (isBoxPlotColumn(child)) {\n      this.unforward(\n        child,\n        ...suffix('.impose', BoxPlotColumn.EVENT_MAPPING_CHANGED, BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED)\n      );\n    } else if (isMapAbleColumn(child)) {\n      this.unforward(child, ...suffix('.impose', BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED));\n    }\n    return super.removeImpl(child, index);\n  }\n}\n","import { suffix, IEventListener, IAdvancedBoxPlotData } from '../internal';\nimport { toolbar, dialogAddons, SortByDefault } from './annotations';\nimport type Column from './Column';\nimport {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n  DEFAULT_COLOR,\n} from './Column';\nimport CompositeColumn, { addColumn, filterChanged, moveColumn, removeColumn } from './CompositeColumn';\nimport type { IKeyValue } from './IArrayColumn';\nimport type { IDataRow, IGroup, IColumnDesc } from './interfaces';\nimport {\n  EAdvancedSortMethod,\n  INumberFilter,\n  INumbersColumn,\n  isNumbersColumn,\n  IMappingFunction,\n  IColorMappingFunction,\n  isMapAbleColumn,\n} from './INumberColumn';\nimport { ScaleMappingFunction } from './MappingFunction';\nimport NumbersColumn from './NumbersColumn';\nimport { DEFAULT_COLOR_FUNCTION } from './ColorMappingFunction';\nimport { DEFAULT_FORMATTER, noNumberFilter } from './internalNumber';\nimport { integrateDefaults } from './internal';\n\n/**\n *  factory for creating a description creating a max column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createImpositionsDesc(label = 'Imposition') {\n  return { type: 'impositions', label };\n}\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf ImpositionCompositesColumn\n * @event\n */\nexport declare function mappingChanged_ICCS(previous: IMappingFunction, current: IMappingFunction): void;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf ImpositionCompositesColumn\n * @event\n */\nexport declare function colorMappingChanged_ICCS(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * implementation of a combine column, standard operations how to select\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterNumber', 'colorMapped', 'editMapping')\n@dialogAddons('sort', 'sortNumbers')\n@SortByDefault('descending')\nexport default class ImpositionCompositesColumn extends CompositeColumn implements INumbersColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumbersColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumbersColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  constructor(id: string, desc: Readonly<IColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'numbers',\n        groupRenderer: 'numbers',\n        summaryRenderer: 'histogram',\n      })\n    );\n  }\n\n  get label() {\n    const l = super.getMetaData().label;\n    const c = this._children;\n    if (l !== 'Imposition' || c.length === 0) {\n      return l;\n    }\n    if (c.length === 1) {\n      return c[0].label;\n    }\n    const w = this.wrapper;\n    const rest = this.rest;\n    return `${w ? w.label : '?'} (${rest.map((c) => c.label).join(', ')})`;\n  }\n\n  private get wrapper(): INumbersColumn | null {\n    return (this._children.find(isNumbersColumn) as INumbersColumn) || null;\n  }\n\n  private get rest() {\n    const w = this.wrapper;\n    return this._children.filter((d) => d !== w);\n  }\n\n  getLabel(row: IDataRow) {\n    const c = this._children;\n    if (c.length === 0) {\n      return '';\n    }\n    if (c.length === 1) {\n      return c[0].getLabel(row);\n    }\n    const w = this.wrapper;\n    const rest = this.rest;\n    return `${w ? w.getLabel(row) : '?'} (${rest.map((c) => `${c.label} = ${c.getLabel(row)}`)})`;\n  }\n\n  getColor(row: IDataRow) {\n    const c = this._children;\n    switch (c.length) {\n      case 0:\n        return DEFAULT_COLOR;\n      case 1:\n        return c[0].getColor(row);\n      default:\n        return this.rest[0].getColor(row);\n    }\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        ImpositionCompositesColumn.EVENT_MAPPING_CHANGED,\n        ImpositionCompositesColumn.EVENT_COLOR_MAPPING_CHANGED,\n      ]);\n  }\n\n  on(\n    type: typeof ImpositionCompositesColumn.EVENT_COLOR_MAPPING_CHANGED,\n    listener: typeof colorMappingChanged_ICCS | null\n  ): this;\n  on(type: typeof ImpositionCompositesColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_ICCS | null): this;\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  get labels() {\n    const w = this.wrapper;\n    return w ? w.labels : [];\n  }\n\n  get dataLength() {\n    const w = this.wrapper;\n    return w ? w.dataLength : null;\n  }\n\n  getNumberFormat() {\n    const w = this.wrapper;\n    return w ? w.getNumberFormat() : DEFAULT_FORMATTER;\n  }\n\n  getValue(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getValue(row) : [];\n  }\n\n  getNumber(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getNumber(row) : NaN;\n  }\n\n  getRawNumber(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getRawNumber(row) : NaN;\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      const value = this.getRawNumber(row);\n      if (Number.isNaN(value)) {\n        return null;\n      }\n      return {\n        label: this.getLabels(row),\n        color: this.getColor(row),\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n\n  getNumbers(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getNumbers(row) : [];\n  }\n\n  getRawNumbers(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getRawNumbers(row) : [];\n  }\n\n  iterNumber(row: IDataRow) {\n    return this.getNumbers(row);\n  }\n\n  iterRawNumber(row: IDataRow) {\n    return this.getRawNumbers(row);\n  }\n\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\n    const w = this.wrapper;\n    return w ? w.getBoxPlotData(row) : null;\n  }\n\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\n    const w = this.wrapper;\n    return w ? w.getRawBoxPlotData(row) : null;\n  }\n\n  getMapping() {\n    const w = this.wrapper;\n    return w ? w.getMapping() : new ScaleMappingFunction();\n  }\n\n  getOriginalMapping() {\n    const w = this.wrapper;\n    return w ? w.getOriginalMapping() : new ScaleMappingFunction();\n  }\n\n  getSortMethod() {\n    const w = this.wrapper;\n    return w ? w.getSortMethod() : EAdvancedSortMethod.min;\n  }\n\n  setSortMethod(value: EAdvancedSortMethod) {\n    const w = this.wrapper;\n    return w ? w.setSortMethod(value) : undefined;\n  }\n\n  setMapping(mapping: IMappingFunction): void {\n    const w = this.wrapper;\n    return w ? w.setMapping(mapping) : undefined;\n  }\n\n  getColorMapping() {\n    const w = this.wrapper;\n    return w ? w.getColorMapping() : DEFAULT_COLOR_FUNCTION;\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    const w = this.wrapper;\n    return w ? w.setColorMapping(mapping) : undefined;\n  }\n\n  getFilter() {\n    const w = this.wrapper;\n    return w ? w.getFilter() : noNumberFilter();\n  }\n\n  setFilter(value: INumberFilter | null): void {\n    const w = this.wrapper;\n    return w ? w.setFilter(value) : undefined;\n  }\n\n  getRange(): [string, string] {\n    const w = this.wrapper;\n    return w ? w.getRange() : ['0', '1'];\n  }\n\n  getMap(row: IDataRow): IKeyValue<number>[] {\n    const w = this.wrapper;\n    return w ? w.getMap(row) : [];\n  }\n\n  getMapLabel(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getMapLabel(row) : [];\n  }\n\n  getLabels(row: IDataRow): string[] {\n    const w = this.wrapper;\n    return w ? w.getLabels(row) : [];\n  }\n\n  getValues(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getValues(row) : [];\n  }\n\n  toCompareValue(row: IDataRow) {\n    return NumbersColumn.prototype.toCompareValue.call(this, row);\n  }\n\n  toCompareValueType() {\n    return NumbersColumn.prototype.toCompareValueType.call(this);\n  }\n\n  toCompareGroupValue(rows: IDataRow[], group: IGroup) {\n    return NumbersColumn.prototype.toCompareGroupValue.call(this, rows, group);\n  }\n\n  toCompareGroupValueType() {\n    return NumbersColumn.prototype.toCompareGroupValueType.call(this);\n  }\n\n  insert(col: Column, index: number): Column | null {\n    if (this._children.length === 1 && !this.wrapper && !isNumbersColumn(col)) {\n      // at least one has to be a number column\n      return null;\n    }\n    if (this._children.length >= 2) {\n      // limit to two\n      return null;\n    }\n    return super.insert(col, index);\n  }\n\n  protected insertImpl(col: Column, index: number) {\n    if (isNumbersColumn(col)) {\n      this.forward(col, ...suffix('.impose', NumbersColumn.EVENT_MAPPING_CHANGED));\n    }\n    if (isMapAbleColumn(col)) {\n      this.forward(col, ...suffix('.impose', NumbersColumn.EVENT_COLOR_MAPPING_CHANGED));\n    }\n    return super.insertImpl(col, index);\n  }\n\n  protected removeImpl(child: Column, index: number) {\n    if (isNumbersColumn(child)) {\n      this.unforward(child, ...suffix('.impose', NumbersColumn.EVENT_MAPPING_CHANGED));\n    }\n    if (isMapAbleColumn(child)) {\n      this.unforward(child, ...suffix('.impose', NumbersColumn.EVENT_COLOR_MAPPING_CHANGED));\n    }\n    return super.removeImpl(child, index);\n  }\n}\n","import { format } from 'd3-format';\nimport CompositeColumn from './CompositeColumn';\nimport type { IDataRow, IGroup, IColumnDesc } from './interfaces';\nimport { isMissingValue } from './missing';\nimport NumberColumn from './NumberColumn';\nimport { SortByDefault, toolbar } from './annotations';\nimport type { ISequence } from '../internal';\nimport type { INumberColumn } from './INumberColumn';\n\nexport interface ICompositeNumberDesc extends IColumnDesc {\n  /**\n   * d3 format number Format\n   * @default 0.3n\n   */\n  numberFormat?: string;\n}\n\nexport declare type ICompositeNumberColumnDesc = ICompositeNumberDesc & IColumnDesc;\n\n/**\n * implementation of a combine column, standard operations how to select\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'group', 'groupBy')\n@SortByDefault('descending')\nexport default class CompositeNumberColumn extends CompositeColumn implements INumberColumn {\n  private readonly numberFormat: (n: number) => string = format('.3n');\n\n  constructor(id: string, desc: Readonly<ICompositeNumberColumnDesc>) {\n    super(id, desc);\n\n    if (desc.numberFormat) {\n      this.numberFormat = format(desc.numberFormat);\n    }\n  }\n\n  getNumberFormat() {\n    return this.numberFormat;\n  }\n\n  getLabel(row: IDataRow) {\n    if (!this.isLoaded()) {\n      return '';\n    }\n    const v = this.getValue(row);\n    //keep non number if it is not a number else convert using formatter\n    return String(typeof v === 'number' && !Number.isNaN(v) && isFinite(v) ? this.numberFormat(v) : v);\n  }\n\n  getValue(row: IDataRow) {\n    if (!this.isLoaded()) {\n      return null;\n    }\n    //weighted sum\n    const v = this.compute(row);\n    if (isMissingValue(v)) {\n      return null;\n    }\n    return v;\n  }\n\n  protected compute(_row: IDataRow) {\n    return NaN;\n  }\n\n  getNumber(row: IDataRow) {\n    const r = this.getValue(row);\n    return r == null ? NaN : r;\n  }\n\n  getRawNumber(row: IDataRow) {\n    return this.getNumber(row);\n  }\n\n  iterNumber(row: IDataRow) {\n    return [this.getNumber(row)];\n  }\n\n  iterRawNumber(row: IDataRow) {\n    return [this.getRawNumber(row)];\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      return {\n        value: this.getRawNumber(row),\n        children: this.children.map((d) => d.getExportValue(row, format)),\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n\n  toCompareValue(row: IDataRow) {\n    return NumberColumn.prototype.toCompareValue.call(this, row);\n  }\n\n  toCompareValueType() {\n    return NumberColumn.prototype.toCompareValueType.call(this);\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, group: IGroup) {\n    return NumberColumn.prototype.toCompareGroupValue.call(this, rows, group);\n  }\n\n  toCompareGroupValueType() {\n    return NumberColumn.prototype.toCompareGroupValueType.call(this);\n  }\n\n  getRenderer(): string {\n    return NumberColumn.prototype.getRenderer.call(this);\n  }\n}\n","import { median, quantile, IEventListener } from '../internal';\nimport { toolbar } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n  DEFAULT_COLOR,\n} from './Column';\nimport type CompositeColumn from './CompositeColumn';\nimport type { addColumn, filterChanged, moveColumn, removeColumn } from './CompositeColumn';\nimport CompositeNumberColumn, { ICompositeNumberColumnDesc } from './CompositeNumberColumn';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport { EAdvancedSortMethod } from './INumberColumn';\nimport { integrateDefaults } from './internal';\n\n/**\n *  factory for creating a description creating a max column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createReduceDesc(label = 'Reduce') {\n  return { type: 'reduce', label };\n}\n\nexport interface IReduceDesc {\n  readonly reduce?: EAdvancedSortMethod;\n}\n\nexport declare type IReduceColumnDesc = IReduceDesc & ICompositeNumberColumnDesc;\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf ReduceColumn\n * @event\n */\nexport declare function reduceChanged(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\n\n/**\n * combines multiple columns by using the maximal value\n */\n@toolbar('reduce')\nexport default class ReduceColumn extends CompositeNumberColumn {\n  static readonly EVENT_REDUCE_CHANGED = 'reduceChanged';\n\n  private reduce: EAdvancedSortMethod;\n\n  constructor(id: string, desc: Readonly<IReduceColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'interleaving',\n        groupRenderer: 'interleaving',\n        summaryRenderer: 'interleaving',\n      })\n    );\n    this.reduce = desc.reduce || EAdvancedSortMethod.max;\n  }\n\n  get label() {\n    const l = super.getMetaData().label;\n    if (l !== 'Reduce') {\n      return l;\n    }\n    return `${this.reduce[0].toUpperCase()}${this.reduce.slice(1)}(${this.children.map((d) => d.label).join(', ')})`;\n  }\n\n  getColor(row: IDataRow) {\n    //compute the index of the maximal one\n    const c = this._children;\n    if (\n      c.length === 0 ||\n      this.reduce === EAdvancedSortMethod.q1 ||\n      this.reduce === EAdvancedSortMethod.q3 ||\n      this.reduce === EAdvancedSortMethod.mean\n    ) {\n      return DEFAULT_COLOR;\n    }\n    const v = this.compute(row);\n    const selected = c.find((c) => c.getValue(row) === v);\n    return selected ? selected.getColor(row) : DEFAULT_COLOR;\n  }\n\n  protected compute(row: IDataRow) {\n    const vs = this._children.map((d) => d.getValue(row)).filter((d) => !Number.isNaN(d));\n    if (vs.length === 0) {\n      return NaN;\n    }\n    switch (this.reduce) {\n      case EAdvancedSortMethod.mean:\n        return vs.reduce((a, b) => a + b, 0) / vs.length;\n      case EAdvancedSortMethod.max:\n        return vs.reduce((a, b) => Math.max(a, b), Number.NEGATIVE_INFINITY);\n      case EAdvancedSortMethod.min:\n        return vs.reduce((a, b) => Math.min(a, b), Number.POSITIVE_INFINITY);\n      case EAdvancedSortMethod.median:\n        return median(vs)!;\n      case EAdvancedSortMethod.q1:\n        return quantile(\n          vs.sort((a, b) => a - b),\n          0.25\n        )!;\n      case EAdvancedSortMethod.q3:\n        return quantile(\n          vs.sort((a, b) => a - b),\n          0.75\n        )!;\n    }\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([ReduceColumn.EVENT_REDUCE_CHANGED]);\n  }\n\n  on(type: typeof ReduceColumn.EVENT_REDUCE_CHANGED, listener: typeof reduceChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  getReduce() {\n    return this.reduce;\n  }\n\n  setReduce(reduce: EAdvancedSortMethod) {\n    if (this.reduce === reduce) {\n      return;\n    }\n    this.fire(\n      [ReduceColumn.EVENT_REDUCE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY],\n      this.reduce,\n      (this.reduce = reduce)\n    );\n  }\n\n  dump(toDescRef: (desc: any) => any) {\n    const r = super.dump(toDescRef);\n    r.reduce = this.reduce;\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    this.reduce = dump.reduce || this.reduce;\n    super.restore(dump, factory);\n  }\n\n  get canJustAddNumbers() {\n    return true;\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      return {\n        value: this.getRawNumber(row),\n        children: this.children.map((d) => d.getExportValue(row, format)),\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n}\n","import { round, IEventListener, similar } from '../internal';\nimport { toolbar } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type CompositeColumn from './CompositeColumn';\nimport type { addColumn, filterChanged, moveColumn, removeColumn } from './CompositeColumn';\nimport CompositeNumberColumn, { ICompositeNumberDesc } from './CompositeNumberColumn';\nimport type { IDataRow, IFlatColumn, IMultiLevelColumn, ITypeFactory } from './interfaces';\nimport { integrateDefaults } from './internal';\n\n/**\n * factory for creating a description creating a stacked column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createStackDesc(label = 'Weighted Sum', showNestedSummaries = true): IStackColumnColumnDesc {\n  return { type: 'stack', label, showNestedSummaries };\n}\n\n/**\n * emitted when the collapse property changes\n * @asMemberOf StackColumn\n * @event\n */\nexport declare function collapseChanged(previous: boolean, current: boolean): void;\n\n/**\n * emitted when the weights change\n * @asMemberOf StackColumn\n * @event\n */\nexport declare function weightsChanged(previous: number[], current: number[]): void;\n\n/**\n * emitted when the ratios between the children changes\n * @asMemberOf StackColumn\n * @event\n */\nexport declare function nestedChildRatio(previous: number[], current: number[]): void;\n\nexport declare type IStackColumnColumnDesc = ICompositeNumberDesc & {\n  /**\n   * show nested summaries\n   * @default true\n   */\n  showNestedSummaries?: boolean;\n};\n\n/**\n * implementation of the stacked column\n */\n@toolbar('editWeights', 'compress', 'expand')\nexport default class StackColumn extends CompositeNumberColumn implements IMultiLevelColumn {\n  static readonly EVENT_COLLAPSE_CHANGED = 'collapseChanged';\n  static readonly EVENT_WEIGHTS_CHANGED = 'weightsChanged';\n  static readonly EVENT_MULTI_LEVEL_CHANGED = 'nestedChildRatio';\n\n  static readonly COLLAPSED_RENDERER = 'number';\n\n  private readonly adaptChange: (old: number, newValue: number) => void;\n\n  /**\n   * whether this stack column is collapsed i.e. just looks like an ordinary number column\n   * @type {boolean}\n   * @private\n   */\n  private collapsed = false;\n\n  constructor(id: string, desc: IStackColumnColumnDesc) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'stack',\n        groupRenderer: 'stack',\n        summaryRenderer: 'stack',\n      })\n    );\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    this.adaptChange = function (this: { source: Column }, oldValue, newValue) {\n      that.adaptWidthChange(this.source, oldValue, newValue);\n    };\n  }\n\n  get label() {\n    const l = super.getMetaData().label;\n    const c = this._children;\n    if (l !== 'Weighted Sum' || c.length === 0) {\n      return l;\n    }\n    const weights = this.getWeights();\n    return c.map((c, i) => `${c.label} (${round(100 * weights[i], 1)}%)`).join(' + ');\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        StackColumn.EVENT_COLLAPSE_CHANGED,\n        StackColumn.EVENT_WEIGHTS_CHANGED,\n        StackColumn.EVENT_MULTI_LEVEL_CHANGED,\n      ]);\n  }\n\n  on(type: typeof StackColumn.EVENT_COLLAPSE_CHANGED, listener: typeof collapseChanged | null): this;\n  on(type: typeof StackColumn.EVENT_WEIGHTS_CHANGED, listener: typeof weightsChanged | null): this;\n  on(type: typeof StackColumn.EVENT_MULTI_LEVEL_CHANGED, listener: typeof nestedChildRatio | null): this;\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  setCollapsed(value: boolean) {\n    if (this.collapsed === value) {\n      return;\n    }\n    this.fire(\n      [StackColumn.EVENT_COLLAPSE_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.collapsed,\n      (this.collapsed = value)\n    );\n  }\n\n  getCollapsed() {\n    return this.collapsed;\n  }\n\n  isShowNestedSummaries() {\n    return (this.desc as IStackColumnColumnDesc).showNestedSummaries !== false;\n  }\n\n  get canJustAddNumbers() {\n    return true;\n  }\n\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\n    let self = null;\n    const children =\n      levelsToGo <= Column.FLAT_ALL_COLUMNS ? this._children : this._children.filter((c) => c.isVisible());\n    //no more levels or just this one\n    if (levelsToGo === 0 || levelsToGo <= Column.FLAT_ALL_COLUMNS) {\n      let w = this.getWidth();\n      if (!this.collapsed) {\n        w += (children.length - 1) * padding;\n      }\n      r.push((self = { col: this, offset, width: w }));\n      if (levelsToGo === 0) {\n        return w;\n      }\n    }\n    //push children\n    let acc = offset;\n    children.forEach((c) => {\n      acc += c.flatten(r, acc, levelsToGo - 1, padding) + padding;\n    });\n    if (self) {\n      //nesting my even increase my width\n      self.width = acc - offset - padding;\n    }\n    return acc - offset - padding;\n  }\n\n  dump(toDescRef: (desc: any) => any) {\n    const r = super.dump(toDescRef);\n    r.collapsed = this.collapsed;\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    this.collapsed = dump.collapsed === true;\n    super.restore(dump, factory);\n  }\n\n  /**\n   * inserts a column at a the given position\n   */\n  insert(col: Column, index: number, weight = NaN) {\n    if (!Number.isNaN(weight)) {\n      col.setWidth((weight / (1 - weight)) * this.getWidth());\n    }\n    col.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, this.adaptChange);\n    //increase my width\n    super.setWidth(this.length === 0 ? col.getWidth() : this.getWidth() + col.getWidth());\n\n    return super.insert(col, index);\n  }\n\n  push(col: Column, weight = NaN) {\n    return this.insert(col, this.length, weight);\n  }\n\n  insertAfter(col: Column, ref: Column, weight = NaN) {\n    const i = this.indexOf(ref);\n    if (i < 0) {\n      return null;\n    }\n    return this.insert(col, i + 1, weight);\n  }\n\n  /**\n   * adapts weights according to an own width change\n   * @param col\n   * @param oldValue\n   * @param newValue\n   */\n  private adaptWidthChange(col: Column, oldValue: number, newValue: number) {\n    if (similar(oldValue, newValue, 0.5)) {\n      return;\n    }\n    const bak = this.getWeights();\n    const full = this.getWidth(),\n      change = (newValue - oldValue) / full;\n    const oldWeight = oldValue / full;\n    const factor = (1 - oldWeight - change) / (1 - oldWeight);\n    const widths = this._children.map((c) => {\n      if (c === col) {\n        //c.weight += change;\n        return newValue;\n      }\n      const guess = c.getWidth() * factor;\n      const w = Number.isNaN(guess) || guess < 1 ? 0 : guess;\n      c.setWidthImpl(w);\n      return w;\n    });\n    //adapt width if needed\n    super.setWidth(widths.reduce((a, b) => a + b, 0));\n\n    this.fire(\n      [\n        StackColumn.EVENT_WEIGHTS_CHANGED,\n        StackColumn.EVENT_MULTI_LEVEL_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      bak,\n      this.getWeights()\n    );\n  }\n\n  getWeights() {\n    const w = this.getWidth();\n    return this._children.map((d) => d.getWidth() / w);\n  }\n\n  setWeights(weights: number[]) {\n    const bak = this.getWeights();\n    const delta = weights.length - this.length;\n    let s: number;\n    if (delta < 0) {\n      s = weights.reduce((p, a) => p + a, 0);\n      if (s <= 1) {\n        for (let i = 0; i < -delta; ++i) {\n          weights.push((1 - s) * (1 / -delta));\n        }\n      } else if (s <= 100) {\n        for (let i = 0; i < -delta; ++i) {\n          weights.push((100 - s) * (1 / -delta));\n        }\n      }\n    }\n    weights = weights.slice(0, this.length);\n    s = weights.reduce((p, a) => p + a, 0) / this.getWidth();\n    weights = weights.map((d) => d / s);\n\n    this._children.forEach((c, i) => {\n      c.setWidthImpl(weights[i]);\n    });\n    this.fire(\n      [\n        StackColumn.EVENT_WEIGHTS_CHANGED,\n        StackColumn.EVENT_MULTI_LEVEL_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      bak,\n      weights\n    );\n  }\n\n  removeImpl(child: Column, index: number) {\n    child.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, null);\n    super.setWidth(this.length === 0 ? 100 : this.getWidth() - child.getWidth());\n    return super.removeImpl(child, index);\n  }\n\n  setWidth(value: number) {\n    const factor = value / this.getWidth();\n    this._children.forEach((child) => {\n      //disable since we change it\n      child.setWidthImpl(child.getWidth() * factor);\n    });\n    super.setWidth(value);\n  }\n\n  protected compute(row: IDataRow) {\n    const w = this.getWidth();\n    // missing value for the stack column if at least one child value is missing\n    if (this._children.some((d) => d.getValue(row) === null)) {\n      return null;\n    }\n    return this._children.reduce((acc, d) => acc + d.getValue(row) * (d.getWidth() / w), 0);\n  }\n\n  getRenderer() {\n    if (this.getCollapsed() && this.isLoaded()) {\n      return StackColumn.COLLAPSED_RENDERER;\n    }\n    return super.getRenderer();\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      return {\n        value: this.getRawNumber(row),\n        children: this.children.map((d) => d.getExportValue(row, format)),\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n}\n","import { similar, IEventListener } from '../internal';\nimport { toolbar } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport CompositeColumn, { addColumn, filterChanged, moveColumn, removeColumn } from './CompositeColumn';\nimport type { IDataRow, IColumnDesc, IFlatColumn, IMultiLevelColumn, ITypeFactory } from './interfaces';\nimport { integrateDefaults } from './internal';\nimport StackColumn from './StackColumn';\n\n/**\n * emitted when the collapse property changes\n * @asMemberOf MultiLevelCompositeColumn\n * @event\n */\nexport declare function collapseChanged_MC(previous: boolean, current: boolean): void;\n\n/**\n * emitted when the ratios between the children changes\n * @asMemberOf MultiLevelCompositeColumn\n * @event\n */\nexport declare function nestedChildRatio_MC(previous: number, current: number): void;\n\nexport declare type IMultiLevelCompositeColumnDesc = IColumnDesc & {\n  /**\n   * show nested summaries\n   * @default true\n   */\n  showNestedSummaries?: boolean;\n};\n\n@toolbar('compress', 'expand')\nexport default class MultiLevelCompositeColumn extends CompositeColumn implements IMultiLevelColumn {\n  static readonly EVENT_COLLAPSE_CHANGED = StackColumn.EVENT_COLLAPSE_CHANGED;\n  static readonly EVENT_MULTI_LEVEL_CHANGED = StackColumn.EVENT_MULTI_LEVEL_CHANGED;\n\n  static readonly COLLAPSED_RENDERER = 'default';\n\n  private readonly adaptChange: (old: number, newValue: number) => void;\n\n  /**\n   * whether this stack column is collapsed i.e. just looks like an ordinary number column\n   * @type {boolean}\n   * @private\n   */\n  private collapsed = false;\n\n  constructor(id: string, desc: Readonly<IMultiLevelCompositeColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        summaryRenderer: 'nested',\n      })\n    );\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    this.adaptChange = function (old, newValue) {\n      that.adaptWidthChange(old, newValue);\n    };\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([MultiLevelCompositeColumn.EVENT_COLLAPSE_CHANGED, MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED]);\n  }\n\n  on(type: typeof MultiLevelCompositeColumn.EVENT_COLLAPSE_CHANGED, listener: typeof collapseChanged_MC | null): this;\n  on(\n    type: typeof MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED,\n    listener: typeof nestedChildRatio_MC | null\n  ): this;\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  setCollapsed(value: boolean) {\n    if (this.collapsed === value) {\n      return;\n    }\n    this.fire(\n      [StackColumn.EVENT_COLLAPSE_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.collapsed,\n      (this.collapsed = value)\n    );\n  }\n\n  getCollapsed() {\n    return this.collapsed;\n  }\n\n  isShowNestedSummaries() {\n    return (this.desc as IMultiLevelCompositeColumnDesc).showNestedSummaries !== false;\n  }\n\n  dump(toDescRef: (desc: any) => any) {\n    const r = super.dump(toDescRef);\n    r.collapsed = this.collapsed;\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    this.collapsed = dump.collapsed === true;\n    super.restore(dump, factory);\n  }\n\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\n    return StackColumn.prototype.flatten.call(this, r, offset, levelsToGo, padding);\n  }\n\n  /**\n   * inserts a column at a the given position\n   * @param col\n   * @param index\n   */\n  insert(col: Column, index: number) {\n    col.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, this.adaptChange);\n    //increase my width\n    super.setWidth(this.length === 0 ? col.getWidth() : this.getWidth() + col.getWidth());\n\n    return super.insert(col, index);\n  }\n\n  /**\n   * adapts weights according to an own width change\n   * @param oldValue\n   * @param newValue\n   */\n  private adaptWidthChange(oldValue: number, newValue: number) {\n    if (similar(oldValue, newValue, 0.5)) {\n      return;\n    }\n    const act = this.getWidth();\n    const next = act + (newValue - oldValue);\n    this.fire(\n      [MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY],\n      act,\n      next\n    );\n    super.setWidth(next);\n  }\n\n  removeImpl(child: Column, index: number) {\n    child.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, null);\n    super.setWidth(this.length === 0 ? 100 : this.getWidth() - child.getWidth());\n    return super.removeImpl(child, index);\n  }\n\n  setWidth(value: number) {\n    const act = this.getWidth();\n    const factor = value / act;\n    this._children.forEach((child) => {\n      //disable since we change it\n      child.setWidthImpl(child.getWidth() * factor);\n    });\n    if (!similar(act, value, 0.5)) {\n      this.fire(\n        [MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY],\n        act,\n        value\n      );\n    }\n    super.setWidth(value);\n  }\n\n  getRenderer() {\n    if (this.getCollapsed()) {\n      return MultiLevelCompositeColumn.COLLAPSED_RENDERER;\n    }\n    return super.getRenderer();\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      return {\n        children: this.children.map((d) => d.getExportValue(row, format)),\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n}\n","import type { IDataRow, ECompareValueType } from './interfaces';\nimport MultiLevelCompositeColumn, { IMultiLevelCompositeColumnDesc } from './MultiLevelCompositeColumn';\nimport { concat } from '../internal';\nimport { toolbar } from './annotations';\n\n/**\n * factory for creating a description creating a mean column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createNestedDesc(label = 'Nested', showNestedSummaries = true): IMultiLevelCompositeColumnDesc {\n  return { type: 'nested', label, showNestedSummaries };\n}\n\n/**\n * a nested column is a composite column where the sorting order is determined by the nested ordering of the children\n * i.e., sort by the first child if equal sort by the second child,...\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy')\nexport default class NestedColumn extends MultiLevelCompositeColumn {\n  toCompareValue(row: IDataRow) {\n    return concat(this.children.map((d) => d.toCompareValue(row)));\n  }\n\n  toCompareValueType(): ECompareValueType[] {\n    return concat(this.children.map((d) => d.toCompareValueType()));\n  }\n\n  getLabel(row: IDataRow) {\n    return this.children.map((d) => d.getLabel(row)).join(';');\n  }\n\n  getValue(row: IDataRow) {\n    return this.children.map((d) => d.getValue(row)).join(';');\n  }\n}\n","import { toolbar, SortByDefault, dialogAddons } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport type { IKeyValue } from './IArrayColumn';\nimport { IDataRow, ECompareValueType, ITypeFactory } from './interfaces';\nimport {\n  EAdvancedSortMethod,\n  IAdvancedBoxPlotColumn,\n  INumberDesc,\n  INumberFilter,\n  IMappingFunction,\n  IColorMappingFunction,\n} from './INumberColumn';\nimport MapColumn, { IMapColumnDesc } from './MapColumn';\nimport { restoreMapping } from './MappingFunction';\nimport { isMissingValue } from './missing';\nimport NumberColumn from './NumberColumn';\nimport { IEventListener, IAdvancedBoxPlotData, boxplotBuilder } from '../internal';\nimport { format } from 'd3-format';\nimport {\n  DEFAULT_FORMATTER,\n  noNumberFilter,\n  toCompareBoxPlotValue,\n  getBoxPlotNumber,\n  isDummyNumberFilter,\n  restoreNumberFilter,\n} from './internalNumber';\nimport { integrateDefaults } from './internal';\n\nexport interface INumberMapDesc extends INumberDesc {\n  readonly sort?: EAdvancedSortMethod;\n}\n\nexport declare type INumberMapColumnDesc = INumberMapDesc & IMapColumnDesc<number>;\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf NumberMapColumn\n * @event\n */\nexport declare function mappingChanged_NMC(previous: IMappingFunction, current: IMappingFunction): void;\n/**\n * emitted when the color mapping property changes\n * @asMemberOf NumberMapColumn\n * @event\n */\nexport declare function colorMappingChanged_NMC(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * emitted when the sort method property changes\n * @asMemberOf NumberMapColumn\n * @event\n */\nexport declare function sortMethodChanged_NMC(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf NumberMapColumn\n * @event\n */\nexport declare function filterChanged_NMC(previous: INumberFilter | null, current: INumberFilter | null): void;\n\n@toolbar('rename', 'filterNumber', 'colorMapped', 'editMapping')\n@dialogAddons('sort', 'sortNumbers')\n@SortByDefault('descending')\nexport default class NumberMapColumn extends MapColumn<number> implements IAdvancedBoxPlotColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\n  static readonly EVENT_SORTMETHOD_CHANGED = NumberColumn.EVENT_SORTMETHOD_CHANGED;\n  static readonly EVENT_FILTER_CHANGED = NumberColumn.EVENT_FILTER_CHANGED;\n\n  private readonly numberFormat: (n: number) => string = DEFAULT_FORMATTER;\n\n  private sort: EAdvancedSortMethod;\n  private mapping: IMappingFunction;\n  private original: IMappingFunction;\n  private colorMapping: IColorMappingFunction;\n  /**\n   * currently active filter\n   * @type {{min: number, max: number}}\n   * @private\n   */\n  private currentFilter: INumberFilter = noNumberFilter();\n\n  constructor(id: string, desc: Readonly<INumberMapColumnDesc>, factory: ITypeFactory) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'mapbars',\n      })\n    );\n    this.mapping = restoreMapping(desc, factory);\n    this.original = this.mapping.clone();\n    this.colorMapping = factory.colorMappingFunction(desc.colorMapping || desc.color);\n    this.sort = desc.sort || EAdvancedSortMethod.median;\n\n    if (desc.numberFormat) {\n      this.numberFormat = format(desc.numberFormat);\n    }\n  }\n\n  getNumberFormat() {\n    return this.numberFormat;\n  }\n\n  toCompareValue(row: IDataRow): number {\n    return toCompareBoxPlotValue(this, row);\n  }\n\n  toCompareValueType() {\n    return ECompareValueType.FLOAT;\n  }\n\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\n    const data = this.getRawValue(row);\n    if (data == null) {\n      return null;\n    }\n    const b = boxplotBuilder();\n    for (const d of data) {\n      b.push(isMissingValue(d.value) ? NaN : this.mapping.apply(d.value));\n    }\n    return b.build();\n  }\n\n  getRange() {\n    return this.mapping.getRange(this.numberFormat);\n  }\n\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\n    const data = this.getRawValue(row);\n    if (data == null) {\n      return null;\n    }\n\n    const b = boxplotBuilder();\n    for (const d of data) {\n      b.push(isMissingValue(d.value) ? NaN : d.value);\n    }\n    return b.build();\n  }\n\n  getNumber(row: IDataRow): number {\n    return getBoxPlotNumber(this, row, 'normalized');\n  }\n\n  getRawNumber(row: IDataRow): number {\n    return getBoxPlotNumber(this, row, 'raw');\n  }\n\n  iterNumber(row: IDataRow) {\n    const r = this.getValue(row);\n    return r ? r.map((d) => d.value) : [NaN];\n  }\n\n  iterRawNumber(row: IDataRow) {\n    const r = this.getRawValue(row);\n    return r ? r.map((d) => d.value) : [NaN];\n  }\n\n  getValue(row: IDataRow) {\n    const values = this.getRawValue(row);\n    return values.length === 0\n      ? null\n      : values.map(({ key, value }) => ({ key, value: isMissingValue(value) ? NaN : this.mapping.apply(value) }));\n  }\n\n  getRawValue(row: IDataRow): IKeyValue<number>[] {\n    const r = super.getValue(row);\n    return r == null ? [] : r;\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\n  }\n\n  getLabels(row: IDataRow) {\n    const v = this.getRawValue(row);\n    return v.map(({ key, value }) => ({ key, value: this.numberFormat(value) }));\n  }\n\n  getSortMethod() {\n    return this.sort;\n  }\n\n  setSortMethod(sort: EAdvancedSortMethod) {\n    if (this.sort === sort) {\n      return;\n    }\n    this.fire([NumberMapColumn.EVENT_SORTMETHOD_CHANGED], this.sort, (this.sort = sort));\n    // sort by me if not already sorted by me\n    if (!this.isSortedByMe().asc) {\n      this.sortByMe();\n    }\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.sortMethod = this.getSortMethod();\n    r.filter = !isDummyNumberFilter(this.currentFilter) ? this.currentFilter : null;\n    r.map = this.mapping.toJSON();\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.sortMethod) {\n      this.sort = dump.sortMethod;\n    }\n    if (dump.filter) {\n      this.currentFilter = restoreNumberFilter(dump.filter);\n    }\n    if (dump.map || dump.domain) {\n      this.mapping = restoreMapping(dump, factory);\n    }\n    if (dump.colorMapping) {\n      this.colorMapping = factory.colorMappingFunction(dump.colorMapping);\n    }\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        NumberMapColumn.EVENT_COLOR_MAPPING_CHANGED,\n        NumberMapColumn.EVENT_MAPPING_CHANGED,\n        NumberMapColumn.EVENT_SORTMETHOD_CHANGED,\n        NumberMapColumn.EVENT_FILTER_CHANGED,\n      ]);\n  }\n\n  on(type: typeof NumberMapColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_NMC | null): this;\n  on(type: typeof NumberMapColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_NMC | null): this;\n  on(type: typeof NumberMapColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_NMC | null): this;\n  on(type: typeof NumberMapColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_NMC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getOriginalMapping() {\n    return this.original.clone();\n  }\n\n  getMapping() {\n    return this.mapping.clone();\n  }\n\n  setMapping(mapping: IMappingFunction) {\n    if (this.mapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [NumberMapColumn.EVENT_MAPPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.mapping.clone(),\n      (this.mapping = mapping)\n    );\n  }\n\n  getColor(row: IDataRow) {\n    return NumberColumn.prototype.getColor.call(this, row);\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [NumberMapColumn.EVENT_COLOR_MAPPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  isFiltered() {\n    return NumberColumn.prototype.isFiltered.call(this);\n  }\n\n  getFilter(): INumberFilter {\n    return NumberColumn.prototype.getFilter.call(this);\n  }\n\n  setFilter(value: INumberFilter | null) {\n    NumberColumn.prototype.setFilter.call(this, value);\n  }\n\n  filter(row: IDataRow) {\n    return NumberColumn.prototype.filter.call(this, row);\n  }\n\n  clearFilter() {\n    return NumberColumn.prototype.clearFilter.call(this);\n  }\n}\n","import { equalArrays, extent, IEventListener, ISequence } from '../internal';\nimport { Category, toolbar } from './annotations';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\nimport CategoricalColumn from './CategoricalColumn';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  groupRendererChanged,\n  labelChanged,\n  metaDataChanged,\n  rendererTypeChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n} from './Column';\nimport type {\n  ICategoricalColumn,\n  ICategoricalDesc,\n  ICategoricalFilter,\n  ICategory,\n  ICategoricalColorMappingFunction,\n} from './ICategoricalColumn';\nimport type { IDataRow, IValueColumnDesc, ITypeFactory } from './interfaces';\nimport NumberColumn from './NumberColumn';\nimport type { INumberColumn } from './INumberColumn';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport { toCategories } from './internalCategorical';\nimport { DEFAULT_FORMATTER } from './internalNumber';\nimport { integrateDefaults } from './internal';\n\nexport declare type IOrdinalColumnDesc = ICategoricalDesc & IValueColumnDesc<number>;\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf OrdinalColumn\n * @event\n */\nexport declare function mappingChanged_OC(previous: number[], current: number[]): void;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf OrdinalColumn\n * @event\n */\nexport declare function colorMappingChanged_OC(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf OrdinalColumn\n * @event\n */\nexport declare function filterChanged_OC(previous: ICategoricalFilter | null, current: ICategoricalFilter | null): void;\n\n/**\n * similar to a categorical column but the categories are mapped to numbers\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'group', 'filterOrdinal', 'colorMappedCategorical')\n@Category('categorical')\nexport default class OrdinalColumn extends ValueColumn<number> implements INumberColumn, ICategoricalColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_FILTER_CHANGED = CategoricalColumn.EVENT_FILTER_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  readonly categories: ICategory[];\n\n  private colorMapping: ICategoricalColorMappingFunction;\n\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\n\n  private currentFilter: ICategoricalFilter | null = null;\n\n  constructor(id: string, desc: Readonly<IOrdinalColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'number',\n        groupRenderer: 'boxplot',\n      })\n    );\n    this.categories = toCategories(desc);\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n\n  onDataUpdate(rows: ISequence<IDataRow>): void {\n    super.onDataUpdate(rows);\n    if ((this.desc as IOrdinalColumnDesc).categories) {\n      return;\n    }\n    // derive\n    const categories = new Set<string>();\n    rows.forEach((row) => {\n      const value = super.getValue(row);\n      if (!value) {\n        return;\n      }\n      categories.add(String(value));\n    });\n    this.categories.splice(0, this.categories.length, ...toCategories({ categories: Array.from(categories) }));\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        OrdinalColumn.EVENT_COLOR_MAPPING_CHANGED,\n        OrdinalColumn.EVENT_MAPPING_CHANGED,\n        OrdinalColumn.EVENT_FILTER_CHANGED,\n      ]);\n  }\n\n  on(type: typeof OrdinalColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_OC | null): this;\n  on(type: typeof OrdinalColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_OC | null): this;\n  on(type: typeof OrdinalColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_OC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getNumberFormat() {\n    return DEFAULT_FORMATTER;\n  }\n\n  get dataLength() {\n    return this.categories.length;\n  }\n\n  get labels() {\n    return this.categories.map((d) => d.label);\n  }\n\n  getValue(row: IDataRow) {\n    const v = this.getNumber(row);\n    return Number.isNaN(v) ? null : v;\n  }\n\n  getCategory(row: IDataRow) {\n    const v = super.getValue(row);\n    if (!v) {\n      return null;\n    }\n    const vs = String(v);\n    return this.lookup.has(vs) ? this.lookup.get(vs)! : null;\n  }\n\n  getCategories(row: IDataRow) {\n    return [this.getCategory(row)];\n  }\n\n  iterCategory(row: IDataRow) {\n    return [this.getCategory(row)];\n  }\n\n  iterNumber(row: IDataRow) {\n    return [this.getNumber(row)];\n  }\n\n  iterRawNumber(row: IDataRow) {\n    return [this.getRawNumber(row)];\n  }\n\n  getColor(row: IDataRow) {\n    return CategoricalColumn.prototype.getColor.call(this, row);\n  }\n\n  getLabel(row: IDataRow) {\n    return CategoricalColumn.prototype.getLabel.call(this, row);\n  }\n\n  getLabels(row: IDataRow) {\n    return CategoricalColumn.prototype.getLabels.call(this, row);\n  }\n\n  getValues(row: IDataRow) {\n    return CategoricalColumn.prototype.getValues.call(this, row);\n  }\n\n  getMap(row: IDataRow) {\n    return CategoricalColumn.prototype.getMap.call(this, row);\n  }\n\n  getMapLabel(row: IDataRow) {\n    return CategoricalColumn.prototype.getMapLabel.call(this, row);\n  }\n\n  getSet(row: IDataRow) {\n    return CategoricalColumn.prototype.getSet.call(this, row);\n  }\n\n  getNumber(row: IDataRow) {\n    const v = this.getCategory(row);\n    return v ? v.value : NaN;\n  }\n\n  getRawNumber(row: IDataRow) {\n    return this.getNumber(row);\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      const value = this.getNumber(row);\n      if (Number.isNaN(value)) {\n        return null;\n      }\n      return {\n        name: this.getLabel(row),\n        value,\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = CategoricalColumn.prototype.dump.call(this, toDescRef);\n    r.mapping = this.getMapping();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    CategoricalColumn.prototype.restore.call(this, dump, factory);\n    if (dump.mapping) {\n      this.setMapping(dump.mapping);\n    }\n  }\n\n  getMapping() {\n    return this.categories.map((d) => d.value);\n  }\n\n  setMapping(mapping: number[]) {\n    const r = extent(mapping);\n    mapping = mapping.map((d) => (d - r[0]!) / (r[1]! - r[0]!));\n    const bak = this.getMapping();\n    if (equalArrays(bak, mapping)) {\n      return;\n    }\n    this.categories.forEach((d, i) => (d.value = mapping[i] || 0));\n    this.fire(\n      [\n        OrdinalColumn.EVENT_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      bak,\n      this.getMapping()\n    );\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    return CategoricalColumn.prototype.setColorMapping.call(this, mapping);\n  }\n\n  isFiltered() {\n    return this.currentFilter != null;\n  }\n\n  filter(row: IDataRow): boolean {\n    return CategoricalColumn.prototype.filter.call(this, row);\n  }\n\n  group(row: IDataRow) {\n    return CategoricalColumn.prototype.group.call(this, row);\n  }\n\n  getFilter() {\n    return this.currentFilter;\n  }\n\n  setFilter(filter: ICategoricalFilter | null) {\n    return CategoricalColumn.prototype.setFilter.call(this, filter);\n  }\n\n  clearFilter() {\n    return CategoricalColumn.prototype.clearFilter.call(this);\n  }\n\n  toCompareValue(row: IDataRow) {\n    return CategoricalColumn.prototype.toCompareValue.call(this, row);\n  }\n\n  toCompareValueType() {\n    return CategoricalColumn.prototype.toCompareValueType.call(this);\n  }\n\n  getRenderer(): string {\n    return NumberColumn.prototype.getRenderer.call(this);\n  }\n}\n","import NumberColumn from './NumberColumn';\nimport type { IEventListener } from '../internal';\nimport { SortByDefault, toolbar } from './annotations';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  groupRendererChanged,\n  labelChanged,\n  metaDataChanged,\n  rendererTypeChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n} from './Column';\nimport type { addColumn, moveColumn, removeColumn } from './CompositeColumn';\nimport type CompositeColumn from './CompositeColumn';\nimport CompositeNumberColumn, { ICompositeNumberDesc } from './CompositeNumberColumn';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport { isDummyNumberFilter, noNumberFilter, restoreNumberFilter } from './internalNumber';\nimport {\n  IColorMappingFunction,\n  IMapAbleColumn,\n  IMapAbleDesc,\n  IMappingFunction,\n  INumberFilter,\n  isNumberColumn,\n} from './INumberColumn';\nimport { restoreMapping } from './MappingFunction';\nimport { integrateDefaults } from './internal';\n\nconst DEFAULT_SCRIPT = `let s = 0;\ncol.forEach((c) => s += c.v);\nreturn s / col.length`;\n\n/**\n * factory for creating a description creating a mean column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createScriptDesc(label = 'script') {\n  return { type: 'script', label, script: DEFAULT_SCRIPT };\n}\n\nfunction wrapWithContext(code: string) {\n  let clean = code.trim();\n  if (!clean.includes('return')) {\n    clean = `return (${clean});`;\n  }\n  return `\n  const max = function(arr) { return Math.max.apply(Math, arr); };\n  const min = function(arr) { return Math.min.apply(Math, arr); };\n  const extent = function(arr) { return [min(arr), max(arr)]; };\n  const clamp = function(v, minValue, maxValue) { return v < minValue ? minValue : (v > maxValue ? maxValue : v); };\n  const normalize = function(v, minMax, max) {\n    if (Array.isArray(minMax)) {\n      minMax = minMax[0];\n      max = minMax[1];\n    }\n    return (v - minMax) / (max - minMax);\n  };\n  const denormalize = function(v, minMax, max) {\n    if (Array.isArray(minMax)) {\n      minMax = minMax[0];\n      max = minMax[1];\n    }\n    return v * (max - minMax) + minMax;\n  };\n  const linear = function(v, source, target) {\n    target = target || [0, 1];\n    return denormalize(normalize(v, source), target);\n  };\n  const v = (function custom() {\n    ${clean}\n  })();\n\n  return typeof v === 'number' ? v : NaN`;\n}\n\ninterface IColumnWrapper {\n  v: any;\n  raw: number | null;\n  type: string;\n  name: string;\n  id: string;\n}\n\n/**\n * wrapper class for simpler column accessing\n */\nclass ColumnWrapper implements IColumnWrapper {\n  constructor(private readonly c: Column, public readonly v: any, public readonly raw: number | null) {}\n\n  get type() {\n    return this.c.desc.type;\n  }\n\n  get name() {\n    return this.c.getMetaData().label;\n  }\n\n  get id() {\n    return this.c.id;\n  }\n}\n\nclass LazyColumnWrapper implements IColumnWrapper {\n  constructor(private readonly c: Column, private readonly row: IDataRow) {}\n\n  get type() {\n    return this.c.desc.type;\n  }\n\n  get name() {\n    return this.c.getMetaData().label;\n  }\n\n  get id() {\n    return this.c.id;\n  }\n\n  get v() {\n    return this.c.getValue(this.row);\n  }\n\n  get raw() {\n    return isNumberColumn(this.c) ? this.c.getRawNumber(this.row) : null;\n  }\n}\n\n/**\n * helper context for accessing columns within a scripted columns\n */\nclass ColumnContext {\n  private readonly lookup = new Map<string, IColumnWrapper>();\n  private _all: ColumnContext | null = null;\n\n  constructor(private readonly children: IColumnWrapper[], private readonly allFactory?: () => ColumnContext) {\n    children.forEach((c) => {\n      this.lookup.set(`ID@${c.id}`, c);\n      this.lookup.set(`ID@${c.id.toLowerCase()}`, c);\n      this.lookup.set(`NAME@${c.name}`, c);\n      this.lookup.set(`NAME@${c.name.toLowerCase()}`, c);\n    });\n  }\n\n  /**\n   * get a column by name\n   * @param {string} name\n   * @return {IColumnWrapper}\n   */\n  byName(name: string) {\n    return this.lookup.get(`NAME@${name}`);\n  }\n\n  /**\n   * get a column by id\n   * @param {string} id\n   * @return {IColumnWrapper}\n   */\n  byID(id: string) {\n    return this.lookup.get(`ID@${id}`);\n  }\n\n  /**\n   * get a column by index\n   * @param {number} index\n   * @return {IColumnWrapper}\n   */\n  byIndex(index: number) {\n    return this.children[index];\n  }\n\n  forEach(callback: (c: IColumnWrapper, index: number) => void) {\n    return this.children.forEach(callback);\n  }\n\n  /**\n   * number of columns\n   * @return {number}\n   */\n  get length() {\n    return this.children.length;\n  }\n\n  /**\n   * get the all context, i.e one with all columns of this ranking\n   * @return {ColumnContext}\n   */\n  get all() {\n    if (this._all == null) {\n      this._all = this.allFactory ? this.allFactory() : null;\n    }\n    return this._all!;\n  }\n}\n\nexport interface IScriptDesc extends ICompositeNumberDesc, IMapAbleDesc {\n  /**\n   * the function to use, it has two parameters: children (current children) and values (their row values)\n   * @default 'return Math.max.apply(Math,values)'\n   */\n  script?: string;\n}\n\nexport declare type IScriptColumnDesc = IScriptDesc;\n\n/**\n * emitted when the script property changes\n * @asMemberOf ScriptColumn\n * @event\n */\nexport declare function scriptChanged(previous: string, current: string): void;\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf ScriptColumn\n * @event\n */\nexport declare function mappingChanged(previous: IMappingFunction, current: IMappingFunction): void;\n/**\n * emitted when the color mapping property changes\n * @asMemberOf ScriptColumn\n * @event\n */\nexport declare function colorMappingChanged(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf ScriptColumn\n * @event\n */\nexport declare function filterChanged(previous: INumberFilter | null, current: INumberFilter | null): void;\n\n/**\n * column combiner which uses a custom JavaScript function to combined the values\n * The script itself can be any valid JavaScript code. It will be embedded in a function.\n * Therefore the last statement has to return a value.\n *\n * In case of a single line statement the code piece statement <code>return</code> will be automatically prefixed.\n *\n * The function signature is: <br><code>(row: any, index: number, children: Column[], values: any[], raws: (number|null)[]) => number</code>\n *  <dl>\n *    <dt>param: <code>row</code></dt>\n *    <dd>the row in the dataset to compute the value for</dd>\n *    <dt>param: <code>index</code></dt>\n *    <dd>the index of the row</dd>\n *    <dt>param: <code>children</code></dt>\n *    <dd>the list of LineUp columns that are part of this ScriptColumn</dd>\n *    <dt>param: <code>values</code></dt>\n *    <dd>the computed value of each column (see <code>children</code>) for the current row</dd>\n *    <dt>param: <code>raws</code></dt>\n *    <dd>similar to <code>values</code>. Numeric columns return by default the normalized value, this array gives access to the original \"raw\" values before mapping is applied</dd>\n *    <dt>returns:</dt>\n *    <dd>the computed number <strong>in the range [0, 1] or NaN</strong></dd>\n *  </dl>\n *\n * In addition to the standard JavaScript functions and objects (Math, ...) a couple of utility functions are available: </p>\n * <dl>\n *    <dt><code>max(arr: number[]) => number</code></dt>\n *    <dd>computes the maximum of the given array of numbers</dd>\n *    <dt><code>min(arr: number[]) => number</code></dt>\n *    <dd>computes the minimum of the given array of numbers</dd>\n *    <dt><code>extent(arr: number[]) => [number, number]</code></dt>\n *    <dd>computes both minimum and maximum and returning an array with the first element the minimum and the second the maximum</dd>\n *    <dt><code>clamp(v: number, min: number, max: number) => number</code></dt>\n *    <dd>ensures that the given value is within the given min/max value</dd>\n *    <dt><code>normalize(v: number, min: number, max: number) => number</code></dt>\n *    <dd>normalizes the given value <code>(v - min) / (max - min)</code></dd>\n *    <dt><code>denormalize(v: number, min: number, max: number) => number</code></dt>\n *    <dd>inverts a normalized value <code>v * (max - min) + min</code></dd>\n *    <dt><code>linear(v: number, input: [number, number], output: [number, number]) => number</code></dt>\n *    <dd>performs a linear mapping from input domain to output domain both given as an array of [min, max] values. <code>denormalize(normalize(v, input[0], input[1]), output[0], output[1])</code></dd>\n *  </dl>\n */\n@toolbar('script', 'filterNumber', 'colorMapped', 'editMapping')\n@SortByDefault('descending')\nexport default class ScriptColumn extends CompositeNumberColumn implements IMapAbleColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\n  static readonly EVENT_SCRIPT_CHANGED = 'scriptChanged';\n  static readonly DEFAULT_SCRIPT = DEFAULT_SCRIPT;\n\n  private script = ScriptColumn.DEFAULT_SCRIPT;\n  private f: (children, values: number[], raws: any[], col: ColumnContext, row: any, index: number) => number | null =\n    null;\n  private mapping: IMappingFunction;\n  private original: IMappingFunction;\n  private colorMapping: IColorMappingFunction;\n  /**\n   * currently active filter\n   * @type {{min: number, max: number}}\n   * @private\n   */\n  private currentFilter: INumberFilter = noNumberFilter();\n\n  constructor(id: string, desc: Readonly<IScriptColumnDesc>, factory: ITypeFactory) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'number',\n        groupRenderer: 'boxplot',\n        summaryRenderer: 'histogram',\n      })\n    );\n    this.script = desc.script || this.script;\n    this.mapping = restoreMapping(desc, factory);\n    this.original = this.mapping.clone();\n    this.colorMapping = factory.colorMappingFunction(desc.colorMapping || desc.color);\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        ScriptColumn.EVENT_SCRIPT_CHANGED,\n        ScriptColumn.EVENT_COLOR_MAPPING_CHANGED,\n        ScriptColumn.EVENT_MAPPING_CHANGED,\n      ]);\n  }\n\n  on(type: typeof ScriptColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged | null): this;\n  on(type: typeof ScriptColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged | null): this;\n  on(type: typeof ScriptColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof ScriptColumn.EVENT_SCRIPT_CHANGED, listener: typeof scriptChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  setScript(script: string) {\n    if (this.script === script) {\n      return;\n    }\n    this.f = null;\n    this.fire(\n      [ScriptColumn.EVENT_SCRIPT_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY],\n      this.script,\n      (this.script = script)\n    );\n  }\n\n  getScript() {\n    return this.script;\n  }\n\n  dump(toDescRef: (desc: any) => any) {\n    const r = super.dump(toDescRef);\n    r.script = this.script;\n    r.filter = !isDummyNumberFilter(this.currentFilter) ? this.currentFilter : null;\n    r.map = this.mapping.toJSON();\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n\n    this.script = dump.script || this.script;\n    if (dump.filter) {\n      this.currentFilter = restoreNumberFilter(dump.filter);\n    }\n    if (dump.map || dump.domain) {\n      this.mapping = restoreMapping(dump.map, factory);\n    }\n    if (dump.colorMapping) {\n      this.colorMapping = factory.colorMappingFunction(dump.colorMapping);\n    }\n  }\n\n  protected compute(row: IDataRow) {\n    if (this.f == null) {\n      // eslint-disable-next-line no-new-func\n      this.f = new Function('children', 'values', 'raws', 'col', 'row', 'index', wrapWithContext(this.script)) as any;\n    }\n    const children = this._children;\n    const values = this._children.map((d) => d.getValue(row));\n    const raws = this._children.map((d) => (isNumberColumn(d) ? d.getRawNumber(row) : null)) as number[];\n    const col = new ColumnContext(\n      children.map((c, i) => new ColumnWrapper(c, values[i], raws[i])),\n      () => {\n        const cols = this.findMyRanker()!.flatColumns; // all except myself\n        return new ColumnContext(cols.map((c) => new LazyColumnWrapper(c, row)));\n      }\n    );\n    return this.f.call(this, children, values, raws, col, row.v, row.i);\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      return {\n        value: this.getRawNumber(row),\n        children: this.children.map((d) => d.getExportValue(row, format)),\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n\n  getRange() {\n    return this.mapping.getRange(this.getNumberFormat());\n  }\n\n  getOriginalMapping() {\n    return this.original.clone();\n  }\n\n  getMapping() {\n    return this.mapping.clone();\n  }\n\n  setMapping(mapping: IMappingFunction) {\n    if (this.mapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        ScriptColumn.EVENT_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.mapping.clone(),\n      (this.mapping = mapping)\n    );\n  }\n\n  getColor(row: IDataRow) {\n    return NumberColumn.prototype.getColor.call(this, row);\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        ScriptColumn.EVENT_COLOR_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  isFiltered() {\n    return NumberColumn.prototype.isFiltered.call(this);\n  }\n\n  getFilter(): INumberFilter {\n    return NumberColumn.prototype.getFilter.call(this);\n  }\n\n  setFilter(value: INumberFilter | null) {\n    NumberColumn.prototype.setFilter.call(this, value);\n  }\n\n  filter(row: IDataRow) {\n    return NumberColumn.prototype.filter.call(this, row);\n  }\n\n  clearFilter() {\n    return NumberColumn.prototype.clearFilter.call(this);\n  }\n}\n","import { toolbar } from './annotations';\nimport type {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type Column from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport type { IDataRow } from './interfaces';\nimport MapColumn, { IMapColumnDesc } from './MapColumn';\nimport { EAlignment, IStringDesc } from './StringColumn';\nimport type { IEventListener } from '../internal';\nimport { isMissingValue } from './missing';\nimport { integrateDefaults } from './internal';\n\nexport declare type IStringMapColumnDesc = IStringDesc & IMapColumnDesc<string>;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'search')\nexport default class StringMapColumn extends MapColumn<string> {\n  readonly alignment: EAlignment;\n  readonly escape: boolean;\n\n  constructor(id: string, desc: Readonly<IStringMapColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 200,\n        renderer: 'map',\n      })\n    );\n    this.alignment = desc.alignment ?? EAlignment.left;\n    this.escape = desc.escape !== false;\n  }\n\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow) {\n    const r = this.getMapValue(row);\n    return r.every((d) => d.value === '') ? null : r;\n  }\n\n  getMapValue(row: IDataRow) {\n    return super.getMap(row).map(({ key, value }) => ({\n      key,\n      value: isMissingValue(value) ? '' : String(value),\n    }));\n  }\n}\n","import { toolbar } from './annotations';\nimport ArrayColumn, { IArrayColumnDesc } from './ArrayColumn';\nimport type { IDataRow } from './interfaces';\nimport { EAlignment, IStringDesc } from './StringColumn';\nimport { isMissingValue } from './missing';\nimport { integrateDefaults } from './internal';\n\nexport declare type IStringsColumnDesc = IStringDesc & IArrayColumnDesc<string>;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'search')\nexport default class StringsColumn extends ArrayColumn<string> {\n  readonly alignment: EAlignment;\n  readonly escape: boolean;\n\n  constructor(id: string, desc: Readonly<IStringsColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 200,\n      })\n    );\n    this.alignment = desc.alignment ?? EAlignment.left;\n    this.escape = desc.escape !== false;\n  }\n\n  getValues(row: IDataRow) {\n    return super.getValues(row).map((v) => {\n      return isMissingValue(v) ? '' : String(v);\n    });\n  }\n}\n","import { Category, toolbar, dialogAddons } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type { IDataRow, IGroup, IValueColumnDesc, ITypeFactory } from './interfaces';\nimport { patternFunction, integrateDefaults } from './internal';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport type { IEventListener, ISequence } from '../internal';\nimport { IStringDesc, EAlignment, IStringGroupCriteria, EStringGroupCriteriaType, IStringFilter } from './StringColumn';\nimport StringColumn from './StringColumn';\n\nexport interface ILinkDesc extends IStringDesc {\n  /**\n   * replacement pattern, use use <code>${value}</code> for the current value, <code>${escapedValue}</code> for an url safe value and <code>${item}</code> for the whole item\n   */\n  pattern?: string;\n\n  /**\n   * optional list of pattern templates\n   */\n  patternTemplates?: string[];\n}\n\nexport interface ILink {\n  alt: string;\n  href: string;\n}\n\nexport declare type ILinkColumnDesc = ILinkDesc & IValueColumnDesc<string | ILink>;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf LinkColumn\n * @event\n */\nexport declare function filterChanged_LC(previous: string | RegExp | null, current: string | RegExp | null): void;\n\n/**\n * emitted when the grouping property changes\n * @asMemberOf LinkColumn\n * @event\n */\nexport declare function groupingChanged_LC(previous: (RegExp | string)[][], current: (RegExp | string)[][]): void;\n\n/**\n * emitted when the pattern property changes\n * @asMemberOf LinkColumn\n * @event\n */\nexport declare function patternChanged_LC(previous: string, current: string): void;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'search', 'groupBy', 'filterString', 'editPattern')\n@dialogAddons('group', 'groupString')\n@Category('string')\nexport default class LinkColumn extends ValueColumn<string | ILink> {\n  static readonly EVENT_FILTER_CHANGED = StringColumn.EVENT_FILTER_CHANGED;\n  static readonly EVENT_GROUPING_CHANGED = StringColumn.EVENT_GROUPING_CHANGED;\n  static readonly EVENT_PATTERN_CHANGED = 'patternChanged';\n\n  private pattern: string;\n  private patternFunction: (value: string, raw: any) => string | null = null;\n  readonly patternTemplates: string[];\n\n  private currentFilter: string | RegExp | null = null;\n  private currentGroupCriteria: IStringGroupCriteria = {\n    type: EStringGroupCriteriaType.startsWith,\n    values: [],\n  };\n\n  readonly alignment: EAlignment;\n  readonly escape: boolean;\n\n  constructor(id: string, desc: Readonly<ILinkColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(\n        desc,\n        Object.assign(\n          {\n            width: 200,\n          },\n          desc.pattern\n            ? {\n                renderer: 'link',\n                groupRenderer: 'link',\n              }\n            : {}\n        )\n      )\n    );\n    this.alignment = desc.alignment ?? EAlignment.left;\n    this.escape = desc.escape !== false;\n\n    this.pattern = desc.pattern || '';\n    this.patternTemplates = desc.patternTemplates || [];\n  }\n\n  setPattern(pattern: string) {\n    if (pattern === this.pattern) {\n      return;\n    }\n    this.patternFunction = null; // reset cache\n    this.fire(\n      [\n        LinkColumn.EVENT_PATTERN_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.pattern,\n      (this.pattern = pattern)\n    );\n  }\n\n  getPattern() {\n    return this.pattern;\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([LinkColumn.EVENT_PATTERN_CHANGED, LinkColumn.EVENT_GROUPING_CHANGED, LinkColumn.EVENT_FILTER_CHANGED]);\n  }\n\n  on(type: typeof LinkColumn.EVENT_PATTERN_CHANGED, listener: typeof patternChanged_LC | null): this;\n  on(type: typeof LinkColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_LC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof LinkColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged_LC | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow) {\n    const l = this.getLink(row);\n    return l == null ? null : l.href;\n  }\n\n  getLink(row: IDataRow): ILink | null {\n    const v: string | null | ILink = super.getValue(row);\n    return this.transformValue(v, row);\n  }\n\n  private transformValue(v: any, row: IDataRow) {\n    if (v == null || v === '') {\n      return null;\n    }\n    if (typeof v === 'string') {\n      if (!this.pattern) {\n        return {\n          alt: v,\n          href: v,\n        };\n      }\n      if (!this.patternFunction) {\n        this.patternFunction = patternFunction(this.pattern, 'item');\n      }\n      return {\n        alt: v,\n        href: this.patternFunction.call(this, v, row.v),\n      };\n    }\n    return v;\n  }\n\n  getLabel(row: IDataRow) {\n    const l = this.getLink(row);\n    return l == null ? '' : l.alt;\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = StringColumn.prototype.dump.call(this, toDescRef);\n    if (this.pattern !== (this.desc as any).pattern) {\n      r.pattern = this.pattern;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    StringColumn.prototype.restore.call(this, dump, factory);\n    if (dump.pattern) {\n      this.pattern = dump.pattern;\n    }\n  }\n\n  isFiltered() {\n    return this.currentFilter != null;\n  }\n\n  filter(row: IDataRow) {\n    return StringColumn.prototype.filter.call(this, row);\n  }\n\n  getFilter() {\n    return this.currentFilter;\n  }\n\n  setFilter(filter: IStringFilter) {\n    return StringColumn.prototype.setFilter.call(this, filter);\n  }\n\n  clearFilter() {\n    return StringColumn.prototype.clearFilter.call(this);\n  }\n\n  getGroupCriteria() {\n    return this.currentGroupCriteria;\n  }\n\n  setGroupCriteria(value: IStringGroupCriteria) {\n    return StringColumn.prototype.setGroupCriteria.call(this, value);\n  }\n\n  toCompareValue(a: IDataRow) {\n    return StringColumn.prototype.toCompareValue.call(this, a);\n  }\n\n  toCompareValueType() {\n    return StringColumn.prototype.toCompareValueType.call(this);\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, group: IGroup) {\n    return StringColumn.prototype.toCompareGroupValue.call(this, rows, group);\n  }\n\n  toCompareGroupValueType() {\n    return StringColumn.prototype.toCompareGroupValueType.call(this);\n  }\n\n  group(row: IDataRow): IGroup {\n    return StringColumn.prototype.group.call(this, row);\n  }\n}\n","import { toolbar } from './annotations';\nimport type Column from './Column';\nimport type {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport { patternFunction, integrateDefaults } from './internal';\nimport MapColumn, { IMapColumnDesc } from './MapColumn';\nimport LinkColumn, { ILinkDesc } from './LinkColumn';\nimport type { IEventListener } from '../internal';\nimport { EAlignment } from './StringColumn';\nimport type { IKeyValue } from './IArrayColumn';\nimport type { ILink } from './LinkColumn';\n\nexport declare type ILinkMapColumnDesc = ILinkDesc & IMapColumnDesc<string>;\n\n/**\n * emitted when the pattern property changes\n * @asMemberOf LinkMapColumn\n * @event\n */\nexport declare function patternChanged_LMC(previous: string, current: string): void;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'search', 'editPattern')\nexport default class LinkMapColumn extends MapColumn<string> {\n  static readonly EVENT_PATTERN_CHANGED = LinkColumn.EVENT_PATTERN_CHANGED;\n\n  readonly alignment: EAlignment;\n  readonly escape: boolean;\n  private pattern: string;\n  private patternFunction: (value: string, raw: any, key: string) => string | null = null;\n  readonly patternTemplates: string[];\n\n  constructor(id: string, desc: Readonly<ILinkMapColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 200,\n        renderer: 'map',\n      })\n    );\n    this.alignment = desc.alignment ?? EAlignment.left;\n    this.escape = desc.escape !== false;\n    this.pattern = desc.pattern ?? '';\n    this.patternTemplates = desc.patternTemplates ?? [];\n  }\n\n  setPattern(pattern: string) {\n    LinkColumn.prototype.setPattern.call(this, pattern);\n  }\n\n  getPattern() {\n    return this.pattern;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([LinkColumn.EVENT_PATTERN_CHANGED]);\n  }\n\n  on(type: typeof LinkColumn.EVENT_PATTERN_CHANGED, listener: typeof patternChanged_LMC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow) {\n    const r = this.getLinkMap(row);\n    return r.every((d) => d.value == null)\n      ? null\n      : r.map(({ key, value }) => ({\n          key,\n          value: value ? value.href : '',\n        }));\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getLinkMap(row).map(({ key, value }) => ({\n      key,\n      value: value ? value.alt : '',\n    }));\n  }\n\n  getLinkMap(row: IDataRow): IKeyValue<ILink>[] {\n    return super.getMap(row).map(({ key, value }) => ({\n      key,\n      value: this.transformValue(value, row, key),\n    }));\n  }\n\n  private transformValue(v: any, row: IDataRow, key: string) {\n    if (v == null || v === '') {\n      return null;\n    }\n    if (typeof v === 'string') {\n      if (!this.pattern) {\n        return {\n          alt: v,\n          href: v,\n        };\n      }\n      if (!this.patternFunction) {\n        this.patternFunction = patternFunction(this.pattern, 'item', 'key');\n      }\n      return {\n        alt: v,\n        href: this.patternFunction.call(this, v, row.v, key),\n      };\n    }\n    return v;\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    if (this.pattern !== (this.desc as any).pattern) {\n      r.pattern = this.pattern;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    if (dump.pattern) {\n      this.pattern = dump.pattern;\n    }\n    super.restore(dump, factory);\n  }\n}\n","import { toolbar } from './annotations';\nimport ArrayColumn, { IArrayColumnDesc } from './ArrayColumn';\nimport type {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type Column from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport { patternFunction, integrateDefaults } from './internal';\nimport { EAlignment } from './StringColumn';\nimport type { IEventListener } from '../internal';\nimport LinkColumn, { ILink, ILinkDesc } from './LinkColumn';\n\nexport declare type ILinksColumnDesc = ILinkDesc & IArrayColumnDesc<string | ILink>;\n\n/**\n * emitted when the pattern property changes\n * @asMemberOf LinksColumn\n * @event\n */\nexport declare function patternChanged_LCS(previous: string, current: string): void;\n\n@toolbar('rename', 'search', 'editPattern')\nexport default class LinksColumn extends ArrayColumn<string | ILink> {\n  static readonly EVENT_PATTERN_CHANGED = LinkColumn.EVENT_PATTERN_CHANGED;\n\n  readonly alignment: EAlignment;\n  readonly escape: boolean;\n  private pattern: string;\n  private patternFunction: (value: string, raw: any, index: number) => string | null = null;\n  readonly patternTemplates: string[];\n\n  constructor(id: string, desc: Readonly<ILinksColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 200,\n      })\n    );\n    this.alignment = desc.alignment ?? EAlignment.left;\n    this.escape = desc.escape !== false;\n    this.pattern = desc.pattern ?? '';\n    this.patternTemplates = desc.patternTemplates ?? [];\n  }\n\n  setPattern(pattern: string) {\n    return LinkColumn.prototype.setPattern.call(this, pattern);\n  }\n\n  getPattern() {\n    return this.pattern;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([LinksColumn.EVENT_PATTERN_CHANGED]);\n  }\n\n  on(type: typeof LinksColumn.EVENT_PATTERN_CHANGED, listener: typeof patternChanged_LCS | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValues(row: IDataRow) {\n    return this.getLinks(row).map((d) => (d ? d.href : ''));\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getLinks(row).map((d) => (d ? d.alt : ''));\n  }\n\n  private transformValue(v: any, row: IDataRow, i: number) {\n    if (v == null || v === '') {\n      return null;\n    }\n    if (typeof v === 'string') {\n      if (!this.pattern) {\n        return {\n          alt: v,\n          href: v,\n        };\n      }\n      if (!this.patternFunction) {\n        this.patternFunction = patternFunction(this.pattern, 'item', 'index');\n      }\n      return {\n        alt: v,\n        href: this.patternFunction.call(this, v, row.v, i),\n      };\n    }\n    return v;\n  }\n\n  getLinks(row: IDataRow): ILink[] {\n    return super.getValues(row).map((v, i) => {\n      return this.transformValue(v, row, i);\n    });\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    if (this.pattern !== (this.desc as any).pattern) {\n      r.pattern = this.pattern;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    if (dump.pattern) {\n      this.pattern = dump.pattern;\n    }\n    super.restore(dump, factory);\n  }\n}\n","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nexport function isPromiseLike(p) {\n    return p != null && typeof p.then === 'function';\n}\n/**\n * the symbol returned when the promise was aborted\n */\nexport var ABORTED = Symbol('aborted');\nfunction thenFactory(loader, isAborted, abort) {\n    function then(onfulfilled, _onrejected) {\n        var fullfiller = loader.then(function (loaded) {\n            var loadedOrAborted = isAborted() ? ABORTED : loaded;\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var res = onfulfilled ? onfulfilled(loadedOrAborted) : loadedOrAborted;\n            if (isPromiseLike(res)) {\n                return res.then(function (r) {\n                    return isAborted() ? ABORTED : r;\n                });\n            }\n            return isAborted() ? ABORTED : res;\n        });\n        return {\n            then: thenFactory(fullfiller, isAborted, abort),\n            abort: abort,\n            isAborted: isAborted,\n        };\n    }\n    return then;\n}\n/**\n * abort able Promise wrapper, returns a promise which can be aborted, and trying to avoid executing therefore the wrapped promise\n * @param {Promise<T>} loader\n * @returns {any}\n */\nexport default function abortAble(loader) {\n    var aborted = null;\n    var isAborted = function () { return aborted === null; };\n    var aborter = new Promise(function (resolve) {\n        aborted = resolve;\n    });\n    var abort = function () {\n        if (aborted == null) {\n            return;\n        }\n        aborted(ABORTED);\n        aborted = null;\n    };\n    var race = Promise.race([aborter, loader]);\n    return {\n        then: thenFactory(race, isAborted, abort),\n        abort: abort,\n        isAborted: isAborted,\n    };\n}\nexport function abortAbleFetch(input, init) {\n    var controller = new AbortController();\n    var race = new Promise(function (resolve, reject) {\n        var r = fetch(input, __assign({ signal: controller.signal }, (init || {})));\n        r.then(resolve);\n        r.catch(function (error) {\n            if (error instanceof DOMException) {\n                resolve(ABORTED);\n            }\n            else {\n                reject(error);\n            }\n        });\n    });\n    var abort = controller.abort.bind(controller);\n    var isAborted = function () { return controller.signal.aborted; };\n    return {\n        then: thenFactory(race, isAborted, abort),\n        abort: abort,\n        isAborted: isAborted,\n    };\n}\n/**\n * similar to Promise.all but for abortAble\n */\nexport function abortAbleAll(values) {\n    var loader = Promise.all(values);\n    var aborted = null;\n    var isAborted = function () { return aborted === null; };\n    var aborter = new Promise(function (resolve) {\n        aborted = resolve;\n    });\n    var abort = function () {\n        if (aborted == null) {\n            return;\n        }\n        aborted(ABORTED);\n        for (var _i = 0, values_1 = values; _i < values_1.length; _i++) {\n            var v = values_1[_i];\n            if (isAbortAble(v)) {\n                v.abort();\n            }\n        }\n        aborted = null;\n    };\n    var race = Promise.race([aborter, loader]);\n    return {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        then: thenFactory(race, isAborted, abort),\n        abort: abort,\n        isAborted: isAborted,\n    };\n}\n/**\n * checked whether the given argument is an abortable Promise\n * @param {IAbortAblePromise<any> | any} candidate\n * @returns {boolean}\n */\nexport function isAbortAble(candidate) {\n    return (candidate != null &&\n        candidate &&\n        typeof candidate.then === 'function' &&\n        typeof candidate.abort === 'function');\n}\nexport function isAsyncUpdate(update) {\n    return update !== undefined && update !== null && update && isAbortAble(update.ready);\n}\n/**\n * similar to Promise.resolve\n */\nexport function abortAbleResolveNow(value) {\n    function then(onfulfilled, _onrejected) {\n        var res = onfulfilled ? onfulfilled(value) : value;\n        if (isAbortAble(res)) {\n            return res;\n        }\n        if (isPromiseLike(res)) {\n            return abortAble(res);\n        }\n        return {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            then: abortAbleResolveNow(res),\n            abort: function () { return undefined; },\n            isAborted: function () { return false; },\n        };\n    }\n    return {\n        then: then,\n        abort: function () { return undefined; },\n        isAborted: function () { return false; },\n    };\n}\n//# sourceMappingURL=abortAble.js.map","import type {\n  Column,\n  Ranking,\n  IColumnConstructor,\n  IColumnDesc,\n  IGroup,\n  IndicesArray,\n  IDataRow,\n  IRankingDump,\n  EAggregationState,\n  IColorMappingFunctionConstructor,\n  IMappingFunctionConstructor,\n  ITypeFactory,\n} from '../model';\nimport type { AEventDispatcher, ISequence } from '../internal';\nimport type { IRenderTasks } from '../renderer';\nimport type { IAbortAblePromise as IAbortAblePromiseImpl } from 'lineupengine';\n\nexport { ABORTED } from 'lineupengine';\nexport declare type IAbortAblePromise<T> = IAbortAblePromiseImpl<T>;\n\nexport declare type IAggregationStrategy = 'group' | 'item' | 'group+item' | 'group+top+item' | 'group+item+top';\n\nexport interface IDataProviderOptions {\n  columnTypes: { [columnType: string]: IColumnConstructor };\n  colorMappingFunctionTypes: { [colorMappingFunctionType: string]: IColorMappingFunctionConstructor };\n  mappingFunctionTypes: { [mappingFunctionType: string]: IMappingFunctionConstructor };\n\n  /**\n   * allow just single selected rows\n   * @default: false\n   */\n  singleSelection: boolean;\n\n  /**\n   * show top N rows as sample rows\n   * @default 10\n   */\n  showTopN: number;\n\n  /**\n   * aggregation strategy to show upon grouping, see also showTopN\n   * @default 'item'\n   */\n  aggregationStrategy: IAggregationStrategy;\n\n  /**\n   * whether to propagate a collapse operation to its children\n   * @default true\n   */\n  propagateAggregationState: boolean;\n}\n\nexport interface IDataProvider extends AEventDispatcher {\n  readonly columnTypes: { [columnType: string]: IColumnConstructor };\n\n  getTotalNumberOfRows(): number;\n\n  getTaskExecutor(): IRenderTasks;\n\n  getTypeFactory(): ITypeFactory;\n\n  takeSnapshot(col: Column): void;\n\n  selectAllOf(ranking: Ranking): void;\n\n  getSelection(): number[];\n\n  setSelection(dataIndices: IndicesArray): void;\n\n  toggleSelection(i: number, additional?: boolean): boolean;\n\n  isSelected(i: number): boolean;\n\n  removeRanking(ranking: Ranking): void;\n\n  ensureOneRanking(): void;\n\n  find(id: string): Column | null;\n\n  clone(col: Column): Column;\n\n  create(desc: IColumnDesc): Column | null;\n\n  toDescRef(desc: IColumnDesc): any;\n\n  fromDescRef(ref: any): IColumnDesc;\n\n  mappingSample(col: Column): Promise<ISequence<number>> | ISequence<number>;\n\n  searchAndJump(search: string | RegExp, col: Column): void;\n\n  getRankings(): Ranking[];\n\n  getFirstRanking(): Ranking | null;\n  getLastRanking(): Ranking;\n\n  getColumns(): IColumnDesc[];\n\n  getAggregationStrategy(): IAggregationStrategy;\n\n  isAggregated(ranking: Ranking, group: IGroup): boolean;\n\n  setAggregationState(ranking: Ranking, group: IGroup, state: EAggregationState): void;\n\n  getAggregationState(ranking: Ranking, group: IGroup): EAggregationState;\n\n  aggregateAllOf(ranking: Ranking, aggregateAll: boolean | number | EAggregationState, groups?: IGroup[]): void;\n\n  getTopNAggregated(ranking: Ranking, group: IGroup): number;\n\n  setTopNAggregated(ranking: Ranking, group: IGroup, value: number): void;\n\n  setShowTopN(value: number): void;\n  getShowTopN(): number;\n\n  getRow(dataIndex: number): Promise<IDataRow> | IDataRow;\n\n  clearFilters(): void;\n}\n\nexport const SCHEMA_REF = `https://lineup.js.org/develop/schema.4.0.0.json`;\n\nexport interface IDataProviderDump {\n  $schema?: string;\n  /**\n   * base for generating new uids\n   */\n  uid?: number;\n\n  /**\n   * current selection\n   */\n  selection?: number[];\n\n  /**\n   * list of aggregated group paths\n   */\n  aggregations?: string[] | { [key: string]: number };\n  /**\n   * ranking dumps\n   */\n  rankings?: IRankingDump[];\n\n  /**\n   * custom show top N setting\n   */\n  showTopN?: number;\n}\n\nexport interface IDeriveOptions {\n  /**\n   * maximal percentage of unique values to be treated as a categorical column\n   */\n  categoricalThreshold: number | ((unique: number, total: number) => boolean);\n\n  columns: string[];\n\n  /**\n   * date pattern to check for string matching them\n   * @default %x\n   */\n  datePattern: string | string[];\n}\n\nexport interface IExportOptions {\n  /**\n   * export separator, default: '\\t'\n   */\n  separator: string;\n  /**\n   * new line character, default: '\\n'\n   */\n  newline: string;\n  /**\n   * should a header be generated, default: true\n   */\n  header: boolean;\n  /**\n   * quote strings, default: false\n   */\n  quote: boolean;\n  /**\n   * quote string to use, default: '\"'\n   */\n  quoteChar: string;\n  /**\n   * filter specific column types, default: exclude all support types (selection, action, rank)\n   * @param col the column description to filter\n   */\n  filter: (col: Column) => boolean; //!isSupportType\n\n  /**\n   * whether the description should be part of the column header\n   */\n  verboseColumnHeaders: boolean;\n}\n","import type { IDataRow } from '../model';\nimport get from 'lodash.get';\n\n/**\n * @internal\n */\nexport function isComplexAccessor(column: any) {\n  // something like a.b or a[4]\n  return typeof column === 'string' && (column.includes('.') || column.includes('['));\n}\n\n/**\n * @internal\n */\nexport function resolveValue(value: any, column: string | number) {\n  if (value != null && value.hasOwnProperty(column)) {\n    // well complex but a direct hit\n    return value[column];\n  }\n  return get(value, column);\n}\n\n/**\n * @internal\n */\nexport function rowComplexGetter(row: IDataRow, desc: any) {\n  return resolveValue(row.v, desc.column);\n}\n\n/**\n * simple row getter\n * @internal\n */\nexport function rowGetter(row: IDataRow, desc: any) {\n  return row.v[desc.column];\n}\n\n/**\n * @internal\n */\nexport function rowGuessGetter(row: IDataRow, desc: any) {\n  const column = desc.column;\n  if (isComplexAccessor(column)) {\n    return rowComplexGetter(row, desc);\n  }\n  return rowGetter(row, desc);\n}\n","import {\n  Ranking,\n  isNumberColumn,\n  Column,\n  IColumnDesc,\n  isSupportType,\n  isMapAbleColumn,\n  DEFAULT_COLOR,\n  IDataRow,\n} from '../model';\nimport { colorPool, MAX_COLORS } from '../model/internal';\nimport { concat, equal, extent, range, resolveValue, ISequence } from '../internal';\nimport { timeParse } from 'd3-time-format';\nimport type { IDataProvider, IDeriveOptions, IExportOptions } from './interfaces';\n\n/**\n * @internal\n */\nexport function cleanCategories(categories: Set<string>) {\n  // remove missing values\n  categories.delete(null);\n  categories.delete(undefined);\n  categories.delete('');\n  categories.delete('NA');\n  categories.delete('NaN');\n  categories.delete('na');\n\n  return Array.from(categories).map(String).sort();\n}\n\nfunction hasDifferentSizes(data: any[][]) {\n  if (data.length === 0) {\n    return false;\n  }\n  const base = data[0].length;\n\n  return data.some((d) => d != null && base !== (Array.isArray(d) ? d.length : -1));\n}\n\nfunction isEmpty(v: any) {\n  return (\n    v == null ||\n    (Array.isArray(v) && v.length === 0) ||\n    (v instanceof Set && v.size === 0) ||\n    (v instanceof Map && v.size === 0) ||\n    equal({}, v)\n  );\n}\n\nfunction deriveBaseType(value: any, all: () => any[], column: number | string, options: IDeriveOptions) {\n  if (value == null) {\n    console.warn('cannot derive from null value for column: ', column);\n    return null;\n  }\n  // primitive\n  if (typeof value === 'number') {\n    return {\n      type: 'number',\n      domain: extent(all()),\n    };\n  }\n  if (typeof value === 'boolean') {\n    return {\n      type: 'boolean',\n    };\n  }\n\n  if (value instanceof Date) {\n    return {\n      type: 'date',\n    };\n  }\n  const formats = Array.isArray(options.datePattern) ? options.datePattern : [options.datePattern];\n  for (const format of formats) {\n    const dateParse = timeParse(format);\n    if (dateParse(value) == null) {\n      continue;\n    }\n    return {\n      type: 'date',\n      dateParse: format,\n    };\n  }\n  const treatAsCategorical =\n    typeof options.categoricalThreshold === 'function'\n      ? options.categoricalThreshold\n      : (u: number, t: number) => u < t * (options.categoricalThreshold as number);\n\n  if (typeof value === 'string') {\n    //maybe a categorical\n    const values = all();\n    const categories = new Set(values);\n    if (treatAsCategorical(categories.size, values.length)) {\n      return {\n        type: 'categorical',\n        categories: cleanCategories(categories),\n      };\n    }\n    return {\n      type: 'string',\n    };\n  }\n\n  if (typeof value === 'object' && value.alt != null && value.href != null) {\n    return {\n      type: 'link',\n    };\n  }\n\n  return null;\n}\n\nfunction deriveType(\n  label: string,\n  value: any,\n  column: number | string,\n  all: () => any[],\n  options: IDeriveOptions\n): IColumnDesc {\n  const base: any = {\n    type: 'string',\n    label,\n    column,\n  };\n\n  const primitive = deriveBaseType(value, all, column, options);\n  if (primitive != null) {\n    return Object.assign(base, primitive);\n  }\n\n  // set\n  if (value instanceof Set) {\n    const cats = new Set<string>();\n    for (const value of all()) {\n      if (!(value instanceof Set)) {\n        continue;\n      }\n      value.forEach((vi) => {\n        cats.add(String(vi));\n      });\n    }\n    return Object.assign(base, {\n      type: 'set',\n      categories: cleanCategories(cats),\n    });\n  }\n\n  // map\n  if (value instanceof Map) {\n    const first = Array.from(value.values()).find((d) => !isEmpty(d));\n    const mapAll = () => {\n      const r: any[] = [];\n      for (const vi of all()) {\n        if (!(vi instanceof Map)) {\n          continue;\n        }\n        vi.forEach((vii) => {\n          if (!isEmpty(vii)) {\n            r.push(vii);\n          }\n        });\n      }\n      return r;\n    };\n    const p = deriveBaseType(first, mapAll, column, options);\n    return Object.assign(base, p || {}, {\n      type: p ? `${p.type}Map` : 'stringMap',\n    });\n  }\n\n  // array\n  if (Array.isArray(value)) {\n    const values = all();\n    const sameLength = !hasDifferentSizes(values);\n    if (sameLength) {\n      base.dataLength = value.length;\n    }\n    const first = value.find((v) => !isEmpty(v));\n    const p = deriveBaseType(first, () => concat(values).filter((d) => !isEmpty(d)), column, options);\n    if (p && p.type === 'categorical' && !sameLength) {\n      return Object.assign(base, p, {\n        type: 'set',\n      });\n    }\n    if (p || isEmpty(first)) {\n      return Object.assign(base, p || {}, {\n        type: p ? `${p.type}s` : 'strings',\n      });\n    }\n\n    if (typeof first === 'object' && first.key != null && first.value != null) {\n      // key,value pair map\n      const mapAll = () => {\n        const r: any[] = [];\n        for (const vi of values) {\n          if (!Array.isArray(vi)) {\n            continue;\n          }\n          for (const vii of vi) {\n            if (!isEmpty(vii)) {\n              r.push(vii);\n            }\n          }\n        }\n        return r;\n      };\n      const p = deriveBaseType(first.value, mapAll, column, options);\n      return Object.assign(base, p || {}, {\n        type: p ? `${p.type}Map` : 'stringMap',\n      });\n    }\n  }\n\n  // check boxplot\n  const bs = ['min', 'max', 'median', 'q1', 'q3'];\n  if (value !== null && typeof value === 'object' && bs.every((b) => typeof value[b] === 'number')) {\n    //  boxplot\n    const vs = all();\n    return Object.assign(base, {\n      type: 'boxplot',\n      domain: [\n        vs.reduce((a, b) => Math.min(a, b.min), Number.POSITIVE_INFINITY),\n        vs.reduce((a, b) => Math.max(a, b.max), Number.NEGATIVE_INFINITY),\n      ],\n    });\n  }\n\n  if (value !== null && typeof value === 'object') {\n    // object map\n    const first = Object.keys(value)\n      .map((k) => value[k])\n      .filter((d) => !isEmpty(d));\n    const mapAll = () => {\n      const r: any[] = [];\n      for (const vi of all()) {\n        if (vi == null) {\n          continue;\n        }\n        Object.keys(vi).forEach((k) => {\n          const vii = vi[k];\n          if (!isEmpty(vii)) {\n            r.push(vii);\n          }\n        });\n      }\n      return r;\n    };\n    const p = deriveBaseType(first, mapAll, column, options);\n    return Object.assign(base, p || {}, {\n      type: p ? `${p.type}Map` : 'stringMap',\n    });\n  }\n\n  console.log('cannot infer type of column:', column);\n  //unknown type\n  return base;\n}\n\nfunction selectColumns(existing: string[], columns: string[]) {\n  const allNots = columns.every((d) => d.startsWith('-'));\n  if (!allNots) {\n    return columns;\n  }\n  // negate case, exclude columns that are given using -notation\n  const exclude = new Set(columns);\n  return existing.filter((d) => !exclude.has(`-${d}`));\n}\n\nfunction toLabel(key: string | number) {\n  if (typeof key === 'number') {\n    return `Col ${key + 1}`;\n  }\n  key = key.trim();\n  if (key.length === 0) {\n    return 'Unknown';\n  }\n  return key\n    .split(/[\\s]+/gm)\n    .map((k) => (k.length === 0 ? k : `${k[0]!.toUpperCase()}${k.slice(1)}`))\n    .join(' ');\n}\n\nexport function deriveColumnDescriptions(data: any[], options: Partial<IDeriveOptions> = {}) {\n  const config = Object.assign(\n    {\n      categoricalThreshold: (u: number, n: number) => u <= MAX_COLORS && u < n * 0.7, //70% unique and less equal to 22 categories\n      columns: [],\n      datePattern: ['%x', '%Y-%m-%d', '%Y-%m-%dT%H:%M:%S.%LZ'],\n    },\n    options\n  );\n\n  const r: IColumnDesc[] = [];\n  if (data.length === 0) {\n    // no data to derive something from\n    return r;\n  }\n\n  const first = data[0];\n  const columns: (number | string)[] = Array.isArray(first)\n    ? range(first.length)\n    : config.columns.length > 0\n    ? selectColumns(Object.keys(first), config.columns)\n    : Object.keys(first);\n\n  return columns.map((key) => {\n    let v = resolveValue(first, key);\n    if (isEmpty(v)) {\n      // cannot derive something from null try other rows\n      const foundRow = data.find((row) => !isEmpty(resolveValue(row, key)));\n      v = foundRow ? foundRow[key] : null;\n    }\n    return deriveType(\n      toLabel(key),\n      v,\n      key,\n      () => data.map((d) => resolveValue(d, key)).filter((d) => !isEmpty(d)),\n      config\n    );\n  });\n}\n\n/**\n * assigns colors to columns if they are numbers and not yet defined\n * @param columns\n * @returns {IColumnDesc[]}\n */\nexport function deriveColors(columns: IColumnDesc[]) {\n  const colors = colorPool();\n  columns.forEach((col: IColumnDesc) => {\n    if (isMapAbleColumn(col)) {\n      col.colorMapping = col.colorMapping || col.color || colors() || DEFAULT_COLOR;\n    }\n  });\n  return columns;\n}\n\nconst DEFAULT_EXPORT_OPTIONS: IExportOptions = {\n  separator: '\\t',\n  newline: '\\n',\n  header: true,\n  quote: false,\n  quoteChar: '\"',\n  filter: (c: Column) => !isSupportType(c),\n  verboseColumnHeaders: false,\n};\n\nfunction createCSVExporter(columns: readonly Column[], options: IExportOptions) {\n  //optionally quote not numbers\n  const escape = new RegExp(`[${options.quoteChar}]`, 'g');\n\n  function quote(v: any, c?: Column) {\n    const l = String(v);\n    if ((options.quote || l.indexOf('\\n') >= 0) && (!c || !isNumberColumn(c))) {\n      return `${options.quoteChar}${l.replace(escape, options.quoteChar + options.quoteChar)}${options.quoteChar}`;\n    }\n    return l;\n  }\n\n  function addHeader() {\n    return columns\n      .map((d) => quote(`${d.label}${options.verboseColumnHeaders && d.description ? `\\n${d.description}` : ''}`))\n      .join(options.separator);\n  }\n\n  function addRow(row: IDataRow) {\n    return columns.map((c) => quote(c.getExportValue(row, 'text'), c)).join(options.separator);\n  }\n\n  return {\n    addHeader,\n    addRow,\n  };\n}\n\n/**\n * utility to export a ranking to a table with the given separator\n * @param ranking\n * @param data\n * @param options\n * @returns {Promise<string>}\n */\nexport function exportRanking(ranking: Ranking, data: any[], options: Partial<IExportOptions> = {}): string {\n  const opts: IExportOptions = Object.assign({}, DEFAULT_EXPORT_OPTIONS, options);\n  const columns = ranking.flatColumns.filter((c) => opts.filter(c));\n\n  const order = ranking.getOrder();\n  const exporter = createCSVExporter(columns, opts);\n  const r: string[] = [];\n\n  if (opts.header) {\n    r.push(exporter.addHeader());\n  }\n  data.forEach((row, i) => {\n    r.push(exporter.addRow({ v: row, i: order[i] }));\n  });\n  return r.join(opts.newline);\n}\n\n/**\n * export table helper\n * @param columnsOrRanking\n * @param data\n * @param options\n * @returns {string}\n */\nexport function exportTable(\n  columnsOrRanking: readonly Column[] | Ranking,\n  data: ISequence<IDataRow>,\n  options: Partial<IExportOptions> = {}\n): string {\n  const opts: IExportOptions = Object.assign({}, DEFAULT_EXPORT_OPTIONS, options);\n  const columns =\n    columnsOrRanking instanceof Ranking ? columnsOrRanking.flatColumns.filter((c) => opts.filter(c)) : columnsOrRanking;\n  const exporter = createCSVExporter(columns, opts);\n  const r: string[] = [];\n\n  if (opts.header) {\n    r.push(exporter.addHeader());\n  }\n  data.forEach((row) => {\n    r.push(exporter.addRow(row));\n  });\n  return r.join(opts.newline);\n}\n\n/** @internal */\nexport function map2Object<T>(map: Map<string, T>) {\n  const r: { [key: string]: T } = {};\n  map.forEach((v, k) => (r[k] = v));\n  return r;\n}\n\n/** @internal */\nexport function object2Map<T>(obj: { [key: string]: T }) {\n  const r = new Map<string, T>();\n  for (const k of Object.keys(obj)) {\n    r.set(k, obj[k]);\n  }\n  return r;\n}\n\n/** @internal */\nexport function rangeSelection(\n  provider: IDataProvider,\n  rankingId: string,\n  dataIndex: number,\n  relIndex: number,\n  ctrlKey: boolean\n) {\n  const ranking = provider.getRankings().find((d) => d.id === rankingId);\n  if (!ranking) {\n    // no known reference\n    return false;\n  }\n  const selection = provider.getSelection();\n  if (selection.length === 0 || selection.includes(dataIndex)) {\n    return false; // no other or deselect\n  }\n  const order = ranking.getOrder();\n  const lookup = new Map(Array.from(order).map((d, i) => [d, i]));\n  const distances = selection.map((d) => {\n    const index = lookup.has(d) ? lookup.get(d)! : Number.POSITIVE_INFINITY;\n    return { s: d, index, distance: Math.abs(relIndex - index) };\n  });\n  const nearest = distances.sort((a, b) => a.distance - b.distance)[0]!;\n  if (!isFinite(nearest.distance)) {\n    return false; // all outside\n  }\n  if (!ctrlKey) {\n    selection.splice(0, selection.length);\n    selection.push(nearest.s);\n  }\n  if (nearest.index < relIndex) {\n    for (let i = nearest.index + 1; i <= relIndex; ++i) {\n      selection.push(order[i]);\n    }\n  } else {\n    for (let i = relIndex; i <= nearest.index; ++i) {\n      selection.push(order[i]);\n    }\n  }\n  provider.setSelection(selection);\n  return true;\n}\n\nexport function isPromiseLike<T>(promiseLike: Promise<T> | T): promiseLike is Promise<T> {\n  return promiseLike != null && typeof (promiseLike as Promise<T>).then === 'function';\n}\n","import type { IAggregationStrategy } from './interfaces';\nimport { IOrderedGroup, IGroup, IGroupParent, IGroupData, IGroupItem, isGroup, EAggregationState } from '../model';\n\nexport function isAlwaysShowingGroupStrategy(strategy: IAggregationStrategy) {\n  return strategy === 'group+item' || strategy === 'group+item+top' || strategy === 'group+top+item';\n}\n\nexport function hasTopNStrategy(strategy: IAggregationStrategy) {\n  return strategy === 'group+item+top' || strategy === 'group+top+item';\n}\n\nexport function convertAggregationState(state: boolean | number | EAggregationState, topN: number) {\n  if (typeof state === 'boolean') {\n    return state ? 0 : -1;\n  }\n  if (state === EAggregationState.COLLAPSE) {\n    return 0;\n  }\n  if (state === EAggregationState.EXPAND) {\n    return -1;\n  }\n  if (state === EAggregationState.EXPAND_TOP_N) {\n    return topN;\n  }\n  return state;\n}\n\nexport declare type IGroupMeta = 'first' | 'last' | 'first last' | null;\n\nexport function toItemMeta(relativeIndex: number, group: IOrderedGroup, topN: number): IGroupMeta {\n  if (relativeIndex === 0) {\n    return group.order.length === 1 ? 'first last' : 'first';\n  }\n  if (relativeIndex === group.order.length - 1 || (topN > 0 && relativeIndex === topN - 1)) {\n    return 'last';\n  }\n  return null;\n}\n\nexport function groupParents(group: IGroup, meta: IGroupMeta) {\n  const parents: { group: IGroup; meta: IGroupMeta }[] = [{ group, meta }];\n\n  let prev = group;\n  let prevMeta = meta;\n  let parent: IGroupParent | undefined | null = group.parent;\n\n  while (parent) {\n    if (parent.subGroups.length === 1 && prevMeta === 'first last') {\n      meta = 'first last';\n    } else if (parent.subGroups[0] === prev && (prevMeta === 'first last' || prevMeta === 'first')) {\n      meta = 'first';\n    } else if (\n      parent.subGroups[parent.subGroups.length - 1] === prev &&\n      (prevMeta === 'last' || prevMeta === 'first last')\n    ) {\n      meta = 'last';\n    } else {\n      meta = null;\n    }\n    parents.unshift({ group: parent, meta });\n\n    prev = parent;\n    prevMeta = meta;\n    parent = parent.parent;\n  }\n  return parents;\n}\n\nexport interface ITopNGetter {\n  (item: IGroup): number;\n}\n\n/**\n * number of group levels this items ends\n */\nexport function groupEndLevel(item: IGroupData | IGroupItem, topNGetter: ITopNGetter) {\n  const group: IGroup = isGroup(item) ? item : item.group;\n  const last = isGroup(item) ? 'first last' : toItemMeta(item.relativeIndex, item.group, topNGetter(group));\n  if (last !== 'last' && last !== 'first last') {\n    return 0;\n  }\n\n  let prev = group;\n  let parent: IGroupParent | undefined | null = group.parent;\n  let i = 1;\n\n  while (parent) {\n    if (!(parent.subGroups.length === 1 || parent.subGroups[parent.subGroups.length - 1] === prev)) {\n      // not last of group - end\n      return i;\n    }\n    ++i;\n    prev = parent;\n    parent = parent.parent;\n  }\n\n  return i;\n}\n\nexport function isSummaryGroup(group: IGroup, strategy: IAggregationStrategy, topNGetter: ITopNGetter) {\n  const topN = topNGetter(group);\n  return isAlwaysShowingGroupStrategy(strategy) && topN !== 0;\n}\n\nexport function toRowMeta(\n  item: IGroupData | IGroupItem,\n  strategy: IAggregationStrategy,\n  topNGetter: ITopNGetter\n): string | null {\n  if (isGroup(item)) {\n    if (isSummaryGroup(item, strategy, topNGetter)) {\n      return 'first';\n    }\n    const level = groupEndLevel(item, topNGetter);\n    if (level === 0) {\n      return 'first';\n    }\n    return `first last${level === 1 ? '' : level - 1}`;\n  }\n\n  const last = toItemMeta(item.relativeIndex, item.group, topNGetter(item.group));\n  if (last == null) {\n    return null;\n  }\n  const level = groupEndLevel(item, topNGetter);\n  if (level === 0) {\n    return null;\n  }\n  return `last${level === 1 ? '' : level - 1}`;\n}\n","import {\n  AEventDispatcher,\n  debounce,\n  ISequence,\n  OrderedSet,\n  IDebounceContext,\n  IEventListener,\n  suffix,\n  IEventContext,\n} from '../internal';\nimport {\n  Column,\n  IColumnConstructor,\n  Ranking,\n  AggregateGroupColumn,\n  createAggregateDesc,\n  IAggregateGroupColumnDesc,\n  isSupportType,\n  EDirtyReason,\n  RankColumn,\n  createRankDesc,\n  createSelectionDesc,\n  IColumnDesc,\n  IDataRow,\n  IGroup,\n  IndicesArray,\n  IOrderedGroup,\n  ISelectionColumnDesc,\n  EAggregationState,\n  IColumnDump,\n  IRankingDump,\n  IColorMappingFunctionConstructor,\n  IMappingFunctionConstructor,\n  ITypeFactory,\n} from '../model';\nimport { models } from '../model/models';\nimport { forEachIndices, everyIndices, toGroupID, unifyParents } from '../model/internal';\nimport { IDataProvider, IDataProviderDump, IDataProviderOptions, SCHEMA_REF, IExportOptions } from './interfaces';\nimport { exportRanking, map2Object, object2Map, exportTable, isPromiseLike } from './utils';\nimport type { IRenderTasks } from '../renderer';\nimport { restoreCategoricalColorMapping } from '../model/CategoricalColorMappingFunction';\nimport { createColorMappingFunction, colorMappingFunctions } from '../model/ColorMappingFunction';\nimport { createMappingFunction, mappingFunctions } from '../model/MappingFunction';\nimport { convertAggregationState } from './internal';\n\n/**\n * emitted when a column has been added\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function addColumn(col: Column, index: number): void;\n\n/**\n * emitted when a column has been moved within this composite column\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function moveColumn(col: Column, index: number, oldIndex: number): void;\n\n/**\n * emitted when a column has been removed\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function removeColumn(col: Column, index: number): void;\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function orderChanged(\n  previous: number[],\n  current: number[],\n  previousGroups: IOrderedGroup[],\n  currentGroups: IOrderedGroup[],\n  dirtyReason: EDirtyReason[]\n): void;\n\n/**\n * emitted when state of the column is dirty\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function dirty(): void;\n\n/**\n * emitted when state of the column related to its header is dirty\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function dirtyHeader(): void;\n\n/**\n * emitted when state of the column related to its values is dirty\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function dirtyValues(): void;\n\n/**\n * emitted when state of the column related to cached values (hist, compare, ...) is dirty\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function dirtyCaches(): void;\n\n/**\n * emitted when the data changes\n * @asMemberOf ADataProvider\n * @param rows the new data rows\n * @event\n */\nexport declare function dataChanged(rows: IDataRow[]): void;\n\n/**\n * emitted when the selection changes\n * @asMemberOf ADataProvider\n * @param dataIndices the selected data indices\n * @event\n */\nexport declare function selectionChanged(dataIndices: number[]): void;\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function addRanking(ranking: Ranking, index: number): void;\n/**\n * @asMemberOf ADataProvider\n * @param ranking if null all rankings are removed else just the specific one\n * @event\n */\nexport declare function removeRanking(ranking: Ranking | null, index: number): void;\n\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function addDesc(desc: IColumnDesc): void;\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function removeDesc(desc: IColumnDesc): void;\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function clearDesc(): void;\n\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function showTopNChanged(previous: number, current: number): void;\n\n/**\n * emitted when the selection changes\n * @asMemberOf ADataProvider\n * @param dataIndices the selected data indices\n * @event\n */\nexport declare function jumpToNearest(dataIndices: number[]): void;\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function aggregate(\n  ranking: Ranking,\n  group: IGroup | IGroup[],\n  previousTopN: number | number[],\n  currentTopN: number | number[]\n): void;\n\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function busy(busy: boolean): void;\n\nfunction toDirtyReason(ctx: IEventContext) {\n  const primary = ctx.primaryType;\n  switch (primary || '') {\n    case Ranking.EVENT_DIRTY_ORDER:\n      return ctx.args[0] || [EDirtyReason.UNKNOWN];\n    case Ranking.EVENT_SORT_CRITERIA_CHANGED:\n      return [EDirtyReason.SORT_CRITERIA_CHANGED];\n    case Ranking.EVENT_GROUP_CRITERIA_CHANGED:\n      return [EDirtyReason.GROUP_CRITERIA_CHANGED];\n    case Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED:\n      return [EDirtyReason.GROUP_SORT_CRITERIA_CHANGED];\n    default:\n      return [EDirtyReason.UNKNOWN];\n  }\n}\n\nfunction mergeDirtyOrderContext(current: IDebounceContext, next: IDebounceContext) {\n  const currentReason = toDirtyReason(current.self);\n  const nextReason = toDirtyReason(next.self);\n  const combined = new Set(currentReason);\n  for (const r of nextReason) {\n    combined.add(r);\n  }\n  const args = [Array.from(combined)];\n  return {\n    self: {\n      primaryType: Ranking.EVENT_DIRTY_ORDER,\n      args,\n    },\n    args,\n  };\n}\n\n/**\n * a basic data provider holding the data and rankings\n */\nabstract class ADataProvider extends AEventDispatcher implements IDataProvider {\n  static readonly EVENT_SELECTION_CHANGED = 'selectionChanged';\n  static readonly EVENT_DATA_CHANGED = 'dataChanged';\n  static readonly EVENT_ADD_COLUMN = Ranking.EVENT_ADD_COLUMN;\n  static readonly EVENT_MOVE_COLUMN = Ranking.EVENT_MOVE_COLUMN;\n  static readonly EVENT_REMOVE_COLUMN = Ranking.EVENT_REMOVE_COLUMN;\n  static readonly EVENT_ADD_RANKING = 'addRanking';\n  static readonly EVENT_REMOVE_RANKING = 'removeRanking';\n  static readonly EVENT_DIRTY = Ranking.EVENT_DIRTY;\n  static readonly EVENT_DIRTY_HEADER = Ranking.EVENT_DIRTY_HEADER;\n  static readonly EVENT_DIRTY_VALUES = Ranking.EVENT_DIRTY_VALUES;\n  static readonly EVENT_DIRTY_CACHES = Ranking.EVENT_DIRTY_CACHES;\n  static readonly EVENT_ORDER_CHANGED = Ranking.EVENT_ORDER_CHANGED;\n  static readonly EVENT_SHOWTOPN_CHANGED = 'showTopNChanged';\n  static readonly EVENT_ADD_DESC = 'addDesc';\n  static readonly EVENT_CLEAR_DESC = 'clearDesc';\n  static readonly EVENT_REMOVE_DESC = 'removeDesc';\n  static readonly EVENT_JUMP_TO_NEAREST = 'jumpToNearest';\n  static readonly EVENT_GROUP_AGGREGATION_CHANGED = AggregateGroupColumn.EVENT_AGGREGATE;\n  static readonly EVENT_BUSY = 'busy';\n\n  private static readonly FORWARD_RANKING_EVENTS = suffix(\n    '.provider',\n    Ranking.EVENT_ADD_COLUMN,\n    Ranking.EVENT_REMOVE_COLUMN,\n    Ranking.EVENT_DIRTY,\n    Ranking.EVENT_DIRTY_HEADER,\n    Ranking.EVENT_MOVE_COLUMN,\n    Ranking.EVENT_ORDER_CHANGED,\n    Ranking.EVENT_DIRTY_VALUES,\n    Ranking.EVENT_DIRTY_CACHES\n  );\n\n  /**\n   * all rankings\n   * @type {Array}\n   * @private\n   */\n  private readonly rankings: Ranking[] = [];\n\n  /**\n   * the current selected indices\n   * @type {OrderedSet}\n   */\n  private readonly selection = new OrderedSet<number>();\n\n  //Map<ranking.id@group.name, -1=expand,0=collapse,N=topN>\n  private readonly aggregations = new Map<string, number>(); // not part of = show all\n\n  private uid = 0;\n  private readonly typeFactory: ITypeFactory;\n\n  private readonly options: Readonly<IDataProviderOptions> = {\n    columnTypes: {},\n    colorMappingFunctionTypes: {},\n    mappingFunctionTypes: {},\n    singleSelection: false,\n    showTopN: 10,\n    aggregationStrategy: 'item',\n    propagateAggregationState: true,\n  };\n\n  /**\n   * lookup map of a column type to its column implementation\n   */\n  readonly columnTypes: { [columnType: string]: IColumnConstructor };\n  readonly colorMappingFunctionTypes: { [colorMappingFunctionType: string]: IColorMappingFunctionConstructor };\n  readonly mappingFunctionTypes: { [mappingFunctionType: string]: IMappingFunctionConstructor };\n\n  private showTopN: number;\n\n  constructor(options: Partial<IDataProviderOptions> = {}) {\n    super();\n    Object.assign(this.options, options);\n    this.columnTypes = Object.assign(models(), this.options.columnTypes);\n    this.colorMappingFunctionTypes = Object.assign(colorMappingFunctions(), this.options.colorMappingFunctionTypes);\n    this.mappingFunctionTypes = Object.assign(mappingFunctions(), this.options.mappingFunctionTypes);\n    this.showTopN = this.options.showTopN;\n\n    this.typeFactory = this.createTypeFactory();\n  }\n\n  private createTypeFactory() {\n    const factory = ((d: IColumnDump) => {\n      const desc = this.fromDescRef(d.desc);\n      if (!desc || !desc.type) {\n        console.warn('cannot restore column dump', d);\n        return new Column(d.id || '', d.desc || {});\n      }\n      this.fixDesc(desc);\n      const type = this.columnTypes[desc.type];\n      if (type == null) {\n        console.warn('invalid column type in column dump using column', d);\n        return new Column(d.id || '', desc);\n      }\n      const c = this.instantiateColumn(type, '', desc, this.typeFactory);\n      c.restore(d, factory);\n      return this.patchColumn(c);\n    }) as ITypeFactory;\n    factory.colorMappingFunction = createColorMappingFunction(this.colorMappingFunctionTypes, factory);\n    factory.mappingFunction = createMappingFunction(this.mappingFunctionTypes);\n    factory.categoricalColorMappingFunction = restoreCategoricalColorMapping;\n    return factory;\n  }\n\n  getTypeFactory() {\n    return this.typeFactory;\n  }\n\n  /**\n   * events:\n   *  * column changes: addColumn, removeColumn\n   *  * ranking changes: addRanking, removeRanking\n   *  * dirty: dirty, dirtyHeder, dirtyValues\n   *  * selectionChanged\n   * @returns {string[]}\n   */\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        ADataProvider.EVENT_DATA_CHANGED,\n        ADataProvider.EVENT_BUSY,\n        ADataProvider.EVENT_SHOWTOPN_CHANGED,\n        ADataProvider.EVENT_ADD_COLUMN,\n        ADataProvider.EVENT_REMOVE_COLUMN,\n        ADataProvider.EVENT_MOVE_COLUMN,\n        ADataProvider.EVENT_ADD_RANKING,\n        ADataProvider.EVENT_REMOVE_RANKING,\n        ADataProvider.EVENT_DIRTY,\n        ADataProvider.EVENT_DIRTY_HEADER,\n        ADataProvider.EVENT_DIRTY_VALUES,\n        ADataProvider.EVENT_DIRTY_CACHES,\n        ADataProvider.EVENT_ORDER_CHANGED,\n        ADataProvider.EVENT_SELECTION_CHANGED,\n        ADataProvider.EVENT_ADD_DESC,\n        ADataProvider.EVENT_CLEAR_DESC,\n        ADataProvider.EVENT_JUMP_TO_NEAREST,\n        ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED,\n      ]);\n  }\n\n  on(type: typeof ADataProvider.EVENT_BUSY, listener: typeof busy | null): this;\n  on(type: typeof ADataProvider.EVENT_DATA_CHANGED, listener: typeof dataChanged | null): this;\n  on(type: typeof ADataProvider.EVENT_SHOWTOPN_CHANGED, listener: typeof showTopNChanged | null): this;\n  on(type: typeof ADataProvider.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof ADataProvider.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof ADataProvider.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof ADataProvider.EVENT_ADD_RANKING, listener: typeof addRanking | null): this;\n  on(type: typeof ADataProvider.EVENT_REMOVE_RANKING, listener: typeof removeRanking | null): this;\n  on(type: typeof ADataProvider.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof ADataProvider.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof ADataProvider.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof ADataProvider.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof ADataProvider.EVENT_ORDER_CHANGED, listener: typeof orderChanged | null): this;\n  on(type: typeof ADataProvider.EVENT_ADD_DESC, listener: typeof addDesc | null): this;\n  on(type: typeof ADataProvider.EVENT_REMOVE_DESC, listener: typeof removeDesc | null): this;\n  on(type: typeof ADataProvider.EVENT_CLEAR_DESC, listener: typeof clearDesc | null): this;\n  on(type: typeof ADataProvider.EVENT_JUMP_TO_NEAREST, listener: typeof jumpToNearest | null): this;\n  on(type: typeof ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED, listener: typeof aggregate | null): this;\n  on(type: typeof ADataProvider.EVENT_SELECTION_CHANGED, listener: typeof selectionChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  abstract getTotalNumberOfRows(): number;\n\n  /**\n   * returns a list of all known column descriptions\n   * @returns {Array}\n   */\n  abstract getColumns(): IColumnDesc[];\n\n  abstract getTaskExecutor(): IRenderTasks;\n\n  /**\n   * adds a new ranking\n   * @param existing an optional existing ranking to clone\n   * @return the new ranking\n   */\n  pushRanking(existing?: Ranking): Ranking {\n    const r = this.cloneRanking(existing);\n\n    this.insertRanking(r);\n    return r;\n  }\n\n  protected fireBusy(busy: boolean) {\n    this.fire(ADataProvider.EVENT_BUSY, busy);\n  }\n\n  takeSnapshot(col: Column): Ranking {\n    this.fireBusy(true);\n    const r = this.cloneRanking();\n    const ranking = col.findMyRanker();\n    // by convention copy all support types and the first string column\n    let hasString = col.desc.type === 'string';\n    let hasColumn = false;\n    const toClone = !ranking\n      ? [col]\n      : ranking.children.filter((c) => {\n          if (c === col) {\n            hasColumn = true;\n            return true;\n          }\n          if (!hasString && c.desc.type === 'string') {\n            hasString = true;\n            return true;\n          }\n          return isSupportType(c);\n        });\n\n    if (!hasColumn) {\n      // maybe a nested one thus not in the top level\n      toClone.push(col);\n    }\n\n    toClone.forEach((c) => {\n      const clone = this.clone(c);\n      r.push(clone);\n      if (c === col) {\n        clone.sortByMe();\n      }\n    });\n    this.insertRanking(r);\n    this.fireBusy(false);\n    return r;\n  }\n\n  insertRanking(r: Ranking, index = this.rankings.length) {\n    this.rankings.splice(index, 0, r);\n    this.forward(r, ...ADataProvider.FORWARD_RANKING_EVENTS);\n    //delayed reordering per ranking\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    r.on(\n      `${Ranking.EVENT_DIRTY_ORDER}.provider`,\n      debounce(\n        function (this: IEventContext) {\n          that.triggerReorder(r, toDirtyReason(this));\n        },\n        100,\n        mergeDirtyOrderContext\n      )\n    );\n    this.fire(\n      [\n        ADataProvider.EVENT_ADD_RANKING,\n        ADataProvider.EVENT_DIRTY_HEADER,\n        ADataProvider.EVENT_DIRTY_VALUES,\n        ADataProvider.EVENT_DIRTY,\n      ],\n      r,\n      index\n    );\n    this.triggerReorder(r);\n  }\n\n  private triggerReorder(ranking: Ranking, dirtyReason?: EDirtyReason[]) {\n    this.fireBusy(true);\n    const reason = dirtyReason || [EDirtyReason.UNKNOWN];\n    Promise.resolve(this.sort(ranking, reason)).then(({ groups, index2pos }) => {\n      if (ranking.getGroupSortCriteria().length === 0) {\n        groups = unifyParents(groups);\n      }\n      this.initAggregateState(ranking, groups);\n      ranking.setGroups(groups, index2pos, reason);\n      this.fireBusy(false);\n    });\n  }\n\n  /**\n   * removes a ranking from this data provider\n   * @param ranking\n   * @returns {boolean}\n   */\n  removeRanking(ranking: Ranking) {\n    const i = this.rankings.indexOf(ranking);\n    if (i < 0) {\n      return false;\n    }\n    this.unforward(ranking, ...ADataProvider.FORWARD_RANKING_EVENTS);\n    this.rankings.splice(i, 1);\n    ranking.on(`${Ranking.EVENT_DIRTY_ORDER}.provider`, null);\n    this.cleanUpRanking(ranking);\n    this.fire(\n      [\n        ADataProvider.EVENT_REMOVE_RANKING,\n        ADataProvider.EVENT_DIRTY_HEADER,\n        ADataProvider.EVENT_DIRTY_VALUES,\n        ADataProvider.EVENT_DIRTY,\n      ],\n      ranking,\n      i\n    );\n    return true;\n  }\n\n  /**\n   * removes all rankings\n   */\n  clearRankings() {\n    this.rankings.forEach((ranking) => {\n      this.unforward(ranking, ...ADataProvider.FORWARD_RANKING_EVENTS);\n      ranking.on(`${Ranking.EVENT_DIRTY_ORDER}.provider`, null);\n      this.cleanUpRanking(ranking);\n    });\n    // clear\n    this.rankings.splice(0, this.rankings.length);\n    this.fire(\n      [\n        ADataProvider.EVENT_REMOVE_RANKING,\n        ADataProvider.EVENT_DIRTY_HEADER,\n        ADataProvider.EVENT_DIRTY_VALUES,\n        ADataProvider.EVENT_DIRTY,\n      ],\n      null,\n      -1\n    );\n  }\n\n  clearFilters() {\n    this.rankings.forEach((ranking) => ranking.clearFilters());\n  }\n\n  /**\n   * returns a list of all current rankings\n   * @returns {Ranking[]}\n   */\n  getRankings() {\n    return this.rankings.slice();\n  }\n\n  /**\n   * returns the last ranking for quicker access\n   * @returns {Ranking}\n   */\n  getFirstRanking() {\n    return this.rankings[0] || null;\n  }\n\n  /**\n   * returns the last ranking for quicker access\n   * @returns {Ranking}\n   */\n  getLastRanking() {\n    return this.rankings[this.rankings.length - 1];\n  }\n\n  ensureOneRanking() {\n    if (this.rankings.length === 0) {\n      const r = this.pushRanking();\n      this.push(r, createRankDesc());\n    }\n  }\n\n  destroy() {\n    // dummy\n  }\n\n  /**\n   * hook method for cleaning up a ranking\n   * @param _ranking\n   */\n  cleanUpRanking(_ranking: Ranking) {\n    // dummy\n  }\n\n  /**\n   * abstract method for cloning a ranking\n   * @param existing\n   * @returns {null}\n   */\n  abstract cloneRanking(existing?: Ranking): Ranking;\n\n  /**\n   * adds a column to a ranking described by its column description\n   * @param ranking the ranking to add the column to\n   * @param desc the description of the column\n   * @return {Column} the newly created column or null\n   */\n  push(ranking: Ranking, desc: IColumnDesc): Column | null {\n    const r = this.create(desc);\n    if (r) {\n      ranking.push(r);\n      return r;\n    }\n    return null;\n  }\n\n  /**\n   * adds a column to a ranking described by its column description\n   * @param ranking the ranking to add the column to\n   * @param index the position to insert the column\n   * @param desc the description of the column\n   * @return {Column} the newly created column or null\n   */\n  insert(ranking: Ranking, index: number, desc: IColumnDesc) {\n    const r = this.create(desc);\n    if (r) {\n      ranking.insert(r, index);\n      return r;\n    }\n    return null;\n  }\n\n  /**\n   * creates a new unique id for a column\n   * @returns {string}\n   */\n  private nextId() {\n    return `col${this.uid++}`;\n  }\n\n  private fixDesc(desc: IColumnDesc) {\n    //hacks for provider dependent descriptors\n    if (desc.type === 'selection') {\n      (desc as ISelectionColumnDesc).accessor = (row: IDataRow) => this.isSelected(row.i);\n      (desc as ISelectionColumnDesc).setter = (index: number, value: boolean) =>\n        value ? this.select(index) : this.deselect(index);\n      (desc as ISelectionColumnDesc).setterAll = (indices: IndicesArray, value: boolean) =>\n        value ? this.selectAll(indices) : this.deselectAll(indices);\n    } else if (desc.type === 'aggregate') {\n      (desc as IAggregateGroupColumnDesc).isAggregated = (ranking: Ranking, group: IGroup) =>\n        this.getAggregationState(ranking, group);\n      (desc as IAggregateGroupColumnDesc).setAggregated = (ranking: Ranking, group: IGroup, value: EAggregationState) =>\n        this.setAggregationState(ranking, group, value);\n    }\n    return desc;\n  }\n\n  protected cleanDesc(desc: IColumnDesc) {\n    //hacks for provider dependent descriptors\n    if (desc.type === 'selection') {\n      delete (desc as ISelectionColumnDesc).accessor;\n      delete (desc as ISelectionColumnDesc).setter;\n      delete (desc as ISelectionColumnDesc).setterAll;\n    } else if (desc.type === 'aggregate') {\n      delete (desc as IAggregateGroupColumnDesc).isAggregated;\n      delete (desc as IAggregateGroupColumnDesc).setAggregated;\n    }\n    return desc;\n  }\n\n  /**\n   * creates an internal column model out of the given column description\n   * @param desc\n   * @returns {Column} the new column or null if it can't be created\n   */\n  create(desc: IColumnDesc): Column | null {\n    this.fixDesc(desc);\n    //find by type and instantiate\n    const type = this.columnTypes[desc.type];\n    if (type) {\n      return this.patchColumn(this.instantiateColumn(type, this.nextId(), desc, this.typeFactory));\n    }\n    return null;\n  }\n\n  protected patchColumn(column: Column): Column {\n    // hook for adapting columns\n    return column;\n  }\n\n  protected instantiateColumn(type: IColumnConstructor, id: string, desc: IColumnDesc, typeFactory: ITypeFactory) {\n    return new type(id, desc, typeFactory);\n  }\n\n  /**\n   * clones a column by dumping and restoring\n   * @param col\n   * @returns {Column}\n   */\n  clone(col: Column) {\n    const dump = this.dumpColumn(col);\n    return this.restoreColumn(dump);\n  }\n\n  /**\n   * restores a column from a dump\n   * @param dump\n   * @returns {Column}\n   */\n  restoreColumn(dump: any): Column {\n    const c = this.typeFactory(dump);\n    c.assignNewId(this.nextId.bind(this));\n    return c;\n  }\n\n  /**\n   * finds a column in all rankings returning the first match\n   * @param idOrFilter by id or by a filter function\n   * @returns {Column}\n   */\n  find(idOrFilter: string | ((col: Column) => boolean)): Column | null {\n    //convert to function\n    const filter = typeof idOrFilter === 'string' ? (col: Column) => col.id === idOrFilter : idOrFilter;\n\n    for (const ranking of this.rankings) {\n      const r = ranking.find(filter);\n      if (r) {\n        return r;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * dumps this whole provider including selection and the rankings\n   * @returns {{uid: number, selection: number[], rankings: *[]}}\n   */\n  dump(): IDataProviderDump {\n    return {\n      $schema: SCHEMA_REF,\n      uid: this.uid,\n      selection: this.getSelection(),\n      aggregations: map2Object(this.aggregations),\n      rankings: this.rankings.map((r) => r.dump(this.toDescRef.bind(this))),\n      showTopN: this.showTopN,\n    };\n  }\n\n  /**\n   * dumps a specific column\n   */\n  dumpColumn(col: Column): IColumnDump {\n    return col.dump(this.toDescRef.bind(this));\n  }\n\n  /**\n   * for better dumping describe reference, by default just return the description\n   */\n  toDescRef(desc: any): any {\n    return desc;\n  }\n\n  /**\n   * inverse operation of toDescRef\n   */\n  fromDescRef(descRef: any): any {\n    return descRef;\n  }\n\n  restoreRanking(dump: IRankingDump) {\n    const ranking = this.cloneRanking();\n    ranking.restore(dump, this.typeFactory);\n    const idGenerator = this.nextId.bind(this);\n    ranking.children.forEach((c) => c.assignNewId(idGenerator));\n    return ranking;\n  }\n\n  restore(dump: IDataProviderDump) {\n    //clean old\n    this.clearRankings();\n\n    //restore selection\n    this.uid = dump.uid || 0;\n    if (dump.selection) {\n      dump.selection.forEach((s: number) => this.selection.add(s));\n    }\n    if (dump.showTopN != null) {\n      this.showTopN = dump.showTopN;\n    }\n    if (dump.aggregations) {\n      this.aggregations.clear();\n      if (Array.isArray(dump.aggregations)) {\n        dump.aggregations.forEach((a: string) => this.aggregations.set(a, 0));\n      } else {\n        object2Map(dump.aggregations).forEach((v, k) => this.aggregations.set(k, v));\n      }\n    }\n\n    //restore rankings\n    if (dump.rankings) {\n      dump.rankings.forEach((r: any) => {\n        const ranking = this.cloneRanking();\n        ranking.restore(r, this.typeFactory);\n        //if no rank column add one\n        if (!ranking.children.some((d) => d instanceof RankColumn)) {\n          ranking.insert(this.create(createRankDesc())!, 0);\n        }\n        this.insertRanking(ranking);\n      });\n    }\n\n    //assign new ids\n    const idGenerator = this.nextId.bind(this);\n    this.rankings.forEach((r) => {\n      r.children.forEach((c) => c.assignNewId(idGenerator));\n    });\n  }\n\n  abstract findDesc(ref: string): IColumnDesc | null;\n\n  /**\n   * generates a default ranking by using all column descriptions ones\n   */\n  deriveDefault(addSupportType = true) {\n    const r = this.pushRanking();\n    if (addSupportType) {\n      r.push(this.create(createAggregateDesc())!);\n      r.push(this.create(createRankDesc())!);\n      if (this.options.singleSelection !== true) {\n        r.push(this.create(createSelectionDesc())!);\n      }\n    }\n    this.getColumns().forEach((col) => {\n      const c = this.create(col);\n      if (!c || isSupportType(c)) {\n        return;\n      }\n      r.push(c);\n    });\n    return r;\n  }\n\n  isAggregated(ranking: Ranking, group: IGroup) {\n    return this.getTopNAggregated(ranking, group) >= 0;\n  }\n\n  getAggregationState(ranking: Ranking, group: IGroup) {\n    const n = this.getTopNAggregated(ranking, group);\n    return n < 0 ? EAggregationState.EXPAND : n === 0 ? EAggregationState.COLLAPSE : EAggregationState.EXPAND_TOP_N;\n  }\n\n  setAggregated(ranking: Ranking, group: IGroup | IGroup[], value: boolean) {\n    return this.setAggregationState(ranking, group, value ? EAggregationState.COLLAPSE : EAggregationState.EXPAND);\n  }\n\n  setAggregationState(ranking: Ranking, group: IGroup | IGroup[], value: EAggregationState) {\n    this.setTopNAggregated(\n      ranking,\n      group,\n      value === EAggregationState.COLLAPSE ? 0 : value === EAggregationState.EXPAND_TOP_N ? this.showTopN : -1\n    );\n  }\n\n  getTopNAggregated(ranking: Ranking, group: IGroup) {\n    let g: IGroup | undefined | null = group;\n    while (g) {\n      const key = `${ranking.id}@${toGroupID(g)}`;\n      if (this.aggregations.has(key)) {\n        // propagate to leaf\n        const v = this.aggregations.get(key)!;\n        if (this.options.propagateAggregationState && group !== g) {\n          this.aggregations.set(`${ranking.id}@${toGroupID(group)}`, v);\n        }\n        return v;\n      }\n      g = g.parent;\n    }\n    return -1;\n  }\n\n  private unaggregateParents(ranking: Ranking, group: IGroup) {\n    let g: IGroup | undefined | null = group.parent;\n    let changed = false;\n    while (g) {\n      changed = this.aggregations.delete(`${ranking.id}@${toGroupID(g)}`) || changed;\n      g = g.parent;\n    }\n    return changed;\n  }\n\n  getAggregationStrategy() {\n    return this.options.aggregationStrategy;\n  }\n\n  private initAggregateState(ranking: Ranking, groups: IGroup[]) {\n    let initial = -1;\n    switch (this.getAggregationStrategy()) {\n      case 'group':\n        initial = 0;\n        break;\n      case 'item':\n      case 'group+item':\n      case 'group+item+top':\n        initial = -1;\n        break;\n      case 'group+top+item':\n        initial = this.showTopN;\n        break;\n    }\n\n    for (const group of groups) {\n      const key = `${ranking.id}@${toGroupID(group)}`;\n      if (!this.aggregations.has(key) && initial >= 0) {\n        this.aggregations.set(key, initial);\n      }\n    }\n  }\n\n  setTopNAggregated(ranking: Ranking, group: IGroup | IGroup[], value: number | number[]) {\n    const groups = Array.isArray(group) ? group : [group];\n    const changed: IGroup[] = [];\n    const previous: number[] = [];\n\n    let changedParents = false;\n\n    for (let i = 0; i < groups.length; i++) {\n      const group = groups[i];\n      const target = typeof value === 'number' ? value : value[i];\n      changedParents = this.unaggregateParents(ranking, group) || changedParents;\n      const current = this.getTopNAggregated(ranking, group);\n      if (current === target) {\n        continue;\n      }\n      changed.push(group);\n      previous.push(current);\n      const key = `${ranking.id}@${toGroupID(group)}`;\n      if (target >= 0) {\n        this.aggregations.set(key, target);\n      } else {\n        this.aggregations.delete(key);\n      }\n    }\n    if (!changedParents && changed.length === 0) {\n      // no change\n      return;\n    }\n    if (!Array.isArray(group)) {\n      // single change\n      this.fire(\n        [ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY],\n        ranking,\n        group,\n        previous.length === 0 ? value : previous[0],\n        value\n      );\n    } else {\n      this.fire(\n        [ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY],\n        ranking,\n        group,\n        previous,\n        value\n      );\n    }\n  }\n\n  aggregateAllOf(ranking: Ranking, aggregateAll: boolean | number | EAggregationState, groups = ranking.getGroups()) {\n    const value = convertAggregationState(aggregateAll, this.showTopN);\n    this.setTopNAggregated(ranking, groups, value);\n  }\n\n  getShowTopN() {\n    return this.showTopN;\n  }\n\n  setShowTopN(value: number) {\n    if (this.showTopN === value) {\n      return;\n    }\n    // update entries\n    for (const [k, v] of Array.from(this.aggregations.entries())) {\n      if (v === this.showTopN) {\n        this.aggregations.set(k, value);\n      }\n    }\n    this.fire(\n      [ADataProvider.EVENT_SHOWTOPN_CHANGED, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY],\n      this.showTopN,\n      (this.showTopN = value)\n    );\n  }\n\n  /**\n   * sorts the given ranking and eventually return a ordering of the data items\n   * @param ranking\n   * @return {Promise<any>}\n   */\n  abstract sort(\n    ranking: Ranking,\n    dirtyReason: EDirtyReason[]\n  ):\n    | Promise<{ groups: IOrderedGroup[]; index2pos: IndicesArray }>\n    | { groups: IOrderedGroup[]; index2pos: IndicesArray };\n\n  /**\n   * returns a view in the order of the given indices\n   * @param indices\n   * @return {Promise<any>}\n   */\n  abstract view(indices: ArrayLike<number>): Promise<any[]> | any[];\n\n  abstract getRow(index: number): Promise<IDataRow> | IDataRow;\n\n  /**\n   * returns a data sample used for the mapping editor\n   * @param col\n   * @return {Promise<any>}\n   */\n  abstract mappingSample(col: Column): Promise<ISequence<number>> | ISequence<number>;\n\n  /**\n   * is the given row selected\n   * @param index\n   * @return {boolean}\n   */\n  isSelected(index: number) {\n    return this.selection.has(index);\n  }\n\n  /**\n   * also select the given row\n   * @param index\n   */\n  select(index: number) {\n    if (this.selection.has(index)) {\n      return; //no change\n    }\n    if (this.options.singleSelection === true && this.selection.size > 0) {\n      this.selection.clear();\n    }\n    this.selection.add(index);\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\n  }\n\n  /**\n   * hook for selecting elements matching the given arguments\n   * @param search\n   * @param col\n   */\n  abstract searchAndJump(search: string | RegExp, col: Column): void;\n\n  jumpToNearest(indices: number[]) {\n    if (indices.length === 0) {\n      return;\n    }\n    this.fire(ADataProvider.EVENT_JUMP_TO_NEAREST, indices);\n  }\n\n  /**\n   * also select all the given rows\n   * @param indices\n   */\n  selectAll(indices: IndicesArray) {\n    if (everyIndices(indices, (i) => this.selection.has(i))) {\n      return; //no change\n    }\n    if (this.options.singleSelection === true) {\n      this.selection.clear();\n      if (indices.length > 0) {\n        this.selection.add(indices[0]);\n      }\n    } else {\n      forEachIndices(indices, (index) => {\n        this.selection.add(index);\n      });\n    }\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\n  }\n\n  selectAllOf(ranking: Ranking) {\n    this.setSelection(Array.from(ranking.getOrder()));\n  }\n\n  /**\n   * set the selection to the given rows\n   * @param indices\n   */\n  setSelection(indices: number[]) {\n    if (indices.length === 0) {\n      return this.clearSelection();\n    }\n    if (this.selection.size === indices.length && indices.every((i) => this.selection.has(i))) {\n      return; //no change\n    }\n    this.selection.clear();\n    this.selectAll(indices);\n  }\n\n  /**\n   * toggles the selection of the given data index\n   * @param index\n   * @param additional just this element or all\n   * @returns {boolean} whether the index is currently selected\n   */\n  toggleSelection(index: number, additional = false) {\n    if (this.isSelected(index)) {\n      if (additional) {\n        this.deselect(index);\n      } else {\n        this.clearSelection();\n      }\n      return false;\n    }\n    if (additional) {\n      this.select(index);\n    } else {\n      this.setSelection([index]);\n    }\n    return true;\n  }\n\n  /**\n   * deselect the given row\n   * @param index\n   */\n  deselect(index: number) {\n    if (!this.selection.has(index)) {\n      return; //no change\n    }\n    this.selection.delete(index);\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\n  }\n\n  /**\n   * also select all the given rows\n   * @param indices\n   */\n  deselectAll(indices: IndicesArray) {\n    if (everyIndices(indices, (i) => !this.selection.has(i))) {\n      return; //no change\n    }\n    forEachIndices(indices, (index) => {\n      this.selection.delete(index);\n    });\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\n  }\n\n  /**\n   * returns a promise containing the selected rows\n   * @return {Promise<any[]>}\n   */\n  selectedRows(): Promise<any[]> | any[] {\n    if (this.selection.size === 0) {\n      return [];\n    }\n    return this.view(this.getSelection());\n  }\n\n  /**\n   * returns the currently selected indices\n   * @returns {Array}\n   */\n  getSelection() {\n    return Array.from(this.selection);\n  }\n\n  /**\n   * clears the selection\n   */\n  clearSelection() {\n    if (this.selection.size === 0) {\n      return; //no change\n    }\n    this.selection.clear();\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, [], false);\n  }\n\n  /**\n   * utility to export a ranking to a table with the given separator\n   * @param ranking\n   * @param options\n   * @returns {Promise<string>}\n   */\n  exportTable(ranking: Ranking, options: Partial<IExportOptions> = {}): Promise<string> | string {\n    const data = this.view(ranking.getOrder());\n    if (isPromiseLike(data)) {\n      return data.then((dataImpl) => exportRanking(ranking, dataImpl, options));\n    }\n    return exportRanking(ranking, data, options);\n  }\n  /**\n   * utility to export the selection within the given ranking to a table with the given separator\n   * @param ranking\n   * @param options\n   * @returns {Promise<string>}\n   */\n  exportSelection(options: Partial<IExportOptions> & { ranking?: Ranking } = {}): Promise<string> | string {\n    const selection = this.getSelection();\n    const ranking = options.ranking || this.getFirstRanking();\n    if (!ranking) {\n      return '';\n    }\n    const rows = selection.map((s) => this.getRow(s));\n    if (rows.some((row) => isPromiseLike(row))) {\n      return Promise.all(rows).then((data) => {\n        return exportTable(ranking, data, options);\n      });\n    }\n    return exportTable(ranking, rows as IDataRow[], options);\n  }\n}\n\nexport default ADataProvider;\n","import {\n  ActionColumn,\n  AggregateGroupColumn,\n  AnnotateColumn,\n  BooleanColumn,\n  BooleansColumn,\n  BoxPlotColumn,\n  CategoricalColumn,\n  CategoricalMapColumn,\n  CategoricalsColumn,\n  DateColumn,\n  DatesColumn,\n  DatesMapColumn,\n  GroupColumn,\n  HierarchyColumn,\n  ImpositionBoxPlotColumn,\n  ImpositionCompositeColumn,\n  ImpositionCompositesColumn,\n  LinkColumn,\n  LinkMapColumn,\n  LinksColumn,\n  NestedColumn,\n  NumberColumn,\n  NumberMapColumn,\n  NumbersColumn,\n  OrdinalColumn,\n  RankColumn,\n  ReduceColumn,\n  ScriptColumn,\n  SelectionColumn,\n  SetColumn,\n  StackColumn,\n  StringColumn,\n  StringMapColumn,\n  StringsColumn,\n} from './';\n\n/**\n * a map of all known column types\n */\nexport function models() {\n  return {\n    actions: ActionColumn,\n    aggregate: AggregateGroupColumn,\n    annotate: AnnotateColumn,\n    boolean: BooleanColumn,\n    booleans: BooleansColumn,\n    boxplot: BoxPlotColumn,\n    categorical: CategoricalColumn,\n    categoricalMap: CategoricalMapColumn,\n    categoricals: CategoricalsColumn,\n    date: DateColumn,\n    dateMap: DatesMapColumn,\n    dates: DatesColumn,\n    group: GroupColumn,\n    hierarchy: HierarchyColumn,\n    imposition: ImpositionCompositeColumn,\n    impositionBoxPlot: ImpositionBoxPlotColumn,\n    impositions: ImpositionCompositesColumn,\n    reduce: ReduceColumn,\n    nested: NestedColumn,\n    number: NumberColumn,\n    numbers: NumbersColumn,\n    numberMap: NumberMapColumn,\n    ordinal: OrdinalColumn,\n    rank: RankColumn,\n    script: ScriptColumn,\n    selection: SelectionColumn,\n    set: SetColumn,\n    stack: StackColumn,\n    string: StringColumn,\n    stringMap: StringMapColumn,\n    strings: StringsColumn,\n    link: LinkColumn,\n    linkMap: LinkMapColumn,\n    links: LinksColumn,\n  };\n}\n","import { IColumnDesc, Ranking } from '../model';\nimport ADataProvider from './ADataProvider';\nimport type { IDataProviderDump, IDataProviderOptions } from './interfaces';\nimport { isComplexAccessor, rowGetter, rowComplexGetter, rowGuessGetter } from '../internal';\n\nfunction injectAccessor(d: any) {\n  d.accessor = d.accessor || (d.column ? (isComplexAccessor(d.column) ? rowComplexGetter : rowGetter) : rowGuessGetter);\n  d.label = d.label || d.column;\n  return d;\n}\n\n/**\n * common base implementation of a DataProvider with a fixed list of column descriptions\n */\nabstract class ACommonDataProvider extends ADataProvider {\n  private rankingIndex = 0;\n\n  constructor(private columns: IColumnDesc[] = [], options: Partial<IDataProviderOptions> = {}) {\n    super(options);\n    //generate the accessor\n    columns.forEach(injectAccessor);\n  }\n\n  cloneRanking(existing?: Ranking) {\n    const id = this.nextRankingId();\n    const clone = new Ranking(id);\n\n    if (existing) {\n      //copy the ranking of the other one\n      //TODO better cloning\n      existing.children.forEach((child) => {\n        this.push(clone, child.desc);\n      });\n    }\n\n    return clone;\n  }\n\n  /**\n   * adds another column description to this data provider\n   * @param column\n   */\n  pushDesc(column: IColumnDesc) {\n    injectAccessor(column);\n    this.columns.push(column);\n    this.fire(ADataProvider.EVENT_ADD_DESC, column);\n  }\n\n  clearColumns() {\n    this.clearRankings();\n    this.columns.splice(0, this.columns.length);\n    this.fire(ADataProvider.EVENT_CLEAR_DESC);\n  }\n\n  /**\n   * Remove the given column description from the data provider.\n   * Column descriptions that are in use (i.e., has column instances in a ranking) cannot be removed by default.\n   * Skip the check by setting the `ignoreBeingUsed` parameter to `true`.\n   *\n   * @param column Column description\n   * @param ignoreBeingUsed Flag whether to ignore the usage of the column descriptions in rankings\n   */\n  removeDesc(column: IColumnDesc, ignoreBeingUsed = false): boolean {\n    const i = this.columns.indexOf(column);\n    if (i < 0) {\n      return false;\n    }\n    const isUsed = ignoreBeingUsed\n      ? false\n      : this.getRankings().some((d) => d.flatColumns.some((c) => c.desc === column));\n    if (isUsed) {\n      return false;\n    }\n    this.columns.splice(i, 1);\n    this.fire(ADataProvider.EVENT_REMOVE_DESC, column);\n    return true;\n  }\n\n  getColumns(): IColumnDesc[] {\n    return this.columns.slice();\n  }\n\n  findDesc(ref: string) {\n    return this.columns.filter((c) => (c as any).column === ref)[0];\n  }\n\n  /**\n   * identify by the tuple type@columnname\n   * @param desc\n   * @returns {string}\n   */\n  toDescRef(desc: any): any {\n    return typeof desc.column !== 'undefined' ? `${desc.type}@${desc.column}` : this.cleanDesc(Object.assign({}, desc));\n  }\n\n  fromDescRef(descRef: any): any {\n    if (typeof descRef === 'string') {\n      return this.columns.find((d: any) => `${d.type}@${d.column}` === descRef || d.type === descRef);\n    }\n    const existing = this.columns.find(\n      (d) => descRef.column === (d as any).column && descRef.label === d.label && descRef.type === d.type\n    );\n    if (existing) {\n      return existing;\n    }\n    return descRef;\n  }\n\n  restore(dump: IDataProviderDump) {\n    super.restore(dump);\n    this.rankingIndex = 1 + Math.max(...this.getRankings().map((r) => +r.id.substring(4)));\n  }\n\n  nextRankingId() {\n    return `rank${this.rankingIndex++}`;\n  }\n}\n\nexport default ACommonDataProvider;\n","import { createIndexArray, ILookUpArray } from '../internal';\nimport {\n  FIRST_IS_MISSING,\n  FIRST_IS_NAN,\n  ECompareValueType,\n  ICompareValue,\n  Column,\n  UIntTypedArray,\n  Ranking,\n  IDataRow,\n} from '../model';\n\nconst missingUInt8 = FIRST_IS_MISSING > 0 ? 255 : 0;\nconst missingBinary = missingUInt8;\nconst missingUInt16 = FIRST_IS_MISSING > 0 ? 65535 : 0; // max or 0\nconst missingUInt32 = FIRST_IS_MISSING > 0 ? 4294967295 : 0; // max or 0\nconst missingInt8 = FIRST_IS_MISSING > 0 ? 127 : -128; // max or min\nconst missingInt16 = FIRST_IS_MISSING > 0 ? 32767 : -32768; // max or min\nconst missingInt32 = FIRST_IS_MISSING > 0 ? 2147483647 : -2147483648; // max or min\nconst missingFloat = FIRST_IS_NAN > 0 ? Number.POSITIVE_INFINITY : Number.NEGATIVE_INFINITY;\nconst missingFloatAsc = FIRST_IS_MISSING > 0 ? Number.POSITIVE_INFINITY : Number.NEGATIVE_INFINITY;\nconst missingString = FIRST_IS_MISSING > 0 ? '\\uffff' : '\\u0000'; // first or last character\n\nfunction chooseMissingByLength(length: number) {\n  if (length <= 255) {\n    return missingBinary;\n  }\n  if (length <= 65535) {\n    return missingUInt16;\n  }\n  return missingUInt32;\n}\n\nfunction toCompareLookUp(rawLength: number, type: ECompareValueType): ILookUpArray {\n  switch (type) {\n    case ECompareValueType.COUNT:\n      return createIndexArray(rawLength + 1);\n    case ECompareValueType.BINARY:\n    case ECompareValueType.UINT8:\n      return new Uint8Array(rawLength);\n    case ECompareValueType.UINT16:\n      return new Uint16Array(rawLength);\n    case ECompareValueType.UINT32:\n      return new Uint32Array(rawLength);\n    case ECompareValueType.INT8:\n      return new Int8Array(rawLength);\n    case ECompareValueType.INT16:\n      return new Int16Array(rawLength);\n    case ECompareValueType.INT32:\n      return new Int32Array(rawLength);\n    case ECompareValueType.STRING:\n      return [] as string[];\n    case ECompareValueType.FLOAT_ASC:\n    case ECompareValueType.FLOAT:\n      return new Float64Array(rawLength);\n    case ECompareValueType.DOUBLE_ASC:\n    case ECompareValueType.DOUBLE:\n      return new Float64Array(rawLength);\n  }\n}\n\nfunction createSetter(\n  type: ECompareValueType,\n  lookup: ILookUpArray,\n  missingCount: number\n): (index: number, v: ICompareValue) => void {\n  switch (type) {\n    case ECompareValueType.BINARY: // just 0 or 1 -> convert to 0=Number.NEGATIVE_INFINITY 1 2 255=Number.POSITIVE_INFINITY\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingBinary : (v as number) + 1);\n    case ECompareValueType.COUNT: // uint32\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingCount : (v as number) + 1);\n    case ECompareValueType.UINT8: // shift by one to have 0 for -Inf\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingInt8 : (v as number) + 1);\n    case ECompareValueType.UINT16: // shift by one to have 0 for -Inf\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingInt16 : (v as number) + 1);\n    case ECompareValueType.UINT32: // shift by one to have 0 for -Inf\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingInt32 : (v as number) + 1);\n    case ECompareValueType.INT8:\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingInt8 : (v as number));\n    case ECompareValueType.INT16:\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingInt16 : (v as number));\n    case ECompareValueType.INT32:\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingInt32 : (v as number));\n    case ECompareValueType.STRING:\n      return (index, v) => (lookup[index] = v == null || v === '' ? missingString : v);\n    case ECompareValueType.FLOAT:\n    case ECompareValueType.DOUBLE:\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingFloat : v);\n    case ECompareValueType.FLOAT_ASC:\n    case ECompareValueType.DOUBLE_ASC:\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingFloatAsc : v);\n  }\n}\n\nexport class CompareLookup {\n  private readonly criteria: { col: Column; valueCache?(dataIndex: number): any }[] = [];\n  private readonly data: {\n    asc: boolean;\n    v: ECompareValueType;\n    lookup: ILookUpArray;\n    setter: (dataIndex: number, value: ICompareValue) => void;\n  }[] = [];\n\n  constructor(\n    rawLength: number,\n    isSorting: boolean,\n    ranking: Ranking,\n    valueCaches?: (col: Column) => undefined | ((i: number) => any)\n  ) {\n    const missingCount = chooseMissingByLength(rawLength + 1); // + 1 for the value shift to have 0 as start\n\n    for (const c of isSorting ? ranking.getSortCriteria() : ranking.getGroupSortCriteria()) {\n      const v = isSorting ? c.col.toCompareValueType() : c.col.toCompareGroupValueType();\n      const valueCache = valueCaches ? valueCaches(c.col) : undefined;\n      this.criteria.push({ col: c.col, valueCache });\n      if (!Array.isArray(v)) {\n        const lookup = toCompareLookUp(rawLength, v);\n        this.data.push({ asc: c.asc, v, lookup, setter: createSetter(v, lookup, missingCount) });\n        continue;\n      }\n      for (const vi of v) {\n        const lookup = toCompareLookUp(rawLength, vi);\n        this.data.push({ asc: c.asc, v: vi, lookup, setter: createSetter(vi, lookup, missingCount) });\n      }\n    }\n\n    if (isSorting) {\n      return;\n    }\n\n    {\n      const v = ECompareValueType.STRING;\n      const lookup = toCompareLookUp(rawLength, v);\n      this.data.push({ asc: true, v, lookup, setter: createSetter(v, lookup, missingCount) });\n    }\n  }\n\n  get sortOrders() {\n    return this.data.map((d) => ({ asc: d.asc, lookup: d.lookup }));\n  }\n\n  get transferAbles() {\n    // so a typed array\n    return this.data\n      .map((d) => d.lookup)\n      .filter((d): d is UIntTypedArray | Float64Array => !Array.isArray(d))\n      .map((d) => d.buffer);\n  }\n\n  push(row: IDataRow) {\n    let i = 0;\n    for (const c of this.criteria) {\n      const r = c.col.toCompareValue(row, c.valueCache ? c.valueCache(row.i) : undefined);\n      if (!Array.isArray(r)) {\n        this.data[i++].setter(row.i, r);\n        continue;\n      }\n      for (const ri of r) {\n        this.data[i++].setter(row.i, ri);\n      }\n    }\n  }\n\n  pushValues(dataIndex: number, vs: ICompareValue[]) {\n    for (let i = 0; i < vs.length; ++i) {\n      this.data[i].setter(dataIndex, vs[i]);\n    }\n  }\n\n  free() {\n    // free up to save memory\n    this.data.splice(0, this.data.length);\n  }\n}\n","import { IAbortAblePromise, ABORTED, IAbortAblePromiseBase } from 'lineupengine';\nexport { ABORTED } from 'lineupengine';\n\n/**\n * @internal\n */\nexport interface IPoorManIdleDeadline {\n  didTimeout: boolean;\n  timeRemaining(): number;\n}\n\n/**\n * helper since not part of the typings\n * @internal\n */\nexport interface IPoorManIdleCallback {\n  requestIdleCallback(callback: (deadline: IPoorManIdleDeadline) => void, options?: { timeout: number }): number;\n\n  clearIdleCallback(callbackId: number): void;\n}\n\n/**\n * @internal\n */\nexport interface ITask<T> {\n  /**\n   * external task id\n   */\n  id: string;\n  /**\n   * iterator for the incremental task, return null for another round\n   */\n  it: Iterator<T | PromiseLike<T> | null>;\n  /**\n   * function to the resolve the resulting promise\n   */\n  resolve(r: T | PromiseLike<T> | symbol): void;\n  /**\n   * the resulting promise\n   */\n  result: PromiseLike<T | symbol>;\n\n  /**\n   * aborts this task\n   */\n  abort: () => void;\n\n  isAborted: boolean;\n}\n\n/**\n * iterator result for another round\n * @internal\n */\nexport const ANOTHER_ROUND = {\n  value: null,\n  done: false,\n};\n\n/**\n * iterator for just one entry\n * @internal\n */\nexport function oneShotIterator<T>(calc: () => T): Iterator<T> {\n  return {\n    next: () => ({ done: true, value: calc() }),\n  };\n}\n\nfunction thenFactory<T>(wrappee: PromiseLike<T>, abort: () => void, isAborted: () => boolean) {\n  function then<TResult1 = T | symbol, TResult2 = never>(\n    onfulfilled?: ((value: T | symbol) => TResult1 | PromiseLike<TResult1>) | undefined | null,\n    onrejected?: ((reason: any) => TResult2 | PromiseLike<TResult2>) | undefined | null\n  ): IAbortAblePromiseBase<TResult1 | TResult2> {\n    const r = wrappee.then(onfulfilled, onrejected);\n    return {\n      then: thenFactory(r, abort, isAborted) as any,\n      abort,\n      isAborted,\n    };\n  }\n  return then;\n}\n\n/**\n * task scheduler for running tasks in idle callbacks\n * @internal\n */\nexport default class TaskScheduler {\n  private tasks: ITask<any>[] = [];\n  // idle callback id\n  private taskId = -1;\n\n  private runTasks = (deadline: IPoorManIdleDeadline) => {\n    // while more tasks and not timed out\n    while (this.tasks.length > 0 && (deadline.didTimeout || deadline.timeRemaining() > 0)) {\n      const task = this.tasks.shift()!;\n\n      let r = task.it.next();\n      // call next till done or ran out of time\n      while (!r.done && (deadline.didTimeout || deadline.timeRemaining() > 0)) {\n        r = task.it.next();\n      }\n\n      if (r.done) {\n        // resolve async\n        requestAnimationFrame(() => task.resolve(r.value));\n      } else {\n        // reschedule again\n        this.tasks.unshift(task);\n      }\n    }\n\n    this.taskId = -1;\n    this.reSchedule();\n  };\n\n  private reSchedule() {\n    if (this.tasks.length === 0 || this.taskId > -1) {\n      return;\n    }\n\n    // eslint-disable-next-line no-restricted-globals\n    const ww = self as any as IPoorManIdleCallback;\n    if (ww.requestIdleCallback) {\n      this.taskId = ww.requestIdleCallback(this.runTasks);\n    } else {\n      this.taskId = setTimeout(this.runTasks, 1) as unknown as number;\n    }\n  }\n\n  /**\n   * pushes a task with multi hops using an iterator\n   * @param id task id\n   * @param it iterator to execute\n   */\n  pushMulti<T>(id: string, it: Iterator<T | PromiseLike<T> | null>, abortAble = true): IAbortAblePromise<T> {\n    // abort task with the same id\n    const abort = () => {\n      const index = this.tasks.findIndex((d) => d.id === id);\n      if (index < 0) {\n        return; // too late or none\n      }\n      const task = this.tasks[index];\n      this.tasks.splice(index, 1);\n\n      task.isAborted = true;\n      task.resolve(ABORTED);\n    };\n\n    {\n      // abort existing\n      const index = this.tasks.findIndex((d) => d.id === id);\n      if (index >= 0) {\n        const task = this.tasks[index];\n        task.abort();\n      }\n    }\n\n    let resolve: (value: T | symbol) => void;\n\n    const p = new Promise<T | symbol>((r) => {\n      // called during constructor\n      resolve = r;\n    });\n\n    const task: ITask<T> = {\n      id,\n      it,\n      result: p,\n      abort,\n      isAborted: false,\n      resolve: resolve!,\n    };\n    const isAborted = () => task.isAborted;\n\n    this.tasks.push(task);\n\n    this.reSchedule();\n\n    const abortOrDummy = abortAble ? abort : () => undefined;\n    const isAbortedOrDummy = abortAble ? isAborted : () => false;\n\n    return {\n      then: thenFactory(p, abortOrDummy, isAbortedOrDummy),\n      abort: abortOrDummy,\n      isAborted: isAbortedOrDummy,\n    };\n  }\n\n  /**\n   * pushes a simple task\n   * @param id task id\n   * @param calc task function\n   */\n  push<T>(id: string, calc: () => T | PromiseLike<T>): IAbortAblePromise<T> {\n    return this.pushMulti(id, oneShotIterator(calc));\n  }\n\n  /**\n   * abort a task with the given id\n   * @param id task id\n   */\n  abort(id: string) {\n    const index = this.tasks.findIndex((d) => d.id === id);\n    if (index < 0) {\n      return false; // too late or none\n    }\n    const task = this.tasks[index];\n    task.abort();\n    return true;\n  }\n\n  abortAll(filter: (task: ITask<any>) => boolean) {\n    const abort = this.tasks.filter(filter);\n    if (abort.length === 0) {\n      return;\n    }\n    this.tasks = this.tasks.filter((d) => !filter(d));\n    for (const task of abort) {\n      task.resolve(ABORTED);\n      task.abort();\n    }\n  }\n\n  clear() {\n    if (this.taskId === -1) {\n      return;\n    }\n    // eslint-disable-next-line no-restricted-globals\n    const ww = self as any as IPoorManIdleCallback;\n    if (ww.requestIdleCallback) {\n      ww.clearIdleCallback(this.taskId);\n    } else {\n      clearTimeout(this.taskId);\n    }\n    this.taskId = -1;\n\n    this.tasks.splice(0, this.tasks.length).forEach((d) => {\n      d.resolve(ABORTED);\n      d.abort();\n    });\n  }\n}\n","import { abortAbleAll, IAbortAblePromise } from 'lineupengine';\nimport { ANOTHER_ROUND } from '../internal/scheduler';\nimport {\n  IForEachAble,\n  lazySeq,\n  boxplotBuilder,\n  categoricalStatsBuilder,\n  categoricalValueCacheBuilder,\n  dateStatsBuilder,\n  dateValueCacheBuilder,\n  IAdvancedBoxPlotData,\n  ICategoricalStatistics,\n  IDateStatistics,\n  IStatistics,\n  numberStatsBuilder,\n  dateValueCache2Value,\n  categoricalValueCache2Value,\n  joinIndexArrays,\n  IBuilder,\n  ISequence,\n  IStringStatistics,\n  stringStatsBuilder,\n} from '../internal';\nimport {\n  CategoricalColumn,\n  Column,\n  ICompareValue,\n  DateColumn,\n  ICategoricalLikeColumn,\n  IDataRow,\n  IDateColumn,\n  IGroup,\n  ImpositionCompositeColumn,\n  IndicesArray,\n  INumberColumn,\n  NumberColumn,\n  OrdinalColumn,\n  Ranking,\n  UIntTypedArray,\n  ICategory,\n  StringColumn,\n  isMapAbleColumn,\n} from '../model';\nimport type { IRenderTask, IRenderTasks } from '../renderer';\nimport type { CompareLookup } from './sort';\n\n/**\n * a render task that is already resolved\n */\nexport class TaskNow<T> implements IRenderTask<T> {\n  constructor(public readonly v: T) {}\n\n  then<U = void>(onfullfilled: (value: T) => U) {\n    return onfullfilled(this.v);\n  }\n}\n\n/**\n * factory function for\n */\nexport function taskNow<T>(v: T) {\n  return new TaskNow(v);\n}\n\n/**\n * a render task based on an abortable promise\n */\nexport class TaskLater<T> implements IRenderTask<T> {\n  constructor(public readonly v: IAbortAblePromise<T>) {}\n\n  then<U = void>(onfullfilled: (value: T | symbol) => U): IAbortAblePromise<U> {\n    return this.v.then(onfullfilled);\n  }\n}\n\nexport function taskLater<T>(v: IAbortAblePromise<T>) {\n  return new TaskLater(v);\n}\n\n/**\n * similar to Promise.all\n */\nexport function tasksAll<T>(tasks: IRenderTask<T>[]): IRenderTask<T[]> {\n  if (tasks.every((t) => t instanceof TaskNow)) {\n    return taskNow(tasks.map((d) => (d as TaskNow<T>).v));\n  }\n  return taskLater(abortAbleAll((tasks as (TaskNow<T> | TaskLater<T>)[]).map((d) => d.v)));\n}\n\nexport interface IRenderTaskExecutor extends IRenderTasks {\n  setData(data: IDataRow[]): void;\n\n  dirtyColumn(col: Column, type: 'data' | 'summary' | 'group'): void;\n  dirtyRanking(ranking: Ranking, type: 'data' | 'summary' | 'group'): void;\n\n  groupCompare(ranking: Ranking, group: IGroup, rows: IndicesArray): IRenderTask<ICompareValue[]>;\n\n  preCompute(ranking: Ranking, groups: { rows: IndicesArray; group: IGroup }[], maxDataIndex: number): void;\n  preComputeCol(col: Column): void;\n  preComputeData(ranking: Ranking): void;\n  copyData2Summary(ranking: Ranking): void;\n  copyCache(col: Column, from: Column): void;\n\n  sort(\n    ranking: Ranking,\n    group: IGroup,\n    indices: IndicesArray,\n    singleCall: boolean,\n    maxDataIndex: number,\n    lookups?: CompareLookup\n  ): Promise<IndicesArray>;\n\n  terminate(): void;\n\n  valueCache(col: Column): undefined | ((dataIndex: number) => any);\n}\n\nexport class MultiIndices {\n  private _joined: IndicesArray | null = null;\n\n  constructor(public readonly indices: IndicesArray[], private readonly maxDataIndex: number) {}\n\n  get joined() {\n    if (this.indices.length === 1) {\n      return this.indices[0];\n    }\n    if (this.indices.length === 0) {\n      return new Uint8Array(0);\n    }\n    if (this._joined) {\n      return this._joined;\n    }\n    return (this._joined = joinIndexArrays(this.indices, this.maxDataIndex));\n  }\n}\n\n/**\n * number of data points to build per iteration / chunk\n */\nconst CHUNK_SIZE = 100;\n\nexport interface ARenderTaskOptions {\n  stringTopNCount: number | readonly string[];\n}\n\nexport class ARenderTasks {\n  protected readonly valueCacheData = new Map<\n    string,\n    Float32Array | UIntTypedArray | Int32Array | Float64Array | readonly string[]\n  >();\n\n  protected readonly byIndex = (i: number) => this.data[i];\n\n  protected readonly options: ARenderTaskOptions;\n  protected data: IDataRow[] = [];\n\n  constructor(options: Partial<ARenderTaskOptions> = {}) {\n    this.options = Object.assign(\n      {\n        stringTopNCount: 10,\n      },\n      options\n    );\n  }\n\n  protected byOrder(indices: IndicesArray): ISequence<IDataRow> {\n    return lazySeq(indices).map(this.byIndex);\n  }\n\n  protected byOrderAcc<T>(indices: IndicesArray, acc: (row: IDataRow) => T) {\n    return lazySeq(indices).map((i) => acc(this.data[i]));\n  }\n\n  /**\n   * builder factory to create an iterator that can be used to schedule\n   * @param builder the builder to use\n   * @param order the order to iterate over\n   * @param acc the accessor to get the value out of the data\n   * @param build optional build mapper\n   */\n  private builder<T, BR, B extends { push: (v: T) => void; build: () => BR }, R = BR>(\n    builder: B,\n    order: IndicesArray | null | MultiIndices,\n    acc: (dataIndex: number) => T,\n    build?: (r: BR) => R\n  ): Iterator<R | null> {\n    let i = 0;\n\n    // no indices given over the whole data\n    const nextData = (currentChunkSize: number = CHUNK_SIZE) => {\n      let chunkCounter = currentChunkSize;\n      const data = this.data;\n      for (; i < data.length && chunkCounter > 0; ++i, --chunkCounter) {\n        builder.push(acc(i));\n      }\n      if (i < data.length) {\n        // need another round\n        return ANOTHER_ROUND;\n      }\n      // done\n      return {\n        done: true,\n        value: build ? build(builder.build()) : (builder.build() as unknown as R),\n      };\n    };\n\n    let o = 0;\n    const orders = order instanceof MultiIndices ? order.indices : [order];\n\n    const nextOrder = (currentChunkSize: number = CHUNK_SIZE) => {\n      let chunkCounter = currentChunkSize;\n\n      while (o < orders.length) {\n        const actOrder = orders[o]!;\n        for (; i < actOrder.length && chunkCounter > 0; ++i, --chunkCounter) {\n          builder.push(acc(actOrder[i]));\n        }\n        if (i < actOrder.length) {\n          // need another round\n          return ANOTHER_ROUND;\n        }\n        // done with this order\n        o++;\n        i = 0;\n      }\n      return {\n        done: true,\n        value: build ? build(builder.build()) : (builder.build() as unknown as R),\n      };\n    };\n    return { next: order == null ? nextData : nextOrder };\n  }\n\n  private builderForEach<T, BR, B extends { pushAll: (v: IForEachAble<T>) => void; build: () => BR }, R = BR>(\n    builder: B,\n    order: IndicesArray | null | MultiIndices,\n    acc: (dataIndex: number) => IForEachAble<T>,\n    build?: (r: BR) => R\n  ): Iterator<R | null> {\n    return this.builder(\n      {\n        push: builder.pushAll,\n        build: builder.build,\n      },\n      order,\n      acc,\n      build\n    );\n  }\n\n  protected boxplotBuilder<R = IAdvancedBoxPlotData>(\n    order: IndicesArray | null | MultiIndices,\n    col: INumberColumn,\n    raw?: boolean,\n    build?: (stat: IAdvancedBoxPlotData) => R\n  ) {\n    const b = boxplotBuilder();\n    return this.numberStatsBuilder(b, order, col, raw, build);\n  }\n\n  protected resolveDomain(col: INumberColumn, raw: boolean): [number, number] {\n    const domain = raw && isMapAbleColumn(col) ? col.getMapping().domain : [0, 1];\n    return [domain[0], domain[domain.length - 1]];\n  }\n\n  protected statsBuilder<R = IStatistics>(\n    order: IndicesArray | null | MultiIndices,\n    col: INumberColumn,\n    numberOfBins: number,\n    raw?: boolean,\n    build?: (stat: IStatistics) => R\n  ) {\n    const b = numberStatsBuilder(this.resolveDomain(col, raw ?? false), numberOfBins);\n    return this.numberStatsBuilder(b, order, col, raw, build);\n  }\n\n  private numberStatsBuilder<R, B extends IBuilder<number, BR>, BR>(\n    b: B,\n    order: IndicesArray | null | MultiIndices,\n    col: INumberColumn,\n    raw?: boolean,\n    build?: (stat: BR) => R\n  ) {\n    if (col instanceof NumberColumn || col instanceof OrdinalColumn || col instanceof ImpositionCompositeColumn) {\n      const key = raw ? `${col.id}:r` : col.id;\n      const dacc: (i: number) => number = raw\n        ? (i) => col.getRawNumber(this.data[i])\n        : (i) => col.getNumber(this.data[i]);\n\n      if (order == null && !this.valueCacheData.has(key)) {\n        // build and valueCache\n        const vs = new Float64Array(this.data.length);\n        let i = 0;\n        return this.builder(\n          {\n            push: (v) => {\n              b.push(v);\n              vs[i++] = v;\n            },\n            build: () => {\n              this.setValueCacheData(key, vs);\n              return b.build();\n            },\n          },\n          null,\n          dacc,\n          build\n        );\n      }\n\n      const cache = this.valueCacheData.get(key) as UIntTypedArray;\n      const acc: (i: number) => number = cache ? (i) => cache[i] : dacc;\n      return this.builder(b, order, acc, build);\n    }\n    const acc: (i: number) => IForEachAble<number> = raw\n      ? (i) => col.iterRawNumber(this.data[i])\n      : (i) => col.iterNumber(this.data[i]);\n    return this.builderForEach(b, order, acc, build);\n  }\n\n  protected dateStatsBuilder<R = IDateStatistics>(\n    order: IndicesArray | null | MultiIndices,\n    col: IDateColumn,\n    template?: IDateStatistics,\n    build?: (stat: IDateStatistics) => R\n  ) {\n    const b = dateStatsBuilder(template);\n    if (col instanceof DateColumn) {\n      if (order == null) {\n        // build and valueCache\n        const vs = dateValueCacheBuilder(this.data.length);\n        return this.builder(\n          {\n            push: (v) => {\n              b.push(v);\n              vs.push(v);\n            },\n            build: () => {\n              this.setValueCacheData(col.id, vs.cache);\n              return b.build();\n            },\n          },\n          null,\n          (i: number) => col.getDate(this.data[i]),\n          build\n        );\n      }\n      const cache = this.valueCacheData.get(col.id) as UIntTypedArray;\n      const acc: (i: number) => Date | null = cache\n        ? (i) => dateValueCache2Value(cache[i])\n        : (i) => col.getDate(this.data[i]);\n      return this.builder(b, order, acc, build);\n    }\n    return this.builderForEach(b, order, (i: number) => col.iterDate(this.data[i]), build);\n  }\n\n  protected categoricalStatsBuilder<R = ICategoricalStatistics>(\n    order: IndicesArray | null | MultiIndices,\n    col: ICategoricalLikeColumn,\n    build?: (stat: ICategoricalStatistics) => R\n  ) {\n    const b = categoricalStatsBuilder(col.categories);\n    if (col instanceof CategoricalColumn || col instanceof OrdinalColumn) {\n      if (order == null) {\n        // build and valueCache\n        const vs = categoricalValueCacheBuilder(this.data.length, col.categories);\n        return this.builder(\n          {\n            push: (v) => {\n              b.push(v);\n              vs.push(v);\n            },\n            build: () => {\n              this.setValueCacheData(col.id, vs.cache);\n              return b.build();\n            },\n          },\n          null,\n          (i: number) => col.getCategory(this.data[i]),\n          build\n        );\n      }\n      const cache = this.valueCacheData.get(col.id) as UIntTypedArray;\n      const acc: (i: number) => ICategory | null = cache\n        ? (i) => categoricalValueCache2Value(cache[i], col.categories)\n        : (i) => col.getCategory(this.data[i]);\n      return this.builder(b, order, acc, build);\n    }\n    return this.builderForEach(b, order, (i: number) => col.iterCategory(this.data[i]), build);\n  }\n\n  protected stringStatsBuilder<R = IStringStatistics>(\n    order: IndicesArray | null | MultiIndices,\n    col: StringColumn,\n    topN?: number | readonly string[],\n    build?: (stat: IStringStatistics) => R\n  ) {\n    const b = stringStatsBuilder(topN ?? this.options.stringTopNCount);\n    if (order == null) {\n      // build and valueCache\n      let i = 0;\n      const vs: string[] = Array(this.data.length).fill(null);\n      return this.builder(\n        {\n          push: (v) => {\n            b.push(v);\n            vs[i++] = v;\n          },\n          build: () => {\n            this.setValueCacheData(col.id, vs);\n            return b.build();\n          },\n        },\n        null,\n        (i: number) => col.getValue(this.data[i]),\n        build\n      );\n    }\n    return this.builder(b, order, (i: number) => col.getValue(this.data[i]), build);\n  }\n\n  dirtyColumn(col: Column, type: 'data' | 'summary' | 'group') {\n    if (type !== 'data') {\n      return;\n    }\n    this.valueCacheData.delete(col.id);\n    this.valueCacheData.delete(`${col.id}:r`);\n  }\n\n  protected setValueCacheData(\n    key: string,\n    value: Float32Array | UIntTypedArray | Int32Array | Float64Array | readonly string[] | null\n  ) {\n    if (value == null) {\n      this.valueCacheData.delete(key);\n    } else {\n      this.valueCacheData.set(key, value);\n    }\n  }\n\n  valueCache(col: Column) {\n    const v = this.valueCacheData.get(col.id);\n    if (!v) {\n      return undefined;\n    }\n    if (col instanceof DateColumn) {\n      return (dataIndex: number) => dateValueCache2Value(v[dataIndex] as number);\n    }\n    if (col instanceof CategoricalColumn || col instanceof OrdinalColumn) {\n      return (dataIndex: number) => categoricalValueCache2Value(v[dataIndex] as number, col.categories);\n    }\n    return (dataIndex: number) => v[dataIndex];\n  }\n}\n","import type {\n  IDataRow,\n  Ranking,\n  IndicesArray,\n  IGroup,\n  IOrderedGroup,\n  INumberColumn,\n  IDateColumn,\n  ICategoricalLikeColumn,\n  ICompareValue,\n  StringColumn,\n} from '../model';\nimport type Column from '../model';\nimport { ARenderTasks, IRenderTaskExecutor, taskNow } from './tasks';\nimport {\n  ISequence,\n  toIndexArray,\n  sortComplex,\n  getNumberOfBins,\n  IDateStatistics,\n  IStringStatistics,\n  ICategoricalStatistics,\n  IAdvancedBoxPlotData,\n  IStatistics,\n} from '../internal';\nimport type { CompareLookup } from './sort';\nimport type { IRenderTask } from '../renderer';\n\n/**\n * @internal\n */\nexport function sortDirect(indices: IndicesArray, maxDataIndex: number, lookups?: CompareLookup) {\n  const order = toIndexArray(indices, maxDataIndex);\n  if (lookups) {\n    sortComplex(order, lookups.sortOrders);\n  }\n  return order;\n}\n\n/**\n * @internal\n */\nexport class DirectRenderTasks extends ARenderTasks implements IRenderTaskExecutor {\n  protected readonly cache = new Map<string, any>();\n\n  setData(data: IDataRow[]) {\n    this.data = data;\n    this.cache.clear();\n    this.valueCacheData.clear();\n  }\n\n  dirtyColumn(col: Column, type: 'data' | 'summary' | 'group') {\n    super.dirtyColumn(col, type);\n\n    if (type === 'group') {\n      return; // not cached\n    }\n    this.cache.delete(`${col.id}:summary`);\n    this.cache.delete(`${col.id}:summary:raw`);\n    this.cache.delete(`${col.id}:summary:b`);\n    this.cache.delete(`${col.id}:summary:braw`);\n\n    if (type === 'summary') {\n      return;\n    }\n    this.cache.delete(`${col.id}:data`);\n    this.cache.delete(`${col.id}:data:raw`);\n    this.cache.delete(`${col.id}:data:b`);\n    this.cache.delete(`${col.id}:data:braw`);\n  }\n\n  dirtyRanking(ranking: Ranking, type: 'data' | 'summary' | 'group') {\n    for (const col of ranking.flatColumns) {\n      this.dirtyColumn(col, type);\n    }\n  }\n\n  preCompute() {\n    // dummy\n  }\n\n  preComputeData() {\n    // dummy\n  }\n\n  preComputeCol() {\n    // dummy\n  }\n\n  copyData2Summary() {\n    // dummy\n  }\n\n  copyCache(col: Column, from: Column) {\n    const fromPrefix = `${from.id}:`;\n\n    for (const key of Array.from(this.cache.keys()).sort()) {\n      if (!key.startsWith(fromPrefix)) {\n        continue;\n      }\n      const cacheKey = `${col.id}:${key.slice(fromPrefix.length)}`;\n      this.cache.set(cacheKey, this.cache.get(key)!);\n    }\n  }\n\n  sort(\n    _ranking: Ranking,\n    _group: IGroup,\n    indices: IndicesArray,\n    _singleCall: boolean,\n    maxDataIndex: number,\n    lookups?: CompareLookup\n  ) {\n    return Promise.resolve(sortDirect(indices, maxDataIndex, lookups));\n  }\n\n  groupCompare(ranking: Ranking, group: IGroup, rows: IndicesArray): IRenderTask<ICompareValue[]> {\n    const rg = ranking.getGroupSortCriteria();\n    if (rg.length === 0) {\n      return taskNow([group.name.toLowerCase()]);\n    }\n    const o = this.byOrder(rows);\n    const vs: ICompareValue[] = [];\n    for (const s of rg) {\n      const r = s.col.toCompareGroupValue(o, group);\n      if (Array.isArray(r)) {\n        vs.push(...r);\n      } else {\n        vs.push(r);\n      }\n    }\n    vs.push(group.name.toLowerCase());\n    return taskNow(vs);\n  }\n\n  groupRows<T>(\n    _col: Column,\n    group: IOrderedGroup,\n    _key: string,\n    compute: (rows: ISequence<IDataRow>) => T\n  ): IRenderTask<T> {\n    return taskNow(compute(this.byOrder(group.order)));\n  }\n\n  groupExampleRows<T>(\n    _col: Column,\n    group: IOrderedGroup,\n    _key: string,\n    compute: (rows: ISequence<IDataRow>) => T\n  ): IRenderTask<T> {\n    return taskNow(compute(this.byOrder(group.order.slice(0, 5))));\n  }\n\n  groupBoxPlotStats(col: Column & INumberColumn, group: IOrderedGroup, raw?: boolean) {\n    const { summary, data } = this.summaryBoxPlotStatsD(col, raw);\n    return taskNow({\n      group: this.boxplotBuilder(group.order, col, raw).next(Number.POSITIVE_INFINITY as any).value!,\n      summary,\n      data,\n    });\n  }\n\n  groupNumberStats(col: Column & INumberColumn, group: IOrderedGroup, raw?: boolean) {\n    const { summary, data } = this.summaryNumberStatsD(col, raw);\n    return taskNow({\n      group: this.statsBuilder(group.order, col, summary.hist.length, raw).next(Number.POSITIVE_INFINITY as any).value!,\n      summary,\n      data,\n    });\n  }\n\n  groupCategoricalStats(col: Column & ICategoricalLikeColumn, group: IOrderedGroup) {\n    const { summary, data } = this.summaryCategoricalStatsD(col);\n    return taskNow({\n      group: this.categoricalStatsBuilder(group.order, col).next(Number.POSITIVE_INFINITY as any).value!,\n      summary,\n      data,\n    });\n  }\n\n  groupDateStats(col: Column & IDateColumn, group: IOrderedGroup) {\n    const { summary, data } = this.summaryDateStatsD(col);\n    return taskNow({\n      group: this.dateStatsBuilder(group.order, col, summary).next(Number.POSITIVE_INFINITY as any).value!,\n      summary,\n      data,\n    });\n  }\n\n  groupStringStats(col: StringColumn, group: IOrderedGroup) {\n    const { summary, data } = this.summaryStringStatsD(col);\n    return taskNow({\n      group: this.stringStatsBuilder(\n        group.order,\n        col,\n        summary.topN.map((d) => d.value)\n      ).next(Number.POSITIVE_INFINITY as any).value!,\n      summary,\n      data,\n    });\n  }\n\n  summaryBoxPlotStats(col: Column & INumberColumn, raw?: boolean) {\n    return taskNow(this.summaryBoxPlotStatsD(col, raw));\n  }\n\n  summaryNumberStats(col: Column & INumberColumn, raw?: boolean) {\n    return taskNow(this.summaryNumberStatsD(col, raw));\n  }\n\n  summaryCategoricalStats(col: Column & ICategoricalLikeColumn) {\n    return taskNow(this.summaryCategoricalStatsD(col));\n  }\n\n  summaryDateStats(col: Column & IDateColumn) {\n    return taskNow(this.summaryDateStatsD(col));\n  }\n\n  summaryStringStats(col: StringColumn) {\n    return taskNow(this.summaryStringStatsD(col));\n  }\n\n  private summaryNumberStatsD(col: Column & INumberColumn, raw?: boolean): { summary: IStatistics; data: IStatistics } {\n    const ranking = col.findMyRanker();\n    return this.cached(\n      'summary',\n      col,\n      () => {\n        const order = ranking ? ranking.getOrder() : [];\n        const data = this.dataNumberStats(col, raw);\n        return {\n          summary: this.statsBuilder(order, col, data.hist.length, raw).next(Number.POSITIVE_INFINITY as any).value!,\n          data,\n        };\n      },\n      raw ? ':raw' : '',\n      ranking && ranking.getOrderLength() === 0\n    );\n  }\n\n  private summaryBoxPlotStatsD(\n    col: Column & INumberColumn,\n    raw?: boolean\n  ): { summary: IAdvancedBoxPlotData; data: IAdvancedBoxPlotData } {\n    const ranking = col.findMyRanker();\n    return this.cached(\n      'summary',\n      col,\n      () => {\n        const order = ranking ? ranking.getOrder() : [];\n        const data = this.dataBoxPlotStats(col, raw);\n        return { summary: this.boxplotBuilder(order, col, raw).next(Number.POSITIVE_INFINITY as any).value!, data };\n      },\n      raw ? ':braw' : ':b',\n      ranking && ranking.getOrderLength() === 0\n    );\n  }\n\n  private summaryCategoricalStatsD(col: Column & ICategoricalLikeColumn): {\n    summary: ICategoricalStatistics;\n    data: ICategoricalStatistics;\n  } {\n    const ranking = col.findMyRanker();\n    return this.cached(\n      'summary',\n      col,\n      () => {\n        const order = ranking ? ranking.getOrder() : [];\n        const data = this.dataCategoricalStats(col);\n        return {\n          summary: this.categoricalStatsBuilder(order, col).next(Number.POSITIVE_INFINITY as any).value!,\n          data,\n        };\n      },\n      '',\n      ranking && ranking.getOrderLength() === 0\n    );\n  }\n\n  private summaryDateStatsD(col: Column & IDateColumn): { summary: IDateStatistics; data: IDateStatistics } {\n    const ranking = col.findMyRanker();\n    return this.cached(\n      'summary',\n      col,\n      () => {\n        const order = ranking ? ranking.getOrder() : [];\n        const data = this.dataDateStats(col);\n        return {\n          summary: this.dateStatsBuilder(order, col, data).next(Number.POSITIVE_INFINITY as any).value!,\n          data,\n        };\n      },\n      '',\n      ranking && ranking.getOrderLength() === 0\n    );\n  }\n\n  private summaryStringStatsD(col: StringColumn): { summary: IStringStatistics; data: IStringStatistics } {\n    return this.cached(\n      'summary',\n      col,\n      () => {\n        const ranking = col.findMyRanker()!.getOrder();\n        const data = this.dataStringStats(col);\n        return {\n          summary: this.stringStatsBuilder(ranking, col, undefined).next(Number.POSITIVE_INFINITY as any).value!,\n          data,\n        };\n      },\n      '',\n      col.findMyRanker()!.getOrderLength() === 0\n    );\n  }\n\n  private cached<T>(prefix: string, col: Column, creator: () => T, suffix = '', dontCache = false): T {\n    const key = `${col.id}:${prefix}${suffix}`;\n    if (this.cache.has(key)) {\n      return this.cache.get(key)!;\n    }\n    const s = creator();\n    if (!dontCache) {\n      this.cache.set(key, s);\n    }\n    return s;\n  }\n\n  dataBoxPlotStats(col: Column & INumberColumn, raw?: boolean): IAdvancedBoxPlotData {\n    return this.cached(\n      'data',\n      col,\n      () => this.boxplotBuilder(null, col, raw).next(Number.POSITIVE_INFINITY as any).value!,\n      raw ? ':braw' : ':b'\n    );\n  }\n\n  dataNumberStats(col: Column & INumberColumn, raw?: boolean): IStatistics {\n    return this.cached(\n      'data',\n      col,\n      () =>\n        this.statsBuilder(null, col, getNumberOfBins(this.data.length), raw).next(Number.POSITIVE_INFINITY as any)\n          .value!,\n      raw ? ':raw' : ''\n    );\n  }\n\n  dataCategoricalStats(col: Column & ICategoricalLikeColumn): ICategoricalStatistics {\n    return this.cached(\n      'data',\n\n      col,\n\n      () => this.categoricalStatsBuilder(null, col).next(Number.POSITIVE_INFINITY as any).value!\n    );\n  }\n\n  dataDateStats(col: Column & IDateColumn): IDateStatistics {\n    return this.cached(\n      'data',\n      col,\n      () => this.dateStatsBuilder(null, col).next(Number.POSITIVE_INFINITY as any).value!\n    );\n  }\n\n  dataStringStats(col: StringColumn): IStringStatistics {\n    return this.cached(\n      'data',\n      col,\n      () => this.stringStatsBuilder(null, col).next(Number.POSITIVE_INFINITY as any).value!\n    );\n  }\n\n  terminate() {\n    this.cache.clear();\n  }\n}\n","import Column from './Column';\nimport type { IDataRow, IColumnDesc } from './interfaces';\n\nexport interface IArrayDesc {\n  dataLength?: number;\n  labels?: string[];\n}\n\nexport interface IKeyValue<T> {\n  key: string;\n  value: T;\n}\n\nexport interface IMapColumn<T> extends Column {\n  getMap(row: IDataRow): IKeyValue<T>[];\n\n  getMapLabel(row: IDataRow): IKeyValue<string>[];\n}\n\nexport function isMapColumn(col: Column): col is IMapColumn<any>;\nexport function isMapColumn(col: IColumnDesc): boolean;\nexport function isMapColumn(col: Column | IColumnDesc) {\n  return (\n    (col instanceof Column &&\n      typeof (col as IMapColumn<any>).getMap === 'function' &&\n      typeof (col as IMapColumn<any>).getMapLabel === 'function') ||\n    (!(col instanceof Column) && (col as IColumnDesc).type.endsWith('Map'))\n  );\n}\n\nexport interface IArrayColumn<T> extends IMapColumn<T> {\n  readonly labels: string[];\n  readonly dataLength: number | null;\n\n  getLabels(row: IDataRow): string[];\n\n  getValues(row: IDataRow): T[];\n}\n\nexport function isArrayColumn(col: Column): col is IArrayColumn<any>;\nexport function isArrayColumn(col: IColumnDesc): col is IArrayDesc & IColumnDesc;\nexport function isArrayColumn(col: Column | IColumnDesc) {\n  return (\n    (col instanceof Column &&\n      typeof (col as IArrayColumn<any>).getLabels === 'function' &&\n      typeof (col as IArrayColumn<any>).getValues === 'function' &&\n      isMapColumn(col)) ||\n    (!(col instanceof Column) && (col as IColumnDesc).type.endsWith('s') && (col as IColumnDesc).type !== 'actions')\n  );\n}\n","import type { IForEachAble } from '../internal';\nimport Column from './Column';\nimport { IArrayColumn, isArrayColumn } from './IArrayColumn';\nimport type { IValueColumnDesc, IColumnDesc, IDataRow, ITypedDump } from './interfaces';\n\nexport interface ICategoricalDesc {\n  categories?: (string | Partial<ICategory>)[];\n  /**\n   * @default given or name if not provided\n   */\n  categoryOrder?: 'given' | 'small-to-large' | 'large-to-small' | ((categories: readonly ICategory[]) => ICategory[]);\n}\n\nexport declare type ICategoricalColumnDesc = IValueColumnDesc<string> & ICategoricalDesc;\n\nexport interface ICategoricalColorMappingFunction {\n  apply(v: ICategory): string;\n\n  toJSON(): ITypedDump | null;\n\n  clone(): ICategoricalColorMappingFunction;\n\n  eq(other: ICategoricalColorMappingFunction): boolean;\n}\n\nexport interface ICategoricalColorMappingFunctionConstructor {\n  new (dump: ITypedDump): ICategoricalColorMappingFunction;\n}\n\nexport interface ICategoricalLikeColumn extends Column {\n  readonly categories: ICategory[];\n\n  getColorMapping(): ICategoricalColorMappingFunction;\n  setColorMapping(mapping: ICategoricalColorMappingFunction): void;\n\n  iterCategory(row: IDataRow): IForEachAble<ICategory | null>;\n\n  getCategories(row: IDataRow): (ICategory | null)[];\n}\n\nexport function isCategoricalLikeColumn(col: Column): col is ICategoricalLikeColumn {\n  return (\n    typeof (col as ICategoricalLikeColumn).categories !== 'undefined' &&\n    typeof (col as ICategoricalLikeColumn).iterCategory === 'function'\n  );\n}\n\nexport interface ISetColumn extends IArrayColumn<boolean>, ICategoricalLikeColumn {\n  getSet(row: IDataRow): Set<ICategory>;\n}\n\nexport function isSetColumn(col: Column): col is ISetColumn {\n  return isCategoricalLikeColumn(col) && typeof (col as ISetColumn).getSet === 'function';\n}\n\nexport interface ICategoricalColumn extends ISetColumn {\n  getCategory(row: IDataRow): ICategory | null;\n}\n\nexport interface ICategory {\n  readonly name: string;\n\n  /**\n   * optional label of this category (the one to render)\n   */\n  readonly label: string;\n  /**\n   * category color\n   * @default next in d3 color 10 range\n   */\n  readonly color: string;\n\n  value: number;\n}\n/**\n * checks whether the given column or description is a categorical column, i.e. the value is a list of categories\n * @param col\n * @returns {boolean}\n */\nexport function isCategoricalColumn(col: Column): col is ICategoricalColumn;\nexport function isCategoricalColumn(col: IColumnDesc): col is ICategoricalColumnDesc & IColumnDesc;\nexport function isCategoricalColumn(col: Column | IColumnDesc) {\n  return (\n    (col instanceof Column && typeof (col as ICategoricalColumn).getCategory === 'function') ||\n    (!(col instanceof Column) && (col as IColumnDesc).type.match(/(categorical|ordinal|hierarchy)/) != null)\n  );\n}\n\nexport declare type ICategoricalsColumn = ICategoricalLikeColumn & IArrayColumn<string | null>;\n\nexport function isCategoricalsColumn(col: Column): col is ICategoricalsColumn {\n  return isCategoricalLikeColumn(col) && isArrayColumn(col) && !isSetColumn(col);\n}\n\nexport interface ICategoricalFilter {\n  filter: string[] | string | RegExp;\n  filterMissing: boolean;\n}\n\nexport interface ISetCategoricalFilter extends ICategoricalFilter {\n  mode?: 'every' | 'some';\n}\n\nexport function isCategory(v: any): v is ICategory {\n  return (\n    typeof v.name === 'string' &&\n    typeof v.label === 'string' &&\n    typeof v.color === 'string' &&\n    typeof v.value === 'number'\n  );\n}\n","import type { IForEachAble } from '../internal';\nimport Column from './Column';\nimport type { IColumnDesc, IDataRow } from './interfaces';\nimport type { INumberFilter } from './INumberColumn';\nimport type { IArrayColumn } from './IArrayColumn';\n\nexport interface IDateColumn extends Column {\n  getFormatter(): (v: Date | null) => string;\n\n  getDate(row: IDataRow): Date | null;\n\n  iterDate(row: IDataRow): IForEachAble<Date | null>;\n\n  getFilter(): IDateFilter;\n  setFilter(value: IDateFilter | null): void;\n}\n\nexport interface IDatesColumn extends IDateColumn, IArrayColumn<Date | null> {\n  getDates(row: IDataRow): (Date | null)[];\n}\n\nexport interface IDateDesc {\n  /**\n   * d3 formatting option\n   * @default %x\n   */\n  dateFormat?: string;\n\n  /**\n   * d3 formation option\n   * @dfeault dateFormat\n   */\n  dateParse?: string;\n}\n\n/**\n * checks whether the given column or description is a date column, i.e. the value is a date\n * @param col\n * @returns {boolean}\n */\nexport function isDateColumn(col: Column): col is IDateColumn;\nexport function isDateColumn(col: IColumnDesc): col is IDateDesc & IColumnDesc;\nexport function isDateColumn(col: Column | IColumnDesc) {\n  return (\n    (col instanceof Column && typeof (col as IDateColumn).getDate === 'function') ||\n    (!(col instanceof Column) && (col as IColumnDesc).type.startsWith('date'))\n  );\n}\n\nexport function isDatesColumn(col: Column): col is IDatesColumn {\n  return typeof (col as IDatesColumn).getDates === 'function';\n}\n\nexport declare type IDateFilter = INumberFilter;\n\nexport declare type IDateGranularity =\n  | 'century'\n  | 'decade'\n  | 'year'\n  | 'month'\n  | 'week'\n  | 'day_of_week'\n  | 'day_of_month'\n  | 'day_of_year'\n  | 'hour'\n  | 'minute'\n  | 'second';\n\nexport interface IDateGrouper {\n  /**\n   * granularity level for the grouping\n   */\n  granularity: IDateGranularity;\n  /**\n   * whether circular occurrences should be in the same bin\n   * e.g. granularity = month\n   * circular: 01.2018 == 01.2017\n   * not circular: 01.2018 != 01.2017\n   */\n  circular: boolean;\n}\n","import { abortAble } from 'lineupengine';\nimport {\n  getNumberOfBins,\n  IAdvancedBoxPlotData,\n  ICategoricalStatistics,\n  IDateStatistics,\n  ISequence,\n  ISortMessageResponse,\n  IStatistics,\n  lazySeq,\n  toIndexArray,\n  WorkerTaskScheduler,\n  createWorkerBlob,\n  IStringStatistics,\n} from '../internal';\nimport TaskScheduler, { ABORTED, oneShotIterator } from '../internal/scheduler';\nimport Column, {\n  ICategoricalLikeColumn,\n  ICompareValue,\n  IDataRow,\n  IDateColumn,\n  IGroup,\n  IndicesArray,\n  INumberColumn,\n  IOrderedGroup,\n  isCategoricalLikeColumn,\n  isDateColumn,\n  isNumberColumn,\n  Ranking,\n  StringColumn,\n  UIntTypedArray,\n} from '../model';\nimport type { IRenderTask } from '../renderer';\nimport { sortDirect } from './DirectRenderTasks';\nimport type { CompareLookup } from './sort';\nimport { ARenderTasks, IRenderTaskExecutor, MultiIndices, taskLater, TaskLater, taskNow, TaskNow } from './tasks';\n\nexport class ScheduleRenderTasks extends ARenderTasks implements IRenderTaskExecutor {\n  private readonly cache = new Map<string, IRenderTask<any>>();\n  private readonly tasks = new TaskScheduler();\n  private readonly workers = new WorkerTaskScheduler(createWorkerBlob());\n\n  setData(data: IDataRow[]) {\n    this.data = data;\n    this.cache.clear();\n    this.tasks.clear();\n    this.valueCacheData.clear();\n    this.workers.deleteRefs();\n  }\n\n  dirtyColumn(col: Column, type: 'data' | 'group' | 'summary') {\n    super.dirtyColumn(col, type);\n    // order designed such that first groups, then summaries, then data is deleted\n\n    for (const key of Array.from(this.cache.keys()).sort()) {\n      // data = all\n      // summary = summary + group\n      // group = group only\n      if (\n        (type === 'data' && key.startsWith(`${col.id}:`)) ||\n        (type === 'summary' && key.startsWith(`${col.id}:b:summary:`)) ||\n        key.startsWith(`${col.id}:a:group`)\n      ) {\n        this.cache.delete(key);\n        this.tasks.abort(key);\n      }\n    }\n\n    if (type !== 'data') {\n      return;\n    }\n\n    this.valueCacheData.delete(col.id);\n    this.workers.deleteRef(col.id);\n  }\n\n  dirtyRanking(ranking: Ranking, type: 'data' | 'group' | 'summary') {\n    const cols = ranking.flatColumns;\n\n    let checker: ((key: string) => boolean)[];\n    switch (type) {\n      case 'group':\n        checker = cols.map((col) => (key: string) => key.startsWith(`${col.id}:a:group`));\n        break;\n      case 'summary':\n        checker = cols.map(\n          (col) => (key: string) => key.startsWith(`${col.id}:b:summary`) || key.startsWith(`${col.id}:a:group`)\n        );\n        break;\n      case 'data':\n      default:\n        checker = cols.map((col) => (key: string) => key.startsWith(`${col.id}:`));\n        break;\n    }\n    for (const key of Array.from(this.cache.keys()).sort()) {\n      if (checker.some((f) => f(key))) {\n        this.cache.delete(key);\n        this.tasks.abort(key);\n      }\n    }\n    // group compare tasks\n    this.tasks.abortAll((t) => t.id.startsWith(`r${ranking.id}:`));\n\n    // delete remote caches\n    this.workers.deleteRef(ranking.id, true);\n\n    if (type !== 'data') {\n      return;\n    }\n\n    for (const col of cols) {\n      super.dirtyColumn(col, type);\n      this.workers.deleteRef(col.id);\n    }\n  }\n\n  preCompute(ranking: Ranking, groups: { rows: IndicesArray; group: IGroup }[], maxDataIndex: number) {\n    if (groups.length === 0) {\n      return;\n    }\n    const cols = ranking.flatColumns;\n    if (groups.length === 1) {\n      const { group, rows } = groups[0];\n      const multi = new MultiIndices([rows], maxDataIndex);\n      for (const col of cols) {\n        if (isCategoricalLikeColumn(col)) {\n          this.summaryCategoricalStats(col, multi);\n        } else if (isNumberColumn(col)) {\n          this.summaryNumberStats(col, false, multi);\n          this.summaryNumberStats(col, true, multi);\n        } else if (isDateColumn(col)) {\n          this.summaryDateStats(col, multi);\n        } else if (col instanceof StringColumn) {\n          this.summaryStringStats(col, multi);\n        } else {\n          continue;\n        }\n        // copy from summary to group and create proper structure\n        this.chainCopy(\n          `${col.id}:a:group:${group.name}`,\n          this.cache.get(`${col.id}:b:summary`)!,\n          (v: { summary: any; data: any }) => ({ group: v.summary, summary: v.summary, data: v.data })\n        );\n        if (isNumberColumn(col)) {\n          this.chainCopy(\n            `${col.id}:a:group:${group.name}:raw`,\n            this.cache.get(`${col.id}:b:summary:raw`)!,\n            (v: { summary: any; data: any }) => ({ group: v.summary, summary: v.summary, data: v.data })\n          );\n        }\n      }\n      return;\n    }\n\n    const orderedGroups = groups.map(({ rows, group }) => Object.assign({ order: rows }, group));\n    const full = new MultiIndices(\n      groups.map((d) => d.rows),\n      maxDataIndex\n    );\n    for (const col of cols) {\n      if (isCategoricalLikeColumn(col)) {\n        this.summaryCategoricalStats(col, full);\n        for (const g of orderedGroups) {\n          this.groupCategoricalStats(col, g);\n        }\n      } else if (isDateColumn(col)) {\n        this.summaryDateStats(col, full);\n        for (const g of orderedGroups) {\n          this.groupDateStats(col, g);\n        }\n      } else if (isNumberColumn(col)) {\n        this.summaryNumberStats(col, false, full);\n        this.summaryNumberStats(col, true, full);\n        for (const g of orderedGroups) {\n          this.groupNumberStats(col, g, false);\n          this.groupNumberStats(col, g, true);\n        }\n      } else if (col instanceof StringColumn) {\n        this.summaryStringStats(col, full);\n        for (const g of orderedGroups) {\n          this.groupStringStats(col, g);\n        }\n      }\n    }\n  }\n\n  preComputeData(ranking: Ranking) {\n    for (const col of ranking.flatColumns) {\n      if (isCategoricalLikeColumn(col)) {\n        this.dataCategoricalStats(col);\n      } else if (isNumberColumn(col)) {\n        this.dataNumberStats(col, false);\n        this.dataNumberStats(col, true);\n      } else if (isDateColumn(col)) {\n        this.dataDateStats(col);\n      } else if (col instanceof StringColumn) {\n        this.dataStringStats(col);\n      }\n    }\n  }\n\n  preComputeCol(col: Column) {\n    const ranking = col.findMyRanker();\n\n    if (col instanceof StringColumn) {\n      this.dataStringStats(col);\n      if (!ranking) {\n        return;\n      }\n      this.summaryStringStats(col);\n      for (const group of ranking.getGroups()) {\n        this.groupStringStats(col, group);\n      }\n      return;\n    }\n\n    if (isCategoricalLikeColumn(col)) {\n      this.dataCategoricalStats(col);\n      if (!ranking) {\n        return;\n      }\n      this.summaryCategoricalStats(col);\n      for (const group of ranking.getGroups()) {\n        this.groupCategoricalStats(col, group);\n      }\n      return;\n    }\n\n    if (isNumberColumn(col)) {\n      this.dataNumberStats(col, false);\n      this.dataNumberStats(col, true);\n\n      if (!ranking) {\n        return;\n      }\n      this.summaryNumberStats(col, false);\n      this.summaryNumberStats(col, true);\n      for (const group of ranking.getGroups()) {\n        this.groupNumberStats(col, group, false);\n        this.groupNumberStats(col, group, true);\n      }\n      return;\n    }\n\n    if (!isDateColumn(col)) {\n      return;\n    }\n\n    this.dataDateStats(col);\n\n    if (!ranking) {\n      return;\n    }\n    this.summaryDateStats(col);\n    for (const group of ranking.getGroups()) {\n      this.groupDateStats(col, group);\n    }\n  }\n\n  copyData2Summary(ranking: Ranking) {\n    for (const col of ranking.flatColumns) {\n      if (isCategoricalLikeColumn(col)) {\n        this.dataCategoricalStats(col);\n      } else if (isNumberColumn(col)) {\n        this.dataNumberStats(col, false);\n        this.dataNumberStats(col, true);\n      } else if (isDateColumn(col)) {\n        this.dataDateStats(col);\n      } else if (col instanceof StringColumn) {\n        this.dataStringStats(col);\n      } else {\n        continue;\n      }\n      // copy from data to summary and create proper structure\n      this.chainCopy(`${col.id}:b:summary`, this.cache.get(`${col.id}:c:data`)!, (data: any) => ({\n        summary: data,\n        data,\n      }));\n      if (isNumberColumn(col)) {\n        this.chainCopy(`${col.id}:b:summary:raw`, this.cache.get(`${col.id}:c:data:raw`)!, (data: any) => ({\n          summary: data,\n          data,\n        }));\n      }\n    }\n  }\n\n  copyCache(col: Column, from: Column) {\n    const fromPrefix = `${from.id}:`;\n\n    for (const key of Array.from(this.cache.keys()).sort()) {\n      if (!key.startsWith(fromPrefix)) {\n        continue;\n      }\n      const chainKey = `${col.id}:${key.slice(fromPrefix.length)}`;\n      this.chainCopy(chainKey, this.cache.get(key)!, (data: any) => data);\n    }\n  }\n\n  groupCompare(ranking: Ranking, group: IGroup, rows: IndicesArray) {\n    return taskLater(\n      this.tasks.push(`r${ranking.id}:${group.name}`, () => {\n        const rg = ranking.getGroupSortCriteria();\n        if (rg.length === 0) {\n          return [group.name.toLowerCase()];\n        }\n        const o = this.byOrder(rows);\n        const vs: ICompareValue[] = [];\n        for (const s of rg) {\n          const cache = this.valueCache(s.col);\n          const r = s.col.toCompareGroupValue(o, group, cache ? lazySeq(rows).map((d) => cache(d)) : undefined);\n          if (Array.isArray(r)) {\n            vs.push(...r);\n          } else {\n            vs.push(r);\n          }\n        }\n        vs.push(group.name.toLowerCase());\n        return vs;\n      })\n    );\n  }\n\n  groupRows<T>(col: Column, group: IOrderedGroup, key: string, compute: (rows: ISequence<IDataRow>) => T) {\n    return this.cached(\n      `${col.id}:a:group:${group.name}:${key}`,\n      true,\n      oneShotIterator(() => compute(this.byOrder(group.order)))\n    );\n  }\n\n  groupExampleRows<T>(_col: Column, group: IOrderedGroup, _key: string, compute: (rows: ISequence<IDataRow>) => T) {\n    return taskNow(compute(this.byOrder(group.order.slice(0, 5))));\n  }\n\n  groupBoxPlotStats(col: Column & INumberColumn, group: IOrderedGroup, raw?: boolean) {\n    return this.chain(\n      `${col.id}:a:group:${group.name}${raw ? ':braw' : ':b'}`,\n      this.summaryBoxPlotStats(col, raw),\n      ({ summary, data }) => {\n        const ranking = col.findMyRanker()!;\n        const key = raw ? `${col.id}:r` : col.id;\n        if (this.valueCacheData.has(key) && group.order.length > 0) {\n          // web worker version\n          return () =>\n            this.workers\n              .pushStats(\n                'boxplotStats',\n                {},\n                key,\n                this.valueCacheData.get(key) as Float64Array,\n                `${ranking.id}:${group.name}`,\n                group.order\n              )\n              .then((group) => ({ group, summary, data }));\n        }\n        return this.boxplotBuilder(group.order, col, raw, (group) => ({ group, summary, data }));\n      }\n    );\n  }\n\n  groupNumberStats(col: Column & INumberColumn, group: IOrderedGroup, raw?: boolean) {\n    return this.chain(\n      `${col.id}:a:group:${group.name}${raw ? ':raw' : ''}`,\n      this.summaryNumberStats(col, raw),\n      ({ summary, data }) => {\n        const ranking = col.findMyRanker()!;\n        const key = raw ? `${col.id}:r` : col.id;\n        if (this.valueCacheData.has(key) && group.order.length > 0) {\n          // web worker version\n          return () =>\n            this.workers\n              .pushStats(\n                'numberStats',\n                { numberOfBins: summary.hist.length, domain: this.resolveDomain(col, raw) },\n                key,\n                this.valueCacheData.get(key) as Float64Array,\n                `${ranking.id}:${group.name}`,\n                group.order\n              )\n              .then((group) => ({ group, summary, data }));\n        }\n        return this.statsBuilder(group.order, col, summary.hist.length, raw, (group) => ({\n          group,\n          summary,\n          data,\n        }));\n      }\n    );\n  }\n\n  groupCategoricalStats(col: Column & ICategoricalLikeColumn, group: IOrderedGroup) {\n    return this.chain(`${col.id}:a:group:${group.name}`, this.summaryCategoricalStats(col), ({ summary, data }) => {\n      const ranking = col.findMyRanker()!;\n      if (this.valueCacheData.has(col.id) && group.order.length > 0) {\n        // web worker version\n        return () =>\n          this.workers\n            .pushStats(\n              'categoricalStats',\n              { categories: col.categories.map((d) => d.name) },\n              col.id,\n              this.valueCacheData.get(col.id) as UIntTypedArray,\n              `${ranking.id}:${group.name}`,\n              group.order\n            )\n            .then((group) => ({ group, summary, data }));\n      }\n      return this.categoricalStatsBuilder(group.order, col, (group) => ({ group, summary, data }));\n    });\n  }\n\n  groupDateStats(col: Column & IDateColumn, group: IOrderedGroup) {\n    const key = `${col.id}:a:group:${group.name}`;\n    return this.chain(key, this.summaryDateStats(col), ({ summary, data }) => {\n      const ranking = col.findMyRanker()!;\n      if (this.valueCacheData.has(col.id) && group.order.length > 0) {\n        // web worker version\n        return () =>\n          this.workers\n            .pushStats(\n              'dateStats',\n              { template: summary },\n              col.id,\n              this.valueCacheData.get(col.id) as Float64Array,\n              `${ranking.id}:${group.name}`,\n              group.order\n            )\n            .then((group) => ({ group, summary, data }));\n      }\n      return this.dateStatsBuilder(group.order, col, summary, (group) => ({ group, summary, data }));\n    });\n  }\n\n  groupStringStats(col: StringColumn, group: IOrderedGroup) {\n    const key = `${col.id}:a:group:${group.name}`;\n    return this.chain(key, this.summaryStringStats(col), ({ summary, data }) => {\n      const ranking = col.findMyRanker()!;\n      const topN = summary.topN.map((d) => d.value);\n      if (this.valueCacheData.has(col.id) && group.order.length > 0) {\n        // web worker version\n        return () =>\n          this.workers\n            .pushStats(\n              'stringStats',\n              { topN: this.options.stringTopNCount },\n              col.id,\n              this.valueCacheData.get(col.id) as readonly string[],\n              `${ranking.id}:${group.name}`,\n              group.order\n            )\n            .then((group) => ({ group, summary, data }));\n      }\n      return this.stringStatsBuilder(group.order, col, topN, (group) => ({ group, summary, data }));\n    });\n  }\n\n  summaryBoxPlotStats(col: Column & INumberColumn, raw?: boolean, order?: MultiIndices) {\n    return this.chain(`${col.id}:b:summary${raw ? ':braw' : ':b'}`, this.dataBoxPlotStats(col, raw), (data) => {\n      const ranking = col.findMyRanker()!;\n      const key = raw ? `${col.id}:r` : col.id;\n      if (this.valueCacheData.has(key)) {\n        // web worker version\n        return () =>\n          this.workers\n            .pushStats(\n              'boxplotStats',\n              {},\n              key,\n              this.valueCacheData.get(key) as Float64Array,\n              ranking.id,\n              order ? order.joined : ranking.getOrder()\n            )\n            .then((summary) => ({ summary, data }));\n      }\n      return this.boxplotBuilder(order ? order : ranking.getOrder(), col, raw, (summary) => ({ summary, data }));\n    });\n  }\n\n  summaryNumberStats(col: Column & INumberColumn, raw?: boolean, order?: MultiIndices) {\n    return this.chain(`${col.id}:b:summary${raw ? ':raw' : ''}`, this.dataNumberStats(col, raw), (data) => {\n      const ranking = col.findMyRanker()!;\n      const key = raw ? `${col.id}:r` : col.id;\n      if (this.valueCacheData.has(key)) {\n        // web worker version\n        return () =>\n          this.workers\n            .pushStats(\n              'numberStats',\n              { numberOfBins: data.hist.length, domain: this.resolveDomain(col, raw) },\n              key,\n              this.valueCacheData.get(key) as Float64Array,\n              ranking.id,\n              order ? order.joined : ranking.getOrder()\n            )\n            .then((summary) => ({ summary, data }));\n      }\n      return this.statsBuilder(order ? order : ranking.getOrder(), col, data.hist.length, raw, (summary) => ({\n        summary,\n        data,\n      }));\n    });\n  }\n\n  summaryCategoricalStats(col: Column & ICategoricalLikeColumn, order?: MultiIndices) {\n    return this.chain(`${col.id}:b:summary`, this.dataCategoricalStats(col), (data) => {\n      const ranking = col.findMyRanker()!;\n      if (this.valueCacheData.has(col.id)) {\n        // web worker version\n        return () =>\n          this.workers\n            .pushStats(\n              'categoricalStats',\n              { categories: col.categories.map((d) => d.name) },\n              col.id,\n              this.valueCacheData.get(col.id) as UIntTypedArray,\n              ranking.id,\n              order ? order.joined : ranking.getOrder()\n            )\n            .then((summary) => ({ summary, data }));\n      }\n      return this.categoricalStatsBuilder(order ? order : ranking.getOrder(), col, (summary) => ({ summary, data }));\n    });\n  }\n\n  summaryDateStats(col: Column & IDateColumn, order?: MultiIndices) {\n    return this.chain(`${col.id}:b:summary`, this.dataDateStats(col), (data) => {\n      const ranking = col.findMyRanker()!;\n      if (this.valueCacheData.has(col.id)) {\n        // web worker version\n        return () =>\n          this.workers\n            .pushStats(\n              'dateStats',\n              { template: data },\n              col.id,\n              this.valueCacheData.get(col.id) as Float64Array,\n              ranking.id,\n              order ? order.joined : ranking.getOrder()\n            )\n            .then((summary) => ({ summary, data }));\n      }\n      return this.dateStatsBuilder(order ? order : ranking.getOrder(), col, data, (summary) => ({ summary, data }));\n    });\n  }\n\n  summaryStringStats(col: StringColumn, order?: MultiIndices) {\n    return this.chain(`${col.id}:b:summary`, this.dataStringStats(col), (data) => {\n      const ranking = col.findMyRanker()!;\n      if (this.valueCacheData.has(col.id)) {\n        // web worker version\n        return () =>\n          this.workers\n            .pushStats(\n              'stringStats',\n              { topN: this.options.stringTopNCount },\n              col.id,\n              this.valueCacheData.get(col.id) as readonly string[],\n              ranking.id,\n              order ? order.joined : ranking.getOrder()\n            )\n            .then((summary) => ({ summary, data }));\n      }\n      return this.stringStatsBuilder(order ? order : ranking.getOrder(), col, undefined, (summary) => ({\n        summary,\n        data,\n      }));\n    });\n  }\n\n  private cached<T>(key: string, canAbort: boolean, it: Iterator<T | null> | (() => Promise<T>)): IRenderTask<T> {\n    const dontCache = this.data.length === 0;\n\n    if (this.isValidCacheEntry(key) && !dontCache) {\n      return this.cache.get(key)!;\n    }\n\n    const task = typeof it === 'function' ? abortAble(it()) : this.tasks.pushMulti(key, it, canAbort);\n    const s = taskLater(task);\n    if (!dontCache) {\n      this.cache.set(key, s);\n    }\n    task.then((r) => {\n      if (this.cache.get(key) !== s) {\n        return;\n      }\n      if (typeof r === 'symbol') {\n        this.cache.delete(key);\n      } else {\n        this.cache.set(key, taskNow(r));\n      }\n    });\n    return s;\n  }\n\n  private chain<T, U>(\n    key: string,\n    task: IRenderTask<T>,\n    creator: (data: T) => Iterator<U | null> | (() => Promise<U>)\n  ): IRenderTask<U> {\n    if (this.isValidCacheEntry(key)) {\n      return this.cache.get(key)!;\n    }\n    if (task instanceof TaskNow) {\n      if (typeof task.v === 'symbol') {\n        // aborted\n        return taskNow(ABORTED);\n      }\n      return this.cached(key, true, creator(task.v));\n    }\n\n    const v = (task as TaskLater<T>).v;\n    const subTask = v.then((data) => {\n      if (typeof data === 'symbol') {\n        return ABORTED;\n      }\n      const created = creator(data);\n      if (typeof created === 'function') {\n        // promise\n        return created();\n      }\n      return this.tasks.pushMulti(key, created);\n    });\n    const s = taskLater(subTask);\n    this.cache.set(key, s);\n    subTask.then((r) => {\n      if (this.cache.get(key) !== s) {\n        return;\n      }\n      if (typeof r === 'symbol') {\n        this.cache.delete(key);\n      } else {\n        this.cache.set(key, taskNow(r));\n      }\n    });\n    return s;\n  }\n\n  private isValidCacheEntry(key: string) {\n    if (!this.cache.has(key)) {\n      return false;\n    }\n    const v = this.cache.get(key);\n    // not an aborted task\n    return !(v instanceof TaskNow && typeof v.v === 'symbol') && !(v instanceof TaskLater && v.v.isAborted());\n  }\n\n  private chainCopy<T, U>(key: string, task: IRenderTask<T>, creator: (data: T) => U): IRenderTask<U> {\n    if (this.isValidCacheEntry(key)) {\n      return this.cache.get(key)!;\n    }\n    if (task instanceof TaskNow) {\n      if (typeof task.v === 'symbol') {\n        // aborted\n        return taskNow(ABORTED);\n      }\n      const subTask = taskNow(creator(task.v));\n      this.cache.set(key, subTask);\n      return subTask;\n    }\n\n    const v = (task as TaskLater<T>).v;\n    const subTask = v.then((data) => {\n      if (typeof data === 'symbol') {\n        return ABORTED;\n      }\n      return creator(data);\n    });\n    const s = taskLater(subTask);\n    this.cache.set(key, s);\n    subTask.then((r) => {\n      if (this.cache.get(key) !== s) {\n        return;\n      }\n      if (typeof r === 'symbol') {\n        this.cache.delete(key);\n      } else {\n        this.cache.set(key, taskNow(r));\n      }\n    });\n    return s;\n  }\n\n  dataBoxPlotStats(col: Column & INumberColumn, raw?: boolean) {\n    const key = `${col.id}:c:data${raw ? ':braw' : ':b'}`;\n    const valueCacheKey = raw ? `${col.id}:r` : col.id;\n    if (this.valueCacheData.has(valueCacheKey) && this.data.length > 0) {\n      // use webworker\n      return this.cached(key, false, () =>\n        this.workers.pushStats(\n          'boxplotStats',\n          {},\n          valueCacheKey,\n          this.valueCacheData.get(valueCacheKey)! as Float64Array\n        )\n      );\n    }\n    return this.cached(key, false, this.boxplotBuilder<IAdvancedBoxPlotData>(null, col, raw));\n  }\n\n  dataNumberStats(col: Column & INumberColumn, raw?: boolean) {\n    return this.cached(\n      `${col.id}:c:data${raw ? ':raw' : ''}`,\n      false,\n      this.statsBuilder<IStatistics>(null, col, getNumberOfBins(this.data.length), raw)\n    );\n  }\n\n  dataCategoricalStats(col: Column & ICategoricalLikeColumn) {\n    return this.cached(`${col.id}:c:data`, false, this.categoricalStatsBuilder<ICategoricalStatistics>(null, col));\n  }\n\n  dataStringStats(col: StringColumn) {\n    return this.cached(`${col.id}:c:data`, false, this.stringStatsBuilder<IStringStatistics>(null, col));\n  }\n\n  dataDateStats(col: Column & IDateColumn) {\n    return this.cached(`${col.id}:c:data`, false, this.dateStatsBuilder<IDateStatistics>(null, col));\n  }\n\n  sort(\n    ranking: Ranking,\n    group: IGroup,\n    indices: IndicesArray,\n    singleCall: boolean,\n    maxDataIndex: number,\n    lookups?: CompareLookup\n  ) {\n    if (!lookups || indices.length < 1000) {\n      // no thread needed\n      const order = sortDirect(indices, maxDataIndex, lookups);\n      return Promise.resolve(order);\n    }\n\n    const indexArray = toIndexArray(indices, maxDataIndex);\n    const toTransfer = [indexArray.buffer];\n\n    if (singleCall) {\n      // can transfer otherwise need to copy\n      toTransfer.push(...lookups.transferAbles);\n    }\n\n    return this.workers.push(\n      'sort',\n      {\n        ref: `${ranking.id}:${group.name}`,\n        indices: indexArray,\n        sortOrders: lookups.sortOrders,\n      },\n      toTransfer,\n      (r: ISortMessageResponse) => r.order\n    );\n  }\n\n  terminate() {\n    this.workers.terminate();\n    this.cache.clear();\n    this.valueCacheData.clear();\n  }\n}\n","import { createIndexArray, sortComplex, ISequence, lazySeq, IEventContext } from '../internal';\nimport {\n  Column,\n  EDirtyReason,\n  Ranking,\n  defaultGroup,\n  IColumnDesc,\n  ICompareValue,\n  IDataRow,\n  IGroup,\n  IndicesArray,\n  INumberColumn,\n  IOrderedGroup,\n  CompositeColumn,\n  ValueColumn,\n} from '../model';\nimport ACommonDataProvider from './ACommonDataProvider';\nimport ADataProvider from './ADataProvider';\nimport type { IDataProviderOptions } from './interfaces';\nimport { CompareLookup } from './sort';\nimport type { ARenderTaskOptions, IRenderTaskExecutor } from './tasks';\nimport { DirectRenderTasks } from './DirectRenderTasks';\nimport { ScheduleRenderTasks } from './ScheduledTasks';\nimport { joinGroups, mapIndices, duplicateGroup } from '../model/internal';\n\nexport interface ILocalDataProviderOptions extends ARenderTaskOptions {\n  /**\n   * whether the filter should be applied to all rankings regardless where they are\n   * default: false\n   */\n  filterGlobally: boolean;\n  /**\n   * jump to search results such that they are visible\n   * default: false\n   */\n  jumpToSearchResult: boolean;\n\n  /**\n   * specify the task executor to use direct = no delay, scheduled = run when idle\n   */\n  taskExecutor: 'direct' | 'scheduled';\n}\n\ninterface ISortHelper {\n  group: IGroup;\n  rows: IndicesArray;\n}\n\n/**\n * a data provider based on an local array\n */\nexport default class LocalDataProvider extends ACommonDataProvider {\n  private readonly ooptions: ILocalDataProviderOptions = {\n    /**\n     * whether the filter should be applied to all rankings regardless where they are\n     */\n    filterGlobally: false,\n\n    jumpToSearchResult: false,\n\n    taskExecutor: 'direct',\n\n    stringTopNCount: 10,\n  };\n\n  private readonly reorderAll: () => void;\n\n  private _dataRows: IDataRow[];\n  private filter: ((row: IDataRow) => boolean) | null = null;\n  private readonly tasks: IRenderTaskExecutor;\n\n  constructor(\n    private _data: any[],\n    columns: IColumnDesc[] = [],\n    options: Partial<ILocalDataProviderOptions & IDataProviderOptions> = {}\n  ) {\n    super(columns, options);\n    Object.assign(this.ooptions, options);\n    this._dataRows = toRows(_data);\n    this.tasks =\n      this.ooptions.taskExecutor === 'direct'\n        ? new DirectRenderTasks(this.ooptions)\n        : new ScheduleRenderTasks(this.ooptions);\n    this.tasks.setData(this._dataRows);\n\n    for (const ranking of this.getRankings()) {\n      for (const col of ranking.flatColumns) {\n        if (col instanceof ValueColumn) {\n          col.onDataUpdate(this._dataRows);\n        }\n      }\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    this.reorderAll = function (this: { source?: Ranking; type: string }) {\n      //fire for all other rankings a dirty order event, too\n      const ranking = this.source;\n      const type = this.type;\n      for (const r of that.getRankings()) {\n        if (r !== ranking) {\n          r.dirtyOrder(type === Ranking.EVENT_FILTER_CHANGED ? [EDirtyReason.FILTER_CHANGED] : [EDirtyReason.UNKNOWN]);\n        }\n      }\n    };\n  }\n\n  /**\n   * set a globally applied filter to all data without changing the data source itself\n   * @param {((row: IDataRow) => boolean) | null} filter\n   */\n  setFilter(filter: ((row: IDataRow) => boolean) | null) {\n    this.filter = filter;\n    this.reorderAll.call({ type: Ranking.EVENT_FILTER_CHANGED });\n  }\n\n  getFilter() {\n    return this.filter;\n  }\n\n  getTotalNumberOfRows() {\n    return this.data.length;\n  }\n\n  getTaskExecutor() {\n    return this.tasks;\n  }\n\n  get data() {\n    return this._data;\n  }\n\n  destroy() {\n    super.destroy();\n    this.tasks.terminate();\n  }\n\n  /**\n   * replaces the dataset rows with a new one\n   * @param data\n   */\n  setData(data: any[]) {\n    this._data = data;\n    this._dataRows = toRows(data);\n    this.dataChanged();\n  }\n\n  private dataChanged() {\n    this.tasks.setData(this._dataRows);\n\n    for (const ranking of this.getRankings()) {\n      for (const col of ranking.flatColumns) {\n        if (col instanceof ValueColumn && col.isLoaded()) {\n          col.onDataUpdate(this._dataRows);\n        }\n      }\n      // since it uses normalized data\n      this.tasks.preComputeData(ranking);\n    }\n\n    this.fire(ADataProvider.EVENT_DATA_CHANGED, this._dataRows);\n    this.reorderAll.call({ type: 'data' });\n  }\n\n  clearData() {\n    this.setData([]);\n  }\n\n  /**\n   * append rows to the dataset\n   * @param data\n   */\n  appendData(data: any[]) {\n    for (const d of data) {\n      this._data.push(d);\n      this._dataRows.push({ v: d, i: this._dataRows.length });\n    }\n    this.dataChanged();\n  }\n\n  cloneRanking(existing?: Ranking) {\n    const ranking = super.cloneRanking(existing);\n\n    if (this.ooptions.filterGlobally) {\n      ranking.on(`${Ranking.EVENT_FILTER_CHANGED}.reorderAll`, this.reorderAll);\n    }\n\n    this.trackRanking(ranking, existing);\n    return ranking;\n  }\n\n  private trackRanking(ranking: Ranking, existing?: Ranking) {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    ranking.on(`${Column.EVENT_DIRTY_CACHES}.cache`, function (this: IEventContext) {\n      let col: any = this.origin;\n      while (col instanceof Column) {\n        // console.log(col.label, 'dirty data');\n        that.tasks.dirtyColumn(col, 'data');\n        that.tasks.preComputeCol(col);\n        col = col.parent;\n      }\n    });\n\n    const cols = ranking.flatColumns;\n    const addKey = `${Ranking.EVENT_ADD_COLUMN}.cache`;\n    const removeKey = `${Ranking.EVENT_REMOVE_COLUMN}.cache`;\n    const loadedKey = `${ValueColumn.EVENT_DATA_LOADED}.cache`;\n\n    const removeCol = (col: Column) => {\n      this.tasks.dirtyColumn(col, 'data');\n      if (col instanceof CompositeColumn) {\n        col.on(addKey, null);\n        col.on(removeKey, null);\n      }\n      if (col instanceof ValueColumn) {\n        col.on(loadedKey, null);\n      }\n    };\n\n    const addCol = (col: Column) => {\n      this.tasks.preComputeCol(col);\n      if (col instanceof CompositeColumn) {\n        col.on(addKey, addCol);\n        col.on(removeKey, removeCol);\n      }\n      if (col instanceof ValueColumn) {\n        col.on(loadedKey, dataLoaded);\n      }\n    };\n\n    function dataLoaded(this: IEventContext, _, loaded: boolean) {\n      if (!loaded) {\n        return;\n      }\n      if (this.origin instanceof ValueColumn) {\n        this.origin.onDataUpdate(that._dataRows);\n      }\n    }\n\n    ranking.on(addKey, addCol);\n    ranking.on(removeKey, removeCol);\n    for (const col of cols) {\n      if (col instanceof CompositeColumn) {\n        col.on(addKey, addCol);\n        col.on(removeKey, removeCol);\n      }\n      if (col instanceof ValueColumn) {\n        col.on(loadedKey, dataLoaded);\n      }\n    }\n\n    if (existing) {\n      const copy = existing.flatColumns;\n      for (let i = 0; i < cols.length; ++i) {\n        this.tasks.copyCache(cols[i], copy[i]);\n      }\n    }\n\n    this.tasks.preComputeData(ranking);\n  }\n\n  protected patchColumn(column: Column): Column {\n    const c = super.patchColumn(column);\n    if (c instanceof ValueColumn && c.isLoaded()) {\n      c.onDataUpdate(this._dataRows);\n    }\n    return c;\n  }\n\n  cleanUpRanking(ranking: Ranking) {\n    if (this.ooptions.filterGlobally) {\n      ranking.on(`${Ranking.EVENT_FILTER_CHANGED}.reorderAll`, null);\n    }\n\n    const cols = ranking.flatColumns;\n    const addKey = `${Ranking.EVENT_ADD_COLUMN}.cache`;\n    const removeKey = `${Ranking.EVENT_REMOVE_COLUMN}.cache`;\n    ranking.on(addKey, null);\n    ranking.on(removeKey, null);\n    for (const col of cols) {\n      if (col instanceof CompositeColumn) {\n        col.on(addKey, null);\n        col.on(removeKey, null);\n      }\n    }\n\n    this.tasks.dirtyRanking(ranking, 'data');\n\n    super.cleanUpRanking(ranking);\n  }\n\n  private resolveFilter(ranking: Ranking) {\n    //do the optional filtering step\n    const filter: (Column | ((d: IDataRow) => boolean))[] = [];\n\n    if (this.ooptions.filterGlobally) {\n      for (const r of this.getRankings()) {\n        if (r.isFiltered()) {\n          filter.push(...r.flatColumns.filter((d) => d.isFiltered()));\n        }\n      }\n    } else if (ranking.isFiltered()) {\n      filter.push(...ranking.flatColumns.filter((d) => d.isFiltered()));\n    }\n\n    if (this.filter) {\n      filter.push(this.filter);\n    }\n    return filter;\n  }\n\n  private noSorting(ranking: Ranking) {\n    // initial no sorting required just index mapping\n    const l = this._data.length;\n    const order = createIndexArray(l, l - 1);\n    const index2pos = order.slice();\n    for (let i = 0; i < l; ++i) {\n      order[i] = i;\n      index2pos[i] = i + 1; // shift since default is 0\n    }\n\n    this.tasks.preCompute(ranking, [{ rows: order, group: defaultGroup }], l - 1);\n    return { groups: [Object.assign({ order }, defaultGroup)], index2pos };\n  }\n\n  private createSorter(\n    ranking: Ranking,\n    filter: (Column | ((d: IDataRow) => boolean))[],\n    needsFiltering: boolean,\n    needsGrouping: boolean,\n    needsSorting: boolean\n  ) {\n    const groups = new Map<string, ISortHelper>();\n    const groupOrder: ISortHelper[] = [];\n    let maxDataIndex = -1;\n\n    const groupCriteria = ranking.getGroupCriteria();\n    const lookups = needsSorting\n      ? new CompareLookup(this._data.length, true, ranking, this.tasks.valueCache.bind(this.tasks))\n      : undefined;\n\n    const pushGroup = (group: IGroup, r: IDataRow) => {\n      const groupKey = group.name.toLowerCase();\n      if (groups.has(groupKey)) {\n        (groups.get(groupKey)!.rows as number[]).push(r.i);\n        return;\n      }\n      const s = { group, rows: [r.i] };\n      groups.set(groupKey, s);\n      groupOrder.push(s);\n    };\n\n    const groupCaches = groupCriteria.map((c) => this.tasks.valueCache(c));\n    const filterCaches = filter.map((c) => (typeof c === 'function' ? undefined : this.tasks.valueCache(c)));\n\n    const toGroup =\n      groupCriteria.length === 1\n        ? (r: IDataRow) => joinGroups([groupCriteria[0].group(r, groupCaches[0] ? groupCaches[0]!(r.i) : undefined)])\n        : (r: IDataRow) =>\n            joinGroups(groupCriteria.map((c, i) => c.group(r, groupCaches[i] ? groupCaches[i]!(r.i) : undefined)));\n\n    if (needsFiltering) {\n      // filter, group, sort\n      outer: for (const r of this._dataRows) {\n        for (let f = 0; f < filter.length; ++f) {\n          const fc = filter[f];\n          const c = filterCaches[f];\n          if ((typeof fc === 'function' && !fc(r)) || (fc instanceof Column && !fc.filter(r, c ? c(r.i) : undefined))) {\n            continue outer;\n          }\n        }\n        if (maxDataIndex < r.i) {\n          maxDataIndex = r.i;\n        }\n        if (lookups) {\n          lookups.push(r);\n        }\n        pushGroup(toGroup(r), r);\n      }\n\n      // some default sorting\n      groupOrder.sort((a, b) => a.group.name.toLowerCase().localeCompare(b.group.name.toLowerCase()));\n      return { maxDataIndex, lookups, groupOrder };\n    }\n\n    // reuse the existing groups\n\n    for (const before of ranking.getGroups()) {\n      const order = before.order;\n      if (!needsGrouping) {\n        const clone = duplicateGroup(before);\n        // reuse in full\n        groupOrder.push({ group: clone, rows: order });\n\n        if (!lookups) {\n          maxDataIndex = (order as readonly number[]).reduce((a, b) => Math.max(a, b), maxDataIndex);\n          continue;\n        }\n        // sort\n        for (let o = 0; o < order.length; ++o) {\n          const i = order[o];\n          if (maxDataIndex < i) {\n            maxDataIndex = i;\n          }\n          lookups.push(this._dataRows[i]);\n        }\n        continue;\n      }\n\n      // group, [sort]\n      for (let o = 0; o < order.length; ++o) {\n        const i = order[o];\n        if (maxDataIndex < i) {\n          maxDataIndex = i;\n        }\n        const r = this._dataRows[i];\n        if (lookups) {\n          lookups.push(r);\n        }\n        pushGroup(toGroup(r), r);\n      }\n    }\n\n    if (needsGrouping) {\n      // some default sorting\n      groupOrder.sort((a, b) => a.group.name.toLowerCase().localeCompare(b.group.name.toLowerCase()));\n    }\n    return { maxDataIndex, lookups, groupOrder };\n  }\n\n  private sortGroup(\n    g: ISortHelper,\n    i: number,\n    ranking: Ranking,\n    lookups: CompareLookup | undefined,\n    groupLookup: CompareLookup | undefined,\n    singleGroup: boolean,\n    maxDataIndex: number\n  ): Promise<IOrderedGroup> {\n    const group = g.group;\n\n    const sortTask = this.tasks.sort(ranking, group, g.rows, singleGroup, maxDataIndex, lookups);\n\n    // compute sort group value as task\n    const groupSortTask = groupLookup\n      ? this.tasks.groupCompare(ranking, group, g.rows).then((r) => r)\n      : ([] as ICompareValue[]);\n\n    // trigger task for groups to compute for this group\n\n    return Promise.all([sortTask, groupSortTask]).then(([order, groupC]) => {\n      if (groupLookup && Array.isArray(groupC)) {\n        groupLookup.pushValues(i, groupC);\n      }\n      return Object.assign(group, { order });\n    });\n  }\n\n  private sortGroups(groups: IOrderedGroup[], groupLookup: CompareLookup | undefined, enforceSorting: boolean) {\n    // sort groups\n    if (groupLookup) {\n      const groupIndices = groups.map((_, i) => i);\n      sortComplex(groupIndices, groupLookup.sortOrders);\n      return groupIndices.map((i) => groups[i]);\n    }\n    if (enforceSorting) {\n      // create a default sorting\n      return groups.sort((a, b) => a.name.localeCompare(b.name));\n    }\n    return groups;\n  }\n\n  private index2pos(groups: IOrderedGroup[], maxDataIndex: number) {\n    const total = groups.reduce((a, b) => a + b.order.length, 1);\n    const index2pos = createIndexArray(maxDataIndex + 1, total);\n    let offset = 1;\n    for (const g of groups) {\n      // tslint:disable-next-line\n      for (let i = 0; i < g.order.length; i++, offset++) {\n        index2pos[g.order[i]] = offset;\n      }\n    }\n\n    return { groups, index2pos };\n  }\n\n  sort(ranking: Ranking, dirtyReason: EDirtyReason[]) {\n    const reasons = new Set(dirtyReason);\n\n    if (this._data.length === 0) {\n      return { groups: [], index2pos: [] };\n    }\n\n    // console.log(dirtyReason);\n\n    const filter = this.resolveFilter(ranking);\n\n    const needsFiltering = reasons.has(EDirtyReason.UNKNOWN) || reasons.has(EDirtyReason.FILTER_CHANGED);\n    const needsGrouping =\n      needsFiltering ||\n      reasons.has(EDirtyReason.GROUP_CRITERIA_CHANGED) ||\n      reasons.has(EDirtyReason.GROUP_CRITERIA_DIRTY);\n    const needsSorting =\n      needsGrouping || reasons.has(EDirtyReason.SORT_CRITERIA_CHANGED) || reasons.has(EDirtyReason.SORT_CRITERIA_DIRTY);\n    const needsGroupSorting =\n      needsGrouping ||\n      reasons.has(EDirtyReason.GROUP_SORT_CRITERIA_CHANGED) ||\n      reasons.has(EDirtyReason.GROUP_SORT_CRITERIA_DIRTY);\n\n    if (needsFiltering) {\n      this.tasks.dirtyRanking(ranking, 'summary');\n    } else if (needsGrouping) {\n      this.tasks.dirtyRanking(ranking, 'group');\n    }\n    // otherwise the summary and group summaries should still be valid\n\n    if (filter.length === 0) {\n      // all rows so summary = data\n      this.tasks.copyData2Summary(ranking);\n    }\n\n    const isGroupedBy = ranking.getGroupCriteria().length > 0;\n    const isSortedBy = ranking.getSortCriteria().length > 0;\n    const isGroupedSortedBy = ranking.getGroupSortCriteria().length > 0;\n\n    if (!isGroupedBy && !isSortedBy && filter.length === 0) {\n      return this.noSorting(ranking);\n    }\n\n    const { maxDataIndex, lookups, groupOrder } = this.createSorter(\n      ranking,\n      filter,\n      needsFiltering,\n      needsGrouping,\n      needsSorting\n    );\n\n    if (groupOrder.length === 0) {\n      return { groups: [], index2pos: [] };\n    }\n\n    this.tasks.preCompute(ranking, groupOrder, maxDataIndex);\n\n    if (groupOrder.length === 1) {\n      const g = groupOrder[0]!;\n\n      // not required if: group sort criteria changed -> lookups will be none\n      return this.sortGroup(g, 0, ranking, lookups, undefined, true, maxDataIndex).then((group) => {\n        return this.index2pos([group], maxDataIndex);\n      });\n    }\n\n    const groupLookup =\n      isGroupedSortedBy && needsGroupSorting ? new CompareLookup(groupOrder.length, false, ranking) : undefined;\n\n    return Promise.all(\n      groupOrder.map((g, i) => {\n        // not required if: group sort criteria changed -> lookups will be none\n        return this.sortGroup(g, i, ranking, lookups, groupLookup, false, maxDataIndex);\n      })\n    ).then((groups) => {\n      // not required if: sort criteria changed -> groupLookup will be none\n      const sortedGroups = this.sortGroups(groups, groupLookup, needsGroupSorting);\n      return this.index2pos(sortedGroups, maxDataIndex);\n    });\n  }\n\n  private readonly mapToDataRow = (i: number) => {\n    if (i < 0 || i >= this._dataRows.length) {\n      return { i, v: {} };\n    }\n    return this._dataRows[i];\n  };\n\n  viewRaw(indices: IndicesArray) {\n    return mapIndices(indices, (i) => this._data[i] || {});\n  }\n\n  viewRawRows(indices: IndicesArray) {\n    return mapIndices(indices, this.mapToDataRow);\n  }\n\n  getRow(index: number) {\n    return this._dataRows[index];\n  }\n\n  seq(indices: IndicesArray) {\n    return lazySeq(indices).map(this.mapToDataRow);\n  }\n\n  view(indices: IndicesArray) {\n    return this.viewRaw(indices);\n  }\n\n  mappingSample(col: INumberColumn): ISequence<number> {\n    const MAX_SAMPLE = 120; //at most 120 sample lines\n    const l = this._dataRows.length;\n    if (l <= MAX_SAMPLE) {\n      return lazySeq(this._dataRows).map((v) => col.getRawNumber(v));\n    }\n    //randomly select 500 elements\n    const indices = new Set<number>();\n\n    for (let i = 0; i < MAX_SAMPLE; ++i) {\n      let j = Math.floor(Math.random() * (l - 1));\n      while (indices.has(j)) {\n        j = Math.floor(Math.random() * (l - 1));\n      }\n      indices.add(j);\n    }\n    return lazySeq(Array.from(indices)).map((i) => col.getRawNumber(this._dataRows[i]));\n  }\n\n  searchAndJump(search: string | RegExp, col: Column) {\n    //case insensitive search\n    search = typeof search === 'string' ? search.toLowerCase() : search;\n    const f =\n      typeof search === 'string'\n        ? (v: string) => v.toLowerCase().indexOf(search as string) >= 0\n        : (search as RegExp).test.bind(search);\n    const indices: number[] = [];\n    for (let i = 0; i < this._dataRows.length; ++i) {\n      if (f(col.getLabel(this._dataRows[i]))) {\n        indices.push(i);\n      }\n    }\n    this.jumpToNearest(indices);\n  }\n}\n\nfunction toRows(data: any[]) {\n  return data.map((v, i) => ({ v, i }));\n}\n","import type { IAbortAblePromise } from 'lineupengine';\nimport type {\n  Column,\n  IDataRow,\n  IOrderedGroup,\n  INumberColumn,\n  ICategoricalLikeColumn,\n  IDateColumn,\n  StringColumn,\n} from '../model';\nimport type { IDataProvider } from '../provider';\nimport type DialogManager from '../ui/dialogs/DialogManager';\nimport type {\n  ISequence,\n  IDateStatistics,\n  ICategoricalStatistics,\n  IAdvancedBoxPlotData,\n  IStatistics,\n  IStringStatistics,\n} from '../internal';\n\nexport interface IImposer {\n  color?(row: IDataRow | null, valueHint?: number): string | null;\n}\n\nexport declare type IRenderCallback = (ctx: CanvasRenderingContext2D) => void;\n\n/**\n * a cell renderer for rendering a cell of specific column\n */\nexport interface ICellRenderer {\n  /**\n   * template as a basis for the update\n   */\n  readonly template: string;\n\n  /**\n   * update a given node (create using the template) with the given data\n   * @param node the node to update\n   * @param d the data item\n   * @param i the order relative index\n   * @param group the group this row is part of\n   */\n  update(node: HTMLElement, d: IDataRow, i: number, group: IOrderedGroup): void | IAbortAblePromise<void> | null;\n\n  /**\n   * render a low detail canvas row\n   * @return true if a dom element is needed\n   */\n  render?(\n    ctx: CanvasRenderingContext2D,\n    d: IDataRow,\n    i: number,\n    group: IOrderedGroup\n  ): void | IAbortAblePromise<IRenderCallback> | boolean | null;\n}\n\n/**\n * a cell renderer for rendering a cell of specific column\n */\nexport interface IGroupCellRenderer {\n  /**\n   * template as a basis for the update\n   */\n  readonly template: string;\n\n  /**\n   * update a given node (create using the template) with the given data\n   * @param node the node to update\n   * @param group the group to render\n   */\n  update(node: HTMLElement, group: IOrderedGroup): void | IAbortAblePromise<void> | null;\n}\n\nexport interface ISummaryRenderer {\n  /**\n   * template as a basis for the update\n   */\n  readonly template: string;\n\n  update(node: HTMLElement): void | IAbortAblePromise<void> | null;\n}\n\nexport interface IRenderTask<T> {\n  then<U = void>(onfullfilled: (value: T | symbol) => U): U | IAbortAblePromise<U>;\n}\n\nexport interface IRenderTasks {\n  groupRows<T>(\n    col: Column,\n    group: IOrderedGroup,\n    key: string,\n    compute: (rows: ISequence<IDataRow>) => T\n  ): IRenderTask<T>;\n  groupExampleRows<T>(\n    col: Column,\n    group: IOrderedGroup,\n    key: string,\n    compute: (rows: ISequence<IDataRow>) => T\n  ): IRenderTask<T>;\n\n  groupBoxPlotStats(\n    col: Column & INumberColumn,\n    group: IOrderedGroup,\n    raw?: boolean\n  ): IRenderTask<{ group: IAdvancedBoxPlotData; summary: IAdvancedBoxPlotData; data: IAdvancedBoxPlotData }>;\n  groupNumberStats(\n    col: Column & INumberColumn,\n    group: IOrderedGroup,\n    raw?: boolean\n  ): IRenderTask<{ group: IStatistics; summary: IStatistics; data: IStatistics }>;\n  groupCategoricalStats(\n    col: Column & ICategoricalLikeColumn,\n    group: IOrderedGroup\n  ): IRenderTask<{ group: ICategoricalStatistics; summary: ICategoricalStatistics; data: ICategoricalStatistics }>;\n  groupDateStats(\n    col: Column & IDateColumn,\n    group: IOrderedGroup\n  ): IRenderTask<{ group: IDateStatistics; summary: IDateStatistics; data: IDateStatistics }>;\n  groupStringStats(\n    col: StringColumn,\n    group: IOrderedGroup\n  ): IRenderTask<{ group: IStringStatistics; summary: IStringStatistics; data: IStringStatistics }>;\n\n  summaryBoxPlotStats(\n    col: Column & INumberColumn,\n    raw?: boolean\n  ): IRenderTask<{ summary: IAdvancedBoxPlotData; data: IAdvancedBoxPlotData }>;\n  summaryNumberStats(\n    col: Column & INumberColumn,\n    raw?: boolean\n  ): IRenderTask<{ summary: IStatistics; data: IStatistics }>;\n  summaryCategoricalStats(\n    col: Column & ICategoricalLikeColumn\n  ): IRenderTask<{ summary: ICategoricalStatistics; data: ICategoricalStatistics }>;\n  summaryDateStats(col: Column & IDateColumn): IRenderTask<{ summary: IDateStatistics; data: IDateStatistics }>;\n  summaryStringStats(col: StringColumn): IRenderTask<{ summary: IStringStatistics; data: IStringStatistics }>;\n}\n\n/**\n * context for rendering, wrapped as an object for easy extensibility\n */\nexport interface IRenderContext {\n  readonly tasks: IRenderTasks;\n  /**\n   * render a column\n   * @param col\n   */\n  renderer(col: Column, imposer?: IImposer): ICellRenderer;\n\n  /**\n   * render a column\n   * @param col\n   */\n  groupRenderer(col: Column, imposer?: IImposer): IGroupCellRenderer;\n\n  summaryRenderer(co: Column, interactive: boolean, imposer?: IImposer): ISummaryRenderer;\n\n  /**\n   * prefix used for all generated id names\n   */\n  readonly idPrefix: string;\n\n  asElement(html: string): HTMLElement;\n  sanitize(text: string): string;\n\n  colWidth(col: Column): number;\n\n  readonly provider: IDataProvider;\n  readonly dialogManager: DialogManager;\n}\n\nexport enum ERenderMode {\n  CELL,\n  GROUP,\n  SUMMARY,\n}\n\nexport interface ICellRendererFactory {\n  readonly title: string;\n  readonly groupTitle?: string;\n  readonly summaryTitle?: string;\n\n  canRender(col: Column, mode: ERenderMode): boolean;\n\n  create?(col: Column, context: IRenderContext, imposer?: IImposer): ICellRenderer;\n\n  createGroup?(col: Column, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer;\n\n  createSummary?(col: Column, context: IRenderContext, interactive: boolean, imposer?: IImposer): ISummaryRenderer;\n}\n","/**\n * number of bins before switching to dense mode\n * @internal\n */\nexport const DENSE_HISTOGRAM = 19;\n/**\n * minimal width of a column to show the label in the header\n * @internal\n */\nexport const MIN_LABEL_WIDTH = 30;\n/**\n * number of milliseconds to wait before a hovered canvas row will be replaced with a DOM one\n * @type {number}\n * @internal\n */\nexport const HOVER_DELAY_SHOW_DETAIL = 500;\n\nexport const GUESSED_ROW_HEIGHT = 18;\nexport const GUESSES_GROUP_HEIGHT = 40;\n","import { MIN_LABEL_WIDTH } from '../constants';\nimport { Column, IArrayColumn, IDataRow, ICategoricalLikeColumn, isMapAbleColumn, DEFAULT_COLOR } from '../model';\nimport { hsl } from 'd3-color';\nimport { cssClass } from '../styles';\nimport type { ISequence } from '../internal';\nimport type { IRenderContext } from './interfaces';\n\n/** @internal */\nexport function noop() {\n  // no op\n}\n\nexport const noRenderer = {\n  template: `<div></div>`,\n  update: noop as () => void,\n};\n\n/** @internal */\nexport function setText<T extends Node>(node: T, text?: string): T {\n  if (text === undefined) {\n    return node;\n  }\n  //no performance boost if setting the text node directly\n  //const textNode = <Text>node.firstChild;\n  //if (textNode == null) {\n  //  node.appendChild(node.ownerDocument!.createTextNode(text));\n  //} else {\n  //  textNode.data = text;\n  //}\n  if (node.textContent !== text) {\n    node.textContent = text;\n  }\n  return node;\n}\n\n/**\n * for each item matching the selector execute the callback\n * @param node\n * @param selector\n * @param callback\n * @internal\n */\nexport function forEach<T extends Element>(node: Element, selector: string, callback: (d: T, i: number) => void) {\n  Array.from(node.querySelectorAll<T>(selector)).forEach(callback);\n}\n\n/** @internal */\nexport function forEachChild<T extends Element>(node: Element, callback: (d: T, i: number) => void) {\n  (Array.from(node.children) as T[]).forEach(callback);\n}\n\n/**\n * matches the columns and the dom nodes representing them\n * @param {HTMLElement} node row\n * @param columns columns to check\n * @internal\n */\nexport function matchColumns(\n  node: HTMLElement,\n  columns: { column: Column; template: string; rendererId: string }[],\n  ctx: IRenderContext\n) {\n  if (node.childElementCount === 0) {\n    // initial call fast method\n    node.innerHTML = columns.map((c) => c.template).join('');\n    const children = Array.from(node.children);\n    columns.forEach((col, i) => {\n      const childNode = children[i] as HTMLElement;\n      // set attribute for finding again\n      childNode.dataset.columnId = col.column.id;\n      // store current renderer\n      childNode.dataset.renderer = col.rendererId;\n      childNode.classList.add(cssClass(`renderer-${col.rendererId}`));\n    });\n    return;\n  }\n\n  function matches(c: { column: Column; rendererId: string }, i: number) {\n    //do both match?\n    const n = node.children[i] as HTMLElement;\n    return n != null && n.dataset.columnId === c.column.id && n.dataset.renderer === c.rendererId;\n  }\n\n  if (columns.every(matches)) {\n    return; //nothing to do\n  }\n\n  const idsAndRenderer = new Set(columns.map((c) => `${c.column.id}@${c.rendererId}`));\n  //remove all that are not existing anymore\n  forEachChild(node, (n: HTMLElement) => {\n    const id = n.dataset.columnId;\n    const renderer = n.dataset.renderer;\n    const idAndRenderer = `${id}@${renderer}`;\n    if (!idsAndRenderer.has(idAndRenderer)) {\n      node.removeChild(n);\n    }\n  });\n  columns.forEach((col) => {\n    let childNode = node.querySelector<HTMLElement>(`[data-column-id=\"${col.column.id}\"]`);\n    if (!childNode) {\n      childNode = ctx.asElement(col.template);\n      childNode.dataset.columnId = col.column.id;\n      childNode.dataset.renderer = col.rendererId;\n      childNode.classList.add(cssClass(`renderer-${col.rendererId}`));\n    }\n    node.appendChild(childNode);\n  });\n}\n\nexport function wideEnough(col: IArrayColumn<any>, length: number = col.labels.length) {\n  const w = col.getWidth();\n  return w / length > MIN_LABEL_WIDTH; // at least 30 pixel\n}\n\nexport function wideEnoughCat(col: ICategoricalLikeColumn) {\n  const w = col.getWidth();\n  return w / col.categories.length > MIN_LABEL_WIDTH; // at least 30 pixel\n}\n\n// side effect\nconst adaptTextColorToBgColorCache: { [bg: string]: string } = {};\n/**\n * Adapts the text color for a given background color\n * @param {string} bgColor as `#ff0000`\n * @returns {string} returns `black` or `white` for best contrast\n */\nexport function adaptTextColorToBgColor(bgColor: string): string {\n  const bak = adaptTextColorToBgColorCache[bgColor];\n  if (bak) {\n    return bak;\n  }\n  return (adaptTextColorToBgColorCache[bgColor] = hsl(bgColor).l > 0.5 ? 'black' : 'white');\n}\n\n/**\n *\n * Adapts the text color for a given background color\n * @param {HTMLElement} node the node containing the text\n * @param {string} bgColor as `#ff0000`\n * @param {string} title the title to render\n * @param {number} width for which percentages of the cell this background applies (0..1)\n */\nexport function adaptDynamicColorToBgColor(node: HTMLElement, bgColor: string, title: string, width: number) {\n  const adapt = adaptTextColorToBgColor(bgColor);\n  if (width <= 0.05 || adapt === 'black' || width > 0.9) {\n    // almost empty or full\n    node.style.color = adapt === 'black' || width <= 0.05 ? null : adapt; // null = black\n    // node.classList.remove('lu-gradient-text');\n    // node.style.backgroundImage = null;\n    return;\n  }\n\n  node.style.color = null;\n  node.innerText = title;\n\n  const span = node.ownerDocument!.createElement('span');\n  span.classList.add(cssClass('gradient-text'));\n  span.style.color = adapt;\n  span.innerText = title;\n  node.appendChild(span);\n}\n\n/** @internal */\nexport const uniqueId: (prefix: string) => string = (function () {\n  // side effect but just within the function itself, so good for the library\n  let idCounter = 0;\n  return (prefix: string) => `${prefix}${(idCounter++).toString(36)}`;\n})();\n\nconst NUM_EXAMPLE_VALUES = 5;\n\n/** @internal */\nexport function exampleText(col: Column, rows: ISequence<IDataRow>) {\n  const examples: string[] = [];\n  rows.every((row) => {\n    if (col.getValue(row) == null) {\n      return true;\n    }\n    const v = col.getLabel(row);\n    examples.push(v);\n    return examples.length < NUM_EXAMPLE_VALUES;\n  });\n  if (examples.length === 0) {\n    return '';\n  }\n  return `${examples.join(', ')}${examples.length < rows.length ? ', ...' : ''}`;\n}\n\n/** @internal */\nexport function multiLevelGridCSSClass(idPrefix: string, column: Column) {\n  return cssClass(`stacked-${idPrefix}-${column.id}`);\n}\n\n/** @internal */\nexport function colorOf(col: Column) {\n  if (isMapAbleColumn(col)) {\n    return col.getColorMapping().apply(0);\n  }\n  return DEFAULT_COLOR;\n}\n\n// side effect\nconst adaptColorCache: { [bg: string]: string } = {};\n\nexport const BIG_MARK_LIGHTNESS_FACTOR = 1.1;\nexport const SMALL_MARK_LIGHTNESS_FACTOR = 0.9;\n\nexport function adaptColor(color: string, lightnessFactor = 1, saturationFactor = 1): string {\n  const key = `${color}-${saturationFactor}-${lightnessFactor}`;\n  const r = adaptColorCache[key];\n  if (r) {\n    return r;\n  }\n  const hslColor = hsl(color);\n  hslColor.s = Math.max(Math.min(hslColor.s * saturationFactor, 1), 0);\n  hslColor.l = Math.max(Math.min(hslColor.l * lightnessFactor, 1), 0);\n  const result = hslColor.formatHex();\n  adaptColorCache[key] = result;\n  return result;\n}\n","import { IDataRow, IOrderedGroup, ActionColumn, Column } from '../model';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { forEachChild, noRenderer } from './utils';\nimport { cssClass } from '../styles';\n\nexport default class ActionRenderer implements ICellRendererFactory {\n  readonly title = 'Default';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return col instanceof ActionColumn && mode !== ERenderMode.SUMMARY;\n  }\n\n  create(col: ActionColumn, context: IRenderContext): ICellRenderer {\n    const actions = col.actions;\n    return {\n      template: `<div class=\"${cssClass('actions')} ${cssClass('hover-only')}\">${actions\n        .map(\n          (a) =>\n            `<span title='${context.sanitize(a.name)}' class='${context.sanitize(\n              a.className || ''\n            )}'>${context.sanitize(a.icon || '')}</span>`\n        )\n        .join('')}</div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        forEachChild(n, (ni: HTMLSpanElement, i: number) => {\n          ni.onclick = function (event) {\n            event.preventDefault();\n            event.stopPropagation();\n            setTimeout(() => actions[i].action(d), 1); // async\n          };\n        });\n      },\n    };\n  }\n\n  createGroup(col: ActionColumn, context: IRenderContext): IGroupCellRenderer {\n    const actions = col.groupActions;\n    return {\n      template: `<div class=\"${cssClass('actions')} ${cssClass('hover-only')}\">${actions\n        .map(\n          (a) =>\n            `<span title='${context.sanitize(a.name)}' class='${context.sanitize(\n              a.className || ''\n            )}'>${context.sanitize(a.icon || '')}</span>`\n        )\n        .join('')}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        forEachChild(n, (ni: HTMLSpanElement, i: number) => {\n          ni.onclick = function (event) {\n            event.preventDefault();\n            event.stopPropagation();\n            context.tasks\n              .groupRows(col, group, 'identity', (r) => r)\n              .then((rows) => {\n                if (typeof rows === 'symbol') {\n                  return;\n                }\n                setTimeout(() => actions[i].action(group, Array.from(rows)), 1); // async\n              });\n          };\n        });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import {\n  IDataRow,\n  Column,\n  AggregateGroupColumn,\n  EAggregationState,\n  IOrderedGroup,\n  IGroupParent,\n  IGroup,\n  defaultGroup,\n} from '../model';\nimport { AGGREGATE, CANVAS_HEIGHT, cssClass } from '../styles';\nimport type {\n  IRenderContext,\n  ICellRendererFactory,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport type { IDataProvider } from '../provider';\nimport {\n  groupParents,\n  toItemMeta,\n  isAlwaysShowingGroupStrategy,\n  hasTopNStrategy,\n  isSummaryGroup,\n} from '../provider/internal';\nimport { clear } from '../internal';\n\nfunction preventDefault(event: Event) {\n  event.preventDefault();\n  event.stopPropagation();\n}\n\nfunction matchNodes(node: HTMLElement, length: number, clazz = 'agg-level', addTopN = false) {\n  const doc = node.ownerDocument!;\n  const children = Array.from(node.children) as HTMLElement[];\n  if (addTopN) {\n    // top N buttons\n    length = length + 1;\n  }\n\n  // add missing\n  for (let i = children.length; i < length; ++i) {\n    const child = doc.createElement('div');\n    child.classList.add(cssClass(clazz));\n    children.push(child);\n    node.appendChild(child);\n  }\n  // remove too many\n  for (const r of children.splice(length, children.length - length)) {\n    r.remove();\n  }\n  if (addTopN) {\n    const last = children[children.length - 1];\n    last.classList.remove(cssClass(clazz));\n    last.classList.add(cssClass('agg-all'));\n  }\n  return children;\n}\n\nfunction renderGroups(\n  node: HTMLElement,\n  group: IOrderedGroup,\n  relativeIndex: number,\n  col: AggregateGroupColumn,\n  provider: IDataProvider\n) {\n  const strategy = provider.getAggregationStrategy();\n  const ranking = col.findMyRanker()!;\n  const topNGetter = (group: IGroup) => provider.getTopNAggregated(ranking, group);\n\n  const isRow = relativeIndex >= 0;\n  const isLeafGroup =\n    !(group as any as IGroupParent).subGroups || (group as any as IGroupParent).subGroups.length === 0;\n\n  const alwaysShowGroup = isAlwaysShowingGroupStrategy(strategy);\n  const isSummary = !isRow && isSummaryGroup(group, strategy, topNGetter);\n  const hasTopN = isSummary && isLeafGroup && hasTopNStrategy(strategy);\n\n  const parents = groupParents(\n    group,\n    relativeIndex >= 0 ? toItemMeta(relativeIndex, group, provider.getTopNAggregated(ranking, group)) : 'first last'\n  );\n  const children = matchNodes(node, parents.length, 'agg-level', hasTopN);\n\n  const lastParent = parents.length - 1;\n\n  for (let i = 0; i < parents.length; ++i) {\n    const parent = parents[i];\n    const child = children[i];\n    const state = provider.getAggregationState(ranking, parent.group);\n    const isLastGroup = i === lastParent;\n    child.dataset.level = String(parents.length - 1 - i); // count backwards\n\n    if (alwaysShowGroup && (isRow || i < lastParent)) {\n      // inner or last\n      if (!isSummary && (parent.meta === 'last' || parent.meta === 'first last')) {\n        child.dataset.meta = 'last';\n      } else {\n        delete child.dataset.meta;\n      }\n      child.classList.toggle(cssClass('agg-inner'), isRow && isLastGroup);\n      child.classList.remove(cssClass('agg-expand'), cssClass('agg-collapse'));\n      child.title = '';\n      delete child.onclick;\n      continue;\n    }\n\n    const isCollapsed = state === EAggregationState.COLLAPSE;\n    const isFirst = parent.meta === 'first' || parent.meta === 'first last';\n    const isShowAll = state === EAggregationState.EXPAND;\n    const childTopN = hasTopN && isLastGroup ? children[parents.length] : null;\n\n    let meta = parent.meta;\n    if (isSummary && parent.meta === 'first last') {\n      meta = 'first';\n    }\n\n    if (meta) {\n      child.dataset.meta = meta;\n    } else {\n      delete child.dataset.meta;\n    }\n\n    child.classList.toggle(cssClass('agg-expand'), isFirst);\n    child.classList.toggle(cssClass('agg-collapse'), isCollapsed);\n    child.title = isFirst ? (isCollapsed ? 'Expand Group' : 'Collapse Group') : '';\n\n    if (!isFirst) {\n      delete child.onclick;\n    } else {\n      child.onclick = (evt) => {\n        preventDefault(evt);\n        let nextState: EAggregationState;\n        switch (strategy) {\n          case 'group+top+item':\n            nextState =\n              state === EAggregationState.COLLAPSE ? EAggregationState.EXPAND_TOP_N : EAggregationState.COLLAPSE;\n            break;\n          case 'group':\n          case 'item':\n          case 'group+item':\n          case 'group+item+top':\n          default:\n            nextState = state === EAggregationState.COLLAPSE ? EAggregationState.EXPAND : EAggregationState.COLLAPSE;\n            break;\n        }\n        col.setAggregated(parent.group, nextState);\n      };\n    }\n\n    if (!childTopN) {\n      continue;\n    }\n    childTopN.dataset.level = String(i); // count upwards\n    childTopN.classList.toggle(cssClass('agg-compress'), isShowAll);\n    childTopN.title = isShowAll ? `Show Top ${provider.getShowTopN()} Only` : 'Show All';\n    childTopN.onclick = (evt) => {\n      preventDefault(evt);\n      col.setAggregated(\n        parent.group,\n        state === EAggregationState.EXPAND ? EAggregationState.EXPAND_TOP_N : EAggregationState.EXPAND\n      );\n    };\n  }\n}\n\nfunction isDummyGroup(group: IGroup) {\n  return group.parent == null && group.name === defaultGroup.name;\n}\n\nexport default class AggregateGroupRenderer implements ICellRendererFactory {\n  readonly title: string = 'Default';\n\n  canRender(col: Column): boolean {\n    return col instanceof AggregateGroupColumn;\n  }\n\n  create(col: AggregateGroupColumn, context: IRenderContext): ICellRenderer {\n    return {\n      template: `<div></div>`,\n      update(node: HTMLElement, _row: IDataRow, i: number, group: IOrderedGroup) {\n        if (isDummyGroup(group)) {\n          clear(node);\n          return;\n        }\n        renderGroups(node, group, i, col, context.provider);\n      },\n      render(ctx: CanvasRenderingContext2D, _row: IDataRow, i: number, group: IOrderedGroup) {\n        if (isDummyGroup(group)) {\n          return undefined;\n        }\n        const parents = groupParents(\n          group,\n          toItemMeta(i, group, context.provider.getTopNAggregated(col.findMyRanker()!, group))\n        );\n        ctx.fillStyle = AGGREGATE.color;\n        for (let i = 0; i < parents.length; ++i) {\n          ctx.fillRect(AGGREGATE.levelWidth * i + AGGREGATE.levelOffset, 0, AGGREGATE.strokeWidth, CANVAS_HEIGHT);\n        }\n        return parents.some((d) => d.meta != null);\n      },\n    };\n  }\n\n  createGroup(col: AggregateGroupColumn, context: IRenderContext): IGroupCellRenderer {\n    return {\n      template: `<div><div class=\"${cssClass('agg-level')}\"></div></div>`,\n      update(node: HTMLElement, group: IOrderedGroup) {\n        renderGroups(node, group, -1, col, context.provider);\n      },\n    };\n  }\n\n  createSummary(col: AggregateGroupColumn, context: IRenderContext): ISummaryRenderer {\n    return {\n      template: `<div></div>`,\n      update: (node: HTMLElement) => {\n        const ranking = col.findMyRanker()!;\n        const groups = ranking.getGroups();\n        if (groups.length === 1 && groups[0].name === defaultGroup.name) {\n          clear(node);\n          return;\n        }\n\n        const gparents = groups.map((group) => groupParents(group, 'first last'));\n\n        const max = gparents.reduce((a, b) => Math.max(a, b.length), Number.NEGATIVE_INFINITY);\n        const children = matchNodes(node, max, 'agg-expand');\n\n        for (let i = 0; i < max; ++i) {\n          const child = children[i];\n          const subGroups = gparents.map((d) => (d[i] ? d[i].group : null)).filter((d) => d != null) as IOrderedGroup[];\n\n          const isCollapsed = subGroups.every(\n            (d) => context.provider.getAggregationState(ranking, d) === EAggregationState.COLLAPSE\n          );\n\n          child.classList.toggle(cssClass('agg-collapse'), isCollapsed);\n          child.title = isCollapsed ? 'Expand All Groups' : 'Collapse All Groups';\n\n          child.onclick = (evt) => {\n            preventDefault(evt);\n            context.provider.aggregateAllOf(\n              ranking,\n              isCollapsed ? EAggregationState.EXPAND : EAggregationState.COLLAPSE,\n              subGroups\n            );\n          };\n        }\n      },\n    };\n  }\n}\n","import { cssClass } from '../styles';\n\n/** @internal */\nexport const filterMissingText = 'Filter rows containing missing values';\n\n/** @internal */\nexport function filterMissingMarkup(bakMissing: boolean) {\n  return `<label class=\"${cssClass('checkbox')}\">\n    <input type=\"checkbox\" ${bakMissing ? 'checked=\"checked\"' : ''}>\n    <span class=\"${cssClass('filter-missing')}\">${filterMissingText}</span>\n  </label>`;\n}\n\n/** @internal */\nexport function filterMissingNumberMarkup(bakMissing: boolean, count: number) {\n  return `<label class=\"${cssClass('checkbox')}\">\n    <input type=\"checkbox\" ${bakMissing ? 'checked=\"checked\"' : ''} ${count === 0 ? 'disabled' : ''}>\n    <span class=\"${cssClass('filter-missing')} ${\n    count === 0 ? cssClass('disabled') : ''\n  }\">Filter ${count} missing value rows</span>\n  </label>`;\n}\n\n/** @internal */\nexport function findFilterMissing(node: HTMLElement) {\n  return (node.getElementsByClassName(cssClass('filter-missing'))[0]! as HTMLElement)\n    .previousElementSibling! as HTMLInputElement;\n}\n\n/** @internal */\nexport function updateFilterMissingNumberMarkup(element: HTMLElement, count: number) {\n  const checked = element.getElementsByTagName('input')![0];\n  checked.disabled = count === 0;\n  element.lastElementChild!.classList.toggle(cssClass('disabled'), count === 0);\n  element.lastElementChild!.textContent = `Filter ${count} missing value rows`;\n}\n","import { Column, IDataRow, isMissingValue } from '../model';\nimport { CANVAS_HEIGHT, DASH, cssClass } from '../styles';\n\nexport function renderMissingValue(ctx: CanvasRenderingContext2D, width: number, height: number, x = 0, y = 0) {\n  const dashX = Math.max(0, x + (width - DASH.width) / 2); // center horizontally\n  const dashY = Math.max(0, y + (height - DASH.height) / 2); // center vertically\n  ctx.fillStyle = DASH.color;\n  ctx.fillRect(dashX, dashY, Math.min(width, DASH.width), Math.min(height, DASH.height));\n}\n\nexport function renderMissingDOM(node: HTMLElement, col: Column, d: IDataRow) {\n  const missing = isMissingValue(col.getValue(d));\n  node.classList.toggle(cssClass('missing'), missing);\n  return missing;\n}\n\nexport function renderMissingCanvas(\n  ctx: CanvasRenderingContext2D,\n  col: Column,\n  d: IDataRow,\n  width: number,\n  x = 0,\n  y = 0\n) {\n  const missing = isMissingValue(col.getValue(d));\n  if (missing) {\n    renderMissingValue(ctx, width, CANVAS_HEIGHT, x, y);\n  }\n  return missing;\n}\n","import { StringColumn, Column, IDataRow, IOrderedGroup, IStringFilter } from '../model';\nimport { filterMissingMarkup, findFilterMissing } from '../ui/missing';\nimport type {\n  IRenderContext,\n  ICellRendererFactory,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { setText, exampleText } from './utils';\nimport { cssClass } from '../styles';\nimport { debounce } from '../internal';\n\n/**\n * renders a string with additional alignment behavior\n * one instance factory shared among strings\n */\nexport default class StringCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Default';\n\n  canRender(col: Column): boolean {\n    return col instanceof StringColumn;\n  }\n\n  create(col: StringColumn, context: IRenderContext): ICellRenderer {\n    const align = context.sanitize(col.alignment || 'left');\n    return {\n      template: `<div${align !== 'left' ? ` class=\"${cssClass(align)}\"` : ''}> </div>`,\n      update: (n: HTMLDivElement, d: IDataRow) => {\n        renderMissingDOM(n, col, d);\n        if (col.escape) {\n          setText(n, col.getLabel(d));\n        } else {\n          n.innerHTML = col.getLabel(d);\n        }\n        n.title = n.textContent!;\n      },\n    };\n  }\n\n  createGroup(col: StringColumn, context: IRenderContext): IGroupCellRenderer {\n    return {\n      template: `<div> </div>`,\n      update: (n: HTMLDivElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupExampleRows(col, group, 'string', (rows) => exampleText(col, rows))\n          .then((text) => {\n            if (typeof text === 'symbol') {\n              return;\n            }\n            n.classList.toggle(cssClass('missing'), !text);\n            if (col.escape) {\n              setText(n, text);\n            } else {\n              n.innerHTML = text;\n              n.title = text;\n            }\n          });\n      },\n    };\n  }\n\n  private static interactiveSummary(col: StringColumn, node: HTMLElement) {\n    const form = node as HTMLFormElement;\n    const filterMissing = findFilterMissing(node);\n    const input = node.querySelector<HTMLInputElement>('input[type=\"text\"]');\n    const isRegex = node.querySelector<HTMLInputElement>('input[type=\"checkbox\"]');\n    let isInputFocused = false;\n\n    const update = () => {\n      const valid = input.value.trim();\n      if (valid.length <= 0) {\n        const filter = filterMissing.checked ? { filter: null, filterMissing: filterMissing.checked } : null;\n        col.setFilter(filter);\n        return;\n      }\n      col.setFilter({\n        filter: isRegex.checked ? new RegExp(input.value) : input.value,\n        filterMissing: filterMissing.checked,\n      });\n    };\n\n    filterMissing.onchange = update;\n    input.onchange = update;\n    input.oninput = debounce(update, 100);\n    input.onfocus = () => {\n      isInputFocused = true;\n    };\n    input.onblur = () => {\n      isInputFocused = false;\n    };\n    isRegex.onchange = update;\n    form.onsubmit = (evt) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n      update();\n      return false;\n    };\n\n    return (actCol: StringColumn) => {\n      // skip update of form fields if search input is currently in focus\n      // otherwise this function sets an old value while typing\n      if (isInputFocused) {\n        return;\n      }\n      col = actCol;\n      const f = col.getFilter() || { filter: null, filterMissing: false };\n      const bak = f.filter;\n      filterMissing.checked = f.filterMissing;\n      input.value = bak instanceof RegExp ? bak.source : bak || '';\n      isRegex.checked = bak instanceof RegExp;\n    };\n  }\n\n  createSummary(col: StringColumn, context: IRenderContext, interactive: boolean): ISummaryRenderer {\n    if (!interactive) {\n      return {\n        template: `<div></div>`,\n        update: (node: HTMLElement) => {\n          const filter = col.getFilter();\n          node.textContent = filterToString(filter);\n        },\n      };\n    }\n    const f = col.getFilter() || { filter: null, filterMissing: false };\n    const bak = f.filter || '';\n    let update: (col: StringColumn) => void;\n    return {\n      template: `<form><input type=\"text\" placeholder=\"Filter ${context.sanitize(col.desc.label)}...\" autofocus\n      list=\"${context.idPrefix}${col.id}_dl\" value=\"${context.sanitize(filterToString(f))}\">\n          <label class=\"${cssClass('checkbox')}\">\n            <input type=\"checkbox\" ${bak instanceof RegExp ? 'checked=\"checked\"' : ''}>\n            <span>Use regular expressions</span>\n          </label>\n          ${filterMissingMarkup(f.filterMissing)}\n          <datalist id=\"${context.idPrefix}${col.id}_dl\"></datalist></form>`,\n      update: (node: HTMLElement) => {\n        if (!update) {\n          update = StringCellRenderer.interactiveSummary(col, node);\n        }\n        update(col);\n        const dl = node.querySelector('datalist')!;\n\n        // no return here = loading indicator since it won't affect the rendering\n        void context.tasks.summaryStringStats(col).then((r) => {\n          if (typeof r === 'symbol') {\n            return;\n          }\n          const { summary } = r;\n          matchDataList(dl, summary.topN);\n        });\n      },\n    };\n  }\n}\n\n/**\n * @internal\n */\nexport function filterToString(filter: IStringFilter | null) {\n  if (filter == null || !filter.filter) {\n    return '';\n  }\n  if (filter.filter instanceof RegExp) {\n    return filter.filter.source;\n  }\n  return filter.filter;\n}\n\n/**\n * matches the given stats to a datalist\n * @internal\n */\nexport function matchDataList(node: HTMLDataListElement, matches: readonly { value: string; count: number }[]) {\n  const children = Array.from(node.options);\n  // update existing\n  for (let i = 0; i < matches.length; i++) {\n    const m = matches[i];\n    let child = children[i];\n    if (!child) {\n      child = node.ownerDocument.createElement('option');\n      node.appendChild(child);\n    }\n    child.value = m.value;\n    setText(child, m.count > 1 ? `${m.value} (${m.count.toLocaleString()})` : m.value);\n  }\n  // remove extra\n  for (let i = children.length - 1; i >= matches.length; i--) {\n    children[i].remove();\n  }\n}\n","import { IDataRow, AnnotateColumn, Column } from '../model';\nimport StringCellRenderer from './StringCellRenderer';\nimport { cssClass } from '../styles';\nimport type { ICellRenderer } from './interfaces';\n\nexport default class AnnotationRenderer extends StringCellRenderer {\n  readonly title: string = 'Default';\n\n  canRender(col: Column) {\n    return super.canRender(col) && col instanceof AnnotateColumn;\n  }\n\n  create(col: AnnotateColumn): ICellRenderer {\n    return {\n      template: `<div>\n        <span></span>\n        <input class=\"${cssClass('hover-only')} ${cssClass('annotate-input')}\">\n       </div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        const label = n.firstElementChild! as HTMLElement;\n        const input = n.lastElementChild! as HTMLInputElement;\n        input.onchange = () => {\n          label.textContent = input.value;\n          col.setValue(d, input.value);\n        };\n        input.onclick = (event) => {\n          event.stopPropagation();\n        };\n        label.textContent = input.value = col.getLabel(d);\n      },\n    };\n  }\n}\n","import { Column, isMapAbleColumn, IDataRow, DEFAULT_COLOR } from '../model';\nimport type { IImposer } from './interfaces';\n\nexport function colorOf(col: Column, row: IDataRow | null, imposer?: IImposer, valueHint?: number) {\n  if (imposer && imposer.color) {\n    return imposer.color(row, valueHint);\n  }\n  if (!row) {\n    if (isMapAbleColumn(col)) {\n      return col.getColorMapping().apply(valueHint != null ? valueHint : 0);\n    }\n    return DEFAULT_COLOR;\n  }\n  return col.getColor(row);\n}\n","import { round } from '../internal';\nimport { Column, isNumbersColumn, IDataRow, INumberColumn, isNumberColumn, DEFAULT_COLOR } from '../model';\nimport { setText, adaptDynamicColorToBgColor, noRenderer, BIG_MARK_LIGHTNESS_FACTOR, adaptColor } from './utils';\nimport { CANVAS_HEIGHT, cssClass } from '../styles';\nimport { colorOf } from './impose';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  IImposer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\n\nexport default class BarCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Bar';\n\n  /**\n   * flag to always render the value\n   * @type {boolean}\n   */\n  constructor(private readonly renderValue: boolean = false) {}\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return mode === ERenderMode.CELL && isNumberColumn(col) && !isNumbersColumn(col);\n  }\n\n  create(col: INumberColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const width = context.colWidth(col);\n    return {\n      template: `<div title=\"\">\n          <div class=\"${cssClass('bar-label')}\" style='background-color: ${DEFAULT_COLOR}'>\n            <span ${this.renderValue ? '' : `class=\"${cssClass('hover-only')}\"`}></span>\n          </div>\n        </div>`,\n      update: (n: HTMLDivElement, d: IDataRow) => {\n        const value = col.getNumber(d);\n        const missing = renderMissingDOM(n, col, d);\n        const w = Number.isNaN(value) ? 0 : round(value * 100, 2);\n        const title = col.getLabel(d);\n        n.title = title;\n\n        const bar = n.firstElementChild! as HTMLElement;\n        bar.style.width = missing ? '100%' : `${w}%`;\n        const color = adaptColor(colorOf(col, d, imposer, value), BIG_MARK_LIGHTNESS_FACTOR);\n        bar.style.backgroundColor = missing ? null : color;\n        setText(bar.firstElementChild!, title);\n        const item = bar.firstElementChild! as HTMLElement;\n        setText(item, title);\n        adaptDynamicColorToBgColor(item, color || DEFAULT_COLOR, title, w / 100);\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        const value = col.getNumber(d);\n        ctx.fillStyle = adaptColor(colorOf(col, d, imposer, value) || DEFAULT_COLOR, BIG_MARK_LIGHTNESS_FACTOR);\n        const w = width * value;\n        ctx.fillRect(0, 0, Number.isNaN(w) ? 0 : w, CANVAS_HEIGHT);\n      },\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return noRenderer;\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import type { Column, IDataRow } from '../model';\nimport type {\n  ERenderMode,\n  ICellRendererFactory,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { noRenderer, setText } from './utils';\n\n/**\n * default renderer instance rendering the value as a text\n */\nexport class DefaultCellRenderer implements ICellRendererFactory {\n  title = 'String';\n  groupTitle = 'None';\n  summaryTitle = 'None';\n\n  canRender(_col: Column, _mode: ERenderMode): boolean {\n    return true;\n  }\n\n  create(col: Column): ICellRenderer {\n    return {\n      template: `<div> </div>`,\n      update: (n: HTMLDivElement, d: IDataRow) => {\n        renderMissingDOM(n, col, d);\n        const l = col.getLabel(d);\n        setText(n, l);\n        n.title = l;\n      },\n    };\n  }\n\n  createGroup(_col: Column): IGroupCellRenderer {\n    return noRenderer;\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import { Column, BooleanColumn } from '../model';\nimport { DefaultCellRenderer } from './DefaultCellRenderer';\nimport { ERenderMode, ICellRenderer } from './interfaces';\nimport { cssClass } from '../styles';\n\nexport default class BooleanCellRenderer extends DefaultCellRenderer {\n  readonly title: string = 'Default';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return col instanceof BooleanColumn && mode === ERenderMode.CELL;\n  }\n\n  create(col: Column): ICellRenderer {\n    const r = super.create(col);\n    (r as any).template = `<div class=\"${cssClass('center')}\"> </div>`;\n    return r;\n  }\n}\n","import { IBoxPlotData, IAdvancedBoxPlotData, round } from '../internal';\nimport {\n  NumberColumn,\n  IBoxPlotColumn,\n  INumberColumn,\n  isBoxPlotColumn,\n  Column,\n  IDataRow,\n  isNumberColumn,\n  isMapAbleColumn,\n  IOrderedGroup,\n} from '../model';\nimport { BOX_PLOT, CANVAS_HEIGHT, DOT, cssClass } from '../styles';\nimport { colorOf } from './impose';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  IImposer,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingCanvas } from './missing';\nimport { tasksAll } from '../provider';\nimport { adaptColor, BIG_MARK_LIGHTNESS_FACTOR, SMALL_MARK_LIGHTNESS_FACTOR } from './utils';\n\nconst BOXPLOT = `<div title=\"\">\n  <div class=\"${cssClass('boxplot-whisker')}\">\n    <div class=\"${cssClass('boxplot-box')}\"></div>\n    <div class=\"${cssClass('boxplot-median')}\"></div>\n    <div class=\"${cssClass('boxplot-mean')}\"></div>\n  </div>\n</div>`;\n\nconst MAPPED_BOXPLOT = `<div title=\"\">\n  <div class=\"${cssClass('boxplot-whisker')}\">\n    <div class=\"${cssClass('boxplot-box')}\"></div>\n    <div class=\"${cssClass('boxplot-median')}\"></div>\n    <div class=\"${cssClass('boxplot-mean')}\"></div>\n  </div>\n  <span class=\"${cssClass('mapping-hint')}\"></span><span class=\"${cssClass('mapping-hint')}\"></span>\n</div>`;\n\n/** @internal */\nexport function computeLabel(col: INumberColumn, v: IBoxPlotData | IAdvancedBoxPlotData) {\n  if (v == null) {\n    return '';\n  }\n  const f = col.getNumberFormat();\n  const mean =\n    (v as IAdvancedBoxPlotData).mean != null ? `mean = ${f((v as IAdvancedBoxPlotData).mean)} (dashed line)\\n` : '';\n  return `min = ${f(v.min)}\\nq1 = ${f(v.q1)}\\nmedian = ${f(v.median)}\\n${mean}q3 = ${f(v.q3)}\\nmax = ${f(v.max)}`;\n}\n\nexport default class BoxplotCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Box Plot';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return (isBoxPlotColumn(col) && mode === ERenderMode.CELL) || (isNumberColumn(col) && mode !== ERenderMode.CELL);\n  }\n\n  create(col: IBoxPlotColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const sortMethod = col.getSortMethod() as keyof IBoxPlotData;\n    const sortedByMe = col.isSortedByMe().asc !== undefined;\n    const width = context.colWidth(col);\n    return {\n      template: BOXPLOT,\n      update: (n: HTMLElement, d: IDataRow) => {\n        const data = col.getBoxPlotData(d);\n        n.classList.toggle(cssClass('missing'), !data);\n        if (!data) {\n          return;\n        }\n        const label = col.getRawBoxPlotData(d)!;\n        renderDOMBoxPlot(col, n, data!, label, sortedByMe ? sortMethod : '', colorOf(col, d, imposer));\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n\n        // Rectangle\n        const data = col.getBoxPlotData(d);\n        if (!data) {\n          return;\n        }\n\n        const scaled = {\n          min: data.min * width,\n          median: data.median * width,\n          mean: (data as IAdvancedBoxPlotData).mean != null ? (data as IAdvancedBoxPlotData).mean * width : undefined,\n          q1: data.q1 * width,\n          q3: data.q3 * width,\n          max: data.max * width,\n          outlier: data.outlier ? data.outlier.map((d) => d * width) : undefined,\n          whiskerLow: data.whiskerLow != null ? data.whiskerLow * width : undefined,\n          whiskerHigh: data.whiskerHigh != null ? data.whiskerHigh * width : undefined,\n        };\n        renderBoxPlot(ctx, scaled, sortedByMe ? sortMethod : '', colorOf(col, d, imposer), CANVAS_HEIGHT, 0);\n      },\n    };\n  }\n\n  createGroup(col: INumberColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\n    const sort = col instanceof NumberColumn && col.isGroupSortedByMe().asc !== undefined ? col.getSortMethod() : '';\n    return {\n      template: BOXPLOT,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return tasksAll([\n          context.tasks.groupBoxPlotStats(col, group, false),\n          context.tasks.groupBoxPlotStats(col, group, true),\n        ]).then((data) => {\n          if (typeof data === 'symbol') {\n            return;\n          }\n          // render\n          const isMissing =\n            data == null ||\n            data[0] == null ||\n            data[0].group.count === 0 ||\n            data[0].group.count === data[0].group.missing;\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n          renderDOMBoxPlot(col, n, data[0].group, data[1].group, sort, colorOf(col, null, imposer));\n        });\n      },\n    };\n  }\n\n  createSummary(\n    col: INumberColumn,\n    context: IRenderContext,\n    _interactive: boolean,\n    imposer?: IImposer\n  ): ISummaryRenderer {\n    return {\n      template: isMapAbleColumn(col) ? MAPPED_BOXPLOT : BOXPLOT,\n      update: (n: HTMLElement) => {\n        return tasksAll([\n          context.tasks.summaryBoxPlotStats(col, false),\n          context.tasks.summaryBoxPlotStats(col, true),\n        ]).then((data) => {\n          if (typeof data === 'symbol') {\n            return;\n          }\n          const isMissing =\n            data == null ||\n            data[0] == null ||\n            data[0].summary.count === 0 ||\n            data[0].summary.count === data[0].summary.missing;\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n          const mappedSummary = data[0].summary;\n          const rawSummary = data[1].summary;\n          const sort =\n            col instanceof NumberColumn && col.isGroupSortedByMe().asc !== undefined ? col.getSortMethod() : '';\n\n          if (isMapAbleColumn(col)) {\n            const range = col.getRange();\n            Array.from(n.getElementsByTagName('span')).forEach((d: HTMLElement, i) => (d.textContent = range[i]));\n          }\n\n          renderDOMBoxPlot(col, n, mappedSummary, rawSummary, sort, colorOf(col, null, imposer), isMapAbleColumn(col));\n        });\n      },\n    };\n  }\n}\n\nfunction renderDOMBoxPlot(\n  col: INumberColumn,\n  n: HTMLElement,\n  data: IBoxPlotData | IAdvancedBoxPlotData,\n  label: IBoxPlotData | IAdvancedBoxPlotData,\n  sort: string,\n  color: string | null,\n  hasRange = false\n) {\n  n.title = computeLabel(col, label);\n\n  const whiskers = n.firstElementChild as HTMLElement;\n  const box = whiskers.firstElementChild as HTMLElement;\n  const median = box.nextElementSibling as HTMLElement;\n  const mean = whiskers.lastElementChild as HTMLElement;\n\n  const leftWhisker =\n    data.whiskerLow != null ? data.whiskerLow : Math.max(data.q1 - 1.5 * (data.q3 - data.q1), data.min);\n  const rightWhisker =\n    data.whiskerHigh != null ? data.whiskerHigh : Math.min(data.q3 + 1.5 * (data.q3 - data.q1), data.max);\n  whiskers.style.left = `${round(leftWhisker * 100, 2)}%`;\n  const range = rightWhisker - leftWhisker;\n  whiskers.style.width = `${round(range * 100, 2)}%`;\n\n  //relative within the whiskers\n  box.style.left = `${round(((data.q1 - leftWhisker) / range) * 100, 2)}%`;\n  box.style.width = `${round(((data.q3 - data.q1) / range) * 100, 2)}%`;\n  box.style.backgroundColor = adaptColor(color, BIG_MARK_LIGHTNESS_FACTOR);\n\n  //relative within the whiskers\n  median.style.left = `${round(((data.median - leftWhisker) / range) * 100, 2)}%`;\n  if ((data as IAdvancedBoxPlotData).mean != null) {\n    mean.style.left = `${round((((data as IAdvancedBoxPlotData).mean - leftWhisker) / range) * 100, 2)}%`;\n    mean.style.display = null;\n  } else {\n    mean.style.display = 'none';\n  }\n\n  // match lengths\n  const outliers = Array.from(n.children).slice(1, hasRange ? -2 : undefined) as HTMLElement[];\n  const numOutliers = data.outlier ? data.outlier.length : 0;\n  outliers.splice(numOutliers, outliers.length - numOutliers).forEach((v) => v.remove());\n\n  whiskers.dataset.sort = sort;\n\n  if (!data.outlier || numOutliers === 0) {\n    return;\n  }\n\n  for (let i = outliers.length; i < numOutliers; ++i) {\n    const p = n.ownerDocument!.createElement('div');\n    p.classList.add(cssClass('boxplot-outlier'));\n    outliers.unshift(p);\n    whiskers.insertAdjacentElement('afterend', p);\n  }\n  data.outlier.forEach((v, i) => {\n    delete outliers[i].dataset.sort;\n    outliers[i].style.left = `${round(v * 100, 2)}%`;\n  });\n\n  if (sort === 'min' && data.outlier[0] <= leftWhisker) {\n    // first outliers is the min\n    whiskers.dataset.sort = '';\n    outliers[0].dataset.sort = 'min';\n    if (outliers.length > 1) {\n      // append at the end of the DOM to be on top\n      outliers[outliers.length - 1].insertAdjacentElement('afterend', outliers[0]);\n    }\n  } else if (sort === 'max' && data.outlier[outliers.length - 1] >= rightWhisker) {\n    // last outlier is the max\n    whiskers.dataset.sort = '';\n    outliers[outliers.length - 1].dataset.sort = 'max';\n  }\n}\n\nfunction renderBoxPlot(\n  ctx: CanvasRenderingContext2D,\n  box: IBoxPlotData,\n  sort: string,\n  color: string | null,\n  height: number,\n  topPadding: number\n) {\n  const left = box.whiskerLow != null ? box.whiskerLow : Math.max(box.q1 - 1.5 * (box.q3 - box.q1), box.min);\n  const right = box.whiskerHigh != null ? box.whiskerHigh : Math.min(box.q3 + 1.5 * (box.q3 - box.q1), box.max);\n\n  ctx.fillStyle = adaptColor(color || BOX_PLOT.box, BIG_MARK_LIGHTNESS_FACTOR);\n  ctx.strokeStyle = adaptColor(BOX_PLOT.stroke, SMALL_MARK_LIGHTNESS_FACTOR);\n  ctx.beginPath();\n  ctx.rect(box.q1, 0, box.q3 - box.q1, height);\n  ctx.fill();\n  ctx.stroke();\n\n  //Line\n  const bottomPos = height - topPadding;\n  const middlePos = height / 2;\n\n  ctx.beginPath();\n  ctx.moveTo(left, middlePos);\n  ctx.lineTo(box.q1, middlePos);\n  ctx.moveTo(left, topPadding);\n  ctx.lineTo(left, bottomPos);\n  ctx.moveTo(box.median, 0);\n  ctx.lineTo(box.median, height);\n  ctx.moveTo(box.q3, middlePos);\n  ctx.lineTo(right, middlePos);\n  ctx.moveTo(right, topPadding);\n  ctx.lineTo(right, bottomPos);\n  ctx.stroke();\n  ctx.fill();\n\n  if (sort !== '') {\n    ctx.strokeStyle = BOX_PLOT.sort;\n    ctx.beginPath();\n    ctx.moveTo(box[sort as keyof IBoxPlotData] as number, topPadding);\n    ctx.lineTo(box[sort as keyof IBoxPlotData] as number, height - topPadding);\n    ctx.stroke();\n    ctx.fill();\n  }\n\n  if (!box.outlier) {\n    return;\n  }\n  ctx.fillStyle = BOX_PLOT.outlier;\n  box.outlier.forEach((v) => {\n    // currently dots with 3px\n    ctx.fillRect(Math.max(v - DOT.size / 2, 0), middlePos - DOT.size / 2, DOT.size, DOT.size);\n  });\n}\n","import { hsl } from 'd3-color';\nimport {\n  Column,\n  isNumbersColumn,\n  IDataRow,\n  INumberColumn,\n  isNumberColumn,\n  isMapAbleColumn,\n  DEFAULT_COLOR,\n  SolidColorFunction,\n} from '../model';\nimport { CANVAS_HEIGHT, cssClass } from '../styles';\nimport { colorOf } from './impose';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  IImposer,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { noRenderer, setText } from './utils';\n\nexport function toHeatMapColor(v: number | null, row: IDataRow, col: INumberColumn, imposer?: IImposer) {\n  if (v == null || Number.isNaN(v)) {\n    v = 1; // max = brightest\n  }\n  if (imposer || !isMapAbleColumn(col)) {\n    //hsl space encoding, encode in lightness\n    const color = hsl(colorOf(col, row, imposer, v) || DEFAULT_COLOR);\n    color.l = 1 - v; // largest value = darkest color\n    return color.toString();\n  }\n  const map = col.getColorMapping();\n  const valueColor = map.apply(v);\n  if (map instanceof SolidColorFunction) {\n    //hsl space encoding, encode in lightness\n    const color = hsl(valueColor);\n    color.l = 1 - v; // largest value = darkest color\n    return color.toString();\n  }\n  // some custom logic that maps to another value\n  return valueColor;\n}\n\nexport default class BrightnessCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Brightness';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return isNumberColumn(col) && mode === ERenderMode.CELL && !isNumbersColumn(col);\n  }\n\n  create(col: INumberColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const width = context.colWidth(col);\n    return {\n      template: `<div title=\"\">\n        <div class=\"${cssClass('cat-color')}\" style=\"background-color: ${DEFAULT_COLOR}\"></div><div class=\"${cssClass(\n        'cat-label'\n      )}\"> </div>\n      </div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        const missing = renderMissingDOM(n, col, d);\n        n.title = col.getLabel(d);\n        (n.firstElementChild! as HTMLDivElement).style.backgroundColor = missing\n          ? null\n          : toHeatMapColor(col.getNumber(d), d, col, imposer);\n        setText(n.lastElementChild!, n.title);\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        ctx.fillStyle = toHeatMapColor(col.getNumber(d), d, col, imposer);\n        ctx.fillRect(0, 0, width, CANVAS_HEIGHT);\n      },\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return noRenderer;\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import { DENSE_HISTOGRAM } from '../constants';\nimport { ICategoricalStatistics, round } from '../internal';\nimport {\n  OrdinalColumn,\n  isCategoricalColumn,\n  isCategoricalLikeColumn,\n  ICategoricalLikeColumn,\n  ICategory,\n  Column,\n  CategoricalColumn,\n  ICategoricalColumn,\n  IDataRow,\n  IOrderedGroup,\n  SetColumn,\n  BooleanColumn,\n} from '../model';\nimport { CANVAS_HEIGHT, cssClass, FILTERED_OPACITY } from '../styles';\nimport { filterMissingNumberMarkup, updateFilterMissingNumberMarkup } from '../ui/missing';\nimport {\n  IRenderContext,\n  ICellRendererFactory,\n  ERenderMode,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { setText, wideEnough, forEach } from './utils';\nimport { color } from 'd3-color';\n\n/** @internal */\nexport declare type HasCategoricalFilter = CategoricalColumn | OrdinalColumn | SetColumn | BooleanColumn;\n\nexport default class CategoricalCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Color & Label';\n  readonly groupTitle: string = 'Histogram';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return isCategoricalLikeColumn(col) && (mode !== ERenderMode.CELL || isCategoricalColumn(col));\n  }\n\n  create(col: ICategoricalColumn, context: IRenderContext): ICellRenderer {\n    const width = context.colWidth(col);\n    return {\n      template: `<div>\n        <div class=\"${cssClass('cat-color')}\"></div><div class=\"${cssClass('cat-label')}\"></div>\n      </div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        renderMissingDOM(n, col, d);\n        const v = col.getCategory(d);\n        (n.firstElementChild! as HTMLDivElement).style.backgroundColor = v ? col.getColor(d) : null;\n        setText(n.lastElementChild! as HTMLSpanElement, col.getLabel(d));\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        const v = col.getCategory(d);\n        ctx.fillStyle = v ? col.getColor(d) : '';\n        ctx.fillRect(0, 0, width, CANVAS_HEIGHT);\n      },\n    };\n  }\n\n  createGroup(col: ICategoricalLikeColumn, context: IRenderContext): IGroupCellRenderer {\n    const { template, update, matchBins } = hist(col, false, context.sanitize);\n    return {\n      template: `${template}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        matchBins(n);\n        return context.tasks.groupCategoricalStats(col, group).then((r) => {\n          if (typeof r === 'symbol') {\n            return;\n          }\n          const isMissing = !r || r.group == null || r.group.count === 0 || r.group.count === r.group.missing;\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n          update(n, r.group);\n        });\n      },\n    };\n  }\n\n  createSummary(col: ICategoricalLikeColumn, context: IRenderContext, interactive: boolean): ISummaryRenderer {\n    return col instanceof CategoricalColumn ||\n      col instanceof OrdinalColumn ||\n      col instanceof SetColumn ||\n      col instanceof BooleanColumn\n      ? interactiveSummary(col, context, interactive)\n      : staticSummary(col, context, interactive);\n  }\n}\n\nfunction staticSummary(col: ICategoricalLikeColumn, context: IRenderContext, interactive: boolean) {\n  const { template, update } = hist(col, interactive, context.sanitize);\n  return {\n    template: `${template}</div>`,\n    update: (n: HTMLElement) => {\n      return context.tasks.summaryCategoricalStats(col).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const isMissing = !r || r.summary == null || r.summary.count === 0 || r.summary.count === r.summary.missing;\n        n.classList.toggle(cssClass('missing'), isMissing);\n        if (isMissing) {\n          return;\n        }\n        update(n, r.summary);\n      });\n    },\n  };\n}\n\nfunction interactiveSummary(col: HasCategoricalFilter, context: IRenderContext, interactive: boolean) {\n  const { template, update, matchBins } = hist(col, interactive || wideEnough(col), context.sanitize);\n  let filterUpdate: (missing: number, col: HasCategoricalFilter) => void;\n  return {\n    template: `${template}${interactive ? filterMissingNumberMarkup(false, 0) : ''}</div>`,\n    update: (n: HTMLElement) => {\n      n.classList.toggle(cssClass('histogram-i'), interactive);\n\n      const matchedBins = matchBins(n);\n      if (!filterUpdate || matchedBins) {\n        filterUpdate = interactiveHist(col, n);\n      }\n      return context.tasks.summaryCategoricalStats(col).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const { summary, data } = r;\n        filterUpdate(interactive && data ? data.missing : summary ? summary.missing : 0, col);\n\n        const isMissing = !r || r.summary == null || r.summary.count === 0 || r.summary.count === r.summary.missing;\n        n.classList.toggle(cssClass('missing'), isMissing);\n        if (isMissing) {\n          return;\n        }\n        update(n, summary, interactive ? data : undefined);\n      });\n    },\n  };\n}\n\nfunction hist(col: ICategoricalLikeColumn, showLabels: boolean, sanitize: (v: string) => string) {\n  const createBin = (c: ICategory, color: string) => {\n    return `<div class=\"${cssClass('histogram-bin')}\" title=\"${sanitize(c.label)}: 0\" data-cat=\"${sanitize(c.name)}\" ${\n      showLabels ? `data-title=\"${sanitize(c.label)}\"` : ''\n    }><div style=\"height: 0; background-color: ${color}\"></div></div>`;\n  };\n\n  return {\n    template: (() => {\n      const mapping = col.getColorMapping();\n      const bins = col.categories.map((c) => createBin(c, mapping.apply(c))).join('');\n      return `<div class=\"${cssClass('histogram')} ${\n        col.categories.length! > DENSE_HISTOGRAM ? cssClass('dense') : ''\n      }\">${bins}`; // no closing div to be able to append things\n    })(),\n    matchBins: (n: HTMLElement) => {\n      // matches bins to current categories, since they can change now\n      const categories = col.categories;\n      const mapping = col.getColorMapping();\n      n.classList.toggle(cssClass('dense'), categories.length! > DENSE_HISTOGRAM);\n      // match the histogram bins to the current categories\n      const bins = Array.from(n.querySelectorAll<HTMLElement>('[data-cat]'));\n      let lastBin: HTMLElement | null = null;\n      let changed = false;\n      for (const category of categories) {\n        let bin = bins[0];\n        if (bin && bin.dataset.cat === category.name) {\n          lastBin = bin;\n          bins.shift(); // remove first since handled\n          continue;\n        }\n        // oh no\n        changed = true;\n        if (lastBin) {\n          lastBin.insertAdjacentHTML('afterend', createBin(category, mapping.apply(category)));\n          bin = lastBin.nextElementSibling as HTMLElement;\n        } else {\n          n.insertAdjacentHTML('afterbegin', createBin(category, mapping.apply(category)));\n          bin = n.firstElementChild as HTMLElement;\n        }\n        lastBin = bin;\n      }\n      for (const toRemove of bins) {\n        // delete extra bins\n        changed = true;\n        toRemove.remove();\n      }\n      return changed;\n    },\n    update: (n: HTMLElement, hist: ICategoricalStatistics, gHist?: ICategoricalStatistics) => {\n      const mapping = col.getColorMapping();\n\n      const selected = col.categories.map((d) => {\n        const c = color(mapping.apply(d))!;\n        c.opacity = FILTERED_OPACITY;\n        return c.toString();\n      });\n\n      const maxBin = gHist ? gHist.maxBin : hist.maxBin;\n      forEach(n, '[data-cat]', (d: HTMLElement, i) => {\n        const cat = col.categories[i];\n        const { count } = hist.hist[i];\n        const inner = d.firstElementChild! as HTMLElement;\n        if (gHist) {\n          const { count: gCount } = gHist.hist[i];\n          d.title = `${cat.label}: ${count} of ${gCount}`;\n          inner.style.height = `${round((gCount * 100) / maxBin, 2)}%`;\n          const relY = 100 - round((count * 100) / gCount, 2);\n          inner.style.background =\n            relY === 0\n              ? mapping.apply(cat)\n              : relY === 100\n              ? selected[i]\n              : `linear-gradient(${selected[i]} ${relY}%, ${mapping.apply(cat)} ${relY}%, ${mapping.apply(cat)} 100%)`;\n        } else {\n          d.title = `${col.categories[i].label}: ${count}`;\n          const inner = d.firstElementChild! as HTMLElement;\n          inner.style.height = `${Math.round((count * 100) / maxBin)}%`;\n          inner.style.background = mapping.apply(cat);\n        }\n      });\n    },\n  };\n}\n\nfunction setCategoricalFilter(col: HasCategoricalFilter, filter: string | RegExp | string[], filterMissing: boolean) {\n  if (col instanceof SetColumn) {\n    const f = col.getFilter();\n    const mode = f ? f.mode : undefined;\n    col.setFilter({\n      filter,\n      filterMissing,\n      mode,\n    });\n  } else {\n    col.setFilter({\n      filter,\n      filterMissing,\n    });\n  }\n}\n\n/** @internal */\nexport function interactiveHist(col: HasCategoricalFilter, node: HTMLElement) {\n  const bins = Array.from(node.querySelectorAll<HTMLElement>('[data-cat]'));\n\n  const markFilter = (bin: HTMLElement, cat: ICategory, value: boolean) => {\n    // update filter highlight eagerly for better user feedback\n    const inner = bin.firstElementChild! as HTMLElement;\n    const base = col.getColorMapping().apply(cat);\n    if (value) {\n      inner.style.background = base;\n      return;\n    }\n    const c = color(base)!;\n    c.opacity = FILTERED_OPACITY;\n    inner.style.background = c.toString();\n  };\n\n  bins.forEach((bin, i) => {\n    const cat = col.categories[i];\n\n    bin.onclick = (evt) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n\n      // toggle filter\n      const old = col.getFilter();\n      if (old == null || !Array.isArray(old.filter)) {\n        // deselect\n        markFilter(bin, cat, false);\n        const included = col.categories.slice();\n        included.splice(i, 1);\n        setCategoricalFilter(\n          col,\n          included.map((d) => d.name),\n          old ? old.filterMissing : false\n        );\n        return;\n      }\n      const filter = old.filter.slice();\n      const contained = filter.indexOf(cat.name);\n      if (contained >= 0) {\n        // remove\n        filter.splice(contained, 1);\n        markFilter(bin, cat, false);\n      } else {\n        // readd\n        filter.push(cat.name);\n        markFilter(bin, cat, true);\n      }\n      if (!old.filterMissing && filter.length === col.categories.length) {\n        // dummy filter\n        col.setFilter(null);\n        return;\n      }\n      setCategoricalFilter(col, filter, old.filterMissing);\n    };\n  });\n\n  const filterMissing = node.getElementsByTagName('input')[0]!;\n\n  if (filterMissing) {\n    filterMissing.onchange = () => {\n      // toggle filter\n      const v = filterMissing.checked;\n      const old = col.getFilter();\n      if (old == null) {\n        if (v) {\n          setCategoricalFilter(\n            col,\n            col.categories.map((d) => d.name),\n            v\n          );\n        } else {\n          col.setFilter(null);\n        }\n      } else if (!v && Array.isArray(old.filter) && old.filter.length === col.categories.length) {\n        // dummy\n        col.setFilter(null);\n      } else {\n        setCategoricalFilter(col, old.filter, v);\n      }\n    };\n  }\n\n  return (missing: number, actCol: HasCategoricalFilter) => {\n    col = actCol;\n    const f = col.getFilter();\n    if (filterMissing) {\n      filterMissing.checked = f != null && f.filterMissing;\n      updateFilterMissingNumberMarkup(filterMissing.parentElement, missing);\n    }\n  };\n}\n","import { Column, ICategoricalsColumn, ICategory, IDataRow, IOrderedGroup, isCategoricalsColumn } from '../model';\nimport { toMostFrequentCategoricals } from '../model/internalCategorical';\nimport { CANVAS_HEIGHT, cssClass } from '../styles';\nimport type {\n  ICellRendererFactory,\n  IRenderContext,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingDOM, renderMissingValue } from './missing';\nimport { noop, wideEnough } from './utils';\nimport { GUESSED_ROW_HEIGHT } from '../constants';\n\nexport default class CategoricalHeatmapCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Heatmap';\n\n  canRender(col: Column): boolean {\n    return isCategoricalsColumn(col) && Boolean(col.dataLength);\n  }\n\n  private createContext(col: ICategoricalsColumn, context: IRenderContext) {\n    const width = context.colWidth(col);\n    const cellDimension = width / col.dataLength!;\n    const labels = col.labels;\n    const render = (ctx: CanvasRenderingContext2D, data: (ICategory | null)[], height: number) => {\n      data.forEach((d: ICategory | null, j: number) => {\n        const x = j * cellDimension;\n        if (d == null) {\n          renderMissingValue(ctx, cellDimension, height, x, 0);\n          return;\n        }\n        ctx.fillStyle = d.color;\n        ctx.fillRect(x, 0, cellDimension, height);\n      });\n    };\n    return {\n      template: `<canvas height=\"${GUESSED_ROW_HEIGHT}\" title=\"\"></canvas>`,\n      render,\n      width,\n      mover: (n: HTMLElement, values: string[]) => (evt: MouseEvent) => {\n        const percent = evt.offsetX / width;\n        const index = Math.max(0, Math.min(col.dataLength! - 1, Math.floor(percent * (col.dataLength! - 1) + 0.5)));\n        n.title = `${labels[index]}: ${values[index]}`;\n      },\n    };\n  }\n\n  create(col: ICategoricalsColumn, context: IRenderContext): ICellRenderer {\n    const { template, render, mover, width } = this.createContext(col, context);\n\n    return {\n      template,\n      update: (n: HTMLElement, d: IDataRow) => {\n        const ctx = (n as HTMLCanvasElement).getContext('2d')!;\n        ctx.canvas.width = width;\n        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n        if (renderMissingDOM(n, col, d)) {\n          return;\n        }\n        n.onmousemove = mover(n, col.getLabels(d));\n        n.onmouseleave = () => (n.title = '');\n        render(ctx, col.getCategories(d), GUESSED_ROW_HEIGHT);\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        render(ctx, col.getCategories(d), CANVAS_HEIGHT);\n      },\n    };\n  }\n\n  createGroup(col: ICategoricalsColumn, context: IRenderContext): IGroupCellRenderer {\n    const { template, render, mover, width } = this.createContext(col, context);\n\n    return {\n      template,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupRows(col, group, this.title, (rows) => toMostFrequentCategoricals(rows, col))\n          .then((data) => {\n            if (typeof data === 'symbol') {\n              return;\n            }\n            const ctx = (n as HTMLCanvasElement).getContext('2d')!;\n            ctx.canvas.width = width;\n            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n            const isMissing = !data || data.length === 0 || data.every((d) => d == null);\n            n.classList.toggle(cssClass('missing'), isMissing);\n            if (isMissing) {\n              return;\n            }\n            n.onmousemove = mover(\n              n,\n              data.map((d) => (d ? d.label : 'missing'))\n            );\n            n.onmouseleave = () => (n.title = '');\n            render(ctx, data, GUESSED_ROW_HEIGHT);\n          });\n      },\n    };\n  }\n\n  createSummary(col: ICategoricalsColumn, context: IRenderContext): ISummaryRenderer {\n    let labels = col.labels.slice();\n    while (labels.length > 0 && !wideEnough(col, labels.length)) {\n      labels = labels.filter((_, i) => i % 2 === 0); // even\n    }\n    let templateRows = `<div class=\"${cssClass('heatmap')}\">`;\n    for (const label of labels) {\n      templateRows += `<div class=\"${cssClass('heatmap-cell')}\"  title=\"${context.sanitize(\n        label\n      )}\" data-title=\"${context.sanitize(label)}\"></div>`;\n    }\n    templateRows += '</div>';\n    return {\n      template: templateRows,\n      update: noop,\n    };\n  }\n}\n","import { ICategoricalStatistics, round } from '../internal';\nimport {\n  CategoricalColumn,\n  Column,\n  OrdinalColumn,\n  ICategoricalColumn,\n  isCategoricalColumn,\n  IOrderedGroup,\n  ISetColumn,\n  DEFAULT_COLOR,\n} from '../model';\nimport { filterMissingNumberMarkup } from '../ui/missing';\nimport { interactiveHist, HasCategoricalFilter } from './CategoricalCellRenderer';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { noRenderer, adaptTextColorToBgColor } from './utils';\nimport { cssClass, FILTERED_OPACITY } from '../styles';\nimport { color } from 'd3-color';\n\nexport default class CategoricalStackedDistributionlCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Distribution Bar';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return isCategoricalColumn(col) && mode !== ERenderMode.CELL;\n  }\n\n  create(): ICellRenderer {\n    return noRenderer;\n  }\n\n  createGroup(col: ICategoricalColumn, context: IRenderContext): IGroupCellRenderer {\n    const { template, update } = stackedBar(col, context.sanitize);\n    return {\n      template: `${template}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks.groupCategoricalStats(col, group).then((r) => {\n          if (typeof r === 'symbol') {\n            return;\n          }\n          const isMissing = !r || r.group == null || r.group.count === 0 || r.group.count === r.group.missing;\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n          update(n, r.group);\n        });\n      },\n    };\n  }\n\n  createSummary(col: ICategoricalColumn, context: IRenderContext, interactive: boolean): ISummaryRenderer {\n    return col instanceof CategoricalColumn || col instanceof OrdinalColumn\n      ? interactiveSummary(col, context, interactive)\n      : staticSummary(col, context);\n  }\n}\n\nfunction staticSummary(col: ICategoricalColumn, context: IRenderContext) {\n  const { template, update } = stackedBar(col, context.sanitize);\n  return {\n    template: `${template}</div>`,\n    update: (n: HTMLElement) => {\n      return context.tasks.summaryCategoricalStats(col).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const isMissing = !r || r.summary == null || r.summary.count === 0 || r.summary.count === r.summary.missing;\n        n.classList.toggle(cssClass('missing'), isMissing);\n        if (isMissing) {\n          return;\n        }\n        update(n, r.summary, r.data);\n      });\n    },\n  };\n}\n\nfunction interactiveSummary(col: HasCategoricalFilter, context: IRenderContext, interactive: boolean) {\n  const { template, update } = stackedBar(col, context.sanitize);\n  let filterUpdate: (missing: number, col: HasCategoricalFilter) => void;\n  return {\n    template: `${template}${interactive ? filterMissingNumberMarkup(false, 0) : ''}</div>`,\n    update: (n: HTMLElement) => {\n      if (!filterUpdate) {\n        filterUpdate = interactiveHist(col, n);\n      }\n      return context.tasks.summaryCategoricalStats(col).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const { summary, data } = r;\n\n        const missing = interactive && data ? data.missing : summary ? summary.missing : 0;\n        filterUpdate(missing, col);\n\n        const isMissing = !r || r.summary == null || r.summary.count === 0 || r.summary.count === r.summary.missing;\n        n.classList.toggle(cssClass('missing'), isMissing);\n        if (isMissing) {\n          return;\n        }\n        update(n, summary, data);\n      });\n    },\n  };\n}\n\nfunction selectedCol(value: string) {\n  const c = color(value)!;\n  c.opacity = FILTERED_OPACITY;\n  return c.toString();\n}\n\nfunction stackedBar(col: ISetColumn, sanitize: (v: string) => string) {\n  const s = sanitize;\n  const mapping = col.getColorMapping();\n  const cats = col.categories.map((c) => ({\n    label: c.label,\n    name: c.name,\n    color: mapping.apply(c),\n    selected: selectedCol(mapping.apply(c)),\n  }));\n  cats.push({ label: 'Missing Values', name: 'missing', color: DEFAULT_COLOR, selected: 'transparent' });\n\n  const bins = cats\n    .map(\n      (c) =>\n        `<div class=\"${cssClass('distribution-bar')}\" style=\"background-color: ${s(\n          c.color\n        )}; color: ${adaptTextColorToBgColor(c.color)}\" title=\"${s(c.label)}: 0\" data-cat=\"${s(c.name)}\"><span>${s(\n          c.label\n        )}</span></div>`\n    )\n    .join('');\n\n  return {\n    template: `<div>${bins}`, // no closing div to be able to append things\n    update: (n: HTMLElement, hist: ICategoricalStatistics, gHist?: ICategoricalStatistics) => {\n      const bins: { count: number }[] = hist.hist.slice();\n      bins.push({ count: hist.missing });\n      const children = Array.from(n.children) as HTMLElement[];\n\n      if (!gHist) {\n        const total = bins.reduce((acc, { count }) => acc + count, 0);\n\n        for (let i = 0; i < cats.length; ++i) {\n          const d = children[i];\n          const count = bins[i].count;\n          const label = cats[i].label;\n          d.style.flexGrow = `${round(total === 0 ? 0 : count, 2)}`;\n          d.title = `${label}: ${count}`;\n        }\n        return;\n      }\n\n      const gBins: { count: number }[] = gHist.hist.slice();\n      gBins.push({ count: gHist.missing });\n      const total = gBins.reduce((acc, { count }) => acc + count, 9);\n\n      for (let i = 0; i < cats.length; ++i) {\n        const d = children[i];\n        const count = bins[i].count;\n        const label = cats[i].label;\n        const gCount = gBins[i].count;\n\n        d.style.flexGrow = `${round(total === 0 ? 0 : gCount, 2)}`;\n        d.title = `${label}: ${count} of ${gCount}`;\n        const relY = 100 - round((count * 100) / gCount, 2);\n        d.style.background =\n          relY === 0\n            ? cats[i].color\n            : relY === 100\n            ? cats[i].selected\n            : `linear-gradient(${cats[i].selected} ${relY}%, ${cats[i].color} ${relY}%, ${cats[i].color} 100%)`;\n      }\n    },\n  };\n}\n","import { Column, isNumbersColumn, IDataRow, INumberColumn, isNumberColumn } from '../model';\nimport { colorOf } from './impose';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  IImposer,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { adaptColor, noRenderer, setText, SMALL_MARK_LIGHTNESS_FACTOR } from './utils';\nimport { cssClass } from '../styles';\n\nexport default class CircleCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Proportional Symbol';\n\n  /**\n   * flag to always render the value\n   * @type {boolean}\n   */\n  constructor(private readonly renderValue: boolean = false) {}\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return isNumberColumn(col) && mode === ERenderMode.CELL && !isNumbersColumn(col);\n  }\n\n  create(col: INumberColumn, _context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    return {\n      template: `<div style=\"background: radial-gradient(circle closest-side, red 100%, transparent 100%)\" title=\"\">\n              <div class=\"${this.renderValue ? '' : cssClass('hover-only')} ${cssClass('bar-label')}\"></div>\n          </div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        const v = col.getNumber(d);\n        const p = Math.round(v * 100);\n        const missing = renderMissingDOM(n, col, d);\n        n.style.background = missing\n          ? null\n          : `radial-gradient(circle closest-side, ${adaptColor(\n              colorOf(col, d, imposer),\n              SMALL_MARK_LIGHTNESS_FACTOR\n            )} ${p}%, transparent ${p}%)`;\n        setText(n.firstElementChild!, col.getLabel(d));\n      },\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return noRenderer;\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import { GUESSES_GROUP_HEIGHT, GUESSED_ROW_HEIGHT } from '../constants';\nimport { concatSeq, ISequence, round } from '../internal';\nimport {\n  Column,\n  DEFAULT_COLOR,\n  IDataRow,\n  INumberColumn,\n  IOrderedGroup,\n  isNumberColumn,\n  isNumbersColumn,\n} from '../model';\nimport { CANVAS_HEIGHT, DOT, cssClass } from '../styles';\nimport { colorOf } from './impose';\nimport {\n  ERenderMode,\n  ICellRendererFactory,\n  IImposer,\n  IRenderContext,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { adaptColor, noRenderer, SMALL_MARK_LIGHTNESS_FACTOR } from './utils';\n\nconst PADDED_HEIGHT = 0.8;\nconst radius = DOT.size / 2;\nconst radiusPercentage = (100 * radius) / GUESSED_ROW_HEIGHT;\nconst availableHeight = 100 * PADDED_HEIGHT - radiusPercentage * 2;\nconst shift = 100 * ((1 - PADDED_HEIGHT) / 2) + radiusPercentage;\n\nexport default class DotCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Dot';\n  readonly groupTitle: string = 'Dots';\n\n  /**\n   * flag to always render the value for single dots\n   * @type {boolean}\n   */\n  constructor(private readonly renderValue: boolean = false) {}\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return isNumberColumn(col) && mode !== ERenderMode.SUMMARY;\n  }\n\n  private static getCanvasRenderer(col: INumberColumn, context: IRenderContext) {\n    const width = context.colWidth(col);\n    const pi2 = Math.PI * 2;\n    const radius = DOT.size / 2;\n    const availableHeight = GUESSES_GROUP_HEIGHT * PADDED_HEIGHT - radius * 2;\n    const shift = GUESSES_GROUP_HEIGHT * ((1 - PADDED_HEIGHT) / 2) + radius;\n\n    const render = (ctx: CanvasRenderingContext2D, vs: { value: number; color: string | null }[], width: number) => {\n      ctx.save();\n      ctx.globalAlpha = DOT.opacity;\n      for (const v of vs) {\n        ctx.fillStyle = v.color || DOT.color;\n        const x = Math.min(width - radius, Math.max(radius, v.value * width));\n        const y = round(Math.random() * availableHeight + shift, 2);\n        ctx.beginPath();\n        ctx.moveTo(x + radius, y);\n        ctx.arc(x, y, radius, 0, pi2, true);\n        ctx.fill();\n      }\n      ctx.restore();\n    };\n    return {\n      template: `<canvas height=\"${GUESSES_GROUP_HEIGHT}\"></canvas>`,\n      render,\n      width,\n    };\n  }\n\n  private static getDOMRenderer(col: INumberColumn, sanitize: (v: string) => string) {\n    const dots = !isNumbersColumn(col) ? 1 : col.dataLength!;\n    let tmp = '';\n    for (let i = 0; i < dots; ++i) {\n      tmp += `<div style='background-color: ${DEFAULT_COLOR}' title=''></div>`;\n    }\n\n    const update = (n: HTMLElement, data: ISequence<{ value: number; label: string; color: string | null }>) => {\n      //adapt the number of children\n      const l = data.length;\n      if (n.children.length !== l) {\n        n.innerHTML = data.reduce((tmp, r) => {\n          return `${tmp}<div style='background-color: ${sanitize(r.color)}' title='${sanitize(r.label)}'></div>`;\n        }, '');\n      }\n      const children = n.children;\n\n      data.forEach((v, i) => {\n        const d = children[i] as HTMLElement;\n        d.title = v.label;\n        d.style.display = Number.isNaN(v.value) ? 'none' : null;\n        d.style.left = `${round(v.value * 100, 2)}%`;\n        // jitter\n        d.style.top = l > 1 ? `${round(Math.random() * availableHeight + shift, 2)}%` : null;\n        d.style.backgroundColor = v.color;\n      });\n    };\n\n    const render = (ctx: CanvasRenderingContext2D, vs: number[], colors: (string | null)[], width: number) => {\n      ctx.save();\n      ctx.globalAlpha = DOT.opacity;\n      vs.forEach((v, i) => {\n        ctx.fillStyle = colors[i] || DOT.color;\n        ctx.fillRect(Math.max(0, v * width - DOT.size / 2), 0, DOT.size, CANVAS_HEIGHT);\n      });\n      ctx.restore();\n    };\n    return { template: `<div>${tmp}</div>`, update, render };\n  }\n\n  private static getSingleDOMRenderer(sanitize: (v: string) => string, renderValue: boolean) {\n    const update = (n: HTMLElement, value: number, label: string, color: string) => {\n      const sanitizedLabel = sanitize(label);\n      n.title = sanitizedLabel;\n      const dot = n.firstElementChild as HTMLElement;\n      dot.style.display = Number.isNaN(value) ? 'none' : null;\n      dot.style.left = `${round(value * 100, 2)}%`;\n      dot.style.backgroundColor = sanitize(color);\n      const labelNode = n.lastElementChild as HTMLElement;\n      labelNode.textContent = sanitizedLabel;\n    };\n\n    const render = (ctx: CanvasRenderingContext2D, value: number, color: string, width: number) => {\n      ctx.save();\n      ctx.globalAlpha = DOT.opacitySingle;\n      ctx.fillStyle = color || DOT.color;\n      ctx.fillRect(Math.max(0, value * width - DOT.size / 2), 0, DOT.size, CANVAS_HEIGHT);\n      ctx.restore();\n    };\n\n    return {\n      template: `<div class=\"${cssClass(\n        'dot-single'\n      )}\"><div style='background-color: ${DEFAULT_COLOR}' title=''></div><span ${\n        renderValue ? '' : `class=\"${cssClass('hover-only')}\"`\n      }></span></div>`,\n      update,\n      render,\n    };\n  }\n\n  create(col: INumberColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const width = context.colWidth(col);\n    const formatter = col.getNumberFormat();\n\n    if (!isNumbersColumn(col)) {\n      // single\n      const { template, render, update } = DotCellRenderer.getSingleDOMRenderer(context.sanitize, this.renderValue);\n      return {\n        template,\n        update: (n, d) => {\n          if (renderMissingDOM(n, col, d)) {\n            return;\n          }\n          const color = adaptColor(colorOf(col, d, imposer), SMALL_MARK_LIGHTNESS_FACTOR);\n          return update(n, col.getNumber(d), col.getLabel(d), color);\n        },\n        render: (ctx, d) => {\n          const color = adaptColor(colorOf(col, d, imposer), SMALL_MARK_LIGHTNESS_FACTOR);\n          return render(ctx, col.getNumber(d), color, width);\n        },\n      };\n    }\n\n    const { template, render, update } = DotCellRenderer.getDOMRenderer(col, context.sanitize);\n    return {\n      template,\n      update: (n: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(n, col, d)) {\n          return;\n        }\n        const color = adaptColor(colorOf(col, d, imposer), SMALL_MARK_LIGHTNESS_FACTOR);\n        const data = col\n          .getNumbers(d)\n          .filter((vi: number) => !Number.isNaN(vi))\n          .map((value) => ({ value, label: formatter(value), color }));\n        return update(n, data);\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        const color = adaptColor(colorOf(col, d, imposer), SMALL_MARK_LIGHTNESS_FACTOR);\n        const vs: number[] = col.getNumbers(d).filter((vi: number) => !Number.isNaN(vi));\n        return render(\n          ctx,\n          vs,\n          vs.map((_: any) => color),\n          width\n        );\n      },\n    };\n  }\n\n  createGroup(col: INumberColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\n    const { template, render, width } = DotCellRenderer.getCanvasRenderer(col, context);\n\n    return {\n      template,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupRows(col, group, 'dot', (rows) => {\n            //value, color, label,\n\n            if (!isNumbersColumn(col)) {\n              return Array.from(rows.map((r) => ({ value: col.getNumber(r), color: colorOf(col, r, imposer) })));\n            }\n            // concatenate all columns\n            const vs = rows.map((r) => {\n              const color = adaptColor(colorOf(col, r, imposer), SMALL_MARK_LIGHTNESS_FACTOR);\n              return col\n                .getNumbers(r)\n                .filter((vi: number) => !Number.isNaN(vi))\n                .map((value) => ({ value, color }));\n            });\n            return Array.from(concatSeq(vs));\n          })\n          .then((data) => {\n            if (typeof data === 'symbol') {\n              return;\n            }\n            const isMissing = !data || data.length === 0 || data.every((v) => Number.isNaN(v.value));\n            n.classList.toggle(cssClass('missing'), isMissing);\n            if (isMissing) {\n              return;\n            }\n            const ctx = (n as HTMLCanvasElement).getContext('2d')!;\n            ctx.canvas.width = width;\n            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n            render(ctx, data, width);\n          });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import { Column, GroupColumn, IOrderedGroup, IGroup, defaultGroup, IDataRow } from '../model';\nimport type { ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer } from './interfaces';\nimport { noRenderer } from './utils';\n\nfunction isDummyGroup(group: IGroup) {\n  return group.parent == null && group.name === defaultGroup.name;\n}\n\nexport default class GroupCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Default';\n\n  canRender(col: Column): boolean {\n    return col instanceof GroupColumn;\n  }\n\n  create(): ICellRenderer {\n    return {\n      template: `<div><div></div></div>`,\n      update(node: HTMLElement, _row: IDataRow, i: number, group: IOrderedGroup) {\n        const text = isDummyGroup(group) || i > 0 ? '' : `${group.name} (${group.order.length})`;\n        (node.firstElementChild! as HTMLElement).textContent = text;\n        node.title = text;\n      },\n      render(_ctx: CanvasRenderingContext2D, _row: IDataRow, i: number) {\n        return i === 0;\n      },\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return {\n      template: `<div><div></div></div>`,\n      update(node: HTMLElement, group: IOrderedGroup) {\n        const text = isDummyGroup(group) ? '' : `${group.name} (${group.order.length})`;\n        (node.firstElementChild! as HTMLElement).textContent = text;\n        node.title = text;\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import type { IDataRow, INumbersColumn, EAdvancedSortMethod, IOrderedGroup } from '../model';\nimport type { IRenderContext, IImposer, ICellRenderer, IGroupCellRenderer } from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { ISequence, boxplotBuilder, getSortLabel } from '../internal';\n\nexport abstract class ANumbersCellRenderer {\n  abstract readonly title: string;\n\n  protected abstract createContext(\n    col: INumbersColumn,\n    context: IRenderContext,\n    imposer?: IImposer\n  ): {\n    clazz: string;\n    templateRow: string;\n    update: (row: HTMLElement, data: number[], raw: number[], d: IDataRow, tooltipPrefix?: string) => void;\n    render: (ctx: CanvasRenderingContext2D, data: number[], d: IDataRow) => void;\n  };\n\n  static choose(col: INumbersColumn, rows: ISequence<IDataRow>) {\n    let row: IDataRow | null = null;\n    const data = rows.map((r, i) => {\n      if (i === 0) {\n        row = r;\n      }\n      return { n: col.getNumbers(r), raw: col.getRawNumbers(r) };\n    });\n    const cols = col.dataLength!;\n    const normalized: number[] = [];\n    const raw: number[] = [];\n    // mean column)\n    for (let i = 0; i < cols; ++i) {\n      const vs = data.map((d) => ({ n: d.n[i], raw: d.raw[i] })).filter((d) => !Number.isNaN(d.n));\n      if (vs.length === 0) {\n        normalized.push(NaN);\n        raw.push(NaN);\n      } else {\n        const bbn = boxplotBuilder();\n        const bbr = boxplotBuilder();\n        const s: EAdvancedSortMethod = (col as any).getSortMethod();\n        vs.forEach((d) => {\n          bbn.push(d.n);\n          bbr.push(d.raw);\n        });\n        normalized.push(bbn.build()[s]!);\n        raw.push(bbr.build()[s]!);\n      }\n    }\n    return { normalized, raw, row };\n  }\n\n  create(col: INumbersColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const width = context.colWidth(col);\n    const { templateRow, render, update, clazz } = this.createContext(col, context, imposer);\n    return {\n      template: `<div class=\"${clazz}\">${templateRow}</div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(n, col, d)) {\n          return;\n        }\n        update(n, col.getNumbers(d), col.getRawNumbers(d), d);\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        render(ctx, col.getNumbers(d), d);\n      },\n    };\n  }\n\n  createGroup(col: INumbersColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\n    const { templateRow, update, clazz } = this.createContext(col, context, imposer);\n    return {\n      template: `<div class=\"${clazz}\">${templateRow}</div>`,\n      update: (n: HTMLDivElement, group: IOrderedGroup) => {\n        // render a heatmap\n        return context.tasks\n          .groupRows(col, group, this.title, (rows) => ANumbersCellRenderer.choose(col, rows))\n          .then((data) => {\n            if (typeof data !== 'symbol') {\n              update(n, data.normalized, data.raw, data.row!, `${getSortLabel(col.getSortMethod())} `);\n            }\n          });\n      },\n    };\n  }\n}\n\n/** @internal */\nexport function matchRows(n: HTMLElement | SVGElement, length: number, template: string) {\n  // first match the number of rows\n  const children = Array.from(n.children) as (HTMLElement | SVGElement)[];\n  if (children.length > length) {\n    children.slice(length).forEach((c) => c.remove());\n  } else if (length > children.length) {\n    n.insertAdjacentHTML('beforeend', template.repeat(length - children.length));\n  }\n}\n","import { Column, INumbersColumn, isNumbersColumn, IDataRow, IOrderedGroup } from '../model';\nimport { CANVAS_HEIGHT, cssClass } from '../styles';\nimport { ANumbersCellRenderer } from './ANumbersCellRenderer';\nimport { toHeatMapColor } from './BrightnessCellRenderer';\nimport type {\n  IRenderContext,\n  ICellRendererFactory,\n  IImposer,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingValue, renderMissingDOM } from './missing';\nimport { noop, wideEnough } from './utils';\nimport { GUESSED_ROW_HEIGHT } from '../constants';\nimport { getSortLabel } from '../internal';\n\nexport default class HeatmapCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Heatmap';\n\n  canRender(col: Column): boolean {\n    return isNumbersColumn(col) && Boolean(col.dataLength);\n  }\n\n  private createContext(col: INumbersColumn, context: IRenderContext, imposer?: IImposer) {\n    const width = context.colWidth(col);\n    const cellDimension = width / col.dataLength!;\n    const labels = col.labels;\n    const render = (ctx: CanvasRenderingContext2D, data: number[], item: IDataRow, height: number) => {\n      data.forEach((d: number, j: number) => {\n        const x = j * cellDimension;\n        if (Number.isNaN(d)) {\n          renderMissingValue(ctx, cellDimension, height, x, 0);\n          return;\n        }\n        ctx.fillStyle = toHeatMapColor(d, item, col, imposer);\n        ctx.fillRect(x, 0, cellDimension, height);\n      });\n    };\n    return {\n      template: `<canvas height=\"${GUESSED_ROW_HEIGHT}\" title=\"\"></canvas>`,\n      render,\n      width,\n      mover: (n: HTMLElement, values: string[], prefix?: string) => (evt: MouseEvent) => {\n        const percent = evt.offsetX / width;\n        const index = Math.max(0, Math.min(col.dataLength! - 1, Math.floor(percent * (col.dataLength! - 1) + 0.5)));\n        n.title = `${prefix || ''}${labels[index]}: ${values[index]}`;\n      },\n    };\n  }\n\n  create(col: INumbersColumn, context: IRenderContext, _hist: any, imposer?: IImposer): ICellRenderer {\n    const { template, render, mover, width } = this.createContext(col, context, imposer);\n\n    return {\n      template,\n      update: (n: HTMLElement, d: IDataRow) => {\n        const ctx = (n as HTMLCanvasElement).getContext('2d')!;\n        ctx.canvas.width = width;\n        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n        if (renderMissingDOM(n, col, d)) {\n          return;\n        }\n        n.onmousemove = mover(n, col.getLabels(d));\n        n.onmouseleave = () => (n.title = '');\n        render(ctx, col.getNumbers(d), d, GUESSED_ROW_HEIGHT);\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        render(ctx, col.getNumbers(d), d, CANVAS_HEIGHT);\n      },\n    };\n  }\n\n  createGroup(col: INumbersColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\n    const { template, render, mover, width } = this.createContext(col, context, imposer);\n    const formatter = col.getNumberFormat();\n\n    return {\n      template,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupRows(col, group, this.title, (rows) => ANumbersCellRenderer.choose(col, rows))\n          .then((data) => {\n            if (typeof data === 'symbol') {\n              return;\n            }\n            const ctx = (n as HTMLCanvasElement).getContext('2d')!;\n            ctx.canvas.width = width;\n            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n            const isMissing = !data || data.normalized.length === 0 || data.normalized.every((v) => Number.isNaN(v));\n            n.classList.toggle(cssClass('missing'), isMissing);\n            if (isMissing) {\n              return;\n            }\n\n            n.onmousemove = mover(n, data.raw.map(formatter), `${getSortLabel(col.getSortMethod())} `);\n            n.onmouseleave = () => (n.title = '');\n            render(ctx, data.normalized, data.row!, GUESSED_ROW_HEIGHT);\n          });\n      },\n    };\n  }\n\n  createSummary(col: INumbersColumn, context: IRenderContext): ISummaryRenderer {\n    let labels = col.labels.slice();\n    while (labels.length > 0 && !wideEnough(col, labels.length)) {\n      labels = labels.filter((_, i) => i % 2 === 0); // even\n    }\n    let templateRows = `<div class=\"${cssClass('heatmap')}\">`;\n    for (const label of labels) {\n      templateRows += `<div class=\"${cssClass('heatmap-cell')}\"  title=\"${context.sanitize(\n        label\n      )}\" data-title=\"${context.sanitize(label)}\"></div>`;\n    }\n    templateRows += '</div>';\n    return {\n      template: templateRows,\n      update: noop,\n    };\n  }\n}\n","export default function getWindow(node) {\n  if (node == null) {\n    return window;\n  }\n\n  if (node.toString() !== '[object Window]') {\n    var ownerDocument = node.ownerDocument;\n    return ownerDocument ? ownerDocument.defaultView || window : window;\n  }\n\n  return node;\n}","import getWindow from \"./getWindow.js\";\n\nfunction isElement(node) {\n  var OwnElement = getWindow(node).Element;\n  return node instanceof OwnElement || node instanceof Element;\n}\n\nfunction isHTMLElement(node) {\n  var OwnElement = getWindow(node).HTMLElement;\n  return node instanceof OwnElement || node instanceof HTMLElement;\n}\n\nfunction isShadowRoot(node) {\n  // IE 11 has no ShadowRoot\n  if (typeof ShadowRoot === 'undefined') {\n    return false;\n  }\n\n  var OwnElement = getWindow(node).ShadowRoot;\n  return node instanceof OwnElement || node instanceof ShadowRoot;\n}\n\nexport { isElement, isHTMLElement, isShadowRoot };","export var max = Math.max;\nexport var min = Math.min;\nexport var round = Math.round;","import { isHTMLElement } from \"./instanceOf.js\";\nimport { round } from \"../utils/math.js\";\nexport default function getBoundingClientRect(element, includeScale) {\n  if (includeScale === void 0) {\n    includeScale = false;\n  }\n\n  var rect = element.getBoundingClientRect();\n  var scaleX = 1;\n  var scaleY = 1;\n\n  if (isHTMLElement(element) && includeScale) {\n    var offsetHeight = element.offsetHeight;\n    var offsetWidth = element.offsetWidth; // Do not attempt to divide by 0, otherwise we get `Infinity` as scale\n    // Fallback to 1 in case both values are `0`\n\n    if (offsetWidth > 0) {\n      scaleX = round(rect.width) / offsetWidth || 1;\n    }\n\n    if (offsetHeight > 0) {\n      scaleY = round(rect.height) / offsetHeight || 1;\n    }\n  }\n\n  return {\n    width: rect.width / scaleX,\n    height: rect.height / scaleY,\n    top: rect.top / scaleY,\n    right: rect.right / scaleX,\n    bottom: rect.bottom / scaleY,\n    left: rect.left / scaleX,\n    x: rect.left / scaleX,\n    y: rect.top / scaleY\n  };\n}","import getWindow from \"./getWindow.js\";\nexport default function getWindowScroll(node) {\n  var win = getWindow(node);\n  var scrollLeft = win.pageXOffset;\n  var scrollTop = win.pageYOffset;\n  return {\n    scrollLeft: scrollLeft,\n    scrollTop: scrollTop\n  };\n}","export default function getNodeName(element) {\n  return element ? (element.nodeName || '').toLowerCase() : null;\n}","import { isElement } from \"./instanceOf.js\";\nexport default function getDocumentElement(element) {\n  // $FlowFixMe[incompatible-return]: assume body is always available\n  return ((isElement(element) ? element.ownerDocument : // $FlowFixMe[prop-missing]\n  element.document) || window.document).documentElement;\n}","import getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getWindowScroll from \"./getWindowScroll.js\";\nexport default function getWindowScrollBarX(element) {\n  // If <html> has a CSS width greater than the viewport, then this will be\n  // incorrect for RTL.\n  // Popper 1 is broken in this case and never had a bug report so let's assume\n  // it's not an issue. I don't think anyone ever specifies width on <html>\n  // anyway.\n  // Browsers where the left scrollbar doesn't cause an issue report `0` for\n  // this (e.g. Edge 2019, IE11, Safari)\n  return getBoundingClientRect(getDocumentElement(element)).left + getWindowScroll(element).scrollLeft;\n}","import getWindow from \"./getWindow.js\";\nexport default function getComputedStyle(element) {\n  return getWindow(element).getComputedStyle(element);\n}","import getComputedStyle from \"./getComputedStyle.js\";\nexport default function isScrollParent(element) {\n  // Firefox wants us to check `-x` and `-y` variations as well\n  var _getComputedStyle = getComputedStyle(element),\n      overflow = _getComputedStyle.overflow,\n      overflowX = _getComputedStyle.overflowX,\n      overflowY = _getComputedStyle.overflowY;\n\n  return /auto|scroll|overlay|hidden/.test(overflow + overflowY + overflowX);\n}","import getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getNodeScroll from \"./getNodeScroll.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport isScrollParent from \"./isScrollParent.js\";\nimport { round } from \"../utils/math.js\";\n\nfunction isElementScaled(element) {\n  var rect = element.getBoundingClientRect();\n  var scaleX = round(rect.width) / element.offsetWidth || 1;\n  var scaleY = round(rect.height) / element.offsetHeight || 1;\n  return scaleX !== 1 || scaleY !== 1;\n} // Returns the composite rect of an element relative to its offsetParent.\n// Composite means it takes into account transforms as well as layout.\n\n\nexport default function getCompositeRect(elementOrVirtualElement, offsetParent, isFixed) {\n  if (isFixed === void 0) {\n    isFixed = false;\n  }\n\n  var isOffsetParentAnElement = isHTMLElement(offsetParent);\n  var offsetParentIsScaled = isHTMLElement(offsetParent) && isElementScaled(offsetParent);\n  var documentElement = getDocumentElement(offsetParent);\n  var rect = getBoundingClientRect(elementOrVirtualElement, offsetParentIsScaled);\n  var scroll = {\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n  var offsets = {\n    x: 0,\n    y: 0\n  };\n\n  if (isOffsetParentAnElement || !isOffsetParentAnElement && !isFixed) {\n    if (getNodeName(offsetParent) !== 'body' || // https://github.com/popperjs/popper-core/issues/1078\n    isScrollParent(documentElement)) {\n      scroll = getNodeScroll(offsetParent);\n    }\n\n    if (isHTMLElement(offsetParent)) {\n      offsets = getBoundingClientRect(offsetParent, true);\n      offsets.x += offsetParent.clientLeft;\n      offsets.y += offsetParent.clientTop;\n    } else if (documentElement) {\n      offsets.x = getWindowScrollBarX(documentElement);\n    }\n  }\n\n  return {\n    x: rect.left + scroll.scrollLeft - offsets.x,\n    y: rect.top + scroll.scrollTop - offsets.y,\n    width: rect.width,\n    height: rect.height\n  };\n}","import getWindowScroll from \"./getWindowScroll.js\";\nimport getWindow from \"./getWindow.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nimport getHTMLElementScroll from \"./getHTMLElementScroll.js\";\nexport default function getNodeScroll(node) {\n  if (node === getWindow(node) || !isHTMLElement(node)) {\n    return getWindowScroll(node);\n  } else {\n    return getHTMLElementScroll(node);\n  }\n}","export default function getHTMLElementScroll(element) {\n  return {\n    scrollLeft: element.scrollLeft,\n    scrollTop: element.scrollTop\n  };\n}","import getBoundingClientRect from \"./getBoundingClientRect.js\"; // Returns the layout rect of an element relative to its offsetParent. Layout\n// means it doesn't take into account transforms.\n\nexport default function getLayoutRect(element) {\n  var clientRect = getBoundingClientRect(element); // Use the clientRect sizes if it's not been transformed.\n  // Fixes https://github.com/popperjs/popper-core/issues/1223\n\n  var width = element.offsetWidth;\n  var height = element.offsetHeight;\n\n  if (Math.abs(clientRect.width - width) <= 1) {\n    width = clientRect.width;\n  }\n\n  if (Math.abs(clientRect.height - height) <= 1) {\n    height = clientRect.height;\n  }\n\n  return {\n    x: element.offsetLeft,\n    y: element.offsetTop,\n    width: width,\n    height: height\n  };\n}","import getNodeName from \"./getNodeName.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport { isShadowRoot } from \"./instanceOf.js\";\nexport default function getParentNode(element) {\n  if (getNodeName(element) === 'html') {\n    return element;\n  }\n\n  return (// this is a quicker (but less type safe) way to save quite some bytes from the bundle\n    // $FlowFixMe[incompatible-return]\n    // $FlowFixMe[prop-missing]\n    element.assignedSlot || // step into the shadow DOM of the parent of a slotted node\n    element.parentNode || ( // DOM Element detected\n    isShadowRoot(element) ? element.host : null) || // ShadowRoot detected\n    // $FlowFixMe[incompatible-call]: HTMLElement is a Node\n    getDocumentElement(element) // fallback\n\n  );\n}","import getParentNode from \"./getParentNode.js\";\nimport isScrollParent from \"./isScrollParent.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nexport default function getScrollParent(node) {\n  if (['html', 'body', '#document'].indexOf(getNodeName(node)) >= 0) {\n    // $FlowFixMe[incompatible-return]: assume body is always available\n    return node.ownerDocument.body;\n  }\n\n  if (isHTMLElement(node) && isScrollParent(node)) {\n    return node;\n  }\n\n  return getScrollParent(getParentNode(node));\n}","import getScrollParent from \"./getScrollParent.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport getWindow from \"./getWindow.js\";\nimport isScrollParent from \"./isScrollParent.js\";\n/*\ngiven a DOM element, return the list of all scroll parents, up the list of ancesors\nuntil we get to the top window object. This list is what we attach scroll listeners\nto, because if any of these parent elements scroll, we'll need to re-calculate the\nreference element's position.\n*/\n\nexport default function listScrollParents(element, list) {\n  var _element$ownerDocumen;\n\n  if (list === void 0) {\n    list = [];\n  }\n\n  var scrollParent = getScrollParent(element);\n  var isBody = scrollParent === ((_element$ownerDocumen = element.ownerDocument) == null ? void 0 : _element$ownerDocumen.body);\n  var win = getWindow(scrollParent);\n  var target = isBody ? [win].concat(win.visualViewport || [], isScrollParent(scrollParent) ? scrollParent : []) : scrollParent;\n  var updatedList = list.concat(target);\n  return isBody ? updatedList : // $FlowFixMe[incompatible-call]: isBody tells us target will be an HTMLElement here\n  updatedList.concat(listScrollParents(getParentNode(target)));\n}","import getNodeName from \"./getNodeName.js\";\nexport default function isTableElement(element) {\n  return ['table', 'td', 'th'].indexOf(getNodeName(element)) >= 0;\n}","import getWindow from \"./getWindow.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport { isHTMLElement, isShadowRoot } from \"./instanceOf.js\";\nimport isTableElement from \"./isTableElement.js\";\nimport getParentNode from \"./getParentNode.js\";\n\nfunction getTrueOffsetParent(element) {\n  if (!isHTMLElement(element) || // https://github.com/popperjs/popper-core/issues/837\n  getComputedStyle(element).position === 'fixed') {\n    return null;\n  }\n\n  return element.offsetParent;\n} // `.offsetParent` reports `null` for fixed elements, while absolute elements\n// return the containing block\n\n\nfunction getContainingBlock(element) {\n  var isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') !== -1;\n  var isIE = navigator.userAgent.indexOf('Trident') !== -1;\n\n  if (isIE && isHTMLElement(element)) {\n    // In IE 9, 10 and 11 fixed elements containing block is always established by the viewport\n    var elementCss = getComputedStyle(element);\n\n    if (elementCss.position === 'fixed') {\n      return null;\n    }\n  }\n\n  var currentNode = getParentNode(element);\n\n  if (isShadowRoot(currentNode)) {\n    currentNode = currentNode.host;\n  }\n\n  while (isHTMLElement(currentNode) && ['html', 'body'].indexOf(getNodeName(currentNode)) < 0) {\n    var css = getComputedStyle(currentNode); // This is non-exhaustive but covers the most common CSS properties that\n    // create a containing block.\n    // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n\n    if (css.transform !== 'none' || css.perspective !== 'none' || css.contain === 'paint' || ['transform', 'perspective'].indexOf(css.willChange) !== -1 || isFirefox && css.willChange === 'filter' || isFirefox && css.filter && css.filter !== 'none') {\n      return currentNode;\n    } else {\n      currentNode = currentNode.parentNode;\n    }\n  }\n\n  return null;\n} // Gets the closest ancestor positioned element. Handles some edge cases,\n// such as table ancestors and cross browser bugs.\n\n\nexport default function getOffsetParent(element) {\n  var window = getWindow(element);\n  var offsetParent = getTrueOffsetParent(element);\n\n  while (offsetParent && isTableElement(offsetParent) && getComputedStyle(offsetParent).position === 'static') {\n    offsetParent = getTrueOffsetParent(offsetParent);\n  }\n\n  if (offsetParent && (getNodeName(offsetParent) === 'html' || getNodeName(offsetParent) === 'body' && getComputedStyle(offsetParent).position === 'static')) {\n    return window;\n  }\n\n  return offsetParent || getContainingBlock(element) || window;\n}","export var top = 'top';\nexport var bottom = 'bottom';\nexport var right = 'right';\nexport var left = 'left';\nexport var auto = 'auto';\nexport var basePlacements = [top, bottom, right, left];\nexport var start = 'start';\nexport var end = 'end';\nexport var clippingParents = 'clippingParents';\nexport var viewport = 'viewport';\nexport var popper = 'popper';\nexport var reference = 'reference';\nexport var variationPlacements = /*#__PURE__*/basePlacements.reduce(function (acc, placement) {\n  return acc.concat([placement + \"-\" + start, placement + \"-\" + end]);\n}, []);\nexport var placements = /*#__PURE__*/[].concat(basePlacements, [auto]).reduce(function (acc, placement) {\n  return acc.concat([placement, placement + \"-\" + start, placement + \"-\" + end]);\n}, []); // modifiers that need to read the DOM\n\nexport var beforeRead = 'beforeRead';\nexport var read = 'read';\nexport var afterRead = 'afterRead'; // pure-logic modifiers\n\nexport var beforeMain = 'beforeMain';\nexport var main = 'main';\nexport var afterMain = 'afterMain'; // modifier with the purpose to write to the DOM (or write into a framework state)\n\nexport var beforeWrite = 'beforeWrite';\nexport var write = 'write';\nexport var afterWrite = 'afterWrite';\nexport var modifierPhases = [beforeRead, read, afterRead, beforeMain, main, afterMain, beforeWrite, write, afterWrite];","import { modifierPhases } from \"../enums.js\"; // source: https://stackoverflow.com/questions/49875255\n\nfunction order(modifiers) {\n  var map = new Map();\n  var visited = new Set();\n  var result = [];\n  modifiers.forEach(function (modifier) {\n    map.set(modifier.name, modifier);\n  }); // On visiting object, check for its dependencies and visit them recursively\n\n  function sort(modifier) {\n    visited.add(modifier.name);\n    var requires = [].concat(modifier.requires || [], modifier.requiresIfExists || []);\n    requires.forEach(function (dep) {\n      if (!visited.has(dep)) {\n        var depModifier = map.get(dep);\n\n        if (depModifier) {\n          sort(depModifier);\n        }\n      }\n    });\n    result.push(modifier);\n  }\n\n  modifiers.forEach(function (modifier) {\n    if (!visited.has(modifier.name)) {\n      // check for visited object\n      sort(modifier);\n    }\n  });\n  return result;\n}\n\nexport default function orderModifiers(modifiers) {\n  // order based on dependencies\n  var orderedModifiers = order(modifiers); // order based on phase\n\n  return modifierPhases.reduce(function (acc, phase) {\n    return acc.concat(orderedModifiers.filter(function (modifier) {\n      return modifier.phase === phase;\n    }));\n  }, []);\n}","import getCompositeRect from \"./dom-utils/getCompositeRect.js\";\nimport getLayoutRect from \"./dom-utils/getLayoutRect.js\";\nimport listScrollParents from \"./dom-utils/listScrollParents.js\";\nimport getOffsetParent from \"./dom-utils/getOffsetParent.js\";\nimport getComputedStyle from \"./dom-utils/getComputedStyle.js\";\nimport orderModifiers from \"./utils/orderModifiers.js\";\nimport debounce from \"./utils/debounce.js\";\nimport validateModifiers from \"./utils/validateModifiers.js\";\nimport uniqueBy from \"./utils/uniqueBy.js\";\nimport getBasePlacement from \"./utils/getBasePlacement.js\";\nimport mergeByName from \"./utils/mergeByName.js\";\nimport detectOverflow from \"./utils/detectOverflow.js\";\nimport { isElement } from \"./dom-utils/instanceOf.js\";\nimport { auto } from \"./enums.js\";\nvar INVALID_ELEMENT_ERROR = 'Popper: Invalid reference or popper argument provided. They must be either a DOM element or virtual element.';\nvar INFINITE_LOOP_ERROR = 'Popper: An infinite loop in the modifiers cycle has been detected! The cycle has been interrupted to prevent a browser crash.';\nvar DEFAULT_OPTIONS = {\n  placement: 'bottom',\n  modifiers: [],\n  strategy: 'absolute'\n};\n\nfunction areValidElements() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  return !args.some(function (element) {\n    return !(element && typeof element.getBoundingClientRect === 'function');\n  });\n}\n\nexport function popperGenerator(generatorOptions) {\n  if (generatorOptions === void 0) {\n    generatorOptions = {};\n  }\n\n  var _generatorOptions = generatorOptions,\n      _generatorOptions$def = _generatorOptions.defaultModifiers,\n      defaultModifiers = _generatorOptions$def === void 0 ? [] : _generatorOptions$def,\n      _generatorOptions$def2 = _generatorOptions.defaultOptions,\n      defaultOptions = _generatorOptions$def2 === void 0 ? DEFAULT_OPTIONS : _generatorOptions$def2;\n  return function createPopper(reference, popper, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var state = {\n      placement: 'bottom',\n      orderedModifiers: [],\n      options: Object.assign({}, DEFAULT_OPTIONS, defaultOptions),\n      modifiersData: {},\n      elements: {\n        reference: reference,\n        popper: popper\n      },\n      attributes: {},\n      styles: {}\n    };\n    var effectCleanupFns = [];\n    var isDestroyed = false;\n    var instance = {\n      state: state,\n      setOptions: function setOptions(setOptionsAction) {\n        var options = typeof setOptionsAction === 'function' ? setOptionsAction(state.options) : setOptionsAction;\n        cleanupModifierEffects();\n        state.options = Object.assign({}, defaultOptions, state.options, options);\n        state.scrollParents = {\n          reference: isElement(reference) ? listScrollParents(reference) : reference.contextElement ? listScrollParents(reference.contextElement) : [],\n          popper: listScrollParents(popper)\n        }; // Orders the modifiers based on their dependencies and `phase`\n        // properties\n\n        var orderedModifiers = orderModifiers(mergeByName([].concat(defaultModifiers, state.options.modifiers))); // Strip out disabled modifiers\n\n        state.orderedModifiers = orderedModifiers.filter(function (m) {\n          return m.enabled;\n        }); // Validate the provided modifiers so that the consumer will get warned\n        // if one of the modifiers is invalid for any reason\n\n        if (process.env.NODE_ENV !== \"production\") {\n          var modifiers = uniqueBy([].concat(orderedModifiers, state.options.modifiers), function (_ref) {\n            var name = _ref.name;\n            return name;\n          });\n          validateModifiers(modifiers);\n\n          if (getBasePlacement(state.options.placement) === auto) {\n            var flipModifier = state.orderedModifiers.find(function (_ref2) {\n              var name = _ref2.name;\n              return name === 'flip';\n            });\n\n            if (!flipModifier) {\n              console.error(['Popper: \"auto\" placements require the \"flip\" modifier be', 'present and enabled to work.'].join(' '));\n            }\n          }\n\n          var _getComputedStyle = getComputedStyle(popper),\n              marginTop = _getComputedStyle.marginTop,\n              marginRight = _getComputedStyle.marginRight,\n              marginBottom = _getComputedStyle.marginBottom,\n              marginLeft = _getComputedStyle.marginLeft; // We no longer take into account `margins` on the popper, and it can\n          // cause bugs with positioning, so we'll warn the consumer\n\n\n          if ([marginTop, marginRight, marginBottom, marginLeft].some(function (margin) {\n            return parseFloat(margin);\n          })) {\n            console.warn(['Popper: CSS \"margin\" styles cannot be used to apply padding', 'between the popper and its reference element or boundary.', 'To replicate margin, use the `offset` modifier, as well as', 'the `padding` option in the `preventOverflow` and `flip`', 'modifiers.'].join(' '));\n          }\n        }\n\n        runModifierEffects();\n        return instance.update();\n      },\n      // Sync update – it will always be executed, even if not necessary. This\n      // is useful for low frequency updates where sync behavior simplifies the\n      // logic.\n      // For high frequency updates (e.g. `resize` and `scroll` events), always\n      // prefer the async Popper#update method\n      forceUpdate: function forceUpdate() {\n        if (isDestroyed) {\n          return;\n        }\n\n        var _state$elements = state.elements,\n            reference = _state$elements.reference,\n            popper = _state$elements.popper; // Don't proceed if `reference` or `popper` are not valid elements\n        // anymore\n\n        if (!areValidElements(reference, popper)) {\n          if (process.env.NODE_ENV !== \"production\") {\n            console.error(INVALID_ELEMENT_ERROR);\n          }\n\n          return;\n        } // Store the reference and popper rects to be read by modifiers\n\n\n        state.rects = {\n          reference: getCompositeRect(reference, getOffsetParent(popper), state.options.strategy === 'fixed'),\n          popper: getLayoutRect(popper)\n        }; // Modifiers have the ability to reset the current update cycle. The\n        // most common use case for this is the `flip` modifier changing the\n        // placement, which then needs to re-run all the modifiers, because the\n        // logic was previously ran for the previous placement and is therefore\n        // stale/incorrect\n\n        state.reset = false;\n        state.placement = state.options.placement; // On each update cycle, the `modifiersData` property for each modifier\n        // is filled with the initial data specified by the modifier. This means\n        // it doesn't persist and is fresh on each update.\n        // To ensure persistent data, use `${name}#persistent`\n\n        state.orderedModifiers.forEach(function (modifier) {\n          return state.modifiersData[modifier.name] = Object.assign({}, modifier.data);\n        });\n        var __debug_loops__ = 0;\n\n        for (var index = 0; index < state.orderedModifiers.length; index++) {\n          if (process.env.NODE_ENV !== \"production\") {\n            __debug_loops__ += 1;\n\n            if (__debug_loops__ > 100) {\n              console.error(INFINITE_LOOP_ERROR);\n              break;\n            }\n          }\n\n          if (state.reset === true) {\n            state.reset = false;\n            index = -1;\n            continue;\n          }\n\n          var _state$orderedModifie = state.orderedModifiers[index],\n              fn = _state$orderedModifie.fn,\n              _state$orderedModifie2 = _state$orderedModifie.options,\n              _options = _state$orderedModifie2 === void 0 ? {} : _state$orderedModifie2,\n              name = _state$orderedModifie.name;\n\n          if (typeof fn === 'function') {\n            state = fn({\n              state: state,\n              options: _options,\n              name: name,\n              instance: instance\n            }) || state;\n          }\n        }\n      },\n      // Async and optimistically optimized update – it will not be executed if\n      // not necessary (debounced to run at most once-per-tick)\n      update: debounce(function () {\n        return new Promise(function (resolve) {\n          instance.forceUpdate();\n          resolve(state);\n        });\n      }),\n      destroy: function destroy() {\n        cleanupModifierEffects();\n        isDestroyed = true;\n      }\n    };\n\n    if (!areValidElements(reference, popper)) {\n      if (process.env.NODE_ENV !== \"production\") {\n        console.error(INVALID_ELEMENT_ERROR);\n      }\n\n      return instance;\n    }\n\n    instance.setOptions(options).then(function (state) {\n      if (!isDestroyed && options.onFirstUpdate) {\n        options.onFirstUpdate(state);\n      }\n    }); // Modifiers have the ability to execute arbitrary code before the first\n    // update cycle runs. They will be executed in the same order as the update\n    // cycle. This is useful when a modifier adds some persistent data that\n    // other modifiers need to use, but the modifier is run after the dependent\n    // one.\n\n    function runModifierEffects() {\n      state.orderedModifiers.forEach(function (_ref3) {\n        var name = _ref3.name,\n            _ref3$options = _ref3.options,\n            options = _ref3$options === void 0 ? {} : _ref3$options,\n            effect = _ref3.effect;\n\n        if (typeof effect === 'function') {\n          var cleanupFn = effect({\n            state: state,\n            name: name,\n            instance: instance,\n            options: options\n          });\n\n          var noopFn = function noopFn() {};\n\n          effectCleanupFns.push(cleanupFn || noopFn);\n        }\n      });\n    }\n\n    function cleanupModifierEffects() {\n      effectCleanupFns.forEach(function (fn) {\n        return fn();\n      });\n      effectCleanupFns = [];\n    }\n\n    return instance;\n  };\n}\nexport var createPopper = /*#__PURE__*/popperGenerator(); // eslint-disable-next-line import/no-unused-modules\n\nexport { detectOverflow };","export default function debounce(fn) {\n  var pending;\n  return function () {\n    if (!pending) {\n      pending = new Promise(function (resolve) {\n        Promise.resolve().then(function () {\n          pending = undefined;\n          resolve(fn());\n        });\n      });\n    }\n\n    return pending;\n  };\n}","export default function mergeByName(modifiers) {\n  var merged = modifiers.reduce(function (merged, current) {\n    var existing = merged[current.name];\n    merged[current.name] = existing ? Object.assign({}, existing, current, {\n      options: Object.assign({}, existing.options, current.options),\n      data: Object.assign({}, existing.data, current.data)\n    }) : current;\n    return merged;\n  }, {}); // IE11 does not support Object.values\n\n  return Object.keys(merged).map(function (key) {\n    return merged[key];\n  });\n}","import getWindow from \"../dom-utils/getWindow.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar passive = {\n  passive: true\n};\n\nfunction effect(_ref) {\n  var state = _ref.state,\n      instance = _ref.instance,\n      options = _ref.options;\n  var _options$scroll = options.scroll,\n      scroll = _options$scroll === void 0 ? true : _options$scroll,\n      _options$resize = options.resize,\n      resize = _options$resize === void 0 ? true : _options$resize;\n  var window = getWindow(state.elements.popper);\n  var scrollParents = [].concat(state.scrollParents.reference, state.scrollParents.popper);\n\n  if (scroll) {\n    scrollParents.forEach(function (scrollParent) {\n      scrollParent.addEventListener('scroll', instance.update, passive);\n    });\n  }\n\n  if (resize) {\n    window.addEventListener('resize', instance.update, passive);\n  }\n\n  return function () {\n    if (scroll) {\n      scrollParents.forEach(function (scrollParent) {\n        scrollParent.removeEventListener('scroll', instance.update, passive);\n      });\n    }\n\n    if (resize) {\n      window.removeEventListener('resize', instance.update, passive);\n    }\n  };\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'eventListeners',\n  enabled: true,\n  phase: 'write',\n  fn: function fn() {},\n  effect: effect,\n  data: {}\n};","import { auto } from \"../enums.js\";\nexport default function getBasePlacement(placement) {\n  return placement.split('-')[0];\n}","export default function getVariation(placement) {\n  return placement.split('-')[1];\n}","export default function getMainAxisFromPlacement(placement) {\n  return ['top', 'bottom'].indexOf(placement) >= 0 ? 'x' : 'y';\n}","import getBasePlacement from \"./getBasePlacement.js\";\nimport getVariation from \"./getVariation.js\";\nimport getMainAxisFromPlacement from \"./getMainAxisFromPlacement.js\";\nimport { top, right, bottom, left, start, end } from \"../enums.js\";\nexport default function computeOffsets(_ref) {\n  var reference = _ref.reference,\n      element = _ref.element,\n      placement = _ref.placement;\n  var basePlacement = placement ? getBasePlacement(placement) : null;\n  var variation = placement ? getVariation(placement) : null;\n  var commonX = reference.x + reference.width / 2 - element.width / 2;\n  var commonY = reference.y + reference.height / 2 - element.height / 2;\n  var offsets;\n\n  switch (basePlacement) {\n    case top:\n      offsets = {\n        x: commonX,\n        y: reference.y - element.height\n      };\n      break;\n\n    case bottom:\n      offsets = {\n        x: commonX,\n        y: reference.y + reference.height\n      };\n      break;\n\n    case right:\n      offsets = {\n        x: reference.x + reference.width,\n        y: commonY\n      };\n      break;\n\n    case left:\n      offsets = {\n        x: reference.x - element.width,\n        y: commonY\n      };\n      break;\n\n    default:\n      offsets = {\n        x: reference.x,\n        y: reference.y\n      };\n  }\n\n  var mainAxis = basePlacement ? getMainAxisFromPlacement(basePlacement) : null;\n\n  if (mainAxis != null) {\n    var len = mainAxis === 'y' ? 'height' : 'width';\n\n    switch (variation) {\n      case start:\n        offsets[mainAxis] = offsets[mainAxis] - (reference[len] / 2 - element[len] / 2);\n        break;\n\n      case end:\n        offsets[mainAxis] = offsets[mainAxis] + (reference[len] / 2 - element[len] / 2);\n        break;\n\n      default:\n    }\n  }\n\n  return offsets;\n}","import { top, left, right, bottom, end } from \"../enums.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport getWindow from \"../dom-utils/getWindow.js\";\nimport getDocumentElement from \"../dom-utils/getDocumentElement.js\";\nimport getComputedStyle from \"../dom-utils/getComputedStyle.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getVariation from \"../utils/getVariation.js\";\nimport { round } from \"../utils/math.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar unsetSides = {\n  top: 'auto',\n  right: 'auto',\n  bottom: 'auto',\n  left: 'auto'\n}; // Round the offsets to the nearest suitable subpixel based on the DPR.\n// Zooming can change the DPR, but it seems to report a value that will\n// cleanly divide the values into the appropriate subpixels.\n\nfunction roundOffsetsByDPR(_ref) {\n  var x = _ref.x,\n      y = _ref.y;\n  var win = window;\n  var dpr = win.devicePixelRatio || 1;\n  return {\n    x: round(x * dpr) / dpr || 0,\n    y: round(y * dpr) / dpr || 0\n  };\n}\n\nexport function mapToStyles(_ref2) {\n  var _Object$assign2;\n\n  var popper = _ref2.popper,\n      popperRect = _ref2.popperRect,\n      placement = _ref2.placement,\n      variation = _ref2.variation,\n      offsets = _ref2.offsets,\n      position = _ref2.position,\n      gpuAcceleration = _ref2.gpuAcceleration,\n      adaptive = _ref2.adaptive,\n      roundOffsets = _ref2.roundOffsets,\n      isFixed = _ref2.isFixed;\n  var _offsets$x = offsets.x,\n      x = _offsets$x === void 0 ? 0 : _offsets$x,\n      _offsets$y = offsets.y,\n      y = _offsets$y === void 0 ? 0 : _offsets$y;\n\n  var _ref3 = typeof roundOffsets === 'function' ? roundOffsets({\n    x: x,\n    y: y\n  }) : {\n    x: x,\n    y: y\n  };\n\n  x = _ref3.x;\n  y = _ref3.y;\n  var hasX = offsets.hasOwnProperty('x');\n  var hasY = offsets.hasOwnProperty('y');\n  var sideX = left;\n  var sideY = top;\n  var win = window;\n\n  if (adaptive) {\n    var offsetParent = getOffsetParent(popper);\n    var heightProp = 'clientHeight';\n    var widthProp = 'clientWidth';\n\n    if (offsetParent === getWindow(popper)) {\n      offsetParent = getDocumentElement(popper);\n\n      if (getComputedStyle(offsetParent).position !== 'static' && position === 'absolute') {\n        heightProp = 'scrollHeight';\n        widthProp = 'scrollWidth';\n      }\n    } // $FlowFixMe[incompatible-cast]: force type refinement, we compare offsetParent with window above, but Flow doesn't detect it\n\n\n    offsetParent = offsetParent;\n\n    if (placement === top || (placement === left || placement === right) && variation === end) {\n      sideY = bottom;\n      var offsetY = isFixed && offsetParent === win && win.visualViewport ? win.visualViewport.height : // $FlowFixMe[prop-missing]\n      offsetParent[heightProp];\n      y -= offsetY - popperRect.height;\n      y *= gpuAcceleration ? 1 : -1;\n    }\n\n    if (placement === left || (placement === top || placement === bottom) && variation === end) {\n      sideX = right;\n      var offsetX = isFixed && offsetParent === win && win.visualViewport ? win.visualViewport.width : // $FlowFixMe[prop-missing]\n      offsetParent[widthProp];\n      x -= offsetX - popperRect.width;\n      x *= gpuAcceleration ? 1 : -1;\n    }\n  }\n\n  var commonStyles = Object.assign({\n    position: position\n  }, adaptive && unsetSides);\n\n  var _ref4 = roundOffsets === true ? roundOffsetsByDPR({\n    x: x,\n    y: y\n  }) : {\n    x: x,\n    y: y\n  };\n\n  x = _ref4.x;\n  y = _ref4.y;\n\n  if (gpuAcceleration) {\n    var _Object$assign;\n\n    return Object.assign({}, commonStyles, (_Object$assign = {}, _Object$assign[sideY] = hasY ? '0' : '', _Object$assign[sideX] = hasX ? '0' : '', _Object$assign.transform = (win.devicePixelRatio || 1) <= 1 ? \"translate(\" + x + \"px, \" + y + \"px)\" : \"translate3d(\" + x + \"px, \" + y + \"px, 0)\", _Object$assign));\n  }\n\n  return Object.assign({}, commonStyles, (_Object$assign2 = {}, _Object$assign2[sideY] = hasY ? y + \"px\" : '', _Object$assign2[sideX] = hasX ? x + \"px\" : '', _Object$assign2.transform = '', _Object$assign2));\n}\n\nfunction computeStyles(_ref5) {\n  var state = _ref5.state,\n      options = _ref5.options;\n  var _options$gpuAccelerat = options.gpuAcceleration,\n      gpuAcceleration = _options$gpuAccelerat === void 0 ? true : _options$gpuAccelerat,\n      _options$adaptive = options.adaptive,\n      adaptive = _options$adaptive === void 0 ? true : _options$adaptive,\n      _options$roundOffsets = options.roundOffsets,\n      roundOffsets = _options$roundOffsets === void 0 ? true : _options$roundOffsets;\n\n  if (process.env.NODE_ENV !== \"production\") {\n    var transitionProperty = getComputedStyle(state.elements.popper).transitionProperty || '';\n\n    if (adaptive && ['transform', 'top', 'right', 'bottom', 'left'].some(function (property) {\n      return transitionProperty.indexOf(property) >= 0;\n    })) {\n      console.warn(['Popper: Detected CSS transitions on at least one of the following', 'CSS properties: \"transform\", \"top\", \"right\", \"bottom\", \"left\".', '\\n\\n', 'Disable the \"computeStyles\" modifier\\'s `adaptive` option to allow', 'for smooth transitions, or remove these properties from the CSS', 'transition declaration on the popper element if only transitioning', 'opacity or background-color for example.', '\\n\\n', 'We recommend using the popper element as a wrapper around an inner', 'element that can have any CSS property transitioned for animations.'].join(' '));\n    }\n  }\n\n  var commonStyles = {\n    placement: getBasePlacement(state.placement),\n    variation: getVariation(state.placement),\n    popper: state.elements.popper,\n    popperRect: state.rects.popper,\n    gpuAcceleration: gpuAcceleration,\n    isFixed: state.options.strategy === 'fixed'\n  };\n\n  if (state.modifiersData.popperOffsets != null) {\n    state.styles.popper = Object.assign({}, state.styles.popper, mapToStyles(Object.assign({}, commonStyles, {\n      offsets: state.modifiersData.popperOffsets,\n      position: state.options.strategy,\n      adaptive: adaptive,\n      roundOffsets: roundOffsets\n    })));\n  }\n\n  if (state.modifiersData.arrow != null) {\n    state.styles.arrow = Object.assign({}, state.styles.arrow, mapToStyles(Object.assign({}, commonStyles, {\n      offsets: state.modifiersData.arrow,\n      position: 'absolute',\n      adaptive: false,\n      roundOffsets: roundOffsets\n    })));\n  }\n\n  state.attributes.popper = Object.assign({}, state.attributes.popper, {\n    'data-popper-placement': state.placement\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'computeStyles',\n  enabled: true,\n  phase: 'beforeWrite',\n  fn: computeStyles,\n  data: {}\n};","import getNodeName from \"../dom-utils/getNodeName.js\";\nimport { isHTMLElement } from \"../dom-utils/instanceOf.js\"; // This modifier takes the styles prepared by the `computeStyles` modifier\n// and applies them to the HTMLElements such as popper and arrow\n\nfunction applyStyles(_ref) {\n  var state = _ref.state;\n  Object.keys(state.elements).forEach(function (name) {\n    var style = state.styles[name] || {};\n    var attributes = state.attributes[name] || {};\n    var element = state.elements[name]; // arrow is optional + virtual elements\n\n    if (!isHTMLElement(element) || !getNodeName(element)) {\n      return;\n    } // Flow doesn't support to extend this property, but it's the most\n    // effective way to apply styles to an HTMLElement\n    // $FlowFixMe[cannot-write]\n\n\n    Object.assign(element.style, style);\n    Object.keys(attributes).forEach(function (name) {\n      var value = attributes[name];\n\n      if (value === false) {\n        element.removeAttribute(name);\n      } else {\n        element.setAttribute(name, value === true ? '' : value);\n      }\n    });\n  });\n}\n\nfunction effect(_ref2) {\n  var state = _ref2.state;\n  var initialStyles = {\n    popper: {\n      position: state.options.strategy,\n      left: '0',\n      top: '0',\n      margin: '0'\n    },\n    arrow: {\n      position: 'absolute'\n    },\n    reference: {}\n  };\n  Object.assign(state.elements.popper.style, initialStyles.popper);\n  state.styles = initialStyles;\n\n  if (state.elements.arrow) {\n    Object.assign(state.elements.arrow.style, initialStyles.arrow);\n  }\n\n  return function () {\n    Object.keys(state.elements).forEach(function (name) {\n      var element = state.elements[name];\n      var attributes = state.attributes[name] || {};\n      var styleProperties = Object.keys(state.styles.hasOwnProperty(name) ? state.styles[name] : initialStyles[name]); // Set all values to an empty string to unset them\n\n      var style = styleProperties.reduce(function (style, property) {\n        style[property] = '';\n        return style;\n      }, {}); // arrow is optional + virtual elements\n\n      if (!isHTMLElement(element) || !getNodeName(element)) {\n        return;\n      }\n\n      Object.assign(element.style, style);\n      Object.keys(attributes).forEach(function (attribute) {\n        element.removeAttribute(attribute);\n      });\n    });\n  };\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'applyStyles',\n  enabled: true,\n  phase: 'write',\n  fn: applyStyles,\n  effect: effect,\n  requires: ['computeStyles']\n};","var hash = {\n  left: 'right',\n  right: 'left',\n  bottom: 'top',\n  top: 'bottom'\n};\nexport default function getOppositePlacement(placement) {\n  return placement.replace(/left|right|bottom|top/g, function (matched) {\n    return hash[matched];\n  });\n}","var hash = {\n  start: 'end',\n  end: 'start'\n};\nexport default function getOppositeVariationPlacement(placement) {\n  return placement.replace(/start|end/g, function (matched) {\n    return hash[matched];\n  });\n}","import { isShadowRoot } from \"./instanceOf.js\";\nexport default function contains(parent, child) {\n  var rootNode = child.getRootNode && child.getRootNode(); // First, attempt with faster native method\n\n  if (parent.contains(child)) {\n    return true;\n  } // then fallback to custom implementation with Shadow DOM support\n  else if (rootNode && isShadowRoot(rootNode)) {\n      var next = child;\n\n      do {\n        if (next && parent.isSameNode(next)) {\n          return true;\n        } // $FlowFixMe[prop-missing]: need a better way to handle this...\n\n\n        next = next.parentNode || next.host;\n      } while (next);\n    } // Give up, the result is false\n\n\n  return false;\n}","export default function rectToClientRect(rect) {\n  return Object.assign({}, rect, {\n    left: rect.x,\n    top: rect.y,\n    right: rect.x + rect.width,\n    bottom: rect.y + rect.height\n  });\n}","import { viewport } from \"../enums.js\";\nimport getViewportRect from \"./getViewportRect.js\";\nimport getDocumentRect from \"./getDocumentRect.js\";\nimport listScrollParents from \"./listScrollParents.js\";\nimport getOffsetParent from \"./getOffsetParent.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport { isElement, isHTMLElement } from \"./instanceOf.js\";\nimport getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport contains from \"./contains.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport rectToClientRect from \"../utils/rectToClientRect.js\";\nimport { max, min } from \"../utils/math.js\";\n\nfunction getInnerBoundingClientRect(element) {\n  var rect = getBoundingClientRect(element);\n  rect.top = rect.top + element.clientTop;\n  rect.left = rect.left + element.clientLeft;\n  rect.bottom = rect.top + element.clientHeight;\n  rect.right = rect.left + element.clientWidth;\n  rect.width = element.clientWidth;\n  rect.height = element.clientHeight;\n  rect.x = rect.left;\n  rect.y = rect.top;\n  return rect;\n}\n\nfunction getClientRectFromMixedType(element, clippingParent) {\n  return clippingParent === viewport ? rectToClientRect(getViewportRect(element)) : isElement(clippingParent) ? getInnerBoundingClientRect(clippingParent) : rectToClientRect(getDocumentRect(getDocumentElement(element)));\n} // A \"clipping parent\" is an overflowable container with the characteristic of\n// clipping (or hiding) overflowing elements with a position different from\n// `initial`\n\n\nfunction getClippingParents(element) {\n  var clippingParents = listScrollParents(getParentNode(element));\n  var canEscapeClipping = ['absolute', 'fixed'].indexOf(getComputedStyle(element).position) >= 0;\n  var clipperElement = canEscapeClipping && isHTMLElement(element) ? getOffsetParent(element) : element;\n\n  if (!isElement(clipperElement)) {\n    return [];\n  } // $FlowFixMe[incompatible-return]: https://github.com/facebook/flow/issues/1414\n\n\n  return clippingParents.filter(function (clippingParent) {\n    return isElement(clippingParent) && contains(clippingParent, clipperElement) && getNodeName(clippingParent) !== 'body';\n  });\n} // Gets the maximum area that the element is visible in due to any number of\n// clipping parents\n\n\nexport default function getClippingRect(element, boundary, rootBoundary) {\n  var mainClippingParents = boundary === 'clippingParents' ? getClippingParents(element) : [].concat(boundary);\n  var clippingParents = [].concat(mainClippingParents, [rootBoundary]);\n  var firstClippingParent = clippingParents[0];\n  var clippingRect = clippingParents.reduce(function (accRect, clippingParent) {\n    var rect = getClientRectFromMixedType(element, clippingParent);\n    accRect.top = max(rect.top, accRect.top);\n    accRect.right = min(rect.right, accRect.right);\n    accRect.bottom = min(rect.bottom, accRect.bottom);\n    accRect.left = max(rect.left, accRect.left);\n    return accRect;\n  }, getClientRectFromMixedType(element, firstClippingParent));\n  clippingRect.width = clippingRect.right - clippingRect.left;\n  clippingRect.height = clippingRect.bottom - clippingRect.top;\n  clippingRect.x = clippingRect.left;\n  clippingRect.y = clippingRect.top;\n  return clippingRect;\n}","import getWindow from \"./getWindow.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nexport default function getViewportRect(element) {\n  var win = getWindow(element);\n  var html = getDocumentElement(element);\n  var visualViewport = win.visualViewport;\n  var width = html.clientWidth;\n  var height = html.clientHeight;\n  var x = 0;\n  var y = 0; // NB: This isn't supported on iOS <= 12. If the keyboard is open, the popper\n  // can be obscured underneath it.\n  // Also, `html.clientHeight` adds the bottom bar height in Safari iOS, even\n  // if it isn't open, so if this isn't available, the popper will be detected\n  // to overflow the bottom of the screen too early.\n\n  if (visualViewport) {\n    width = visualViewport.width;\n    height = visualViewport.height; // Uses Layout Viewport (like Chrome; Safari does not currently)\n    // In Chrome, it returns a value very close to 0 (+/-) but contains rounding\n    // errors due to floating point numbers, so we need to check precision.\n    // Safari returns a number <= 0, usually < -1 when pinch-zoomed\n    // Feature detection fails in mobile emulation mode in Chrome.\n    // Math.abs(win.innerWidth / visualViewport.scale - visualViewport.width) <\n    // 0.001\n    // Fallback here: \"Not Safari\" userAgent\n\n    if (!/^((?!chrome|android).)*safari/i.test(navigator.userAgent)) {\n      x = visualViewport.offsetLeft;\n      y = visualViewport.offsetTop;\n    }\n  }\n\n  return {\n    width: width,\n    height: height,\n    x: x + getWindowScrollBarX(element),\n    y: y\n  };\n}","import getDocumentElement from \"./getDocumentElement.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport getWindowScroll from \"./getWindowScroll.js\";\nimport { max } from \"../utils/math.js\"; // Gets the entire size of the scrollable document area, even extending outside\n// of the `<html>` and `<body>` rect bounds if horizontally scrollable\n\nexport default function getDocumentRect(element) {\n  var _element$ownerDocumen;\n\n  var html = getDocumentElement(element);\n  var winScroll = getWindowScroll(element);\n  var body = (_element$ownerDocumen = element.ownerDocument) == null ? void 0 : _element$ownerDocumen.body;\n  var width = max(html.scrollWidth, html.clientWidth, body ? body.scrollWidth : 0, body ? body.clientWidth : 0);\n  var height = max(html.scrollHeight, html.clientHeight, body ? body.scrollHeight : 0, body ? body.clientHeight : 0);\n  var x = -winScroll.scrollLeft + getWindowScrollBarX(element);\n  var y = -winScroll.scrollTop;\n\n  if (getComputedStyle(body || html).direction === 'rtl') {\n    x += max(html.clientWidth, body ? body.clientWidth : 0) - width;\n  }\n\n  return {\n    width: width,\n    height: height,\n    x: x,\n    y: y\n  };\n}","import getFreshSideObject from \"./getFreshSideObject.js\";\nexport default function mergePaddingObject(paddingObject) {\n  return Object.assign({}, getFreshSideObject(), paddingObject);\n}","export default function getFreshSideObject() {\n  return {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0\n  };\n}","export default function expandToHashMap(value, keys) {\n  return keys.reduce(function (hashMap, key) {\n    hashMap[key] = value;\n    return hashMap;\n  }, {});\n}","import getClippingRect from \"../dom-utils/getClippingRect.js\";\nimport getDocumentElement from \"../dom-utils/getDocumentElement.js\";\nimport getBoundingClientRect from \"../dom-utils/getBoundingClientRect.js\";\nimport computeOffsets from \"./computeOffsets.js\";\nimport rectToClientRect from \"./rectToClientRect.js\";\nimport { clippingParents, reference, popper, bottom, top, right, basePlacements, viewport } from \"../enums.js\";\nimport { isElement } from \"../dom-utils/instanceOf.js\";\nimport mergePaddingObject from \"./mergePaddingObject.js\";\nimport expandToHashMap from \"./expandToHashMap.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport default function detectOverflow(state, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _options = options,\n      _options$placement = _options.placement,\n      placement = _options$placement === void 0 ? state.placement : _options$placement,\n      _options$boundary = _options.boundary,\n      boundary = _options$boundary === void 0 ? clippingParents : _options$boundary,\n      _options$rootBoundary = _options.rootBoundary,\n      rootBoundary = _options$rootBoundary === void 0 ? viewport : _options$rootBoundary,\n      _options$elementConte = _options.elementContext,\n      elementContext = _options$elementConte === void 0 ? popper : _options$elementConte,\n      _options$altBoundary = _options.altBoundary,\n      altBoundary = _options$altBoundary === void 0 ? false : _options$altBoundary,\n      _options$padding = _options.padding,\n      padding = _options$padding === void 0 ? 0 : _options$padding;\n  var paddingObject = mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements));\n  var altContext = elementContext === popper ? reference : popper;\n  var popperRect = state.rects.popper;\n  var element = state.elements[altBoundary ? altContext : elementContext];\n  var clippingClientRect = getClippingRect(isElement(element) ? element : element.contextElement || getDocumentElement(state.elements.popper), boundary, rootBoundary);\n  var referenceClientRect = getBoundingClientRect(state.elements.reference);\n  var popperOffsets = computeOffsets({\n    reference: referenceClientRect,\n    element: popperRect,\n    strategy: 'absolute',\n    placement: placement\n  });\n  var popperClientRect = rectToClientRect(Object.assign({}, popperRect, popperOffsets));\n  var elementClientRect = elementContext === popper ? popperClientRect : referenceClientRect; // positive = overflowing the clipping rect\n  // 0 or negative = within the clipping rect\n\n  var overflowOffsets = {\n    top: clippingClientRect.top - elementClientRect.top + paddingObject.top,\n    bottom: elementClientRect.bottom - clippingClientRect.bottom + paddingObject.bottom,\n    left: clippingClientRect.left - elementClientRect.left + paddingObject.left,\n    right: elementClientRect.right - clippingClientRect.right + paddingObject.right\n  };\n  var offsetData = state.modifiersData.offset; // Offsets can be applied only to the popper element\n\n  if (elementContext === popper && offsetData) {\n    var offset = offsetData[placement];\n    Object.keys(overflowOffsets).forEach(function (key) {\n      var multiply = [right, bottom].indexOf(key) >= 0 ? 1 : -1;\n      var axis = [top, bottom].indexOf(key) >= 0 ? 'y' : 'x';\n      overflowOffsets[key] += offset[axis] * multiply;\n    });\n  }\n\n  return overflowOffsets;\n}","import { max as mathMax, min as mathMin } from \"./math.js\";\nexport function within(min, value, max) {\n  return mathMax(min, mathMin(value, max));\n}\nexport function withinMaxClamp(min, value, max) {\n  var v = within(min, value, max);\n  return v > max ? max : v;\n}","import { top, left, right, bottom, start } from \"../enums.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getMainAxisFromPlacement from \"../utils/getMainAxisFromPlacement.js\";\nimport getAltAxis from \"../utils/getAltAxis.js\";\nimport { within, withinMaxClamp } from \"../utils/within.js\";\nimport getLayoutRect from \"../dom-utils/getLayoutRect.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\nimport getVariation from \"../utils/getVariation.js\";\nimport getFreshSideObject from \"../utils/getFreshSideObject.js\";\nimport { min as mathMin, max as mathMax } from \"../utils/math.js\";\n\nfunction preventOverflow(_ref) {\n  var state = _ref.state,\n      options = _ref.options,\n      name = _ref.name;\n  var _options$mainAxis = options.mainAxis,\n      checkMainAxis = _options$mainAxis === void 0 ? true : _options$mainAxis,\n      _options$altAxis = options.altAxis,\n      checkAltAxis = _options$altAxis === void 0 ? false : _options$altAxis,\n      boundary = options.boundary,\n      rootBoundary = options.rootBoundary,\n      altBoundary = options.altBoundary,\n      padding = options.padding,\n      _options$tether = options.tether,\n      tether = _options$tether === void 0 ? true : _options$tether,\n      _options$tetherOffset = options.tetherOffset,\n      tetherOffset = _options$tetherOffset === void 0 ? 0 : _options$tetherOffset;\n  var overflow = detectOverflow(state, {\n    boundary: boundary,\n    rootBoundary: rootBoundary,\n    padding: padding,\n    altBoundary: altBoundary\n  });\n  var basePlacement = getBasePlacement(state.placement);\n  var variation = getVariation(state.placement);\n  var isBasePlacement = !variation;\n  var mainAxis = getMainAxisFromPlacement(basePlacement);\n  var altAxis = getAltAxis(mainAxis);\n  var popperOffsets = state.modifiersData.popperOffsets;\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var tetherOffsetValue = typeof tetherOffset === 'function' ? tetherOffset(Object.assign({}, state.rects, {\n    placement: state.placement\n  })) : tetherOffset;\n  var normalizedTetherOffsetValue = typeof tetherOffsetValue === 'number' ? {\n    mainAxis: tetherOffsetValue,\n    altAxis: tetherOffsetValue\n  } : Object.assign({\n    mainAxis: 0,\n    altAxis: 0\n  }, tetherOffsetValue);\n  var offsetModifierState = state.modifiersData.offset ? state.modifiersData.offset[state.placement] : null;\n  var data = {\n    x: 0,\n    y: 0\n  };\n\n  if (!popperOffsets) {\n    return;\n  }\n\n  if (checkMainAxis) {\n    var _offsetModifierState$;\n\n    var mainSide = mainAxis === 'y' ? top : left;\n    var altSide = mainAxis === 'y' ? bottom : right;\n    var len = mainAxis === 'y' ? 'height' : 'width';\n    var offset = popperOffsets[mainAxis];\n    var min = offset + overflow[mainSide];\n    var max = offset - overflow[altSide];\n    var additive = tether ? -popperRect[len] / 2 : 0;\n    var minLen = variation === start ? referenceRect[len] : popperRect[len];\n    var maxLen = variation === start ? -popperRect[len] : -referenceRect[len]; // We need to include the arrow in the calculation so the arrow doesn't go\n    // outside the reference bounds\n\n    var arrowElement = state.elements.arrow;\n    var arrowRect = tether && arrowElement ? getLayoutRect(arrowElement) : {\n      width: 0,\n      height: 0\n    };\n    var arrowPaddingObject = state.modifiersData['arrow#persistent'] ? state.modifiersData['arrow#persistent'].padding : getFreshSideObject();\n    var arrowPaddingMin = arrowPaddingObject[mainSide];\n    var arrowPaddingMax = arrowPaddingObject[altSide]; // If the reference length is smaller than the arrow length, we don't want\n    // to include its full size in the calculation. If the reference is small\n    // and near the edge of a boundary, the popper can overflow even if the\n    // reference is not overflowing as well (e.g. virtual elements with no\n    // width or height)\n\n    var arrowLen = within(0, referenceRect[len], arrowRect[len]);\n    var minOffset = isBasePlacement ? referenceRect[len] / 2 - additive - arrowLen - arrowPaddingMin - normalizedTetherOffsetValue.mainAxis : minLen - arrowLen - arrowPaddingMin - normalizedTetherOffsetValue.mainAxis;\n    var maxOffset = isBasePlacement ? -referenceRect[len] / 2 + additive + arrowLen + arrowPaddingMax + normalizedTetherOffsetValue.mainAxis : maxLen + arrowLen + arrowPaddingMax + normalizedTetherOffsetValue.mainAxis;\n    var arrowOffsetParent = state.elements.arrow && getOffsetParent(state.elements.arrow);\n    var clientOffset = arrowOffsetParent ? mainAxis === 'y' ? arrowOffsetParent.clientTop || 0 : arrowOffsetParent.clientLeft || 0 : 0;\n    var offsetModifierValue = (_offsetModifierState$ = offsetModifierState == null ? void 0 : offsetModifierState[mainAxis]) != null ? _offsetModifierState$ : 0;\n    var tetherMin = offset + minOffset - offsetModifierValue - clientOffset;\n    var tetherMax = offset + maxOffset - offsetModifierValue;\n    var preventedOffset = within(tether ? mathMin(min, tetherMin) : min, offset, tether ? mathMax(max, tetherMax) : max);\n    popperOffsets[mainAxis] = preventedOffset;\n    data[mainAxis] = preventedOffset - offset;\n  }\n\n  if (checkAltAxis) {\n    var _offsetModifierState$2;\n\n    var _mainSide = mainAxis === 'x' ? top : left;\n\n    var _altSide = mainAxis === 'x' ? bottom : right;\n\n    var _offset = popperOffsets[altAxis];\n\n    var _len = altAxis === 'y' ? 'height' : 'width';\n\n    var _min = _offset + overflow[_mainSide];\n\n    var _max = _offset - overflow[_altSide];\n\n    var isOriginSide = [top, left].indexOf(basePlacement) !== -1;\n\n    var _offsetModifierValue = (_offsetModifierState$2 = offsetModifierState == null ? void 0 : offsetModifierState[altAxis]) != null ? _offsetModifierState$2 : 0;\n\n    var _tetherMin = isOriginSide ? _min : _offset - referenceRect[_len] - popperRect[_len] - _offsetModifierValue + normalizedTetherOffsetValue.altAxis;\n\n    var _tetherMax = isOriginSide ? _offset + referenceRect[_len] + popperRect[_len] - _offsetModifierValue - normalizedTetherOffsetValue.altAxis : _max;\n\n    var _preventedOffset = tether && isOriginSide ? withinMaxClamp(_tetherMin, _offset, _tetherMax) : within(tether ? _tetherMin : _min, _offset, tether ? _tetherMax : _max);\n\n    popperOffsets[altAxis] = _preventedOffset;\n    data[altAxis] = _preventedOffset - _offset;\n  }\n\n  state.modifiersData[name] = data;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'preventOverflow',\n  enabled: true,\n  phase: 'main',\n  fn: preventOverflow,\n  requiresIfExists: ['offset']\n};","export default function getAltAxis(axis) {\n  return axis === 'x' ? 'y' : 'x';\n}","import getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getLayoutRect from \"../dom-utils/getLayoutRect.js\";\nimport contains from \"../dom-utils/contains.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport getMainAxisFromPlacement from \"../utils/getMainAxisFromPlacement.js\";\nimport { within } from \"../utils/within.js\";\nimport mergePaddingObject from \"../utils/mergePaddingObject.js\";\nimport expandToHashMap from \"../utils/expandToHashMap.js\";\nimport { left, right, basePlacements, top, bottom } from \"../enums.js\";\nimport { isHTMLElement } from \"../dom-utils/instanceOf.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar toPaddingObject = function toPaddingObject(padding, state) {\n  padding = typeof padding === 'function' ? padding(Object.assign({}, state.rects, {\n    placement: state.placement\n  })) : padding;\n  return mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements));\n};\n\nfunction arrow(_ref) {\n  var _state$modifiersData$;\n\n  var state = _ref.state,\n      name = _ref.name,\n      options = _ref.options;\n  var arrowElement = state.elements.arrow;\n  var popperOffsets = state.modifiersData.popperOffsets;\n  var basePlacement = getBasePlacement(state.placement);\n  var axis = getMainAxisFromPlacement(basePlacement);\n  var isVertical = [left, right].indexOf(basePlacement) >= 0;\n  var len = isVertical ? 'height' : 'width';\n\n  if (!arrowElement || !popperOffsets) {\n    return;\n  }\n\n  var paddingObject = toPaddingObject(options.padding, state);\n  var arrowRect = getLayoutRect(arrowElement);\n  var minProp = axis === 'y' ? top : left;\n  var maxProp = axis === 'y' ? bottom : right;\n  var endDiff = state.rects.reference[len] + state.rects.reference[axis] - popperOffsets[axis] - state.rects.popper[len];\n  var startDiff = popperOffsets[axis] - state.rects.reference[axis];\n  var arrowOffsetParent = getOffsetParent(arrowElement);\n  var clientSize = arrowOffsetParent ? axis === 'y' ? arrowOffsetParent.clientHeight || 0 : arrowOffsetParent.clientWidth || 0 : 0;\n  var centerToReference = endDiff / 2 - startDiff / 2; // Make sure the arrow doesn't overflow the popper if the center point is\n  // outside of the popper bounds\n\n  var min = paddingObject[minProp];\n  var max = clientSize - arrowRect[len] - paddingObject[maxProp];\n  var center = clientSize / 2 - arrowRect[len] / 2 + centerToReference;\n  var offset = within(min, center, max); // Prevents breaking syntax highlighting...\n\n  var axisProp = axis;\n  state.modifiersData[name] = (_state$modifiersData$ = {}, _state$modifiersData$[axisProp] = offset, _state$modifiersData$.centerOffset = offset - center, _state$modifiersData$);\n}\n\nfunction effect(_ref2) {\n  var state = _ref2.state,\n      options = _ref2.options;\n  var _options$element = options.element,\n      arrowElement = _options$element === void 0 ? '[data-popper-arrow]' : _options$element;\n\n  if (arrowElement == null) {\n    return;\n  } // CSS selector\n\n\n  if (typeof arrowElement === 'string') {\n    arrowElement = state.elements.popper.querySelector(arrowElement);\n\n    if (!arrowElement) {\n      return;\n    }\n  }\n\n  if (process.env.NODE_ENV !== \"production\") {\n    if (!isHTMLElement(arrowElement)) {\n      console.error(['Popper: \"arrow\" element must be an HTMLElement (not an SVGElement).', 'To use an SVG arrow, wrap it in an HTMLElement that will be used as', 'the arrow.'].join(' '));\n    }\n  }\n\n  if (!contains(state.elements.popper, arrowElement)) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(['Popper: \"arrow\" modifier\\'s `element` must be a child of the popper', 'element.'].join(' '));\n    }\n\n    return;\n  }\n\n  state.elements.arrow = arrowElement;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'arrow',\n  enabled: true,\n  phase: 'main',\n  fn: arrow,\n  effect: effect,\n  requires: ['popperOffsets'],\n  requiresIfExists: ['preventOverflow']\n};","import { top, bottom, left, right } from \"../enums.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\n\nfunction getSideOffsets(overflow, rect, preventedOffsets) {\n  if (preventedOffsets === void 0) {\n    preventedOffsets = {\n      x: 0,\n      y: 0\n    };\n  }\n\n  return {\n    top: overflow.top - rect.height - preventedOffsets.y,\n    right: overflow.right - rect.width + preventedOffsets.x,\n    bottom: overflow.bottom - rect.height + preventedOffsets.y,\n    left: overflow.left - rect.width - preventedOffsets.x\n  };\n}\n\nfunction isAnySideFullyClipped(overflow) {\n  return [top, right, bottom, left].some(function (side) {\n    return overflow[side] >= 0;\n  });\n}\n\nfunction hide(_ref) {\n  var state = _ref.state,\n      name = _ref.name;\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var preventedOffsets = state.modifiersData.preventOverflow;\n  var referenceOverflow = detectOverflow(state, {\n    elementContext: 'reference'\n  });\n  var popperAltOverflow = detectOverflow(state, {\n    altBoundary: true\n  });\n  var referenceClippingOffsets = getSideOffsets(referenceOverflow, referenceRect);\n  var popperEscapeOffsets = getSideOffsets(popperAltOverflow, popperRect, preventedOffsets);\n  var isReferenceHidden = isAnySideFullyClipped(referenceClippingOffsets);\n  var hasPopperEscaped = isAnySideFullyClipped(popperEscapeOffsets);\n  state.modifiersData[name] = {\n    referenceClippingOffsets: referenceClippingOffsets,\n    popperEscapeOffsets: popperEscapeOffsets,\n    isReferenceHidden: isReferenceHidden,\n    hasPopperEscaped: hasPopperEscaped\n  };\n  state.attributes.popper = Object.assign({}, state.attributes.popper, {\n    'data-popper-reference-hidden': isReferenceHidden,\n    'data-popper-escaped': hasPopperEscaped\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'hide',\n  enabled: true,\n  phase: 'main',\n  requiresIfExists: ['preventOverflow'],\n  fn: hide\n};","import { popperGenerator, detectOverflow } from \"./createPopper.js\";\nimport eventListeners from \"./modifiers/eventListeners.js\";\nimport popperOffsets from \"./modifiers/popperOffsets.js\";\nimport computeStyles from \"./modifiers/computeStyles.js\";\nimport applyStyles from \"./modifiers/applyStyles.js\";\nimport offset from \"./modifiers/offset.js\";\nimport flip from \"./modifiers/flip.js\";\nimport preventOverflow from \"./modifiers/preventOverflow.js\";\nimport arrow from \"./modifiers/arrow.js\";\nimport hide from \"./modifiers/hide.js\";\nvar defaultModifiers = [eventListeners, popperOffsets, computeStyles, applyStyles, offset, flip, preventOverflow, arrow, hide];\nvar createPopper = /*#__PURE__*/popperGenerator({\n  defaultModifiers: defaultModifiers\n}); // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper, popperGenerator, defaultModifiers, detectOverflow }; // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper as createPopperLite } from \"./popper-lite.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport * from \"./modifiers/index.js\";","import computeOffsets from \"../utils/computeOffsets.js\";\n\nfunction popperOffsets(_ref) {\n  var state = _ref.state,\n      name = _ref.name;\n  // Offsets are the actual position the popper needs to have to be\n  // properly positioned near its reference element\n  // This is the most basic placement, and will be adjusted by\n  // the modifiers in the next step\n  state.modifiersData[name] = computeOffsets({\n    reference: state.rects.reference,\n    element: state.rects.popper,\n    strategy: 'absolute',\n    placement: state.placement\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'popperOffsets',\n  enabled: true,\n  phase: 'read',\n  fn: popperOffsets,\n  data: {}\n};","import getBasePlacement from \"../utils/getBasePlacement.js\";\nimport { top, left, right, placements } from \"../enums.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport function distanceAndSkiddingToXY(placement, rects, offset) {\n  var basePlacement = getBasePlacement(placement);\n  var invertDistance = [left, top].indexOf(basePlacement) >= 0 ? -1 : 1;\n\n  var _ref = typeof offset === 'function' ? offset(Object.assign({}, rects, {\n    placement: placement\n  })) : offset,\n      skidding = _ref[0],\n      distance = _ref[1];\n\n  skidding = skidding || 0;\n  distance = (distance || 0) * invertDistance;\n  return [left, right].indexOf(basePlacement) >= 0 ? {\n    x: distance,\n    y: skidding\n  } : {\n    x: skidding,\n    y: distance\n  };\n}\n\nfunction offset(_ref2) {\n  var state = _ref2.state,\n      options = _ref2.options,\n      name = _ref2.name;\n  var _options$offset = options.offset,\n      offset = _options$offset === void 0 ? [0, 0] : _options$offset;\n  var data = placements.reduce(function (acc, placement) {\n    acc[placement] = distanceAndSkiddingToXY(placement, state.rects, offset);\n    return acc;\n  }, {});\n  var _data$state$placement = data[state.placement],\n      x = _data$state$placement.x,\n      y = _data$state$placement.y;\n\n  if (state.modifiersData.popperOffsets != null) {\n    state.modifiersData.popperOffsets.x += x;\n    state.modifiersData.popperOffsets.y += y;\n  }\n\n  state.modifiersData[name] = data;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'offset',\n  enabled: true,\n  phase: 'main',\n  requires: ['popperOffsets'],\n  fn: offset\n};","import getOppositePlacement from \"../utils/getOppositePlacement.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getOppositeVariationPlacement from \"../utils/getOppositeVariationPlacement.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\nimport computeAutoPlacement from \"../utils/computeAutoPlacement.js\";\nimport { bottom, top, start, right, left, auto } from \"../enums.js\";\nimport getVariation from \"../utils/getVariation.js\"; // eslint-disable-next-line import/no-unused-modules\n\nfunction getExpandedFallbackPlacements(placement) {\n  if (getBasePlacement(placement) === auto) {\n    return [];\n  }\n\n  var oppositePlacement = getOppositePlacement(placement);\n  return [getOppositeVariationPlacement(placement), oppositePlacement, getOppositeVariationPlacement(oppositePlacement)];\n}\n\nfunction flip(_ref) {\n  var state = _ref.state,\n      options = _ref.options,\n      name = _ref.name;\n\n  if (state.modifiersData[name]._skip) {\n    return;\n  }\n\n  var _options$mainAxis = options.mainAxis,\n      checkMainAxis = _options$mainAxis === void 0 ? true : _options$mainAxis,\n      _options$altAxis = options.altAxis,\n      checkAltAxis = _options$altAxis === void 0 ? true : _options$altAxis,\n      specifiedFallbackPlacements = options.fallbackPlacements,\n      padding = options.padding,\n      boundary = options.boundary,\n      rootBoundary = options.rootBoundary,\n      altBoundary = options.altBoundary,\n      _options$flipVariatio = options.flipVariations,\n      flipVariations = _options$flipVariatio === void 0 ? true : _options$flipVariatio,\n      allowedAutoPlacements = options.allowedAutoPlacements;\n  var preferredPlacement = state.options.placement;\n  var basePlacement = getBasePlacement(preferredPlacement);\n  var isBasePlacement = basePlacement === preferredPlacement;\n  var fallbackPlacements = specifiedFallbackPlacements || (isBasePlacement || !flipVariations ? [getOppositePlacement(preferredPlacement)] : getExpandedFallbackPlacements(preferredPlacement));\n  var placements = [preferredPlacement].concat(fallbackPlacements).reduce(function (acc, placement) {\n    return acc.concat(getBasePlacement(placement) === auto ? computeAutoPlacement(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      padding: padding,\n      flipVariations: flipVariations,\n      allowedAutoPlacements: allowedAutoPlacements\n    }) : placement);\n  }, []);\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var checksMap = new Map();\n  var makeFallbackChecks = true;\n  var firstFittingPlacement = placements[0];\n\n  for (var i = 0; i < placements.length; i++) {\n    var placement = placements[i];\n\n    var _basePlacement = getBasePlacement(placement);\n\n    var isStartVariation = getVariation(placement) === start;\n    var isVertical = [top, bottom].indexOf(_basePlacement) >= 0;\n    var len = isVertical ? 'width' : 'height';\n    var overflow = detectOverflow(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      altBoundary: altBoundary,\n      padding: padding\n    });\n    var mainVariationSide = isVertical ? isStartVariation ? right : left : isStartVariation ? bottom : top;\n\n    if (referenceRect[len] > popperRect[len]) {\n      mainVariationSide = getOppositePlacement(mainVariationSide);\n    }\n\n    var altVariationSide = getOppositePlacement(mainVariationSide);\n    var checks = [];\n\n    if (checkMainAxis) {\n      checks.push(overflow[_basePlacement] <= 0);\n    }\n\n    if (checkAltAxis) {\n      checks.push(overflow[mainVariationSide] <= 0, overflow[altVariationSide] <= 0);\n    }\n\n    if (checks.every(function (check) {\n      return check;\n    })) {\n      firstFittingPlacement = placement;\n      makeFallbackChecks = false;\n      break;\n    }\n\n    checksMap.set(placement, checks);\n  }\n\n  if (makeFallbackChecks) {\n    // `2` may be desired in some cases – research later\n    var numberOfChecks = flipVariations ? 3 : 1;\n\n    var _loop = function _loop(_i) {\n      var fittingPlacement = placements.find(function (placement) {\n        var checks = checksMap.get(placement);\n\n        if (checks) {\n          return checks.slice(0, _i).every(function (check) {\n            return check;\n          });\n        }\n      });\n\n      if (fittingPlacement) {\n        firstFittingPlacement = fittingPlacement;\n        return \"break\";\n      }\n    };\n\n    for (var _i = numberOfChecks; _i > 0; _i--) {\n      var _ret = _loop(_i);\n\n      if (_ret === \"break\") break;\n    }\n  }\n\n  if (state.placement !== firstFittingPlacement) {\n    state.modifiersData[name]._skip = true;\n    state.placement = firstFittingPlacement;\n    state.reset = true;\n  }\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'flip',\n  enabled: true,\n  phase: 'main',\n  fn: flip,\n  requiresIfExists: ['offset'],\n  data: {\n    _skip: false\n  }\n};","import getVariation from \"./getVariation.js\";\nimport { variationPlacements, basePlacements, placements as allPlacements } from \"../enums.js\";\nimport detectOverflow from \"./detectOverflow.js\";\nimport getBasePlacement from \"./getBasePlacement.js\";\nexport default function computeAutoPlacement(state, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _options = options,\n      placement = _options.placement,\n      boundary = _options.boundary,\n      rootBoundary = _options.rootBoundary,\n      padding = _options.padding,\n      flipVariations = _options.flipVariations,\n      _options$allowedAutoP = _options.allowedAutoPlacements,\n      allowedAutoPlacements = _options$allowedAutoP === void 0 ? allPlacements : _options$allowedAutoP;\n  var variation = getVariation(placement);\n  var placements = variation ? flipVariations ? variationPlacements : variationPlacements.filter(function (placement) {\n    return getVariation(placement) === variation;\n  }) : basePlacements;\n  var allowedPlacements = placements.filter(function (placement) {\n    return allowedAutoPlacements.indexOf(placement) >= 0;\n  });\n\n  if (allowedPlacements.length === 0) {\n    allowedPlacements = placements;\n\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(['Popper: The `allowedAutoPlacements` option did not allow any', 'placements. Ensure the `placement` option matches the variation', 'of the allowed placements.', 'For example, \"auto\" cannot be used to allow \"bottom-start\".', 'Use \"auto-start\" instead.'].join(' '));\n    }\n  } // $FlowFixMe[incompatible-type]: Flow seems to have problems with two array unions...\n\n\n  var overflows = allowedPlacements.reduce(function (acc, placement) {\n    acc[placement] = detectOverflow(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      padding: padding\n    })[getBasePlacement(placement)];\n    return acc;\n  }, {});\n  return Object.keys(overflows).sort(function (a, b) {\n    return overflows[a] - overflows[b];\n  });\n}","import { createPopper, Placement, Instance } from '@popperjs/core';\nimport type DialogManager from './DialogManager';\nimport { cssClass } from '../../styles';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport type { ILivePreviewOptions } from '../../config';\n\nexport interface IDialogOptions {\n  title: string;\n  livePreview: boolean | keyof ILivePreviewOptions;\n  popup: boolean;\n  // popper options\n  placement?: Placement;\n  eventsEnabled?: boolean;\n  toggleDialog: boolean;\n  cancelSubDialogs?: boolean;\n  autoClose?: boolean;\n}\n\nexport interface IDialogContext {\n  attachment: HTMLElement;\n  level: number;\n  manager: DialogManager;\n  idPrefix: string;\n  sanitize(v: string, dontSanitize?: boolean): string;\n}\n\nexport function dialogContext(\n  ctx: IRankingHeaderContext,\n  level: number,\n  attachment: HTMLElement | MouseEvent\n): IDialogContext {\n  return {\n    attachment:\n      (attachment as MouseEvent).currentTarget != null\n        ? ((attachment as MouseEvent).currentTarget as HTMLElement)\n        : (attachment as HTMLElement),\n    level,\n    manager: ctx.dialogManager,\n    idPrefix: ctx.idPrefix,\n    sanitize: ctx.sanitize,\n  };\n}\n\nabstract class ADialog {\n  private readonly options: Readonly<IDialogOptions> = {\n    title: '',\n    livePreview: false,\n    popup: false,\n    placement: 'bottom-start',\n    toggleDialog: true,\n    cancelSubDialogs: false,\n    autoClose: false,\n  };\n\n  readonly node: HTMLFormElement;\n  private popper: Instance | null = null;\n\n  constructor(protected readonly dialog: Readonly<IDialogContext>, options: Partial<IDialogOptions> = {}) {\n    Object.assign(this.options, options);\n    this.node = dialog.attachment.ownerDocument!.createElement('form');\n    this.node.classList.add(cssClass('dialog'));\n  }\n\n  get autoClose() {\n    return this.options.autoClose;\n  }\n\n  get attachment() {\n    return this.dialog.attachment;\n  }\n\n  get level() {\n    return this.dialog.level;\n  }\n\n  protected abstract build(node: HTMLElement): boolean | void;\n\n  protected showLivePreviews() {\n    return (\n      this.options.livePreview === true ||\n      (typeof this.options.livePreview === 'string' &&\n        this.dialog.manager.livePreviews[this.options.livePreview] === true)\n    );\n  }\n\n  protected enableLivePreviews(selector: string | (HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement)[]) {\n    if (!this.showLivePreviews()) {\n      return;\n    }\n    const submitter = () => {\n      this.submit();\n    };\n    if (typeof selector === 'string') {\n      this.forEach(selector, (n: HTMLInputElement | HTMLSelectElement) => {\n        n.addEventListener('change', submitter, { passive: true });\n      });\n    } else {\n      selector.forEach((n) => {\n        n.addEventListener('change', submitter, { passive: true });\n      });\n    }\n  }\n\n  equals(that: ADialog) {\n    return this.dialog.level === that.dialog.level && this.dialog.attachment === that.dialog.attachment;\n  }\n\n  protected appendDialogButtons() {\n    this.node.insertAdjacentHTML(\n      'beforeend',\n      `<div class=\"${cssClass('dialog-buttons')}\">\n      <button class=\"${cssClass('dialog-button')}\" type=\"submit\" title=\"Apply\"></button>\n      <button class=\"${cssClass('dialog-button')}\" type=\"button\" title=\"Cancel\"></button>\n      <button class=\"${cssClass('dialog-button')}\" type=\"reset\" title=\"Reset to default values\"></button>\n    </div>`\n    );\n  }\n\n  open() {\n    if (this.options.toggleDialog && this.dialog.manager.removeLike(this)) {\n      return;\n    }\n    if (this.build(this.node) === false) {\n      return;\n    }\n    const parent = this.attachment.closest<HTMLElement>(`.${cssClass()}`)!;\n\n    if (this.options.title) {\n      const title = this.node.ownerDocument!.createElement('strong');\n      title.textContent = this.options.title;\n      this.node.insertAdjacentElement('afterbegin', title);\n    }\n    if (!this.options.popup) {\n      this.appendDialogButtons();\n    }\n\n    parent.appendChild(this.node);\n    this.popper = createPopper(this.attachment, this.node, {\n      modifiers: [\n        {\n          name: 'preventOverflow',\n          options: {\n            boundariesElement: parent,\n          },\n        },\n      ],\n      ...this.options,\n    });\n\n    const auto = this.find<HTMLInputElement>('input[autofocus]');\n    if (auto) {\n      // delay such that it works\n      setTimeout(() => auto.focus());\n    }\n\n    const reset = this.find<HTMLButtonElement>('button[type=reset]');\n    if (reset) {\n      reset.onclick = (evt) => {\n        evt.stopPropagation();\n        evt.preventDefault();\n        this.reset();\n        if (this.showLivePreviews()) {\n          this.submit();\n        }\n      };\n    }\n    this.node.onsubmit = (evt) => {\n      evt.stopPropagation();\n      evt.preventDefault();\n      return this.triggerSubmit();\n    };\n    const cancel = this.find<HTMLButtonElement>('button[title=Cancel]');\n    if (cancel) {\n      cancel.onclick = (evt) => {\n        evt.stopPropagation();\n        evt.preventDefault();\n        this.cancel();\n        this.destroy('cancel');\n      };\n    }\n\n    if (this.options.cancelSubDialogs) {\n      this.node.addEventListener('click', () => {\n        this.dialog.manager.removeAboveLevel(this.dialog.level + 1);\n      });\n    }\n\n    this.dialog.manager.push(this);\n  }\n\n  protected triggerSubmit() {\n    if (!this.node.checkValidity()) {\n      return false;\n    }\n    if (this.submit() !== false) {\n      this.destroy('confirm');\n    }\n    return false;\n  }\n\n  protected find<T extends HTMLElement>(selector: string): T {\n    return this.node.querySelector<T>(selector);\n  }\n\n  protected findInput(selector: string) {\n    return this.find<HTMLInputElement>(selector);\n  }\n\n  protected forEach<M extends Element, T>(selector: string, callback: (d: M, i: number) => T): T[] {\n    return Array.from(this.node.querySelectorAll<M>(selector)).map(callback);\n  }\n\n  protected abstract reset(): void;\n\n  protected abstract submit(): boolean | undefined;\n\n  protected abstract cancel(): void;\n\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\n    if (action === 'confirm') {\n      this.submit(); // TODO what if submit wasn't successful?\n    } else if (action === 'cancel') {\n      this.cancel();\n    }\n\n    if (action !== 'handled') {\n      this.dialog.manager.triggerDialogClosed(this, action);\n    }\n\n    if (this.popper) {\n      this.popper.destroy();\n    }\n    this.node.remove();\n  }\n\n  protected destroy(action: 'cancel' | 'confirm' = 'cancel') {\n    this.dialog.manager.triggerDialogClosed(this, action);\n    this.dialog.manager.remove(this, true);\n  }\n}\n\nexport default ADialog;\n","import ADialog, { IDialogContext, IDialogOptions } from './ADialog';\n\nabstract class APopup extends ADialog {\n  constructor(dialog: Readonly<IDialogContext>, options: Partial<IDialogOptions> = {}) {\n    super(\n      dialog,\n      Object.assign(\n        {\n          popup: true,\n        },\n        options\n      )\n    );\n  }\n\n  protected submit() {\n    return true;\n  }\n\n  protected reset() {\n    // dummy\n  }\n\n  protected cancel() {\n    // dummy\n  }\n}\n\nexport default APopup;\n","import type { IDialogContext } from './ADialog';\nimport APopup from './APopup';\n\n/** @internal */\nexport interface IInputNumberOptions {\n  min: number;\n  max: number;\n  step: number | 'any';\n  value: number;\n  label: string | null;\n}\n\n/** @internal */\nexport default class InputNumberDialog extends APopup {\n  private readonly ioptions: Readonly<IInputNumberOptions> = {\n    min: NaN,\n    max: NaN,\n    step: 'any',\n    value: NaN,\n    label: null,\n  };\n\n  constructor(\n    dialog: IDialogContext,\n    private readonly callback: (value: number) => void,\n    options: Partial<IInputNumberOptions> = {}\n  ) {\n    super(dialog);\n    Object.assign(this.ioptions, options);\n  }\n\n  protected build(node: HTMLElement) {\n    const o = this.ioptions;\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n     <input type=\"number\" value=\"${\n       Number.isNaN(o.value) ? '' : String(o.value)\n     }\" required autofocus placeholder=\"${this.dialog.sanitize(o.label ? o.label : 'enter number')}\" ${\n        Number.isNaN(o.min) ? '' : ` min=\"${o.min}\"`\n      } ${Number.isNaN(o.max) ? '' : ` max=\"${o.max}\"`} step=\"${o.step}\">\n    `\n    );\n    this.enableLivePreviews('input');\n  }\n\n  submit() {\n    this.callback(this.findInput('input[type=number]').valueAsNumber);\n    return true;\n  }\n}\n","import { cssClass } from '../styles';\n\n/** @internal */\nexport interface IDragHandleOptions {\n  /**\n   * drag base container\n   * @default handle parentElement\n   */\n  container: HTMLElement | SVGElement;\n  /**\n   * filter to certain mouse events, e.g. shift only\n   */\n  filter(evt: MouseEvent): boolean;\n\n  onStart(handle: HTMLElement | SVGElement, x: number, delta: number, evt: MouseEvent): void;\n\n  onDrag(handle: HTMLElement | SVGElement, x: number, delta: number, evt: MouseEvent): void;\n\n  onEnd(handle: HTMLElement | SVGElement, x: number, delta: number, evt: MouseEvent): void;\n\n  /**\n   * minimal pixel delta\n   * @default 2\n   */\n  minDelta: number;\n}\n\n/**\n * allow to change the width of a column using dragging the handle\n * @internal\n */\nexport function dragHandle(handle: HTMLElement | SVGElement, options: Partial<IDragHandleOptions> = {}) {\n  const o: Readonly<IDragHandleOptions> = Object.assign(\n    {\n      container: handle.parentElement!,\n      filter: () => true,\n      onStart: () => undefined,\n      onDrag: () => undefined,\n      onEnd: () => undefined,\n      minDelta: 2,\n    },\n    options\n  );\n\n  let ueberElement: HTMLElement | null = null;\n\n  // converts the given x coordinate to be relative to the given element\n  const toContainerRelative = (x: number, elem: HTMLElement | SVGElement) => {\n    const rect = elem.getBoundingClientRect();\n    return x - rect.left - elem.clientLeft;\n  };\n\n  let start = 0;\n  let last = 0;\n  let handleShift = 0;\n\n  const mouseMove = (evt: MouseEvent) => {\n    if (!o.filter(evt)) {\n      return;\n    }\n    evt.stopPropagation();\n    evt.preventDefault();\n\n    const end = toContainerRelative(evt.clientX, o.container) - handleShift;\n    if (Math.abs(last - end) < o.minDelta) {\n      //ignore\n      return;\n    }\n\n    last = end;\n    o.onDrag(handle, end, last - end, evt);\n  };\n\n  const mouseUp = (evt: MouseEvent) => {\n    if (!o.filter(evt)) {\n      return;\n    }\n    evt.stopPropagation();\n    evt.preventDefault();\n\n    const end = toContainerRelative(evt.clientX, o.container) - handleShift;\n    ueberElement!.removeEventListener('mousemove', mouseMove);\n    ueberElement!.removeEventListener('mouseup', mouseUp);\n    ueberElement!.removeEventListener('mouseleave', mouseUp);\n    ueberElement!.classList.remove(cssClass('dragging'));\n\n    if (Math.abs(start - end) < 2) {\n      //ignore\n      return;\n    }\n\n    o.onEnd(handle, end, start - end, evt);\n  };\n\n  handle.onmousedown = (evt) => {\n    if (!o.filter(evt)) {\n      return;\n    }\n    evt.stopPropagation();\n    evt.preventDefault();\n\n    handleShift = toContainerRelative(evt.clientX, handle);\n    start = last = toContainerRelative(evt.clientX, o.container) - handleShift;\n\n    // register other event listeners\n    ueberElement = handle.closest('body') || handle.closest<HTMLElement>(`.${cssClass()}`)!; // take the whole body or root lineup\n    ueberElement.addEventListener('mousemove', mouseMove);\n    ueberElement.addEventListener('mouseup', mouseUp);\n    ueberElement.addEventListener('mouseleave', mouseUp);\n    ueberElement.classList.add(cssClass('dragging'));\n\n    o.onStart(handle, start, 0, evt);\n  };\n}\n","import { DENSE_HISTOGRAM } from '../constants';\nimport { IBin, round, IDragHandleOptions, dragHandle } from '../internal';\nimport { cssClass, FILTERED_OPACITY } from '../styles';\nimport { color } from 'd3-color';\nimport { filterMissingNumberMarkup, updateFilterMissingNumberMarkup } from '../ui/missing';\n\nfunction filteredColor(input: string) {\n  const c = color(input)!;\n  c.opacity = FILTERED_OPACITY;\n  return c.toString();\n}\n\nexport function histogramTemplate(guessedBins: number) {\n  let bins = '';\n  for (let i = 0; i < guessedBins; ++i) {\n    bins += `<div class=\"${cssClass(\n      'histogram-bin'\n    )}\" title=\"Bin ${i}: 0\" data-x=\"\"><div style=\"height: 0\" ></div></div>`;\n  }\n  // no closing div to be able to append things\n  return `<div class=\"${cssClass('histogram')} ${guessedBins > DENSE_HISTOGRAM ? cssClass('dense') : ''}\">${bins}`;\n}\n\nfunction matchBins(n: HTMLElement, bins: number) {\n  //adapt the number of children\n  let nodes = Array.from(n.querySelectorAll<HTMLElement>('[data-x]'));\n  if (nodes.length > bins) {\n    nodes.splice(bins, nodes.length - bins).forEach((d) => d.remove());\n  } else if (nodes.length < bins) {\n    for (let i = nodes.length; i < bins; ++i) {\n      n.insertAdjacentHTML(\n        'afterbegin',\n        `<div class=\"${cssClass('histogram-bin')}\" title=\"Bin ${i}: 0\" data-x=\"\"><div style=\"height: 0\" ></div></div>`\n      );\n    }\n    nodes = Array.from(n.querySelectorAll('[data-x]'));\n  }\n  n.classList.toggle(cssClass('dense'), bins > DENSE_HISTOGRAM);\n  return nodes;\n}\n\nexport interface IHistogramLike<T> {\n  readonly maxBin: number;\n  readonly hist: ReadonlyArray<IBin<T>>;\n}\n\n/** @internal */\nexport function histogramUpdate<T>(\n  n: HTMLElement,\n  stats: IHistogramLike<T>,\n  unfiltered: IHistogramLike<T> | null,\n  formatter: (v: T) => string,\n  colorOf: (bin: IBin<T>) => string\n) {\n  const hist = stats.hist;\n  const nodes = matchBins(n, hist.length);\n\n  nodes.forEach((d: HTMLElement, i) => {\n    const bin = hist[i];\n    const inner = d.firstElementChild! as HTMLElement;\n    if (!bin) {\n      inner.style.height = '0%';\n      return;\n    }\n\n    const { x0, x1, count } = bin;\n    const color = colorOf(bin);\n    d.dataset.x = formatter(x0);\n\n    if (unfiltered) {\n      const gCount = (unfiltered.hist[i] || { count }).count;\n      d.title = `${formatter(x0)} - ${formatter(x1)} (${count} of ${gCount})`;\n      inner.style.height = `${round((gCount * 100) / unfiltered.maxBin, 2)}%`;\n      const relY = 100 - round((count * 100) / gCount, 2);\n      inner.style.background =\n        relY === 0\n          ? color\n          : relY === 100\n          ? filteredColor(color)\n          : `linear-gradient(${filteredColor(color)} ${relY}%, ${color} ${relY}%, ${color} 100%)`;\n    } else {\n      d.title = `${formatter(x0)} - ${formatter(x1)} (${count})`;\n      inner.style.height = `${round((count * 100) / stats.maxBin, 2)}%`;\n      inner.style.backgroundColor = color;\n    }\n  });\n}\n\n/**\n * @internal\n */\nexport function mappingHintTemplate(range: [string, string]) {\n  return `<span class=\"${cssClass('mapping-hint')}\" title=\"${range[0]}\">${range[0]}</span><span class=\"${cssClass(\n    'mapping-hint'\n  )}\" title=\"${range[1]}\">${range[1]}</span>`;\n}\n\n/**\n * @internal\n */\nexport function mappingHintUpdate(n: HTMLElement, range: [string, string]) {\n  Array.from(n.getElementsByTagName('span')).forEach((d: HTMLElement, i) => (d.textContent = range[i]));\n}\n\nexport interface IFilterContext<T> {\n  percent(v: T): number;\n  unpercent(p: number): T;\n  format(v: T): string;\n  formatRaw(v: T): string;\n  parseRaw(v: string): T;\n  setFilter(filterMissing: boolean, min: T, max: T): void;\n  edit(value: T, attachment: HTMLElement, type: 'min' | 'max'): Promise<T>;\n  domain: [T, T];\n}\n\n/** @internal */\nexport interface IFilterInfo<T> {\n  filterMissing: boolean;\n  filterMin: T;\n  filterMax: T;\n}\n\nexport function filteredHistTemplate<T>(c: IFilterContext<T>, f: IFilterInfo<T>) {\n  return `\n    <div class=\"${cssClass('histogram-min-hint')}\" style=\"width: ${c.percent(f.filterMin)}%\"></div>\n    <div class=\"${cssClass('histogram-max-hint')}\" style=\"width: ${100 - c.percent(f.filterMax)}%\"></div>\n    <div class=\"${cssClass('histogram-min')}\" data-value=\"${c.format(f.filterMin)}\" data-raw=\"${c.formatRaw(\n    f.filterMin\n  )}\" style=\"left: ${c.percent(f.filterMin)}%\" title=\"min filter, drag or double click to change\"></div>\n    <div class=\"${cssClass('histogram-max')}\" data-value=\"${c.format(f.filterMax)}\" data-raw=\"${c.formatRaw(\n    f.filterMax\n  )}\" style=\"right: ${100 - c.percent(f.filterMax)}%\" title=\"max filter, drag or double click to change\"></div>\n    ${filterMissingNumberMarkup(f.filterMissing, 0)}\n  `;\n}\n\nexport function initFilter<T>(node: HTMLElement, context: IFilterContext<T>) {\n  const min = node.getElementsByClassName(cssClass('histogram-min'))[0] as HTMLElement;\n  const max = node.getElementsByClassName(cssClass('histogram-max'))[0] as HTMLElement;\n  const minHint = node.getElementsByClassName(cssClass('histogram-min-hint'))[0] as HTMLElement;\n  const maxHint = node.getElementsByClassName(cssClass('histogram-max-hint'))[0] as HTMLElement;\n  const filterMissing = node.getElementsByTagName('input')[0] as HTMLInputElement;\n\n  const setFilter = () => {\n    const minValue = context.parseRaw(min.dataset.raw!);\n    const maxValue = context.parseRaw(max.dataset.raw!);\n    context.setFilter(filterMissing.checked, minValue, maxValue);\n  };\n\n  const minImpl = (evt: MouseEvent) => {\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    const value = context.parseRaw(min.dataset.raw!);\n\n    context.edit(value, min, 'min').then((newValue) => {\n      minHint.style.width = `${context.percent(newValue)}%`;\n      min.dataset.value = context.format(newValue);\n      min.dataset.raw = context.formatRaw(newValue);\n      min.style.left = `${context.percent(newValue)}%`;\n      min.classList.toggle(cssClass('swap-hint'), context.percent(newValue) > 15);\n      setFilter();\n    });\n  };\n\n  min.onclick = (evt) => {\n    if (!evt.shiftKey && !evt.ctrlKey) {\n      return;\n    }\n    minImpl(evt);\n  };\n  min.ondblclick = minImpl;\n\n  const maxImpl = (evt: MouseEvent) => {\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    const value = context.parseRaw(max.dataset.raw!);\n\n    context.edit(value, max, 'max').then((newValue) => {\n      maxHint.style.width = `${100 - context.percent(newValue)}%`;\n      max.dataset.value = context.format(newValue);\n      max.dataset.raw = context.formatRaw(newValue);\n      max.style.right = `${100 - context.percent(newValue)}%`;\n      max.classList.toggle(cssClass('swap-hint'), context.percent(newValue) < 85);\n      setFilter();\n    });\n  };\n\n  max.onclick = (evt) => {\n    if (!evt.shiftKey && !evt.ctrlKey) {\n      return;\n    }\n    maxImpl(evt);\n  };\n  max.ondblclick = maxImpl;\n\n  filterMissing.onchange = () => setFilter();\n\n  const options: Partial<IDragHandleOptions> = {\n    minDelta: 0,\n    filter: (evt) => evt.button === 0 && !evt.shiftKey && !evt.ctrlKey,\n    onStart: (handle) => handle.classList.add(cssClass('hist-dragging')),\n    onDrag: (handle, x) => {\n      const total = node.clientWidth;\n      const px = Math.max(0, Math.min(x, total));\n      const percent = Math.round((100 * px) / total);\n      (handle as HTMLElement).dataset.value = context.format(context.unpercent(percent));\n      (handle as HTMLElement).dataset.raw = context.formatRaw(context.unpercent(percent));\n\n      if ((handle as HTMLElement).classList.contains(cssClass('histogram-min'))) {\n        handle.style.left = `${percent}%`;\n        handle.classList.toggle(cssClass('swap-hint'), percent > 15);\n        minHint.style.width = `${percent}%`;\n        return;\n      }\n      handle.style.right = `${100 - percent}%`;\n      handle.classList.toggle(cssClass('swap-hint'), percent < 85);\n      maxHint.style.width = `${100 - percent}%`;\n    },\n    onEnd: (handle) => {\n      handle.classList.remove(cssClass('hist-dragging'));\n      setFilter();\n    },\n  };\n  dragHandle(min, options);\n  dragHandle(max, options);\n\n  return (missing: number, f: IFilterInfo<T>) => {\n    minHint.style.width = `${context.percent(f.filterMin)}%`;\n    maxHint.style.width = `${100 - context.percent(f.filterMax)}%`;\n    min.dataset.value = context.format(f.filterMin);\n    max.dataset.value = context.format(f.filterMax);\n    min.dataset.raw = context.formatRaw(f.filterMin);\n    max.dataset.raw = context.formatRaw(f.filterMax);\n    min.style.left = `${context.percent(f.filterMin)}%`;\n    max.style.right = `${100 - context.percent(f.filterMax)}%`;\n    min.classList.toggle(cssClass('swap-hint'), context.percent(f.filterMin) > 15);\n    max.classList.toggle(cssClass('swap-hint'), context.percent(f.filterMax) < 85);\n    filterMissing.checked = f.filterMissing;\n    updateFilterMissingNumberMarkup(filterMissing.parentElement as HTMLElement, missing);\n  };\n}\n","import { numberStatsBuilder, IStatistics, getNumberOfBins } from '../internal';\nimport {\n  Column,\n  IDataRow,\n  IOrderedGroup,\n  INumberColumn,\n  INumbersColumn,\n  isNumberColumn,\n  isNumbersColumn,\n  IMapAbleColumn,\n  isMapAbleColumn,\n  Ranking,\n} from '../model';\nimport InputNumberDialog from '../ui/dialogs/InputNumberDialog';\nimport { colorOf } from './impose';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  IImposer,\n  IRenderTasks,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { cssClass, engineCssClass } from '../styles';\nimport {\n  histogramUpdate,\n  histogramTemplate,\n  IHistogramLike,\n  mappingHintTemplate,\n  mappingHintUpdate,\n  IFilterInfo,\n  filteredHistTemplate,\n  IFilterContext,\n  initFilter,\n} from './histogram';\nimport { noNumberFilter } from '../model/internalNumber';\nimport type DialogManager from '../ui/dialogs/DialogManager';\n\nexport default class HistogramCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Histogram';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return (isNumberColumn(col) && mode !== ERenderMode.CELL) || (isNumbersColumn(col) && mode === ERenderMode.CELL);\n  }\n\n  create(col: INumbersColumn, _context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const { template, render, guessedBins } = getHistDOMRenderer(col, imposer);\n    return {\n      template: `${template}</div>`,\n      update: (n: HTMLElement, row: IDataRow) => {\n        if (renderMissingDOM(n, col, row)) {\n          return;\n        }\n        const b = numberStatsBuilder([0, 1], guessedBins);\n        for (const n of col.getNumbers(row)) {\n          b.push(n);\n        }\n        const hist = b.build();\n        render(n, hist);\n      },\n    };\n  }\n\n  createGroup(col: INumberColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\n    const { template, render } = getHistDOMRenderer(col, imposer);\n    return {\n      template: `${template}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks.groupNumberStats(col, group).then((r) => {\n          if (typeof r === 'symbol') {\n            return;\n          }\n          const isMissing = !r || r.group == null || r.group.count === 0 || r.group.count === r.group.missing;\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n\n          const { summary, group } = r;\n          render(n, group, summary);\n        });\n      },\n    };\n  }\n\n  createSummary(\n    col: INumberColumn,\n    context: IRenderContext,\n    interactive: boolean,\n    imposer?: IImposer\n  ): ISummaryRenderer {\n    const r = getHistDOMRenderer(col, imposer);\n\n    const staticHist = !interactive || !isMapAbleColumn(col);\n    return staticHist\n      ? staticSummary(col, context, r.template, r.render)\n      : interactiveSummary(col as IMapAbleColumn, context, r.template, r.render);\n  }\n}\n\nfunction staticSummary(\n  col: INumberColumn,\n  context: IRenderContext,\n  template: string,\n  render: (n: HTMLElement, stats: IStatistics, unfiltered?: IStatistics) => void\n) {\n  if (isMapAbleColumn(col)) {\n    template += mappingHintTemplate(col.getRange());\n  }\n  return {\n    template: `${template}</div>`,\n    update: (node: HTMLElement) => {\n      if (isMapAbleColumn(col)) {\n        mappingHintUpdate(node, col.getRange());\n      }\n\n      return context.tasks.summaryNumberStats(col).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const isMissing = !r || r.summary == null || r.summary.count === 0 || r.summary.count === r.summary.missing;\n        node.classList.toggle(cssClass('missing'), isMissing);\n        if (isMissing) {\n          return;\n        }\n        render(node, r.summary);\n      });\n    },\n  };\n}\n\nfunction interactiveSummary(\n  col: IMapAbleColumn,\n  context: IRenderContext,\n  template: string,\n  render: (n: HTMLElement, stats: IStatistics, unfiltered?: IStatistics) => void\n) {\n  const fContext = createFilterContext(col, context);\n  template += filteredHistTemplate(fContext, createFilterInfo(col));\n\n  let updateFilter: (missing: number, f: IFilterInfo<number>) => void;\n\n  return {\n    template: `${template}</div>`,\n    update: (node: HTMLElement) => {\n      if (!updateFilter) {\n        updateFilter = initFilter(node, fContext);\n      }\n      return context.tasks.summaryNumberStats(col, true /* raw */).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const { summary, data } = r;\n\n        updateFilter(data ? data.missing : summary ? summary.missing : 0, createFilterInfo(col));\n\n        node.classList.add(cssClass('histogram-i'));\n        node.classList.toggle(cssClass('missing'), !summary);\n        if (!summary) {\n          return;\n        }\n        render(node, summary, data);\n      });\n    },\n  };\n}\n\n/** @internal */\nexport function createNumberFilter(\n  col: INumberColumn & IMapAbleColumn,\n  parent: HTMLElement,\n  context: { idPrefix: string; dialogManager: DialogManager; tasks: IRenderTasks; sanitize: (v: string) => string },\n  livePreviews: boolean\n) {\n  const renderer = getHistDOMRenderer(col);\n  const fContext = createFilterContext(col, context);\n\n  parent.innerHTML = `${renderer.template}${filteredHistTemplate(fContext, createFilterInfo(col))}</div>`;\n  const summaryNode = parent.firstElementChild! as HTMLElement;\n  summaryNode.classList.add(cssClass('summary'), cssClass('renderer'));\n  summaryNode.dataset.renderer = 'histogram';\n  summaryNode.dataset.interactive = '';\n  summaryNode.classList.add(cssClass('histogram-i'));\n\n  const applyFilter = fContext.setFilter;\n  let currentFilter = createFilterInfo(col);\n  fContext.setFilter = (filterMissing, min, max) => {\n    currentFilter = { filterMissing, filterMin: min, filterMax: max };\n    if (livePreviews) {\n      applyFilter(filterMissing, min, max);\n    }\n  };\n\n  const updateFilter = initFilter(summaryNode, fContext);\n\n  const rerender = () => {\n    const ready = context.tasks.summaryNumberStats(col, true /* raw */).then((r) => {\n      if (typeof r === 'symbol') {\n        return;\n      }\n      const { summary, data } = r;\n      updateFilter(data ? data.missing : summary ? summary.missing : 0, currentFilter);\n      summaryNode.classList.toggle(cssClass('missing'), !summary);\n      if (!summary) {\n        return;\n      }\n      renderer.render(summaryNode, summary, data);\n    });\n    if (!ready) {\n      return;\n    }\n    summaryNode.classList.add(engineCssClass('loading'));\n    ready.then(() => {\n      summaryNode.classList.remove(engineCssClass('loading'));\n    });\n  };\n\n  const ranking = col.findMyRanker()!;\n\n  if (ranking) {\n    ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.numberFilter`, () => rerender());\n  }\n  rerender();\n\n  return {\n    cleanUp() {\n      if (ranking) {\n        ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.numberFilter`, null);\n      }\n    },\n    reset() {\n      currentFilter = createFilterInfo(col, noNumberFilter());\n      rerender();\n    },\n    submit() {\n      applyFilter(currentFilter.filterMissing, currentFilter.filterMin, currentFilter.filterMax);\n    },\n  };\n}\n\n/** @internal */\nexport function getHistDOMRenderer(col: INumberColumn, imposer?: IImposer) {\n  const ranking = col.findMyRanker();\n  const guessedBins = ranking ? getNumberOfBins(ranking.getOrderLength()) : 10;\n  const formatter = col.getNumberFormat();\n\n  const render = (n: HTMLElement, stats: IHistogramLike<number>, unfiltered?: IHistogramLike<number>) => {\n    return histogramUpdate(\n      n,\n      stats,\n      unfiltered || null,\n      formatter,\n      (bin) => colorOf(col, null, imposer, (bin.x1 + bin.x0) / 2)!\n    );\n  };\n  return {\n    template: histogramTemplate(guessedBins),\n    render,\n    guessedBins,\n  };\n}\n\nfunction createFilterInfo(col: IMapAbleColumn, filter = col.getFilter()): IFilterInfo<number> {\n  const domain = col.getMapping().domain;\n  const filterMin = isFinite(filter.min) ? filter.min : domain[0];\n  const filterMax = isFinite(filter.max) ? filter.max : domain[1];\n  return {\n    filterMissing: filter.filterMissing,\n    filterMin,\n    filterMax,\n  };\n}\n\nfunction createFilterContext(\n  col: IMapAbleColumn,\n  context: { idPrefix: string; dialogManager: DialogManager; sanitize: (v: string) => string }\n): IFilterContext<number> {\n  const domain = col.getMapping().domain;\n  const format = col.getNumberFormat();\n  const clamp = (v: number) => Math.max(0, Math.min(100, v));\n  const percent = (v: number) => clamp(Math.round((100 * (v - domain[0])) / (domain[1] - domain[0])));\n  const unpercent = (v: number) => (v / 100) * (domain[1] - domain[0]) + domain[0];\n  return {\n    percent,\n    unpercent,\n    domain: domain as [number, number],\n    format,\n    formatRaw: String,\n    parseRaw: Number.parseFloat,\n    setFilter: (filterMissing, minValue, maxValue) =>\n      col.setFilter({\n        filterMissing,\n        min: minValue === domain[0] ? Number.NEGATIVE_INFINITY : minValue,\n        max: maxValue === domain[1] ? Number.POSITIVE_INFINITY : maxValue,\n      }),\n    edit: (value, attachment) => {\n      return new Promise((resolve) => {\n        const dialogCtx = {\n          attachment,\n          manager: context.dialogManager,\n          level: context.dialogManager.maxLevel + 1,\n          idPrefix: context.idPrefix,\n          sanitize: context.sanitize,\n        };\n        const dialog = new InputNumberDialog(dialogCtx, resolve, {\n          value,\n          min: domain[0],\n          max: domain[1],\n        });\n        dialog.open();\n      });\n    },\n  };\n}\n","import { Column, IDataRow, LinkColumn } from '../model';\nimport { ERenderMode, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer } from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { noRenderer } from './utils';\nimport { abortAble } from 'lineupengine';\n\nfunction loadImage(src: string) {\n  return new Promise<HTMLImageElement>((resolve) => {\n    const image = new Image();\n    image.onload = () => resolve(image);\n    image.src = src;\n  });\n}\n\nexport default class ImageCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Image';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return col instanceof LinkColumn && mode === ERenderMode.CELL;\n  }\n\n  create(col: LinkColumn): ICellRenderer {\n    return {\n      template: `<div></div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        const missing = renderMissingDOM(n, col, d);\n        n.style.backgroundImage = null;\n        if (missing) {\n          n.title = '';\n          return undefined;\n        }\n        const v = col.getLink(d);\n        n.title = v ? v.alt : '';\n        if (!v) {\n          return undefined;\n        }\n        return abortAble(loadImage(v.href)).then((image) => {\n          if (typeof image === 'symbol') {\n            return;\n          }\n          n.style.backgroundImage = missing || !v ? null : `url('${image.src}')`;\n        });\n      },\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return noRenderer;\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import type { ISequence } from '../internal';\nimport type { Column, IDataRow, IOrderedGroup } from '../model';\nimport type {\n  ERenderMode,\n  ICellRenderer,\n  ICellRendererFactory,\n  IGroupCellRenderer,\n  IImposer,\n  IRenderContext,\n  ISummaryRenderer,\n} from './interfaces';\nimport { noRenderer } from './utils';\n\n/**\n * helper class that renders a group renderer as a selected (e.g. median) single item\n */\nexport abstract class AAggregatedGroupRenderer<T extends Column> implements ICellRendererFactory {\n  abstract readonly title: string;\n\n  abstract canRender(col: Column, mode: ERenderMode): boolean;\n\n  abstract create(col: T, context: IRenderContext, imposer?: IImposer): ICellRenderer;\n\n  protected abstract aggregatedIndex(rows: ISequence<IDataRow>, col: T): { row: IDataRow; index: number };\n\n  createGroup(col: T, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\n    const single = this.create(col, context, imposer);\n    return {\n      template: single.template,\n      update: (node: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupRows(col, group, 'aggregated', (rows) => this.aggregatedIndex(rows, col))\n          .then((data) => {\n            if (typeof data !== 'symbol') {\n              single.update(node, data.row, data.index, group);\n            }\n          });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n\nexport default AAggregatedGroupRenderer;\n","import { ISequence, round } from '../internal';\nimport {\n  Column,\n  IDataRow,\n  INumberColumn,\n  isNumberColumn,\n  IMultiLevelColumn,\n  isMultiLevelColumn,\n  IOrderedGroup,\n} from '../model';\nimport { medianIndex } from '../model/internalNumber';\nimport { COLUMN_PADDING } from '../styles';\nimport { AAggregatedGroupRenderer } from './AAggregatedGroupRenderer';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  IImposer,\n  IRenderCallback,\n  IGroupCellRenderer,\n  ICellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { matchColumns, multiLevelGridCSSClass } from './utils';\nimport { cssClass } from '../styles';\nimport { IAbortAblePromise, abortAbleAll } from 'lineupengine';\n\n/** @internal */\nexport interface ICols {\n  column: Column;\n  shift: number;\n  width: number;\n  template: string;\n  rendererId: string;\n  renderer: ICellRenderer | null;\n  groupRenderer: IGroupCellRenderer | null;\n  summaryRenderer: ISummaryRenderer | null;\n}\n\n/**\n * @internal\n * @param parent Parent column\n * @param context Render context\n * @param stacked Are the columns stacked?\n * @param mode Render mode\n * @param imposer Imposer object\n */\nexport function createData(\n  parent: { children: Column[] } & Column,\n  context: IRenderContext,\n  stacked: boolean,\n  mode: ERenderMode,\n  imposer?: IImposer\n): { cols: ICols[]; stacked: boolean; padding: number } {\n  const padding = COLUMN_PADDING;\n  let offset = 0;\n  const cols = parent.children.map((column) => {\n    const shift = offset;\n    const width = column.getWidth();\n    offset += width;\n    offset += !stacked ? padding : 0;\n\n    const renderer = mode === ERenderMode.CELL ? context.renderer(column, imposer) : null;\n    const groupRenderer = mode === ERenderMode.GROUP ? context.groupRenderer(column, imposer) : null;\n    const summaryRenderer = mode === ERenderMode.GROUP ? context.summaryRenderer(column, false, imposer) : null;\n    let template = '';\n    let rendererId = '';\n    switch (mode) {\n      case ERenderMode.CELL:\n        template = renderer!.template;\n        rendererId = column.getRenderer();\n        break;\n      case ERenderMode.GROUP:\n        template = groupRenderer!.template;\n        rendererId = column.getGroupRenderer();\n        break;\n      case ERenderMode.SUMMARY:\n        template = summaryRenderer!.template;\n        rendererId = column.getSummaryRenderer();\n        break;\n    }\n    // inject data attributes\n    template = template.replace(\n      /^<([^ >]+)([ >])/,\n      `<$1 data-column-id=\"${column.id}\" data-renderer=\"${rendererId}\"$2`\n    );\n    // inject classes\n    if (/^<([^>]+) class=\"([ >]*)/.test(template)) {\n      // has class attribute\n      template = template.replace(/^<([^>]+) class=\"([ >]*)/, `<$1 class=\"${cssClass(`renderer-${rendererId}`)} $2`);\n    } else {\n      // inject as the others\n      template = template.replace(/^<([^ >]+)([ >])/, `<$1 class=\"${cssClass(`renderer-${rendererId}`)}\"$2`);\n    }\n    return {\n      column,\n      shift,\n      width,\n      template,\n      rendererId,\n      renderer,\n      groupRenderer,\n      summaryRenderer,\n    };\n  });\n  return { cols, stacked, padding };\n}\n\nexport default class MultiLevelCellRenderer\n  extends AAggregatedGroupRenderer<IMultiLevelColumn & Column>\n  implements ICellRendererFactory\n{\n  readonly title: string;\n\n  constructor(private readonly stacked: boolean = true) {\n    super();\n    this.title = this.stacked ? 'Stacked Bar' : 'Nested';\n  }\n\n  canRender(col: Column): boolean {\n    return isMultiLevelColumn(col);\n  }\n\n  create(col: IMultiLevelColumn & Column, context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const { cols, stacked } = createData(col, context, this.stacked, ERenderMode.CELL, imposer);\n    const width = context.colWidth(col);\n    return {\n      template: `<div class='${multiLevelGridCSSClass(context.idPrefix, col)} ${\n        !stacked ? cssClass('grid-space') : ''\n      }'>${cols.map((d) => d.template).join('')}</div>`,\n      update: (n: HTMLDivElement, d: IDataRow, i: number, group: IOrderedGroup) => {\n        if (renderMissingDOM(n, col, d)) {\n          return null;\n        }\n        matchColumns(n, cols, context);\n\n        const toWait: IAbortAblePromise<void>[] = [];\n        const children = Array.from(n.children) as HTMLElement[];\n        const total = col.getWidth();\n        let missingWeight = 0;\n        cols.forEach((col, ci) => {\n          const weight = col.column.getWidth() / total;\n          const cNode = children[ci];\n          cNode.classList.add(cssClass(this.stacked ? 'stack-sub' : 'nested-sub'), cssClass('detail'));\n          cNode.dataset.group = 'd';\n          cNode.style.transform = stacked ? `translate(-${round((missingWeight / weight) * 100, 4)}%,0)` : null;\n          cNode.style.gridColumnStart = (ci + 1).toString();\n          const r = col.renderer!.update(cNode, d, i, group);\n          if (stacked) {\n            missingWeight += (1 - (col.column as INumberColumn).getNumber(d)) * weight;\n            if (ci < cols.length - 1) {\n              const span = cNode.querySelector('span');\n              if (span) {\n                span.style.overflow = 'hidden';\n              }\n            }\n          }\n          if (r) {\n            toWait.push(r);\n          }\n        });\n\n        if (toWait.length > 0) {\n          return abortAbleAll(toWait) as IAbortAblePromise<void>;\n        }\n        return null;\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow, i: number, group: IOrderedGroup) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return null;\n        }\n        const toWait: { shift: number; r: IAbortAblePromise<IRenderCallback> }[] = [];\n        let stackShift = 0;\n        for (const col of cols) {\n          const cr = col.renderer!;\n          if (cr.render) {\n            const shift = col.shift - stackShift;\n            ctx.translate(shift, 0);\n            const r = cr.render(ctx, d, i, group);\n            if (typeof r !== 'boolean' && r) {\n              toWait.push({ shift, r });\n            }\n            ctx.translate(-shift, 0);\n          }\n          if (stacked) {\n            stackShift += col.width * (1 - (col.column as INumberColumn).getNumber(d));\n          }\n        }\n\n        if (toWait.length === 0) {\n          return null;\n        }\n\n        return abortAbleAll(toWait.map((d) => d.r)).then((callbacks) => {\n          return (ctx: CanvasRenderingContext2D) => {\n            if (typeof callbacks === 'symbol') {\n              return;\n            }\n            for (let i = 0; i < callbacks.length; ++i) {\n              const callback = callbacks[i];\n              if (typeof callback !== 'function') {\n                continue;\n              }\n              const shift = toWait[i].shift;\n              ctx.translate(shift, 0);\n              callback(ctx);\n              ctx.translate(-shift, 0);\n            }\n          };\n        });\n      },\n    };\n  }\n\n  createGroup(col: IMultiLevelColumn & Column, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\n    if (this.stacked && isNumberColumn(col)) {\n      return super.createGroup(col, context, imposer);\n    }\n\n    const { cols } = createData(col, context, false, ERenderMode.GROUP, imposer);\n    return {\n      template: `<div class='${multiLevelGridCSSClass(context.idPrefix, col)} ${cssClass('grid-space')}'>${cols\n        .map((d) => d.template)\n        .join('')}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        matchColumns(n, cols, context);\n\n        const toWait: IAbortAblePromise<void>[] = [];\n        const children = Array.from(n.children) as HTMLElement[];\n        cols.forEach((col, ci) => {\n          const childNode = children[ci];\n          childNode.classList.add(cssClass(this.stacked ? 'stack-sub' : 'nested-sub'), cssClass('group'));\n          childNode.dataset.group = 'g';\n          childNode.style.gridColumnStart = (ci + 1).toString();\n          const r = col.groupRenderer!.update(childNode, group);\n          if (r) {\n            toWait.push(r);\n          }\n        });\n\n        if (toWait.length > 0) {\n          return abortAbleAll(toWait) as IAbortAblePromise<void>;\n        }\n        return null;\n      },\n    };\n  }\n\n  protected aggregatedIndex(rows: ISequence<IDataRow>, col: IMultiLevelColumn & Column) {\n    console.assert(isNumberColumn(col));\n    return medianIndex(rows, col as any as INumberColumn);\n  }\n}\n","import type { INumberBin, IStatistics } from '../internal';\nimport { Column, CompositeNumberColumn, IDataRow, IOrderedGroup, INumberColumn } from '../model';\nimport { CANVAS_HEIGHT, cssClass } from '../styles';\nimport { getHistDOMRenderer } from './HistogramCellRenderer';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { createData } from './MultiLevelCellRenderer';\nimport { colorOf, matchColumns, forEachChild } from './utils';\nimport { tasksAll } from '../provider';\nimport type { IHistogramLike } from './histogram';\n\nexport default class InterleavingCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Interleaved';\n\n  canRender(col: Column) {\n    return col instanceof CompositeNumberColumn;\n  }\n\n  create(col: CompositeNumberColumn, context: IRenderContext): ICellRenderer {\n    const { cols } = createData(col, context, false, ERenderMode.CELL);\n    const width = context.colWidth(col);\n    return {\n      template: `<div>${cols.map((r) => r.template).join('')}</div>`,\n      update: (n: HTMLDivElement, d: IDataRow, i: number, group: IOrderedGroup) => {\n        const missing = renderMissingDOM(n, col, d);\n        if (missing) {\n          return;\n        }\n        matchColumns(n, cols, context);\n        forEachChild(n, (ni: HTMLElement, j) => {\n          cols[j].renderer!.update(ni, d, i, group);\n        });\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow, _i: number, group: IOrderedGroup) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n\n        ctx.save();\n        ctx.scale(1, 1 / cols.length); // scale since internal use the height, too\n        cols.forEach((r, i) => {\n          const rr = r.renderer!;\n          if (rr.render) {\n            rr.render(ctx, d, i, group);\n          }\n          ctx.translate(0, CANVAS_HEIGHT);\n        });\n        ctx.restore();\n      },\n    };\n  }\n\n  createGroup(col: CompositeNumberColumn, context: IRenderContext): IGroupCellRenderer {\n    const { cols } = createData(col, context, false, ERenderMode.GROUP);\n    return {\n      template: `<div>${cols.map((r) => r.template).join('')}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        matchColumns(n, cols, context);\n        forEachChild(n, (ni: HTMLElement, j) => {\n          cols[j].groupRenderer!.update(ni, group);\n        });\n      },\n    };\n  }\n\n  createSummary(col: CompositeNumberColumn, context: IRenderContext, _interactive: boolean): ISummaryRenderer {\n    const cols = col.children;\n    let acc = 0;\n    const { template, render } = getHistDOMRenderer(col, {\n      color: () => colorOf(cols[acc++ % cols.length]),\n    });\n    return {\n      template,\n      update: (n: HTMLElement) => {\n        const tasks = cols.map((col) => context.tasks.summaryNumberStats(col as INumberColumn));\n\n        return tasksAll(tasks).then((vs) => {\n          if (typeof vs === 'symbol') {\n            return;\n          }\n          const summaries = vs.map((d) => d.summary);\n          if (!summaries.some(Boolean)) {\n            n.classList.add(cssClass('missing'));\n            return;\n          }\n          n.classList.remove(cssClass('missing'));\n          const grouped = groupedHist(summaries)!;\n          render(n, grouped);\n        });\n      },\n    };\n  }\n}\n\nconst dummyBin: INumberBin = {\n  count: 0,\n  x0: 0,\n  x1: 0,\n};\n\nfunction groupedHist(stats: (IStatistics | null)[]): IHistogramLike<number> | null {\n  const sample = stats.find(Boolean)!;\n  if (!sample) {\n    return null;\n  }\n\n  const bins = sample.hist.length;\n  // assert all have the same bin size\n  const hist: INumberBin[] = [];\n  let maxBin = 0;\n  for (let i = 0; i < bins; ++i) {\n    for (const s of stats) {\n      const bin = s ? s.hist[i] : null;\n      if (!bin) {\n        hist.push(dummyBin);\n        continue;\n      }\n      if (bin.count > maxBin) {\n        maxBin = bin.count;\n      }\n      hist.push(bin);\n    }\n  }\n  return {\n    maxBin,\n    hist,\n  };\n}\n","import { LinkColumn, Column, IDataRow, IOrderedGroup, ILink } from '../model';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { noRenderer, setText } from './utils';\nimport { cssClass } from '../styles';\nimport { clear, ISequence } from '../internal';\n\nexport default class LinkCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Link';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return col instanceof LinkColumn && mode !== ERenderMode.SUMMARY;\n  }\n\n  create(col: LinkColumn, context: IRenderContext): ICellRenderer {\n    const align = context.sanitize(col.alignment || 'left');\n    return {\n      template: `<a${\n        align !== 'left' ? ` class=\"${cssClass(align)}\"` : ''\n      } target=\"_blank\" rel=\"noopener\" href=\"\"></a>`,\n      update: (n: HTMLAnchorElement, d: IDataRow) => {\n        renderMissingDOM(n, col, d);\n        const v = col.getLink(d);\n        n.href = v ? v.href : '';\n        if (col.escape) {\n          setText(n, v ? v.alt : '');\n        } else {\n          n.innerHTML = v ? v.alt : '';\n        }\n      },\n    };\n  }\n\n  private static exampleText(col: LinkColumn, rows: ISequence<IDataRow>): [ILink[], boolean] {\n    const numExampleRows = 5;\n    const examples: ILink[] = [];\n    rows.every((row) => {\n      const v = col.getLink(row);\n      if (!v) {\n        return true;\n      }\n      examples.push(v);\n      return examples.length < numExampleRows;\n    });\n    if (examples.length === 0) {\n      return [[], false];\n    }\n    return [examples, examples.length < rows.length];\n  }\n\n  createGroup(col: LinkColumn, context: IRenderContext): IGroupCellRenderer {\n    return {\n      template: `<div> </div>`,\n      update: (n: HTMLDivElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupExampleRows(col, group, 'link', (rows) => LinkCellRenderer.exampleText(col, rows))\n          .then((out) => {\n            if (typeof out === 'symbol') {\n              return;\n            }\n            const [links, more] = out;\n            updateLinkList(n, links, more);\n          });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n\nexport function updateLinkList(n: HTMLElement, links: ILink[], more: boolean) {\n  n.classList.toggle(cssClass('missing'), links.length === 0);\n  clear(n);\n  links.forEach((l, i) => {\n    if (i > 0) {\n      n.appendChild(n.ownerDocument.createTextNode(', '));\n    }\n    const a = n.ownerDocument.createElement('a');\n    a.href = l.href;\n    a.textContent = l.alt;\n    a.target = '_blank';\n    a.rel = 'noopener';\n    n.appendChild(a);\n  });\n  if (more) {\n    n.insertAdjacentText('beforeend', ', …');\n  }\n}\n","import { clear, round } from '../internal';\nimport {\n  Column,\n  IMapColumn,\n  IMapAbleColumn,\n  isMapAbleColumn,\n  isMapColumn,\n  IDataRow,\n  isNumberColumn,\n  INumberColumn,\n} from '../model';\nimport { colorOf } from './impose';\nimport {\n  ICellRendererFactory,\n  IImposer,\n  IRenderContext,\n  ERenderMode,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { noRenderer, adaptColor, BIG_MARK_LIGHTNESS_FACTOR } from './utils';\nimport { cssClass } from '../styles';\n\nexport default class MapBarCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Bar Table';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return (\n      isMapColumn(col) &&\n      isNumberColumn(col) &&\n      (mode === ERenderMode.CELL || (mode === ERenderMode.SUMMARY && isMapAbleColumn(col)))\n    );\n  }\n\n  create(col: IMapColumn<number> & INumberColumn, _context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const formatter = col.getNumberFormat();\n\n    return {\n      template: `<div class=\"${cssClass('rtable')}\"></div>`,\n      update: (node: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(node, col, d)) {\n          return;\n        }\n        renderTable(node, col.getMap(d), (n, { value }) => {\n          if (Number.isNaN(value)) {\n            n.classList.add(cssClass('missing'));\n          } else {\n            const w = round(value * 100, 2);\n            n.title = formatter(value);\n            const inner = n.ownerDocument.createElement('div');\n            inner.style.width = `${w}%`;\n            inner.style.backgroundColor = adaptColor(colorOf(col, d, imposer), BIG_MARK_LIGHTNESS_FACTOR);\n            n.appendChild(inner);\n            const span = n.ownerDocument.createElement('span');\n            span.classList.add(cssClass('hover-only'));\n            span.textContent = formatter(value);\n            inner.appendChild(span);\n          }\n        });\n      },\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return noRenderer;\n  }\n\n  createSummary(col: IMapColumn<number> & IMapAbleColumn): ISummaryRenderer {\n    return {\n      template: `<div class=\"${cssClass('rtable')}\"><div>Key</div><div><span></span><span></span>Value</div></div>`,\n      update: (node: HTMLElement) => {\n        const range = col.getRange();\n        const value = node.lastElementChild! as HTMLElement;\n        value.firstElementChild!.textContent = range[0];\n        value.children[1]!.textContent = range[1];\n      },\n    };\n  }\n}\n\nexport function renderTable<E extends { key: string }>(\n  node: HTMLElement,\n  arr: readonly E[],\n  renderValue: (v: HTMLElement, entry: E) => void\n) {\n  clear(node);\n  const doc = node.ownerDocument;\n  for (const entry of arr) {\n    const keyNode = doc.createElement('div');\n    keyNode.textContent = entry.key;\n    node.appendChild(keyNode);\n    const valueNode = doc.createElement('div');\n    renderValue(valueNode, entry);\n    node.appendChild(valueNode);\n  }\n}\n","import {\n  IArrayColumn,\n  IMapColumn,\n  isArrayColumn,\n  isMapColumn,\n  Column,\n  IDataRow,\n  isMissingValue,\n  IOrderedGroup,\n} from '../model';\nimport type {\n  IRenderContext,\n  ICellRendererFactory,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { forEach, noop } from './utils';\nimport { cssClass } from '../styles';\nimport type { ISequence } from '../internal';\nimport { renderTable } from './MapBarCellRenderer';\n\nexport default class TableCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Table';\n\n  canRender(col: Column) {\n    return isMapColumn(col);\n  }\n\n  create(col: IMapColumn<any>): ICellRenderer {\n    if (isArrayColumn(col) && col.dataLength) {\n      // fixed length optimized rendering\n      return this.createFixed(col);\n    }\n    return {\n      template: `<div class=\"${cssClass('rtable')}\"></div>`,\n      update: (node: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(node, col, d)) {\n          return;\n        }\n        renderTable(node, col.getMapLabel(d), (n, { value }) => {\n          n.textContent = value;\n        });\n      },\n    };\n  }\n\n  private static template(col: IArrayColumn<any>) {\n    const labels = col.labels;\n    return `<div>${labels\n      .map(\n        (l) => `<div class=\"${cssClass('table-cell')}\">${l}</div><div  class=\"${cssClass('table-cell')}\" data-v></div>`\n      )\n      .join('\\n')}</div>`;\n  }\n\n  private createFixed(col: IArrayColumn<any>) {\n    return {\n      template: TableCellRenderer.template(col),\n      update: (node: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(node, col, d)) {\n          return;\n        }\n        const value = col.getLabels(d);\n        forEach(node, '[data-v]', (n: HTMLElement, i) => {\n          n.textContent = value[i];\n        });\n      },\n    };\n  }\n\n  createGroup(col: IMapColumn<any>, context: IRenderContext): IGroupCellRenderer {\n    if (isArrayColumn(col) && col.dataLength) {\n      // fixed length optimized rendering\n      return this.createFixedGroup(col, context);\n    }\n    return {\n      template: `<div class=\"${cssClass('rtable')}\"></div>`,\n      update: (node: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupRows(col, group, 'table', (rows) => groupByKey(rows.map((d) => col.getMapLabel(d))))\n          .then((entries) => {\n            if (typeof entries === 'symbol') {\n              return;\n            }\n            renderTable(node, entries, (n, { values }) => {\n              const numExampleRows = 5;\n              const v = `${values\n                .slice(0, numExampleRows)\n                .map((d) => d.value)\n                .join(', ')}`;\n              if (numExampleRows < values.length) {\n                n.textContent = `${v}, …`;\n              } else {\n                n.textContent = v;\n              }\n            });\n          });\n      },\n    };\n  }\n\n  private createFixedGroup(col: IArrayColumn<any>, context: IRenderContext) {\n    return {\n      template: TableCellRenderer.template(col),\n      update: (node: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupExampleRows(col, group, 'table', (rows) => {\n            const values: string[][] = col.labels.map(() => []);\n            rows.forEach((row) => {\n              const labels = col.getLabels(row);\n              for (let i = 0; i < Math.min(values.length, labels.length); ++i) {\n                if (!isMissingValue(labels[i])) {\n                  values[i].push(labels[i]);\n                }\n              }\n            });\n            return values;\n          })\n          .then((values) => {\n            if (typeof values === 'symbol') {\n              return;\n            }\n            forEach(node, '[data-v]', (n: HTMLElement, i) => {\n              n.textContent = `${values[i].join(', ')}, …`;\n            });\n          });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return {\n      template: `<div class=\"${cssClass('rtable')}\"><div>Key</div><div>Value</div></div>`,\n      update: noop,\n    };\n  }\n}\n\n/** @internal */\nexport function groupByKey<T extends { key: string }>(arr: ISequence<ISequence<T>>) {\n  const m = new Map<string, T[]>();\n  arr.forEach((a) =>\n    a.forEach((d) => {\n      if (!m.has(d.key)) {\n        m.set(d.key, [d]);\n      } else {\n        m.get(d.key)!.push(d);\n      }\n    })\n  );\n  return Array.from(m)\n    .sort((a, b) => a[0].localeCompare(b[0]))\n    .map(([key, values]) => ({ key, values }));\n}\n","import { IDataRow, LinkMapColumn, Column, ILink, IKeyValue, IOrderedGroup } from '../model';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { groupByKey } from './TableCellRenderer';\nimport { noRenderer, noop } from './utils';\nimport { cssClass } from '../styles';\nimport { clear } from '../internal';\nimport { updateLinkList } from './LinkCellRenderer';\nimport { renderTable } from './MapBarCellRenderer';\n\nexport default class LinkMapCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Table with Links';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return col instanceof LinkMapColumn && mode !== ERenderMode.SUMMARY;\n  }\n\n  create(col: LinkMapColumn, context: IRenderContext): ICellRenderer {\n    const align = context.sanitize(col.alignment || 'left');\n    return {\n      template: `<div class=\"${cssClass('rtable')}\"></div>`,\n      update: (node: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(node, col, d)) {\n          return;\n        }\n        clear(node);\n        const doc = node.ownerDocument;\n        for (const { key, value } of col.getLinkMap(d)) {\n          const keyNode = doc.createElement('div');\n          keyNode.classList.add(cssClass('table-cell'));\n          keyNode.textContent = key;\n          node.appendChild(keyNode);\n          const valueNode = doc.createElement('div');\n          valueNode.classList.add(cssClass('table-cell'));\n          if (align !== 'left') {\n            valueNode.classList.add(cssClass(align));\n          }\n          const valueA = doc.createElement('a');\n          valueA.href = value.href;\n          valueA.textContent = value.alt;\n          valueA.target = '_blank';\n          valueA.rel = 'noopener';\n          valueNode.appendChild(valueA);\n          node.appendChild(valueNode);\n        }\n      },\n      render: noop,\n    };\n  }\n\n  private static example(arr: IKeyValue<ILink>[]): [ILink[], boolean] {\n    const numExampleRows = 5;\n    const examples: ILink[] = [];\n    for (const row of arr) {\n      if (!row || !row.value.href) {\n        continue;\n      }\n      examples.push(row.value);\n      if (examples.length >= numExampleRows) {\n        break;\n      }\n    }\n    if (examples.length === 0) {\n      return [[], false];\n    }\n    return [examples, examples.length < arr.length];\n  }\n\n  createGroup(col: LinkMapColumn, context: IRenderContext): IGroupCellRenderer {\n    const align = col.alignment || 'left';\n    return {\n      template: `<div class=\"${cssClass('rtable')}\"></div>`,\n      update: (node: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupRows(col, group, 'linkmap', (rows) => groupByKey(rows.map((d) => col.getLinkMap(d))))\n          .then((entries) => {\n            if (typeof entries === 'symbol') {\n              return;\n            }\n            renderTable(node, entries, (n, { values }) => {\n              if (align !== 'left') {\n                n.classList.add(cssClass(align));\n              }\n              const [links, more] = LinkMapCellRenderer.example(values);\n              if (links.length === 0) {\n                n.classList.add(cssClass('missing'));\n              } else {\n                updateLinkList(n, links, more);\n              }\n            });\n          });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import type { ICellRendererFactory, IGroupCellRenderer, ISummaryRenderer } from './interfaces';\nimport { noop } from './utils';\n\nexport default class LoadingCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Loading';\n\n  canRender(): boolean {\n    return false; // just direct selection\n  }\n\n  create() {\n    // no typing because ICellRenderer would not be assignable to IGroupCellRenderer and ISummaryRenderer\n    return {\n      template: `<div>Loading …</div>`,\n      update: noop as () => void,\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return this.create();\n  }\n\n  createSummary(): ISummaryRenderer {\n    return this.create();\n  }\n}\n","import { Column, RankColumn, IDataRow, IOrderedGroup } from '../model';\nimport type { ICellRendererFactory, ISummaryRenderer, IGroupCellRenderer, ICellRenderer } from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { noRenderer, setText } from './utils';\nimport { cssClass } from '../styles';\n\nexport default class RankCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Default';\n\n  canRender(col: Column) {\n    return col instanceof RankColumn;\n  }\n\n  create(col: Column): ICellRenderer {\n    return {\n      template: `<div class=\"${cssClass('right')}\"> </div>`,\n      update: (n: HTMLDivElement, d: IDataRow) => {\n        renderMissingDOM(n, col, d);\n        setText(n, col.getLabel(d));\n      },\n    };\n  }\n\n  createGroup(col: Column): IGroupCellRenderer {\n    const ranking = col.findMyRanker()!;\n    return {\n      template: `<div><div></div><div></div></div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        const fromTSpan = n.firstElementChild! as HTMLElement;\n        const toTSpan = n.lastElementChild! as HTMLElement;\n        if (group.order.length === 0) {\n          fromTSpan.textContent = '';\n          toTSpan.textContent = '';\n          return;\n        }\n        fromTSpan.textContent = ranking.getRank(group.order[0]).toString();\n        toTSpan.textContent = ranking.getRank(group.order[group.order.length - 1]).toString();\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import { Column, SelectionColumn, IDataRow, IOrderedGroup } from '../model';\nimport type {\n  IRenderContext,\n  ICellRendererFactory,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { cssClass } from '../styles';\nimport { everyIndices } from '../model/internal';\nimport { rangeSelection } from '../provider/utils';\n\nexport default class SelectionRenderer implements ICellRendererFactory {\n  readonly title: string = 'Default';\n\n  canRender(col: Column) {\n    return col instanceof SelectionColumn;\n  }\n\n  create(col: SelectionColumn, ctx: IRenderContext): ICellRenderer {\n    return {\n      template: `<div></div>`,\n      update: (n: HTMLElement, d: IDataRow, i: number) => {\n        n.onclick = function (event) {\n          event.preventDefault();\n          event.stopPropagation();\n          if (event.shiftKey) {\n            const ranking = col.findMyRanker()!.id;\n            if (rangeSelection(ctx.provider, ranking, d.i, i, event.ctrlKey)) {\n              return;\n            }\n          }\n\n          col.toggleValue(d);\n        };\n      },\n    };\n  }\n\n  createGroup(col: SelectionColumn, context: IRenderContext): IGroupCellRenderer {\n    return {\n      template: `<div></div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        let selected = 0;\n        let unselected = 0;\n        const total = group.order.length;\n        everyIndices(group.order, (i) => {\n          const s = context.provider.isSelected(i);\n          if (s) {\n            selected++;\n          } else {\n            unselected++;\n          }\n          if (selected * 2 > total || unselected * 2 > total) {\n            // more than half already, can abort already decided\n            return false;\n          }\n          return true;\n        });\n\n        n.classList.toggle(cssClass('group-selected'), selected * 2 > total);\n        n.onclick = function (event) {\n          event.preventDefault();\n          event.stopPropagation();\n          const value = n.classList.toggle(cssClass('group-selected'));\n          col.setValues(group.order, value);\n        };\n      },\n    };\n  }\n\n  createSummary(col: SelectionColumn, context: IRenderContext): ISummaryRenderer {\n    const unchecked = cssClass('icon-unchecked');\n    const checked = cssClass('icon-checked');\n    return {\n      template: `<div title=\"(Un)Select All\" class=\"${unchecked}\"></div>`,\n      update: (node: HTMLElement) => {\n        node.onclick = (evt) => {\n          evt.stopPropagation();\n          const isUnchecked = node.classList.contains(unchecked);\n          if (isUnchecked) {\n            context.provider.selectAllOf(col.findMyRanker()!);\n            node.classList.remove(unchecked);\n            node.classList.add(checked);\n          } else {\n            context.provider.setSelection([]);\n            node.classList.remove(checked);\n            node.classList.add(unchecked);\n          }\n        };\n      },\n    };\n  }\n}\n","import { Column, ICategoricalLikeColumn, IDataRow, IOrderedGroup, ISetColumn, isSetColumn } from '../model';\nimport { CANVAS_HEIGHT, cssClass } from '../styles';\nimport type {\n  ICellRendererFactory,\n  IRenderContext,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { forEachChild, noop, wideEnoughCat } from './utils';\nimport { round } from '../internal';\n\nexport default class SetCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Matrix';\n\n  canRender(col: Column): boolean {\n    return isSetColumn(col);\n  }\n\n  private static createDOMContext(col: ICategoricalLikeColumn, sanitize: (v: string) => string) {\n    const categories = col.categories;\n    const mapping = col.getColorMapping();\n    let templateRows = '';\n    for (const cat of categories) {\n      templateRows += `<div class=\"${cssClass('heatmap-cell')}\" title=\"${sanitize(\n        cat.label\n      )}\" style=\"background-color: ${mapping.apply(cat)}\"></div>`;\n    }\n    return {\n      templateRow: templateRows,\n      render: (n: HTMLElement, value: (number | boolean)[]) => {\n        forEachChild(n, (d: HTMLElement, i) => {\n          const v = value[i];\n          d.style.backgroundColor = mapping.apply(categories[i]);\n          d.style.opacity = typeof v === 'boolean' ? (v ? '1' : '0') : round(v, 2).toString();\n        });\n      },\n    };\n  }\n\n  create(col: ISetColumn, context: IRenderContext): ICellRenderer {\n    const { templateRow, render } = SetCellRenderer.createDOMContext(col, context.sanitize);\n    const width = context.colWidth(col);\n    const cellDimension = width / col.dataLength!;\n    const cats = col.categories;\n    const mapping = col.getColorMapping();\n\n    return {\n      template: `<div class=\"${cssClass('heatmap')}\">${templateRow}</div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(n, col, d)) {\n          return;\n        }\n        render(n, col.getValues(d));\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        // Circle\n        const data = col.getValues(d);\n\n        ctx.save();\n        cats.forEach((d, j) => {\n          if (!data[j]) {\n            return;\n          }\n          const posX = j * cellDimension;\n          ctx.fillStyle = mapping.apply(d);\n          ctx.fillRect(posX, 0, cellDimension, CANVAS_HEIGHT);\n        });\n\n        ctx.restore();\n      },\n    };\n  }\n\n  createGroup(col: ISetColumn, context: IRenderContext): IGroupCellRenderer {\n    const { templateRow, render } = SetCellRenderer.createDOMContext(col, context.sanitize);\n    return {\n      template: `<div class=\"${cssClass('heatmap')}\">${templateRow}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks.groupCategoricalStats(col, group).then((r) => {\n          if (typeof r === 'symbol') {\n            return;\n          }\n          const isMissing = !r || !r.group || r.group.count === 0 || r.group.count === r.group.missing;\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n          render(\n            n,\n            r.group.hist.map((d) => d.count / r.group.maxBin)\n          );\n        });\n      },\n    };\n  }\n\n  createSummary(col: ICategoricalLikeColumn, context: IRenderContext): ISummaryRenderer {\n    const categories = col.categories;\n    const mapping = col.getColorMapping();\n    let templateRows = `<div class=\"${cssClass('heatmap')}\">`;\n    const labels = wideEnoughCat(col);\n    for (const cat of categories) {\n      templateRows += `<div class=\"${cssClass('heatmap-cell')}\" title=\"${context.sanitize(cat.label)}\"${\n        labels ? ` data-title=\"${context.sanitize(cat.label)}\"` : ''\n      } style=\"background-color: ${mapping.apply(cat)}\"></div>`;\n    }\n    templateRows += '</div>';\n    return {\n      template: templateRows,\n      update: noop,\n    };\n  }\n}\n","import {\n  Column,\n  INumbersColumn,\n  NumbersColumn,\n  isNumbersColumn,\n  IDataRow,\n  IOrderedGroup,\n  isMissingValue,\n} from '../model';\nimport { matchRows } from './ANumbersCellRenderer';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { forEachChild, noRenderer } from './utils';\nimport type { ISequence } from '../internal';\nimport { cssClass } from '../styles';\n\n/** @internal */\nexport function line(data: ISequence<number>) {\n  if (data.length === 0) {\n    return '';\n  }\n  let p = '';\n  let moveNext = true;\n\n  data.forEach((d, i) => {\n    if (Number.isNaN(d)) {\n      moveNext = true;\n    } else if (moveNext) {\n      p += `M${i},${1 - d} `;\n      moveNext = false;\n    } else {\n      p += `L${i},${1 - d} `;\n    }\n  });\n  return p;\n}\n\nexport default class SparklineCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Sparkline';\n\n  canRender(col: Column, mode: ERenderMode) {\n    return isNumbersColumn(col) && mode !== ERenderMode.SUMMARY;\n  }\n\n  create(col: INumbersColumn): ICellRenderer {\n    const dataLength = col.dataLength!;\n    const yPos = 1 - col.getMapping().apply(NumbersColumn.CENTER);\n    return {\n      template: `<svg viewBox=\"0 0 ${dataLength - 1} 1\" preserveAspectRatio=\"none meet\"><line x1=\"0\" x2=\"${\n        dataLength - 1\n      }\" y1=\"${yPos}\" y2=\"${yPos}\"></line><path></path></svg>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(n, col, d)) {\n          return;\n        }\n        const data = col.getNumbers(d);\n        n.lastElementChild!.setAttribute('d', line(data));\n      },\n    };\n  }\n\n  createGroup(col: INumbersColumn, context: IRenderContext): IGroupCellRenderer {\n    const dataLength = col.dataLength!;\n    const yPos = 1 - col.getMapping().apply(NumbersColumn.CENTER);\n    return {\n      template: `<svg viewBox=\"0 0 ${dataLength - 1} 1\" preserveAspectRatio=\"none meet\"><line x1=\"0\" x2=\"${\n        dataLength - 1\n      }\" y1=\"${yPos}\" y2=\"${yPos}\"></line><path></path></svg>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        //overlapping ones\n        matchRows(n, group.order.length, `<path></path>`);\n        return context.tasks\n          .groupRows(col, group, 'numbers', (r) => Array.from(r.map((d) => col.getNumbers(d))))\n          .then((vs) => {\n            if (typeof vs === 'symbol') {\n              return;\n            }\n            const isMissing = vs.length === 0 || vs.every((v) => v.every(isMissingValue));\n            n.classList.toggle(cssClass('missing'), isMissing);\n            if (isMissing) {\n              return;\n            }\n            forEachChild(n, (row, i) => {\n              row.setAttribute('d', line(vs[i]));\n            });\n          });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import { Column, IDataRow, IOrderedGroup, isCategoricalColumn, ISetColumn, isSetColumn } from '../model';\nimport { CANVAS_HEIGHT, cssClass, UPSET } from '../styles';\nimport type {\n  ICellRendererFactory,\n  IRenderContext,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\n\nexport default class UpSetCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'UpSet';\n\n  canRender(col: Column) {\n    // set but not a pure categorical one\n    return isSetColumn(col) && !isCategoricalColumn(col);\n  }\n\n  private static calculateSetPath(setData: boolean[], cellDimension: number) {\n    const catindexes: number[] = [];\n    setData.forEach((d: boolean, i: number) => (d ? catindexes.push(i) : -1));\n\n    const left = catindexes[0] * cellDimension + cellDimension / 2;\n    const right = catindexes[catindexes.length - 1] * cellDimension + cellDimension / 2;\n\n    return { left, right };\n  }\n\n  private static createDOMContext(col: ISetColumn, sanitize: (v: string) => string) {\n    const categories = col.categories;\n    let templateRows = '';\n    for (const cat of categories) {\n      templateRows += `<div class=\"${cssClass('upset-dot')}\" title=\"${sanitize(cat.label)}\"></div>`;\n    }\n    return {\n      template: `<div><div class=\"${cssClass('upset-line')}\"></div>${templateRows}</div>`,\n      render: (n: HTMLElement, value: boolean[]) => {\n        Array.from(n.children)\n          .slice(1)\n          .forEach((d, i) => {\n            const v = value[i];\n            d.classList.toggle(cssClass('enabled'), v);\n          });\n\n        const line = n.firstElementChild as HTMLElement;\n        const left = value.findIndex((d) => d);\n        const right = value.length - 1 - value.reverse().findIndex((d) => d);\n\n        if (left < 0 || left === right) {\n          line.style.display = 'none';\n          return;\n        }\n        line.style.display = null;\n        line.style.left = `${Math.round((100 * (left + 0.5)) / value.length)}%`;\n        line.style.width = `${Math.round((100 * (right - left)) / value.length)}%`;\n      },\n    };\n  }\n\n  create(col: ISetColumn, context: IRenderContext): ICellRenderer {\n    const { template, render } = UpSetCellRenderer.createDOMContext(col, context.sanitize);\n    const width = context.colWidth(col);\n    const cellDimension = width / col.categories.length;\n\n    return {\n      template,\n      update: (n: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(n, col, d)) {\n          return;\n        }\n        render(n, col.getValues(d));\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        // Circle\n        const data = col.getValues(d);\n\n        const hasTrueValues = data.some((d) => d); //some values are true?\n\n        ctx.save();\n        ctx.fillStyle = UPSET.color;\n        ctx.strokeStyle = UPSET.color;\n        if (hasTrueValues) {\n          const { left, right } = UpSetCellRenderer.calculateSetPath(data, cellDimension);\n          ctx.beginPath();\n          ctx.moveTo(left, CANVAS_HEIGHT / 2);\n          ctx.lineTo(right, CANVAS_HEIGHT / 2);\n          ctx.stroke();\n        }\n\n        data.forEach((d, j) => {\n          const posX = j * cellDimension;\n          ctx.beginPath();\n          ctx.globalAlpha = d ? 1 : UPSET.inactive;\n          ctx.fillRect(posX, 0, cellDimension, CANVAS_HEIGHT);\n          ctx.fill();\n        });\n\n        ctx.restore();\n      },\n    };\n  }\n\n  createGroup(col: ISetColumn, context: IRenderContext): IGroupCellRenderer {\n    const { template, render } = UpSetCellRenderer.createDOMContext(col, context.sanitize);\n    return {\n      template,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks.groupCategoricalStats(col, group).then((r) => {\n          if (typeof r === 'symbol') {\n            return;\n          }\n          render(\n            n,\n            r.group.hist.map((d) => d.count > 0)\n          );\n        });\n      },\n    };\n  }\n\n  createSummary(col: ISetColumn, context: IRenderContext): ISummaryRenderer {\n    const { template, render } = UpSetCellRenderer.createDOMContext(col, context.sanitize);\n    return {\n      template,\n      update: (n: HTMLElement) => {\n        return context.tasks.summaryCategoricalStats(col).then((r) => {\n          if (typeof r === 'symbol') {\n            return;\n          }\n          render(\n            n,\n            r.summary.hist.map((d) => d.count > 0)\n          );\n        });\n      },\n    };\n  }\n}\n","import { Column, NumbersColumn, IDataRow, INumbersColumn, isNumbersColumn } from '../model';\nimport { CANVAS_HEIGHT, cssClass } from '../styles';\nimport { ANumbersCellRenderer } from './ANumbersCellRenderer';\nimport { toHeatMapColor } from './BrightnessCellRenderer';\nimport { IRenderContext, ERenderMode, ICellRendererFactory, IImposer, ISummaryRenderer } from './interfaces';\nimport { forEachChild, noRenderer } from './utils';\n\nexport default class VerticalBarCellRenderer extends ANumbersCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Bar Chart';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return isNumbersColumn(col) && Boolean(col.dataLength) && mode === ERenderMode.CELL;\n  }\n\n  private static compute(v: number, threshold: number, domain: number[]) {\n    if (v < threshold) {\n      //threshold to down\n      return { height: threshold - v, bottom: v - domain[0] };\n    }\n    //from top to down\n    return { height: v - threshold, bottom: threshold - domain[0] };\n  }\n\n  protected createContext(col: INumbersColumn, context: IRenderContext, imposer?: IImposer) {\n    const cellDimension = context.colWidth(col) / col.dataLength!;\n    const threshold = col.getMapping().apply(NumbersColumn.CENTER);\n    const range = 1;\n    let templateRows = '';\n    for (let i = 0; i < col.dataLength!; ++i) {\n      templateRows += `<div class=\"${cssClass('heatmap-cell')}\" style=\"background-color: white\" title=\"\"></div>`;\n    }\n    const formatter = col.getNumberFormat();\n\n    return {\n      clazz: cssClass('heatmap'),\n      templateRow: templateRows,\n      update: (row: HTMLElement, data: number[], raw: number[], item: IDataRow, tooltipPrefix?: string) => {\n        const zero = toHeatMapColor(0, item, col, imposer);\n        const one = toHeatMapColor(1, item, col, imposer);\n\n        forEachChild(row, (d: HTMLElement, i) => {\n          const v = data[i];\n          const { bottom, height } = VerticalBarCellRenderer.compute(v, threshold, [0, 1]);\n          d.title = `${tooltipPrefix || ''}${formatter(raw[i])}`;\n          d.style.backgroundColor = v < threshold ? zero : one;\n          d.style.bottom = `${Math.round((100 * bottom) / range)}%`;\n          d.style.height = `${Math.round((100 * height) / range)}%`;\n        });\n      },\n      render: (ctx: CanvasRenderingContext2D, data: number[], item: IDataRow) => {\n        const zero = toHeatMapColor(0, item, col, imposer);\n        const one = toHeatMapColor(1, item, col, imposer);\n        const scale = CANVAS_HEIGHT / range;\n        data.forEach((v, j) => {\n          ctx.fillStyle = v < threshold ? zero : one;\n          const xpos = j * cellDimension;\n          const { bottom, height } = VerticalBarCellRenderer.compute(v, threshold, [0, 1]);\n          ctx.fillRect(xpos, (range - height - bottom) * scale, cellDimension, height * scale);\n        });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import { Column, IDataRow, DateColumn, IOrderedGroup } from '../model';\nimport type {\n  IRenderContext,\n  ICellRendererFactory,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { noop, noRenderer, setText, exampleText } from './utils';\nimport { chooseAggregatedDate } from '../model/internalDate';\nimport { cssClass } from '../styles';\n\nexport default class DateCellRenderer implements ICellRendererFactory {\n  title = 'Date';\n  groupTitle = 'Date';\n  summaryTitle = 'Date';\n\n  canRender(col: Column): boolean {\n    return col instanceof DateColumn;\n  }\n\n  create(col: DateColumn): ICellRenderer {\n    return {\n      template: `<div> </div>`,\n      update: (n: HTMLDivElement, d: IDataRow) => {\n        renderMissingDOM(n, col, d);\n        setText(n, col.getLabel(d));\n      },\n      render: noop,\n    };\n  }\n\n  createGroup(col: DateColumn, context: IRenderContext): IGroupCellRenderer {\n    return {\n      template: `<div> </div>`,\n      update: (n: HTMLDivElement, group: IOrderedGroup) => {\n        const isGrouped = col.isGroupedBy() >= 0;\n        if (isGrouped) {\n          return context.tasks\n            .groupRows(col, group, 'date', (rows) => chooseAggregatedDate(rows, col.getDateGrouper(), col))\n            .then((chosen) => {\n              if (typeof chosen === 'symbol') {\n                return;\n              }\n              n.classList.toggle(cssClass('missing'), !chosen);\n              setText(n, chosen ? chosen.name : '');\n            });\n        }\n        return context.tasks\n          .groupExampleRows(col, group, 'date', (sample) => exampleText(col, sample))\n          .then((text) => {\n            if (typeof text === 'symbol') {\n              return;\n            }\n            n.classList.toggle(cssClass('missing'), !text);\n            setText(n, text);\n          });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import type { IDialogContext } from './ADialog';\nimport { timeFormat } from 'd3-time-format';\nimport APopup from './APopup';\n\n/** @internal */\nexport interface IInputDateOptions {\n  value: Date | null;\n  label: string | null;\n}\n\n/** @internal */\nexport default class InputDateDialog extends APopup {\n  private readonly ioptions: Readonly<IInputDateOptions> = {\n    value: null,\n    label: null,\n  };\n\n  constructor(\n    dialog: IDialogContext,\n    private readonly callback: (value: Date | null) => void,\n    options: Partial<IInputDateOptions> = {}\n  ) {\n    super(dialog);\n    Object.assign(this.ioptions, options);\n  }\n\n  protected build(node: HTMLElement) {\n    const o = this.ioptions;\n\n    const f = timeFormat('%Y-%m-%d');\n\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n     <input type=\"date\" value=\"${o.value ? f(o.value) : ''}\" required autofocus placeholder=\"${this.dialog.sanitize(\n        o.label ? o.label : 'enter date'\n      )}\">\n    `\n    );\n    this.findInput('input[type=date]').addEventListener('keypress', (evt) => {\n      if (evt.key === 'Enter') {\n        this.triggerSubmit();\n      }\n    });\n    this.enableLivePreviews('input');\n  }\n\n  submit() {\n    this.callback(this.findInput('input[type=date]').valueAsDate);\n    return true;\n  }\n}\n","import { dateStatsBuilder, IDateStatistics } from '../internal';\nimport {\n  Column,\n  IDataRow,\n  IDateColumn,\n  IDatesColumn,\n  IOrderedGroup,\n  isDateColumn,\n  isDatesColumn,\n  Ranking,\n} from '../model';\nimport { cssClass, engineCssClass } from '../styles';\nimport {\n  ERenderMode,\n  ICellRendererFactory,\n  IRenderContext,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n  IRenderTasks,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { colorOf } from './utils';\nimport {\n  histogramUpdate,\n  histogramTemplate,\n  mappingHintTemplate,\n  mappingHintUpdate,\n  IFilterInfo,\n  IFilterContext,\n  filteredHistTemplate,\n  initFilter,\n} from './histogram';\nimport InputDateDialog from '../ui/dialogs/InputDateDialog';\nimport { shiftFilterDateDay, noDateFilter } from '../model/internalDate';\nimport type DialogManager from '../ui/dialogs/DialogManager';\n\nexport default class DateHistogramCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Histogram';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return (isDateColumn(col) && mode !== ERenderMode.CELL) || (isDatesColumn(col) && mode === ERenderMode.CELL);\n  }\n\n  create(col: IDatesColumn, _context: IRenderContext): ICellRenderer {\n    const { template, render } = getHistDOMRenderer(col);\n    return {\n      template: `${template}</div>`,\n      update: (n: HTMLElement, row: IDataRow) => {\n        if (renderMissingDOM(n, col, row)) {\n          return;\n        }\n        const b = dateStatsBuilder();\n        for (const n of col.getDates(row)) {\n          b.push(n);\n        }\n        const hist = b.build();\n        render(n, hist);\n      },\n    };\n  }\n\n  createGroup(col: IDateColumn, context: IRenderContext): IGroupCellRenderer {\n    const { template, render } = getHistDOMRenderer(col);\n    return {\n      template: `${template}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks.groupDateStats(col, group).then((r) => {\n          if (typeof r === 'symbol') {\n            return;\n          }\n          const isMissing = !r || r.group == null || r.group.count === 0 || r.group.count === r.group.missing;\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n          render(n, r.group);\n        });\n      },\n    };\n  }\n\n  createSummary(col: IDateColumn, context: IRenderContext, interactive: boolean): ISummaryRenderer {\n    const r = getHistDOMRenderer(col);\n    return interactive\n      ? interactiveSummary(col, context, r.template, r.render)\n      : staticSummary(col, context, false, r.template, r.render);\n  }\n}\n\nfunction staticSummary(\n  col: IDateColumn,\n  context: IRenderContext,\n  interactive: boolean,\n  template: string,\n  render: (n: HTMLElement, stats: IDateStatistics, unfiltered?: IDateStatistics) => void\n) {\n  template += mappingHintTemplate(['', '']);\n\n  return {\n    template: `${template}</div>`,\n    update: (node: HTMLElement) => {\n      return context.tasks.summaryDateStats(col).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const { summary, data } = r;\n\n        node.classList.toggle(cssClass('missing'), !summary);\n        if (!summary) {\n          return;\n        }\n        const formatter = col.getFormatter();\n        mappingHintUpdate(node, [formatter(summary.min), formatter(summary.max)]);\n\n        render(node, summary, interactive ? data : undefined);\n      });\n    },\n  };\n}\n\nfunction interactiveSummary(\n  col: IDateColumn,\n  context: IRenderContext,\n  template: string,\n  render: (n: HTMLElement, stats: IDateStatistics, unfiltered?: IDateStatistics) => void\n) {\n  const filter = col.getFilter();\n  const dummyDomain: [number, number] = [\n    isFinite(filter.min) ? filter.min : 0,\n    isFinite(filter.max) ? filter.max : 100,\n  ];\n\n  template += filteredHistTemplate(createFilterContext(col, context, dummyDomain), createFilterInfo(col, dummyDomain));\n\n  let fContext: IFilterContext<number>;\n  let updateFilter: (missing: number, f: IFilterInfo<number>) => void;\n\n  return {\n    template: `${template}</div>`,\n    update: (node: HTMLElement) => {\n      return context.tasks.summaryDateStats(col).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const { summary, data } = r;\n        if (!updateFilter) {\n          const domain: [number, number] = [\n            data.min ? data.min.getTime() : Date.now(),\n            data.max ? data.max.getTime() : Date.now(),\n          ];\n          fContext = createFilterContext(col, context, domain);\n          updateFilter = initFilter(node, fContext);\n        }\n\n        updateFilter(data ? data.missing : summary ? summary.missing : 0, createFilterInfo(col, fContext.domain));\n\n        node.classList.add(cssClass('histogram-i'));\n        node.classList.toggle(cssClass('missing'), !summary);\n        if (!summary) {\n          return;\n        }\n        render(node, summary, data);\n      });\n    },\n  };\n}\n\n/** @internal */\nexport function createDateFilter(\n  col: IDateColumn,\n  parent: HTMLElement,\n  context: { idPrefix: string; dialogManager: DialogManager; tasks: IRenderTasks; sanitize: (v: string) => string },\n  livePreviews: boolean\n) {\n  const renderer = getHistDOMRenderer(col);\n  const filter = col.getFilter();\n\n  let domain: [number, number] = [isFinite(filter.min) ? filter.min : 0, isFinite(filter.max) ? filter.max : 100];\n\n  let fContext = createFilterContext(col, context, domain);\n  let applyFilter = fContext.setFilter;\n  let currentFilter = createFilterInfo(col, domain);\n  fContext.setFilter = (filterMissing, min, max) => {\n    currentFilter = { filterMissing, filterMin: min, filterMax: max };\n    if (livePreviews) {\n      applyFilter(filterMissing, min, max);\n    }\n  };\n  parent.innerHTML = `${renderer.template}${filteredHistTemplate(fContext, createFilterInfo(col, domain))}</div>`;\n  const summaryNode = parent.firstElementChild! as HTMLElement;\n  summaryNode.classList.add(cssClass('summary'), cssClass('renderer'));\n  summaryNode.dataset.renderer = 'histogram';\n  summaryNode.dataset.interactive = '';\n  summaryNode.classList.add(cssClass('histogram-i'));\n\n  let updateFilter: null | ((missing: number, filter: IFilterInfo<number>) => void) = null;\n  const prepareRender = (min: Date | null, max: Date | null) => {\n    // reinit with proper domain\n    domain = [min ? min.getTime() : Date.now(), max ? max.getTime() : Date.now()];\n    fContext = createFilterContext(col, context, domain);\n    applyFilter = fContext.setFilter;\n    currentFilter = createFilterInfo(col, domain);\n    fContext.setFilter = (filterMissing, min, max) => {\n      currentFilter = { filterMissing, filterMin: min, filterMax: max };\n      if (livePreviews) {\n        applyFilter(filterMissing, min, max);\n      }\n    };\n    return initFilter(summaryNode, fContext);\n  };\n\n  const rerender = () => {\n    const ready = context.tasks.summaryDateStats(col).then((r) => {\n      if (typeof r === 'symbol') {\n        return;\n      }\n      const { summary, data } = r;\n      if (!updateFilter) {\n        updateFilter = prepareRender(data.min, data.max);\n      }\n      updateFilter(data ? data.missing : summary ? summary.missing : 0, currentFilter);\n      summaryNode.classList.toggle(cssClass('missing'), !summary);\n      if (!summary) {\n        return;\n      }\n      renderer.render(summaryNode, summary, data);\n    });\n    if (!ready) {\n      return;\n    }\n    summaryNode.classList.add(engineCssClass('loading'));\n    ready.then(() => {\n      summaryNode.classList.remove(engineCssClass('loading'));\n    });\n  };\n\n  const ranking = col.findMyRanker()!;\n\n  if (ranking) {\n    ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.numberFilter`, () => rerender());\n  }\n  rerender();\n\n  return {\n    cleanUp() {\n      if (ranking) {\n        ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.numberFilter`, null);\n      }\n    },\n    reset() {\n      currentFilter = createFilterInfo(col, domain, noDateFilter());\n      rerender();\n    },\n    submit() {\n      applyFilter(currentFilter.filterMissing, currentFilter.filterMin, currentFilter.filterMax);\n    },\n  };\n}\n\nfunction getHistDOMRenderer(col: IDateColumn) {\n  const guessedBins = 10;\n\n  const formatter = col.getFormatter();\n  const color = colorOf(col)!;\n\n  const render = (n: HTMLElement, stats: IDateStatistics, unfiltered?: IDateStatistics) => {\n    return histogramUpdate(n, stats, unfiltered || null, formatter, () => color);\n  };\n  return {\n    template: histogramTemplate(guessedBins),\n    render,\n    guessedBins,\n  };\n}\n\nfunction createFilterInfo(col: IDateColumn, domain: [number, number], filter = col.getFilter()): IFilterInfo<number> {\n  const filterMin = isFinite(filter.min) ? filter.min : domain[0];\n  const filterMax = isFinite(filter.max) ? filter.max : domain[1];\n  return {\n    filterMissing: filter.filterMissing,\n    filterMin,\n    filterMax,\n  };\n}\n\nfunction createFilterContext(\n  col: IDateColumn,\n  context: { idPrefix: string; dialogManager: DialogManager; sanitize: (v: string) => string },\n  domain: [number, number]\n): IFilterContext<number> {\n  const clamp = (v: number) => Math.max(0, Math.min(100, v));\n  const percent = (v: number) => clamp(Math.round((100 * (v - domain[0])) / (domain[1] - domain[0])));\n  const unpercent = (v: number) => (v / 100) * (domain[1] - domain[0]) + domain[0];\n  return {\n    percent,\n    unpercent,\n    domain,\n    format: (v) => (Number.isNaN(v) ? '' : col.getFormatter()(new Date(v))),\n    formatRaw: String,\n    parseRaw: (v) => Number.parseInt(v, 10),\n    setFilter: (filterMissing, minValue, maxValue) =>\n      col.setFilter({\n        filterMissing,\n        min: Math.abs(minValue - domain[0]) < 0.001 ? Number.NEGATIVE_INFINITY : shiftFilterDateDay(minValue, 'min'),\n        max: Math.abs(maxValue - domain[1]) < 0.001 ? Number.POSITIVE_INFINITY : shiftFilterDateDay(maxValue, 'max'),\n      }),\n    edit: (value, attachment, type) => {\n      return new Promise((resolve) => {\n        const dialogCtx = {\n          attachment,\n          manager: context.dialogManager,\n          level: context.dialogManager.maxLevel + 1,\n          idPrefix: context.idPrefix,\n          sanitize: context.sanitize,\n        };\n        const dialog = new InputDateDialog(\n          dialogCtx,\n          (d) => resolve(d == null ? NaN : shiftFilterDateDay(d.getTime(), type)),\n          { value: Number.isNaN(value) ? null : new Date(value) }\n        );\n        dialog.open();\n      });\n    },\n  };\n}\n","import { color } from 'd3-color';\nimport { IStringStatistics, round } from '../internal';\nimport { DEFAULT_COLOR, StringColumn } from '../model';\nimport { cssClass, FILTERED_OPACITY } from '../styles';\nimport type { IGroupCellRenderer, IRenderContext, ISummaryRenderer } from './interfaces';\nimport StringCellRenderer from './StringCellRenderer';\n\nconst DEFAULT_FILTERED_COLOR = (() => {\n  const c = color(DEFAULT_COLOR);\n  c.opacity = FILTERED_OPACITY;\n  return c.toString();\n})();\n/**\n * renders a string with additional alignment behavior\n * one instance factory shared among strings\n */\nexport default class StringHistogramCellRenderer extends StringCellRenderer {\n  readonly title: string = 'TopN Histogram';\n\n  createGroup(col: StringColumn, context: IRenderContext): IGroupCellRenderer {\n    const { template, update } = hist(false);\n    return {\n      template,\n      update: (node: HTMLElement, group) => {\n        return context.tasks.groupStringStats(col, group).then((r) => {\n          if (typeof r === 'symbol' || !r) {\n            return;\n          }\n          update(node, r.group, r.summary);\n        });\n      },\n    };\n  }\n\n  createSummary(col: StringColumn, context: IRenderContext, interactive: boolean): ISummaryRenderer {\n    if (interactive) {\n      return super.createSummary(col, context, interactive);\n    }\n    const { template, update } = hist(interactive);\n    return {\n      template,\n      update: (node: HTMLElement) => {\n        return context.tasks.summaryStringStats(col).then((r) => {\n          if (typeof r === 'symbol' || !r) {\n            return;\n          }\n          update(node, r.summary);\n        });\n      },\n    };\n  }\n}\n\nfunction hist(showLabels: boolean) {\n  const bins = Array(5)\n    .fill(0)\n    .map(\n      () =>\n        `<div class=\"${cssClass('histogram-bin')}\" title=\": 0\" data-cat=\"\" ${\n          showLabels ? `data-title=\"\"` : ''\n        }><div style=\"height: 0; background: ${DEFAULT_COLOR}\"></div></div>`\n    )\n    .join('');\n  const template = `<div class=\"${cssClass('histogram')}\">${bins}</div>`;\n\n  return {\n    template,\n    update: (n: HTMLElement, hist: IStringStatistics, gHist?: IStringStatistics) => {\n      const maxBin = (gHist ?? hist).topN.reduce((acc, v) => Math.max(acc, v.count), 0);\n      const updateBin = (d: HTMLElement, i: number) => {\n        const bin = hist.topN[i];\n        const inner = d.firstElementChild! as HTMLElement;\n        d.dataset.cat = bin.value;\n        if (showLabels) {\n          d.dataset.title = bin.value;\n        }\n        if (gHist) {\n          const { count: gCount } = gHist.topN[i] ?? { count: 0 };\n          d.title = `${bin.value}: ${bin.count} of ${gCount}`;\n          inner.style.height = `${round((gCount * 100) / maxBin, 2)}%`;\n          const relY = 100 - round((bin.count * 100) / gCount, 2);\n          inner.style.background =\n            relY === 0\n              ? DEFAULT_COLOR\n              : relY === 100\n              ? DEFAULT_FILTERED_COLOR\n              : `linear-gradient(${DEFAULT_FILTERED_COLOR} ${relY}%, ${DEFAULT_COLOR} ${relY}%, ${DEFAULT_COLOR} 100%)`;\n        } else {\n          d.title = `${bin.value}: ${bin.count}`;\n          const inner = d.firstElementChild! as HTMLElement;\n          inner.style.height = `${Math.round((bin.count * 100) / maxBin)}%`;\n        }\n      };\n      const dataBins = hist.topN.length;\n      const bins = Array.from(n.querySelectorAll<HTMLElement>(`.${cssClass('histogram-bin')}`));\n      for (let i = 0; i < Math.min(bins.length, dataBins); i++) {\n        updateBin(bins[i], i);\n      }\n      for (let i = bins.length; i < dataBins; i++) {\n        const d = n.ownerDocument.createElement('div');\n        d.classList.add(cssClass('histogram-bin'));\n        n.appendChild(d);\n        const dd = n.ownerDocument.createElement('div');\n        dd.style.height = '0';\n        dd.style.background = DEFAULT_COLOR;\n        d.appendChild(dd);\n        updateBin(d, i);\n      }\n      for (let i = dataBins; i < bins.length; i++) {\n        bins[i].remove();\n      }\n    },\n  };\n}\n","import { scaleLinear } from 'd3-scale';\nimport { GUESSES_GROUP_HEIGHT } from '../constants';\nimport { IAdvancedBoxPlotData, extent } from '../internal';\nimport { Column, INumberColumn, IOrderedGroup, isMapAbleColumn, isNumberColumn, NumberColumn } from '../model';\nimport { tasksAll } from '../provider';\nimport { cssClass } from '../styles';\nimport { computeLabel } from './BoxplotCellRenderer';\nimport { colorOf } from './impose';\nimport {\n  ERenderMode,\n  ICellRenderer,\n  ICellRendererFactory,\n  IGroupCellRenderer,\n  IImposer,\n  IRenderContext,\n  ISummaryRenderer,\n} from './interfaces';\nimport { adaptColor, BIG_MARK_LIGHTNESS_FACTOR, noRenderer, SMALL_MARK_LIGHTNESS_FACTOR } from './utils';\n\nexport default class ViolinPlotCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Violin Plot';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return isNumberColumn(col) && mode !== ERenderMode.CELL;\n  }\n\n  create(): ICellRenderer {\n    return noRenderer;\n  }\n\n  createGroup(col: INumberColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\n    const sort = col instanceof NumberColumn && col.isGroupSortedByMe().asc !== undefined ? col.getSortMethod() : '';\n    return {\n      template: createViolinTemplate(col.getWidth(), false),\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return tasksAll([\n          context.tasks.groupBoxPlotStats(col, group, false),\n          context.tasks.groupBoxPlotStats(col, group, true),\n        ]).then((data) => {\n          if (typeof data === 'symbol') {\n            return;\n          }\n          // render\n          const isMissing =\n            data == null ||\n            data[0] == null ||\n            data[0].group.count === 0 ||\n            data[0].group.count === data[0].group.missing;\n\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n          const color = adaptColor(colorOf(col, null, imposer), SMALL_MARK_LIGHTNESS_FACTOR);\n          const fillColor = adaptColor(colorOf(col, null, imposer), BIG_MARK_LIGHTNESS_FACTOR);\n          renderViolin(col, n, data[0].group, data[1].group, sort, color, fillColor);\n        });\n      },\n    };\n  }\n\n  createSummary(\n    col: INumberColumn,\n    context: IRenderContext,\n    _interactive: boolean,\n    imposer?: IImposer\n  ): ISummaryRenderer {\n    return {\n      template: createViolinTemplate(col.getWidth(), isMapAbleColumn(col)),\n      update: (n: HTMLElement) => {\n        return tasksAll([\n          context.tasks.summaryBoxPlotStats(col, false),\n          context.tasks.summaryBoxPlotStats(col, true),\n        ]).then((data) => {\n          if (typeof data === 'symbol') {\n            return;\n          }\n          const isMissing =\n            data == null ||\n            data[0] == null ||\n            data[0].summary.count === 0 ||\n            data[0].summary.count === data[0].summary.missing;\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n          const mappedSummary = data[0].summary;\n          const rawSummary = data[1].summary;\n          const sort =\n            col instanceof NumberColumn && col.isGroupSortedByMe().asc !== undefined ? col.getSortMethod() : '';\n\n          if (isMapAbleColumn(col)) {\n            const range = col.getRange();\n            Array.from(n.getElementsByTagName('span')).forEach((d: HTMLElement, i) => (d.textContent = range[i]));\n          }\n          const color = adaptColor(colorOf(col, null, imposer), SMALL_MARK_LIGHTNESS_FACTOR);\n          const fillColor = adaptColor(colorOf(col, null, imposer), BIG_MARK_LIGHTNESS_FACTOR);\n          renderViolin(col, n, mappedSummary, rawSummary, sort, color, fillColor);\n        });\n      },\n    };\n  }\n}\n\nfunction createViolinTemplate(width: number, isMapped: boolean) {\n  const mappedHelper = isMapped\n    ? `<span class=\"${cssClass('mapping-hint')}\"></span><span class=\"${cssClass('mapping-hint')}\"></span>`\n    : '';\n  const h = GUESSES_GROUP_HEIGHT;\n  return `<div title=\"\">\n      <svg class=\"${cssClass('violin')}\"\n           viewBox=\"0 0 ${width} ${h}\" preserveAspectRatio=\"none meet\">\n        <path class=\"${cssClass('violin-path')}\" d=\"M0,0 L100,0\"></path>\n        <line x1=\"0\" x2=\"0\" y1=\"${h / 2}\" y2=\"${h / 2}\" class=\"${cssClass('violin-iqr')}\"></line>\n        <line x1=\"0\" x2=\"0\" y1=\"${h / 2 - h * 0.25}\" y2=\"${h / 2 + h * 0.25}\" class=\"${cssClass('violin-mean')}\"></line>\n        <line x1=\"0\" x2=\"0\" y1=\"${h / 2 - h * 0.25}\" y2=\"${h / 2 + h * 0.25}\" class=\"${cssClass(\n    'violin-median'\n  )}\"></line>\n      </svg>\n      ${mappedHelper}\n    </div>`;\n}\n\nfunction computePath(xScale: (v: number) => number, data: IAdvancedBoxPlotData) {\n  const halfH = GUESSES_GROUP_HEIGHT / 2;\n  const yScale = scaleLinear([0, halfH - 1]).domain(extent(data.kdePoints, (d) => d.p));\n  const pathF: string[] = [];\n  const pathB: string[] = [];\n  for (const point of data.kdePoints) {\n    const x = xScale(point.v);\n    const y = yScale(point.p);\n    pathF.push(`${pathF.length === 0 ? 'M' : 'L'}${x},${halfH - y}`);\n    pathB.push(`L${x},${halfH + y}`);\n  }\n  pathB.reverse();\n  return pathF.join(' ') + pathB.join(' ') + ' Z';\n}\n\nfunction renderViolin(\n  col: INumberColumn,\n  n: HTMLElement,\n  data: IAdvancedBoxPlotData,\n  label: IAdvancedBoxPlotData,\n  _sort: string,\n  color: string | null,\n  fillColor: string | null\n) {\n  n.title = computeLabel(col, label);\n  const svg = n.firstElementChild as SVGSVGElement;\n  svg.style.color = color;\n  const path = svg.firstElementChild as SVGPathElement;\n  path.style.fill = fillColor;\n  const xScale = scaleLinear([0, col.getWidth()]).domain([0, 1]);\n  path.setAttribute('d', computePath(xScale, data));\n  const iqrLine = svg.children[1] as SVGLineElement;\n  const medianLine = svg.children[2] as SVGCircleElement;\n  const meanLine = svg.children[3] as SVGCircleElement;\n  medianLine.setAttribute('x1', xScale(data.median).toString());\n  medianLine.setAttribute('x2', xScale(data.median).toString());\n  meanLine.setAttribute('x1', xScale(data.mean).toString());\n  meanLine.setAttribute('x2', xScale(data.mean).toString());\n  iqrLine.setAttribute('x1', xScale(data.q1).toString());\n  iqrLine.setAttribute('x2', xScale(data.q3).toString());\n}\n","import { round } from '../internal';\nimport { Column, IDataRow, INumberColumn, isNumberColumn } from '../model';\nimport { CANVAS_HEIGHT, cssClass, TICK } from '../styles';\nimport { colorOf } from './impose';\nimport {\n  ERenderMode,\n  ICellRenderer,\n  ICellRendererFactory,\n  IGroupCellRenderer,\n  IImposer,\n  IRenderContext,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { adaptColor, noRenderer, SMALL_MARK_LIGHTNESS_FACTOR } from './utils';\n\nexport default class TickCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Tick';\n  readonly groupTitle: string = 'Ticks';\n  /**\n   * flag to always render the value\n   * @type {boolean}\n   */\n\n  constructor(private readonly renderValue: boolean = false) {}\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return isNumberColumn(col) && mode === ERenderMode.CELL;\n  }\n\n  create(col: INumberColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const width = col.getWidth();\n    return {\n      template: `<div><div></div><span ${\n        this.renderValue ? '' : `class=\"${cssClass('text-shadow')} ${cssClass('hover-only')}\"`\n      }></span></div>`,\n      update: (n: HTMLDivElement, d: IDataRow) => {\n        renderMissingDOM(n, col, d);\n        const color = adaptColor(colorOf(col, d, imposer), SMALL_MARK_LIGHTNESS_FACTOR);\n        const l = context.sanitize(col.getLabel(d));\n        const v = col.getNumber(d);\n        n.title = l;\n        const tick = n.firstElementChild as HTMLElement;\n        tick.style.background = context.sanitize(color);\n        tick.style.left = `${round(v * 100, 2)}%`;\n        const label = n.lastElementChild as HTMLElement;\n        label.textContent = l;\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        const color = adaptColor(colorOf(col, d, imposer), SMALL_MARK_LIGHTNESS_FACTOR);\n        const v = col.getNumber(d);\n\n        ctx.save();\n        ctx.globalAlpha = TICK.opacity;\n        ctx.fillStyle = color || TICK.color;\n        ctx.fillRect(Math.max(0, v * width - TICK.size / 2), 0, TICK.size, CANVAS_HEIGHT);\n        ctx.restore();\n      },\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return noRenderer;\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import { DENSE_HISTOGRAM } from '../constants';\nimport { round } from '../internal';\nimport { Column, IDataRow, isCategoricalColumn, ICategoricalColumn } from '../model';\nimport { CANVAS_HEIGHT, cssClass, TICK } from '../styles';\nimport { colorOf } from './impose';\nimport {\n  ERenderMode,\n  ICellRenderer,\n  ICellRendererFactory,\n  IGroupCellRenderer,\n  IImposer,\n  IRenderContext,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { adaptColor, noRenderer, SMALL_MARK_LIGHTNESS_FACTOR } from './utils';\n\nexport default class CategoricalTickCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Tick';\n  /**\n   * flag to always render the value\n   * @type {boolean}\n   */\n  constructor(private readonly renderValue: boolean = false) {}\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return isCategoricalColumn(col) && mode === ERenderMode.CELL;\n  }\n\n  create(col: ICategoricalColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const width = col.getWidth();\n    return {\n      template: `<div><div></div><span ${\n        this.renderValue ? '' : `class=\"${cssClass('text-shadow')} ${cssClass('hover-only')}\"`\n      }></span></div>`,\n      update: (n: HTMLDivElement, d: IDataRow) => {\n        renderMissingDOM(n, col, d);\n        const perElem = 100 / col.categories.length;\n        let color = colorOf(col, d, imposer);\n        if (col.categories.length > DENSE_HISTOGRAM) {\n          color = adaptColor(color, SMALL_MARK_LIGHTNESS_FACTOR);\n        }\n        const l = context.sanitize(col.getLabel(d));\n        const index = col.categories.indexOf(col.getCategory(d));\n        n.title = l;\n        const tick = n.firstElementChild as HTMLElement;\n        tick.style.background = context.sanitize(color);\n        tick.style.left = `${round(perElem * index, 2)}%`;\n        tick.style.width = `${round(perElem, 2)}%`;\n        const label = n.lastElementChild as HTMLElement;\n        label.textContent = l;\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        let color = colorOf(col, d, imposer);\n        if (col.categories.length > DENSE_HISTOGRAM) {\n          color = adaptColor(color, SMALL_MARK_LIGHTNESS_FACTOR);\n        }\n        const perElem = width / col.categories.length;\n        const index = col.categories.indexOf(col.getCategory(d));\n\n        ctx.save();\n        ctx.globalAlpha = TICK.opacity;\n        ctx.fillStyle = color || TICK.color;\n        ctx.fillRect(Math.max(0, index * perElem), 0, perElem, CANVAS_HEIGHT);\n        ctx.restore();\n      },\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return noRenderer;\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import type { Column } from '../model';\nimport ActionRenderer from './ActionRenderer';\nimport AggregateGroupRenderer from './AggregateGroupRenderer';\nimport AnnotationRenderer from './AnnotationRenderer';\nimport BarCellRenderer from './BarCellRenderer';\nimport BooleanCellRenderer from './BooleanCellRenderer';\nimport BoxplotCellRenderer from './BoxplotCellRenderer';\nimport BrightnessCellRenderer from './BrightnessCellRenderer';\nimport CategoricalCellRenderer from './CategoricalCellRenderer';\nimport CategoricalHeatmapCellRenderer from './CategoricalHeatmapCellRenderer';\nimport CategoricalStackedDistributionlCellRenderer from './CategoricalStackedDistributionlCellRenderer';\nimport CircleCellRenderer from './CircleCellRenderer';\nimport { DefaultCellRenderer } from './DefaultCellRenderer';\nimport DotCellRenderer from './DotCellRenderer';\nimport GroupCellRenderer from './GroupCellRenderer';\nimport HeatmapCellRenderer from './HeatmapCellRenderer';\nimport HistogramCellRenderer from './HistogramCellRenderer';\nimport ImageCellRenderer from './ImageCellRenderer';\nimport { ERenderMode, ICellRendererFactory } from './interfaces';\nimport InterleavingCellRenderer from './InterleavingCellRenderer';\nimport LinkCellRenderer from './LinkCellRenderer';\nimport LinkMapCellRenderer from './LinkMapCellRenderer';\nimport LoadingCellRenderer from './LoadingCellRenderer';\nimport MapBarCellRenderer from './MapBarCellRenderer';\nimport MultiLevelCellRenderer from './MultiLevelCellRenderer';\nimport RankCellRenderer from './RankCellRenderer';\nimport SelectionRenderer from './SelectionRenderer';\nimport SetCellRenderer from './SetCellRenderer';\nimport SparklineCellRenderer from './SparklineCellRenderer';\nimport StringCellRenderer from './StringCellRenderer';\nimport TableCellRenderer from './TableCellRenderer';\nimport UpSetCellRenderer from './UpSetCellRenderer';\nimport VerticalBarCellRenderer from './VerticalBarCellRenderer';\nimport DateCellRenderer from './DateCellRenderer';\nimport DateHistogramCellRenderer from './DateHistogramCellRenderer';\nimport StringHistogramCellRenderer from './StringHistogramCellRenderer';\nimport ViolinPlotCellRenderer from './ViolinPlotCellRenderer';\nimport TickCellRenderer from './TickCellRenderer';\nimport CategoricalTickCellRenderer from './CategoricalTickCellRenderer';\n\nconst defaultCellRenderer = new DefaultCellRenderer();\n/**\n * default render factories\n */\nexport const renderers: { [key: string]: ICellRendererFactory } = {\n  actions: new ActionRenderer(),\n  aggregate: new AggregateGroupRenderer(),\n  annotate: new AnnotationRenderer(),\n  boolean: new BooleanCellRenderer(),\n  boxplot: new BoxplotCellRenderer(),\n  brightness: new BrightnessCellRenderer(),\n  catdistributionbar: new CategoricalStackedDistributionlCellRenderer(),\n  categorical: new CategoricalCellRenderer(),\n  circle: new CircleCellRenderer(),\n  date: new DateCellRenderer(),\n  default: defaultCellRenderer,\n  dot: new DotCellRenderer(),\n  group: new GroupCellRenderer(),\n  heatmap: new HeatmapCellRenderer(),\n  catheatmap: new CategoricalHeatmapCellRenderer(),\n  histogram: new HistogramCellRenderer(),\n  datehistogram: new DateHistogramCellRenderer(),\n  image: new ImageCellRenderer(),\n  interleaving: new InterleavingCellRenderer(),\n  link: new LinkCellRenderer(),\n  linkMap: new LinkMapCellRenderer(),\n  loading: new LoadingCellRenderer(),\n  nested: new MultiLevelCellRenderer(false),\n  number: new BarCellRenderer(),\n  mapbars: new MapBarCellRenderer(),\n  rank: new RankCellRenderer(),\n  selection: new SelectionRenderer(),\n  set: new SetCellRenderer(),\n  sparkline: new SparklineCellRenderer(),\n  stack: new MultiLevelCellRenderer(),\n  string: new StringCellRenderer(),\n  stringhist: new StringHistogramCellRenderer(),\n  table: new TableCellRenderer(),\n  upset: new UpSetCellRenderer(),\n  verticalbar: new VerticalBarCellRenderer(),\n  violin: new ViolinPlotCellRenderer(),\n  tick: new TickCellRenderer(),\n  cattick: new CategoricalTickCellRenderer(),\n};\n\nexport function chooseRenderer(col: Column, renderers: { [key: string]: ICellRendererFactory }): ICellRendererFactory {\n  const r = renderers[col.getRenderer()];\n  return r && typeof r.create === 'function' ? r : defaultCellRenderer;\n}\n\nexport function chooseGroupRenderer(\n  col: Column,\n  renderers: { [key: string]: ICellRendererFactory }\n): ICellRendererFactory {\n  const r = renderers[col.getGroupRenderer()];\n  return r && typeof r.createGroup === 'function' ? r : defaultCellRenderer;\n}\n\nexport function chooseSummaryRenderer(\n  col: Column,\n  renderers: { [key: string]: ICellRendererFactory }\n): ICellRendererFactory {\n  const r = renderers[col.getSummaryRenderer()];\n  return r && typeof r.createSummary === 'function' ? r : defaultCellRenderer;\n}\n\n/**\n * determined the list of possible renderers for a given colum\n * @param col the column to resolve the renderers\n * @param renderers map of possible renderers\n * @param canRender optional custom canRender function\n */\nexport function getPossibleRenderer(\n  col: Column,\n  renderers: { [key: string]: ICellRendererFactory },\n  canRender?: (type: string, renderer: ICellRendererFactory, col: Column, mode: ERenderMode) => boolean\n) {\n  const all = Object.keys(renderers)\n    .filter(Boolean)\n    .map((type) => ({ type, factory: renderers[type] }));\n\n  const item = all.filter(\n    ({ type, factory }) =>\n      typeof factory.create === 'function' &&\n      factory.canRender(col, ERenderMode.CELL) &&\n      (!canRender || canRender(type, factory, col, ERenderMode.CELL))\n  );\n  const group = all.filter(\n    ({ type, factory }) =>\n      typeof factory.createGroup === 'function' &&\n      factory.canRender(col, ERenderMode.GROUP) &&\n      (!canRender || canRender(type, factory, col, ERenderMode.GROUP))\n  );\n  const summary = all.filter(\n    ({ type, factory }) =>\n      typeof factory.createSummary === 'function' &&\n      factory.canRender(col, ERenderMode.SUMMARY) &&\n      (!canRender || canRender(type, factory, col, ERenderMode.SUMMARY))\n  );\n\n  return {\n    item: item.map(({ type, factory }) => ({ type, label: factory.title })),\n    group: group.map(({ type, factory }) => ({ type, label: factory.groupTitle || factory.title })),\n    summary: summary.map(({ type, factory }) => ({\n      type,\n      label: factory.summaryTitle || factory.groupTitle || factory.title,\n    })),\n  };\n}\n","import colors from \"../colors.js\";\n\nexport default colors(\"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3\");\n","import type {\n  ICategoricalColumn,\n  CategoricalsColumn,\n  CategoricalMapColumn,\n  ICategory,\n  ICategoricalColorMappingFunction,\n} from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { uniqueId } from './utils';\nimport { cssClass } from '../../styles';\nimport { color } from 'd3-color';\nimport {\n  schemeCategory10,\n  schemeAccent,\n  schemeDark2,\n  schemePastel1,\n  schemePastel2,\n  schemeSet1,\n  schemeSet2,\n  schemeSet3,\n} from 'd3-scale-chromatic';\nimport {\n  DEFAULT_CATEGORICAL_COLOR_FUNCTION,\n  ReplacementColorMappingFunction,\n} from '../../model/CategoricalColorMappingFunction';\n\nconst sets: { [key: string]: ReadonlyArray<string> } = {\n  schemeCategory10,\n  schemeAccent,\n  schemeDark2,\n  schemePastel1,\n  schemePastel2,\n  schemeSet1,\n  schemeSet2,\n  schemeSet3,\n};\n\n/** @internal */\nexport default class CategoricalColorMappingDialog extends ADialog {\n  private readonly before: ICategoricalColorMappingFunction;\n\n  constructor(\n    private readonly column: ICategoricalColumn | CategoricalsColumn | CategoricalMapColumn,\n    dialog: IDialogContext\n  ) {\n    super(dialog, {\n      livePreview: 'colorMapping',\n    });\n\n    this.before = column.getColorMapping().clone();\n  }\n\n  protected build(node: HTMLElement) {\n    const id = uniqueId(this.dialog.idPrefix);\n    const mapping = this.column.getColorMapping();\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<div class=\"${cssClass('dialog-table')}\">\n      <div class=\"${cssClass('dialog-color-table-entry')}\">\n        <select id=\"${id}Chooser\">\n          <option value=\"\">Apply Color Scheme...</option>\n          <option value=\"schemeCategory10\">D3 Category 10 (${schemeCategory10.length})</option>\n          <option value=\"schemeSet1\">Set 1 (${schemeSet1.length})</option>\n          <option value=\"schemeSet2\">Set 2 (${schemeSet2.length})</option>\n          <option value=\"schemeSet3\">Set 3 (${schemeSet3.length})</option>\n          <option value=\"schemeAccent\">Accent (${schemeAccent.length})</option>\n          <option value=\"schemeDark2\">Dark2 (${schemeDark2.length})</option>\n          <option value=\"schemePastel1\">Pastel 1 (${schemePastel1.length})</option>\n          <option value=\"schemePastel2\">Pastel 2 (${schemePastel2.length})</option>\n        </select>\n      </div>\n      ${this.column.categories\n        .map(\n          () => `\n        <label class=\"${cssClass('checkbox')} ${cssClass('dialog-color-table-entry')}\">\n          <input data-cat=\"\" type=\"color\" value=\"\">\n          <span> </span>\n        </label>`\n        )\n        .join('')}\n    </div>`\n    );\n    const categories = this.column.categories;\n    Array.from(node.querySelectorAll(`label.${cssClass('checkbox')}.${cssClass('dialog-color-table-entry')}`)).forEach(\n      (n, i) => {\n        const cat = categories[i];\n        (n.firstElementChild as HTMLElement).dataset.cat = cat.name;\n        (n.firstElementChild as HTMLInputElement).value = color(mapping.apply(cat))!.formatHex();\n        n.lastElementChild.textContent = cat.label;\n      }\n    );\n\n    this.findInput('select').onchange = (evt) => {\n      const scheme = sets[(evt.currentTarget as HTMLInputElement).value];\n      if (!scheme) {\n        return;\n      }\n      this.forEach('[data-cat]', (n: HTMLInputElement, i) => {\n        n.value = scheme[i % scheme.length];\n      });\n      if (this.showLivePreviews()) {\n        this.submit();\n      }\n    };\n\n    this.enableLivePreviews('input[type=color]');\n  }\n\n  reset() {\n    const cats = this.column.categories;\n    this.forEach('[data-cat]', (n: HTMLInputElement, i) => {\n      n.value = color(cats[i]!.color)!.formatHex();\n    });\n  }\n\n  submit() {\n    const cats = this.column.categories;\n    const map = new Map<ICategory, string>();\n    this.forEach('input[data-cat]', (n: HTMLInputElement, i) => {\n      const cat = cats[i];\n      if (color(cat.color)!.formatHex() !== n.value) {\n        map.set(cat, n.value);\n      }\n    });\n    if (map.size === 0) {\n      this.column.setColorMapping(DEFAULT_CATEGORICAL_COLOR_FUNCTION);\n    } else {\n      this.column.setColorMapping(new ReplacementColorMappingFunction(map));\n    }\n    return true;\n  }\n\n  cancel() {\n    this.column.setColorMapping(this.before);\n  }\n}\n","import {\n  SetColumn,\n  CategoricalColumn,\n  ICategoricalFilter,\n  ISetCategoricalFilter,\n  Ranking,\n  BooleanColumn,\n} from '../../model';\nimport { findFilterMissing, updateFilterMissingNumberMarkup, filterMissingNumberMarkup } from '../missing';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { forEach } from './utils';\nimport { cssClass, engineCssClass } from '../../styles';\nimport { isCategoryIncluded } from '../../model/internalCategorical';\nimport type { IRankingHeaderContext } from '../interfaces';\n\n/** @internal */\nexport default class CategoricalFilterDialog extends ADialog {\n  private readonly before: ICategoricalFilter;\n\n  constructor(\n    private readonly column: CategoricalColumn | SetColumn | BooleanColumn,\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog, {\n      livePreview: 'filter',\n    });\n    this.before = this.column.getFilter() || { filter: '', filterMissing: false };\n  }\n\n  protected build(node: HTMLElement) {\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<div class=\"${cssClass('dialog-table')}\">\n        <label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')}\">\n          <input type=\"checkbox\" checked>\n          <span>\n            <span class=\"${cssClass('dialog-filter-table-color')}\"></span>\n            <div>Un/Select All</div>\n          </span>\n        </label>\n        ${this.column.categories\n          .map(\n            (c) => `<label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')}\" data-cat=\"\">\n          <input data-cat=\"\" type=\"checkbox\"${isCategoryIncluded(this.before, c) ? 'checked' : ''}>\n          <span>\n            <span class=\"${cssClass('dialog-filter-table-color')}\" style=\"background-color: ${this.ctx.sanitize(\n              c.color\n            )}\"></span>\n            <div class=\"${cssClass('dialog-filter-table-entry-label')}\"> </div>\n            <div class=\"${cssClass('dialog-filter-table-entry-stats')}\"></div>\n          </span>\n        </label>`\n          )\n          .join('')}\n    </div>`\n    );\n    const categories = this.column.categories;\n    Array.from(node.querySelectorAll(`label.${cssClass('checkbox')}[data-cat]`)).forEach((n, i) => {\n      const cat = categories[i];\n      (n.firstElementChild as HTMLElement).dataset.cat = cat.name;\n      n.querySelector(`.${cssClass('dialog-filter-table-entry-label')}`).textContent = cat.label;\n    });\n    // selectAll\n    const selectAll = this.findInput('input:not([data-cat])');\n    selectAll.onchange = () => {\n      forEach(node, 'input[data-cat]', (n: HTMLInputElement) => (n.checked = selectAll.checked));\n    };\n    if (this.column instanceof SetColumn) {\n      const some = (this.before as ISetCategoricalFilter).mode !== 'every';\n      node.insertAdjacentHTML('beforeend', `<strong>Show rows where</strong>`);\n      node.insertAdjacentHTML(\n        'beforeend',\n        `<label class=\"${cssClass('checkbox')}\">\n        <input type=\"radio\" ${!some ? 'checked=\"checked\"' : ''} name=\"mode\" value=\"every\">\n        <span>all are selected</span>\n      </label>`\n      );\n      node.insertAdjacentHTML(\n        'beforeend',\n        `<label class=\"${cssClass('checkbox')}\" style=\"padding-bottom: 0.6em\">\n        <input type=\"radio\" ${some ? 'checked=\"checked\"' : ''} name=\"mode\" value=\"some\">\n        <span>some are selected</span>\n      </label>`\n      );\n    }\n    node.insertAdjacentHTML('beforeend', filterMissingNumberMarkup(this.before.filterMissing, 0));\n\n    this.enableLivePreviews('input[type=checkbox],input[type=radio]');\n\n    const ranking = this.column.findMyRanker()!;\n    if (ranking) {\n      ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.catFilter`, () => this.updateStats());\n    }\n    this.updateStats();\n  }\n\n  private updateStats() {\n    const ready = this.ctx.provider\n      .getTaskExecutor()\n      .summaryCategoricalStats(this.column)\n      .then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const { summary, data } = r;\n        const missing = data ? data.missing : summary ? summary.missing : 0;\n        updateFilterMissingNumberMarkup(findFilterMissing(this.node).parentElement, missing);\n        if (!summary || !data) {\n          return;\n        }\n        this.forEach(`.${cssClass('dialog-filter-table-entry-stats')}`, (n: HTMLElement, i) => {\n          const bin = summary.hist[i];\n          const raw = data.hist[i];\n          n.textContent = `${bin.count.toLocaleString()}/${raw.count.toLocaleString()}`;\n        });\n      });\n    if (!ready) {\n      return;\n    }\n    this.node.classList.add(engineCssClass('loading'));\n    ready.then(() => {\n      this.node.classList.remove(engineCssClass('loading'));\n    });\n  }\n\n  private updateFilter(filter: string[] | null | RegExp | string, filterMissing: boolean, someMode = false) {\n    const noFilter = filter == null && filterMissing === false;\n    const f: ISetCategoricalFilter = { filter: filter!, filterMissing };\n    if (this.column instanceof SetColumn) {\n      f.mode = someMode ? 'some' : 'every';\n    }\n    this.column.setFilter(noFilter ? null : f);\n  }\n\n  protected reset() {\n    this.forEach('input[data-cat]', (n: HTMLInputElement) => (n.checked = true));\n    findFilterMissing(this.node).checked = false;\n    const mode = this.findInput('input[value=every]');\n    if (mode) {\n      mode.checked = true;\n    }\n  }\n\n  protected cancel() {\n    this.updateFilter(\n      this.before.filter === '' ? null : this.before.filter,\n      this.before.filterMissing,\n      (this.before as ISetCategoricalFilter).mode === 'some'\n    );\n  }\n\n  protected submit() {\n    let f: string[] | null = this.forEach('input[data-cat]:checked', (n: HTMLInputElement) => n.dataset.cat!);\n    if (f.length === this.column.categories.length) {\n      // all checked = no filter\n      f = null;\n    }\n    const filterMissing = findFilterMissing(this.node).checked;\n    const mode = this.findInput('input[value=some]');\n    this.updateFilter(f, filterMissing, mode != null && mode.checked);\n    return true;\n  }\n\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\n    super.cleanUp(action);\n    const ranking = this.column.findMyRanker()!;\n    if (ranking) {\n      ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.catFilter`, null);\n    }\n  }\n}\n","import { round } from '../../internal';\nimport type { OrdinalColumn, ICategoricalFilter } from '../../model';\nimport { isCategoryIncluded } from '../../model/internalCategorical';\nimport { filterMissingMarkup, findFilterMissing } from '../missing';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { forEach } from './utils';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class CategoricalMappingFilterDialog extends ADialog {\n  private readonly before: ICategoricalFilter;\n\n  constructor(private readonly column: OrdinalColumn, dialog: IDialogContext) {\n    super(dialog, {\n      livePreview: 'filter',\n    });\n    this.before = this.column.getFilter() || {\n      filter: this.column.categories.map((d) => d.name),\n      filterMissing: false,\n    };\n  }\n\n  protected build(node: HTMLElement) {\n    const joint = this.column.categories.map((d) =>\n      Object.assign(\n        {\n          range: round(d.value * 100, 2),\n        },\n        d\n      )\n    );\n    joint.sort((a, b) => a.label.localeCompare(b.label));\n\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<div class=\"${cssClass('dialog-table')}\">\n        <label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')}\">\n          <input type=\"checkbox\" checked>\n          <span>\n            <div>Un/Select All</div>\n          </span>\n        </label>\n        ${joint\n          .map(\n            (cat) => `\n          <label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')}\">\n            <input data-cat=\"${cat.name}\" type=\"checkbox\"${isCategoryIncluded(this.before, cat) ? 'checked' : ''}>\n            <span>\n              <input type=\"number\" value=\"${cat.range}\" min=\"0\" max=\"100\" size=\"5\">\n              <div class=\"${cssClass('dialog-filter-color-bar')}\">\n                <span style=\"background-color: ${cat.color}; width: ${cat.range}%\"></span>\n              </div>\n              <div>${cat.label}</div>\n            </span>\n          </label>`\n          )\n          .join('')}\n    </div>`\n    );\n    // TODO sanitize\n    // selectAll\n    const selectAll = this.findInput('input[type=checkbox]:not([data-cat])');\n    selectAll.onchange = () => {\n      forEach(node, '[data-cat]', (n: HTMLInputElement) => (n.checked = selectAll.checked));\n    };\n    this.forEach('input[type=number]', (d: HTMLInputElement) => {\n      d.oninput = () => {\n        (d.nextElementSibling!.firstElementChild as HTMLElement).style.width = `${d.value}%`;\n      };\n    });\n    node.insertAdjacentHTML('beforeend', filterMissingMarkup(this.before.filterMissing));\n\n    this.enableLivePreviews('input[type=checkbox], input[type=number]');\n  }\n\n  private updateFilter(filter: string[] | null | string | RegExp, filterMissing: boolean) {\n    const noFilter = filter == null && filterMissing === false;\n    this.column.setFilter(noFilter ? null : { filter: filter!, filterMissing });\n  }\n\n  protected cancel() {\n    this.updateFilter(this.before.filter, this.before.filterMissing);\n  }\n\n  protected reset() {\n    this.forEach('[data-cat]', (n: HTMLInputElement) => {\n      n.checked = false;\n      (n.nextElementSibling! as HTMLInputElement).value = '50';\n    });\n  }\n\n  protected submit() {\n    const items = this.forEach('input[data-cat]', (n: HTMLInputElement) => ({\n      checked: n.checked,\n      cat: n.dataset.cat!,\n      range: (n.nextElementSibling as HTMLInputElement)!.valueAsNumber,\n    }));\n    let f: string[] | null = items.filter((d) => d.checked).map((d) => d.cat);\n    if (f.length === this.column.categories.length) {\n      // all checked = no filter\n      f = null;\n    }\n    const filterMissing = findFilterMissing(this.node).checked;\n    this.updateFilter(f, filterMissing);\n    this.column.setMapping(items.map((d) => d.range / 100));\n    return true;\n  }\n}\n","import type { Column } from '../../model';\nimport type { IRankingHeaderContext, IRenderInfo } from '../interfaces';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class ChangeRendererDialog extends ADialog {\n  private readonly before: { renderer: string; group: string; summary: string };\n\n  constructor(private readonly column: Column, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\n    super(dialog, {\n      livePreview: 'vis',\n    });\n\n    this.before = {\n      renderer: column.getRenderer(),\n      group: column.getGroupRenderer(),\n      summary: column.getSummaryRenderer(),\n    };\n  }\n\n  protected build(node: HTMLElement) {\n    const current = this.column.getRenderer();\n    const currentGroup = this.column.getGroupRenderer();\n    const currentSummary = this.column.getSummaryRenderer();\n    const { item, group, summary } = this.ctx.getPossibleRenderer(this.column);\n\n    console.assert(item.length > 1 || group.length > 1 || summary.length > 1); // otherwise no need to show this\n\n    const byName = (a: IRenderInfo, b: IRenderInfo) => a.label.localeCompare(b.label);\n    const s = this.ctx.sanitize;\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n      <strong>Item Visualization</strong>\n      ${item\n        .sort(byName)\n        .map(\n          (d) =>\n            ` <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"renderer\" value=\"${s(d.type)}\" ${\n              current === d.type ? 'checked' : ''\n            }><span>${s(d.label)}</span></label>`\n        )\n        .join('')}\n      <strong>Group Visualization</strong>\n      ${group\n        .sort(byName)\n        .map(\n          (d) =>\n            ` <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"group\" value=\"${s(d.type)}\" ${\n              currentGroup === d.type ? 'checked' : ''\n            }><span>${s(d.label)}</span></label>`\n        )\n        .join('')}\n      <strong>Summary Visualization</strong>\n      ${summary\n        .sort(byName)\n        .map(\n          (d) =>\n            ` <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"summary\" value=\"${s(d.type)}\" ${\n              currentSummary === d.type ? 'checked' : ''\n            }><span>${s(d.label)}</span></label>`\n        )\n        .join('')}\n    `\n    );\n\n    this.enableLivePreviews('input[type=radio]');\n  }\n\n  protected cancel() {\n    this.column.setRenderer(this.before.renderer);\n    this.column.setGroupRenderer(this.before.group);\n    this.column.setSummaryRenderer(this.before.summary);\n  }\n\n  protected reset() {\n    const desc = this.column.desc;\n    const r = this.findInput(`input[name=renderer][value=\"${desc.renderer || desc.type}\"]`);\n    if (r) {\n      r.checked = true;\n    }\n    const g = this.findInput(`input[name=group][value=\"${desc.groupRenderer || desc.type}\"]`);\n    if (g) {\n      g.checked = true;\n    }\n    const s = this.findInput(`input[name=summary][value=\"${desc.summaryRenderer || desc.type}\"]`);\n    if (s) {\n      s.checked = true;\n    }\n  }\n\n  protected submit() {\n    const renderer = this.findInput('input[name=renderer]:checked').value;\n    const group = this.findInput('input[name=group]:checked').value;\n    const summary = this.findInput('input[name=summary]:checked').value;\n\n    this.column.setRenderer(renderer);\n    this.column.setGroupRenderer(group);\n    this.column.setSummaryRenderer(summary);\n\n    return true;\n  }\n}\n","import ADialog, { IDialogContext } from './ADialog';\nimport {\n  schemeCategory10,\n  schemeSet1,\n  schemeSet2,\n  schemeSet3,\n  schemeAccent,\n  schemeDark2,\n  schemePastel2,\n  schemePastel1,\n} from 'd3-scale-chromatic';\nimport { round } from '../../internal';\nimport { uniqueId } from '../../renderer/utils';\nimport {\n  QuantizedColorFunction,\n  CustomColorMappingFunction,\n  SolidColorFunction,\n  SequentialColorFunction,\n  DivergentColorFunction,\n} from '../../model/ColorMappingFunction';\nimport { IMapAbleColumn, DEFAULT_COLOR, IColorMappingFunction, IMapAbleDesc } from '../../model';\nimport { cssClass } from '../../styles';\nimport type { IRankingHeaderContext } from '../interfaces';\n\nexport default class ColorMappingDialog extends ADialog {\n  private readonly before: IColorMappingFunction;\n  private readonly id = uniqueId('col');\n\n  constructor(\n    private readonly column: IMapAbleColumn,\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog, {\n      livePreview: 'colorMapping',\n    });\n\n    this.before = this.column.getColorMapping();\n  }\n\n  private createTemplate(id: string, wrapped: IColorMappingFunction) {\n    const current = wrapped instanceof QuantizedColorFunction ? wrapped.base : wrapped;\n    const entries = current instanceof CustomColorMappingFunction ? current.entries : [];\n\n    let h = '';\n    h += `<datalist id=\"${id}L\">${schemeCategory10.map((d) => `<option>${d}\"</option>`).join('')}</datalist>`;\n    h += `<datalist id=\"${id}LW\"><option>#FFFFFF\"</option>${schemeCategory10\n      .slice(0, -1)\n      .map((d) => `<option>${d}</option>`)\n      .join('')}</datalist>`;\n\n    h += `<strong data-toggle=\"${current instanceof SolidColorFunction ? 'open' : ''}\">Solid Color</strong>`;\n    h += `<div>`;\n    {\n      const refColor = current instanceof SolidColorFunction ? current.color : '';\n      let has = refColor === DEFAULT_COLOR;\n      const colorSets = [\n        schemeCategory10,\n        schemeAccent,\n        schemeDark2,\n        schemePastel1,\n        schemePastel2,\n        schemeSet1,\n        schemeSet2,\n        schemeSet3,\n      ];\n      const renderColor = (d: string) => `<label class=\"${cssClass('checkbox-color')}\">\n        <input name=\"color\" type=\"radio\" value=\"${d}\" ${d === refColor ? 'checked=\"checked\"' : ''}>\n        <span style=\"background: ${d}\"></span>\n      </label>`;\n      colorSets.forEach((colors, i) => {\n        has = has || colors.includes(refColor);\n        h += `<div class=\"${cssClass('color-line')}\">\n          ${colors.map(renderColor).join('')}\n          ${i === 0 ? renderColor(DEFAULT_COLOR) : ''}\n        </div>`;\n      });\n      h += `<label class=\"${cssClass('checkbox')} ${cssClass(\n        'color-gradient'\n      )}\"><input name=\"color\" type=\"radio\" value=\"custom:solid\" ${refColor && !has ? 'checked=\"checked\"' : ''}>\n        <span class=\"${cssClass('color-custom')}\"><input type=\"color\" name=\"solid\" list=\"${id}L\" value=\"${\n        current instanceof SolidColorFunction ? this.ctx.sanitize(current.color) : DEFAULT_COLOR\n      }\" ${refColor && !has ? '' : 'disabled'}></span>\n      </label>`;\n    }\n    h += '</div>';\n\n    h += `<strong data-toggle=\"${\n      current instanceof SequentialColorFunction ||\n      (current instanceof CustomColorMappingFunction && entries.length === 2)\n        ? 'open'\n        : ''\n    }\">Sequential Color</strong>`;\n    h += '<div>';\n    h += `<div><label class=\"${cssClass('checkbox')}\">\n      <input name=\"kindS\" type=\"radio\" id=\"${id}KC_S\" value=\"continuous\" ${\n      !(wrapped instanceof QuantizedColorFunction) ? 'checked' : ''\n    }>\n      <span>Continuous</span>\n    </label>\n    <label class=\"${cssClass('checkbox')}\">\n      <input name=\"kindS\" type=\"radio\" id=\"${id}KQ_S\" value=\"quantized\" ${\n      wrapped instanceof QuantizedColorFunction ? 'checked' : ''\n    }>\n      <span>Discrete&nbsp;<input type=\"number\" id=\"${id}KQS_S\" min=\"2\" step=\"1\" style=\"width: 3em\" value=\"${\n      wrapped instanceof QuantizedColorFunction ? `${wrapped.steps}\"` : '5\" disabled'\n    }>&nbsp; steps</span>\n    </label></div>`;\n    {\n      const name = current instanceof SequentialColorFunction ? current.name : '';\n      for (const colors of Object.keys(SequentialColorFunction.FUNCTIONS)) {\n        h += `<label class=\"${cssClass('checkbox')} ${cssClass(\n          'color-gradient'\n        )}\"><input name=\"color\" type=\"radio\" value=\"${colors}\" ${colors === name ? 'checked=\"checked\"' : ''}>\n        <span data-c=\"${colors}\" style=\"background: ${gradient(SequentialColorFunction.FUNCTIONS[colors], 9)}\"></span>\n      </label>`;\n      }\n      const isCustom = entries.length === 2;\n      h += `<label class=\"${cssClass('checkbox')} ${cssClass('color-gradient')}\">\n        <input name=\"color\" type=\"radio\" value=\"custom:sequential\" ${isCustom ? 'checked' : ''}>\n        <span class=\"${cssClass('color-custom')}\">\n          <input type=\"color\" name=\"interpolate0\" list=\"${id}LW\" ${\n        !isCustom ? 'disabled' : `value=\"${entries[0].color}\"`\n      }>\n          <input type=\"color\" name=\"interpolate1\" list=\"${id}LW\" ${\n        !isCustom ? 'disabled' : `value=\"${entries[entries.length - 1].color}\"`\n      }>\n        </span>\n      </label>`;\n    }\n    h += '</div>';\n    h += `<strong data-toggle=\"${\n      current instanceof DivergentColorFunction ||\n      (current instanceof CustomColorMappingFunction && entries.length === 3)\n        ? 'open'\n        : ''\n    }\">Diverging Color</strong>`;\n    h += '<div>';\n    h += `<div><label class=\"${cssClass('checkbox')}\">\n      <input name=\"kindD\" type=\"radio\" id=\"${id}KC_D\" value=\"continuous\" ${\n      !(wrapped instanceof QuantizedColorFunction) ? 'checked' : ''\n    }>\n      <span>Continuous</span>\n    </label>\n    <label class=\"${cssClass('checkbox')}\">\n      <input name=\"kindD\" type=\"radio\" id=\"${id}KQ_D\" value=\"quantized\" ${\n      wrapped instanceof QuantizedColorFunction ? 'checked' : ''\n    }>\n      <span>Discrete&nbsp;<input type=\"number\" id=\"${id}KQS_D\" min=\"2\" step=\"1\" style=\"width: 3em\" value=\"${\n      wrapped instanceof QuantizedColorFunction ? `${wrapped.steps}\"` : '5\" disabled'\n    }>&nbsp; steps</span>\n    </label></div>`;\n\n    {\n      const name = current instanceof DivergentColorFunction ? current.name : '';\n      for (const colors of Object.keys(DivergentColorFunction.FUNCTIONS)) {\n        h += `<label class=\"${cssClass('checkbox')} ${cssClass(\n          'color-gradient'\n        )}\"><input name=\"color\" type=\"radio\" value=\"${colors}\" ${colors === name ? 'checked=\"checked\"' : ''}>\n        <span data-c=\"${colors}\" style=\"background: ${gradient(DivergentColorFunction.FUNCTIONS[colors], 11)}\"></span>\n      </label>`;\n      }\n      const isCustom = entries.length === 3;\n      h += `<label class=\"${cssClass('checkbox')} ${cssClass('color-gradient')}\">\n        <input name=\"color\" type=\"radio\" value=\"custom:divergent\" ${isCustom ? 'checked' : ''}>\n        <span class=\"${cssClass('color-custom')}\">\n          <input type=\"color\" name=\"divergingm1\" list=\"${id}L\" ${\n        !isCustom ? 'disabled' : `value=\"${this.ctx.sanitize(entries[0].color)}\"`\n      }>\n          <input type=\"color\" name=\"diverging0\" list=\"${id}LW\" ${\n        !isCustom ? 'disabled' : `value=\"${this.ctx.sanitize(entries[1].color)}\"`\n      }>\n          <input type=\"color\" name=\"diverging1\" list=\"${id}L\" ${\n        !isCustom ? 'disabled' : `value=\"${this.ctx.sanitize(entries[2].color)}\"`\n      }>\n        </span>\n      </label>`;\n    }\n    h += '</div>';\n\n    return h;\n  }\n\n  private applyColor() {\n    const selected = this.findInput(`input[name=color]:checked`);\n    if (!selected) {\n      return;\n    }\n    const quantized = this.findInput(`#${this.id}KQ_S`);\n    const steps = this.findInput(`#${this.id}KQS_S`);\n\n    const base = toColor(selected, this.node);\n    if (quantized.checked && !(base instanceof SolidColorFunction)) {\n      this.column.setColorMapping(new QuantizedColorFunction(base, Number.parseInt(steps.value, 10)));\n    } else {\n      this.column.setColorMapping(base);\n    }\n  }\n\n  protected build(node: HTMLElement) {\n    const content = node.ownerDocument!.createElement('div');\n    content.classList.add(cssClass('dialog-color'));\n    node.appendChild(content);\n    this.render(content, this.column.getColorMapping());\n  }\n\n  private render(node: HTMLElement, value: IColorMappingFunction) {\n    const id = this.id;\n    node.innerHTML = this.createTemplate(id, value);\n\n    const toggles = Array.from(node.querySelectorAll<HTMLElement>('strong[data-toggle]'));\n\n    for (const toggle of toggles) {\n      toggle.onclick = (evt) => {\n        evt.preventDefault();\n        evt.stopPropagation();\n        for (const t2 of toggles) {\n          t2.dataset.toggle = t2.dataset.toggle === 'open' || toggle !== t2 ? '' : 'open';\n        }\n      };\n    }\n\n    const customs: HTMLElement[] = [];\n    const updateColor = (d: HTMLInputElement) => {\n      if (!d.checked) {\n        return;\n      }\n      // disable customs\n      for (const custom of customs) {\n        Array.from(custom.nextElementSibling!.getElementsByTagName('input')).forEach(\n          (s) => (s.disabled = custom !== d)\n        );\n      }\n      if (this.showLivePreviews()) {\n        this.applyColor();\n      }\n    };\n\n    const updateSelectedColor = () => {\n      const selected = this.findInput(`input[name=color]:checked`);\n      if (selected) {\n        updateColor(selected);\n      }\n    };\n\n    this.forEach('input[name=color]', (d: HTMLInputElement) => {\n      if (d.value.startsWith('custom:')) {\n        customs.push(d);\n      }\n      d.onchange = () => updateColor(d);\n    });\n\n    // upon changing custom parameter trigger an update\n    this.forEach(`.${cssClass('color-custom')} input[type=color]`, (d: HTMLInputElement) => {\n      d.onchange = () => {\n        const item = d.parentElement!.previousElementSibling! as HTMLInputElement;\n        updateColor(item);\n      };\n    });\n\n    // sync and apply\n    const continuouos = this.findInput(`#${id}KC_S`);\n    const quantized = this.findInput(`#${id}KQ_S`);\n    const steps = this.findInput(`#${id}KQS_S`);\n    const continuouos2 = this.findInput(`#${id}KC_D`);\n    const quantized2 = this.findInput(`#${id}KQ_D`);\n    const steps2 = this.findInput(`#${id}KQS_D`);\n\n    continuouos.onchange = continuouos2.onchange = (evt) => {\n      continuouos.checked = continuouos2.checked = (evt.currentTarget as HTMLInputElement).checked;\n      steps.disabled = steps2.disabled = !quantized.checked;\n      if (continuouos.checked) {\n        this.updateGradients(-1);\n        updateSelectedColor();\n      }\n    };\n    steps.onchange = steps2.onchange = (evt) => {\n      steps.value = steps2.value = (evt.currentTarget as HTMLInputElement).value;\n      this.updateGradients(Number.parseInt(steps.value, 10));\n      updateSelectedColor();\n    };\n    quantized.onchange = quantized2.onchange = (evt) => {\n      quantized.checked = quantized2.checked = (evt.currentTarget as HTMLInputElement).checked;\n      steps.disabled = steps2.disabled = !quantized.checked;\n      if (quantized.checked) {\n        this.updateGradients(Number.parseInt(steps.value, 10));\n        updateSelectedColor();\n      }\n    };\n  }\n\n  protected reset() {\n    const desc = this.column.desc as IMapAbleDesc;\n    const colorMapping = this.ctx.provider.getTypeFactory().colorMappingFunction(desc.colorMapping || desc.color);\n    this.render(this.node.querySelector<HTMLElement>(`.${cssClass('dialog-color')}`)!, colorMapping);\n  }\n\n  protected submit() {\n    this.applyColor();\n    return true;\n  }\n\n  protected cancel() {\n    this.column.setColorMapping(this.before);\n  }\n\n  private updateGradients(steps: number) {\n    this.forEach(`span[data-c]`, (d: HTMLElement) => {\n      const key = d.dataset.c!;\n      const s = SequentialColorFunction.FUNCTIONS[key];\n      if (s) {\n        d.style.background = steps < 0 ? gradient(s, 9) : steppedGradient(s, steps);\n        return;\n      }\n      const di = DivergentColorFunction.FUNCTIONS[key];\n      if (di) {\n        d.style.background = steps < 0 ? gradient(di, 11) : steppedGradient(di, steps);\n        return;\n      }\n    });\n  }\n}\n\nfunction toColor(input: HTMLInputElement, node: HTMLElement) {\n  switch (input.value) {\n    case 'custom:solid':\n      return new SolidColorFunction(node.querySelector<HTMLInputElement>('input[name=solid]')!.value);\n    case 'custom:sequential':\n      const s0 = node.querySelector<HTMLInputElement>('input[name=interpolate0]')!.value;\n      const s1 = node.querySelector<HTMLInputElement>('input[name=interpolate1]')!.value;\n      return new CustomColorMappingFunction([\n        { color: s0, value: 0 },\n        { color: s1, value: 1 },\n      ]);\n    case 'custom:diverging':\n      const dm1 = node.querySelector<HTMLInputElement>('input[name=divergentm1]')!.value;\n      const d0 = node.querySelector<HTMLInputElement>('input[name=divergent0]')!.value;\n      const d1 = node.querySelector<HTMLInputElement>('input[name=divergent1]')!.value;\n      return new CustomColorMappingFunction([\n        { color: dm1, value: 0 },\n        { color: d0, value: 0.5 },\n        { color: d1, value: 1 },\n      ]);\n  }\n  if (input.value in SequentialColorFunction.FUNCTIONS) {\n    return new SequentialColorFunction(input.value);\n  }\n  if (input.value in DivergentColorFunction.FUNCTIONS) {\n    return new DivergentColorFunction(input.value);\n  }\n  return new SolidColorFunction(input.value);\n}\n\nfunction gradient(interpolate: (v: number) => string, steps = 2) {\n  if (steps <= 1) {\n    return `${interpolate(0)}`;\n  }\n  const stepSize = 1 / (steps - 1);\n  let r = `linear-gradient(to right`;\n  for (let i = 0; i < steps; ++i) {\n    r += `, ${interpolate(i * stepSize)} ${round(i * stepSize * 100, 2)}%`;\n  }\n  r += ')';\n  return r;\n}\n\nfunction steppedGradient(color: (v: number) => string, count = 2) {\n  if (count === 1) {\n    return `${color(0)}`;\n  }\n  let r = `linear-gradient(to right`;\n  const stepSize = 1 / count;\n  const half = stepSize / 2;\n  for (let i = 0; i < count; ++i) {\n    // stepped\n    // first and last at border else center\n    const shift = i === 0 ? 0 : i === count - 1 ? stepSize : half;\n    const c = color(i * stepSize + shift);\n    r += `, ${c} ${round(i * stepSize * 100, 2)}%, ${c} ${round((i + 1) * stepSize * 100, 2)}%`;\n  }\n  r += ')';\n  return r;\n}\n","import { cssClass } from '../styles';\n\n/** @internal */\nexport function hasDnDType(e: DragEvent, ...typesToCheck: string[]) {\n  const available: any = e.dataTransfer!.types;\n\n  /*\n   * In Chrome data transfer.types is an Array,\n   * while in Firefox it is a DOMStringList\n   * that only implements a contains-method!\n   */\n  if (typeof available.indexOf === 'function') {\n    return typesToCheck.some((type) => available.indexOf(type) >= 0);\n  }\n  if (typeof available.includes === 'function') {\n    return typesToCheck.some((type) => available.includes(type));\n  }\n  if (typeof available.contains === 'function') {\n    return typesToCheck.some((type) => available.contains(type));\n  }\n  return false;\n}\n\n/**\n * helper storage for dnd in edge since edge doesn't support custom mime-types\n * @type {Map<number, {[p: string]: string}>}\n */\nconst dndTransferStorage = new Map<number, { [key: string]: string }>();\n\nfunction isEdgeDnD(e: DragEvent) {\n  return dndTransferStorage.size > 0 && hasDnDType(e, 'text/plain');\n}\n\n/**\n * checks whether it is a copy operation\n * @param e\n * @returns {boolean|RegExpMatchArray}\n * @internal\n */\nexport function copyDnD(e: DragEvent) {\n  const dT = e.dataTransfer!;\n  return Boolean((e.ctrlKey && dT.effectAllowed.match(/copy/gi)) || !dT.effectAllowed.match(/move/gi));\n}\n\n/**\n * updates the drop effect according to the current copyDnD state\n * @param e\n * @internal\n */\nexport function updateDropEffect(e: DragEvent) {\n  const dT = e.dataTransfer!;\n  if (copyDnD(e)) {\n    dT.dropEffect = 'copy';\n  } else {\n    dT.dropEffect = 'move';\n  }\n}\n\n/** @internal */\nexport type IDragEffect = 'none' | 'copy' | 'copyLink' | 'copyMove' | 'link' | 'linkMove' | 'move' | 'all';\n\n/** @internal */\nexport interface IDragStartResult {\n  effectAllowed: IDragEffect;\n  data: { [mimeType: string]: string };\n}\n\n/** @internal */\nexport interface IDropResult {\n  effect: IDragEffect;\n  data: { [mimeType: string]: string };\n}\n\nlet idCounter = 0;\n\n/**\n * add drag support for the given element\n * @param {HTMLElement} node\n * @param {() => IDragStartResult} onDragStart callback to compute the payload an object of mime types\n * @param {boolean} stopPropagation whether to stop propagation in case of success\n * @internal\n */\nexport function dragAble(\n  node: HTMLElement,\n  onDragStart: () => IDragStartResult,\n  onDragEnd?: () => void,\n  stopPropagation = false\n) {\n  const id = ++idCounter;\n\n  node.classList.add(cssClass('dragable'));\n  node.draggable = true;\n\n  node.addEventListener('dragstart', (e) => {\n    node.classList.add(cssClass('dragging'));\n    const payload = onDragStart();\n    e.dataTransfer!.effectAllowed = payload.effectAllowed;\n\n    if (stopPropagation) {\n      e.stopPropagation();\n    }\n\n    // copy all data transfer objects\n    const keys = Object.keys(payload.data);\n    const allSucceeded = keys.every((k) => {\n      try {\n        e.dataTransfer!.setData(k, payload.data[k]);\n        return true;\n      } catch (e) {\n        return false;\n      }\n    });\n    if (allSucceeded) {\n      return;\n    }\n    //compatibility mode for edge\n    const text = payload.data['text/plain'] || '';\n    e.dataTransfer!.setData('text/plain', `${id}${text ? `: ${text}` : ''}`);\n    dndTransferStorage.set(id, payload.data);\n  });\n\n  node.addEventListener('dragend', (e) => {\n    node.classList.remove(cssClass('dragging'));\n\n    if (stopPropagation) {\n      e.stopPropagation();\n    }\n\n    if (dndTransferStorage.size > 0) {\n      //clear the id\n      dndTransferStorage.delete(id);\n    }\n\n    // remove all\n    const over = node.ownerDocument!.getElementsByClassName(cssClass('dragover'))[0] as HTMLElement;\n    if (over) {\n      over.classList.remove(cssClass('dragover'));\n    }\n\n    if (onDragEnd) {\n      onDragEnd();\n    }\n  });\n}\n\n/**\n * add dropable support for the given node\n * @param {HTMLElement} node\n * @param {string[]} mimeTypes mimeTypes to look for\n * @param {(result: IDropResult, e: DragEvent) => boolean} onDrop callback when dropped, returns true if the drop was successful\n * @param {(e: DragEvent) => void} onDragOver optional drag over handler, e.g. for special effects\n * @param {boolean} stopPropagation flag if the event propagation should be stopped in case of success\n * @param {() => boolean} optional whether to enable dropping at all\n * @internal\n */\nexport function dropAble(\n  node: HTMLElement,\n  mimeTypes: string[],\n  onDrop: (result: IDropResult, e: DragEvent) => boolean,\n  onDragOver: null | ((e: DragEvent) => void) = null,\n  stopPropagation = false,\n  canDrop: () => boolean = () => true\n) {\n  node.addEventListener('dragenter', (e) => {\n    //var xy = mouse($node.node());\n    if (node.classList.contains(cssClass('dragging')) || !(hasDnDType(e, ...mimeTypes) || isEdgeDnD(e)) || !canDrop()) {\n      // not a valid mime type\n      node.classList.remove(cssClass('dragover'));\n      return undefined;\n    }\n    node.classList.add(cssClass('dragover'));\n    if (stopPropagation) {\n      e.stopPropagation();\n    }\n    //sounds good\n    return false;\n  });\n\n  node.addEventListener('dragover', (e) => {\n    if (node.classList.contains(cssClass('dragging')) || !(hasDnDType(e, ...mimeTypes) || isEdgeDnD(e)) || !canDrop()) {\n      // not a valid mime type\n      return undefined;\n    }\n\n    e.preventDefault();\n    updateDropEffect(e);\n    node.classList.add(cssClass('dragover'));\n\n    if (stopPropagation) {\n      e.stopPropagation();\n    }\n    if (onDragOver) {\n      onDragOver(e);\n    }\n    //sound good\n    return false;\n  });\n\n  node.addEventListener('dragleave', (evt) => {\n    // same fix as in phovea\n    (evt.target as HTMLElement).classList.remove(cssClass('dragover'));\n  });\n\n  node.addEventListener('drop', (e) => {\n    e.preventDefault();\n    if (stopPropagation) {\n      e.stopPropagation();\n    }\n    updateDropEffect(e);\n\n    const effect = e.dataTransfer!.dropEffect as IDragEffect;\n\n    node.classList.remove(cssClass('dragover'));\n\n    if (isEdgeDnD(e)) {\n      // retrieve from helper\n      const base = e.dataTransfer!.getData('text/plain');\n      const id = Number.parseInt(base.indexOf(':') >= 0 ? base.substring(0, base.indexOf(':')) : base, 10);\n      if (dndTransferStorage.has(id)) {\n        const data = dndTransferStorage.get(id)!;\n        dndTransferStorage.delete(id);\n        return !onDrop({ effect, data }, e);\n      }\n      return undefined;\n    }\n\n    if (!hasDnDType(e, ...mimeTypes)) {\n      return undefined;\n    }\n\n    // copy sub mime types\n    const data: any = {};\n    //selects the data contained in the data transfer\n    mimeTypes.forEach((mime) => {\n      const value = e.dataTransfer!.getData(mime);\n      if (value !== '') {\n        data[mime] = value;\n      }\n    });\n    return !onDrop({ effect, data }, e);\n  });\n}\n","import type { Column } from '../model';\nimport { getAllToolbarActions, getAllToolbarDialogAddons } from '../model/internal';\nimport type { IRankingHeaderContext, IToolbarAction } from './interfaces';\n\nfunction sortActions(a: IToolbarAction, b: IToolbarAction) {\n  if (a.options.order === b.options.order) {\n    return a.title.toString().localeCompare(b.title.toString());\n  }\n  return (a.options.order || 50) - (b.options.order || 50);\n}\n\nfunction getFullToolbar(col: Column, ctx: IRankingHeaderContext) {\n  const cache = ctx.caches.toolbar;\n  if (cache.has(col.desc.type)) {\n    return cache.get(col.desc.type)!;\n  }\n\n  const keys = getAllToolbarActions(col);\n\n  if (!col.fixed) {\n    keys.push('remove');\n  }\n  {\n    const possible = ctx.getPossibleRenderer(col);\n    if (possible.item.length > 2 || possible.group.length > 2 || possible.summary.length > 2) {\n      // default always possible\n      keys.push('vis');\n    }\n  }\n\n  const actions = ctx.resolveToolbarActions(col, keys);\n\n  const r = Array.from(new Set(actions)).sort(sortActions);\n  cache.set(col.desc.type, r);\n  return r;\n}\n\n/** @internal */\nexport function getToolbar(col: Column, ctx: IRankingHeaderContext) {\n  const toolbar = getFullToolbar(col, ctx);\n  const flags = ctx.flags;\n\n  return toolbar.filter((a) => {\n    if (a.enabled && !a.enabled(col)) {\n      return false;\n    }\n    // level is basic or not one of disabled features\n    return (\n      a.options.featureLevel === 'basic' ||\n      !(\n        (flags.advancedModelFeatures === false && a.options.featureCategory === 'model') ||\n        (flags.advancedRankingFeatures === false && a.options.featureCategory === 'ranking') ||\n        (flags.advancedUIFeatures === false && a.options.featureCategory === 'ui')\n      )\n    );\n  });\n}\n\n/** @internal */\nexport function isSortAble(col: Column, ctx: IRankingHeaderContext) {\n  const toolbar = getFullToolbar(col, ctx);\n  return toolbar.find((d) => d.title === 'Sort' || d.title.startsWith('Sort By')) != null;\n}\n\n/** @internal */\nexport function isGroupAble(col: Column, ctx: IRankingHeaderContext) {\n  const toolbar = getFullToolbar(col, ctx);\n  return toolbar.find((d) => d.title === 'Group' || d.title.startsWith('Group By')) != null;\n}\n\n/** @internal */\nexport function isGroupSortAble(col: Column, ctx: IRankingHeaderContext) {\n  const toolbar = getFullToolbar(col, ctx);\n  return toolbar.find((d) => d.title.startsWith('Sort Groups By')) != null;\n}\n\n/** @internal */\nexport function getToolbarDialogAddons(col: Column, key: string, ctx: IRankingHeaderContext) {\n  const cacheKey = `${col.desc.type}@${key}`;\n  const cacheAddon = ctx.caches.toolbarAddons;\n  if (cacheAddon.has(cacheKey)) {\n    return cacheAddon.get(cacheKey)!;\n  }\n\n  const keys = getAllToolbarDialogAddons(col, key);\n  const actions = ctx.resolveToolbarDialogAddons(col, keys);\n\n  const r = Array.from(new Set(actions)).sort((a, b) => {\n    if (a.order === b.order) {\n      return a.title.localeCompare(b.title);\n    }\n    return (a.order || 50) - (b.order || 50);\n  });\n  cacheAddon.set(cacheKey, r);\n  return r;\n}\n","import Column, { getSortType } from '../model';\nimport { cssClass } from '../styles';\nimport type { IRankingHeaderContext, IToolbarAction } from './interfaces';\nimport { getToolbar } from './toolbarResolvers';\n\n/** @internal */\nexport function actionCSSClass(title: string) {\n  if (title.endsWith('…')) {\n    title = title.slice(0, -2);\n  }\n  if (title.endsWith('&hellip;')) {\n    title = title.slice(0, -'&hellip;'.length - 1);\n  }\n  if (title.endsWith('By')) {\n    title = title.slice(0, -3);\n  }\n  const clean = title.toLowerCase().replace(/[ +-]/gm, '-');\n  return `${cssClass('action')} ${cssClass(`action-${clean}`)}`;\n}\n\nexport function addIconDOM(\n  node: HTMLElement,\n  col: Column,\n  ctx: IRankingHeaderContext,\n  level: number,\n  showLabel: boolean,\n  mode: 'header' | 'sidePanel'\n) {\n  return (action: IToolbarAction) => {\n    const m = isActionMode(col, action, mode, 'shortcut')\n      ? 'o'\n      : isActionMode(col, action, mode, 'menu+shortcut')\n      ? 's'\n      : 'r';\n    const title = ctx.sanitize(action.title);\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<i data-a=\"${m}\" title=\"${title}\" class=\"${actionCSSClass(title)} ${cssClass(\n        `feature-${ctx.sanitize(action.options.featureLevel || 'basic')}`\n      )} ${cssClass(`feature-${ctx.sanitize(action.options.featureCategory || 'others')}`)}\"><span${\n        !showLabel ? ` class=\"${cssClass('aria')}\" aria-hidden=\"true\"` : ''\n      }>${title}</span> </i>`\n    );\n    const i = node.lastElementChild as HTMLElement;\n    i.onclick = (evt) => {\n      evt.stopPropagation();\n      ctx.dialogManager.setHighlightColumn(col);\n      action.onClick(col, evt as any, ctx, level, !showLabel);\n    };\n    return i;\n  };\n}\n\nexport function isActionMode(\n  col: Column,\n  d: IToolbarAction,\n  mode: 'header' | 'sidePanel',\n  value: 'menu' | 'menu+shortcut' | 'shortcut'\n) {\n  const s = d.options.mode === undefined ? 'menu' : d.options.mode;\n  if (s === value) {\n    return true;\n  }\n  if (typeof s === 'function') {\n    return s(col, mode) === value;\n  }\n  return false;\n}\n\n/** @internal */\nexport function createToolbarMenuItems(\n  node: HTMLElement,\n  level: number,\n  col: Column,\n  ctx: IRankingHeaderContext,\n  mode: 'header' | 'sidePanel'\n) {\n  const addIcon = addIconDOM(node, col, ctx, level, true, mode);\n  getToolbar(col, ctx)\n    .filter((d) => !isActionMode(col, d, mode, 'shortcut'))\n    .forEach(addIcon);\n}\n\n/** @internal */\nexport function updateIconState(node: HTMLElement, col: Column) {\n  const sort = node.getElementsByClassName(cssClass('action-sort'))[0]! as HTMLElement;\n  if (sort) {\n    const { asc, priority } = col.isSortedByMe();\n    sort.dataset.sort = asc !== undefined ? asc : '';\n    sort.dataset.type = getSortType(col);\n    if (priority !== undefined) {\n      sort.dataset.priority = (priority + 1).toString();\n    } else {\n      delete sort.dataset.priority;\n    }\n  }\n\n  const sortGroups = node.getElementsByClassName(cssClass('action-sort-groups'))[0]! as HTMLElement;\n  if (sortGroups) {\n    const { asc, priority } = col.isGroupSortedByMe();\n    sortGroups.dataset.sort = asc !== undefined ? asc : '';\n    sortGroups.dataset.type = getSortType(col);\n    if (priority !== undefined) {\n      sortGroups.dataset.priority = (priority + 1).toString();\n    } else {\n      delete sortGroups.dataset.priority;\n    }\n  }\n\n  const group = node.getElementsByClassName(cssClass('action-group'))[0]! as HTMLElement;\n  if (group) {\n    const groupedBy = col.isGroupedBy();\n    group.dataset.group = groupedBy >= 0 ? 'true' : 'false';\n    if (groupedBy >= 0) {\n      group.dataset.priority = (groupedBy + 1).toString();\n    } else {\n      delete group.dataset.priority;\n    }\n  }\n\n  const filter = node.getElementsByClassName(cssClass('action-filter'))[0]! as HTMLElement;\n  if (!filter) {\n    return;\n  }\n  if (col.isFiltered()) {\n    filter.dataset.active = '';\n  } else {\n    delete filter.dataset.active;\n  }\n}\n","import type { Column } from '../../model';\nimport { createToolbarMenuItems, updateIconState } from '../headerTooltip';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport type { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\nimport APopup from './APopup';\n\n/** @internal */\nexport default class MoreColumnOptionsDialog extends APopup {\n  constructor(\n    private readonly column: Column,\n    dialog: IDialogContext,\n    private readonly mode: 'header' | 'sidePanel',\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog, {\n      autoClose: true,\n    });\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('more-options'));\n    node.dataset.colId = this.column.id;\n    createToolbarMenuItems(node, this.dialog.level + 1, this.column, this.ctx, this.mode);\n\n    updateIconState(node, this.column);\n  }\n}\n","import { MIN_LABEL_WIDTH } from '../constants';\nimport { dragAble, dropAble, hasDnDType, IDropResult } from '../internal';\nimport { categoryOf } from '../model';\nimport {\n  createStackDesc,\n  IColumnDesc,\n  isArrayColumn,\n  isBoxPlotColumn,\n  isCategoricalColumn,\n  isMapColumn,\n  isNumberColumn,\n  isNumbersColumn,\n  Column,\n  createImpositionDesc,\n  createImpositionsDesc,\n  createImpositionBoxPlotDesc,\n  CompositeColumn,\n  IMultiLevelColumn,\n  isMultiLevelColumn,\n} from '../model';\nimport { aria, cssClass, engineCssClass, RESIZE_ANIMATION_DURATION, RESIZE_SPACE } from '../styles';\nimport MoreColumnOptionsDialog from './dialogs/MoreColumnOptionsDialog';\nimport type { IRankingHeaderContext, IOnClickHandler } from './interfaces';\nimport { getToolbar } from './toolbarResolvers';\nimport { dialogContext } from './dialogs';\nimport { addIconDOM, actionCSSClass, isActionMode, updateIconState } from './headerTooltip';\nimport { setText } from '../renderer/utils';\n\nexport { createToolbarMenuItems, actionCSSClass } from './headerTooltip';\n\nfunction setTextOrEmpty(node: HTMLElement, condition: boolean, text: string, asHTML = false) {\n  if (condition) {\n    setText(node, ' ');\n  } else if (asHTML) {\n    node.innerHTML = text;\n  } else {\n    setText(node, text);\n  }\n  return node;\n}\n\n/** @internal */\nexport interface IHeaderOptions {\n  dragAble: boolean;\n  mergeDropAble: boolean;\n  rearrangeAble: boolean;\n  resizeable: boolean;\n  level: number;\n  extraPrefix: string;\n}\n\n/** @internal */\nexport function createHeader(col: Column, ctx: IRankingHeaderContext, options: Partial<IHeaderOptions> = {}) {\n  options = Object.assign(\n    {\n      dragAble: true,\n      mergeDropAble: true,\n      rearrangeAble: true,\n      resizeable: true,\n      level: 0,\n      extraPrefix: '',\n    },\n    options\n  );\n  const node = ctx.document.createElement('section');\n\n  const extra = options.extraPrefix\n    ? (name: string) => `${cssClass(name)} ${cssClass(`${options.extraPrefix}-${name}`)}`\n    : cssClass;\n  const summary = col.getMetaData().summary;\n  node.innerHTML = `\n    <div class=\"${extra('label')} ${cssClass('typed-icon')}\"></div>\n    <div class=\"${extra('sublabel')}\"></div>\n    <div class=\"${extra('toolbar')}\"></div>\n    <div class=\"${extra('spacing')}\"></div>\n    <div class=\"${extra('handle')} ${cssClass('feature-advanced')} ${cssClass('feature-ui')}\"></div>\n    ${options.mergeDropAble ? `<div class=\"${extra('header-drop')} ${extra('merger')}\"></div>` : ''}\n    ${\n      options.rearrangeAble\n        ? `<div class=\"${extra('header-drop')} ${extra('placer')}\" data-draginfo=\"Place here\"></div>`\n        : ''\n    }\n  `;\n  setTextOrEmpty(\n    node.firstElementChild as HTMLElement,\n    col.getWidth() < MIN_LABEL_WIDTH,\n    col.label,\n    col.desc.labelAsHTML\n  );\n  setTextOrEmpty(\n    node.children[1] as HTMLElement,\n    col.getWidth() < MIN_LABEL_WIDTH || !summary,\n    summary,\n    col.desc.summaryAsHTML\n  );\n\n  // addTooltip(node, col);\n\n  createShortcutMenuItems(\n    node.getElementsByClassName(cssClass('toolbar'))[0]! as HTMLElement,\n    options.level!,\n    col,\n    ctx,\n    'header'\n  );\n\n  toggleToolbarIcons(node, col);\n\n  if (options.dragAble) {\n    dragAbleColumn(node, col, ctx);\n  }\n  if (options.mergeDropAble) {\n    const merger = node.getElementsByClassName(cssClass('merger'))[0]! as HTMLElement;\n    if (!options.rearrangeAble) {\n      merger.style.left = '0';\n      merger.style.width = '100%';\n    }\n    mergeDropAble(merger, col, ctx);\n  }\n  if (options.rearrangeAble) {\n    const placer = node.getElementsByClassName(cssClass('placer'))[0]! as HTMLElement;\n    const nextSibling = col.nextSibling();\n    const widthFactor = !options.rearrangeAble ? 0.5 : 0.2;\n    if (!options.rearrangeAble) {\n      placer.style.left = '50%';\n    }\n    placer.style.width = `${col.getWidth() * widthFactor + (nextSibling?.getWidth() / 2 ?? 50)}px`;\n    rearrangeDropAble(placer, col, ctx);\n  }\n  if (options.resizeable) {\n    dragWidth(col, node);\n  }\n  return node;\n}\n\n/** @internal */\nexport function updateHeader(node: HTMLElement, col: Column, minWidth = MIN_LABEL_WIDTH) {\n  const label = node.getElementsByClassName(cssClass('label'))[0]! as HTMLElement;\n  setTextOrEmpty(label, col.getWidth() < minWidth, col.label, col.desc.labelAsHTML);\n  const summary = col.getMetaData().summary;\n  const subLabel = node.getElementsByClassName(cssClass('sublabel'))[0] as HTMLElement;\n  if (subLabel) {\n    setTextOrEmpty(subLabel, col.getWidth() < minWidth || !summary, summary, col.desc.summaryAsHTML);\n  }\n\n  let title = col.label;\n  if (summary) {\n    title = `${title}\\n${summary}`;\n  }\n  if (col.description) {\n    title = `${title}\\n${col.description}`;\n  }\n  node.title = title;\n  node.dataset.colId = col.id;\n  node.dataset.type = col.desc.type;\n  label.dataset.typeCat = categoryOf(col).name;\n\n  updateIconState(node, col);\n\n  updateMoreDialogIcons(node, col);\n\n  // update width for width of next sibling\n  const placer = node.getElementsByClassName(cssClass('placer'))[0]! as HTMLElement;\n  if (placer) {\n    const nextSibling = col.nextSibling();\n    const widthFactor = node.getElementsByClassName(cssClass('merger')).length === 0 ? 0.5 : 0.2;\n    placer.style.width = `${col.getWidth() * widthFactor + (nextSibling?.getWidth() * widthFactor ?? 50) + 5}px`;\n  }\n}\n\nfunction updateMoreDialogIcons(node: HTMLElement, col: Column) {\n  const root = node.closest(`.${cssClass()}`);\n  if (!root) {\n    return;\n  }\n  const dialog = root.querySelector<HTMLElement>(`.${cssClass('more-options')}[data-col-id=\"${col.id}\"]`);\n  if (!dialog) {\n    return;\n  }\n  updateIconState(dialog, col);\n}\n\n/** @internal */\nexport interface IAddIcon {\n  (title: string, onClick: IOnClickHandler): void;\n}\n\n/** @internal */\nexport function createShortcutMenuItems(\n  node: HTMLElement,\n  level: number,\n  col: Column,\n  ctx: IRankingHeaderContext,\n  mode: 'header' | 'sidePanel',\n  willAutoHide = true\n) {\n  const addIcon = addIconDOM(node, col, ctx, level, false, mode);\n  const toolbar = getToolbar(col, ctx);\n  const shortcuts = toolbar.filter((d) => !isActionMode(col, d, mode, 'menu'));\n  const hybrids = shortcuts.reduce((a, b) => a + (isActionMode(col, b, mode, 'menu+shortcut') ? 1 : 0), 0);\n\n  shortcuts.forEach(addIcon);\n  const moreEntries = toolbar.length - shortcuts.length + hybrids;\n\n  if (shortcuts.length === toolbar.length || (moreEntries === hybrids && !willAutoHide)) {\n    // all visible or just hybrids that will always be visible\n    return;\n  }\n\n  // need a more entry\n  node.insertAdjacentHTML(\n    'beforeend',\n    `<i data-a=\"m\" data-m=\"${moreEntries}\" title=\"More …\" class=\"${actionCSSClass('More')}\">${aria('More …')}</i>`\n  );\n  const i = node.lastElementChild as HTMLElement;\n  i.onclick = (evt) => {\n    evt.stopPropagation();\n    ctx.dialogManager.setHighlightColumn(col);\n    const dialog = new MoreColumnOptionsDialog(col, dialogContext(ctx, level, evt), mode, ctx);\n    dialog.open();\n  };\n}\n\n/** @internal */\nfunction toggleRotatedHeader(node: HTMLElement, col: Column, defaultVisibleClientWidth: number) {\n  // rotate header flag if needed\n  const label = node.getElementsByClassName(cssClass('label'))[0] as HTMLElement;\n  if (col.getWidth() < MIN_LABEL_WIDTH) {\n    label.classList.remove(`.${cssClass('rotated')}`);\n    return;\n  }\n  const width = label.clientWidth;\n  const rotated =\n    width <= 0\n      ? ((col.label.length * defaultVisibleClientWidth) / 3) * 0.6 > col.getWidth()\n      : label.scrollWidth * 0.6 > label.clientWidth;\n  label.classList.toggle(`.${cssClass('rotated')}`, rotated);\n}\n\n/** @internal */\nfunction toggleToolbarIcons(node: HTMLElement, col: Column, defaultVisibleClientWidth = 22.5) {\n  toggleRotatedHeader(node, col, defaultVisibleClientWidth);\n\n  const toolbar = node.getElementsByClassName(cssClass('toolbar'))[0] as HTMLElement;\n  if (toolbar.childElementCount === 0) {\n    return;\n  }\n  const availableWidth = col.getWidth();\n  const actions = Array.from(toolbar.children).map((d) => ({\n    node: d as HTMLElement,\n    width: d.clientWidth > 0 ? d.clientWidth : defaultVisibleClientWidth,\n  }));\n\n  const shortCuts = actions.filter((d) => d.node.dataset.a === 'o');\n  const hybrids = actions.filter((d) => d.node.dataset.a === 's');\n  const moreIcon = actions.find((d) => d.node.dataset.a === 'm');\n  const moreEntries = moreIcon ? Number.parseInt(moreIcon.node.dataset.m!, 10) : 0;\n  const needMore = moreEntries > hybrids.length;\n\n  let total = actions.reduce((a, b) => a + b.width, 0);\n\n  for (const action of actions) {\n    // maybe hide not needed \"more\"\n    action.node.classList.remove(cssClass('hidden'));\n  }\n\n  // all visible\n  if (total < availableWidth) {\n    return;\n  }\n  if (moreIcon && !needMore && total - moreIcon.width < availableWidth) {\n    // available space is enough we can skip the \"more\" and then it fits\n    moreIcon.node.classList.add(cssClass('hidden'));\n    return;\n  }\n\n  for (const action of hybrids.reverse().concat(shortCuts.reverse())) {\n    // back to forth and hybrids earlier than pure shortcuts\n    // hide and check if enough\n    action.node.classList.add(cssClass('hidden'));\n    total -= action.width;\n    if (total < availableWidth) {\n      return;\n    }\n  }\n}\n\n/**\n * allow to change the width of a column using dragging the handle\n * @internal\n */\nexport function dragWidth(col: Column, node: HTMLElement) {\n  let ueberElement: HTMLElement;\n  let sizeHelper: HTMLElement;\n  let currentFooterTransformation = '';\n  const handle = node.getElementsByClassName(cssClass('handle'))[0] as HTMLElement;\n\n  let start = 0;\n  let originalWidth = 0;\n  const mouseMove = (evt: MouseEvent) => {\n    evt.stopPropagation();\n    evt.preventDefault();\n    const end = evt.clientX;\n    const delta = end - start;\n\n    if (Math.abs(start - end) < 2) {\n      //ignore\n      return;\n    }\n    start = end;\n    const width = Math.max(0, col.getWidth() + delta);\n\n    sizeHelper.classList.toggle(cssClass('resize-animated'), width < originalWidth);\n    // no idea why shifted by the size compared to the other footer element\n    sizeHelper.style.transform = `${currentFooterTransformation} translate(${\n      width - originalWidth - RESIZE_SPACE\n    }px, 0px)`;\n\n    node.style.width = `${width}px`;\n    col.setWidth(width);\n    toggleToolbarIcons(node, col);\n  };\n\n  const mouseUp = (evt: MouseEvent) => {\n    evt.stopPropagation();\n    evt.preventDefault();\n    const end = evt.clientX;\n    node.classList.remove(cssClass('change-width'));\n\n    ueberElement.removeEventListener('mousemove', mouseMove);\n    ueberElement.removeEventListener('mouseup', mouseUp);\n    ueberElement.removeEventListener('mouseleave', mouseUp);\n    ueberElement.classList.remove(cssClass('resizing'));\n    node.style.width = null;\n    setTimeout(() => {\n      sizeHelper.classList.remove(cssClass('resizing'), cssClass('resize-animated'));\n    }, RESIZE_ANIMATION_DURATION * 1.2); // after animation ended\n\n    if (Math.abs(start - end) < 2) {\n      //ignore\n      return;\n    }\n    const delta = end - start;\n    const width = Math.max(0, col.getWidth() + delta);\n    col.setWidth(width);\n    toggleToolbarIcons(node, col);\n  };\n  handle.onmousedown = (evt) => {\n    evt.stopPropagation();\n    evt.preventDefault();\n    node.classList.add(cssClass('change-width'));\n\n    originalWidth = col.getWidth();\n    start = evt.clientX;\n    ueberElement = node.closest<HTMLElement>('body') || node.closest<HTMLElement>(`.${cssClass()}`)!; // take the whole body or root lineup\n    ueberElement.addEventListener('mousemove', mouseMove);\n    ueberElement.addEventListener('mouseup', mouseUp);\n    ueberElement.addEventListener('mouseleave', mouseUp);\n    ueberElement.classList.add(cssClass('resizing'));\n\n    sizeHelper = node\n      .closest<HTMLElement>(`.${engineCssClass()}`)!\n      .querySelector<HTMLElement>(`.${cssClass('resize-helper')}`);\n    currentFooterTransformation = (sizeHelper.previousElementSibling! as HTMLElement).style.transform!;\n    sizeHelper.style.transform = `${currentFooterTransformation} translate(${-RESIZE_SPACE}px, 0px)`;\n    sizeHelper.classList.add(cssClass('resizing'));\n  };\n  handle.onclick = (evt) => {\n    // avoid resorting\n    evt.stopPropagation();\n    evt.preventDefault();\n  };\n}\n\n/** @internal */\nexport const MIMETYPE_PREFIX = 'text/x-caleydo-lineup-column';\n\n/**\n * allow to drag the column away\n * @internal\n */\nexport function dragAbleColumn(node: HTMLElement, column: Column, ctx: IRankingHeaderContext) {\n  dragAble(\n    node,\n    () => {\n      const header = node.closest(`.${engineCssClass('header')}`);\n      if (header) {\n        header.classList.add(cssClass('dragging-column'));\n      }\n      const ref = JSON.stringify(ctx.provider.toDescRef(column.desc));\n      const data: any = {\n        'text/plain': column.label,\n        [`${MIMETYPE_PREFIX}-ref`]: column.id,\n        [MIMETYPE_PREFIX]: ref,\n      };\n      if (isNumberColumn(column)) {\n        data[`${MIMETYPE_PREFIX}-number`] = ref;\n        data[`${MIMETYPE_PREFIX}-number-ref`] = column.id;\n      }\n      if (isCategoricalColumn(column)) {\n        data[`${MIMETYPE_PREFIX}-categorical`] = ref;\n        data[`${MIMETYPE_PREFIX}-categorical-ref`] = column.id;\n      }\n      if (isBoxPlotColumn(column)) {\n        data[`${MIMETYPE_PREFIX}-boxplot`] = ref;\n        data[`${MIMETYPE_PREFIX}-boxplot-ref`] = column.id;\n      }\n      if (isMapColumn(column)) {\n        data[`${MIMETYPE_PREFIX}-map`] = ref;\n        data[`${MIMETYPE_PREFIX}-map-ref`] = column.id;\n      }\n      if (isArrayColumn(column)) {\n        data[`${MIMETYPE_PREFIX}-array`] = ref;\n        data[`${MIMETYPE_PREFIX}-array-ref`] = column.id;\n      }\n      if (isNumbersColumn(column)) {\n        data[`${MIMETYPE_PREFIX}-numbers`] = ref;\n        data[`${MIMETYPE_PREFIX}-numbers-ref`] = column.id;\n      }\n      return {\n        effectAllowed: 'copyMove',\n        data,\n      };\n    },\n    () => {\n      const header = node.closest(`.${engineCssClass('header')}`);\n      if (header) {\n        header.classList.remove(cssClass('dragging-column'));\n      }\n    },\n    true\n  );\n}\n\n/**\n * dropper for allowing to rearrange (move, copy) columns\n * @internal\n */\nexport function rearrangeDropAble(node: HTMLElement, column: Column, ctx: IRankingHeaderContext) {\n  dropAble(\n    node,\n    [`${MIMETYPE_PREFIX}-ref`, MIMETYPE_PREFIX],\n    (result) => {\n      let col: Column | null = null;\n      const data = result.data;\n      if (!(`${MIMETYPE_PREFIX}-ref` in data)) {\n        const desc = JSON.parse(data[MIMETYPE_PREFIX]);\n        col = ctx.provider.create(ctx.provider.fromDescRef(desc));\n        return col != null && column.insertAfterMe(col) != null;\n      }\n\n      // find by reference\n      const id = data[`${MIMETYPE_PREFIX}-ref`];\n      col = ctx.provider.find(id);\n      if (!col || (col === column && !result.effect.startsWith('copy'))) {\n        return false;\n      }\n      if (result.effect.startsWith('copy')) {\n        col = ctx.provider.clone(col!);\n        return col != null && column.insertAfterMe(col) != null;\n      }\n      // detect whether it is an internal move operation or an real remove/insert operation\n      const toInsertParent = col.parent;\n      if (!toInsertParent) {\n        // no parent will always be a move\n        return column.insertAfterMe(col) != null;\n      }\n      if (toInsertParent === column.parent) {\n        // move operation\n        return toInsertParent.moveAfter(col, column) != null;\n      }\n      col.removeMe();\n      return column.insertAfterMe(col) != null;\n    },\n    null,\n    true\n  );\n}\n\n/**\n * dropper for merging columns\n * @internal\n */\nexport function mergeDropAble(node: HTMLElement, column: Column, ctx: IRankingHeaderContext) {\n  const resolveDrop = (result: IDropResult) => {\n    const data = result.data;\n    const copy = result.effect === 'copy';\n    const prefix = MIMETYPE_PREFIX;\n    const key = Object.keys(data).find((d) => d.startsWith(prefix) && d.endsWith('-ref'));\n    if (key) {\n      const id = data[key];\n      let col: Column = ctx.provider.find(id)!;\n      if (copy) {\n        col = ctx.provider.clone(col);\n      } else if (col === column) {\n        return null;\n      } else {\n        col.removeMe();\n      }\n      return col;\n    }\n    const alternative = Object.keys(data).find((d) => d.startsWith(prefix));\n    if (!alternative) {\n      return null;\n    }\n    const desc = JSON.parse(alternative);\n    return ctx.provider.create(ctx.provider.fromDescRef(desc))!;\n  };\n\n  const pushChild = (result: IDropResult) => {\n    const col: Column | null = resolveDrop(result);\n    return col != null && (column as CompositeColumn).push(col) != null;\n  };\n\n  const mergeImpl = (col: Column | null, desc: IColumnDesc) => {\n    if (col == null) {\n      return false;\n    }\n    const ranking = column.findMyRanker()!;\n    const index = ranking.indexOf(column);\n    const parent = ctx.provider.create(desc) as CompositeColumn;\n    column.removeMe();\n    parent.push(column);\n    parent.push(col);\n    return ranking.insert(parent, index) != null;\n  };\n\n  const mergeWith = (desc: IColumnDesc) => (result: IDropResult) => {\n    const col: Column | null = resolveDrop(result);\n    return mergeImpl(col, desc);\n  };\n\n  const all = [`${MIMETYPE_PREFIX}-ref`, MIMETYPE_PREFIX];\n  const numberlike = [`${MIMETYPE_PREFIX}-number-ref`, `${MIMETYPE_PREFIX}-number`];\n  const categorical = [`${MIMETYPE_PREFIX}-categorical-ref`, `${MIMETYPE_PREFIX}-categorical`];\n\n  if (isMultiLevelColumn(column) || column instanceof CompositeColumn) {\n    // stack column or nested\n    node.dataset.draginfo = '+';\n    return dropAble(\n      node,\n      (column as IMultiLevelColumn | CompositeColumn).canJustAddNumbers ? numberlike : all,\n      pushChild\n    );\n  }\n  if (isNumbersColumn(column)) {\n    node.dataset.draginfo = 'Color by';\n    return dropAble(node, categorical, mergeWith(createImpositionsDesc()));\n  }\n  if (isBoxPlotColumn(column)) {\n    node.dataset.draginfo = 'Color by';\n    return dropAble(node, categorical, mergeWith(createImpositionBoxPlotDesc()));\n  }\n  if (isNumberColumn(column)) {\n    node.dataset.draginfo = 'Merge';\n    return dropAble(\n      node,\n      categorical.concat(numberlike),\n      (result: IDropResult) => {\n        const col: Column | null = resolveDrop(result);\n        if (col == null) {\n          return false;\n        }\n        if (isCategoricalColumn(col)) {\n          return mergeImpl(col, createImpositionDesc());\n        }\n        if (isNumberColumn(col)) {\n          return mergeImpl(col, createStackDesc());\n        }\n        return false;\n      },\n      (e) => {\n        if (hasDnDType(e, ...categorical)) {\n          node.dataset.draginfo = 'Color by';\n          return;\n        }\n        if (hasDnDType(e, ...numberlike)) {\n          node.dataset.draginfo = 'Sum';\n        }\n      }\n    );\n  }\n}\n","import { debounce, clear, suffix } from '../../internal';\nimport { CompositeColumn } from '../../model';\nimport { createHeader, updateHeader } from '../header';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport type { IDialogContext } from './ADialog';\nimport { cssClass, engineCssClass } from '../../styles';\nimport APopup from './APopup';\n\n/** @internal */\nexport default class CompositeChildrenDialog extends APopup {\n  private readonly id: string;\n\n  constructor(private readonly column: CompositeColumn, dialog: IDialogContext, private ctx: IRankingHeaderContext) {\n    super(dialog);\n    this.id = `.dialog${Math.random().toString(36).slice(-8).substring(0, 3)}`;\n  }\n\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\n    super.cleanUp(action);\n    this.column.on(suffix(this.id, CompositeColumn.EVENT_ADD_COLUMN, CompositeColumn.EVENT_REMOVE_COLUMN), null);\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('dialog-sub-nested'));\n    const createChildren = () => {\n      this.column.children.forEach((c) => {\n        const n = createHeader(c, this.ctx, {\n          mergeDropAble: false,\n          resizeable: false,\n          level: this.dialog.level + 1,\n          extraPrefix: 'sub',\n        });\n        n.className = cssClass('header');\n        updateHeader(n, c);\n        const summary = this.ctx.summaryRenderer(c, false);\n        const summaryNode = this.ctx.asElement(summary.template);\n        summaryNode.dataset.renderer = c.getSummaryRenderer();\n        summaryNode.classList.add(cssClass('summary'), cssClass('renderer'), cssClass('th-summary'));\n\n        const r = summary.update(summaryNode);\n        if (r) {\n          summaryNode.classList.add(engineCssClass('loading'));\n          r.then(() => {\n            summaryNode.classList.remove(engineCssClass('loading'));\n          });\n        }\n        n.appendChild(summaryNode);\n        node.appendChild(n);\n      });\n    };\n    createChildren();\n\n    this.column.on(\n      suffix(this.id, CompositeColumn.EVENT_ADD_COLUMN, CompositeColumn.EVENT_REMOVE_COLUMN),\n      debounce(() => {\n        if (!node.parentElement) {\n          // already closed\n          this.destroy();\n          return;\n        }\n        clear(node);\n        createChildren();\n      })\n    );\n  }\n}\n","import type { IRankingHeaderContext } from '..';\nimport { HierarchyColumn, ICategoryInternalNode, ICutOffNode, resolveInnerNodes } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\n\n/** @internal */\nexport default class CutOffHierarchyDialog extends ADialog {\n  private readonly innerNodes: ICategoryInternalNode[];\n  private readonly innerNodePaths: string[];\n\n  private readonly before: ICutOffNode;\n\n  constructor(\n    private readonly column: HierarchyColumn,\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog, {\n      livePreview: 'cutOff',\n    });\n\n    this.innerNodes = resolveInnerNodes(this.column.hierarchy);\n    this.innerNodePaths = this.innerNodes.map((n) => n.path);\n    this.before = column.getCutOff();\n  }\n\n  protected build(node: HTMLElement) {\n    const s = this.ctx.sanitize;\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n        <input type=\"text\" value=\"${s(this.before.node.label)}\" required=\"required\" autofocus=\"autofocus\" list=\"ui${\n        this.ctx.idPrefix\n      }lineupHierarchyList\" placeholder=\"cut off node\">\n        <input type=\"number\" value=\"${\n          isFinite(this.before.maxDepth) ? this.before.maxDepth : ''\n        }\" placeholder=\"max depth (&infin;)\">\n        <datalist id=\"ui${this.ctx.idPrefix}lineupHierarchyList\">${this.innerNodes.map(\n        (node) => `<option value=\"${s(node.path)}\">${s(node.label)}</option>`\n      )}</datalist>`\n    );\n\n    //custom validation\n    const innerNodePaths = this.innerNodePaths;\n    this.findInput('input[type=\"text\"]').addEventListener(\n      'change',\n      function (this: HTMLInputElement) {\n        const value = this.value;\n        if (innerNodePaths.indexOf(value) < 0) {\n          this.setCustomValidity('invalid node');\n        } else {\n          this.setCustomValidity('');\n        }\n      },\n      {\n        passive: true,\n      }\n    );\n\n    this.enableLivePreviews('input[type=text],input[type=number]');\n  }\n\n  protected reset() {\n    this.findInput('input[type=\"text\"]').value = this.column.hierarchy.path;\n    this.findInput('input[type=\"number\"]').value = '';\n  }\n\n  protected cancel() {\n    this.column.setCutOff(this.before);\n  }\n\n  protected submit() {\n    const newNode = this.findInput('input[type=\"text\"]').value;\n    const newNodeIndex = this.innerNodePaths.indexOf(newNode);\n    const node = this.innerNodes[newNodeIndex];\n    const maxDepthText = this.findInput('input[type=\"number\"]').value;\n    const maxDepth = maxDepthText === '' ? Number.POSITIVE_INFINITY : Number.parseInt(maxDepthText, 10);\n    this.column.setCutOff({ node, maxDepth });\n    return true;\n  }\n}\n","import type { DateColumn, IDateFilter } from '../../model';\nimport { noDateFilter } from '../../model/internalDate';\nimport { createDateFilter } from '../../renderer/DateHistogramCellRenderer';\nimport { cssClass } from '../../styles';\nimport ADialog, { IDialogContext } from './ADialog';\nimport type { IRankingHeaderContext } from '../interfaces';\n\n/** @internal */\nexport default class DateFilterDialog extends ADialog {\n  private readonly before: IDateFilter;\n  private handler: { reset: () => void; submit: () => void; cleanUp: () => void } | null = null;\n\n  constructor(\n    private readonly column: DateColumn,\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog, {\n      livePreview: 'filter',\n      cancelSubDialogs: true,\n    });\n    this.before = this.column.getFilter() ?? noDateFilter();\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('dialog-mapper'));\n\n    this.handler = createDateFilter(\n      this.column,\n      node,\n      {\n        dialogManager: this.ctx.dialogManager,\n        idPrefix: this.ctx.idPrefix,\n        tasks: this.ctx.provider.getTaskExecutor(),\n        sanitize: this.ctx.sanitize,\n      },\n      this.showLivePreviews()\n    );\n  }\n\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\n    super.cleanUp(action);\n    this.handler!.cleanUp();\n  }\n\n  protected reset() {\n    this.handler!.reset();\n  }\n\n  protected submit() {\n    this.handler!.submit();\n    return true;\n  }\n\n  protected cancel() {\n    this.column.setFilter(this.before);\n  }\n}\n","import type { IRankingHeaderContext } from '..';\nimport type { LinkColumn, LinkMapColumn, LinksColumn } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\n\n/** @internal */\nexport default class EditPatternDialog extends ADialog {\n  private readonly before: string;\n\n  constructor(\n    private readonly column: LinkColumn | LinksColumn | LinkMapColumn,\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog);\n\n    this.before = this.column.getPattern();\n  }\n\n  protected build(node: HTMLElement) {\n    const templates = this.column.patternTemplates;\n    const s = this.ctx.sanitize;\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<strong>Edit Pattern (access via $\\{value}, $\\{item})</strong><input\n        type=\"text\"\n        size=\"30\"\n        value=\"${s(this.before)}\"\n        required\n        autofocus\n        placeholder=\"pattern (access via $\\{value}, $\\{item})\"\n        ${templates.length > 0 ? `list=\"ui${this.ctx.idPrefix}lineupPatternList\"` : ''}\n      >`\n    );\n    if (templates.length > 0) {\n      node.insertAdjacentHTML(\n        'beforeend',\n        `<datalist id=\"ui${this.ctx.idPrefix}lineupPatternList\">${templates.map(\n          (t) => `<option value=\"${s(t)}\">`\n        )}</datalist>`\n      );\n    }\n\n    this.enableLivePreviews('input');\n  }\n\n  protected cancel() {\n    this.column.setPattern(this.before);\n  }\n\n  protected reset() {\n    this.node.querySelector('input')!.value = '';\n  }\n\n  protected submit() {\n    const newValue = this.node.querySelector('input')!.value;\n    this.column.setPattern(newValue);\n    return true;\n  }\n}\n","import type { Column } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { uniqueId, forEach } from './utils';\nimport { getToolbarDialogAddons } from '../toolbarResolvers';\nimport type { IRankingHeaderContext, IToolbarDialogAddonHandler } from '../interfaces';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class GroupDialog extends ADialog {\n  private readonly handlers: IToolbarDialogAddonHandler[] = [];\n\n  constructor(private readonly column: Column, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\n    super(dialog, {\n      livePreview: 'group',\n    });\n  }\n\n  protected build(node: HTMLElement) {\n    const addons = getToolbarDialogAddons(this.column, 'group', this.ctx);\n    for (const addon of addons) {\n      const strong = node.ownerDocument.createElement('strong');\n      strong.textContent = addon.title;\n      this.node.insertAdjacentElement('beforeend', strong);\n      this.handlers.push(addon.append(this.column, this.node, this.dialog, this.ctx));\n    }\n\n    this.handlers.push(sortOrder(node, this.column, this.dialog.idPrefix));\n\n    for (const handler of this.handlers) {\n      this.enableLivePreviews(handler.elems);\n    }\n  }\n\n  protected submit() {\n    for (const handler of this.handlers) {\n      if (handler.submit() === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  protected cancel() {\n    for (const handler of this.handlers) {\n      handler.cancel();\n    }\n  }\n\n  protected reset() {\n    for (const handler of this.handlers) {\n      handler.reset();\n    }\n  }\n}\n\nfunction sortOrder(node: HTMLElement, column: Column, idPrefix: string): IToolbarDialogAddonHandler {\n  const ranking = column.findMyRanker()!;\n  const current = ranking.getGroupCriteria();\n  let order = current.indexOf(column);\n  const enabled = order >= 0;\n\n  if (order < 0) {\n    order = current.length;\n  }\n\n  const id = uniqueId(idPrefix);\n  node.insertAdjacentHTML(\n    'afterbegin',\n    `\n        <strong>Group By</strong>\n        <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"grouped\" value=\"true\" ${\n      enabled ? 'checked' : ''\n    } ><span>Enabled</span></label>\n        <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"grouped\" value=\"false\" ${\n      !enabled ? 'checked' : ''\n    } ><span>Disabled</span></label>\n        <strong>Group Priority</strong>\n        <input type=\"number\" id=\"${id}P\" step=\"1\" min=\"1\" max=\"${current.length + 1}\" value=\"${order + 1}\">\n    `\n  );\n\n  const updateDisabled = (disable: boolean) => {\n    forEach(\n      node,\n      'input:not([name=grouped]), select, textarea',\n      (d: HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement) => {\n        d.disabled = disable;\n      }\n    );\n  };\n  updateDisabled(!enabled);\n\n  forEach(node, 'input[name=grouped]', (n: HTMLInputElement) => {\n    n.addEventListener(\n      'change',\n      () => {\n        const enabled = n.value === 'true';\n        updateDisabled(!enabled);\n      },\n      {\n        passive: true,\n      }\n    );\n  });\n\n  return {\n    elems: `input[name=grouped], #${id}P`,\n    submit() {\n      const enabled = node.querySelector<HTMLInputElement>('input[name=grouped]:checked')!.value === 'true';\n      const order = Number.parseInt(node.querySelector<HTMLInputElement>(`#${id}P`)!.value, 10) - 1;\n      ranking.groupBy(column, !enabled ? -1 : order);\n      return true;\n    },\n    reset() {\n      node.querySelector<HTMLInputElement>('input[name=grouped][value=false]')!.checked = true;\n      node.querySelector<HTMLInputElement>(`#${id}P`)!.value = (current.length + (!enabled ? 1 : 0)).toString();\n      updateDisabled(true);\n    },\n    cancel() {\n      ranking.groupBy(column, current.indexOf(column));\n    },\n  };\n}\n","import { round, similar, dragHandle, IDragHandleOptions } from '../../internal';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\n\nfunction clamp(v: number) {\n  return Math.max(Math.min(v, 100), 0);\n}\n\n/** @internal */\nexport interface IMappingAdapter {\n  destroyed(self: MappingLine): void;\n\n  updated(self: MappingLine): void;\n\n  domain(): number[];\n\n  normalizeRaw(v: number): number;\n\n  unnormalizeRaw(v: number): number;\n\n  dialog: IDialogContext;\n\n  formatter(v: number): string;\n}\n\n/** @internal */\nexport default class MappingLineDialog extends ADialog {\n  private readonly before: { domain: number; range: number };\n\n  constructor(\n    private readonly line: {\n      destroy(): void;\n      domain: number;\n      range: number;\n      frozen: boolean;\n      update(domain: number, range: number, trigger: boolean): void;\n    },\n    dialog: IDialogContext,\n    private readonly adapter: IMappingAdapter\n  ) {\n    super(dialog, {\n      livePreview: 'dataMapping',\n    });\n    this.dialog.attachment.classList.add(cssClass('mapping-line-selected'));\n    this.before = {\n      domain: this.line.domain,\n      range: this.line.range,\n    };\n  }\n\n  build(node: HTMLElement) {\n    const domain = this.adapter.domain();\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n        <button class=\"${cssClass('dialog-button')} lu-action-remove\" title=\"Remove\" type=\"button\" ${\n        this.line.frozen ? 'style=\"display: none\"' : ''\n      } ><span style=\"margin-left: 3px\">Remove Mapping Line</span></button>\n        <strong>Input Domain Value (min ... max)</strong>\n        <input type=\"number\" value=\"${this.adapter.formatter(this.adapter.unnormalizeRaw(this.line.domain))}\" ${\n        this.line.frozen ? 'readonly disabled' : ''\n      } autofocus required min=\"${domain[0]}\" max=\"${domain[1]}\" step=\"any\">\n        <strong>Output Normalized Value (0 ... 1)</strong>\n        <input type=\"number\" value=\"${round(this.line.range / 100, 3)}\" required min=\"0\" max=\"1\" step=\"any\">\n      `\n    );\n    this.find('button').addEventListener(\n      'click',\n      () => {\n        this.destroy('confirm');\n        this.line.destroy();\n      },\n      {\n        passive: true,\n      }\n    );\n    this.enableLivePreviews('input');\n  }\n\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\n    super.cleanUp(action);\n\n    this.dialog.attachment.classList.remove(cssClass('mapping-line-selected'));\n  }\n\n  protected cancel() {\n    this.line.update(this.before.domain, this.before.range, true);\n  }\n\n  protected reset() {\n    this.findInput('input[type=number]').value = round(this.adapter.unnormalizeRaw(this.before.domain), 3).toString();\n    this.findInput('input[type=number]:last-of-type').value = round(this.before.range / 100, 3).toString();\n  }\n\n  protected submit() {\n    if (!this.node.checkValidity()) {\n      return false;\n    }\n    const domain = this.adapter.normalizeRaw(this.findInput('input[type=number]').valueAsNumber);\n    const range = this.findInput('input[type=number]:last-of-type').valueAsNumber * 100;\n    this.line.update(domain, range, true);\n    return true;\n  }\n}\n\n/** @internal */\nexport class MappingLine {\n  readonly node: SVGGElement;\n\n  constructor(g: SVGGElement, public domain: number, public range: number, private readonly adapter: IMappingAdapter) {\n    const h = 52;\n    g.insertAdjacentHTML(\n      'beforeend',\n      `<g class=\"${cssClass('dialog-mapper-mapping')}\" transform=\"translate(${domain},0)\">\n      <line x1=\"0\" x2=\"${range - domain}\" y2=\"${h}\"></line>\n      <line x1=\"0\" x2=\"${range - domain}\" y2=\"${h}\"></line>\n      <circle r=\"2\"></circle>\n      <circle cx=\"${range - domain}\" cy=\"${h}\" r=\"2\"></circle>\n      <text class=\"${cssClass('dialog-mapper-mapping-domain')} ${\n        domain > 25 && domain < 75 ? cssClass('dialog-mapper-mapping-middle') : ''\n      }${domain > 75 ? cssClass('dialog-mapper-mapping-right') : ''}\" dy=\"-3\">\n        ${this.adapter.formatter(this.adapter.unnormalizeRaw(domain))}\n      </text>\n      <text class=\"${cssClass('dialog-mapper-mapping-range')} ${\n        range > 25 && range < 75 ? cssClass('dialog-mapper-mapping-middle') : ''\n      }${range > 50 ? cssClass('dialog-mapper-mapping-right') : ''}\" dy=\"3\" x=\"${range - domain}\" y=\"${h}\">\n        ${round(range / 100, 3)}\n      </text>\n      <title>Drag the anchor circle to change the mapping, double click to edit</title>\n    </g>`\n    );\n    this.node = g.lastElementChild! as SVGGElement;\n\n    // freeze 0 and 100 domain = raw domain ones\n    this.node.classList.toggle(cssClass('frozen'), similar(0, domain) || similar(domain, 100));\n    {\n      let beforeDomain: number;\n      let beforeRange: number;\n      let shiftDomain: number;\n      let shiftRange: number;\n\n      const normalize = (x: number) => (x * 100) / g.getBoundingClientRect().width;\n\n      const common: Partial<IDragHandleOptions> = {\n        container: g.parentElement!,\n        filter: (evt) => evt.button === 0 && !evt.shiftKey,\n        onStart: (_, x) => {\n          beforeDomain = this.domain;\n          beforeRange = this.range;\n          const normalized = normalize(x);\n          shiftDomain = this.domain - normalized;\n          shiftRange = this.range - normalized;\n        },\n        onEnd: () => {\n          if (!similar(beforeDomain, this.domain) || !similar(beforeRange, this.range)) {\n            this.adapter.updated(this);\n          }\n        },\n      };\n\n      const line = this.node.querySelector<SVGLineElement>('line:first-of-type')!;\n      dragHandle(line, {\n        // line\n        ...common,\n        onDrag: (_, x) => {\n          const normalized = normalize(x);\n          this.update(clamp(normalized + shiftDomain), clamp(normalized + shiftRange));\n        },\n      });\n\n      const domainCircle = this.node.querySelector<SVGLineElement>('circle:first-of-type')!;\n      dragHandle(domainCircle, {\n        ...common,\n        onDrag: (_, x) => {\n          const normalized = normalize(x);\n          this.update(clamp(normalized), this.range);\n        },\n      });\n      const rangeCircle = this.node.querySelector<SVGLineElement>('circle:last-of-type')!;\n      dragHandle(rangeCircle, {\n        ...common,\n        onDrag: (_, x) => {\n          const normalized = normalize(x);\n          this.update(this.domain, clamp(normalized));\n        },\n      });\n    }\n\n    this.node.onclick = (evt) => {\n      if (!evt.shiftKey) {\n        return;\n      }\n      this.openDialog();\n    };\n\n    this.node.ondblclick = () => {\n      this.openDialog();\n    };\n  }\n\n  private openDialog() {\n    const ctx = {\n      manager: this.adapter.dialog.manager,\n      level: this.adapter.dialog.level + 1,\n      attachment: this.node as any,\n      idPrefix: this.adapter.dialog.idPrefix,\n      sanitize: this.adapter.dialog.sanitize,\n    };\n    const dialog = new MappingLineDialog(this, ctx, this.adapter);\n    dialog.open();\n  }\n\n  get frozen() {\n    return this.node.classList.contains(cssClass('frozen'));\n  }\n\n  destroy(handled = false) {\n    this.node.remove();\n    if (!handled) {\n      this.adapter.destroyed(this);\n    }\n  }\n\n  update(domain: number, range: number, trigger = false) {\n    if (similar(domain, 100)) {\n      domain = 100;\n    }\n    if (similar(domain, 0)) {\n      domain = 0;\n    }\n    if (similar(range, 100)) {\n      range = 100;\n    }\n    if (similar(range, 0)) {\n      range = 0;\n    }\n\n    if (similar(domain, this.domain) && similar(range, this.range)) {\n      return;\n    }\n    if (this.frozen) {\n      domain = this.domain;\n    }\n    this.domain = domain;\n    this.range = range;\n    this.node.setAttribute('transform', `translate(${domain},0)`);\n    const shift = range - domain;\n    Array.from(this.node.querySelectorAll<SVGLineElement>('line')).forEach((d) => d.setAttribute('x2', String(shift)));\n    this.node.querySelector<SVGCircleElement>('circle[cx]')!.setAttribute('cx', String(shift));\n\n    const t1 = this.node.querySelector<SVGTextElement>('text')!;\n    t1.textContent = this.adapter.formatter(this.adapter.unnormalizeRaw(domain));\n    t1.classList.toggle(cssClass('dialog-mapper-mapping-right'), domain > 75);\n    t1.classList.toggle(cssClass('dialog-mapper-mapping-middle'), domain >= 25 && domain <= 75);\n\n    const t2 = this.node.querySelector<SVGTextElement>('text[x]')!;\n    t2.textContent = round(range / 100, 3).toString();\n    t2.classList.toggle(cssClass('dialog-mapper-mapping-right'), range > 75);\n    t2.classList.toggle(cssClass('dialog-mapper-mapping-middle'), range >= 25 && range <= 75);\n    t2.setAttribute('x', String(shift));\n\n    if (trigger) {\n      this.adapter.updated(this);\n    }\n  }\n}\n","import { ISequence, round } from '../../internal';\nimport { IMapAbleColumn, IMappingFunction, isMissingValue, isMapAbleColumn } from '../../model';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { IMappingAdapter, MappingLine } from './MappingLineDialog';\nimport { cssClass } from '../../styles';\nimport { ScaleMappingFunction, ScriptMappingFunction } from '../../model/MappingFunction';\n\n/** @internal */\nexport default class MappingDialog extends ADialog {\n  private scale: IMappingFunction;\n\n  private readonly mappingLines: MappingLine[] = [];\n  private rawDomain: [number, number];\n\n  private readonly data: Promise<ISequence<number>>;\n  private readonly idPrefix: string;\n\n  private readonly before: IMappingFunction;\n\n  private readonly mappingAdapter: IMappingAdapter = {\n    destroyed: (self: MappingLine) => {\n      this.mappingLines.splice(this.mappingLines.indexOf(self), 1);\n      this.updateLines(this.computeScale());\n    },\n    updated: () => this.updateLines(this.computeScale()),\n    domain: () => this.rawDomain,\n    normalizeRaw: this.normalizeRaw.bind(this),\n    unnormalizeRaw: this.unnormalizeRaw.bind(this),\n    dialog: this.dialog,\n    formatter: this.column.getNumberFormat(),\n  };\n\n  constructor(private readonly column: IMapAbleColumn, dialog: IDialogContext, ctx: IRankingHeaderContext) {\n    super(dialog, {\n      livePreview: 'dataMapping',\n      cancelSubDialogs: true,\n    });\n\n    this.idPrefix = `me${ctx.idPrefix}`;\n    this.before = this.column.getMapping().clone();\n    this.scale = this.column.getMapping().clone();\n    const domain = this.scale.domain;\n    this.rawDomain = [domain[0], domain[domain.length - 1]];\n\n    this.data = Promise.resolve(ctx.provider.mappingSample(column));\n  }\n\n  private get scaleType() {\n    if (this.scale instanceof ScriptMappingFunction) {\n      return 'script';\n    }\n    if (this.scale instanceof ScaleMappingFunction) {\n      const base = this.scale.scaleType;\n      if (base !== 'linear') {\n        return base;\n      }\n      // check if invert or absolute\n      const r = this.scale.range;\n      if (r.length === 2 && r[0] === 1 && r[1] === 0) {\n        return 'linear_invert';\n      }\n      if (r.length === 3 && r[0] === 1 && r[1] === 0 && r[2] === 1) {\n        return 'linear_abs';\n      }\n      return 'linear';\n    }\n    return 'unknown';\n  }\n\n  build(node: HTMLElement) {\n    node.classList.add(cssClass('dialog-mapper'));\n\n    const r = this.column.findMyRanker();\n    const others = !r ? [] : r.flatColumns.filter((d) => isMapAbleColumn(d) && d !== this.column);\n\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n        <div><label for=\"${this.idPrefix}mapping_type\"><strong>Normalization Scaling:</strong></label><select id=\"${\n        this.idPrefix\n      }mapping_type\" class=\"browser-default\">\n        <option value=\"linear\">Linear</option>\n        <option value=\"linear_invert\">Invert</option>\n        <option value=\"linear_abs\">Absolute</option>\n        <option value=\"log\">Log</option>\n        <option value=\"pow1.1\">Pow 1.1</option>\n        <option value=\"pow2\">Pow 2</option>\n        <option value=\"pow3\">Pow 3</option>\n        <option value=\"sqrt\">Sqrt</option>\n        <option value=\"script\">Custom Script</option>\n        <option value=\"unknown\">Unknown</option>\n        ${\n          others.length > 0\n            ? `<optgroup label=\"Copy From\">${others\n                .map(\n                  (d) => `<option value=\"copy_${d.id}\">${this.dialog.sanitize(d.label, d.desc.labelAsHTML)}</option>`\n                )\n                .join('')}</optgroup>`\n            : ''\n        }\n      </select>\n      </div>\n        <div class=\"${cssClass('dialog-mapper-warning')}\">\n          Warning: All items with values outside of the input domain will be set to the min/max value of the input domain.\n        </div>\n        <div class=\"${cssClass('dialog-mapper-domain')}\">\n          <input id=\"${this.idPrefix}min\" required type=\"number\" value=\"${round(this.rawDomain[0], 3)}\" step=\"any\">\n          <span>Input Domain (min - max)</span>\n          <input id=\"${this.idPrefix}max\" required type=\"number\" value=\"${round(this.rawDomain[1], 3)}\" step=\"any\">\n        </div>\n        <svg class=\"${cssClass('dialog-mapper-details')}\" viewBox=\"0 0 106 66\">\n           <g transform=\"translate(3,7)\">\n              <rect y=\"-3\" width=\"100\" height=\"10\">\n                <title>Click to create a new mapping line</title>\n              </rect>\n              <rect y=\"49\" width=\"100\" height=\"10\">\n                <title>Click to create a new mapping line</title>\n              </rect>\n           </g>\n        </svg>\n        <div class=${cssClass('dialog-mapper-range')}>\n          <span>Output Normalized Domain (0 - 1)</span>\n        </div>\n        <div class=\"${cssClass('dialog-mapper-script')}\">\n          <strong>Custom Normalization Script</strong>\n          <textarea class=\"${cssClass('textarea')}\"></textarea>\n        </div>`\n    );\n\n    const g = node.querySelector<SVGGElement>(`.${cssClass('dialog-mapper-details')} > g`);\n\n    this.forEach(\n      `.${cssClass('dialog-mapper-details')} rect`,\n      (d: SVGRectElement) =>\n        (d.onclick = (evt) => {\n          evt.preventDefault();\n          evt.stopPropagation();\n          const bb = d.getBoundingClientRect();\n          const x = round(((evt.x - bb.left) * 100) / bb.width, 2);\n          const m = new MappingLine(g, x, x, this.mappingAdapter);\n          this.mappingLines.push(m);\n        })\n    );\n\n    {\n      const select = this.find<HTMLSelectElement>('select');\n      const textarea = this.find<HTMLSelectElement>('textarea');\n      select.onchange = (evt) => {\n        const select = evt.currentTarget as HTMLSelectElement;\n        switch (select.value) {\n          case 'linear_invert':\n            this.scale = new ScaleMappingFunction(this.rawDomain.slice(), 'linear', [1, 0]);\n            break;\n          case 'linear_abs':\n            this.scale = new ScaleMappingFunction(\n              [this.rawDomain[0], (this.rawDomain[1] - this.rawDomain[0]) / 2, this.rawDomain[1]],\n              'linear',\n              [1, 0, 1]\n            );\n            break;\n          case 'script':\n            const s = new ScriptMappingFunction(this.rawDomain.slice());\n            this.scale = s;\n            textarea.value = s.code;\n            break;\n          case 'unknown':\n            // clone original again\n            this.scale = this.column.getOriginalMapping().clone();\n            break;\n          default:\n            if (select.value.startsWith('copy_')) {\n              this.copyMapping(select.value.slice('copy_'.length));\n              return;\n            }\n            this.scale = new ScaleMappingFunction(this.rawDomain.slice(), select.value, [0, 1]);\n            break;\n        }\n        this.createMappings();\n        node.dataset.scale = select.value;\n        this.updateLines();\n      };\n      const scaleType = (node.dataset.scale = this.scaleType);\n      select.selectedIndex = Array.from(select.options).findIndex((d) => d.value === scaleType);\n\n      if (scaleType === 'script') {\n        textarea.value = (this.scale as ScriptMappingFunction).code;\n      }\n      this.createMappings();\n    }\n\n    this.forEach(`#${this.idPrefix}min, #${this.idPrefix}max`, (d: HTMLInputElement, i) => {\n      d.onchange = () => {\n        const v = d.valueAsNumber;\n        if (v === this.rawDomain[i]) {\n          d.setCustomValidity('');\n          return;\n        }\n        const other = this.rawDomain[1 - i];\n        if (Number.isNaN(v) || (i === 0 && v >= other) || (i === 1 && v <= other)) {\n          d.setCustomValidity(`value has to be ${i === 0 ? '<= max' : '>= min'}`);\n          return;\n        }\n        d.setCustomValidity('');\n        this.rawDomain[i] = v;\n        this.updateDomainWarning();\n\n        this.scale = this.computeScale();\n        const patchedDomain = this.scale.domain.slice();\n        patchedDomain[0] = this.rawDomain[0];\n        patchedDomain[patchedDomain.length - 1] = this.rawDomain[1];\n        this.scale.domain = patchedDomain;\n        this.createMappings();\n        this.updateLines();\n        if (this.showLivePreviews()) {\n          this.column.setMapping(this.scale);\n        }\n      };\n    });\n\n    this.data.then((values) => {\n      values.forEach((v) => {\n        if (!isMissingValue(v)) {\n          g.insertAdjacentHTML(\n            'afterbegin',\n            `<line data-v=\"${v}\" x1=\"${round(this.normalizeRaw(v), 2)}\" x2=\"${round(\n              this.scale.apply(v) * 100,\n              2\n            )}\" y2=\"52\"></line>`\n          );\n        }\n      });\n    });\n\n    this.updateDomainWarning();\n  }\n\n  private updateDomainWarning() {\n    const warningNode = this.node.querySelector<HTMLElement>(`.${cssClass('dialog-mapper-warning')}`);\n    const originalDomain = this.column.getOriginalMapping().domain;\n    const showWarning = this.rawDomain.some((d, i) => originalDomain[i] !== d);\n    warningNode.style.display = showWarning ? '' : 'none';\n  }\n\n  private createMappings() {\n    this.mappingLines.splice(0, this.mappingLines.length).forEach((d) => d.destroy(true));\n    if (!(this.scale instanceof ScaleMappingFunction)) {\n      return;\n    }\n    const g = this.node.querySelector<SVGGElement>(`.${cssClass('dialog-mapper-details')} > g`);\n    const domain = this.scale.domain;\n    const range = this.scale.range;\n    for (let i = 0; i < domain.length; ++i) {\n      this.mappingLines.push(new MappingLine(g, this.normalizeRaw(domain[i]), range[i] * 100, this.mappingAdapter));\n    }\n  }\n\n  private update() {\n    const scaleType = (this.node.dataset.scale = this.scaleType);\n    const select = this.find<HTMLSelectElement>('select');\n    select.selectedIndex = Array.from(select.options).findIndex((d) => d.value === scaleType);\n    if (scaleType === 'script') {\n      this.find<HTMLTextAreaElement>('textarea').value = (this.scale as ScriptMappingFunction).code;\n    }\n    this.forEach(`input[type=number]`, (d: HTMLInputElement, i) => {\n      d.value = round(this.rawDomain[i], 3).toString();\n    });\n  }\n\n  private updateLines(scale = this.scale) {\n    this.forEach(`.${cssClass('dialog-mapper-details')}  > g > line[x1]`, (d: SVGLineElement) => {\n      const v = Number.parseFloat(d.getAttribute('data-v')!);\n      d.setAttribute('x1', round(this.normalizeRaw(v), 2).toString());\n      d.setAttribute('x2', round(scale.apply(v) * 100, 2).toString());\n    });\n  }\n\n  protected reset() {\n    this.scale = this.column.getOriginalMapping().clone();\n    const domain = this.scale.domain;\n    this.rawDomain = [domain[0], domain[domain.length - 1]];\n    this.update();\n    this.createMappings();\n    this.updateLines();\n    this.updateDomainWarning();\n  }\n\n  private copyMapping(columnId: string) {\n    const r = this.column.findMyRanker();\n    if (!r) {\n      return;\n    }\n    const ref = r.find(columnId)! as IMapAbleColumn;\n    this.scale = ref.getMapping().clone();\n    this.rawDomain = this.scale.domain.slice() as [number, number];\n    this.update();\n    this.createMappings();\n    this.updateLines();\n  }\n\n  private normalizeRaw(d: number) {\n    const v = ((d - this.rawDomain[0]) * 100) / (this.rawDomain[1] - this.rawDomain[0]);\n    return Math.max(Math.min(v, 100), 0); // clamp\n  }\n\n  private unnormalizeRaw(d: number) {\n    return (d * (this.rawDomain[1] - this.rawDomain[0])) / 100 + this.rawDomain[0];\n  }\n\n  private computeScale() {\n    const type = this.scaleType;\n    if (type === 'script') {\n      return new ScriptMappingFunction(this.rawDomain.slice(), this.node.querySelector('textarea')!.value);\n    }\n    this.mappingLines.sort((a, b) => a.domain - b.domain);\n    const domain = this.mappingLines.map((d) => this.unnormalizeRaw(d.domain));\n    const range = this.mappingLines.map((d) => d.range / 100);\n    return new ScaleMappingFunction(domain, type, range);\n  }\n\n  protected submit() {\n    if (!this.node.checkValidity()) {\n      return false;\n    }\n    const scale = this.computeScale();\n    this.column.setMapping(scale);\n    return true;\n  }\n\n  protected cancel() {\n    this.column.setMapping(this.before);\n  }\n}\n","import type { IMapAbleColumn, INumberFilter } from '../../model';\nimport { createNumberFilter } from '../../renderer/HistogramCellRenderer';\nimport { cssClass } from '../../styles';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport ADialog, { IDialogContext } from './ADialog';\n\n/** @internal */\nexport default class NumberFilterDialog extends ADialog {\n  private readonly before: INumberFilter;\n  private handler: { reset: () => void; submit: () => void; cleanUp: () => void } | null = null;\n\n  constructor(\n    private readonly column: IMapAbleColumn,\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog, {\n      livePreview: 'filter',\n      cancelSubDialogs: true,\n    });\n\n    this.before = column.getFilter();\n  }\n\n  build(node: HTMLElement) {\n    node.classList.add(cssClass('dialog-mapper'));\n\n    this.handler = createNumberFilter(\n      this.column,\n      node,\n      {\n        dialogManager: this.ctx.dialogManager,\n        idPrefix: this.ctx.idPrefix,\n        tasks: this.ctx.provider.getTaskExecutor(),\n        sanitize: this.ctx.sanitize,\n      },\n      this.showLivePreviews()\n    );\n  }\n\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\n    super.cleanUp(action);\n    this.handler!.cleanUp();\n  }\n\n  protected reset() {\n    this.handler!.reset();\n  }\n\n  protected submit() {\n    this.handler!.submit();\n    return true;\n  }\n\n  protected cancel() {\n    this.column.setFilter(this.before);\n  }\n}\n","import { forEach } from '../../renderer/utils';\nimport { cssClass } from '../../styles';\nimport { getSortLabel } from '../../internal';\nimport type { IToolbarDialogAddonHandler } from '../interfaces';\n\n/** @internal */\nexport function sortMethods(\n  node: HTMLElement,\n  column: { setSortMethod(v: string): void; getSortMethod(): string },\n  methods: string[]\n): IToolbarDialogAddonHandler {\n  const bak = column.getSortMethod();\n  methods.forEach((d) =>\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"multivaluesort\" value=\"${d}\"  ${\n        bak === d ? 'checked' : ''\n      } ><span>${getSortLabel(d)}</span></label>`\n    )\n  );\n\n  forEach(node, 'input[name=multivaluesort]', (n: HTMLInputElement) => {\n    n.addEventListener('change', () => column.setSortMethod(n.value), {\n      passive: true,\n    });\n  });\n\n  return {\n    elems: 'input[name=multivaluesort]',\n    submit() {\n      const selected = node.querySelector<HTMLInputElement>('input[name=multivaluesort]:checked')!.value;\n      column.setSortMethod(selected);\n      return true;\n    },\n    cancel() {\n      column.setSortMethod(bak);\n    },\n    reset() {\n      node.querySelector<HTMLInputElement>(`input[name=multivaluesort][value=\"${bak}\"]`)!.checked = true;\n    },\n  };\n}\n\n/** @internal */\nexport { uniqueId, forEach, forEachChild, colorOf } from '../../renderer/utils';\n","import { EAdvancedSortMethod, ReduceColumn } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { sortMethods } from './utils';\nimport type { IToolbarDialogAddonHandler } from '../interfaces';\n\n/** @internal */\nexport default class ReduceDialog extends ADialog {\n  private handler: IToolbarDialogAddonHandler | null = null;\n\n  constructor(private readonly column: ReduceColumn, dialog: IDialogContext) {\n    super(dialog, {\n      livePreview: 'reduce',\n    });\n  }\n\n  protected build(node: HTMLElement) {\n    const wrapper = {\n      getSortMethod: () => this.column.getReduce(),\n      setSortMethod: (s: EAdvancedSortMethod) => this.column.setReduce(s),\n    };\n    this.handler = sortMethods(node, wrapper, Object.keys(EAdvancedSortMethod));\n\n    this.enableLivePreviews(this.handler.elems);\n  }\n\n  protected submit() {\n    return this.handler!.submit();\n  }\n\n  protected reset() {\n    this.handler!.reset();\n  }\n\n  protected cancel() {\n    this.handler!.cancel();\n  }\n}\n","import type { Column, IColumnMetaData } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class RenameDialog extends ADialog {\n  private readonly before: IColumnMetaData;\n\n  constructor(private readonly column: Column, dialog: IDialogContext) {\n    super(dialog);\n    this.before = column.getMetaData();\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('dialog-rename'));\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n      <input type=\"text\" required autofocus placeholder=\"name\">\n      <input type=\"text\" placeholder=\"summary\" name=\"summary\">\n      <textarea class=\"${cssClass('textarea')}\" rows=\"5\" placeholder=\"description\"></textarea>`\n    );\n    node.querySelector<HTMLInputElement>('input').value = this.column.label;\n    node.querySelector<HTMLInputElement>('input:last-of-type').value = this.column.getMetaData().summary;\n    node.querySelector<HTMLTextAreaElement>('textarea').textContent = this.column.description;\n  }\n\n  protected reset() {\n    const desc = this.column.desc;\n    const meta = {\n      label: desc.label || this.column.id,\n      summary: desc.summary || '',\n      description: desc.description || '',\n    };\n    this.findInput('input[type=\"text\"]').value = meta.label;\n    this.findInput('input[name=\"summary\"]').value = meta.summary;\n    this.node.querySelector('textarea')!.value = meta.description;\n  }\n\n  protected submit() {\n    const label = this.findInput('input[type=\"text\"]').value;\n    const summary = this.findInput('input[name=\"summary\"]').value.trim();\n    const description = this.node.querySelector('textarea')!.value;\n    this.column.setMetaData({ label, description, summary });\n    return true;\n  }\n\n  protected cancel() {\n    this.column.setMetaData(this.before);\n  }\n}\n","import { ScriptColumn } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class ScriptEditDialog extends ADialog {\n  private readonly before: string;\n\n  constructor(private readonly column: ScriptColumn, dialog: IDialogContext) {\n    super(dialog);\n    this.before = column.getScript();\n  }\n\n  protected build(node: HTMLElement) {\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<textarea class=\"${cssClass(\n        'textarea'\n      )}\" autofocus=\"true\" rows=\"5\" autofocus=\"autofocus\" style=\"width: 95%;\">${this.column.getScript()}</textarea>`\n    );\n  }\n\n  protected cancel() {\n    this.column.setScript(this.before);\n  }\n\n  protected reset() {\n    this.node.querySelector('textarea')!.value = (this.column.desc as any).script || ScriptColumn.DEFAULT_SCRIPT;\n  }\n\n  protected submit() {\n    this.column.setScript(this.node.querySelector('textarea')!.value);\n    return true;\n  }\n}\n","import type { Column } from '../../model';\nimport type { IDataProvider } from '../../provider';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\nimport { debounce } from '../../internal';\n\n/** @internal */\nexport default class SearchDialog extends ADialog {\n  constructor(private readonly column: Column, dialog: IDialogContext, private readonly provider: IDataProvider) {\n    super(dialog, {\n      livePreview: 'search',\n    });\n  }\n\n  protected build(node: HTMLElement) {\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<input type=\"text\" size=\"20\" value=\"\" required autofocus placeholder=\"search... (>= 3 chars)\">\n      <label class=\"${cssClass('checkbox')}\">\n        <input type=\"checkbox\">\n        <span>Use regular expressions</span>\n      </label>\n    `\n    );\n\n    const input = node.querySelector<HTMLInputElement>('input[type=\"text\"]')!;\n    const checkbox = node.querySelector<HTMLInputElement>('input[type=\"checkbox\"]')!;\n    const update = () => {\n      const search: any = input.value;\n      if (search.length < 3) {\n        input.setCustomValidity('at least 3 characters');\n        return;\n      }\n      input.setCustomValidity('');\n    };\n    input.addEventListener('input', update, {\n      passive: true,\n    });\n    checkbox.addEventListener('change', update, {\n      passive: true,\n    });\n    this.enableLivePreviews([input, checkbox]);\n\n    if (!this.showLivePreviews()) {\n      return;\n    }\n    input.addEventListener(\n      'input',\n      debounce(() => this.submit(), 100),\n      {\n        passive: true,\n      }\n    );\n  }\n\n  protected submit() {\n    const input = this.findInput('input[type=\"text\"]')!;\n    const checkbox = this.findInput('input[type=\"checkbox\"]')!;\n\n    let search: any = input.value;\n    const isRegex = checkbox.checked;\n    if (isRegex) {\n      search = new RegExp(search);\n    }\n    this.provider.searchAndJump(search, this.column);\n    return true;\n  }\n\n  protected reset() {\n    const input = this.findInput('input[type=\"text\"]')!;\n    const checkbox = this.findInput('input[type=\"checkbox\"]')!;\n    input.value = '';\n    checkbox.checked = false;\n  }\n\n  protected cancel() {\n    // nothing to do\n  }\n}\n","import ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\nimport type { IDataProvider } from '../../provider';\n\n/** @internal */\nexport default class ShowTopNDialog extends ADialog {\n  private readonly before: number;\n\n  constructor(private readonly provider: IDataProvider, dialog: IDialogContext) {\n    super(dialog);\n\n    this.before = this.provider.getShowTopN();\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('dialog-rename'));\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n      <input type=\"number\" min=\"0\" step=\"1\" value=\"${this.dialog.sanitize(String(this.before))}\">`\n    );\n\n    this.enableLivePreviews('input');\n  }\n\n  protected cancel() {\n    this.provider.setShowTopN(this.before);\n  }\n\n  protected submit() {\n    const value = this.findInput('input').valueAsNumber;\n    this.provider.setShowTopN(value);\n    return true;\n  }\n\n  protected reset() {\n    const defaultValue = 10;\n    this.findInput('input').value = defaultValue.toString();\n  }\n}\n","import type { Column } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { uniqueId, forEach } from './utils';\nimport { getToolbarDialogAddons } from '../toolbarResolvers';\nimport type { IRankingHeaderContext, IToolbarDialogAddonHandler } from '../interfaces';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class SortDialog extends ADialog {\n  private readonly handlers: IToolbarDialogAddonHandler[] = [];\n\n  constructor(\n    private readonly column: Column,\n    private readonly groupSortBy: boolean,\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog, {\n      livePreview: groupSortBy ? 'groupSort' : 'sort',\n    });\n  }\n\n  protected build(node: HTMLElement) {\n    const addons = getToolbarDialogAddons(this.column, this.groupSortBy ? 'sortGroup' : 'sort', this.ctx);\n    for (const addon of addons) {\n      const title = this.node.ownerDocument.createElement('strong');\n      title.textContent = addon.title;\n      this.node.insertAdjacentElement('beforeend', title);\n      this.handlers.push(addon.append(this.column, this.node, this.dialog, this.ctx));\n    }\n\n    this.handlers.push(sortOrder(node, this.column, this.dialog.idPrefix, this.groupSortBy));\n\n    for (const handler of this.handlers) {\n      this.enableLivePreviews(handler.elems);\n    }\n  }\n\n  protected submit() {\n    for (const handler of this.handlers) {\n      if (handler.submit() === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  protected cancel() {\n    for (const handler of this.handlers) {\n      handler.cancel();\n    }\n  }\n\n  protected reset() {\n    for (const handler of this.handlers) {\n      handler.reset();\n    }\n  }\n}\n\nfunction sortOrder(\n  node: HTMLElement,\n  column: Column,\n  idPrefix: string,\n  groupSortBy = false\n): IToolbarDialogAddonHandler {\n  const ranking = column.findMyRanker()!;\n  const current = groupSortBy ? ranking.getGroupSortCriteria() : ranking.getSortCriteria();\n  const order = Object.assign({}, groupSortBy ? column.isGroupSortedByMe() : column.isSortedByMe());\n\n  const priority = order.priority === undefined ? current.length : order.priority;\n\n  const id = uniqueId(idPrefix);\n  node.insertAdjacentHTML(\n    'afterbegin',\n    `\n        <strong>Sort Order</strong>\n        <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"sortorder\" value=\"asc\"  ${\n      order.asc === 'asc' ? 'checked' : ''\n    } ><span>Ascending</span></label>\n        <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"sortorder\" value=\"desc\"  ${\n      order.asc === 'desc' ? 'checked' : ''\n    } ><span>Descending</span></label>\n        <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"sortorder\" value=\"none\"  ${\n      order.asc === undefined ? 'checked' : ''\n    } ><span>Unsorted</span></label>\n        <strong>Sort Priority</strong>\n        <input type=\"number\" id=\"${id}P\" step=\"1\" min=\"1\" max=\"${current.length + 1}\" value=\"${priority + 1}\">\n    `\n  );\n\n  const updateDisabled = (disable: boolean) => {\n    forEach(\n      node,\n      'input:not([name=sortorder]), select, textarea',\n      (d: HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement) => {\n        d.disabled = disable;\n      }\n    );\n  };\n  updateDisabled(order.asc === undefined);\n\n  forEach(node, 'input[name=sortorder]', (n: HTMLInputElement) => {\n    n.addEventListener(\n      'change',\n      () => {\n        updateDisabled(n.value === 'none');\n      },\n      {\n        passive: true,\n      }\n    );\n  });\n\n  return {\n    elems: `input[name=sortorder], #${id}P`,\n    submit() {\n      const asc = node.querySelector<HTMLInputElement>('input[name=sortorder]:checked')!.value;\n      const priority = Number.parseInt(node.querySelector<HTMLInputElement>(`#${id}P`)!.value, 10) - 1;\n\n      if (groupSortBy) {\n        ranking.groupSortBy(column, asc === 'asc', asc === 'none' ? -1 : priority);\n      } else {\n        ranking.sortBy(column, asc === 'asc', asc === 'none' ? -1 : priority);\n      }\n      return true;\n    },\n    reset() {\n      node.querySelector<HTMLInputElement>('input[name=sortorder][value=none]')!.checked = true;\n      node.querySelector<HTMLInputElement>(`#${id}P`)!.value = (\n        current.length + (order.priority === undefined ? 1 : 0)\n      ).toString();\n      updateDisabled(true);\n    },\n    cancel() {\n      if (groupSortBy) {\n        ranking.groupSortBy(column, order.asc === 'asc', order.asc === undefined ? -1 : order.priority);\n      } else {\n        ranking.sortBy(column, order.asc === 'asc', order.asc === undefined ? -1 : order.priority);\n      }\n    },\n  };\n}\n","import type { StringColumn, IStringFilter } from '../../model';\nimport { filterMissingMarkup, findFilterMissing } from '../missing';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\nimport { debounce } from '../../internal';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport { filterToString, matchDataList } from '../../renderer/StringCellRenderer';\n\nfunction toInput(text: string, isRegex: boolean) {\n  const v = text.trim();\n  if (v === '') {\n    return null;\n  }\n  return isRegex ? new RegExp(v, 'm') : v;\n}\n\n/** @internal */\nexport default class StringFilterDialog extends ADialog {\n  private readonly before: IStringFilter | null;\n\n  constructor(\n    private readonly column: StringColumn,\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog, {\n      livePreview: 'filter',\n    });\n\n    this.before = this.column.getFilter();\n  }\n\n  private updateFilter(filter: string | RegExp | null, filterMissing: boolean) {\n    if (filter == null && !filterMissing) {\n      this.column.setFilter(null);\n    } else {\n      this.column.setFilter({ filter, filterMissing });\n    }\n  }\n\n  protected reset() {\n    this.findInput('input[type=\"text\"]').value = '';\n    this.forEach('input[type=checkbox]', (n: HTMLInputElement) => (n.checked = false));\n  }\n\n  protected cancel() {\n    if (this.before) {\n      this.updateFilter(this.before.filter === '' ? null : this.before.filter, this.before.filterMissing);\n    } else {\n      this.updateFilter(null, false);\n    }\n  }\n\n  protected submit() {\n    const filterMissing = findFilterMissing(this.node).checked;\n    const input = this.findInput('input[type=\"text\"]').value;\n    const isRegex = this.findInput('input[type=\"checkbox\"]').checked;\n    this.updateFilter(toInput(input, isRegex), filterMissing);\n    return true;\n  }\n\n  protected build(node: HTMLElement) {\n    const s = this.ctx.sanitize;\n    const bak = this.column.getFilter() || { filter: '', filterMissing: false };\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<input type=\"text\" placeholder=\"Filter ${s(this.column.desc.label)} …\" autofocus\n         value=\"${filterToString(bak)}\" list=\"${this.dialog.idPrefix}_sdl\">\n    <label class=\"${cssClass('checkbox')}\">\n      <input type=\"checkbox\" ${bak.filter instanceof RegExp ? 'checked=\"checked\"' : ''}>\n      <span>Use regular expressions</span>\n    </label>\n    ${filterMissingMarkup(bak.filterMissing)}\n    <datalist id=\"${this.dialog.idPrefix}_sdl\"></datalist>`\n    );\n\n    const filterMissing = findFilterMissing(node);\n    const input = node.querySelector<HTMLInputElement>('input[type=\"text\"]');\n    const isRegex = node.querySelector<HTMLInputElement>('input[type=\"checkbox\"]');\n\n    const dl = node.querySelector('datalist')!;\n    this.ctx.provider\n      .getTaskExecutor()\n      .summaryStringStats(this.column)\n      .then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const { summary } = r;\n        matchDataList(dl, summary.topN);\n      });\n\n    this.enableLivePreviews([filterMissing, input, isRegex]);\n\n    if (!this.showLivePreviews()) {\n      return;\n    }\n    input.addEventListener(\n      'input',\n      debounce(() => this.submit(), 100),\n      {\n        passive: true,\n      }\n    );\n  }\n}\n","import { round } from '../../internal';\nimport type { StackColumn } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { forEach, colorOf } from './utils';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class WeightsEditDialog extends ADialog {\n  private readonly weights: number[];\n\n  constructor(private readonly column: StackColumn, dialog: IDialogContext) {\n    super(dialog);\n\n    this.weights = this.column.getWeights();\n  }\n\n  protected cancel() {\n    this.column.setWeights(this.weights.slice());\n  }\n\n  protected reset() {\n    const weight = 100 / this.weights.length;\n    forEach(this.node, 'input[type=number]', (n: HTMLInputElement) => {\n      const v = round(weight, 2);\n      n.value = String(v);\n      (n.nextElementSibling!.firstElementChild! as HTMLElement).style.width = `${v}%`;\n    });\n  }\n\n  protected build(node: HTMLElement) {\n    const children = this.column.children;\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<div class=\"${cssClass('dialog-table')}\">\n        ${this.weights\n          .map(\n            (weight, i) => `<div class=\"${cssClass('dialog-weights-table-entry')}\">\n          <input type=\"number\" value=\"${round(weight * 100, 2)}\" min=\"0\" max=\"100\" step=\"any\" required>\n          <span class=\"${cssClass('dialog-filter-color-bar')}\">\n            <span style=\"background-color: ${colorOf(children[i])}; width: ${round(weight * 100, 2)}%\"></span>\n          </span>\n          ${this.dialog.sanitize(children[i].label)}\n        </div>`\n          )\n          .join('')}\n    </div>`\n    );\n    const inputs = Array.from(this.node.querySelectorAll<HTMLInputElement>('input[type=number]'));\n    inputs.forEach((d, i) => {\n      d.oninput = () => {\n        const weight = d.valueAsNumber;\n        if (weight <= 0) {\n          d.setCustomValidity('weight cannot be zero');\n        } else {\n          d.setCustomValidity('');\n        }\n        this.updateBar(d);\n\n        if (inputs.length !== 2) {\n          return;\n        }\n\n        // corner case auto decrease the other\n        const rest = 100 - weight;\n\n        if (rest <= 0) {\n          d.setCustomValidity('weight cannot be 100 in case of two elements');\n        } else {\n          d.setCustomValidity('');\n        }\n\n        const other = inputs[1 - i]!;\n        other.value = round(rest, 2).toString();\n        this.updateBar(other);\n      };\n    });\n  }\n\n  private updateBar(input: HTMLInputElement) {\n    (input.nextElementSibling!.firstElementChild! as HTMLElement).style.width = `${input.value}%`;\n  }\n\n  private distributeWeights() {\n    const inputs = Array.from(this.node.querySelectorAll<HTMLInputElement>('input[type=number]')).map((d) => ({\n      input: d,\n      weight: d.value ? d.valueAsNumber : NaN,\n    }));\n    const hasMissing = inputs.some((d) => Number.isNaN(d.weight));\n    if (hasMissing) {\n      // compute missing ones\n      const missingIndices = inputs.filter((d) => Number.isNaN(d.weight));\n      const correct = inputs.filter((d) => !Number.isNaN(d.weight));\n      const sum = correct.reduce((a, b) => a + b.weight, 0);\n\n      if (sum < 100) {\n        // compute rest\n        const rest = (100 - sum) / missingIndices.length;\n        for (const input of missingIndices) {\n          input.input.value = round(rest, 2).toString();\n          this.updateBar(input.input);\n        }\n        return;\n      }\n      // already above 100, set missing to 0 and do a regular normalization (user has to deal with it)\n      for (const input of missingIndices) {\n        input.input.value = '0';\n        this.updateBar(input.input);\n      }\n    }\n\n    const weights = inputs.map((d) => d.weight);\n    if (validWeights(weights)) {\n      return; // nothing to do\n    }\n\n    // pure distribute the sum\n    const sum = weights.reduce((a, b) => a + b, 0);\n    for (const input of inputs) {\n      input.input.value = round((input.weight * 100) / sum, 2).toString();\n      this.updateBar(input.input);\n    }\n  }\n\n  protected appendDialogButtons() {\n    super.appendDialogButtons();\n    const buttons = this.node.querySelector<HTMLElement>(`.${cssClass('dialog-buttons')}`)!;\n    buttons.insertAdjacentHTML(\n      'beforeend',\n      `<button class=\"${cssClass('dialog-button')} ${cssClass(\n        'dialog-weights-distribute-button'\n      )}\" type=\"button\" title=\"distribute weights\"></button>`\n    );\n\n    const last = buttons.lastElementChild! as HTMLElement;\n    last.onclick = (evt) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n      this.distributeWeights();\n    };\n  }\n\n  submit() {\n    const inputs = Array.from(this.node.querySelectorAll<HTMLInputElement>('input[type=number]')).map((d) => ({\n      input: d,\n      weight: d.valueAsNumber,\n    }));\n    let invalid = false;\n    for (const input of inputs) {\n      if (input.weight <= 0) {\n        input.input.setCustomValidity('weight cannot be zero');\n        invalid = true;\n      } else {\n        input.input.setCustomValidity('');\n      }\n    }\n    const weights = inputs.map((d) => d.weight);\n    if (!invalid && !validWeights(weights)) {\n      inputs[inputs.length - 1].input.setCustomValidity(\n        'sum of weights has to be 100, change weights or use the redistribute button to fix'\n      );\n      invalid = true;\n    }\n    if (invalid) {\n      if (typeof this.node.reportValidity === 'function') {\n        this.node.reportValidity();\n      }\n      return false;\n    }\n\n    this.column.setWeights(weights.map((d) => d / 100));\n    return true;\n  }\n}\n\nfunction validWeights(weights: number[]) {\n  return Math.abs(weights.reduce((a, b) => a + b, 0) - 100) < 3;\n}\n","import type { SelectionColumn } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\nimport type { IRankingHeaderContext } from '../interfaces';\n\n/** @internal */\nexport default class SelectionFilterDialog extends ADialog {\n  private readonly before: number[] | null;\n\n  constructor(\n    private readonly column: SelectionColumn,\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog, {\n      livePreview: 'filter',\n    });\n\n    this.before = this.column.getFilter();\n  }\n\n  private updateFilter(filter: number[] | null) {\n    this.column.setFilter(filter);\n  }\n\n  protected reset() {\n    this.findInput('input[value=none]').checked = true;\n  }\n\n  protected cancel() {\n    if (this.before) {\n      this.updateFilter(this.before);\n    } else {\n      this.updateFilter(null);\n    }\n  }\n\n  protected submit() {\n    const chosen = (this.findInput('input[name=mode]:checked')?.value as 'none' | 'keep' | 'update') ?? 'keep';\n    if (chosen === 'none') {\n      this.updateFilter(null);\n    } else if (chosen === 'update') {\n      this.updateFilter(this.ctx.provider.getSelection());\n    }\n    return true;\n  }\n\n  private guessRemoveFilter() {\n    const total = this.ctx.provider.getTotalNumberOfRows();\n    const ranking = this.column.findMyRanker();\n    const hasOtherFilter = ranking.flatColumns.some((d) => d.isFiltered() && d !== this.column);\n    return hasOtherFilter ? '?' : total.toLocaleString();\n  }\n\n  protected build(node: HTMLElement) {\n    const filtered = this.column.getFilter() ?? [];\n    const selected = this.ctx.provider.getSelection().length;\n    const total = this.ctx.provider.getTotalNumberOfRows();\n    const visible = this.column.findMyRanker().getOrderLength();\n\n    if (selected === 0 && filtered.length === 0) {\n      // no rows selected and no filter set\n      node.insertAdjacentText('beforeend', 'Select rows to apply this filter');\n    } else if (selected > 0 && filtered.length === 0) {\n      // rows select but no filter yet\n      node.insertAdjacentHTML(\n        'beforeend',\n        `<div class=\"${cssClass('dialog-table')}\">\n        <label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')} ${cssClass(\n          'dialog-table-entry-wide'\n        )}\">\n          <input type=\"radio\" checked=\"checked\" name=\"mode\" value=\"none\">\n          <span>\n            <div class=\"${cssClass('dialog-filter-table-entry-label')}\">No filter</div>\n            <div class=\"${cssClass(\n              'dialog-filter-table-entry-stats'\n            )}\">${visible.toLocaleString()}/${total.toLocaleString()}</div>\n          </span>\n        </label>\n        <label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')} ${cssClass(\n          'dialog-table-entry-wide'\n        )}\">\n          <input type=\"radio\" name=\"mode\" value=\"update\">\n          <span>\n            <div class=\"${cssClass('dialog-filter-table-entry-label')}\">Set filter to current selection</div>\n            <div class=\"${cssClass(\n              'dialog-filter-table-entry-stats'\n            )}\">${selected.toLocaleString()}/${total.toLocaleString()}</div>\n          </span>\n        </label>\n      </div>`\n      );\n    } else {\n      const guessedRemoved = this.guessRemoveFilter();\n      node.insertAdjacentHTML(\n        'beforeend',\n        `<div class=\"${cssClass('dialog-table')}\" >\n        <label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')} ${cssClass(\n          'dialog-table-entry-wide'\n        )}\">\n          <input type=\"radio\" ${filtered.length === 0 ? 'checked=\"checked\"' : ''} name=\"mode\" value=\"none\">\n          <span>\n            <div class=\"${cssClass('dialog-filter-table-entry-label')}\">Remove filter</div>\n            <div class=\"${cssClass(\n              'dialog-filter-table-entry-stats'\n            )}\">${guessedRemoved}/${total.toLocaleString()}</div>\n          </span>\n        </label>\n        <label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')} ${cssClass(\n          'dialog-table-entry-wide'\n        )}\">\n          <input type=\"radio\" ${filtered.length > 0 ? 'checked=\"checked\"' : ''} name=\"mode\" value=\"keep\">\n          <span>\n            <div class=\"${cssClass('dialog-filter-table-entry-label')}\">Keep current filter</div>\n            <div class=\"${cssClass(\n              'dialog-filter-table-entry-stats'\n            )}\">${filtered.length.toLocaleString()}/${total.toLocaleString()}</div>\n          </span>\n        </label>\n        <label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')} ${cssClass(\n          'dialog-table-entry-wide'\n        )}\">\n          <input type=\"radio\" name=\"mode\" value=\"update\" ${selected === 0 ? 'disabled=\"disabled\"' : ''}>\n          <span>\n            <div class=\"${cssClass('dialog-filter-table-entry-label')}\">Set filter to current selection</div>\n            <div class=\"${cssClass(\n              'dialog-filter-table-entry-stats'\n            )}\">${selected.toLocaleString()}/${total.toLocaleString()}</div>\n          </span>\n        </label>\n      </div>`\n      );\n    }\n    const inputs = Array.from(node.querySelectorAll('input'));\n\n    this.enableLivePreviews(inputs);\n  }\n}\n","import {\n  Column,\n  CompositeColumn,\n  EAdvancedSortMethod,\n  EDateSort,\n  ESortMethod,\n  IMultiLevelColumn,\n  isSortingAscByDefault,\n  isSupportType,\n} from '../model';\nimport { cssClass } from '../styles';\nimport ADialog, { dialogContext, IDialogContext } from './dialogs/ADialog';\nimport CategoricalColorMappingDialog from './dialogs/CategoricalColorMappingDialog';\nimport CategoricalFilterDialog from './dialogs/CategoricalFilterDialog';\nimport CategoricalMappingFilterDialog from './dialogs/CategoricalMappingFilterDialog';\nimport ChangeRendererDialog from './dialogs/ChangeRendererDialog';\nimport ColorMappingDialog from './dialogs/ColorMappingDialog';\nimport CompositeChildrenDialog from './dialogs/CompositeChildrenDialog';\nimport CutOffHierarchyDialog from './dialogs/CutOffHierarchyDialog';\nimport DateFilterDialog from './dialogs/DateFilterDialog';\nimport EditPatternDialog from './dialogs/EditPatternDialog';\nimport GroupDialog from './dialogs/GroupDialog';\nimport MappingDialog from './dialogs/MappingDialog';\nimport NumberFilterDialog from './dialogs/NumberFilterDialog';\nimport ReduceDialog from './dialogs/ReduceDialog';\nimport RenameDialog from './dialogs/RenameDialog';\nimport ScriptEditDialog from './dialogs/ScriptEditDialog';\nimport SearchDialog from './dialogs/SearchDialog';\nimport ShowTopNDialog from './dialogs/ShowTopNDialog';\nimport SortDialog from './dialogs/SortDialog';\nimport StringFilterDialog from './dialogs/StringFilterDialog';\nimport WeightsEditDialog from './dialogs/WeightsEditDialog';\nimport SelectionFilterDialog from './dialogs/SelectionFilterDialog';\nimport type {\n  IRankingHeaderContext,\n  IOnClickHandler,\n  IUIOptions,\n  IToolbarAction,\n  IToolbarDialogAddon,\n} from './interfaces';\nimport appendDate from './dialogs/groupDate';\nimport appendNumber from './dialogs/groupNumber';\nimport appendString from './dialogs/groupString';\nimport { sortMethods } from './dialogs/utils';\n\ninterface IDialogClass {\n  new (col: any, dialog: IDialogContext, ...args: any[]): ADialog;\n}\n\nfunction ui(title: string, onClick: IOnClickHandler, options: Partial<IUIOptions> = {}): IToolbarAction {\n  return { title, onClick, options };\n}\n\nfunction uiDialog(\n  title: string,\n  dialogClass: IDialogClass,\n  extraArgs: (ctx: IRankingHeaderContext) => any[] = () => [],\n  options: Partial<IUIOptions> = {}\n): IToolbarAction {\n  return {\n    title,\n    onClick: (col, evt, ctx, level) => {\n      const dialog = new dialogClass(col, dialogContext(ctx, level, evt), ...extraArgs(ctx));\n      dialog.open();\n    },\n    options,\n  };\n}\n\nconst sort: IToolbarAction = {\n  title: 'Sort', // basic ranking\n  onClick: (col, evt, ctx, level) => {\n    ctx.dialogManager.removeAboveLevel(level);\n    if (!evt.ctrlKey) {\n      col.toggleMySorting();\n      return;\n    }\n    const ranking = col.findMyRanker()!;\n    const current = ranking.getSortCriteria();\n    const order = col.isSortedByMe();\n\n    const isAscByDefault = isSortingAscByDefault(col);\n\n    if (order.priority === undefined) {\n      ranking.sortBy(col, isAscByDefault, current.length);\n      return;\n    }\n    let next: string | undefined = undefined;\n    if (isAscByDefault) {\n      next = order.asc ? 'desc' : undefined;\n    } else {\n      next = !order.asc ? 'asc' : undefined;\n    }\n    ranking.sortBy(col, next === 'asc', next ? order.priority : -1);\n  },\n  options: {\n    mode: 'shortcut',\n    order: 1,\n    featureCategory: 'ranking',\n    featureLevel: 'basic',\n  },\n};\n\nconst sortBy: IToolbarAction = {\n  title: 'Sort By …', // advanced ranking\n  onClick: (col, evt, ctx, level) => {\n    const dialog = new SortDialog(col, false, dialogContext(ctx, level, evt), ctx);\n    dialog.open();\n  },\n  options: {\n    mode: 'menu',\n    order: 1,\n    featureCategory: 'ranking',\n    featureLevel: 'advanced',\n  },\n};\n\nconst sortGroupBy: IToolbarAction = {\n  title: 'Sort Groups By …', // advanced ranking\n  onClick: (col, evt, ctx, level) => {\n    const dialog = new SortDialog(col, true, dialogContext(ctx, level, evt), ctx);\n    dialog.open();\n  },\n  options: {\n    mode: 'menu',\n    order: 3,\n    featureCategory: 'ranking',\n    featureLevel: 'advanced',\n  },\n};\n\nconst rename: IToolbarAction = {\n  title: 'Rename …', // advanced\n  onClick: (col, evt, ctx, level) => {\n    const dialog = new RenameDialog(col, dialogContext(ctx, level, evt));\n    dialog.open();\n  },\n  options: {\n    order: 5,\n    featureCategory: 'ui',\n    featureLevel: 'advanced',\n  },\n};\n\nconst vis: IToolbarAction = {\n  title: 'Visualization …', // advanced view\n  onClick: (col, evt, ctx, level) => {\n    const dialog = new ChangeRendererDialog(col, dialogContext(ctx, level, evt), ctx);\n    dialog.open();\n  },\n  options: {\n    featureCategory: 'ui',\n    featureLevel: 'advanced',\n  },\n};\n\nconst clone: IToolbarAction = {\n  title: 'Clone', // advanced model\n  onClick: (col, _evt, ctx) => {\n    ctx.dialogManager.removeAll(); // since the column will be removed\n    ctx.provider.takeSnapshot(col);\n  },\n  options: {\n    order: 80,\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  },\n};\n\nconst remove: IToolbarAction = {\n  title: 'Remove', // advanced model\n  onClick: (col, _evt, ctx) => {\n    ctx.dialogManager.removeAll(); // since the column will be removed\n    const ranking = col.findMyRanker()!;\n    const last = ranking.children.every((d) => isSupportType(d) || d.fixed || d === col);\n    if (!last) {\n      col.removeMe();\n      return;\n    }\n    ctx.provider.removeRanking(ranking);\n    ctx.provider.ensureOneRanking();\n  },\n  options: {\n    order: 90,\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  },\n};\n\n// basic ranking\nconst group = ui(\n  'Group',\n  (col, evt, ctx, level) => {\n    ctx.dialogManager.removeAboveLevel(level);\n\n    if (!evt.ctrlKey) {\n      col.groupByMe();\n      return;\n    }\n    const ranking = col.findMyRanker()!;\n    const current = ranking.getGroupCriteria();\n    const order = current.indexOf(col);\n\n    ranking.groupBy(col, order >= 0 ? -1 : current.length);\n  },\n  { mode: 'shortcut', order: 2, featureCategory: 'ranking', featureLevel: 'basic' }\n);\n\n// advanced ranking\nconst groupBy = ui(\n  'Group By …',\n  (col, evt, ctx, level) => {\n    const dialog = new GroupDialog(col, dialogContext(ctx, level, evt), ctx);\n    dialog.open();\n  },\n  { mode: 'menu', order: 2, featureCategory: 'ranking', featureLevel: 'advanced' }\n);\n\nfunction toggleCompressExpand(col: Column, evt: MouseEvent, ctx: IRankingHeaderContext, level: number) {\n  ctx.dialogManager.removeAboveLevel(level);\n  const mcol = col as IMultiLevelColumn;\n  mcol.setCollapsed(!mcol.getCollapsed());\n\n  const collapsed = mcol.getCollapsed();\n  const i = evt.currentTarget as HTMLElement;\n  i.title = collapsed ? 'Expand' : 'Compress';\n  i.classList.toggle(cssClass('action-compress'), !collapsed);\n  i.classList.toggle(cssClass('action-expand'), collapsed);\n  const inner = i.getElementsByTagName('span')[0]!;\n  if (inner) {\n    inner.textContent = i.title;\n  }\n}\n\nconst compress: IToolbarAction = {\n  title: 'Compress',\n  enabled: (col: IMultiLevelColumn) => !col.getCollapsed(),\n  onClick: toggleCompressExpand,\n  options: { featureCategory: 'model', featureLevel: 'advanced' },\n};\n\nconst expand: IToolbarAction = {\n  title: 'Expand',\n  enabled: (col: IMultiLevelColumn) => col.getCollapsed(),\n  onClick: toggleCompressExpand,\n  options: { featureCategory: 'model', featureLevel: 'advanced' },\n};\n\nconst setShowTopN: IToolbarAction = {\n  title: 'Change Show Top N',\n  onClick: (_col, evt, ctx, level) => {\n    const dialog = new ShowTopNDialog(ctx.provider, dialogContext(ctx, level, evt));\n    dialog.open();\n  },\n  options: {\n    featureCategory: 'ui',\n    featureLevel: 'advanced',\n  },\n};\n\nexport const toolbarActions: { [key: string]: IToolbarAction } = {\n  vis,\n  group,\n  groupBy,\n  compress,\n  expand,\n  sort,\n  sortBy,\n  sortGroupBy,\n  clone,\n  remove,\n  rename,\n  setShowTopN,\n  search: uiDialog('Search …', SearchDialog, (ctx) => [ctx.provider], {\n    mode: 'menu+shortcut',\n    order: 4,\n    featureCategory: 'ranking',\n    featureLevel: 'basic',\n  }),\n  filterNumber: uiDialog('Filter …', NumberFilterDialog, (ctx) => [ctx], {\n    mode: 'menu+shortcut',\n    featureCategory: 'ranking',\n    featureLevel: 'basic',\n  }),\n  filterDate: uiDialog('Filter …', DateFilterDialog, (ctx) => [ctx], {\n    mode: 'menu+shortcut',\n    featureCategory: 'ranking',\n    featureLevel: 'basic',\n  }),\n  filterString: uiDialog('Filter …', StringFilterDialog, (ctx) => [ctx], {\n    mode: 'menu+shortcut',\n    featureCategory: 'ranking',\n    featureLevel: 'basic',\n  }),\n  filterSelection: uiDialog('Filter …', SelectionFilterDialog, (ctx) => [ctx], {\n    mode: 'menu+shortcut',\n    featureCategory: 'ranking',\n    featureLevel: 'basic',\n  }),\n  filterCategorical: uiDialog('Filter …', CategoricalFilterDialog, (ctx) => [ctx], {\n    mode: 'menu+shortcut',\n    featureCategory: 'ranking',\n    featureLevel: 'basic',\n  }),\n  filterOrdinal: uiDialog('Filter …', CategoricalMappingFilterDialog, () => [], {\n    mode: 'menu+shortcut',\n    featureCategory: 'ranking',\n    featureLevel: 'basic',\n  }),\n  colorMapped: uiDialog('Color Mapping …', ColorMappingDialog, (ctx) => [ctx], {\n    mode: 'menu',\n    featureCategory: 'ui',\n    featureLevel: 'advanced',\n  }),\n  colorMappedCategorical: uiDialog('Color Mapping …', CategoricalColorMappingDialog, () => [], {\n    mode: 'menu',\n    featureCategory: 'ui',\n    featureLevel: 'advanced',\n  }),\n  script: uiDialog('Edit Combine Script …', ScriptEditDialog, () => [], {\n    mode: 'menu+shortcut',\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  }),\n  reduce: uiDialog('Reduce by …', ReduceDialog, () => [], {\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  }),\n  cutoff: uiDialog('Set Cut Off …', CutOffHierarchyDialog, (ctx) => [ctx], {\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  }),\n  editMapping: uiDialog('Data Mapping …', MappingDialog, (ctx) => [ctx], {\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  }),\n  editPattern: uiDialog('Edit Pattern …', EditPatternDialog, (ctx) => [ctx], {\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  }),\n  editWeights: uiDialog('Edit Weights …', WeightsEditDialog, () => [], {\n    mode: 'menu+shortcut',\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  }),\n  compositeContained: uiDialog('Contained Columns …', CompositeChildrenDialog, (ctx) => [ctx], {\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  }),\n  splitCombined: ui(\n    'Split Combined Column',\n    (col, _evt, ctx, level) => {\n      ctx.dialogManager.removeAboveLevel(level - 1); // close itself\n      // split the combined column into its children\n      (col as CompositeColumn).children.reverse().forEach((c) => col.insertAfterMe(c));\n      col.removeMe();\n    },\n    { featureCategory: 'model', featureLevel: 'advanced' }\n  ),\n  invertSelection: ui(\n    'Invert Selection',\n    (col, _evt, ctx, level) => {\n      ctx.dialogManager.removeAboveLevel(level - 1); // close itself\n      const s = ctx.provider.getSelection();\n      const order = Array.from(col.findMyRanker()!.getOrder());\n      if (s.length === 0) {\n        ctx.provider.setSelection(order);\n        return;\n      }\n      const ss = new Set(s);\n      const others = order.filter((d) => !ss.has(d));\n      ctx.provider.setSelection(others);\n    },\n    { featureCategory: 'model', featureLevel: 'advanced' }\n  ),\n};\n\nfunction uiSortMethod(methods: string[]): IToolbarDialogAddon {\n  methods = methods.sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));\n  return {\n    title: 'Sort By',\n    order: 2,\n    append(col, node) {\n      return sortMethods(node, col as any, methods);\n    },\n  };\n}\n\nexport const toolbarDialogAddons: { [key: string]: IToolbarDialogAddon } = {\n  sortNumber: uiSortMethod(Object.keys(EAdvancedSortMethod)),\n  sortNumbers: uiSortMethod(Object.keys(EAdvancedSortMethod)),\n  sortBoxPlot: uiSortMethod(Object.keys(ESortMethod)),\n  sortDates: uiSortMethod(Object.keys(EDateSort)),\n  sortGroups: uiSortMethod(['count', 'name']),\n  groupNumber: {\n    title: 'Split',\n    order: 2,\n    append: appendNumber,\n  } as IToolbarDialogAddon,\n  groupString: {\n    title: 'Groups',\n    order: 2,\n    append: appendString,\n  } as IToolbarDialogAddon,\n  groupDate: {\n    title: 'Granularity',\n    order: 2,\n    append: appendDate,\n  } as IToolbarDialogAddon,\n};\n","import type { NumberColumn } from '../../model';\nimport type { IDialogContext } from './ADialog';\nimport { round, getNumberOfBins } from '../../internal';\nimport { forEach } from '../../renderer/utils';\nimport { cssClass } from '../../styles';\nimport type { IToolbarDialogAddonHandler } from '../interfaces';\n\n/** @internal */\nexport default function groupNumber(\n  col: NumberColumn,\n  node: HTMLElement,\n  dialog: IDialogContext\n): IToolbarDialogAddonHandler {\n  const domain = col.getMapping().domain;\n  const before = col.getGroupThresholds();\n  const isThreshold = before.length <= 1;\n  const ranking = col.findMyRanker()!;\n  node.insertAdjacentHTML(\n    'beforeend',\n    `\n    <label class=\"${cssClass('checkbox')}\">\n      <input type=\"radio\" name=\"threshold\" value=\"threshold\" ${isThreshold ? 'checked' : ''}>\n      <span>at&nbsp;<input type=\"number\" size=\"10\" id=\"${dialog.idPrefix}N1\" value=\"${\n      before.length > 0 ? before[0] : round((domain[1] - domain[0]) / 2, 2)\n    }\"\n          required min=\"${domain[0]}\" max=\"${domain[1]}\" step=\"any\" ${!isThreshold ? 'disabled' : ''}>\n      </span>\n    </label>\n    <label class=\"${cssClass('checkbox')}\">\n      <input type=\"radio\" name=\"threshold\" value=\"bins\" ${!isThreshold ? 'checked' : ''}>\n      <span> in&nbsp;<input type=\"number\" size=\"5\" id=\"${dialog.idPrefix}N2\" value=\"${\n      before.length > 1 ? before.length : getNumberOfBins(ranking.getOrderLength())\n    }\"\n          required min=\"2\" step=\"1\" ${isThreshold ? 'disabled' : ''}>&nbsp;bins\n      </span>\n    </label>\n  `\n  );\n\n  const threshold = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}N1`);\n  const bins = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}N2`);\n\n  forEach(node, 'input[name=threshold]', (d: HTMLInputElement) => {\n    d.addEventListener(\n      'change',\n      () => {\n        const isThreshold = d.value === 'threshold';\n        threshold.disabled = !isThreshold;\n        bins.disabled = isThreshold;\n      },\n      { passive: true }\n    );\n  });\n\n  return {\n    elems: `input[name=threshold], #${dialog.idPrefix}N1, #${dialog.idPrefix}N2`,\n    submit() {\n      const isThreshold = node.querySelector<HTMLInputElement>('input[name=threshold]:checked')!.value === 'threshold';\n      if (isThreshold) {\n        col.setGroupThresholds([threshold.valueAsNumber]);\n        return true;\n      }\n      const count = Number.parseInt(bins.value, 10);\n      const delta = (domain[1] - domain[0]) / count;\n      let act = domain[0] + delta;\n      const thresholds = [act];\n      for (let i = 1; i < count - 1; ++i) {\n        act += delta;\n        thresholds.push(act);\n      }\n      col.setGroupThresholds(thresholds);\n      return true;\n    },\n    cancel() {\n      col.setGroupThresholds(before);\n    },\n    reset() {\n      const value = round((domain[1] - domain[0]) / 2, 2);\n      threshold.value = value.toString();\n      threshold.disabled = false;\n      bins.value = getNumberOfBins(ranking.getOrderLength()).toString();\n      bins.disabled = true;\n      node.querySelector<HTMLInputElement>('input[name=threshold][value=threshold]')!.checked = true;\n    },\n  };\n}\n","import type { IDialogContext } from './ADialog';\nimport { StringColumn, EStringGroupCriteriaType } from '../../model';\nimport { cssClass } from '../../styles';\nimport type { IToolbarDialogAddonHandler } from '../interfaces';\n\n/** @internal */\nexport default function groupString(\n  col: StringColumn,\n  node: HTMLElement,\n  dialog: IDialogContext\n): IToolbarDialogAddonHandler {\n  const current = col.getGroupCriteria();\n  const { type, values } = current;\n\n  node.insertAdjacentHTML(\n    'beforeend',\n    `\n    <label class=\"${cssClass('checkbox')}\">\n      <input type=\"radio\" name=\"${dialog.idPrefix}groupString\" value=\"${EStringGroupCriteriaType.value}\" id=\"${\n      dialog.idPrefix\n    }VAL\" ${type === EStringGroupCriteriaType.value ? 'checked' : ''}>\n      <span>Use text value</span>\n    </label>\n    <label class=\"${cssClass('checkbox')}\">\n      <input type=\"radio\" name=\"${dialog.idPrefix}groupString\" value=\"${EStringGroupCriteriaType.startsWith}\" id=\"${\n      dialog.idPrefix\n    }RW\" ${type === EStringGroupCriteriaType.startsWith ? 'checked' : ''}>\n      <span>Text starts with …</span>\n    </label>\n    <label class=\"${cssClass('checkbox')}\">\n      <input type=\"radio\" name=\"${dialog.idPrefix}groupString\" value=\"${EStringGroupCriteriaType.regex}\" id=\"${\n      dialog.idPrefix\n    }RE\" ${type === EStringGroupCriteriaType.regex ? 'checked' : ''}>\n      <span>Use regular expressions</span>\n    </label>\n    <textarea rows=\"5\" placeholder=\"one value per row, e.g., \\nA\\nB\" id=\"${dialog.idPrefix}T\">${values\n      .map((value) => (value instanceof RegExp ? value.source : value))\n      .join('\\n')}</textarea>\n  `\n  );\n\n  const valueRadioButton = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}VAL`)!;\n  const startsWithRadioButton = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}RW`)!;\n  const regexRadioButton = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}RE`)!;\n  const text = node.querySelector<HTMLTextAreaElement>(`#${dialog.idPrefix}T`)!;\n\n  const showOrHideTextarea = (show: boolean) => {\n    text.style.display = show ? null : 'none';\n  };\n\n  showOrHideTextarea(type !== EStringGroupCriteriaType.value);\n  valueRadioButton.onchange = () => showOrHideTextarea(!valueRadioButton.checked);\n  startsWithRadioButton.onchange = () => showOrHideTextarea(startsWithRadioButton.checked);\n  regexRadioButton.onchange = () => showOrHideTextarea(regexRadioButton.checked);\n\n  return {\n    elems: [text, valueRadioButton, startsWithRadioButton, regexRadioButton],\n    submit() {\n      const checkedNode = node.querySelector<HTMLInputElement>(`input[name=\"${dialog.idPrefix}groupString\"]:checked`)!;\n      const newType = checkedNode.value as EStringGroupCriteriaType;\n      let items: (string | RegExp)[] = text.value\n        .trim()\n        .split('\\n')\n        .map((d) => d.trim())\n        .filter((d) => d.length > 0);\n\n      if (newType === EStringGroupCriteriaType.regex) {\n        items = items.map((d) => new RegExp(d.toString(), 'm'));\n      }\n      col.setGroupCriteria({\n        type: newType,\n        values: items,\n      });\n      return true;\n    },\n    cancel() {\n      col.setGroupCriteria(current);\n    },\n    reset() {\n      text.value = '';\n      startsWithRadioButton.checked = true;\n    },\n  };\n}\n","import type { DateColumn, IDateGranularity } from '../../model';\nimport { cssClass } from '../../styles';\nimport type { IToolbarDialogAddonHandler } from '../interfaces';\nimport { defaultDateGrouper } from '../../model/internalDate';\n\n/** @internal */\nexport default function appendDate(col: DateColumn, node: HTMLElement): IToolbarDialogAddonHandler {\n  const before = col.getDateGrouper();\n\n  let html = '';\n  for (const g of [\n    'century',\n    'decade',\n    'year',\n    'month',\n    'week',\n    'day_of_week',\n    'day_of_month',\n    'day_of_year',\n    'hour',\n    'minute',\n    'second',\n  ]) {\n    html += `<label class=\"${cssClass('checkbox')}\">\n    <input type=\"radio\" name=\"granularity\" value=\"${g}\" ${before.granularity === g ? 'checked' : ''}>\n    <span> by ${g} </span>\n  </label>`;\n  }\n  html += `<label class=\"${cssClass('checkbox')}\">\n    <input type=\"checkbox\" name=\"circular\" ${before.circular ? 'checked' : ''}>\n    <span> Circular </span>\n  </label>`;\n\n  node.insertAdjacentHTML('beforeend', html);\n  const circular = node.querySelector<HTMLInputElement>('input[name=circular]')!;\n\n  return {\n    elems: 'input[name=granularity],input[name=circular]',\n    submit() {\n      const granularity = node.querySelector<HTMLInputElement>('input[name=granularity]:checked')!\n        .value as IDateGranularity;\n      col.setDateGrouper({\n        granularity,\n        circular: circular.checked,\n      });\n      return true;\n    },\n    cancel() {\n      col.setDateGrouper(before);\n    },\n    reset() {\n      const r = defaultDateGrouper();\n      circular.checked = r.circular;\n      const g = node.querySelector<HTMLInputElement>(`input[name=granularity][value=\"${r.granularity}\"]`)!;\n      g.checked = true;\n    },\n  };\n}\n","import { renderers } from './renderer/renderers';\nimport { toolbarDialogAddons, toolbarActions } from './ui/toolbar';\nimport type { Column, Ranking, IGroupData, IGroupItem } from './model';\nimport type { IDataProvider } from './provider';\nimport type { ICellRendererFactory, ERenderMode } from './renderer';\nimport type { IToolbarAction, IToolbarDialogAddon } from './ui';\n\n/**\n * custom height implementation logic\n */\nexport interface IDynamicHeight {\n  /**\n   * default height for a row for optimized styling\n   */\n  defaultHeight: number;\n\n  /**\n   * returns the height in pixel for the given row\n   * @param {IGroupItem | IGroupData} item the item to show\n   * @returns {number} its height in pixel\n   */\n  height(item: IGroupItem | IGroupData): number;\n\n  /**\n   * returns the padding in pixel after the given row\n   * @param {IGroupItem | IGroupData | null} item item to show\n   * @returns {number} its padding in pixel\n   */\n  padding(item: IGroupItem | IGroupData | null): number;\n}\n\nexport interface ILineUpFlags {\n  /**\n   * optimization flag to disable frozen columns for optimizing rendering performance\n   * @default true\n   */\n  disableFrozenColumns: boolean;\n  /**\n   * flag whether advanced ranking features are enabled\n   * @default true\n   */\n  advancedRankingFeatures: boolean;\n  /**\n   * flag whether advanced model features are enabled\n   * @default true\n   */\n  advancedModelFeatures: boolean;\n  /**\n   * flag whether advanced UI features are enabled\n   * @default true\n   */\n  advancedUIFeatures: boolean;\n}\n\nexport interface IToolbarLookup<T> {\n  [key: string]: T;\n}\n\nexport interface ILivePreviewOptions {\n  search: boolean;\n  filter: boolean;\n  vis: boolean;\n  sort: boolean;\n  group: boolean;\n  groupSort: boolean;\n  colorMapping: boolean;\n  dataMapping: boolean;\n  reduce: boolean;\n  rename: boolean;\n  cutOff: boolean;\n}\n\nexport interface ILineUpOptions {\n  /**\n   * option to enable/disable showing a summary (histogram, ...) in the header\n   * @default true\n   */\n  summaryHeader: boolean;\n  /**\n   * option to enable/disable animated transitions\n   * @default true\n   */\n  animated: boolean;\n  /**\n   * option to enforce that the whole row is shown upon hover without overflow hidden\n   * @default false\n   */\n  expandLineOnHover: boolean;\n  /**\n   * option to enable/disable the panel\n   * @default true\n   */\n  sidePanel: boolean;\n  /**\n   * option to specify whether the panel should be collapsed by default\n   * @default false\n   */\n  sidePanelCollapsed: boolean;\n  /**\n   * show the sorting and grouping hierarchy indicators in the side panel\n   * @default true\n   */\n  hierarchyIndicator: boolean;\n\n  /**\n   * flag whether dialogs should confirm or cancel on clicking the background\n   * @default cancel\n   */\n  onDialogBackgroundClick: 'cancel' | 'confirm';\n\n  /**\n   * flag whether to shows filter previews as soon as the user changes the filter in the dialog\n   * @default {search: true,filter: true, vis: true,sort: true, group: true, groupSort: true, colorMapping: true}\n   */\n  livePreviews: Partial<ILivePreviewOptions>;\n\n  /**\n   * option to specify the default slope graph mode\n   * @default 'item'\n   */\n  defaultSlopeGraphMode: 'item' | 'band';\n\n  /**\n   * how many degrees should a label be rotated in case of narrow columns\n   * @default 0 no rotation\n   */\n  labelRotation: number;\n\n  /**\n   * height of a row\n   * @default 18\n   */\n  rowHeight: number;\n  /**\n   * padding between two rows\n   * @default 2\n   */\n  rowPadding: number;\n  /**\n   * height of an aggregated group in pixel\n   * @default 40\n   */\n  groupHeight: number;\n  /**\n   * padding between two groups in pixel\n   * @default 5\n   */\n  groupPadding: number;\n\n  /**\n   * custom function to compute the level of detail for a row\n   * @param {number} rowIndex the current row index to be rendered\n   * @returns {\"high\" | \"low\"}\n   */\n  levelOfDetail: (rowIndex: number) => 'high' | 'low';\n  /**\n   * custom function to compute the height of a row (group or item)\n   * @param {(IGroupItem | IGroupData)[]} data the data to render\n   * @param {Ranking} ranking the ranking of the data\n   * @returns {IDynamicHeight | null} the height compute function or null to use the default\n   */\n  dynamicHeight: (data: (IGroupItem | IGroupData)[], ranking: Ranking) => IDynamicHeight | null;\n  /**\n   * custom function to be called when updating a HTML row\n   * @param {HTMLElement} row node element to be updated\n   * @param {number} rowIndex row index to be rendered in the row\n   */\n  customRowUpdate: (row: HTMLElement, rowIndex: number) => void;\n\n  /**\n   * register custom toolbar actions and dialog addons\n   */\n  toolbarActions: IToolbarLookup<IToolbarAction>;\n  toolbarDialogAddons: IToolbarLookup<IToolbarDialogAddon>;\n\n  /**\n   * hook for postprocess the toolbar actions for a column\n   */\n  resolveToolbarActions: (col: Column, keys: string[], lookup: IToolbarLookup<IToolbarAction>) => IToolbarAction[];\n  /**\n   * hook for postprocess the toolbar dialog addons for a column\n   */\n  resolveToolbarDialogAddons: (\n    col: Column,\n    keys: string[],\n    lookup: IToolbarLookup<IToolbarDialogAddon>\n  ) => IToolbarDialogAddon[];\n\n  /**\n   * register custom renderer factories\n   */\n  renderers: { [type: string]: ICellRendererFactory };\n\n  /**\n   * custom check whether a given renderer can render the given column in the given mode\n   */\n  canRender: (type: string, renderer: ICellRendererFactory, col: Column, mode: ERenderMode) => boolean;\n\n  /**\n   * custom flags for optimization\n   */\n  flags: Partial<ILineUpFlags>;\n\n  /**\n   * ignore incompatible browser and always show (on own risk)\n   * @default false\n   */\n  ignoreUnsupportedBrowser: boolean;\n\n  /**\n   * option to enable to copy selected rows using ctrl-c\n   * @default false\n   */\n  copyableRows: boolean;\n\n  /**\n   * identifier for this LineUp instance. by default a random id is generated.\n   * @default random string\n   */\n  instanceId: string;\n}\n\nexport interface ITaggleOptions extends ILineUpOptions {\n  /**\n   * whether the overview mode is enabled by default\n   * @default false\n   */\n  overviewMode: boolean;\n}\n\nexport interface ILineUpLike {\n  readonly node: HTMLElement;\n  readonly data: IDataProvider;\n\n  dump(): any;\n\n  destroy(): void;\n}\n\nfunction resolveToolbarActions(col: Column, keys: string[], lookup: IToolbarLookup<IToolbarAction>) {\n  const actions: IToolbarAction[] = [];\n\n  keys.forEach((key) => {\n    if (lookup.hasOwnProperty(key)) {\n      actions.push(lookup[key]);\n    } else {\n      console.warn(`cannot find toolbar action of type: \"${col.desc.type}\" with key \"${key}\"`);\n    }\n  });\n  return actions;\n}\n\nfunction resolveToolbarDialogAddons(col: Column, keys: string[], lookup: IToolbarLookup<IToolbarDialogAddon>) {\n  const actions: IToolbarDialogAddon[] = [];\n\n  keys.forEach((key) => {\n    if (lookup.hasOwnProperty(key)) {\n      actions.push(lookup[key]);\n    } else {\n      console.warn(`cannot find toolbar dialog addon of type: \"${col.desc.type}\" with key \"${key}\"`);\n    }\n  });\n  return actions;\n}\n\nexport function defaultOptions(): ITaggleOptions {\n  return {\n    toolbarActions,\n    toolbarDialogAddons,\n    resolveToolbarActions,\n    resolveToolbarDialogAddons,\n    renderers: Object.assign({}, renderers),\n    canRender: () => true,\n\n    labelRotation: 0,\n    summaryHeader: true,\n    animated: true,\n    expandLineOnHover: false,\n    sidePanel: true,\n    sidePanelCollapsed: false,\n    hierarchyIndicator: true,\n    defaultSlopeGraphMode: 'item',\n    overviewMode: false,\n\n    livePreviews: {\n      search: true,\n      filter: true,\n      vis: true,\n      sort: true,\n      group: true,\n      groupSort: true,\n      colorMapping: true,\n    },\n    onDialogBackgroundClick: 'confirm',\n\n    rowHeight: 18,\n    groupHeight: 40,\n    groupPadding: 5,\n    rowPadding: 2,\n\n    levelOfDetail: () => 'high',\n    customRowUpdate: () => undefined,\n    dynamicHeight: () => null,\n\n    flags: {\n      disableFrozenColumns: true, //disable by default for speed navigator.userAgent.includes('Firefox/52') // disable by default in Firefox ESR 52\n      advancedRankingFeatures: true,\n      advancedModelFeatures: true,\n      advancedUIFeatures: true,\n    },\n\n    ignoreUnsupportedBrowser: false,\n    copyableRows: true,\n\n    instanceId: Math.random().toString(36).slice(-8).substring(0, 3), // generate a random string with length 3\n  };\n}\n","const TYPE_OBJECT = '[object Object]';\n\n/**\n * deep merge the source object into the target object and return the target object.\n * will concatenate arrays instead of replacing them.\n * @internal\n */\nexport default function merge<T1, T2>(target: T1, source: T2): T1 | T2 {\n  const result: any = target;\n\n  if (!source) {\n    return result;\n  }\n\n  const bKeys = Object.keys(source) as (keyof T2)[];\n  if (bKeys.length === 0) {\n    return result;\n  }\n\n  for (const key of bKeys) {\n    const value = source[key];\n\n    //merge just POJOs\n    if (Object.prototype.toString.call(value) === TYPE_OBJECT && Object.getPrototypeOf(value) === Object.prototype) {\n      //pojo\n      if (result[key] == null) {\n        result[key] = {};\n      }\n      result[key] = merge(result[key], value);\n    } else if (Array.isArray(value)) {\n      if (result[key] == null) {\n        result[key] = [];\n      }\n      result[key] = result[key].concat(value);\n    } else {\n      result[key] = value;\n    }\n  }\n  return result;\n}\n","var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar BrowserInfo = /** @class */ (function () {\n    function BrowserInfo(name, version, os) {\n        this.name = name;\n        this.version = version;\n        this.os = os;\n        this.type = 'browser';\n    }\n    return BrowserInfo;\n}());\nexport { BrowserInfo };\nvar NodeInfo = /** @class */ (function () {\n    function NodeInfo(version) {\n        this.version = version;\n        this.type = 'node';\n        this.name = 'node';\n        this.os = process.platform;\n    }\n    return NodeInfo;\n}());\nexport { NodeInfo };\nvar SearchBotDeviceInfo = /** @class */ (function () {\n    function SearchBotDeviceInfo(name, version, os, bot) {\n        this.name = name;\n        this.version = version;\n        this.os = os;\n        this.bot = bot;\n        this.type = 'bot-device';\n    }\n    return SearchBotDeviceInfo;\n}());\nexport { SearchBotDeviceInfo };\nvar BotInfo = /** @class */ (function () {\n    function BotInfo() {\n        this.type = 'bot';\n        this.bot = true; // NOTE: deprecated test name instead\n        this.name = 'bot';\n        this.version = null;\n        this.os = null;\n    }\n    return BotInfo;\n}());\nexport { BotInfo };\nvar ReactNativeInfo = /** @class */ (function () {\n    function ReactNativeInfo() {\n        this.type = 'react-native';\n        this.name = 'react-native';\n        this.version = null;\n        this.os = null;\n    }\n    return ReactNativeInfo;\n}());\nexport { ReactNativeInfo };\n// tslint:disable-next-line:max-line-length\nvar SEARCHBOX_UA_REGEX = /alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/;\nvar SEARCHBOT_OS_REGEX = /(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\\ Jeeves\\/Teoma|ia_archiver)/;\nvar REQUIRED_VERSION_PARTS = 3;\nvar userAgentRules = [\n    ['aol', /AOLShield\\/([0-9\\._]+)/],\n    ['edge', /Edge\\/([0-9\\._]+)/],\n    ['edge-ios', /EdgiOS\\/([0-9\\._]+)/],\n    ['yandexbrowser', /YaBrowser\\/([0-9\\._]+)/],\n    ['kakaotalk', /KAKAOTALK\\s([0-9\\.]+)/],\n    ['samsung', /SamsungBrowser\\/([0-9\\.]+)/],\n    ['silk', /\\bSilk\\/([0-9._-]+)\\b/],\n    ['miui', /MiuiBrowser\\/([0-9\\.]+)$/],\n    ['beaker', /BeakerBrowser\\/([0-9\\.]+)/],\n    ['edge-chromium', /EdgA?\\/([0-9\\.]+)/],\n    [\n        'chromium-webview',\n        /(?!Chrom.*OPR)wv\\).*Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/,\n    ],\n    ['chrome', /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/],\n    ['phantomjs', /PhantomJS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['crios', /CriOS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['firefox', /Firefox\\/([0-9\\.]+)(?:\\s|$)/],\n    ['fxios', /FxiOS\\/([0-9\\.]+)/],\n    ['opera-mini', /Opera Mini.*Version\\/([0-9\\.]+)/],\n    ['opera', /Opera\\/([0-9\\.]+)(?:\\s|$)/],\n    ['opera', /OPR\\/([0-9\\.]+)(:?\\s|$)/],\n    ['pie', /^Microsoft Pocket Internet Explorer\\/(\\d+\\.\\d+)$/],\n    ['pie', /^Mozilla\\/\\d\\.\\d+\\s\\(compatible;\\s(?:MSP?IE|MSInternet Explorer) (\\d+\\.\\d+);.*Windows CE.*\\)$/],\n    ['netfront', /^Mozilla\\/\\d\\.\\d+.*NetFront\\/(\\d.\\d)/],\n    ['ie', /Trident\\/7\\.0.*rv\\:([0-9\\.]+).*\\).*Gecko$/],\n    ['ie', /MSIE\\s([0-9\\.]+);.*Trident\\/[4-7].0/],\n    ['ie', /MSIE\\s(7\\.0)/],\n    ['bb10', /BB10;\\sTouch.*Version\\/([0-9\\.]+)/],\n    ['android', /Android\\s([0-9\\.]+)/],\n    ['ios', /Version\\/([0-9\\._]+).*Mobile.*Safari.*/],\n    ['safari', /Version\\/([0-9\\._]+).*Safari/],\n    ['facebook', /FB[AS]V\\/([0-9\\.]+)/],\n    ['instagram', /Instagram\\s([0-9\\.]+)/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Mobile/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Gecko\\)$/],\n    ['curl', /^curl\\/([0-9\\.]+)$/],\n    ['searchbot', SEARCHBOX_UA_REGEX],\n];\nvar operatingSystemRules = [\n    ['iOS', /iP(hone|od|ad)/],\n    ['Android OS', /Android/],\n    ['BlackBerry OS', /BlackBerry|BB10/],\n    ['Windows Mobile', /IEMobile/],\n    ['Amazon OS', /Kindle/],\n    ['Windows 3.11', /Win16/],\n    ['Windows 95', /(Windows 95)|(Win95)|(Windows_95)/],\n    ['Windows 98', /(Windows 98)|(Win98)/],\n    ['Windows 2000', /(Windows NT 5.0)|(Windows 2000)/],\n    ['Windows XP', /(Windows NT 5.1)|(Windows XP)/],\n    ['Windows Server 2003', /(Windows NT 5.2)/],\n    ['Windows Vista', /(Windows NT 6.0)/],\n    ['Windows 7', /(Windows NT 6.1)/],\n    ['Windows 8', /(Windows NT 6.2)/],\n    ['Windows 8.1', /(Windows NT 6.3)/],\n    ['Windows 10', /(Windows NT 10.0)/],\n    ['Windows ME', /Windows ME/],\n    ['Windows CE', /Windows CE|WinCE|Microsoft Pocket Internet Explorer/],\n    ['Open BSD', /OpenBSD/],\n    ['Sun OS', /SunOS/],\n    ['Chrome OS', /CrOS/],\n    ['Linux', /(Linux)|(X11)/],\n    ['Mac OS', /(Mac_PowerPC)|(Macintosh)/],\n    ['QNX', /QNX/],\n    ['BeOS', /BeOS/],\n    ['OS/2', /OS\\/2/],\n];\nexport function detect(userAgent) {\n    if (!!userAgent) {\n        return parseUserAgent(userAgent);\n    }\n    if (typeof document === 'undefined' &&\n        typeof navigator !== 'undefined' &&\n        navigator.product === 'ReactNative') {\n        return new ReactNativeInfo();\n    }\n    if (typeof navigator !== 'undefined') {\n        return parseUserAgent(navigator.userAgent);\n    }\n    return getNodeVersion();\n}\nfunction matchUserAgent(ua) {\n    // opted for using reduce here rather than Array#first with a regex.test call\n    // this is primarily because using the reduce we only perform the regex\n    // execution once rather than once for the test and for the exec again below\n    // probably something that needs to be benchmarked though\n    return (ua !== '' &&\n        userAgentRules.reduce(function (matched, _a) {\n            var browser = _a[0], regex = _a[1];\n            if (matched) {\n                return matched;\n            }\n            var uaMatch = regex.exec(ua);\n            return !!uaMatch && [browser, uaMatch];\n        }, false));\n}\nexport function browserName(ua) {\n    var data = matchUserAgent(ua);\n    return data ? data[0] : null;\n}\nexport function parseUserAgent(ua) {\n    var matchedRule = matchUserAgent(ua);\n    if (!matchedRule) {\n        return null;\n    }\n    var name = matchedRule[0], match = matchedRule[1];\n    if (name === 'searchbot') {\n        return new BotInfo();\n    }\n    // Do not use RegExp for split operation as some browser do not support it (See: http://blog.stevenlevithan.com/archives/cross-browser-split)\n    var versionParts = match[1] && match[1].split('.').join('_').split('_').slice(0, 3);\n    if (versionParts) {\n        if (versionParts.length < REQUIRED_VERSION_PARTS) {\n            versionParts = __spreadArray(__spreadArray([], versionParts, true), createVersionParts(REQUIRED_VERSION_PARTS - versionParts.length), true);\n        }\n    }\n    else {\n        versionParts = [];\n    }\n    var version = versionParts.join('.');\n    var os = detectOS(ua);\n    var searchBotMatch = SEARCHBOT_OS_REGEX.exec(ua);\n    if (searchBotMatch && searchBotMatch[1]) {\n        return new SearchBotDeviceInfo(name, version, os, searchBotMatch[1]);\n    }\n    return new BrowserInfo(name, version, os);\n}\nexport function detectOS(ua) {\n    for (var ii = 0, count = operatingSystemRules.length; ii < count; ii++) {\n        var _a = operatingSystemRules[ii], os = _a[0], regex = _a[1];\n        var match = regex.exec(ua);\n        if (match) {\n            return os;\n        }\n    }\n    return null;\n}\nexport function getNodeVersion() {\n    var isNode = typeof process !== 'undefined' && process.version;\n    return isNode ? new NodeInfo(process.version.slice(1)) : null;\n}\nfunction createVersionParts(count) {\n    var output = [];\n    for (var ii = 0; ii < count; ii++) {\n        output.push('0');\n    }\n    return output;\n}\n","import { detect } from 'detect-browser';\n\nexport const SUPPORTED_FIREFOX_VERSION = 57;\nexport const SUPPORTED_CHROME_VERSION = 64;\nexport const SUPPORTED_EDGE_VERSION = 16;\n\n/**\n * @internal\n */\nexport function getUnsupportedBrowserError() {\n  const info = detect();\n  if (!info || !info.version) {\n    return 'browser cannot be detected';\n  }\n  const prefix = `unsupported browser detected:`;\n  switch (info.name) {\n    case 'firefox':\n      const fVersion = Number.parseInt(info.version.slice(0, info.version.indexOf('.')), 10);\n      if (fVersion <= SUPPORTED_FIREFOX_VERSION && fVersion !== 52) {\n        // ESR\n        return `${prefix} Firefox ${info.version} (&lt; ${SUPPORTED_FIREFOX_VERSION})`;\n      }\n      return null;\n    case 'edge':\n      const eVersion = Number.parseInt(info.version.slice(0, info.version.indexOf('.')), 10);\n      if (eVersion <= SUPPORTED_EDGE_VERSION) {\n        return `${prefix} Edge ${info.version} (&lt; ${SUPPORTED_EDGE_VERSION})`;\n      }\n      return null;\n    case 'chrome':\n      const cVersion = Number.parseInt(info.version.slice(0, info.version.indexOf('.')), 10);\n      if (cVersion <= SUPPORTED_CHROME_VERSION) {\n        return `${prefix} Chrome ${info.version} (&lt; ${SUPPORTED_CHROME_VERSION})`;\n      }\n      return null;\n    case 'ie':\n      return `${prefix} Internet Explorer`;\n  }\n  console.warn('unknown browser detected', info, 'assuming fine...');\n  return null;\n}\n/**\n * checks whether the current browser is compatible with lineupjs\n * @return boolean\n */\nexport function isBrowserSupported() {\n  return getUnsupportedBrowserError() == null;\n}\n","import type ADialog from './ADialog';\nimport type Column from '../../model';\nimport { cssClass } from '../../styles';\nimport type { ILivePreviewOptions } from '../../config';\nimport { AEventDispatcher, IEventListener } from '../../internal';\n\n/**\n * emitted a dialog is opened\n * @asMemberOf DialogManager\n * @param dialog the opened dialog\n * @event\n */\nexport declare function dialogOpened(dialog: ADialog): void;\n\n/**\n * emitted a dialog is closed\n * @asMemberOf DialogManager\n * @param dialog the closed dialog\n * @param action the action how the dialog was closed\n * @event\n */\nexport declare function dialogClosed(dialog: ADialog, action: 'cancel' | 'confirm'): void;\n\nexport default class DialogManager extends AEventDispatcher {\n  static readonly EVENT_DIALOG_OPENED = 'dialogOpened';\n  static readonly EVENT_DIALOG_CLOSED = 'dialogClosed';\n\n  private readonly escKeyListener = (evt: KeyboardEvent) => {\n    if (evt.which === 27) {\n      this.removeLast();\n    }\n  };\n\n  private readonly openDialogs: ADialog[] = [];\n  readonly node: HTMLElement;\n  readonly livePreviews: Partial<ILivePreviewOptions>;\n  readonly onDialogBackgroundClick: 'cancel' | 'confirm';\n\n  constructor(options: {\n    doc: Document;\n    livePreviews: Partial<ILivePreviewOptions>;\n    onDialogBackgroundClick: 'cancel' | 'confirm';\n  }) {\n    super();\n    const doc = options.doc;\n    this.livePreviews = options.livePreviews;\n    this.onDialogBackgroundClick = options.onDialogBackgroundClick;\n    this.node = doc.createElement('div');\n    this.node.classList.add(cssClass('backdrop'));\n    const backdrop = doc.createElement('div');\n    backdrop.classList.add(cssClass('backdrop-bg'));\n    this.node.appendChild(backdrop);\n    this.node.onclick = () => {\n      this.removeAll();\n    };\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([DialogManager.EVENT_DIALOG_CLOSED, DialogManager.EVENT_DIALOG_OPENED]);\n  }\n\n  on(type: typeof DialogManager.EVENT_DIALOG_OPENED, listener: typeof dialogOpened | null): this;\n  on(type: typeof DialogManager.EVENT_DIALOG_CLOSED, listener: typeof dialogClosed | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  get maxLevel() {\n    return this.openDialogs.reduce((acc, a) => Math.max(acc, a.level), 0);\n  }\n\n  setHighlight(mask: { left: number; top: number; width: number; height: number }) {\n    const area = this.node.firstElementChild as HTMLElement;\n    // @see https://bennettfeely.com/clippy/ -> select `Frame` example\n    // use webkit prefix for safari\n    area.style.clipPath = (area.style as any).webkitClipPath = `polygon(\n      0% 0%,\n      0% 100%,\n      ${mask.left}px 100%,\n      ${mask.left}px ${mask.top}px,\n      ${mask.left + mask.width}px ${mask.top}px,\n      ${mask.left + mask.width}px ${mask.top + mask.height}px,\n      ${mask.left}px ${mask.top + mask.height}px,\n      ${mask.left}px 100%,\n      100% 100%,\n      100% 0%\n    )`;\n  }\n\n  setHighlightColumn(column: Column) {\n    const root = this.node.parentElement!;\n    if (!root) {\n      this.clearHighlight();\n      return;\n    }\n    const header = root.querySelector<HTMLElement>(`.${cssClass('header')}[data-col-id=\"${column.id}\"]`);\n    if (!header) {\n      this.clearHighlight();\n      return;\n    }\n    const base = header.getBoundingClientRect();\n    const offset = root.getBoundingClientRect();\n    this.setHighlight({\n      left: base.left - offset.left,\n      top: base.top - offset.top,\n      width: base.width,\n      height: offset.height,\n    });\n  }\n\n  clearHighlight() {\n    const area = this.node.firstElementChild as HTMLElement;\n    area.style.clipPath = null;\n  }\n\n  private removeLast() {\n    if (this.openDialogs.length === 0) {\n      return;\n    }\n    this.remove(this.openDialogs[this.openDialogs.length - 1]);\n  }\n\n  removeAll() {\n    if (this.openDialogs.length === 0) {\n      return;\n    }\n    const all = this.openDialogs.splice(0, this.openDialogs.length);\n    all.reverse().forEach((d) => d.cleanUp(this.onDialogBackgroundClick));\n    this.takeDown();\n  }\n\n  triggerDialogClosed(dialog: ADialog, action: 'cancel' | 'confirm') {\n    this.fire(DialogManager.EVENT_DIALOG_CLOSED, dialog, action);\n  }\n\n  remove(dialog: ADialog, handled = false) {\n    const index = this.openDialogs.indexOf(dialog);\n    if (index < 0) {\n      return false;\n    }\n    // destroy self and all levels below that = after that\n    const destroyed = this.openDialogs.splice(index, this.openDialogs.length - index);\n    destroyed.reverse().forEach((d) => d.cleanUp(handled ? 'handled' : this.onDialogBackgroundClick));\n    while (handled && this.openDialogs.length > 0 && this.openDialogs[this.openDialogs.length - 1].autoClose) {\n      const dialog = this.openDialogs.pop()!;\n      dialog.cleanUp(this.onDialogBackgroundClick);\n    }\n\n    if (this.openDialogs.length === 0) {\n      this.takeDown();\n    }\n    return true;\n  }\n\n  removeAboveLevel(level: number) {\n    // hide all dialogs which have a higher or equal level to the newly opened one\n    this.openDialogs\n      .filter((d) => d.level >= level)\n      .reverse()\n      .forEach((d) => this.remove(d));\n  }\n\n  removeLike(dialog: ADialog) {\n    const similar = this.openDialogs.find((d) => dialog.equals(d));\n    if (!similar) {\n      return false;\n    }\n    this.remove(similar);\n    return true;\n  }\n\n  private setUp() {\n    this.node.ownerDocument!.addEventListener('keyup', this.escKeyListener, {\n      passive: true,\n    });\n    this.node.style.display = 'block';\n  }\n\n  private takeDown() {\n    this.clearHighlight();\n    this.node.ownerDocument!.removeEventListener('keyup', this.escKeyListener);\n    this.node.style.display = null;\n  }\n\n  push(dialog: ADialog) {\n    this.removeAboveLevel(dialog.level);\n\n    if (this.openDialogs.length === 0) {\n      this.setUp();\n    }\n\n    this.openDialogs.push(dialog);\n    this.fire(DialogManager.EVENT_DIALOG_OPENED, dialog);\n  }\n}\n","export { default as KeyFinder } from './KeyFinder';\n/**\n * different row animation modes\n */\nexport var EAnimationMode;\n(function (EAnimationMode) {\n    /**\n     * plain update existed both before and after\n     */\n    EAnimationMode[EAnimationMode[\"UPDATE\"] = 0] = \"UPDATE\";\n    /**\n     * exists both before and after but wasn't visible yet thus was created\n     */\n    EAnimationMode[EAnimationMode[\"UPDATE_CREATE\"] = 1] = \"UPDATE_CREATE\";\n    /**\n     * exists both before and after is visible but not needed anymore and thus removed\n     */\n    EAnimationMode[EAnimationMode[\"UPDATE_REMOVE\"] = 2] = \"UPDATE_REMOVE\";\n    /**\n     * row appears\n     */\n    EAnimationMode[EAnimationMode[\"SHOW\"] = 3] = \"SHOW\";\n    /**\n     * row disappears\n     */\n    EAnimationMode[EAnimationMode[\"HIDE\"] = 4] = \"HIDE\";\n})(EAnimationMode || (EAnimationMode = {}));\nvar NO_CHANGE_DELTA = 1;\nexport function noAnimationChange(_a, previousHeight, currentHeight) {\n    var previous = _a.previous, mode = _a.mode, nodeY = _a.nodeY, current = _a.current;\n    // sounds like the same\n    var prev = previous.height == null ? previousHeight : previous.height;\n    var curr = current.height == null ? currentHeight : current.height;\n    return (mode === EAnimationMode.UPDATE &&\n        Math.abs(previous.y - nodeY) <= NO_CHANGE_DELTA &&\n        Math.abs(prev - curr) <= NO_CHANGE_DELTA);\n}\n/**\n * maximal duration of all animations + extra waiting before e.g. rows are really removed\n * @type {number}\n */\nvar MAX_ANIMATION_TIME = 1100;\nexport var defaultPhases = [\n    {\n        delay: 0,\n        apply: function (_a) {\n            var mode = _a.mode, previous = _a.previous, nodeY = _a.nodeY, current = _a.current, node = _a.node;\n            var actNode = node;\n            actNode.dataset.animation = EAnimationMode[mode].toLowerCase();\n            actNode.style.transform = \"translate(0, \" + (previous.y - nodeY) + \"px)\";\n            if (mode === EAnimationMode.SHOW) {\n                // already target height\n                actNode.style.height = current.height !== null ? current.height + \"px\" : '';\n            }\n            else {\n                // always set previous height for default height changes\n                actNode.style.height = previous.height + \"px\";\n            }\n            if (mode === EAnimationMode.SHOW) {\n                actNode.style.opacity = '0';\n            }\n            else if (mode === EAnimationMode.HIDE) {\n                actNode.style.opacity = '1';\n            }\n            else {\n                actNode.style.opacity = '';\n            }\n        },\n    },\n    {\n        delay: 10,\n        apply: function (_a) {\n            var mode = _a.mode, current = _a.current, nodeY = _a.nodeY, node = _a.node;\n            var actNode = node;\n            // null for added/update since already at the right position\n            actNode.style.transform =\n                mode === EAnimationMode.HIDE || mode === EAnimationMode.UPDATE_REMOVE\n                    ? \"translate(0, \" + (current.y - nodeY) + \"px)\"\n                    : '';\n            if (mode !== EAnimationMode.HIDE) {\n                // keep height for removal\n                actNode.style.height = current.height !== null ? current.height + \"px\" : '';\n            }\n            if (mode === EAnimationMode.SHOW) {\n                actNode.style.opacity = '1';\n            }\n            else if (mode === EAnimationMode.HIDE) {\n                actNode.style.opacity = '0';\n            }\n            else {\n                actNode.style.opacity = '';\n            }\n        },\n    },\n    {\n        delay: MAX_ANIMATION_TIME,\n        apply: function (_a) {\n            var node = _a.node;\n            var actNode = node;\n            delete actNode.dataset.animation;\n            actNode.style.opacity = '';\n            actNode.style.transform = '';\n        },\n    },\n];\n//# sourceMappingURL=index.js.map","import {\n  getUnsupportedBrowserError,\n  SUPPORTED_CHROME_VERSION,\n  SUPPORTED_EDGE_VERSION,\n  SUPPORTED_FIREFOX_VERSION,\n} from '../browser';\nimport type { ILineUpLike } from '../config';\nimport { AEventDispatcher, IEventListener, clear } from '../internal';\nimport type { Column } from '../model';\nimport { DataProvider, IDataProviderDump } from '../provider';\nimport { cssClass } from '../styles';\nimport DialogManager from './dialogs/DialogManager';\nimport type { ADialog } from './dialogs';\nimport { isPromiseLike } from '../provider/utils';\n\n/**\n * emitted when the highlight changes\n * @asMemberOf ALineUp\n * @param dataIndex the highlighted data index or -1 for none\n * @event\n */\nexport declare function highlightChanged(dataIndex: number): void;\n\n/**\n * emitted when the selection changes\n * @asMemberOf ALineUp\n * @param dataIndices the selected data indices\n * @event\n */\nexport declare function selectionChanged(dataIndices: number[]): void;\n/**\n * emitted a dialog is opened\n * @asMemberOf ALineUp\n * @param dialog the opened dialog\n * @event\n */\nexport declare function dialogOpened(dialog: ADialog): void;\n/**\n * emitted a dialog is closed\n * @asMemberOf ALineUp\n * @param dialog the closed dialog\n * @param action the action how the dialog was closed\n * @event\n */\nexport declare function dialogClosed(dialog: ADialog, action: 'cancel' | 'confirm'): void;\n\nexport abstract class ALineUp extends AEventDispatcher implements ILineUpLike {\n  static readonly EVENT_SELECTION_CHANGED = DataProvider.EVENT_SELECTION_CHANGED;\n  static readonly EVENT_DIALOG_OPENED = DialogManager.EVENT_DIALOG_OPENED;\n  static readonly EVENT_DIALOG_CLOSED = DialogManager.EVENT_DIALOG_CLOSED;\n  static readonly EVENT_HIGHLIGHT_CHANGED = 'highlightChanged';\n\n  private highlightListeners = 0;\n\n  readonly isBrowserSupported: boolean;\n\n  constructor(public readonly node: HTMLElement, private _data: DataProvider, ignoreIncompatibleBrowser: boolean) {\n    super();\n\n    const error = getUnsupportedBrowserError();\n    this.isBrowserSupported = ignoreIncompatibleBrowser || !error;\n\n    if (!this.isBrowserSupported) {\n      this.node.classList.add(cssClass('unsupported-browser'));\n      this.node.innerHTML = `<span>${error}</span>\n      <div class=\"${cssClass('unsupported-browser')}\">\n        <a href=\"https://www.mozilla.org/en-US/firefox/\" rel=\"noopener\" target=\"_blank\" data-browser=\"firefox\" data-version=\"${SUPPORTED_FIREFOX_VERSION}\"></a>\n        <a href=\"https://www.google.com/chrome/index.html\" rel=\"noopener\" target=\"_blank\" data-browser=\"chrome\" data-version=\"${SUPPORTED_CHROME_VERSION}\" title=\"best support\"></a>\n        <a href=\"https://www.microsoft.com/en-us/windows/microsoft-edge\" rel=\"noopener\" target=\"_blank\" data-browser=\"edge\" data-version=\"${SUPPORTED_EDGE_VERSION}\"></a>\n      </div><span>use the <code>ignoreUnsupportedBrowser=true</code> option to ignore this error at your own risk</span>`;\n    }\n\n    this.forward(_data, `${DataProvider.EVENT_SELECTION_CHANGED}.main`);\n    _data.on(`${DataProvider.EVENT_BUSY}.busy`, (busy) => this.node.classList.toggle(cssClass('busy'), busy));\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        ALineUp.EVENT_HIGHLIGHT_CHANGED,\n        ALineUp.EVENT_SELECTION_CHANGED,\n        ALineUp.EVENT_DIALOG_OPENED,\n        ALineUp.EVENT_DIALOG_CLOSED,\n      ]);\n  }\n\n  on(type: typeof ALineUp.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\n  on(type: typeof ALineUp.EVENT_SELECTION_CHANGED, listener: typeof selectionChanged | null): this;\n  on(type: typeof ALineUp.EVENT_DIALOG_OPENED, listener: typeof dialogOpened | null): this;\n  on(type: typeof ALineUp.EVENT_DIALOG_CLOSED, listener: typeof dialogClosed | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  get data() {\n    return this._data;\n  }\n\n  destroy() {\n    // just clear since we hand in the node itself\n    clear(this.node);\n    this._data.destroy();\n  }\n\n  dump() {\n    return this.data.dump();\n  }\n\n  restore(dump: IDataProviderDump) {\n    this._data.restore(dump);\n  }\n\n  abstract update(): void;\n\n  setDataProvider(data: DataProvider, dump?: IDataProviderDump) {\n    if (this._data) {\n      this.unforward(this._data, `${DataProvider.EVENT_SELECTION_CHANGED}.taggle`);\n      this._data.on(`${DataProvider.EVENT_BUSY}.busy`, null);\n    }\n    this._data = data;\n    if (dump) {\n      data.restore(dump);\n    }\n    this.forward(data, `${DataProvider.EVENT_SELECTION_CHANGED}.taggle`);\n\n    data.on(`${DataProvider.EVENT_BUSY}.busy`, (busy) => this.node.classList.toggle(cssClass('busy'), busy));\n  }\n\n  getSelection() {\n    return this._data.getSelection();\n  }\n\n  setSelection(dataIndices: number[]) {\n    this._data.setSelection(dataIndices);\n  }\n\n  /**\n   * sorts LineUp by he given column\n   * @param column callback function finding the column to sort\n   * @param ascending\n   * @returns {boolean}\n   */\n  sortBy(column: string | ((col: Column) => boolean), ascending = false) {\n    const col = this.data.find(column);\n    if (col) {\n      col.sortByMe(ascending);\n    }\n    return col != null;\n  }\n\n  abstract setHighlight(dataIndex: number, scrollIntoView: boolean): boolean;\n\n  abstract getHighlight(): number;\n\n  protected listenersChanged(type: string, enabled: boolean) {\n    super.listenersChanged(type, enabled);\n    if (!type.startsWith(ALineUp.EVENT_HIGHLIGHT_CHANGED)) {\n      return;\n    }\n    if (enabled) {\n      this.highlightListeners++;\n      if (this.highlightListeners === 1) {\n        // first\n        this.enableHighlightListening(true);\n      }\n    } else {\n      this.highlightListeners -= 1;\n      if (this.highlightListeners === 0) {\n        // last\n        this.enableHighlightListening(false);\n      }\n    }\n  }\n\n  protected enableHighlightListening(_enable: boolean) {\n    // hook\n  }\n\n  protected addCopyListener() {\n    this.node.addEventListener('copy', (e) => {\n      if (!this.data || !this.data.getFirstRanking()) {\n        return;\n      }\n      const selections = this.data.getSelection();\n      let data: Promise<string> | string;\n      if (selections.length === 0) {\n        // copy all\n        data = this.data.exportTable(this.data.getFirstRanking());\n      } else {\n        // copy subset\n        data = this.data.exportSelection();\n      }\n      e.preventDefault();\n      if (isPromiseLike(data)) {\n        data.then((csv) => {\n          e.clipboardData.setData('text/plain', csv);\n          e.clipboardData.setData('text/tsv', csv);\n        });\n      } else {\n        e.clipboardData.setData('text/plain', data);\n        e.clipboardData.setData('text/tsv', data);\n      }\n    });\n  }\n}\n\nexport default ALineUp;\n","/**\n * utility class for optimized row context access\n */\nvar KeyFinder = /** @class */ (function () {\n    /**\n     * constructor for fast key based row access\n     * @param {IExceptionContext} context context to use\n     * @param {(rowIndex: number) => string} key key function\n     */\n    function KeyFinder(context, key) {\n        var _this = this;\n        this.context = context;\n        this.key = key;\n        this.cache = [];\n        this.lastFilled = 0;\n        this.key2index = new Map();\n        this.context.exceptions.forEach(function (e) {\n            _this.cache[e.index] = e.y;\n            _this.key2index.set(key(e.index), e.index);\n        });\n    }\n    KeyFinder.prototype.findValidStart = function (before) {\n        for (var i = before - 1; i >= 0; i -= 1) {\n            if (this.cache[i] !== undefined) {\n                return i;\n            }\n        }\n        return -1;\n    };\n    /**\n     * returns the position of the given given or -1 if not found\n     * @param {string} key\n     */\n    KeyFinder.prototype.posByKey = function (key) {\n        var index = this.key2index.get(key);\n        if (index != null) {\n            return { index: index, pos: this.pos(index) };\n        }\n        return this.fillCacheTillKey(key);\n    };\n    /**\n     * returns the position of the given index\n     * @param {number} index index to look for\n     */\n    KeyFinder.prototype.pos = function (index) {\n        if (this.context.exceptions.length === 0) {\n            // fast pass\n            return index * this.context.defaultRowHeight;\n        }\n        var cached = this.cache[index];\n        if (cached !== undefined) {\n            return cached;\n        }\n        // need to compute it\n        // find the starting point where to start counting\n        var start = this.findValidStart(index);\n        if (start < 0) {\n            this.fillCache(0, index, 0);\n        }\n        else {\n            this.fillCache(start + 1, index, this.cache[start] + this.heightOf(start));\n        }\n        return this.cache[index];\n    };\n    KeyFinder.prototype.fillCache = function (first, last, offset, callback) {\n        if (last <= this.lastFilled) {\n            // everything already there\n            if (!callback) {\n                return;\n            }\n            for (var i = first; i <= last; i += 1) {\n                callback(i, this.key(i), this.cache[i]);\n            }\n            return;\n        }\n        var pos = offset;\n        for (var i = first; i <= last; i += 1) {\n            this.cache[i] = pos;\n            var key = this.key(i);\n            this.key2index.set(key, i);\n            if (callback) {\n                callback(i, key, pos);\n            }\n            pos += this.heightOf(i);\n        }\n    };\n    /**\n     * returns the height of the row identified by index\n     * @param {number} index\n     */\n    KeyFinder.prototype.heightOf = function (index) {\n        var _a;\n        var lookup = this.context.exceptionsLookup;\n        return (_a = lookup.get(index)) !== null && _a !== void 0 ? _a : this.context.defaultRowHeight;\n    };\n    KeyFinder.prototype.exceptionHeightOf = function (index, returnDefault) {\n        if (returnDefault === void 0) { returnDefault = false; }\n        var padding = this.context.padding(index);\n        var lookup = this.context.exceptionsLookup;\n        var entry = lookup.get(index);\n        if (entry != null) {\n            return entry - padding;\n        }\n        return returnDefault ? this.context.defaultRowHeight - padding : null;\n    };\n    /**\n     * padding of the given index\n     * @param {number} index\n     * @returns {number}\n     */\n    KeyFinder.prototype.padding = function (index) {\n        return this.context.padding(index);\n    };\n    KeyFinder.prototype.fillCacheTillKey = function (target) {\n        var pos = 0;\n        for (var i = this.lastFilled; i < this.context.numberOfRows; i += 1, this.lastFilled += 1) {\n            var c = this.cache[i];\n            if (c !== undefined) {\n                pos = c + this.heightOf(i);\n                continue;\n            }\n            // new one fill up\n            var key = this.key(i);\n            this.cache[i] = pos;\n            this.key2index.set(key, i);\n            if (key === target) {\n                return { index: i, pos: pos };\n            }\n            pos += this.heightOf(i);\n        }\n        return { index: -1, pos: -1 };\n    };\n    /**\n     * computes the positions and keys for a range of given indices\n     * @param {number} first first row index\n     * @param {number} last last row index\n     * @param {number} offset pos offset for the first row index\n     * @param {(index: number, key: string, pos: number) => void} callback callback for each identified index\n     */\n    KeyFinder.prototype.positions = function (first, last, offset, callback) {\n        this.fillCache(first, last, offset, callback);\n    };\n    return KeyFinder;\n}());\nexport default KeyFinder;\n//# sourceMappingURL=KeyFinder.js.map","export * from './scroll';\n/**\n * clear node clearing\n * @param node\n * @internal\n */\nexport function clear(node) {\n    while (node.lastChild) {\n        node.removeChild(node.lastChild);\n    }\n    return node;\n}\n//# sourceMappingURL=index.js.map","export var defaultMode = 'animation'; // Boolean((<any>window).chrome) ? 'animation' : 0, // animation frame on chrome;\nfunction dummy() {\n    return {\n        handler: [],\n        prev: null,\n        timer: -1,\n    };\n}\nvar ScrollHandler = /** @class */ (function () {\n    function ScrollHandler(node) {\n        // this.current = this.asInfo();\n        var _this = this;\n        this.node = node;\n        this.sync = dummy();\n        this.animation = dummy();\n        this.numbers = new Map();\n        this.handleAnimationImpl = function () {\n            if (_this.animation.timer !== 1) {\n                return;\n            }\n            _this.handle(_this.animation);\n            _this.animation.timer = -1;\n        };\n        node.addEventListener('scroll', function () {\n            // this.current = this.asInfo();\n            // if (this.prev && (Math.abs(this.current.left - this.prev.left) + Math.abs(this.current.top - this.prev.top)) < 4) {\n            //   return;\n            // }\n            // this.prev = this.current;\n            if (_this.sync.handler.length > 0) {\n                _this.handle(_this.sync);\n            }\n            _this.handleAnimation();\n            _this.handleTimeouts();\n        }, {\n            passive: true,\n        });\n    }\n    Object.defineProperty(ScrollHandler.prototype, \"current\", {\n        // current: IScrollInfo;\n        // private prev: IScrollInfo | null = null;\n        get: function () {\n            return this.asInfo();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ScrollHandler.prototype.handle = function (handler) {\n        var info = this.current;\n        if (handler.prev && Math.abs(info.left - handler.prev.left) + Math.abs(info.top - handler.prev.top) < 4) {\n            return;\n        }\n        // eslint-disable-next-line no-param-reassign\n        handler.prev = info;\n        for (var _i = 0, _a = handler.handler; _i < _a.length; _i++) {\n            var s = _a[_i];\n            s(info);\n        }\n    };\n    ScrollHandler.prototype.handleAnimation = function () {\n        if (this.animation.timer !== -1 || this.animation.handler.length === 0) {\n            return;\n        }\n        this.animation.timer = 1;\n        requestAnimationFrame(this.handleAnimationImpl);\n    };\n    ScrollHandler.prototype.handleTimeouts = function () {\n        var _this = this;\n        if (this.numbers.size === 0) {\n            return;\n        }\n        this.numbers.forEach(function (handler, n) {\n            if (handler.handler.length === 0) {\n                return;\n            }\n            // eslint-disable-next-line no-param-reassign, no-restricted-globals\n            handler.timer = self.setTimeout(function () {\n                _this.handle(handler);\n                // eslint-disable-next-line no-param-reassign\n                handler.timer = -1;\n            }, n);\n        });\n    };\n    ScrollHandler.prototype.asInfo = function () {\n        return {\n            left: this.node.scrollLeft,\n            top: this.node.scrollTop,\n            width: this.node.clientWidth,\n            height: this.node.clientHeight,\n        };\n    };\n    ScrollHandler.prototype.push = function (mode, handler) {\n        var _a;\n        if (typeof mode === 'number') {\n            var entry = (_a = this.numbers.get(mode)) !== null && _a !== void 0 ? _a : dummy();\n            entry.handler.push(handler);\n            this.numbers.set(mode, entry);\n        }\n        switch (mode) {\n            case 'sync':\n                this.sync.handler.push(handler);\n                break;\n            case 'animation':\n                this.animation.handler.push(handler);\n                break;\n        }\n    };\n    ScrollHandler.prototype.remove = function (handler) {\n        var test = [this.sync, this.animation].concat(Array.from(this.numbers.values()));\n        return test.some(function (d) {\n            var index = d.handler.indexOf(handler);\n            if (index >= 0) {\n                d.handler.splice(index, 1);\n            }\n            return index >= 0;\n        });\n    };\n    ScrollHandler.prototype.isWaiting = function (mode) {\n        var _a, _b;\n        switch (mode) {\n            case 'animation':\n                return this.animation.timer >= 0;\n            case 'sync':\n                return false;\n            default:\n                return ((_b = (_a = this.numbers.get(mode)) === null || _a === void 0 ? void 0 : _a.timer) !== null && _b !== void 0 ? _b : -1) >= 0;\n        }\n    };\n    return ScrollHandler;\n}());\n/**\n * @internal\n */\nexport function addScroll(scrollElement, mode, handler) {\n    // hide in element to have just one real listener\n    var c = scrollElement;\n    if (!c.__le_scroller__) {\n        c.__le_scroller__ = new ScrollHandler(scrollElement);\n    }\n    var s = c.__le_scroller__;\n    s.push(mode, handler);\n    return s.asInfo();\n}\n/**\n * @internal\n */\nexport function isScrollEventWaiting(scroller, mode) {\n    var c = scroller;\n    if (!c.__le_scroller__) {\n        return false;\n    }\n    var s = c.__le_scroller__;\n    return s.isWaiting(mode);\n}\n/**\n * @internal\n */\nexport function removeScroll(scroller, handler) {\n    var c = scroller;\n    if (c.__le_scroller__) {\n        c.__le_scroller__.remove(handler);\n    }\n}\n//# sourceMappingURL=scroll.js.map","var RowHeightException = /** @class */ (function () {\n    function RowHeightException(index, y, height) {\n        this.index = index;\n        this.y = y;\n        this.height = height;\n    }\n    Object.defineProperty(RowHeightException.prototype, \"y2\", {\n        get: function () {\n            return this.y + this.height;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RowHeightException;\n}());\n/**\n * creates a uniform exception context, i.e no exceptions all rows are of the same height\n * @param {number} numberOfRows\n * @param {number} currentRowHeight\n * @param {number} rowPadding padding between rows\n * @return {IExceptionContext}\n */\nexport function uniformContext(numberOfRows, rowHeight, rowPadding) {\n    if (rowPadding === void 0) { rowPadding = 0; }\n    var currentRowHeight = rowHeight + rowPadding;\n    var exceptionsLookup = {\n        keys: function () { return [].values(); },\n        get: function () { return currentRowHeight; },\n        has: function () { return false; },\n        size: 0,\n    };\n    return {\n        exceptions: [],\n        exceptionsLookup: exceptionsLookup,\n        totalHeight: numberOfRows * currentRowHeight,\n        numberOfRows: numberOfRows,\n        defaultRowHeight: currentRowHeight,\n        padding: function () { return rowPadding; },\n    };\n}\n/**\n * computes the most frequent value in a given array like\n * @param {} values\n * @return {number}\n */\nfunction mostFrequentValue(values) {\n    var lookup = new Map();\n    values.forEach(function (value) {\n        lookup.set(value, (lookup.get(value) || 0) + 1);\n    });\n    if (lookup.size === 0) {\n        return 20; // default value since it doesn't matter\n    }\n    // sort desc take first key and asc by the second in case of tie, it is optimized to have exceptions for higher rows less for big rows\n    var sorted = Array.from(lookup).sort(function (a, b) {\n        if (a[1] !== b[1]) {\n            return b[1] - a[1];\n        }\n        return a[0] - b[0];\n    });\n    var mostFrequent = sorted[0][0];\n    if (mostFrequent === 0) {\n        // corner case\n        return sorted.length > 1 ? sorted[1][0] : 20; // all empty\n    }\n    return mostFrequent;\n}\n/**\n * creates a non uniform context based on the given array like heights\n * @param rowHeights array like to get the heights\n * @param {number} defaultRowHeight if not given the most frequent value will be used\n * @param {number} rowPadding padding between rows\n * @return {IExceptionContext}\n */\nexport function nonUniformContext(rowHeights, defaultRowHeight, rowPadding) {\n    if (defaultRowHeight === void 0) { defaultRowHeight = Number.NaN; }\n    if (rowPadding === void 0) { rowPadding = 0; }\n    var exceptionsLookup = new Map();\n    var exceptions = [];\n    var padding = typeof rowPadding === 'function' ? rowPadding : function () { return rowPadding; };\n    var actualDefaultRowHeight = defaultRowHeight;\n    if (Number.isNaN(actualDefaultRowHeight)) {\n        actualDefaultRowHeight = mostFrequentValue(rowHeights);\n    }\n    actualDefaultRowHeight += padding(-1);\n    var prev = -1;\n    var acc = 0;\n    var totalHeight = 0;\n    var numberOfRows = 0;\n    rowHeights.forEach(function (height, index) {\n        var paddedHeight = height + padding(index);\n        totalHeight += paddedHeight;\n        numberOfRows += 1;\n        if (paddedHeight === actualDefaultRowHeight) {\n            // regular\n            return;\n        }\n        exceptionsLookup.set(index, paddedHeight);\n        var between = (index - prev - 1) * actualDefaultRowHeight;\n        prev = index;\n        var y = acc + between;\n        acc = y + paddedHeight;\n        exceptions.push(new RowHeightException(index, y, paddedHeight));\n    });\n    return {\n        exceptionsLookup: exceptionsLookup,\n        exceptions: exceptions,\n        totalHeight: totalHeight,\n        defaultRowHeight: actualDefaultRowHeight,\n        numberOfRows: numberOfRows,\n        padding: padding,\n    };\n}\n/**\n * creates a random context with the given constraints\n * @param {number} numberOfRows\n * @param {number} defaultRowHeight\n * @param {number} minRowHeight\n * @param {number} maxRowHeight\n * @param {number} ratio around ratio percent will get a non uniform height\n * @param {number} seed random seed\n * @return {IExceptionContext}\n */\nexport function randomContext(numberOfRows, defaultRowHeight, minRowHeight, maxRowHeight, ratio, seed) {\n    if (minRowHeight === void 0) { minRowHeight = 2; }\n    if (maxRowHeight === void 0) { maxRowHeight = defaultRowHeight * 10; }\n    if (ratio === void 0) { ratio = 0.2; }\n    if (seed === void 0) { seed = Date.now(); }\n    var actSeed = seed;\n    var random = function () {\n        var x = Math.sin(actSeed) * 10000;\n        actSeed += 1;\n        return x - Math.floor(x);\n    };\n    var getter = function () {\n        var coin = random();\n        if (coin < ratio) {\n            // non uniform\n            return minRowHeight + Math.round(random() * (maxRowHeight - minRowHeight));\n        }\n        return defaultRowHeight;\n    };\n    var forEach = function (callback) {\n        for (var index = 0; index < numberOfRows; index += 1) {\n            callback(getter(), index);\n        }\n    };\n    return nonUniformContext({ forEach: forEach }, defaultRowHeight);\n}\n/**\n * computes the visible range\n * @param {number} scrollTop top scrolling\n * @param {number} clientHeight visible height\n * @param {number} rowHeight height of a row by default\n * @param {IRowHeightException[]} heightExceptions exceptions of this default height\n * @param {number} numberOfRows the number of rows\n * @return {IVisibleRange} the computed visible range\n */\nexport function range(scrollTop, clientHeight, rowHeight, heightExceptions, numberOfRows) {\n    if (numberOfRows === 0) {\n        return { first: 0, last: -1, firstRowPos: 0, endPos: 0 };\n    }\n    if (numberOfRows === 1) {\n        return {\n            first: 0,\n            last: 0,\n            firstRowPos: 0,\n            endPos: heightExceptions.length === 0 ? rowHeight : heightExceptions[0].y2,\n        };\n    }\n    var offset = scrollTop;\n    var offset2 = offset + clientHeight;\n    function indexOf(pos, indexShift) {\n        return Math.min(numberOfRows - 1, indexShift + Math.max(0, Math.floor(pos / rowHeight)));\n    }\n    function calc(offsetShift, indexShift) {\n        var shifted = offset - offsetShift;\n        var shifted2 = offset2 - offsetShift;\n        var first = indexOf(shifted, indexShift);\n        var last = indexOf(shifted2, indexShift);\n        var firstRowPos = offsetShift + (first - indexShift) * rowHeight;\n        var endPos = offsetShift + (last + 1 - indexShift) * rowHeight;\n        // if (!isGuess) {\n        //  console.log(first, '@', firstRowPos, last, '#', end, offset, offset2, firstRowPos <= offset, offset2 <= end);\n        // }\n        // console.assert(\n        //   !isGuess || !(firstRowPos > offset || (endPos < offset2 && last < numberOfRows - 1)),\n        //   'error',\n        //   isGuess,\n        //   firstRowPos,\n        //   endPos,\n        //   offset,\n        //   offset2,\n        //   indexShift,\n        //   offsetShift\n        // );\n        return { first: first, last: last, firstRowPos: firstRowPos, endPos: endPos };\n    }\n    var r = calc(0, 0);\n    if (heightExceptions.length === 0) {\n        // uniform\n        return r;\n    }\n    if (r.last < heightExceptions[0].index) {\n        // console.log('before the first exception = uniform with no shift');\n        // console.log(r.first, '@', r.firstRowPos, r.last, '#', r.end, offset, offset2, r.firstRowPos <= offset, offset2 <= r.end);\n        return r;\n    }\n    if (r.last === heightExceptions[0].index && heightExceptions[0].height > rowHeight) {\n        return Object.assign(r, { endPos: heightExceptions[0].y2 });\n    }\n    // the position where the exceptions ends\n    var lastPos = heightExceptions[heightExceptions.length - 1];\n    if (offset >= lastPos.y) {\n        var rest = calc(lastPos.y2, lastPos.index + 1);\n        if (offset < lastPos.y2) {\n            // include me\n            return Object.assign(rest, {\n                first: lastPos.index,\n                firstRowPos: lastPos.y,\n            });\n        }\n        return rest;\n    }\n    // we have some exceptions\n    var visible = [];\n    var closest = heightExceptions[0]; // closest before not in range\n    for (var _i = 0, heightExceptions_1 = heightExceptions; _i < heightExceptions_1.length; _i++) {\n        var item = heightExceptions_1[_i];\n        var y = item.y, y2 = item.y2;\n        if (y >= offset2) {\n            break;\n        }\n        if (y2 <= offset) {\n            closest = item;\n            continue;\n        }\n        visible.push(item);\n    }\n    if (visible.length === 0) {\n        // console.log('we are in the between some exceptions and none are visible');\n        return calc(closest.y2, closest.index + 1); // skip myself\n    }\n    {\n        // console.log('we show at least one exception');\n        var firstException = visible[0];\n        var lastException = visible[visible.length - 1];\n        var first = Math.max(0, firstException.index - Math.max(0, Math.ceil((firstException.y - offset) / rowHeight)));\n        var last = lastException.index;\n        if (offset2 >= lastException.y2) {\n            last = indexOf(offset2 - lastException.y2, lastException.index + 1);\n        }\n        var firstRowPos = firstException.y - (firstException.index - first) * rowHeight;\n        var endPos = lastException.y2 + (last - lastException.index) * rowHeight;\n        // console.log(first, '@', firstRowPos, last, '#', end, offset, offset2, firstRowPos <= offset, offset2 <= end);\n        // console.assert(\n        //   firstRowPos <= offset && (endPos >= offset2 || last === numberOfRows - 1),\n        //   'error',\n        //   firstRowPos,\n        //   endPos,\n        //   offset,\n        //   offset2,\n        //   firstException,\n        //   lastException\n        // );\n        return { first: first, last: last, firstRowPos: firstRowPos, endPos: endPos };\n    }\n}\nexport function frozenDelta(current, target) {\n    var currentLength = current.length;\n    var targetLength = target.length;\n    if (currentLength === 0) {\n        return { added: target, removed: [], common: 0 };\n    }\n    if (targetLength === 0) {\n        return { added: [], removed: current, common: 0 };\n    }\n    if (currentLength === targetLength) {\n        // since sorted and left increasing true\n        return { added: [], removed: [], common: currentLength };\n    }\n    var removed = current.slice(Math.min(targetLength, currentLength));\n    var added = target.slice(Math.min(targetLength, currentLength));\n    return { added: added, removed: removed, common: currentLength - removed.length };\n}\nexport function updateFrozen(old, columns, first) {\n    var oldLast = old.length === 0 ? 0 : old[old.length - 1] + 1;\n    var added = [];\n    var removed = [];\n    for (var i = old.length - 1; i >= 0; i -= 1) {\n        var index = old[i];\n        if (index >= first) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            removed.push(old.pop());\n        }\n        else {\n            // can stop since sorted and it will never happen again\n            break;\n        }\n    }\n    // added\n    for (var i = oldLast; i < first; i += 1) {\n        if (columns[i].frozen) {\n            added.push(i);\n            old.push(i);\n        }\n    }\n    return { target: old, added: added, removed: removed };\n}\n//# sourceMappingURL=logic.js.map","/**\n * scrolling result\n */\nexport var EScrollResult;\n(function (EScrollResult) {\n    /**\n     * nothing has changed\n     */\n    EScrollResult[EScrollResult[\"NONE\"] = 0] = \"NONE\";\n    /**\n     * all rows needed to be recreated\n     */\n    EScrollResult[EScrollResult[\"ALL\"] = 1] = \"ALL\";\n    /**\n     * unknown\n     */\n    EScrollResult[EScrollResult[\"SOME\"] = 2] = \"SOME\";\n    /**\n     * some rows are added at the bottom\n     */\n    EScrollResult[EScrollResult[\"SOME_BOTTOM\"] = 3] = \"SOME_BOTTOM\";\n    /**\n     * some rows are added at the top\n     */\n    EScrollResult[EScrollResult[\"SOME_TOP\"] = 4] = \"SOME_TOP\";\n})(EScrollResult || (EScrollResult = {}));\n//# sourceMappingURL=IMixin.js.map","var PREFIX = 'le';\n/**\n * @internal\n * @param suffix suffix to suffix\n */\nexport function cssClass(suffix) {\n    if (!suffix) {\n        return PREFIX;\n    }\n    return PREFIX + \"-\" + suffix;\n}\nexport var CSS_CLASS_LOADING = cssClass('loading');\nexport var CSS_CLASS_FROZEN = cssClass('frozen');\nexport var CSS_CLASS_HIDDEN = cssClass('hidden');\nexport var CSS_CLASS_MULTI = cssClass('multi');\nexport var CSS_CLASS_EVEN = cssClass('even');\nexport var CSS_CLASS_SHIFTED = cssClass('shifted');\nexport var CSS_CLASS_SCROLLBAR_TESTER = cssClass('scrollbar-tester');\nexport var CSS_CLASS_HEADER = cssClass('header');\nexport var CSS_CLASS_BODY = cssClass('body');\nexport var CSS_CLASS_FOOTER = cssClass('footer');\nexport var CSS_CLASS_THEAD = cssClass('thead');\nexport var CSS_CLASS_TBODY = cssClass('tbody');\nexport var CSS_CLASS_TR = cssClass('tr');\nexport var CSS_CLASS_TH = cssClass('th');\nexport var CSS_CLASS_TD = cssClass('td');\nexport var CSS_CLASS_SCROLLING = cssClass('scrolling');\nexport var CSS_CLASS_ROW_ANIMATION = cssClass('row-animation');\n//# sourceMappingURL=index.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { ABORTED, isAbortAble } from './abortAble';\nimport { defaultPhases, EAnimationMode, noAnimationChange, } from './animation';\nimport KeyFinder from './animation/KeyFinder';\nimport { addScroll, clear, defaultMode, removeScroll } from './internal';\nimport { isScrollEventWaiting } from './internal/scroll';\nimport { range } from './logic';\nimport { EScrollResult } from './mixin';\nimport { cssClass, CSS_CLASS_EVEN, CSS_CLASS_FOOTER, CSS_CLASS_LOADING, CSS_CLASS_ROW_ANIMATION, CSS_CLASS_SCROLLING, CSS_CLASS_TR, } from './styles';\nexport function isLoadingCell(node) {\n    return node.classList.contains(CSS_CLASS_LOADING);\n}\n/**\n * base class for creating a scalable table renderer based on rows\n */\nvar ARowRenderer = /** @class */ (function () {\n    function ARowRenderer(body, options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        this.body = body;\n        this.pool = [];\n        this.loadingPool = [];\n        this.loading = new WeakMap();\n        /**\n         * currently visible slice\n         */\n        this.visible = {\n            first: 0,\n            forcedFirst: 0,\n            last: -1,\n            forcedLast: -1,\n        };\n        /**\n         * position of the first visible row in pixel\n         * @type {number}\n         */\n        this.visibleFirstRowPos = 0;\n        this.scrollListener = null;\n        this.lastScrollInfo = null;\n        this.abortAnimation = function () { return undefined; };\n        this.options = {\n            async: defaultMode,\n            minScrollDelta: 10,\n            mixins: [],\n            scrollingHint: false,\n            batchSize: 10,\n            striped: false,\n            viewportOversize: 200,\n        };\n        this.adapter = this.createAdapter();\n        Object.assign(this.options, options);\n        this.mixins = this.options.mixins.map(function (MixinClass) { return new MixinClass(_this.adapter); });\n        this.fragment = body.ownerDocument.createDocumentFragment();\n    }\n    /**\n     * register another mixin to this renderer\n     * @param {IMixinClass} MixinClass the mixin class to instantiate\n     * @param options optional constructor options\n     */\n    ARowRenderer.prototype.addMixin = function (MixinClass, options) {\n        this.mixins.push(new MixinClass(this.adapter, options));\n    };\n    ARowRenderer.prototype.createAdapter = function () {\n        var _this = this;\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        var that = this;\n        return {\n            visible: this.visible,\n            addAtBeginning: function (from, to) { return _this.addAtBeginning(from, to); },\n            addAtBottom: this.addAtBottom.bind(this),\n            removeFromBeginning: function (from, to) { return _this.removeFromBeginning(from, to); },\n            removeFromBottom: this.removeFromBottom.bind(this),\n            updateOffset: this.updateOffset.bind(this),\n            isScrollEventWaiting: function () { return isScrollEventWaiting(_this.bodyScroller, _this.options.async); },\n            get visibleFirstRowPos() {\n                return that.visibleFirstRowPos;\n            },\n            get context() {\n                return that.context;\n            },\n            get scrollOffset() {\n                return that.lastScrollInfo ? that.lastScrollInfo.top : 0;\n            },\n            get scrollTotal() {\n                return that.lastScrollInfo ? that.lastScrollInfo.height : that.bodyScroller.clientHeight;\n            },\n        };\n    };\n    Object.defineProperty(ARowRenderer.prototype, \"bodyScroller\", {\n        /**\n         * get the scrolling container i.e. parent of the body element\n         * @returns {HTMLElement}\n         */\n        get: function () {\n            return this.body.parentElement;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ARowRenderer.prototype, \"bodySizer\", {\n        get: function () {\n            var parent = this.bodyScroller;\n            var sizer = Array.from(parent.children).find(function (d) { return d.tagName.toLowerCase() === 'footer'; });\n            if (sizer) {\n                return sizer;\n            }\n            var s = parent.ownerDocument.createElement('footer');\n            s.classList.add(CSS_CLASS_FOOTER, cssClass(\"footer-\" + this.idPrefix));\n            parent.insertBefore(s, parent.firstChild);\n            return s;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * initializes the table and register the onscroll listener\n     * @returns {void} nothing\n     */\n    ARowRenderer.prototype.init = function () {\n        var _this = this;\n        var scroller = this.bodyScroller;\n        var old = addScroll(scroller, this.options.async, (this.scrollListener = function (act) {\n            _this.lastScrollInfo = act;\n            if (Math.abs(old.top - act.top) < _this.options.minScrollDelta &&\n                Math.abs(old.height - act.height) < _this.options.minScrollDelta) {\n                return;\n            }\n            var isGoingDown = act.top > old.top;\n            old = act;\n            _this.onScrolledVertically(act.top, act.height, isGoingDown);\n            if (_this.options.scrollingHint) {\n                _this.body.classList.remove(CSS_CLASS_SCROLLING);\n            }\n        }));\n        if (this.options.scrollingHint) {\n            addScroll(scroller, 'animation', function () { return _this.body.classList.add(CSS_CLASS_SCROLLING); });\n        }\n        this.recreate();\n    };\n    /**\n     * destroys this renderer and unregisters all event listeners\n     */\n    ARowRenderer.prototype.destroy = function () {\n        if (this.scrollListener) {\n            removeScroll(this.bodyScroller, this.scrollListener);\n        }\n        this.body.remove();\n    };\n    ARowRenderer.cleanUp = function (item) {\n        // eslint-disable-next-line no-param-reassign\n        item.style.height = '';\n    };\n    ARowRenderer.prototype.select = function (index) {\n        var item = this.pool.pop();\n        var result;\n        if (item != null) {\n            result = this.updateRow(item, index);\n        }\n        else {\n            item = this.loadingPool.pop();\n            if (item != null) {\n                item.classList.remove(CSS_CLASS_LOADING);\n                result = this.createRow(item, index);\n            }\n            else {\n                item = this.body.ownerDocument.createElement('div');\n                item.classList.add(CSS_CLASS_TR, cssClass(\"tr-\" + this.idPrefix));\n                result = this.createRow(item, index);\n            }\n        }\n        item.dataset.index = String(index);\n        if (this.options.striped) {\n            item.classList.toggle(CSS_CLASS_EVEN, index % 2 === 0);\n        }\n        return { item: item, result: result };\n    };\n    ARowRenderer.prototype.selectProxy = function () {\n        var proxy = this.loadingPool.pop();\n        if (proxy == null) {\n            proxy = this.body.ownerDocument.createElement('div');\n            proxy.classList.add(CSS_CLASS_LOADING, CSS_CLASS_TR, cssClass(\"tr-\" + this.idPrefix));\n        }\n        return proxy;\n    };\n    ARowRenderer.prototype.recycle = function (item) {\n        ARowRenderer.cleanUp(item);\n        // check if the original dom element is still being manipulated\n        var abort = this.loading.get(item);\n        if (abort != null) {\n            abort.abort();\n        }\n        else {\n            this.pool.push(item);\n        }\n    };\n    ARowRenderer.prototype.proxy = function (item, result) {\n        var _this = this;\n        if (!isAbortAble(result)) {\n            return item;\n        }\n        var abort = result;\n        // lazy loading\n        var real = item;\n        var proxy = this.selectProxy();\n        // copy attributes\n        proxy.dataset.index = real.dataset.index;\n        proxy.style.height = real.style.height;\n        this.loading.set(proxy, abort);\n        abort.then(function (abortResult) {\n            if (abortResult === ABORTED) {\n                // aborted can recycle the real one\n                ARowRenderer.cleanUp(real);\n                _this.pool.push(real);\n            }\n            else {\n                // fully loaded\n                _this.body.replaceChild(real, proxy);\n            }\n            _this.loading.delete(proxy);\n            ARowRenderer.cleanUp(proxy);\n            _this.loadingPool.push(proxy);\n        }, function () {\n            // handle as aborted\n            // aborted can recycle the real one\n            ARowRenderer.cleanUp(real);\n            _this.pool.push(real);\n            _this.loading.delete(proxy);\n            ARowRenderer.cleanUp(proxy);\n            _this.loadingPool.push(proxy);\n        });\n        return proxy;\n    };\n    ARowRenderer.prototype.create = function (index) {\n        var _a = this.select(index), item = _a.item, result = _a.result;\n        var _b = this.context, ex = _b.exceptionsLookup, padding = _b.padding;\n        var exceptionHeight = ex.get(index);\n        if (exceptionHeight != null) {\n            item.style.height = exceptionHeight - padding(index) + \"px\";\n        }\n        return this.proxy(item, result);\n    };\n    ARowRenderer.prototype.removeAll = function (perform) {\n        if (perform === void 0) { perform = true; }\n        var b = this.body;\n        if (!perform) {\n            return Array.from(b.children);\n        }\n        var toRecycle = [];\n        while (b.lastElementChild) {\n            var i = b.lastElementChild;\n            b.removeChild(i);\n            this.recycle(i);\n            toRecycle.push(i);\n        }\n        return toRecycle;\n    };\n    /**\n     * triggers and visual update of all visible rows\n     */\n    ARowRenderer.prototype.update = function () {\n        var _this = this;\n        var first = this.visible.first;\n        var fragment = this.fragment;\n        var items = Array.from(this.body.children);\n        clear(this.body);\n        items.forEach(function (item, i) {\n            if (_this.loading.has(item)) {\n                // still loading\n                fragment.appendChild(item);\n                return;\n            }\n            var abort = _this.updateRow(item, i + first);\n            fragment.appendChild(_this.proxy(item, abort));\n        });\n        this.body.appendChild(fragment);\n    };\n    /**\n     * utility to execute a function for each visible row\n     * @param {(row: HTMLElement, rowIndex: number) => void} callback callback to execute\n     * @param {boolean} inPlace whether the DOM changes should be performed in place instead of in a fragment\n     */\n    ARowRenderer.prototype.forEachRow = function (callback, inPlace) {\n        var _this = this;\n        if (inPlace === void 0) { inPlace = false; }\n        var rows = Array.from(this.body.children);\n        var fragment = this.fragment;\n        if (!inPlace) {\n            clear(this.body);\n        }\n        rows.forEach(function (row, index) {\n            if (!isLoadingCell(row) && row.dataset.animation !== 'update_remove' && row.dataset.animation !== 'hide') {\n                // skip loading ones and temporary ones\n                callback(row, index + _this.visible.first);\n            }\n            if (!inPlace) {\n                fragment.appendChild(row);\n            }\n        });\n        if (!inPlace) {\n            this.body.appendChild(fragment);\n        }\n    };\n    ARowRenderer.prototype.removeFromBeginning = function (from, to, perform) {\n        if (perform === void 0) { perform = true; }\n        return this.remove(from, to, true, perform);\n    };\n    ARowRenderer.prototype.removeFromBottom = function (from, to, perform) {\n        if (perform === void 0) { perform = true; }\n        return this.remove(from, to, false, perform);\n    };\n    ARowRenderer.prototype.remove = function (from, to, fromBeginning, perform) {\n        if (perform === void 0) { perform = true; }\n        if (to < from) {\n            return [];\n        }\n        var b = this.body;\n        var toRecycle = [];\n        // console.log('remove', fromBeginning, (to - from) + 1, this.body.childElementCount - ((to - from) + 1));\n        var act = (fromBeginning ? b.firstChild : b.lastChild);\n        for (var i = from; i <= to; i += 1) {\n            var item = act;\n            act = (fromBeginning ? act.nextSibling : act.previousSibling);\n            if (perform) {\n                b.removeChild(item);\n                this.recycle(item);\n            }\n            toRecycle.push(item);\n        }\n        return toRecycle;\n    };\n    ARowRenderer.prototype.addAtBeginning = function (from, to, perform) {\n        if (perform === void 0) { perform = true; }\n        if (to < from) {\n            return null;\n        }\n        // console.log('add', (to - from) + 1, this.body.childElementCount + ((to - from) + 1));\n        var fragment = this.fragment;\n        if (from === to && perform) {\n            this.body.insertBefore(this.create(from), this.body.firstChild);\n            return null;\n        }\n        for (var i = from; i <= to; i += 1) {\n            fragment.appendChild(this.create(i));\n        }\n        if (perform) {\n            this.body.insertBefore(fragment, this.body.firstChild);\n        }\n        return fragment;\n    };\n    ARowRenderer.prototype.addAtBottom = function (from, to, perform) {\n        if (perform === void 0) { perform = true; }\n        if (to < from) {\n            return null;\n        }\n        // console.log('add_b', (to - from) + 1, this.body.childElementCount + ((to - from) + 1));\n        if (from === to && perform) {\n            this.body.appendChild(this.create(from));\n            return null;\n        }\n        var fragment = this.fragment;\n        for (var i = from; i <= to; i += 1) {\n            fragment.appendChild(this.create(i));\n        }\n        if (perform) {\n            this.body.appendChild(fragment);\n        }\n        return fragment;\n    };\n    ARowRenderer.prototype.updateOffset = function (firstRowPos) {\n        this.visibleFirstRowPos = firstRowPos;\n        this.updateSizer(firstRowPos);\n    };\n    ARowRenderer.prototype.updateSizer = function (firstRowPos) {\n        var totalHeight = this.context.totalHeight;\n        setTransform(this.body, 0, firstRowPos.toFixed(0));\n        setTransform(this.bodySizer, 0, Math.max(0, totalHeight - 1).toFixed(0));\n    };\n    /**\n     * removes all rows and recreates the table\n     * @param {IAnimationContext} ctx optional animation context to create a transition between the previous and the current tables\n     * @returns {void} nothing\n     */\n    ARowRenderer.prototype.recreate = function (ctx) {\n        this.abortAnimation();\n        if (ctx) {\n            return this.recreateAnimated(ctx);\n        }\n        return this.recreatePure();\n    };\n    ARowRenderer.prototype.recreatePure = function () {\n        var context = this.context;\n        var scroller = this.bodyScroller;\n        // update first to avoid resetting scrollTop\n        this.updateOffset(0);\n        this.removeAll();\n        this.clearPool();\n        var _a = range(scroller.scrollTop, scroller.clientHeight, context.defaultRowHeight, context.exceptions, context.numberOfRows), first = _a.first, last = _a.last, firstRowPos = _a.firstRowPos;\n        this.visible.first = first;\n        this.visible.forcedFirst = first;\n        this.visible.last = last;\n        this.visible.forcedLast = last;\n        if (first < 0) {\n            // empty\n            this.updateOffset(0);\n            return;\n        }\n        this.addAtBottom(first, last);\n        this.updateOffset(firstRowPos);\n    };\n    ARowRenderer.prototype.recreateAnimated = function (ctx) {\n        var _this = this;\n        var lookup = new Map();\n        var prev = new KeyFinder(ctx.previous, ctx.previousKey);\n        var cur = new KeyFinder(this.context, ctx.currentKey);\n        var next = range(this.bodyScroller.scrollTop, this.bodyScroller.clientHeight, cur.context.defaultRowHeight, cur.context.exceptions, cur.context.numberOfRows);\n        {\n            var rows_1 = Array.from(this.body.children);\n            var old = __assign({}, this.visible);\n            // store the current rows in a lookup and clear\n            clear(this.body);\n            prev.positions(old.first, Math.min(old.last, old.first + rows_1.length), this.visibleFirstRowPos, function (i, key, pos) {\n                var n = rows_1[i];\n                if (n) {\n                    // shouldn't happen that it is not there\n                    lookup.set(key, { n: n, pos: pos, i: i });\n                }\n                // else {\n                //  console.error(i, key, pos, rows);\n                // }\n            });\n        }\n        this.visible.first = next.first;\n        this.visible.forcedFirst = next.first;\n        this.visible.last = next.last;\n        this.visible.forcedLast = next.last;\n        var fragment = this.fragment;\n        var animation = [];\n        var nodeY = next.firstRowPos;\n        cur.positions(next.first, next.last, next.firstRowPos, function (i, key, pos) {\n            var node;\n            var mode = EAnimationMode.UPDATE;\n            var previous;\n            var item = lookup.get(key);\n            if (item != null) {\n                // still visible\n                lookup.delete(key);\n                // update height\n                item.n.dataset.index = String(i);\n                node = _this.proxy(item.n, _this.updateRow(item.n, i));\n                previous = {\n                    index: item.i,\n                    y: item.pos,\n                    height: prev.exceptionHeightOf(item.i, true),\n                };\n            }\n            else {\n                // need a new row\n                var old = prev.posByKey(key);\n                // maybe not visible  before so keep in place\n                node = _this.create(i);\n                mode = old.index < 0 ? EAnimationMode.SHOW : EAnimationMode.UPDATE_CREATE;\n                previous = {\n                    index: old.index,\n                    y: old.pos >= 0 ? old.pos : pos,\n                    height: old.index < 0 ? cur.exceptionHeightOf(i, true) : prev.exceptionHeightOf(old.index, true),\n                };\n            }\n            animation.push({\n                node: node,\n                key: key,\n                mode: mode,\n                previous: previous,\n                nodeY: nodeY,\n                nodeYCurrentHeight: pos,\n                current: {\n                    index: i,\n                    y: pos,\n                    height: cur.exceptionHeightOf(i),\n                },\n            });\n            node.style.transform = \"translate(0, \" + (nodeY - pos) + \"px)\";\n            nodeY += previous.height + (previous.index < 0 ? cur.padding(i) : prev.padding(previous.index));\n            fragment.appendChild(node);\n        });\n        var nodeYCurrentHeight = next.endPos;\n        // items that are going to be removed\n        lookup.forEach(function (item, key) {\n            // calculate their next position\n            var r = cur.posByKey(key);\n            // maybe not visible anymore, keep in place\n            var nextPos = r.pos >= 0 ? r.pos : item.pos;\n            var node = item.n;\n            // located at addedPos\n            // should end up at nextPos\n            // was previously at item.pos\n            node.style.transform = \"translate(0, \" + (item.pos - nodeY) + \"px)\";\n            fragment.appendChild(node);\n            var prevHeight = prev.exceptionHeightOf(item.i, true);\n            animation.push({\n                node: item.n,\n                key: key,\n                mode: r.index < 0 ? EAnimationMode.HIDE : EAnimationMode.UPDATE_REMOVE,\n                previous: {\n                    index: item.i,\n                    y: item.pos,\n                    height: prevHeight,\n                },\n                nodeY: nodeY,\n                nodeYCurrentHeight: nodeYCurrentHeight,\n                current: {\n                    index: r.index,\n                    y: nextPos,\n                    height: r.index < 0 ? null : cur.exceptionHeightOf(r.index),\n                },\n            });\n            nodeYCurrentHeight +=\n                r.index < 0 ? cur.context.defaultRowHeight : cur.exceptionHeightOf(r.index, true) + cur.padding(r.index);\n            nodeY += prevHeight + prev.padding(item.i);\n        });\n        this.updateOffset(next.firstRowPos);\n        this.animate(animation, ctx.phases || defaultPhases, prev, cur, fragment);\n    };\n    ARowRenderer.prototype.animate = function (animation, phases, previousFinder, currentFinder, fragment) {\n        var _this = this;\n        var activeAnimation = animation;\n        if (activeAnimation.length <= 0) {\n            this.body.appendChild(fragment);\n            return;\n        }\n        var currentTimer = -1;\n        var actPhase = 0;\n        var executePhase = function (phase, items) {\n            if (items === void 0) { items = activeAnimation; }\n            items.forEach(function (anim) { return phase.apply(anim, previousFinder, currentFinder); });\n        };\n        var run = function () {\n            // dummy log for forcing dom update\n            // eslint-disable-next-line no-console\n            console.assert(activeAnimation[0].node.offsetTop >= 0, 'dummy log for forcing dom update');\n            executePhase(phases[actPhase]);\n            actPhase += 1;\n            // shifted by one since already added through ++\n            if (actPhase < phases.length) {\n                // schedule the next one\n                var next = phases[actPhase];\n                // eslint-disable-next-line no-restricted-globals\n                currentTimer = self.setTimeout(run, next.delay);\n                return;\n            }\n            // last one\n            var body = _this.body.classList;\n            Array.from(body).forEach(function (v) {\n                if (v.startsWith(cssClass()) && v.endsWith('-animation')) {\n                    body.remove(v);\n                }\n            });\n            // clean up\n            activeAnimation.forEach(function (_a) {\n                var node = _a.node, mode = _a.mode;\n                if (mode !== EAnimationMode.UPDATE_REMOVE && mode !== EAnimationMode.HIDE) {\n                    return;\n                }\n                node.remove();\n                // eslint-disable-next-line no-param-reassign\n                node.style.transform = '';\n                _this.recycle(node);\n            });\n            _this.abortAnimation = function () { return undefined; };\n            currentTimer = -1;\n        };\n        // execute all phases having a delay of zero\n        while (phases[actPhase].delay === 0) {\n            executePhase(phases[actPhase]);\n            actPhase += 1;\n        }\n        // after the initial one\n        var body = this.body;\n        this.body.appendChild(fragment);\n        var dummyAnimation = [];\n        activeAnimation = activeAnimation.filter(function (d) {\n            if (noAnimationChange(d, previousFinder.context.defaultRowHeight, currentFinder.context.defaultRowHeight)) {\n                dummyAnimation.push(d);\n                return false;\n            }\n            return true;\n        });\n        if (dummyAnimation.length > 0) {\n            // execute all phases for them\n            phases.slice(actPhase).forEach(function (phase) { return executePhase(phase, dummyAnimation); });\n        }\n        if (activeAnimation.length === 0) {\n            return;\n        }\n        body.classList.add(CSS_CLASS_ROW_ANIMATION);\n        new Set(activeAnimation.map(function (d) { return d.mode; })).forEach(function (mode) {\n            // add class but map to UPDATE only\n            body.classList.add(cssClass(EAnimationMode[mode].toLowerCase().split('_')[0] + \"-animation\"));\n        });\n        this.abortAnimation = function () {\n            if (currentTimer <= 0) {\n                return;\n            }\n            // abort by removing\n            clearTimeout(currentTimer);\n            currentTimer = -1;\n            // run the last phase\n            actPhase = phases.length - 1;\n            run();\n        };\n        // next tick such that DOM will be updated\n        // eslint-disable-next-line no-restricted-globals\n        currentTimer = self.setTimeout(run, phases[actPhase].delay);\n    };\n    /**\n     * clears the row pool used for faster creation\n     */\n    ARowRenderer.prototype.clearPool = function () {\n        // clear pool\n        this.pool.splice(0, this.pool.length);\n    };\n    /**\n     * triggers a revalidation of the current scrolling offset\n     */\n    ARowRenderer.prototype.revalidate = function () {\n        var scroller = this.bodyScroller;\n        this.onScrolledVertically(scroller.scrollTop, scroller.clientHeight, true);\n        this.updateOffset(this.visibleFirstRowPos);\n    };\n    /**\n     * scrolling vertically\n     * @param {number} scrollTop top scrolling\n     * @param {number} clientHeight visible height\n     * @param {boolean} isGoingDown hint whether the scrollTop increases\n     * @return {EScrollResult} full in case of a full rebuild or partial update\n     */\n    ARowRenderer.prototype.onScrolledVertically = function (scrollTop, clientHeight, isGoingDown) {\n        var shift = this.options.viewportOversize;\n        var shiftTop = Math.max(0, scrollTop - shift);\n        var scrollResult = this.onScrolledImpl(shiftTop, clientHeight + shift + (scrollTop - shiftTop));\n        for (var _i = 0, _a = this.mixins; _i < _a.length; _i++) {\n            var mixin = _a[_i];\n            mixin.onScrolled(isGoingDown, scrollResult);\n        }\n        return scrollResult;\n    };\n    ARowRenderer.prototype.shiftLast = function (current, currentDelta) {\n        var b = this.options.batchSize;\n        if (currentDelta >= b) {\n            return current;\n        }\n        var total = this.context.numberOfRows;\n        return Math.min(total - 1, current + (this.options.batchSize - currentDelta));\n    };\n    ARowRenderer.prototype.shiftFirst = function (current, currentFirstRow, currentDelta) {\n        var _a;\n        var b = this.options.batchSize;\n        if (currentDelta >= b || current <= 0) {\n            return { first: current, firstRowPos: currentFirstRow };\n        }\n        var first = Math.max(0, current - (this.options.batchSize - currentDelta));\n        var _b = this.context, exceptionsLookup = _b.exceptionsLookup, defaultRowHeight = _b.defaultRowHeight;\n        var firstRowPos = currentFirstRow;\n        for (var i = first; i < current; i += 1) {\n            firstRowPos -= (_a = exceptionsLookup.get(i)) !== null && _a !== void 0 ? _a : defaultRowHeight;\n        }\n        return { first: first, firstRowPos: firstRowPos };\n    };\n    ARowRenderer.prototype.onScrolledImpl = function (scrollTop, clientHeight) {\n        var context = this.context;\n        var _a = range(scrollTop, clientHeight, context.defaultRowHeight, context.exceptions, context.numberOfRows), first = _a.first, last = _a.last, firstRowPos = _a.firstRowPos;\n        var visible = this.visible;\n        visible.forcedFirst = first;\n        visible.forcedLast = last;\n        if (first - visible.first >= 0 && last - visible.last <= 0) {\n            // nothing to do\n            return EScrollResult.NONE;\n        }\n        var r = EScrollResult.SOME;\n        var toRecycle;\n        var toAdd;\n        var toAddBottom = false;\n        if (first > visible.last || last < visible.first) {\n            // no overlap, clean and draw everything\n            // console.log(`ff added: ${last - first + 1} removed: ${visibleLast - visibleFirst + 1} ${first}:${last} ${offset}`);\n            // removeRows(visibleFirst, visibleLast);\n            toRecycle = this.removeAll(false);\n            toAdd = this.addAtBottom(first, last, false);\n            toAddBottom = true;\n            r = EScrollResult.ALL;\n        }\n        else if (first < visible.first) {\n            // some first rows missing and some last rows to much\n            // console.log(`up added: ${visibleFirst - first + 1} removed: ${visibleLast - last + 1} ${first}:${last} ${offset}`);\n            var toRemove = visible.last - (last + 1);\n            if (toRemove >= this.options.batchSize) {\n                toRecycle = this.removeFromBottom(last + 1, visible.last, false);\n            }\n            else {\n                last = visible.last;\n            }\n            var shift = this.shiftFirst(first, firstRowPos, visible.first - 1 - first);\n            first = shift.first;\n            firstRowPos = shift.firstRowPos;\n            toAdd = this.addAtBeginning(first, visible.first - 1, false);\n            toAddBottom = false;\n            r = EScrollResult.SOME_TOP;\n        }\n        else {\n            // console.log(`do added: ${last - visibleLast + 1} removed: ${first - visibleFirst + 1} ${first}:${last} ${offset}`);\n            // some last rows missing and some first rows to much\n            var toRemove = first - 1 - visible.first;\n            if (toRemove >= this.options.batchSize) {\n                toRecycle = this.removeFromBeginning(visible.first, first - 1, false);\n            }\n            else {\n                first = visible.first;\n                firstRowPos = this.visibleFirstRowPos;\n            }\n            last = this.shiftLast(last, last - visible.last + 1);\n            toAdd = this.addAtBottom(visible.last + 1, last, false);\n            toAddBottom = true;\n            r = EScrollResult.SOME_BOTTOM;\n        }\n        visible.first = first;\n        visible.last = last;\n        this.updateOffset(firstRowPos);\n        this.manipulate(toRecycle, toAdd, toAddBottom);\n        return r;\n    };\n    ARowRenderer.prototype.manipulate = function (toRecycle, toAdd, bottom) {\n        if (toRecycle) {\n            for (var _i = 0, toRecycle_1 = toRecycle; _i < toRecycle_1.length; _i++) {\n                var item = toRecycle_1[_i];\n                item.remove();\n                this.recycle(item);\n            }\n        }\n        if (!toAdd) {\n            return;\n        }\n        if (bottom) {\n            this.body.appendChild(toAdd);\n        }\n        else {\n            this.body.insertBefore(toAdd, this.body.firstChild);\n        }\n    };\n    return ARowRenderer;\n}());\nexport { ARowRenderer };\nexport default ARowRenderer;\nexport function setTransform(elem, x, y) {\n    var text = \"translate(\" + x + \"px, \" + y + \"px)\";\n    var anyElem = elem;\n    // eslint-disable-next-line no-underscore-dangle\n    if (anyElem.__transform__ === text) {\n        return;\n    }\n    // eslint-disable-next-line no-underscore-dangle\n    anyElem.__transform__ = text;\n    // eslint-disable-next-line no-param-reassign\n    elem.style.transform = text;\n}\n//# sourceMappingURL=ARowRenderer.js.map","// import manually import './style.scss';\nfunction assignStyles(target, source) {\n    var targetObj = target;\n    for (var _i = 0, _a = Object.keys(source); _i < _a.length; _i++) {\n        var key = _a[_i];\n        var v = source[key];\n        if (!v.endsWith(' !important')) {\n            if (targetObj[key] !== v) {\n                // eslint-disable-next-line no-param-reassign\n                targetObj[key] = v;\n            }\n            continue;\n        }\n        // handle special important case\n        var plain = v.slice(0, -' !important'.length);\n        if (targetObj[key] === plain) {\n            continue;\n        }\n        // eslint-disable-next-line no-param-reassign\n        targetObj[key] = plain;\n        // see https://gist.github.com/youssman/745578062609e8acac9f\n        var hyphen = key.replace(/([a-zA-Z])(?=[A-Z])/g, '$1-').toLowerCase();\n        target.setProperty(hyphen, plain, 'important');\n    }\n}\nvar StyleManager = /** @class */ (function () {\n    /**\n     * the parent element to append this managed style\n     * @param {HTMLElement} root\n     */\n    function StyleManager(root) {\n        this.rules = [];\n        this.testVerifyTimeout = -1;\n        this.node = root.ownerDocument.createElement('style');\n        this.node.appendChild(root.ownerDocument.createTextNode('')); // for webkit?\n        root.appendChild(this.node);\n    }\n    StyleManager.prototype.destroy = function () {\n        this.node.remove();\n    };\n    StyleManager.prototype.verifySheet = function () {\n        var _this = this;\n        var sheet = this.sheet;\n        if (!sheet) {\n            if (this.testVerifyTimeout >= 0) {\n                return;\n            }\n            // test till attached\n            // eslint-disable-next-line no-restricted-globals\n            this.testVerifyTimeout = self.setTimeout(function () {\n                _this.testVerifyTimeout = -1;\n                _this.verifySheet();\n            }, 20);\n            return;\n        }\n        var rules = sheet.cssRules;\n        if (rules.length === this.rules.length &&\n            this.rules.every(function (d, i) { return rules[i].selectorText === d.selector; })) {\n            // same\n            return;\n        }\n        // console.warn('invalid sheet rules detected');\n        var l = rules.length;\n        for (var i = l - 1; i >= 0; i -= 1) {\n            sheet.deleteRule(i);\n        }\n        // create all\n        for (var _i = 0, _a = this.rules; _i < _a.length; _i++) {\n            var rule = _a[_i];\n            var index = sheet.insertRule(rule.selector + \" {}\", sheet.cssRules.length);\n            var cssRule = sheet.cssRules[index];\n            rule.selector = cssRule.selectorText;\n            assignStyles(cssRule.style, rule.style);\n        }\n    };\n    Object.defineProperty(StyleManager.prototype, \"sheet\", {\n        get: function () {\n            return this.node.sheet;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    StyleManager.prototype.getSheetRule = function (index) {\n        var sheet = this.sheet;\n        return sheet ? sheet.cssRules[index] : null;\n    };\n    /**\n     * add a custom css rule\n     * @param {string} id unique id of the rule for later identification\n     * @param {string} selector the css selector\n     * @param {Partial<CSSStyleDeclaration>} style the style attributes\n     * @returns {string} the id again\n     */\n    StyleManager.prototype.addRule = function (id, selector, style) {\n        this.verifySheet();\n        var sheet = this.sheet;\n        if (!sheet) {\n            // upon next update\n            this.rules.push({ id: id, selector: selector, style: style });\n            return null;\n        }\n        var index = sheet.insertRule(selector + \" {}\", sheet.cssRules.length);\n        var rule = sheet.cssRules[index];\n        this.rules.push({ id: id, selector: rule.selectorText, style: style });\n        assignStyles(rule.style, style);\n        return id;\n    };\n    /**\n     * updates or add a rule, see @addRule\n     * @param {string} id unique id of the rule for later identification\n     * @param {string} selector the css selector\n     * @param {Partial<CSSStyleDeclaration>} style the style attributes\n     * @returns {string} the id again\n     */\n    StyleManager.prototype.updateRule = function (id, selector, style) {\n        this.verifySheet();\n        var index = this.rules.findIndex(function (d) { return d.id === id; });\n        if (index < 0) {\n            return this.addRule(id, selector, style);\n        }\n        var stored = this.rules[index];\n        stored.selector = selector;\n        stored.style = style;\n        var rule = this.getSheetRule(index);\n        if (rule) {\n            if (rule.selectorText.replace(/\\s/gm, '') !== selector.replace(/\\s/gm, '')) {\n                // ignoring white space\n                rule.selectorText = selector;\n                stored.selector = rule.selectorText;\n            }\n            assignStyles(rule.style, style);\n        }\n        return id;\n    };\n    /**\n     * deletes the given rule by id\n     * @param {string} id the rule to delete\n     */\n    StyleManager.prototype.deleteRule = function (id) {\n        this.verifySheet();\n        var index = this.rules.findIndex(function (d) { return d.id === id; });\n        if (index < 0) {\n            return;\n        }\n        this.rules.splice(index, 1);\n        var sheet = this.sheet;\n        if (sheet) {\n            sheet.deleteRule(index);\n        }\n    };\n    Object.defineProperty(StyleManager.prototype, \"ruleNames\", {\n        /**\n         * get a list of all registered rule ids\n         */\n        get: function () {\n            return this.rules.map(function (d) { return d.id; });\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return StyleManager;\n}());\nexport default StyleManager;\n//# sourceMappingURL=StyleManager.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { addScroll } from '../internal';\nimport { cssClass, CSS_CLASS_BODY, CSS_CLASS_FOOTER, CSS_CLASS_HEADER, CSS_CLASS_SCROLLBAR_TESTER, CSS_CLASS_SHIFTED, CSS_CLASS_TBODY, CSS_CLASS_THEAD, } from '../styles';\nimport StyleManager from './StyleManager';\nexport function setTemplate(root, id) {\n    var cleanId = id.startsWith('#') ? id.slice(1) : id;\n    // eslint-disable-next-line no-param-reassign\n    root.innerHTML = \"\\n  <header id=\\\"header-\" + cleanId + \"\\\" class=\\\"\" + CSS_CLASS_HEADER + \" \" + cssClass(\"header-\" + cleanId) + \"\\\">\\n    <article class=\\\"\" + CSS_CLASS_THEAD + \" \" + cssClass(\"thead-\" + cleanId) + \"\\\"></article>\\n  </header>\\n  <main id=\\\"body-\" + cleanId + \"\\\" class=\\\"\" + CSS_CLASS_BODY + \" \" + cssClass(\"body-\" + cleanId) + \"\\\">\\n    <footer class=\\\"\" + CSS_CLASS_FOOTER + \"\\\">&nbsp;</footer>\\n    <article class=\\\"\" + CSS_CLASS_TBODY + \" \" + cssClass(\"tbody-\" + cleanId) + \"\\\"></article>\\n  </main>\";\n    return root;\n}\n/**\n * generates the HTML Ids used for the header and body article of a table\n * @param {string} tableId base table id\n * @param {boolean} asSelector flag whether to prepend with # for CSS selector\n * @return {ISelectors} the table ids used for header and body\n */\nexport function tableIds(tableId) {\n    return {\n        thead: \"thead-\" + tableId,\n        tbody: \"tbody-\" + tableId,\n        tr: \"tr-\" + tableId,\n        th: \"th-\" + tableId,\n        td: \"td-\" + tableId,\n    };\n}\nexport function tableCSSClasses(tableId) {\n    var ids = tableIds(tableId);\n    return {\n        thead: cssClass(ids.thead),\n        tbody: cssClass(ids.tbody),\n        tr: cssClass(ids.tr),\n        th: cssClass(ids.th),\n        td: cssClass(ids.td),\n    };\n}\n/**\n * utility for custom generated CSS rules with a focus on dynamically generated grid layouts\n */\nvar GridStyleManager = /** @class */ (function (_super) {\n    __extends(GridStyleManager, _super);\n    function GridStyleManager(root, id) {\n        var _this = _super.call(this, root) || this;\n        _this.id = id.startsWith('#') ? id.slice(1) : id;\n        _this.ids = tableIds(_this.id);\n        _this.cssClasses = tableCSSClasses(_this.id);\n        var headerScroller = root.getElementsByTagName('header')[0];\n        var bodyScroller = root.getElementsByTagName('main')[0];\n        // async since style needs to be added to dom first\n        // eslint-disable-next-line no-restricted-globals\n        self.setTimeout(function () {\n            var width = measureScrollbar(root).width;\n            _this.updateRule('__scrollBarFix2', \"#header-\" + _this.id + \" > article:last-of-type\", {\n                borderRight: width + \"px solid transparent\",\n            });\n        }, 20);\n        var old = headerScroller.scrollLeft;\n        // update frozen and sync header with body\n        addScroll(bodyScroller, 'animation', function (act) {\n            var newValue = act.left;\n            if (old !== newValue) {\n                headerScroller.scrollLeft = newValue;\n                old = newValue;\n            }\n            root.classList.toggle(CSS_CLASS_SHIFTED, act.left > 0);\n        });\n        return _this;\n    }\n    /**\n     * updates the column widths and default row height for a table\n     * @param {number} defaultRowHeight\n     * @param {IColumn[]} columns\n     * @param {number} frozenShift shift frozen columns\n     * @param {string} tableId optional tableId in case of multiple tables within the same engine\n     * @param {string} unit\n     */\n    GridStyleManager.prototype.update = function (defaultRowHeight, columns, padding, frozenShift, tableId, unit) {\n        if (unit === void 0) { unit = 'px'; }\n        var ids = tableIds(tableId);\n        var selectors = tableCSSClasses(tableId);\n        var total = \"\" + columns.reduce(function (a, b, i) { return a + b.width + padding(i); }, 0) + unit;\n        this.updateRule(\"__heightsRule\" + selectors.tr, \".\" + selectors.tr, {\n            height: defaultRowHeight + \"px\",\n            width: total,\n        });\n        this.updateRule(\"__heightsRule\" + selectors.tbody, \"#\" + ids.tbody, {\n            width: total,\n        });\n        this.updateColumns(columns, padding, selectors, frozenShift, unit);\n    };\n    /**\n     * removes a given tableId if not needed anymore\n     * @param {string} tableId tableId to remove\n     */\n    GridStyleManager.prototype.remove = function (tableId) {\n        var selectors = tableCSSClasses(tableId);\n        this.deleteRule(\"__heightsRule\" + selectors.tr);\n        this.deleteRule(\"__heightsRule\" + selectors.tbody);\n        var prefix = \"__col\" + selectors.td + \"_\";\n        var rules = this.ruleNames.reduce(function (a, b) { return a + (b.startsWith(prefix) ? 1 : 0); }, 0);\n        // reset\n        for (var i = 0; i < rules; i += 1) {\n            this.deleteRule(\"\" + prefix + i);\n        }\n    };\n    GridStyleManager.prototype.updateColumns = function (columns, padding, cssSelectors, frozenShift, unit) {\n        var _this = this;\n        if (unit === void 0) { unit = 'px'; }\n        var prefix = \"__col\" + cssSelectors.td + \"_\";\n        var rules = new Set(this.ruleNames.filter(function (d) { return d.startsWith(prefix); }));\n        var acc = 0;\n        columns.forEach(function (c, i) {\n            var th = \".\" + cssSelectors.th + \"[data-id=\\\"\" + c.id + \"\\\"]\";\n            var thStyles = {\n                width: \"\" + c.width + unit,\n            };\n            var td = \".\" + cssSelectors.td + \"[data-id=\\\"\" + c.id + \"\\\"]\";\n            var tdStyles = {\n                transform: \"translateX(\" + acc + unit + \")\",\n                width: \"\" + c.width + unit,\n            };\n            if (c.frozen) {\n                thStyles.left = acc + \"px\";\n                _this.updateRule(\"\" + prefix + td + \"F\", \".\" + cssSelectors.td + \".\" + CSS_CLASS_SHIFTED + \"[data-id=\\\"\" + c.id + \"\\\"]\", {\n                    transform: \"translateX(0)\",\n                    left: \"\" + (acc + frozenShift) + unit,\n                });\n                rules.delete(\"\" + prefix + td + \"F\");\n            }\n            _this.updateRule(\"\" + prefix + th, th, thStyles);\n            rules.delete(\"\" + prefix + th);\n            _this.updateRule(\"\" + prefix + td, td, tdStyles);\n            rules.delete(\"\" + prefix + td);\n            acc += c.width + padding(i);\n        });\n        rules.forEach(function (d) { return _this.deleteRule(d); });\n    };\n    return GridStyleManager;\n}(StyleManager));\nexport default GridStyleManager;\n/**\n * measure the width and height of the scrollbars\n * based on Slick grid implementation\n * @param root\n */\nfunction measureScrollbar(root) {\n    var _a;\n    var body = (_a = root.ownerDocument) === null || _a === void 0 ? void 0 : _a.body;\n    if (!body) {\n        return { width: 10, height: 10 };\n    }\n    body.insertAdjacentHTML('beforeend', \"<div class=\\\"\" + CSS_CLASS_SCROLLBAR_TESTER + \"\\\"><div></div></div>\");\n    var elem = body.lastElementChild;\n    var width = elem.offsetWidth - elem.clientWidth;\n    var height = elem.offsetHeight - elem.clientHeight;\n    elem.remove();\n    return { width: width, height: height };\n}\n//# sourceMappingURL=GridStyleManager.js.map","var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport { setTransform } from '../ARowRenderer';\nimport { addScroll, defaultMode } from '../internal';\nimport { GridStyleManager, tableCSSClasses, tableIds } from '../style';\nimport { cssClass, CSS_CLASS_BODY, CSS_CLASS_FOOTER, CSS_CLASS_HEADER, CSS_CLASS_MULTI, CSS_CLASS_TBODY, CSS_CLASS_THEAD, } from '../styles';\n/**\n * manager of multiple columns separated by separators each an own row renderer\n */\nvar MultiTableRowRenderer = /** @class */ (function () {\n    function MultiTableRowRenderer(node, htmlId, options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        this.node = node;\n        this.tableId = 0;\n        this.sections = [];\n        this.options = {\n            columnPadding: 0,\n            async: defaultMode,\n            minScrollDelta: 30,\n        };\n        Object.assign(this.options, options);\n        var cleanHTMLId = htmlId.startsWith('#') ? htmlId.slice(1) : htmlId;\n        // eslint-disable-next-line no-param-reassign\n        node.id = cleanHTMLId;\n        // eslint-disable-next-line no-param-reassign\n        node.innerHTML = \"<header id=\\\"header-\" + cleanHTMLId + \"\\\" class=\\\"\" + CSS_CLASS_HEADER + \" \" + cssClass(\"header-\" + cleanHTMLId) + \"\\\">\\n      <footer class=\\\"\" + CSS_CLASS_FOOTER + \" \" + cssClass(\"footer-\" + cleanHTMLId) + \"\\\">&nbsp;</footer>\\n    </header>\\n    <main id=\\\"body-\" + cleanHTMLId + \"\\\" class=\\\"\" + CSS_CLASS_BODY + \" \" + cssClass(\"body-\" + cleanHTMLId) + \"\\\">\\n      <footer class=\\\"\" + CSS_CLASS_FOOTER + \"\\\">&nbsp;</footer>\\n    </main>\";\n        node.classList.add(cssClass(), CSS_CLASS_MULTI, 'lineup-engine');\n        this.style = new GridStyleManager(this.node, cleanHTMLId);\n        var old = addScroll(this.main, this.options.async, function (act) {\n            if (Math.abs(old.left - act.left) < _this.options.minScrollDelta &&\n                Math.abs(old.width - act.width) < _this.options.minScrollDelta) {\n                return;\n            }\n            var isGoingRight = act.left > old.left;\n            old = act;\n            _this.onScrolledHorizontally(act.left, act.width, isGoingRight);\n        });\n    }\n    MultiTableRowRenderer.prototype.update = function () {\n        var _this = this;\n        this.onScrolledHorizontally(this.main.scrollLeft, this.main.clientWidth, false);\n        var offset = 0;\n        this.sections.forEach(function (s) {\n            // eslint-disable-next-line no-param-reassign\n            s.body.style.left = offset + \"px\";\n            // eslint-disable-next-line no-param-reassign\n            s.header.style.left = offset + \"px\";\n            offset += s.width + _this.options.columnPadding;\n        });\n    };\n    MultiTableRowRenderer.prototype.onScrolledHorizontally = function (scrollLeft, clientWidth, isGoingRight) {\n        var _this = this;\n        var offset = 0;\n        var scrollEnd = scrollLeft + clientWidth;\n        this.sections.forEach(function (s) {\n            var end = offset + s.width;\n            if (end < scrollLeft || offset > scrollEnd) {\n                s.hide();\n            }\n            else {\n                s.show(Math.max(0, scrollLeft - offset), Math.min(scrollEnd - offset, s.width), isGoingRight);\n            }\n            offset = end + _this.options.columnPadding;\n        });\n        this.updateOffset();\n    };\n    MultiTableRowRenderer.prototype.updateOffset = function () {\n        var _this = this;\n        var headerFooter = this.header.getElementsByTagName('footer')[0];\n        var bodyFooter = this.main.getElementsByTagName('footer')[0];\n        var maxHeight = this.sections.reduce(function (acc, d) { return Math.max(acc, d.height); }, 0);\n        var total = this.sections.reduce(function (a, c) { return a + c.width + _this.options.columnPadding; }, 0);\n        setTransform(headerFooter, total, 0);\n        setTransform(bodyFooter, total, maxHeight);\n    };\n    MultiTableRowRenderer.prototype.destroy = function () {\n        this.sections.forEach(function (d) { return d.destroy(); });\n        this.node.remove();\n    };\n    Object.defineProperty(MultiTableRowRenderer.prototype, \"doc\", {\n        get: function () {\n            return this.node.ownerDocument;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(MultiTableRowRenderer.prototype, \"header\", {\n        get: function () {\n            return this.node.getElementsByTagName('header')[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(MultiTableRowRenderer.prototype, \"main\", {\n        get: function () {\n            return this.node.getElementsByTagName('main')[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * push another table to this instance\n     * @param {ITableFactory<T extends ITableSection>} factory factory for the table\n     * @param extras additional arguments to provide for the factory\n     * @returns {T} the table instance\n     */\n    MultiTableRowRenderer.prototype.pushTable = function (factory) {\n        var extras = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            extras[_i - 1] = arguments[_i];\n        }\n        var header = this.doc.createElement('article');\n        var body = this.doc.createElement('article');\n        var tableId = this.node.id + \"T\" + this.tableId;\n        this.tableId += 1;\n        var ids = tableIds(tableId);\n        var cssClasses = tableCSSClasses(tableId);\n        header.id = ids.thead;\n        header.classList.add(CSS_CLASS_THEAD, cssClasses.thead);\n        body.id = ids.tbody;\n        body.classList.add(CSS_CLASS_TBODY, cssClasses.tbody);\n        this.header.insertBefore(header, this.header.lastElementChild); // before the footer\n        this.main.appendChild(body);\n        var table = factory.call.apply(factory, __spreadArray([this, header, body, tableId, this.style], extras, false));\n        table.init();\n        this.sections.push(table);\n        this.update();\n        return table;\n    };\n    /**\n     * push another separator to the manager\n     * @param {ISeparatorFactory<T extends ITableSection>} factory the factory to create the separator\n     * @param extras optional additional arguments\n     * @returns {T} the new created separator\n     */\n    MultiTableRowRenderer.prototype.pushSeparator = function (factory) {\n        var extras = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            extras[_i - 1] = arguments[_i];\n        }\n        var header = this.doc.createElement('section');\n        var body = this.doc.createElement('section');\n        header.classList.add(cssClass('header-separator'));\n        body.classList.add(cssClass('separator'));\n        this.header.insertBefore(header, this.header.lastElementChild); // before the footer\n        this.main.appendChild(body);\n        var separator = factory.call.apply(factory, __spreadArray([this, header, body, this.style], extras, false));\n        separator.init();\n        this.sections.push(separator);\n        this.update();\n        return separator;\n    };\n    /**\n     * removes a given table section\n     * @param {ITableSection} section section to remove\n     * @returns {boolean} successful flag\n     */\n    MultiTableRowRenderer.prototype.remove = function (section) {\n        var index = this.sections.indexOf(section);\n        if (index < 0) {\n            return false;\n        }\n        this.sections.splice(index, 1);\n        section.destroy();\n        this.update();\n        return true;\n    };\n    MultiTableRowRenderer.prototype.clear = function () {\n        this.sections.splice(0, this.sections.length).forEach(function (s) { return s.destroy(); });\n        this.update();\n    };\n    /**\n     * triggers and update because of a change in width of one or more table sections\n     */\n    MultiTableRowRenderer.prototype.widthChanged = function () {\n        this.update();\n    };\n    return MultiTableRowRenderer;\n}());\nexport default MultiTableRowRenderer;\n//# sourceMappingURL=MultiTableRowRenderer.js.map","/**\n * caches parsing of html strings in a dom element cache\n * @param doc the doc to create the elements under\n * @internal\n */\nexport default function domElementCache(doc: Document): (html: string) => HTMLElement {\n  const cache = new Map<string, HTMLElement>();\n\n  const helper = doc.createElement('div');\n\n  return (html: string) => {\n    if (cache.has(html)) {\n      return cache.get(html)!.cloneNode(true) as HTMLElement;\n    }\n\n    helper.innerHTML = html;\n    const node = helper.firstElementChild! as HTMLElement;\n    // keep a copy\n    cache.set(html, node.cloneNode(true) as HTMLElement);\n\n    return node;\n  };\n}\n\nexport function createSanitizer(doc: Document): (v: string) => string {\n  // prepare variables\n  // based on https://stackoverflow.com/questions/24816/escaping-html-strings-with-jquery/17546215#17546215\n  const textNode = doc.createTextNode('');\n  const wrapper = doc.createElement('div');\n  wrapper.appendChild(textNode);\n\n  return (v: string) => {\n    if (!v) {\n      return '';\n    }\n    textNode.nodeValue = v;\n    return wrapper.innerHTML;\n  };\n}\n","import { range } from '../logic';\nimport { EScrollResult } from './IMixin';\n/**\n * mixin that prefetches rows depending on the scrolling direction for faster rendering\n */\nvar PrefetchMixin = /** @class */ (function () {\n    function PrefetchMixin(adapter, options) {\n        this.adapter = adapter;\n        this.prefetchTimeout = -1;\n        this.cleanupTimeout = -1;\n        this.options = {\n            prefetchRows: 20,\n            cleanUpRows: 10,\n            delay: 200,\n        };\n        Object.assign(this.options, options);\n        return this;\n    }\n    PrefetchMixin.prototype.prefetchDown = function () {\n        this.prefetchTimeout = -1;\n        if (this.adapter.isScrollEventWaiting()) {\n            return;\n        }\n        var context = this.adapter.context;\n        var nextLast = Math.min(this.adapter.visible.forcedLast + this.options.prefetchRows, context.numberOfRows - 1);\n        // add some rows in advance\n        if (this.adapter.visible.last === nextLast &&\n            this.adapter.visible.last >= this.adapter.visible.forcedLast + this.options.prefetchRows) {\n            return;\n        }\n        this.adapter.addAtBottom(this.adapter.visible.last + 1, nextLast);\n        // console.log('prefetch', visibleFirst, visibleLast + 1, '=>', nextLast, ranking.children.length);\n        this.adapter.visible.last = nextLast;\n    };\n    PrefetchMixin.prototype.prefetchUp = function () {\n        this.prefetchTimeout = -1;\n        if (this.adapter.isScrollEventWaiting() ||\n            this.adapter.visible.first <= this.adapter.visible.forcedFirst - this.options.prefetchRows) {\n            return;\n        }\n        var context = this.adapter.context;\n        var fakeOffset = Math.max(this.adapter.scrollOffset - this.options.prefetchRows * context.defaultRowHeight, 0);\n        var height = this.adapter.scrollTotal;\n        var _a = range(fakeOffset, height, context.defaultRowHeight, context.exceptions, context.numberOfRows), first = _a.first, firstRowPos = _a.firstRowPos;\n        if (first === this.adapter.visible.first) {\n            return;\n        }\n        var frozenShift = this.adapter.syncFrozen ? this.adapter.syncFrozen(first) : 0;\n        this.adapter.addAtBeginning(first, this.adapter.visible.first - 1, frozenShift);\n        // console.log('prefetch up ', visibleFirst, '=>', first, visibleLast, ranking.children.length);\n        this.adapter.visible.first = first;\n        this.adapter.updateOffset(firstRowPos);\n    };\n    PrefetchMixin.prototype.triggerPrefetch = function (isGoingDown) {\n        if (this.prefetchTimeout >= 0) {\n            clearTimeout(this.prefetchTimeout);\n        }\n        var prefetchDownPossible = this.adapter.visible.last < this.adapter.visible.forcedLast + this.options.prefetchRows;\n        var prefetchUpPossible = this.adapter.visible.first > this.adapter.visible.forcedFirst - this.options.prefetchRows;\n        var isLast = this.adapter.visible.last === this.adapter.context.numberOfRows;\n        var isFirst = this.adapter.visible.first === 0;\n        if ((isGoingDown && !prefetchDownPossible && !isLast) || (!isGoingDown && !prefetchUpPossible && !isFirst)) {\n            return;\n        }\n        // go down if we are already at the top, too\n        var op = isGoingDown || isFirst ? this.prefetchDown.bind(this) : this.prefetchUp.bind(this);\n        // eslint-disable-next-line no-restricted-globals\n        this.prefetchTimeout = self.setTimeout(op, this.options.delay);\n    };\n    PrefetchMixin.prototype.cleanUpTop = function (first) {\n        this.cleanupTimeout = -1;\n        if (this.adapter.isScrollEventWaiting()) {\n            return;\n        }\n        var newFirst = Math.max(0, first - this.options.cleanUpRows);\n        if (newFirst <= this.adapter.visible.first) {\n            return;\n        }\n        // console.log('cleanup top');\n        var frozenShift = this.adapter.syncFrozen ? this.adapter.syncFrozen(newFirst) : 0;\n        this.adapter.removeFromBeginning(this.adapter.visible.first, newFirst - 1, frozenShift);\n        var context = this.adapter.context;\n        // console.log('cleanup up ', visibleFirst, '=>', newFirst, visibleLast, ranking.children.length);\n        var shift = (newFirst - this.adapter.visible.first) * context.defaultRowHeight;\n        if (context.exceptions.length > 0) {\n            for (var i = this.adapter.visible.first; i < newFirst; i += 1) {\n                var ex = context.exceptionsLookup.get(i);\n                if (ex != null) {\n                    shift += ex - context.defaultRowHeight;\n                }\n            }\n        }\n        this.adapter.visible.first = newFirst;\n        this.adapter.updateOffset(this.adapter.visibleFirstRowPos + shift);\n        this.prefetchDown();\n    };\n    PrefetchMixin.prototype.cleanUpBottom = function (last) {\n        this.cleanupTimeout = -1;\n        var newLast = last + this.options.cleanUpRows;\n        if (this.adapter.visible.last <= newLast) {\n            return;\n        }\n        // console.log('cleanup bottom');\n        this.adapter.removeFromBottom(newLast + 1, this.adapter.visible.last);\n        this.adapter.visible.last = newLast;\n        this.prefetchUp();\n    };\n    PrefetchMixin.prototype.triggerCleanUp = function (first, last, isGoingDown) {\n        if (this.cleanupTimeout >= 0) {\n            clearTimeout(this.cleanupTimeout);\n        }\n        if ((isGoingDown && first - this.options.cleanUpRows <= this.adapter.visible.first) ||\n            (!isGoingDown && this.adapter.visible.last <= last + this.options.cleanUpRows)) {\n            return;\n        }\n        // eslint-disable-next-line no-restricted-globals\n        this.cleanupTimeout = self.setTimeout(isGoingDown ? this.cleanUpTop.bind(this) : this.cleanUpBottom.bind(this), this.options.delay, isGoingDown ? first : last);\n    };\n    PrefetchMixin.prototype.onScrolled = function (isGoingDown, scrollResult) {\n        if (this.adapter.isScrollEventWaiting()) {\n            return;\n        }\n        if (scrollResult !== EScrollResult.ALL && this.options.cleanUpRows > 0) {\n            this.triggerCleanUp(this.adapter.visible.forcedFirst, this.adapter.visible.forcedLast, isGoingDown);\n        }\n        if (scrollResult !== EScrollResult.NONE && this.options.prefetchRows > 0) {\n            this.triggerPrefetch(isGoingDown);\n        }\n    };\n    return PrefetchMixin;\n}());\nexport default PrefetchMixin;\n//# sourceMappingURL=PrefetchMixin.js.map","import { ABORTED, isAbortAble, isAsyncUpdate } from '../../abortAble';\nimport { isLoadingCell } from '../../ARowRenderer';\nimport { clear } from '../../internal';\nimport { isScrollEventWaiting } from '../../internal/scroll';\nimport { range, updateFrozen } from '../../logic';\nimport { EScrollResult } from '../../mixin';\nimport { cssClass, CSS_CLASS_FROZEN, CSS_CLASS_LOADING, CSS_CLASS_SHIFTED, CSS_CLASS_TD, CSS_CLASS_TH, } from '../../styles';\n/**\n * @internal\n */\nvar ACellAdapter = /** @class */ (function () {\n    function ACellAdapter(header, style, tableId, mixinClasses) {\n        var _this = this;\n        if (mixinClasses === void 0) { mixinClasses = []; }\n        this.header = header;\n        this.style = style;\n        this.tableId = tableId;\n        /**\n         * pool of cells per column\n         * @type {Array}\n         */\n        this.cellPool = [];\n        this.loading = new WeakMap();\n        this.visibleColumns = {\n            frozen: [],\n            first: 0,\n            forcedFirst: 0,\n            last: -1,\n            forcedLast: -1,\n        };\n        this.visibleFirstColumnPos = 0;\n        this.horizontallyShifted = false;\n        this.columnAdapter = this.createColumnAdapter();\n        this.columnMixins = mixinClasses.map(function (MixinClass) { return new MixinClass(_this.columnAdapter); });\n        this.columnFragment = header.ownerDocument.createDocumentFragment();\n    }\n    ACellAdapter.prototype.leftShift = function () {\n        var ctx = this.context;\n        var frozen = this.visibleColumns.frozen.reduce(function (a, d) { return a + ctx.columns[d].width + ctx.column.padding(d); }, 0);\n        return this.visibleFirstColumnPos - frozen;\n    };\n    Object.defineProperty(ACellAdapter.prototype, \"headerScroller\", {\n        get: function () {\n            return this.header.parentElement;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ACellAdapter.prototype.addColumnMixin = function (MixinClass, options) {\n        this.columnMixins.push(new MixinClass(this.columnAdapter, options));\n    };\n    ACellAdapter.prototype.createColumnAdapter = function () {\n        var _this = this;\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        var that = this;\n        var r = {\n            visible: this.visibleColumns,\n            addAtBeginning: this.addColumnAtStart.bind(this),\n            addAtBottom: this.addColumnAtEnd.bind(this),\n            removeFromBeginning: this.removeColumnFromStart.bind(this),\n            removeFromBottom: this.removeColumnFromEnd.bind(this),\n            updateOffset: this.updateColumnOffset.bind(this),\n            scroller: this.headerScroller,\n            syncFrozen: this.syncFrozen.bind(this),\n            isScrollEventWaiting: function () { return isScrollEventWaiting(_this.headerScroller, 'animation'); },\n            get visibleFirstRowPos() {\n                return that.visibleFirstColumnPos;\n            },\n            get context() {\n                return that.context.column;\n            },\n            get scrollOffset() {\n                return that.lastScrollInfo ? that.lastScrollInfo.left : 0;\n            },\n            get scrollTotal() {\n                return that.lastScrollInfo ? that.lastScrollInfo.width : that.headerScroller.clientWidth;\n            },\n        };\n        return r;\n    };\n    ACellAdapter.prototype.init = function () {\n        var _this = this;\n        var context = this.context;\n        this.style.update(context.defaultRowHeight - context.padding(-1), context.columns, context.column.padding, 0, this.tableId);\n        context.columns.forEach(function () {\n            // init pool\n            _this.cellPool.push([]);\n        });\n    };\n    ACellAdapter.prototype.onScrolledHorizontally = function (scrollLeft, clientWidth, isGoingRight) {\n        var scrollResult = this.onScrolledHorizontallyImpl(scrollLeft, clientWidth);\n        for (var _i = 0, _a = this.columnMixins; _i < _a.length; _i++) {\n            var mixin = _a[_i];\n            mixin.onScrolled(isGoingRight, scrollResult);\n        }\n        return scrollResult;\n    };\n    ACellAdapter.prototype.removeColumnFromStart = function (from, to, frozenShift) {\n        var _this = this;\n        if (frozenShift === void 0) { frozenShift = this.visibleColumns.frozen.length; }\n        this.forEachRow(function (row) {\n            _this.removeCellFromStart(row, from, to, frozenShift);\n        });\n        // if (debug) {\n        //   this.verifyRows();\n        // }\n    };\n    ACellAdapter.prototype.removeCellFromStart = function (row, from, to, frozenShift) {\n        for (var i = from; i <= to; i += 1) {\n            var node = (frozenShift === 0 ? row.firstElementChild : row.children[frozenShift]);\n            node.remove();\n            this.recycleCell(node, i);\n        }\n        // if (debug) {\n        //   verifyRow(row, -1, this.context.columns);\n        // }\n    };\n    ACellAdapter.prototype.removeColumnFromEnd = function (from, to) {\n        var _this = this;\n        this.forEachRow(function (row) {\n            _this.removeCellFromEnd(row, from, to);\n        });\n        // if (debug) {\n        //   this.verifyRows();\n        // }\n    };\n    ACellAdapter.prototype.removeCellFromEnd = function (row, from, to) {\n        for (var i = to; i >= from; i -= 1) {\n            var node = row.lastElementChild;\n            node.remove();\n            this.recycleCell(node, i);\n        }\n        // if (debug) {\n        //   verifyRow(row, -1, this.context.columns);\n        // }\n    };\n    ACellAdapter.prototype.removeFrozenCells = function (row, columnIndices, shift) {\n        for (var _i = 0, columnIndices_1 = columnIndices; _i < columnIndices_1.length; _i++) {\n            var columnIndex = columnIndices_1[_i];\n            var node = row.children[shift];\n            node.remove();\n            this.recycleCell(node, columnIndex);\n        }\n        // if (debug) {\n        //   verifyRow(row, -1, this.context.columns);\n        // }\n    };\n    ACellAdapter.prototype.removeFrozenColumns = function (columnIndices, shift) {\n        var _this = this;\n        this.forEachRow(function (row) {\n            _this.removeFrozenCells(row, columnIndices, shift);\n        });\n        // if (debug) {\n        //   this.verifyRows();\n        // }\n    };\n    ACellAdapter.prototype.removeAllColumns = function (includingFrozen) {\n        var _this = this;\n        this.forEachRow(function (row) {\n            _this.removeAllCells(row, includingFrozen);\n        });\n        // if (debug) {\n        //   this.verifyRows();\n        // }\n    };\n    ACellAdapter.prototype.removeAllCells = function (row, includingFrozen, shift) {\n        var _this = this;\n        if (shift === void 0) { shift = this.visibleColumns.first; }\n        var arr = Array.from(row.children);\n        var frozen = this.visibleColumns.frozen;\n        clear(row);\n        if (includingFrozen || frozen.length === 0) {\n            for (var _i = 0, frozen_1 = frozen; _i < frozen_1.length; _i++) {\n                var i = frozen_1[_i];\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                this.recycleCell(arr.shift(), i);\n            }\n        }\n        else {\n            // have frozen and keep them, so readd them\n            for (var i = 0; i < frozen.length; i += 1) {\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                row.appendChild(arr.shift());\n            }\n        }\n        arr.forEach(function (item, i) {\n            _this.recycleCell(item, i + shift);\n        });\n        // if (debug) {\n        //   verifyRow(row, -1, this.context.columns);\n        // }\n    };\n    ACellAdapter.prototype.selectProxyCell = function (row, column, columns) {\n        var pool = this.cellPool[column];\n        var columnObj = columns[column];\n        var item;\n        var ready;\n        var pooled = pool.pop();\n        var r = pooled\n            ? this.updateCell(pooled, row, columnObj) || pooled\n            : this.createCell(this.header.ownerDocument, row, columnObj);\n        if (isAsyncUpdate(r)) {\n            item = r.item;\n            ready = r.ready;\n        }\n        else {\n            item = r;\n        }\n        if (item !== pooled) {\n            item.dataset.id = columnObj.id;\n            item.classList.add(CSS_CLASS_TD, this.style.cssClasses.td, cssClass(\"td-\" + this.tableId));\n        }\n        this.updateShiftedState(item, columnObj);\n        return { item: item, ready: ready };\n    };\n    ACellAdapter.prototype.handleCellReady = function (item, ready, column) {\n        var _this = this;\n        if (column === void 0) { column = -1; }\n        item.classList.add(CSS_CLASS_LOADING);\n        var abort = ready;\n        // lazy loading\n        this.loading.set(item, abort);\n        abort.then(function (result) {\n            _this.loading.delete(item);\n            item.classList.remove(CSS_CLASS_LOADING);\n            if (result === ABORTED && column >= 0) {\n                // aborted can recycle the real one\n                _this.cellPool[column].push(item);\n            }\n        });\n        return item;\n    };\n    ACellAdapter.prototype.selectCell = function (row, column, columns) {\n        var _a = this.selectProxyCell(row, column, columns), item = _a.item, ready = _a.ready;\n        if (!isAbortAble(ready)) {\n            return item;\n        }\n        return this.handleCellReady(item, ready, column);\n    };\n    ACellAdapter.prototype.updateShiftedState = function (node, col) {\n        node.classList.toggle(CSS_CLASS_SHIFTED, col.frozen && this.horizontallyShifted);\n    };\n    ACellAdapter.prototype.recycleCell = function (item, column) {\n        if (column === void 0) { column = -1; }\n        // check if the dom element is still being manipulated\n        var abort = this.loading.get(item);\n        if (abort != null) {\n            abort.abort();\n        }\n        else if (!isLoadingCell(item) && column >= 0) {\n            this.cellPool[column].push(item);\n        }\n    };\n    ACellAdapter.prototype.addColumnAtStart = function (from, to, frozenShift) {\n        var _this = this;\n        if (frozenShift === void 0) { frozenShift = this.visibleColumns.frozen.length; }\n        var columns = this.context.columns;\n        this.forEachRow(function (row, rowIndex) {\n            _this.addCellAtStart(row, rowIndex, from, to, frozenShift, columns);\n        });\n        // if (debug) {\n        //   this.verifyRows();\n        // }\n    };\n    ACellAdapter.prototype.addCellAtStart = function (row, rowIndex, from, to, frozenShift, columns) {\n        // if (debug) {\n        //   verifyRow(row, rowIndex, this.context.columns);\n        // }\n        for (var i = to; i >= from; i -= 1) {\n            var cell = this.selectCell(rowIndex, i, columns);\n            row.insertBefore(cell, frozenShift > 0 ? row.children[frozenShift] : row.firstChild);\n        }\n        // if (debug) {\n        //   verifyRow(row, rowIndex, this.context.columns);\n        // }\n    };\n    ACellAdapter.prototype.insertFrozenCells = function (row, rowIndex, columnIndices, shift, columns) {\n        var before = row.children[shift];\n        for (var _i = 0, columnIndices_2 = columnIndices; _i < columnIndices_2.length; _i++) {\n            var i = columnIndices_2[_i];\n            var cell = this.selectCell(rowIndex, i, columns);\n            if (before) {\n                row.insertBefore(cell, before);\n            }\n            else {\n                row.appendChild(cell);\n            }\n        }\n    };\n    ACellAdapter.prototype.insertFrozenColumns = function (columnIndices, shift) {\n        var _this = this;\n        var columns = this.context.columns;\n        this.forEachRow(function (row, rowIndex) {\n            _this.insertFrozenCells(row, rowIndex, columnIndices, shift, columns);\n        });\n    };\n    ACellAdapter.prototype.addColumnAtEnd = function (from, to) {\n        var _this = this;\n        var columns = this.context.columns;\n        this.forEachRow(function (row, rowIndex) {\n            _this.addCellAtEnd(row, rowIndex, from, to, columns);\n        });\n        // if (debug) {\n        //   this.verifyRows();\n        // }\n    };\n    // private verifyRows() {\n    //   const { columns } = this.context;\n    //   this.forEachRow((row, rowIndex) => verifyRow(row, rowIndex, columns));\n    // }\n    ACellAdapter.prototype.addCellAtEnd = function (row, rowIndex, from, to, columns) {\n        for (var i = from; i <= to; i += 1) {\n            var cell = this.selectCell(rowIndex, i, columns);\n            row.appendChild(cell);\n        }\n        // if (debug) {\n        //   verifyRow(row, rowIndex, this.context.columns);\n        // }\n    };\n    ACellAdapter.prototype.updateHeaders = function () {\n        var _this = this;\n        var columns = this.context.columns;\n        Array.from(this.header.children).forEach(function (node, i) {\n            var base = node;\n            var col = columns[i];\n            var r = _this.updateHeader(base, col);\n            var n;\n            if (isAsyncUpdate(r)) {\n                n = _this.handleCellReady(r.item, r.ready, -1);\n            }\n            else {\n                n = r || base;\n            }\n            if (n === base) {\n                return;\n            }\n            n.dataset.id = col.id;\n            n.classList.add(CSS_CLASS_TH, _this.style.cssClasses.th, cssClass(\"th-\" + _this.tableId));\n            _this.header.replaceChild(base, n);\n        });\n    };\n    ACellAdapter.prototype.recreate = function (left, width) {\n        var _this = this;\n        var _a;\n        var context = this.context;\n        this.style.update(context.defaultRowHeight - context.padding(-1), context.columns, context.column.padding, 0, this.tableId);\n        this.clearPool();\n        // init pool\n        for (var i = this.cellPool.length; i < context.columns.length; i += 1) {\n            this.cellPool.push([]);\n        }\n        // create all header columns\n        {\n            var fragment_1 = this.columnFragment;\n            var document_1 = fragment_1.ownerDocument;\n            // create lookup cache to reuse headers\n            var ids_1 = new Map();\n            while (this.header.lastChild) {\n                var c = this.header.lastChild;\n                this.header.removeChild(c);\n                ids_1.set((_a = c.dataset.id) !== null && _a !== void 0 ? _a : '', c);\n            }\n            context.columns.forEach(function (col) {\n                var existing = ids_1.get(col.id);\n                var r = existing ? _this.updateHeader(existing, col) || existing : _this.createHeader(document_1, col);\n                var n;\n                if (isAsyncUpdate(r)) {\n                    n = _this.handleCellReady(r.item, r.ready, -1);\n                }\n                else {\n                    n = r;\n                }\n                if (n !== existing) {\n                    n.dataset.id = col.id;\n                    n.classList.add(CSS_CLASS_TH, _this.style.cssClasses.th, cssClass(\"th-\" + _this.tableId));\n                }\n                fragment_1.appendChild(n);\n            });\n            this.header.appendChild(fragment_1);\n        }\n        var _b = range(left, width, context.column.defaultRowHeight, context.column.exceptions, context.column.numberOfRows), first = _b.first, last = _b.last, firstRowPos = _b.firstRowPos;\n        this.visibleColumns.first = first;\n        this.visibleColumns.forcedFirst = first;\n        this.visibleColumns.last = last;\n        this.visibleColumns.forcedLast = last;\n        if (context.columns.some(function (c) { return c.frozen; })) {\n            var target = updateFrozen([], context.columns, first).target;\n            this.visibleColumns.frozen = target;\n        }\n        else {\n            this.visibleColumns.frozen = [];\n        }\n        this.updateColumnOffset(firstRowPos);\n    };\n    ACellAdapter.prototype.clearPool = function () {\n        this.cellPool.forEach(function (p) { return p.splice(0, p.length); });\n    };\n    ACellAdapter.prototype.updateColumnOffset = function (firstColumnPos) {\n        var changed = firstColumnPos !== this.visibleFirstColumnPos;\n        this.visibleFirstColumnPos = firstColumnPos;\n        if (changed) {\n            var context = this.context;\n            this.style.update(context.defaultRowHeight - context.padding(-1), context.columns, context.column.padding, 0, this.tableId);\n        }\n    };\n    ACellAdapter.prototype.createRow = function (node, rowIndex) {\n        var columns = this.context.columns;\n        var visible = this.visibleColumns;\n        if (visible.frozen.length > 0) {\n            for (var _i = 0, _a = visible.frozen; _i < _a.length; _i++) {\n                var i = _a[_i];\n                var cell = this.selectCell(rowIndex, i, columns);\n                node.appendChild(cell);\n            }\n        }\n        for (var i = visible.first; i <= visible.last; i += 1) {\n            var cell = this.selectCell(rowIndex, i, columns);\n            node.appendChild(cell);\n        }\n    };\n    ACellAdapter.prototype.updateRow = function (node, rowIndex) {\n        var _a;\n        var columns = this.context.columns;\n        var visible = this.visibleColumns;\n        // columns may not match anymore if it is a pooled item a long time ago\n        switch (node.childElementCount) {\n            case 0:\n                if (visible.frozen.length > 0) {\n                    this.insertFrozenCells(node, rowIndex, visible.frozen, 0, columns);\n                }\n                this.addCellAtEnd(node, rowIndex, visible.first, visible.last, columns);\n                break;\n            case 1: {\n                var old = node.firstElementChild;\n                var id_1 = (_a = old.dataset.id) !== null && _a !== void 0 ? _a : '';\n                var columnIndex = columns.findIndex(function (c) { return c.id === id_1; });\n                node.removeChild(old);\n                if (columnIndex >= 0) {\n                    this.recycleCell(old, columnIndex);\n                }\n                if (visible.frozen.length > 0) {\n                    this.insertFrozenCells(node, rowIndex, visible.frozen, 0, columns);\n                }\n                this.addCellAtEnd(node, rowIndex, visible.first, visible.last, columns);\n                break;\n            }\n            default:\n                this.mergeColumns(node, rowIndex);\n                break;\n        }\n    };\n    ACellAdapter.prototype.mergeColumns = function (node, rowIndex) {\n        var _this = this;\n        var columns = this.context.columns;\n        var visible = this.visibleColumns;\n        var ids = new Map();\n        while (node.lastChild) {\n            var c = node.lastChild;\n            node.removeChild(c);\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            ids.set(c.dataset.id, c);\n        }\n        var updateImpl = function (i) {\n            var col = columns[i];\n            var existing = ids.get(col.id);\n            if (!existing) {\n                var cell_1 = _this.selectCell(rowIndex, i, columns);\n                node.appendChild(cell_1);\n                return;\n            }\n            ids.delete(col.id);\n            var r = _this.updateCell(existing, rowIndex, col) || existing;\n            var cell;\n            if (isAsyncUpdate(r)) {\n                cell = _this.handleCellReady(r.item, r.ready, i);\n            }\n            else {\n                cell = r;\n            }\n            if (cell && cell !== existing) {\n                cell.dataset.id = col.id;\n                cell.classList.add(CSS_CLASS_TD, _this.style.cssClasses.td, cssClass(\"td-\" + _this.tableId));\n            }\n            _this.updateShiftedState(cell, col);\n            node.appendChild(cell);\n        };\n        for (var _i = 0, _a = visible.frozen; _i < _a.length; _i++) {\n            var frozen = _a[_i];\n            updateImpl(frozen);\n        }\n        for (var i = visible.first; i <= visible.last; i += 1) {\n            updateImpl(i);\n        }\n        if (ids.size === 0) {\n            return;\n        }\n        // recycle\n        var byId = new Map(columns.map(function (d, i) { return [d.id, i]; }));\n        ids.forEach(function (idNode, key) {\n            var index = byId.get(key);\n            if (index != null && index >= 0) {\n                _this.recycleCell(idNode, index);\n            }\n        });\n    };\n    ACellAdapter.prototype.updateShiftedStates = function () {\n        if (!this.context.columns.some(function (d) { return d.frozen; })) {\n            return;\n        }\n        var shifted = this.horizontallyShifted;\n        var clazz = CSS_CLASS_SHIFTED;\n        if (shifted) {\n            var headers = Array.from(this.header.querySelectorAll(\".\" + CSS_CLASS_FROZEN + \":not(.\" + clazz + \")\"));\n            var bodies = Array.from(this.body.querySelectorAll(\".\" + CSS_CLASS_FROZEN + \":not(.\" + clazz + \")\"));\n            for (var _i = 0, headers_1 = headers; _i < headers_1.length; _i++) {\n                var item = headers_1[_i];\n                item.classList.add(clazz);\n            }\n            for (var _a = 0, bodies_1 = bodies; _a < bodies_1.length; _a++) {\n                var item = bodies_1[_a];\n                item.classList.add(clazz);\n            }\n        }\n        else {\n            var headers = Array.from(this.header.querySelectorAll(\".\" + CSS_CLASS_FROZEN + \".\" + clazz));\n            var bodies = Array.from(this.body.querySelectorAll(\".\" + CSS_CLASS_FROZEN + \".\" + clazz));\n            for (var _b = 0, headers_2 = headers; _b < headers_2.length; _b++) {\n                var item = headers_2[_b];\n                item.classList.remove(clazz);\n            }\n            for (var _c = 0, bodies_2 = bodies; _c < bodies_2.length; _c++) {\n                var item = bodies_2[_c];\n                item.classList.remove(clazz);\n            }\n        }\n    };\n    ACellAdapter.prototype.syncFrozen = function (first) {\n        var columns = this.context.columns;\n        var visible = this.visibleColumns;\n        if (!columns.some(function (d) { return d.frozen; })) {\n            return 0;\n        }\n        if (first === 0) {\n            if (visible.frozen.length > 0) {\n                this.removeFrozenColumns(visible.frozen, 0);\n                visible.frozen = [];\n            }\n            return 0;\n        }\n        var old = visible.frozen.length;\n        var _a = updateFrozen(visible.frozen, columns, first), target = _a.target, added = _a.added, removed = _a.removed;\n        if (removed.length > 0) {\n            this.removeFrozenColumns(removed, old - removed.length);\n        }\n        if (added.length > 0) {\n            this.insertFrozenColumns(added, old - removed.length);\n        }\n        visible.frozen = target;\n        return target.length;\n    };\n    ACellAdapter.prototype.onScrolledHorizontallyImpl = function (scrollLeft, clientWidth) {\n        var shiftingChanged = this.horizontallyShifted !== scrollLeft > 0;\n        this.horizontallyShifted = scrollLeft > 0;\n        var column = this.context.column;\n        var _a = range(scrollLeft, clientWidth, column.defaultRowHeight, column.exceptions, column.numberOfRows), first = _a.first, last = _a.last, firstRowPos = _a.firstRowPos;\n        var visible = this.visibleColumns;\n        visible.forcedFirst = first;\n        visible.forcedLast = last;\n        if (first - visible.first >= 0 && last - visible.last <= 0) {\n            // nothing to do\n            if (shiftingChanged) {\n                this.updateShiftedStates();\n            }\n            return EScrollResult.NONE;\n        }\n        var r = EScrollResult.SOME;\n        var frozenShift = this.syncFrozen(first);\n        if (first > visible.last || last < visible.first) {\n            // no overlap, clean and draw everything\n            // console.log(\n            //   `ff added: ${last - first + 1} removed: ${visible.last - visible.first + 1} ${first}:${last} ${frozenShift}`\n            // );\n            // removeRows(visibleFirst, visibleLast);\n            this.removeAllColumns(false);\n            // this.updateShiftedStates();\n            this.addColumnAtEnd(first, last);\n            r = EScrollResult.ALL;\n        }\n        else if (first < visible.first) {\n            // some first rows missing and some last rows to much\n            // console.log(\n            //   `up added: ${visible.first - first + 1} removed: ${visible.last - last + 1} ${first}:${last} ${frozenShift}`\n            // );\n            this.removeColumnFromEnd(last + 1, visible.last);\n            this.updateShiftedStates();\n            this.addColumnAtStart(first, visible.first - 1, frozenShift);\n            r = EScrollResult.SOME_TOP;\n        }\n        else {\n            // console.log(\n            //   `do added: ${last - visible.last + 1} removed: ${first - visible.first + 1} ${first}:${last} ${frozenShift}`\n            // );\n            // some last rows missing and some first rows to much\n            this.removeColumnFromStart(visible.first, first - 1, frozenShift);\n            this.updateShiftedStates();\n            this.addColumnAtEnd(visible.last + 1, last);\n            r = EScrollResult.SOME_BOTTOM;\n        }\n        visible.first = first;\n        visible.last = last;\n        this.updateColumnOffset(firstRowPos);\n        return r;\n    };\n    return ACellAdapter;\n}());\nexport { ACellAdapter };\n/**\n * @internal\n */\nexport default ACellAdapter;\n// function verifyRow(row: HTMLElement, index: number, columns: IColumn[]) {\n//   const cols = Array.from(row.children) as HTMLElement[];\n//   // sort incrementally\n//   if (cols.length <= 1) {\n//     return;\n//   }\n//   const colObjs = cols.map((c) => columns.find((d) => d.id === c.dataset.id));\n//   console.assert(\n//     colObjs.every((d) => Boolean(d)),\n//     'all columns must exist',\n//     index\n//   );\n//   console.assert(\n//     colObjs.every((d, i) => i === 0 || d.index >= colObjs[i - 1]!.index),\n//     'all columns in ascending order',\n//     index\n//   );\n//   console.assert(new Set(colObjs).size === colObjs.length, 'unique columns', colObjs);\n// }\n//# sourceMappingURL=ACellAdapter.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ARowRenderer, setTransform } from '../ARowRenderer';\nimport { EScrollResult } from '../mixin';\nimport { CSS_CLASS_HIDDEN, CSS_CLASS_LOADING } from '../styles';\nimport { ACellAdapter } from './internal/ACellAdapter';\n/**\n * base class for a cell renderer as table section\n */\nvar ACellTableSection = /** @class */ (function (_super) {\n    __extends(ACellTableSection, _super);\n    function ACellTableSection(header, body, tableId, style, options) {\n        if (options === void 0) { options = {}; }\n        var _this = _super.call(this, body, options) || this;\n        _this.header = header;\n        _this.body = body;\n        _this.tableId = tableId;\n        _this.style = style;\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        var that = _this;\n        var LocalCell = /** @class */ (function (_super) {\n            __extends(LocalCell, _super);\n            function LocalCell() {\n                return _super !== null && _super.apply(this, arguments) || this;\n            }\n            Object.defineProperty(LocalCell.prototype, \"context\", {\n                get: function () {\n                    return that.context;\n                },\n                enumerable: false,\n                configurable: true\n            });\n            Object.defineProperty(LocalCell.prototype, \"body\", {\n                get: function () {\n                    return that.body;\n                },\n                enumerable: false,\n                configurable: true\n            });\n            Object.defineProperty(LocalCell.prototype, \"lastScrollInfo\", {\n                get: function () {\n                    return that.lastScrollInfo;\n                },\n                enumerable: false,\n                configurable: true\n            });\n            LocalCell.prototype.createHeader = function (document, column) {\n                return that.createHeader(document, column);\n            };\n            LocalCell.prototype.updateHeader = function (node, column) {\n                return that.updateHeader(node, column);\n            };\n            LocalCell.prototype.createCell = function (document, index, column) {\n                return that.createCell(document, index, column);\n            };\n            LocalCell.prototype.updateColumnOffset = function (firstColumnPos) {\n                _super.prototype.updateColumnOffset.call(this, firstColumnPos);\n                that.updateOffset(that.visibleFirstRowPos);\n            };\n            LocalCell.prototype.updateCell = function (node, index, column) {\n                return that.updateCell(node, index, column);\n            };\n            LocalCell.prototype.forEachRow = function (callback) {\n                return that.forEachRow(callback);\n            };\n            return LocalCell;\n        }(ACellAdapter));\n        _this.cell = new LocalCell(_this.header, _this.style, tableId, options.mixins || []);\n        return _this;\n    }\n    ACellTableSection.prototype.addColumnMixin = function (mixinClass, options) {\n        this.cell.addColumnMixin(mixinClass, options);\n    };\n    Object.defineProperty(ACellTableSection.prototype, \"idPrefix\", {\n        get: function () {\n            return this.tableId;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ACellTableSection.prototype, \"width\", {\n        get: function () {\n            return this.context.column.totalHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ACellTableSection.prototype, \"visibleColumns\", {\n        get: function () {\n            return this.cell.visibleColumns;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ACellTableSection.prototype, \"visibleFirstColumnPos\", {\n        get: function () {\n            return this.cell.visibleFirstColumnPos;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ACellTableSection.prototype, \"height\", {\n        get: function () {\n            return this.context.totalHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ACellTableSection.prototype, \"hidden\", {\n        get: function () {\n            return this.header.classList.contains(CSS_CLASS_LOADING);\n        },\n        set: function (value) {\n            var old = this.hidden;\n            if (old === value) {\n                return;\n            }\n            this.header.classList.toggle(CSS_CLASS_LOADING, value);\n            this.body.classList.toggle(CSS_CLASS_LOADING, value);\n            this.header.classList.toggle(CSS_CLASS_HIDDEN, value);\n            this.body.classList.toggle(CSS_CLASS_HIDDEN, value);\n            this.onVisibilityChanged(!value);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ACellTableSection.prototype.updateSizer = function (firstRowPos) {\n        this.updateShifts(firstRowPos, this.cell.leftShift());\n        // no sizer update since centrally managed\n    };\n    ACellTableSection.prototype.updateShifts = function (top, _left) {\n        setTransform(this.body, 0 /* left.toFixed(0) */, top.toFixed(0));\n    };\n    /**\n     * hook when the visibility changes\n     * @param {boolean} _visible current visibility\n     */\n    ACellTableSection.prototype.onVisibilityChanged = function (_visible) {\n        // hook\n    };\n    ACellTableSection.prototype.hide = function () {\n        this.hidden = true;\n    };\n    ACellTableSection.prototype.show = function (scrollLeft, clientWidth, isGoingRight) {\n        var wasHidden = this.hidden;\n        this.hidden = false;\n        if (wasHidden) {\n            // full update\n            this.revalidate();\n        }\n        else {\n            this.onScrolledHorizontally(scrollLeft, clientWidth, isGoingRight);\n        }\n    };\n    ACellTableSection.prototype.init = function () {\n        this.hide(); // hide by default\n        this.cell.init();\n        _super.prototype.init.call(this);\n    };\n    ACellTableSection.prototype.destroy = function () {\n        _super.prototype.destroy.call(this);\n        this.header.remove();\n        this.style.remove(this.tableId);\n    };\n    ACellTableSection.prototype.onScrolledVertically = function (scrollTop, clientHeight, isGoingDown) {\n        if (this.hidden) {\n            return EScrollResult.NONE;\n        }\n        return _super.prototype.onScrolledVertically.call(this, scrollTop, clientHeight, isGoingDown);\n    };\n    ACellTableSection.prototype.onScrolledHorizontally = function (scrollLeft, clientWidth, isGoingRight) {\n        var r = this.cell.onScrolledHorizontally(scrollLeft, clientWidth, isGoingRight);\n        this.updateSizer(this.visibleFirstRowPos);\n        return r;\n    };\n    /**\n     * triggers updating the header\n     */\n    ACellTableSection.prototype.updateHeaders = function () {\n        this.cell.updateHeaders();\n    };\n    ACellTableSection.prototype.handleCellReady = function (item, ready, column) {\n        if (column === void 0) { column = -1; }\n        return this.cell.handleCellReady(item, ready, column);\n    };\n    ACellTableSection.prototype.recycleCell = function (item, column) {\n        if (column === void 0) { column = -1; }\n        this.cell.recycleCell(item, column);\n    };\n    /**\n     * trigger an update all all column widths\n     */\n    ACellTableSection.prototype.updateColumnWidths = function () {\n        var context = this.context;\n        this.style.update(context.defaultRowHeight - context.padding(-1), context.columns, context.column.padding, 0, this.tableId);\n    };\n    ACellTableSection.prototype.recreate = function (ctx) {\n        var scroller = this.bodyScroller;\n        var oldLeft = scroller.scrollLeft;\n        this.cell.recreate(oldLeft, scroller.clientWidth);\n        _super.prototype.recreate.call(this, ctx);\n        // restore left\n        scroller.scrollLeft = oldLeft;\n    };\n    ACellTableSection.prototype.clearPool = function () {\n        _super.prototype.clearPool.call(this);\n        this.cell.clearPool();\n    };\n    ACellTableSection.prototype.createRow = function (node, rowIndex) {\n        this.cell.createRow(node, rowIndex);\n        node.classList.add(this.style.cssClasses.tr);\n    };\n    ACellTableSection.prototype.updateRow = function (node, rowIndex) {\n        this.cell.updateRow(node, rowIndex);\n    };\n    return ACellTableSection;\n}(ARowRenderer));\nexport { ACellTableSection };\nexport default ACellTableSection;\n//# sourceMappingURL=ACellTableSection.js.map","import {\n  defaultPhases,\n  EAnimationMode,\n  IAnimationContext,\n  IAnimationItem,\n  IExceptionContext,\n  IPhase,\n  KeyFinder,\n} from 'lineupengine';\nimport { IGroupData, IGroupItem, isGroup } from '../model';\n\n/** @internal */\nexport interface IGroupLookUp {\n  item2groupIndex: Map<number, number>;\n  group2firstItemIndex: Map<string, number>;\n}\n\nfunction toGroupLookup(items: (IGroupItem | IGroupData)[]): IGroupLookUp {\n  const item2groupIndex = new Map<number, number>();\n  const group2firstItemIndex = new Map<string, number>();\n  items.forEach((item, i) => {\n    if (isGroup(item)) {\n      for (let o = 0; o < item.order.length; ++o) {\n        item2groupIndex.set(o, i);\n      }\n    } else if (item.group && item.relativeIndex === 0) {\n      group2firstItemIndex.set(item.group.name, i);\n    }\n  });\n  return { item2groupIndex, group2firstItemIndex };\n}\n\nfunction toKey(item: IGroupItem | IGroupData) {\n  if (isGroup(item)) {\n    return item.name;\n  }\n  return (item as IGroupItem).dataIndex.toString();\n}\n\n/** @internal */\nexport function lineupAnimation(\n  previous: IExceptionContext,\n  previousData: (IGroupItem | IGroupData)[],\n  currentData: (IGroupItem | IGroupData)[]\n): IAnimationContext {\n  const previousKey = (index: number) => toKey(previousData[index]);\n  const currentKey = (index: number) => toKey(currentData[index]);\n\n  const previousGroupCount = previousData.reduce((acc, i) => acc + (isGroup(i) ? 1 : 0), 0);\n  const currentGroupCount = currentData.reduce((acc, i) => acc + (isGroup(i) ? 1 : 0), 0);\n\n  if (previousGroupCount === currentGroupCount) {\n    // reorder or filter only\n    return { currentKey, previous, previousKey };\n  }\n\n  // try to appear where the group was uncollapsed and vice versa\n  let prevHelper: IGroupLookUp;\n  const appearPosition = (currentRowIndex: number, previousFinder: KeyFinder, defaultValue: number) => {\n    if (!prevHelper) {\n      prevHelper = toGroupLookup(previousData);\n    }\n    const item = currentData[currentRowIndex];\n    const referenceIndex = isGroup(item)\n      ? prevHelper.group2firstItemIndex.get(item.name)\n      : prevHelper.item2groupIndex.get(item.dataIndex);\n    if (referenceIndex === undefined) {\n      return defaultValue;\n    }\n    const pos = previousFinder.posByKey(previousKey(referenceIndex));\n    return pos.pos >= 0 ? pos.pos : defaultValue;\n  };\n\n  let currHelper: IGroupLookUp;\n  const removePosition = (previousRowIndex: number, currentFinder: KeyFinder, defaultValue: number) => {\n    if (!currHelper) {\n      currHelper = toGroupLookup(currentData);\n    }\n    const item = previousData[previousRowIndex];\n    const referenceIndex = isGroup(item)\n      ? currHelper.group2firstItemIndex.get(item.name)\n      : currHelper.item2groupIndex.get(item.dataIndex);\n    if (referenceIndex === undefined) {\n      return defaultValue;\n    }\n    const pos = currentFinder.posByKey(currentKey(referenceIndex));\n    return pos.pos >= 0 ? pos.pos : defaultValue;\n  };\n\n  const phases: IPhase[] = [\n    Object.assign({}, defaultPhases[0], {\n      apply(item: Readonly<IAnimationItem>, previousFinder: KeyFinder) {\n        defaultPhases[0].apply(item);\n        if (item.mode === EAnimationMode.SHOW) {\n          item.node.style.transform = `translate(0, ${\n            appearPosition(item.current.index, previousFinder, item.previous.y) - item.nodeY\n          }px)`;\n        }\n      },\n    }),\n    Object.assign({}, defaultPhases[1], {\n      apply(item: Readonly<IAnimationItem>, _previousFinder: KeyFinder, currentFinder: KeyFinder) {\n        defaultPhases[1].apply(item);\n        if (item.mode === EAnimationMode.HIDE) {\n          item.node.style.transform = `translate(0, ${\n            removePosition(item.previous.index, currentFinder, item.current.y) - item.nodeY\n          }px)`;\n        }\n      },\n    }),\n    defaultPhases[defaultPhases.length - 1],\n  ];\n\n  return { previous, previousKey, currentKey, phases };\n}\n","import { IColumn, IAbortAblePromise, IAsyncUpdate, isAbortAble } from 'lineupengine';\nimport type { Column } from '../model';\nimport type { ICellRenderer, IGroupCellRenderer } from '../renderer';\nimport type { ISummaryRenderer, IRenderCallback } from '../renderer';\nimport { createHeader, updateHeader } from './header';\nimport type { IRankingContext } from './interfaces';\nimport type { ILineUpFlags } from '../config';\nimport { cssClass, engineCssClass } from '../styles';\nimport { isPromiseLike } from '../internal';\n\nexport interface IRenderers {\n  singleId: string;\n  single: ICellRenderer;\n  groupId: string;\n  group: IGroupCellRenderer;\n  summaryId: string;\n  summary: ISummaryRenderer | null;\n  singleTemplate: HTMLElement | null;\n  groupTemplate: HTMLElement | null;\n  summaryTemplate: HTMLElement | null;\n}\n\nexport default class RenderColumn implements IColumn {\n  renderers: IRenderers | null = null;\n\n  constructor(\n    public readonly c: Column,\n    public index: number,\n    protected ctx: IRankingContext,\n    protected readonly flags: ILineUpFlags\n  ) {}\n\n  get width() {\n    return this.c.getWidth();\n  }\n\n  get id() {\n    return this.c.id;\n  }\n\n  get frozen() {\n    return this.flags.disableFrozenColumns ? false : this.c.frozen;\n  }\n\n  private singleRenderer() {\n    if (!this.renderers || !this.renderers.single) {\n      return null;\n    }\n    if (this.renderers.singleTemplate) {\n      return this.renderers.singleTemplate.cloneNode(true) as HTMLElement;\n    }\n    const elem = this.ctx.asElement(this.renderers.single.template);\n    elem.classList.add(cssClass(`renderer-${this.renderers.singleId}`), cssClass('detail'));\n    elem.dataset.renderer = this.renderers.singleId;\n    elem.dataset.group = 'd';\n\n    this.renderers.singleTemplate = elem.cloneNode(true) as HTMLElement;\n    return elem;\n  }\n\n  private groupRenderer() {\n    if (!this.renderers || !this.renderers.group) {\n      return null;\n    }\n    if (this.renderers.groupTemplate) {\n      return this.renderers.groupTemplate.cloneNode(true) as HTMLElement;\n    }\n    const elem = this.ctx.asElement(this.renderers.group.template);\n    elem.classList.add(cssClass(`renderer-${this.renderers.groupId}`), cssClass('group'));\n    elem.dataset.renderer = this.renderers.groupId;\n    elem.dataset.group = 'g';\n\n    this.renderers.groupTemplate = elem.cloneNode(true) as HTMLElement;\n    return elem;\n  }\n\n  private summaryRenderer() {\n    if (!this.renderers || !this.renderers.summary) {\n      return null;\n    }\n    if (this.renderers.summaryTemplate) {\n      return this.renderers.summaryTemplate.cloneNode(true) as HTMLElement;\n    }\n    const elem = this.ctx.asElement(this.renderers.summary.template);\n    elem.classList.add(cssClass('summary'), cssClass('th-summary'), cssClass(`renderer-${this.renderers.summaryId}`));\n    elem.dataset.renderer = this.renderers.summaryId;\n\n    this.renderers.summaryTemplate = elem.cloneNode(true) as HTMLElement;\n    return elem;\n  }\n\n  createHeader(): HTMLElement | IAsyncUpdate<HTMLElement> {\n    const node = createHeader(this.c, this.ctx, {\n      extraPrefix: 'th',\n      dragAble: this.flags.advancedUIFeatures,\n      mergeDropAble: this.flags.advancedModelFeatures,\n      rearrangeAble: this.flags.advancedUIFeatures,\n      resizeable: this.flags.advancedUIFeatures,\n    });\n    node.classList.add(cssClass('header'));\n    if (!this.flags.disableFrozenColumns) {\n      node.classList.toggle(engineCssClass('frozen'), this.frozen);\n    }\n\n    if (this.renderers && this.renderers.summary) {\n      const summary = this.summaryRenderer()!;\n      node.appendChild(summary);\n    }\n    return this.updateHeader(node);\n  }\n\n  hasSummaryLine() {\n    return Boolean(this.c.getMetaData().summary);\n  }\n\n  updateHeader(node: HTMLElement): HTMLElement | IAsyncUpdate<HTMLElement> {\n    updateHeader(node, this.c);\n    if (!this.renderers || !this.renderers.summary) {\n      return node;\n    }\n    let summary = node.getElementsByClassName(cssClass('summary'))[0]! as HTMLElement;\n    summary.remove();\n    summary = this.summaryRenderer()!;\n    node.appendChild(summary);\n    const ready = this.renderers.summary.update(summary);\n    if (ready) {\n      return { item: node, ready };\n    }\n    return node;\n  }\n\n  createCell(index: number): HTMLElement | IAsyncUpdate<HTMLElement> {\n    const isGroup = this.ctx.isGroup(index);\n    const node = isGroup ? this.groupRenderer()! : this.singleRenderer()!;\n    return this.updateCell(node, index);\n  }\n\n  updateCell(node: HTMLElement, index: number): HTMLElement | IAsyncUpdate<HTMLElement> {\n    if (!this.flags.disableFrozenColumns) {\n      node.classList.toggle(engineCssClass('frozen'), this.frozen);\n    }\n    const isGroup = this.ctx.isGroup(index);\n    // assert that we have the template of the right mode\n    const oldRenderer = node.dataset.renderer;\n    const currentRenderer = isGroup ? this.renderers!.groupId : this.renderers!.singleId;\n    const oldGroup = node.dataset.group;\n    const currentGroup = isGroup ? 'g' : 'd';\n    if (oldRenderer !== currentRenderer || oldGroup !== currentGroup) {\n      node = isGroup ? this.groupRenderer()! : this.singleRenderer()!;\n    }\n    let ready: IAbortAblePromise<void> | void | null;\n    if (isGroup) {\n      const g = this.ctx.getGroup(index);\n      ready = this.renderers!.group.update(node, g);\n    } else {\n      const r = this.ctx.getRow(index);\n      const row = this.ctx.provider.getRow(r.dataIndex);\n      if (!isPromiseLike(row)) {\n        ready = this.renderers!.single.update(node, row, r.relativeIndex, r.group);\n      } else {\n        ready = chainAbortAble(row, (row) => this.renderers!.single.update(node, row, r.relativeIndex, r.group));\n      }\n    }\n    if (ready) {\n      return { item: node, ready };\n    }\n    return node;\n  }\n\n  renderCell(ctx: CanvasRenderingContext2D, index: number): boolean | IAbortAblePromise<IRenderCallback> {\n    const r = this.ctx.getRow(index);\n    const s = this.renderers!.single;\n    if (!s.render) {\n      return false;\n    }\n    const row = this.ctx.provider.getRow(r.dataIndex);\n    if (!isPromiseLike(row)) {\n      return s.render(ctx, row, r.relativeIndex, r.group) || false;\n    }\n    return chainAbortAble(row, (row) => s.render!(ctx, row, r.relativeIndex, r.group) || false);\n  }\n}\n\nfunction chainAbortAble<T, U, V>(\n  toWait: Promise<T>,\n  mapper: (value: T) => IAbortAblePromise<U> | V\n): IAbortAblePromise<U> | V {\n  let aborted = false;\n  const p: any = new Promise<IAbortAblePromise<U> | null | void>((resolve) => {\n    if (aborted) {\n      return;\n    }\n    toWait.then((r) => {\n      if (aborted) {\n        return;\n      }\n      const mapped = mapper(r);\n      if (isAbortAble(mapped as any)) {\n        p.abort = (mapped as IAbortAblePromise<U>).abort.bind(mapped);\n        return p.then(resolve);\n      }\n      return resolve(mapped as any);\n    });\n  });\n\n  p.abort = () => {\n    aborted = true;\n  };\n  return p;\n}\n","import { abortAbleAll, IAbortAblePromise, IAsyncUpdate, isAsyncUpdate, StyleManager } from 'lineupengine';\nimport { round } from '../internal';\nimport type { Column, IMultiLevelColumn } from '../model';\nimport type { ISummaryRenderer } from '../renderer';\nimport { multiLevelGridCSSClass } from '../renderer/utils';\nimport { COLUMN_PADDING, cssClass } from '../styles';\nimport { createHeader, updateHeader } from './header';\nimport RenderColumn from './RenderColumn';\n\n/** @internal */\nexport default class MultiLevelRenderColumn extends RenderColumn {\n  private summaries: ISummaryRenderer[] = [];\n\n  private get mc() {\n    return this.c as IMultiLevelColumn & Column;\n  }\n\n  get width() {\n    return this.c.getWidth() + COLUMN_PADDING * this.mc.length;\n  }\n\n  createHeader() {\n    const r = super.createHeader();\n    const wrapper = this.ctx.document.createElement('div');\n    wrapper.classList.add(cssClass('nested'));\n    wrapper.classList.add(multiLevelGridCSSClass(this.ctx.idPrefix, this.c));\n\n    if (isAsyncUpdate(r)) {\n      r.item.appendChild(wrapper);\n    } else {\n      r.appendChild(wrapper);\n    }\n\n    return this.updateNested(wrapper, r);\n  }\n\n  private matchChildren(wrapper: HTMLElement, children: Column[]) {\n    function matches(col: Column, i: number) {\n      //do both match?\n      const n = wrapper.children[i] as HTMLElement;\n      return n != null && n.dataset.colId === col.id;\n    }\n\n    if (children.every(matches) && children.length === wrapper.childElementCount) {\n      // 1:1 match\n      return;\n    }\n\n    const lookup = new Map(\n      (Array.from(wrapper.children) as HTMLElement[]).map(\n        (n: HTMLElement, i) =>\n          [n.dataset.colId!, { node: n, summary: this.summaries[i] }] as [\n            string,\n            { node: HTMLElement; summary: ISummaryRenderer }\n          ]\n      )\n    );\n\n    // reset summaries array\n    this.summaries = [];\n\n    children.forEach((cc, i) => {\n      const existing = lookup.get(cc.id);\n      if (existing) {\n        // reuse existing\n        lookup.delete(cc.id);\n        const n = existing.node;\n        n.style.gridColumnStart = (i + 1).toString();\n        wrapper.appendChild(n);\n        this.summaries[i] = existing.summary;\n        return;\n      }\n\n      const n = createHeader(cc, this.ctx, {\n        extraPrefix: 'th',\n        mergeDropAble: false,\n        dragAble: this.flags.advancedModelFeatures,\n        rearrangeAble: this.flags.advancedModelFeatures,\n        resizeable: this.flags.advancedModelFeatures,\n      });\n      n.classList.add(cssClass('header'), cssClass('nested-th'));\n      n.style.gridColumnStart = (i + 1).toString();\n      wrapper.appendChild(n);\n\n      if (!this.renderers || !this.renderers.summary) {\n        return;\n      }\n      const summary = this.ctx.summaryRenderer(cc, false);\n      const summaryNode = this.ctx.asElement(summary.template);\n      summaryNode.classList.add(\n        cssClass('summary'),\n        cssClass('th-summary'),\n        cssClass(`renderer-${cc.getSummaryRenderer()}`)\n      );\n      summaryNode.dataset.renderer = cc.getSummaryRenderer();\n      n.appendChild(summaryNode);\n      this.summaries[i] = summary;\n      summary.update(summaryNode);\n    });\n\n    // delete not used ones anymore\n    lookup.forEach((v) => v.node.remove());\n  }\n\n  updateHeader(node: HTMLElement) {\n    const r = super.updateHeader(node);\n    node = isAsyncUpdate(r) ? r.item : r;\n    const wrapper = node.getElementsByClassName(cssClass('nested'))[0] as HTMLElement;\n    if (!wrapper) {\n      return r; // too early\n    }\n    node.appendChild(wrapper); // ensure the last one\n    return this.updateNested(wrapper, r);\n  }\n\n  hasSummaryLine() {\n    return super.hasSummaryLine() || this.mc.children.some((c) => Boolean(c.getMetaData().summary));\n  }\n\n  updateWidthRule(style: StyleManager) {\n    const mc = this.mc;\n    // need this for chrome to work properly\n    const widths = mc.children.map((c) => `minmax(0, ${round(c.getWidth())}fr)`);\n    const clazz = multiLevelGridCSSClass(this.ctx.idPrefix, this.c);\n    style.updateRule(`stacked-${this.c.id}`, `.${clazz}`, {\n      display: 'grid',\n      gridTemplateColumns: widths.join(' '),\n    });\n    return clazz;\n  }\n\n  private updateNested(wrapper: HTMLElement, r: HTMLElement | IAsyncUpdate<HTMLElement>) {\n    const sub = this.mc.isShowNestedSummaries() ? this.mc.children : [];\n\n    this.matchChildren(wrapper, sub);\n\n    const children = Array.from(wrapper.children) as HTMLElement[];\n\n    const toWait: IAbortAblePromise<void>[] = [];\n    let header: HTMLElement;\n    if (isAsyncUpdate(r)) {\n      toWait.push(r.ready);\n      header = r.item;\n    } else {\n      header = r;\n    }\n\n    sub.forEach((c, i) => {\n      const node = children[i];\n      updateHeader(node, c);\n\n      if (!this.renderers || !this.renderers.summary) {\n        return;\n      }\n      let summary = node.getElementsByClassName(cssClass('summary'))[0] as HTMLElement;\n      const oldRenderer = summary.dataset.renderer;\n      const currentRenderer = c.getSummaryRenderer();\n      if (oldRenderer !== currentRenderer) {\n        const renderer = this.ctx.summaryRenderer(c, false);\n        summary.remove();\n        summary = this.ctx.asElement(renderer.template);\n        summary.classList.add(cssClass('summary'), cssClass('th-summary'), cssClass(`renderer-${currentRenderer}`));\n        summary.dataset.renderer = currentRenderer;\n        this.summaries[i] = renderer;\n        node.appendChild(summary);\n      }\n      const ready = this.summaries[i].update(summary);\n      if (ready) {\n        toWait.push(ready);\n      }\n    });\n\n    if (toWait.length === 0) {\n      return header;\n    }\n    return {\n      item: header,\n      ready: abortAbleAll(toWait) as IAbortAblePromise<void>,\n    };\n  }\n}\n","import { OrderedSet, AEventDispatcher, IEventListener } from '../internal';\nimport { IGroupData, IGroupItem, isGroup } from '../model';\nimport type { IDataProvider } from '../provider';\nimport { cssClass, engineCssClass } from '../styles';\nimport { forEachIndices } from '../model/internal';\nimport { rangeSelection } from '../provider/utils';\n\ninterface IPoint {\n  x: number;\n  y: number;\n}\n\ninterface IShift {\n  xShift: number;\n  yShift: number;\n  node: HTMLElement;\n}\n\n/**\n * @asMemberOf SelectionManager\n * @internal\n * @event\n */\nexport declare function selectRange(from: number, to: number, additional: boolean): void;\n\n/** @internal */\nexport default class SelectionManager extends AEventDispatcher {\n  static readonly EVENT_SELECT_RANGE = 'selectRange';\n  private static readonly MIN_DISTANCE = 10;\n\n  private readonly hr: HTMLHRElement;\n\n  private start: (IPoint & IShift) | null = null;\n\n  constructor(private readonly ctx: { provider: IDataProvider }, private readonly body: HTMLElement) {\n    super();\n    const root = body.parentElement!.parentElement!;\n    let hr = root.querySelector('hr');\n    if (!hr) {\n      hr = root.ownerDocument!.createElement('hr');\n      root.appendChild(hr);\n    }\n    this.hr = hr;\n    this.hr.classList.add(cssClass('hr'));\n\n    const mouseMove = (evt: MouseEvent) => {\n      this.showHint(evt);\n    };\n    const mouseUp = (evt: MouseEvent) => {\n      this.body.removeEventListener('mousemove', mouseMove);\n      this.body.removeEventListener('mouseup', mouseUp);\n      this.body.removeEventListener('mouseleave', mouseUp);\n\n      if (!this.start) {\n        return;\n      }\n      const row = engineCssClass('tr');\n      const startNode = this.start.node.classList.contains(row)\n        ? this.start.node\n        : this.start.node.closest<HTMLElement>(`.${row}`);\n      // somehow on firefox the mouseUp will be triggered on the original node\n      // thus search the node explicitly\n      const end = this.body.ownerDocument!.elementFromPoint(evt.clientX, evt.clientY) as HTMLElement;\n      const endNode = end.classList.contains(row) ? end : end.closest<HTMLElement>(`.${row}`);\n      this.start = null;\n\n      this.body.classList.remove(cssClass('selection-active'));\n      this.hr.classList.remove(cssClass('selection-active'));\n\n      this.select(evt.ctrlKey, startNode, endNode);\n    };\n\n    body.addEventListener(\n      'mousedown',\n      (evt) => {\n        const r = root.getBoundingClientRect();\n        this.start = { x: evt.clientX, y: evt.clientY, xShift: r.left, yShift: r.top, node: evt.target as HTMLElement };\n\n        this.body.classList.add(cssClass('selection-active'));\n        body.addEventListener('mousemove', mouseMove, {\n          passive: true,\n        });\n        body.addEventListener('mouseup', mouseUp, {\n          passive: true,\n        });\n        body.addEventListener('mouseleave', mouseUp, {\n          passive: true,\n        });\n      },\n      {\n        passive: true,\n      }\n    );\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([SelectionManager.EVENT_SELECT_RANGE]);\n  }\n\n  on(type: typeof SelectionManager.EVENT_SELECT_RANGE, listener: typeof selectRange | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  private select(additional: boolean, startNode?: HTMLElement, endNode?: HTMLElement) {\n    if (!startNode || !endNode || startNode === endNode) {\n      return; // no single\n    }\n\n    const startIndex = Number.parseInt(startNode.dataset.index!, 10);\n    const endIndex = Number.parseInt(endNode.dataset.index!, 10);\n\n    const from = Math.min(startIndex, endIndex);\n    const end = Math.max(startIndex, endIndex);\n    if (from === end) {\n      return; // no single\n    }\n    // bounce event end\n    requestAnimationFrame(() => this.fire(SelectionManager.EVENT_SELECT_RANGE, from, end, additional));\n  }\n\n  private showHint(end: MouseEvent) {\n    const start = this.start!;\n    const sy = start.y;\n    const ey = end.clientY;\n\n    const visible = Math.abs(sy - ey) > SelectionManager.MIN_DISTANCE;\n    this.hr.classList.toggle(cssClass('selection-active'), visible);\n    this.hr.style.transform = `translate(${start.x - start.xShift}px,${sy - start.yShift}px)scale(1,${Math.abs(\n      ey - sy\n    )})rotate(${ey > sy ? 90 : -90}deg)`;\n  }\n\n  remove(node: HTMLElement) {\n    node.onclick = undefined;\n  }\n\n  add(node: HTMLElement) {\n    node.onclick = (evt) => {\n      const dataIndex = Number.parseInt(node.dataset.i!, 10);\n      if (evt.shiftKey) {\n        const relIndex = Number.parseInt(node.dataset.index!, 10);\n        const ranking = node.parentElement!.dataset.ranking!;\n        if (rangeSelection(this.ctx.provider, ranking, dataIndex, relIndex, evt.ctrlKey)) {\n          return;\n        }\n      }\n      this.ctx.provider.toggleSelection(dataIndex, evt.ctrlKey);\n    };\n  }\n\n  selectRange(rows: { forEach: (c: (item: IGroupItem | IGroupData) => void) => void }, additional = false) {\n    const current = new OrderedSet<number>(additional ? this.ctx.provider.getSelection() : []);\n    const toggle = (dataIndex: number) => {\n      if (current.has(dataIndex)) {\n        current.delete(dataIndex);\n      } else {\n        current.add(dataIndex);\n      }\n    };\n    rows.forEach((d) => {\n      if (isGroup(d)) {\n        forEachIndices(d.order, toggle);\n      } else {\n        toggle(d.dataIndex);\n      }\n    });\n    this.ctx.provider.setSelection(Array.from(current));\n  }\n\n  updateState(node: HTMLElement, dataIndex: number) {\n    if (this.ctx.provider.isSelected(dataIndex)) {\n      node.classList.add(cssClass('selected'));\n    } else {\n      node.classList.remove(cssClass('selected'));\n    }\n  }\n\n  update(node: HTMLElement, selectedDataIndices: { has(dataIndex: number): boolean }) {\n    const dataIndex = Number.parseInt(node.dataset.i!, 10);\n    if (selectedDataIndices.has(dataIndex)) {\n      node.classList.add(cssClass('selected'));\n    } else {\n      node.classList.remove(cssClass('selected'));\n    }\n  }\n}\n","import {\n  ACellTableSection,\n  GridStyleManager,\n  IAbortAblePromise,\n  ICellRenderContext,\n  IExceptionContext,\n  isAbortAble,\n  isAsyncUpdate,\n  isLoadingCell,\n  ITableSection,\n  nonUniformContext,\n  PrefetchMixin,\n  tableIds,\n  uniformContext,\n  IAsyncUpdate,\n} from 'lineupengine';\nimport type { ILineUpFlags } from '../config';\nimport { HOVER_DELAY_SHOW_DETAIL } from '../constants';\nimport { AEventDispatcher, clear, debounce, IEventContext, IEventHandler, IEventListener, suffix } from '../internal';\nimport {\n  Column,\n  IGroupData,\n  IGroupItem,\n  IOrderedGroup,\n  isGroup,\n  isMultiLevelColumn,\n  Ranking,\n  StackColumn,\n  IGroupParent,\n  defaultGroup,\n  IGroup,\n} from '../model';\nimport type { IImposer, IRenderCallback, IRenderContext } from '../renderer';\nimport { CANVAS_HEIGHT, COLUMN_PADDING, cssClass, engineCssClass } from '../styles';\nimport { lineupAnimation } from './animation';\nimport type { IRankingBodyContext, IRankingHeaderContextContainer } from './interfaces';\nimport MultiLevelRenderColumn from './MultiLevelRenderColumn';\nimport RenderColumn, { IRenderers } from './RenderColumn';\nimport SelectionManager from './SelectionManager';\nimport { groupRoots } from '../model/internal';\nimport { isAlwaysShowingGroupStrategy, toRowMeta } from '../provider/internal';\n\nexport interface IEngineRankingContext extends IRankingHeaderContextContainer, IRenderContext {\n  createRenderer(c: Column, imposer?: IImposer): IRenderers;\n}\n\nexport interface IEngineRankingOptions {\n  animation: boolean;\n  levelOfDetail: (rowIndex: number) => 'high' | 'low';\n  customRowUpdate: (row: HTMLElement, rowIndex: number) => void;\n  flags: ILineUpFlags;\n}\n\n/**\n * emitted when the width of the ranking changed\n * @asMemberOf EngineRanking\n * @event\n */\nexport declare function widthChanged(): void;\n/**\n * emitted when the data of the ranking needs to be updated\n * @asMemberOf EngineRanking\n * @event\n */\nexport declare function updateData(): void;\n/**\n * emitted when the table has be recreated\n * @asMemberOf EngineRanking\n * @event\n */\nexport declare function recreate(): void;\n/**\n * emitted when the highlight changes\n * @asMemberOf EngineRanking\n * @param dataIndex the highlighted data index or -1 for none\n * @event\n */\nexport declare function highlightChanged(dataIndex: number): void;\n\n/** @internal */\nclass RankingEvents extends AEventDispatcher {\n  static readonly EVENT_WIDTH_CHANGED = 'widthChanged';\n  static readonly EVENT_UPDATE_DATA = 'updateData';\n  static readonly EVENT_RECREATE = 'recreate';\n  static readonly EVENT_HIGHLIGHT_CHANGED = 'highlightChanged';\n\n  fire(type: string | string[], ...args: any[]) {\n    super.fire(type, ...args);\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        RankingEvents.EVENT_WIDTH_CHANGED,\n        RankingEvents.EVENT_UPDATE_DATA,\n        RankingEvents.EVENT_RECREATE,\n        RankingEvents.EVENT_HIGHLIGHT_CHANGED,\n      ]);\n  }\n}\n\nconst PASSIVE: AddEventListenerOptions = {\n  passive: false,\n};\n\nexport default class EngineRanking extends ACellTableSection<RenderColumn> implements ITableSection, IEventHandler {\n  static readonly EVENT_WIDTH_CHANGED = RankingEvents.EVENT_WIDTH_CHANGED;\n  static readonly EVENT_UPDATE_DATA = RankingEvents.EVENT_UPDATE_DATA;\n  static readonly EVENT_RECREATE = RankingEvents.EVENT_RECREATE;\n  static readonly EVENT_HIGHLIGHT_CHANGED = RankingEvents.EVENT_HIGHLIGHT_CHANGED;\n\n  private _context: ICellRenderContext<RenderColumn>;\n\n  private readonly loadingCanvas = new WeakMap<\n    HTMLCanvasElement,\n    { col: number; render: IAbortAblePromise<IRenderCallback> }[]\n  >();\n\n  private readonly renderCtx: IRankingBodyContext;\n  private data: (IGroupItem | IGroupData)[] = [];\n  private readonly selection: SelectionManager;\n  private highlight = -1;\n  private readonly canvasPool: HTMLCanvasElement[] = [];\n\n  private currentCanvasShift = 0;\n  private currentCanvasWidth = 0;\n\n  private readonly events = new RankingEvents();\n\n  private roptions: Readonly<IEngineRankingOptions> = {\n    animation: true,\n    levelOfDetail: () => 'high',\n    customRowUpdate: () => undefined,\n    flags: {\n      disableFrozenColumns: false,\n      advancedModelFeatures: true,\n      advancedRankingFeatures: true,\n      advancedUIFeatures: true,\n    },\n  };\n\n  private readonly delayedUpdate: (this: { type: string }) => void;\n  private readonly delayedUpdateAll: () => void;\n  private readonly delayedUpdateColumnWidths: () => void;\n  private readonly columns: RenderColumn[];\n\n  private readonly canvasMouseHandler = {\n    timer: new Set<number>(),\n    hoveredRows: new Set<HTMLElement>(),\n    cleanUp: () => {\n      const c = this.canvasMouseHandler;\n      c.timer.forEach((timer) => {\n        clearTimeout(timer);\n      });\n      c.timer.clear();\n      for (const row of Array.from(c.hoveredRows)) {\n        c.unhover(row);\n      }\n    },\n    enter: (evt: MouseEvent) => {\n      const c = this.canvasMouseHandler;\n      c.cleanUp();\n      const row = evt.currentTarget as HTMLElement;\n      row.addEventListener('mouseleave', c.leave, PASSIVE);\n      c.timer.add(\n        setTimeout(() => {\n          c.hoveredRows.add(row);\n          this.updateHoveredRow(row, true);\n        }, HOVER_DELAY_SHOW_DETAIL) as unknown as number\n      );\n    },\n    leave: (evt: MouseEvent | HTMLElement) => {\n      // on row to survive canvas removal\n      const c = this.canvasMouseHandler;\n      const row = (\n        typeof (evt as MouseEvent).currentTarget !== 'undefined' ? (evt as MouseEvent).currentTarget : evt\n      ) as HTMLElement;\n      c.unhover(row);\n\n      c.cleanUp();\n    },\n    unhover: (row: HTMLElement) => {\n      // remove self\n      const c = this.canvasMouseHandler;\n      c.hoveredRows.delete(row);\n      row.removeEventListener('mouseleave', c.leave);\n      if (!EngineRanking.isCanvasRenderedRow(row) && row.parentElement) {\n        // and part of dom\n        setTimeout(() => this.updateHoveredRow(row, false));\n      }\n    },\n  };\n\n  private readonly highlightHandler = {\n    enabled: false,\n    enter: (evt: MouseEvent) => {\n      if (this.highlight >= 0) {\n        const old = this.body.getElementsByClassName(engineCssClass('highlighted'))[0];\n        if (old) {\n          old.classList.remove(engineCssClass('highlighted'));\n        }\n        this.highlight = -1;\n      }\n      const row = evt.currentTarget as HTMLElement;\n      const dataIndex = Number.parseInt(row.dataset.i || '-1', 10);\n      this.events.fire(EngineRanking.EVENT_HIGHLIGHT_CHANGED, dataIndex);\n    },\n    leave: () => {\n      if (this.highlight >= 0) {\n        const old = this.body.getElementsByClassName(engineCssClass('highlighted'))[0];\n        if (old) {\n          old.classList.remove(engineCssClass('highlighted'));\n        }\n        this.highlight = -1;\n      }\n      this.events.fire(EngineRanking.EVENT_HIGHLIGHT_CHANGED, -1);\n    },\n  };\n\n  constructor(\n    public readonly ranking: Ranking,\n    header: HTMLElement,\n    body: HTMLElement,\n    tableId: string,\n    style: GridStyleManager,\n    private readonly ctx: IEngineRankingContext,\n    roptions: Partial<IEngineRankingOptions> = {}\n  ) {\n    super(header, body, tableId, style, { mixins: [PrefetchMixin], batchSize: 20 });\n    Object.assign(this.roptions, roptions);\n    body.dataset.ranking = ranking.id;\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    this.delayedUpdate = debounce(\n      function (this: { type: string; primaryType: string }) {\n        if (this.type !== Ranking.EVENT_DIRTY_VALUES) {\n          that.events.fire(EngineRanking.EVENT_UPDATE_DATA);\n          return;\n        }\n        if (\n          this.primaryType !== Column.EVENT_RENDERER_TYPE_CHANGED &&\n          this.primaryType !== Column.EVENT_GROUP_RENDERER_TYPE_CHANGED &&\n          this.primaryType !== Column.EVENT_LABEL_CHANGED\n        ) {\n          // just the single column will be updated\n          that.updateBody();\n        }\n      },\n      50,\n      (current, next) => {\n        const currentEvent = current.self.type;\n        // order changed is more important\n        return currentEvent === Ranking.EVENT_ORDER_CHANGED ? current : next;\n      }\n    );\n\n    this.delayedUpdateAll = debounce(() => this.updateAll(), 50);\n    this.delayedUpdateColumnWidths = debounce(() => this.updateColumnWidths(), 50);\n    ranking.on(`${Ranking.EVENT_ADD_COLUMN}.hist`, (col: Column, index: number) => {\n      // index doesn't consider the hidden columns\n      const hiddenOffset = this.ranking.children.slice(0, index).reduce((acc, c) => acc + (!c.isVisible() ? 1 : 0), 0);\n      const shiftedIndex = index - hiddenOffset;\n      this.columns.splice(shiftedIndex, 0, this.createCol(col, shiftedIndex));\n      this.reindex();\n      this.delayedUpdateAll();\n    });\n    ranking.on(`${Ranking.EVENT_REMOVE_COLUMN}.body`, (col: Column, index: number) => {\n      EngineRanking.disableListener(col);\n      // index doesn't consider the hidden columns\n      const hiddenOffset = this.ranking.children.slice(0, index).reduce((acc, c) => acc + (!c.isVisible() ? 1 : 0), 0);\n      const shiftedIndex = index - hiddenOffset;\n      this.columns.splice(shiftedIndex, 1);\n      this.reindex();\n      this.delayedUpdateAll();\n    });\n    ranking.on(`${Ranking.EVENT_MOVE_COLUMN}.body`, (col: Column, index: number) => {\n      //delete first\n      const shiftedOld = this.columns.findIndex((d) => d.c === col);\n      const c = this.columns.splice(shiftedOld, 1)[0];\n      // adapt target index based on previous index, i.e shift by one\n      const hiddenOffset = this.ranking.children.slice(0, index).reduce((acc, c) => acc + (!c.isVisible() ? 1 : 0), 0);\n      const shiftedIndex = index - hiddenOffset;\n      this.columns.splice(shiftedOld < shiftedIndex ? shiftedIndex - 1 : shiftedIndex, 0, c);\n      this.reindex();\n      this.delayedUpdateAll();\n    });\n    ranking.on(\n      `${Ranking.EVENT_COLUMN_VISIBILITY_CHANGED}.body`,\n      (col: Column, _oldValue: boolean, newValue: boolean) => {\n        if (newValue) {\n          // become visible\n          const index = ranking.children.indexOf(col);\n          const hiddenOffset = this.ranking.children\n            .slice(0, index)\n            .reduce((acc, c) => acc + (!c.isVisible() ? 1 : 0), 0);\n          const shiftedIndex = index - hiddenOffset;\n          this.columns.splice(shiftedIndex, 0, this.createCol(col, shiftedIndex));\n        } else {\n          // hide\n          const index = this.columns.findIndex((d) => d.c === col);\n          EngineRanking.disableListener(col);\n          this.columns.splice(index, 1);\n        }\n        this.reindex();\n        this.delayedUpdateAll();\n      }\n    );\n    ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.body`, this.delayedUpdate);\n\n    this.selection = new SelectionManager(this.ctx, body);\n    this.selection.on(SelectionManager.EVENT_SELECT_RANGE, (from: number, to: number, additional: boolean) => {\n      this.selection.selectRange(this.data.slice(from, to + 1), additional);\n    });\n\n    this.renderCtx = Object.assign(\n      {\n        isGroup: (index: number) => isGroup(this.data[index]),\n        getRow: (index: number) => this.data[index] as IGroupItem,\n        getGroup: (index: number) => this.data[index] as IGroupData,\n      },\n      ctx\n    );\n\n    // default context\n    this.columns = ranking.children.filter((c) => c.isVisible()).map((c, i) => this.createCol(c, i));\n    this._context = Object.assign(\n      {\n        columns: this.columns,\n        column: nonUniformContext(\n          this.columns.map((w) => w.width),\n          100,\n          COLUMN_PADDING\n        ),\n      },\n      uniformContext(0, 20)\n    );\n\n    this.columns.forEach((column) => {\n      if (column instanceof MultiLevelRenderColumn) {\n        column.updateWidthRule(this.style);\n      }\n      column.renderers = this.ctx.createRenderer(column.c);\n    });\n\n    this.style.updateRule(\n      `hoverOnly${this.tableId}`,\n      `\n      #${tableIds(this.tableId).tbody}:hover > .${engineCssClass('tr')}:hover .${cssClass('hover-only')},\n      #${tableIds(this.tableId).tbody} > .${engineCssClass('tr')}.${cssClass('selected')} .${cssClass('hover-only')},\n      #${tableIds(this.tableId).tbody} > .${engineCssClass('tr')}.${engineCssClass('highlighted')} .${cssClass(\n        'hover-only'\n      )}`,\n      {\n        visibility: 'visible',\n      }\n    );\n\n    this.updateCanvasRule();\n  }\n\n  on(type: typeof EngineRanking.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof EngineRanking.EVENT_UPDATE_DATA, listener: typeof updateData | null): this;\n  on(type: typeof EngineRanking.EVENT_RECREATE, listener: typeof recreate | null): this;\n  on(type: typeof EngineRanking.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    this.events.on(type, listener);\n    return this;\n  }\n\n  get id() {\n    return this.ranking.id;\n  }\n\n  protected onVisibilityChanged(visible: boolean) {\n    super.onVisibilityChanged(visible);\n    if (visible) {\n      this.delayedUpdate.call({ type: Ranking.EVENT_ORDER_CHANGED });\n    }\n  }\n\n  updateHeaders() {\n    this.updateColumnSummaryFlag();\n    return super.updateHeaders();\n  }\n\n  get currentData() {\n    return this.data;\n  }\n\n  get context(): ICellRenderContext<RenderColumn> {\n    return this._context;\n  }\n\n  protected createHeader(_document: Document, column: RenderColumn): HTMLElement | IAsyncUpdate<HTMLElement> {\n    return column.createHeader();\n  }\n\n  private updateColumnSummaryFlag() {\n    // updates the header flag depending on whether there are any sublabels\n    this.header.classList.toggle(\n      cssClass('show-sublabel'),\n      this.columns.some((c) => c.hasSummaryLine())\n    );\n  }\n\n  protected updateHeader(node: HTMLElement, column: RenderColumn) {\n    if (column instanceof MultiLevelRenderColumn) {\n      column.updateWidthRule(this.style);\n    }\n    return column.updateHeader(node);\n  }\n\n  protected createCell(_document: Document, index: number, column: RenderColumn) {\n    return column.createCell(index);\n  }\n\n  private createCellHandled(col: RenderColumn, index: number) {\n    const r = col.createCell(index);\n    let item: HTMLElement;\n    if (isAsyncUpdate(r)) {\n      item = this.handleCellReady(r.item, r.ready, col.index);\n    } else {\n      item = r;\n    }\n    this.initCellClasses(item, col.id);\n    return item;\n  }\n\n  protected updateCell(node: HTMLElement, index: number, column: RenderColumn) {\n    return column.updateCell(node, index);\n  }\n\n  private selectCanvas() {\n    if (this.canvasPool.length > 0) {\n      return this.canvasPool.pop()!;\n    }\n    const c = this.body.ownerDocument!.createElement('canvas');\n    c.classList.add(cssClass(`low-c${this.tableId}`));\n    return c;\n  }\n\n  private rowFlags(row: HTMLElement) {\n    const rowany: any = row;\n    const v = rowany.__lu__;\n    if (v == null) {\n      return (rowany.__lu__ = {});\n    }\n    return v;\n  }\n\n  private visibleRenderedWidth() {\n    let width = 0;\n    for (const col of this.visibleColumns.frozen) {\n      width += this.columns[col].width + COLUMN_PADDING;\n    }\n    for (let col = this.visibleColumns.first; col <= this.visibleColumns.last; ++col) {\n      width += this.columns[col].width + COLUMN_PADDING;\n    }\n    if (width > 0) {\n      width -= COLUMN_PADDING; // for the last one\n    }\n    return width;\n  }\n\n  private pushLazyRedraw(\n    canvas: HTMLCanvasElement,\n    x: number,\n    column: RenderColumn,\n    render: IAbortAblePromise<IRenderCallback>\n  ) {\n    render.then((r) => {\n      const l = this.loadingCanvas.get(canvas) || [];\n      const pos = l.findIndex((d) => d.render === render && d.col === column.index);\n      if (pos < 0) {\n        // not part anymore ignore\n        return;\n      }\n      l.splice(pos, 1);\n      if (typeof r === 'function') {\n        // i.e not aborted\n        const ctx = canvas.getContext('2d')!;\n        ctx.clearRect(x - 1, 0, column.width + 2, canvas.height);\n        ctx.save();\n        ctx.translate(x, 0);\n        r(ctx);\n        ctx.restore();\n      }\n\n      if (l.length > 0) {\n        return;\n      }\n      this.loadingCanvas.delete(canvas);\n      canvas.classList.remove(cssClass('loading-c'));\n    });\n\n    if (!this.loadingCanvas.has(canvas)) {\n      canvas.classList.add(cssClass('loading-c'));\n      this.loadingCanvas.set(canvas, [{ col: column.index, render }]);\n    } else {\n      this.loadingCanvas.get(canvas)!.push({ col: column.index, render });\n    }\n  }\n\n  private renderRow(canvas: HTMLCanvasElement, node: HTMLElement, index: number) {\n    if (this.loadingCanvas.has(canvas)) {\n      for (const a of this.loadingCanvas.get(canvas)!) {\n        a.render.abort();\n      }\n      this.loadingCanvas.delete(canvas);\n    }\n    canvas.classList.remove(cssClass('loading-c'));\n\n    canvas.width = this.currentCanvasWidth;\n    canvas.height = CANVAS_HEIGHT;\n    const ctx = canvas.getContext('2d')!;\n    ctx.imageSmoothingEnabled = false;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    ctx.save();\n    const domColumns: RenderColumn[] = [];\n\n    let x = 0;\n    const renderCellImpl = (col: number) => {\n      const c = this.columns[col];\n      const r = c.renderCell(ctx, index);\n      if (r === true) {\n        domColumns.push(c);\n      } else if (r !== false && isAbortAble(r)) {\n        this.pushLazyRedraw(canvas, x, c, r);\n      }\n      const shift = c.width + COLUMN_PADDING;\n      x += shift;\n      ctx.translate(shift, 0);\n    };\n\n    for (const col of this.visibleColumns.frozen) {\n      renderCellImpl(col);\n    }\n    for (let col = this.visibleColumns.first; col <= this.visibleColumns.last; ++col) {\n      renderCellImpl(col);\n    }\n    ctx.restore();\n\n    const visibleElements = node.childElementCount - 1; // for canvas\n\n    if (domColumns.length === 0) {\n      while (node.lastElementChild !== node.firstElementChild) {\n        const n = node.lastElementChild! as HTMLElement;\n        node.removeChild(n);\n        this.recycleCell(n);\n      }\n      return;\n    }\n    if (domColumns.length === 1) {\n      const first = domColumns[0];\n      if (visibleElements === 0) {\n        const item = this.createCellHandled(first, index);\n        item.classList.add(cssClass('low'));\n        node.appendChild(item);\n        return;\n      }\n      const firstDOM = node.lastElementChild! as HTMLElement;\n      if (visibleElements === 1 && firstDOM.dataset.colId === first.id) {\n        const isLoading = isLoadingCell(firstDOM);\n        if (isLoading) {\n          const item = this.createCellHandled(first, index);\n          node.replaceChild(item, firstDOM);\n          this.recycleCell(firstDOM, first.index);\n          return;\n        }\n        this.updateCellImpl(first, node.lastElementChild as HTMLElement, index);\n        return;\n      }\n    }\n\n    const existing = new Map((Array.from(node.children) as HTMLElement[]).slice(1).map((d) => [d.dataset.id, d]));\n    for (const col of domColumns) {\n      const elem = existing.get(col.id);\n      if (elem && !isLoadingCell(elem)) {\n        existing.delete(col.id);\n        this.updateCellImpl(col, elem, index);\n      } else {\n        const c = this.createCellHandled(col, index);\n        c.classList.add(cssClass('low'));\n        node.appendChild(c);\n      }\n    }\n    existing.forEach((v) => {\n      v.remove();\n      this.recycleCell(v);\n    });\n  }\n\n  protected updateCanvasCell(\n    canvas: HTMLCanvasElement,\n    node: HTMLElement,\n    index: number,\n    column: RenderColumn,\n    x: number\n  ) {\n    // delete lazy that would render the same thing\n    if (this.loadingCanvas.has(canvas)) {\n      const l = this.loadingCanvas.get(canvas)!;\n      const me = l.filter((d) => d.col === column.index);\n      if (me.length > 0) {\n        this.loadingCanvas.set(\n          canvas,\n          l.filter((d) => d.col !== column.index)\n        );\n        for (const a of me) {\n          a.render.abort();\n        }\n      }\n    }\n\n    const ctx = canvas.getContext('2d')!;\n    ctx.clearRect(x - 1, 0, column.width + 2, canvas.height);\n    ctx.save();\n    ctx.translate(x, 0);\n    const needDOM = column.renderCell(ctx, index);\n    ctx.restore();\n\n    if (typeof needDOM !== 'boolean' && isAbortAble(needDOM)) {\n      this.pushLazyRedraw(canvas, x, column, needDOM);\n    }\n\n    if (needDOM !== true && node.childElementCount === 1) {\n      // just canvas\n      return;\n    }\n    const elem = node.querySelector<HTMLElement>(`[data-id=\"${column.id}\"]`);\n    if (elem && !needDOM) {\n      elem.remove();\n      this.recycleCell(elem, column.index);\n      return;\n    }\n    if (elem) {\n      return this.updateCellImpl(column, elem, index);\n    }\n\n    const c = this.createCellHandled(column, index);\n    c.classList.add(cssClass('low'));\n    node.appendChild(c);\n  }\n\n  private reindex() {\n    this.columns.forEach((c, i) => {\n      c.index = i;\n    });\n  }\n\n  updateAll() {\n    this.columns.forEach((c, i) => {\n      c.index = i;\n      c.renderers = this.ctx.createRenderer(c.c);\n    });\n\n    this._context = Object.assign({}, this._context, {\n      column: nonUniformContext(\n        this.columns.map((w) => w.width),\n        100,\n        COLUMN_PADDING\n      ),\n    });\n\n    this.updateColumnSummaryFlag();\n\n    this.events.fire(EngineRanking.EVENT_RECREATE);\n    super.recreate();\n    this.events.fire(EngineRanking.EVENT_WIDTH_CHANGED);\n  }\n\n  updateBody() {\n    if (this.hidden) {\n      return;\n    }\n    this.events.fire(EngineRanking.EVENT_WIDTH_CHANGED);\n    super.forEachRow((row, rowIndex) => this.updateRow(row, rowIndex));\n  }\n\n  updateHeaderOf(col: Column) {\n    const i = this._context.columns.findIndex((d) => d.c === col);\n    if (i < 0) {\n      return false;\n    }\n    const node = this.header.children[i]! as HTMLElement;\n    const column = this._context.columns[i];\n    if (node && column) {\n      this.updateHeader(node, column);\n    }\n    this.updateColumnSummaryFlag();\n    return node && column;\n  }\n\n  protected createRow(node: HTMLElement, rowIndex: number): void {\n    node.classList.add(this.style.cssClasses.tr);\n    this.roptions.customRowUpdate(node, rowIndex);\n    if (this.highlightHandler.enabled) {\n      node.addEventListener('mouseenter', this.highlightHandler.enter, PASSIVE);\n      this.rowFlags(node).highlight = true;\n    }\n\n    const isGroup = this.renderCtx.isGroup(rowIndex);\n\n    const meta = this.toRowMeta(rowIndex);\n    if (!meta) {\n      delete node.dataset.meta;\n    } else {\n      node.dataset.meta = meta;\n    }\n\n    if (isGroup) {\n      node.dataset.agg = 'group';\n      super.createRow(node, rowIndex);\n      return;\n    }\n\n    const { dataIndex } = this.renderCtx.getRow(rowIndex);\n    node.classList.toggle(engineCssClass('highlighted'), this.highlight === dataIndex);\n    node.dataset.i = dataIndex.toString();\n    node.dataset.agg = 'detail'; //or 'group'\n\n    this.selection.updateState(node, dataIndex);\n    this.selection.add(node);\n\n    const low = this.roptions.levelOfDetail(rowIndex) === 'low';\n    node.classList.toggle(cssClass('low'), low);\n\n    if (!low || this.ctx.provider.isSelected(dataIndex)) {\n      super.createRow(node, rowIndex);\n      return;\n    }\n\n    const canvas = this.selectCanvas();\n    node.appendChild(canvas);\n    node.addEventListener('mouseenter', this.canvasMouseHandler.enter, PASSIVE);\n    this.renderRow(canvas, node, rowIndex);\n  }\n\n  protected updateRow(node: HTMLElement, rowIndex: number, hoverLod?: 'high' | 'low'): void {\n    this.roptions.customRowUpdate(node, rowIndex);\n\n    const computedLod = this.roptions.levelOfDetail(rowIndex);\n    const low = (hoverLod ? hoverLod : computedLod) === 'low';\n    const wasLow = node.classList.contains(cssClass('low'));\n    const isGroup = this.renderCtx.isGroup(rowIndex);\n    const wasGroup = node.dataset.agg === 'group';\n\n    node.classList.toggle(cssClass('low'), computedLod === 'low');\n\n    if (this.highlightHandler.enabled && !this.rowFlags(node).highlight) {\n      node.addEventListener('mouseenter', this.highlightHandler.enter, PASSIVE);\n      this.rowFlags(node).highlight = true;\n    }\n\n    if (isGroup !== wasGroup) {\n      // change of mode clear the children to reinitialize them\n      clear(node);\n\n      // adapt body\n      node.dataset.agg = isGroup ? 'group' : 'detail';\n      if (isGroup) {\n        node.dataset.i = '';\n        this.selection.remove(node);\n      } else {\n        this.selection.add(node);\n      }\n    }\n\n    if (wasLow && (!computedLod || isGroup)) {\n      node.removeEventListener('mouseenter', this.canvasMouseHandler.enter);\n    }\n\n    const meta = this.toRowMeta(rowIndex);\n    if (!meta) {\n      delete node.dataset.meta;\n    } else {\n      node.dataset.meta = meta;\n    }\n\n    if (isGroup) {\n      node.classList.remove(engineCssClass('highlighted'));\n      super.updateRow(node, rowIndex);\n      return;\n    }\n\n    const { dataIndex } = this.renderCtx.getRow(rowIndex);\n    node.classList.toggle(engineCssClass('highlighted'), this.highlight === dataIndex);\n    node.dataset.i = dataIndex.toString();\n    this.selection.updateState(node, dataIndex);\n\n    const canvas =\n      wasLow && node.firstElementChild!.nodeName.toLowerCase() === 'canvas'\n        ? (node.firstElementChild! as HTMLCanvasElement)\n        : null;\n    if (!low || this.ctx.provider.isSelected(dataIndex)) {\n      if (canvas) {\n        this.recycleCanvas(canvas);\n        clear(node);\n        node.removeEventListener('mouseenter', this.canvasMouseHandler.enter);\n      }\n      super.updateRow(node, rowIndex);\n      return;\n    }\n\n    // use canvas\n    if (wasLow && canvas) {\n      this.renderRow(canvas, node, rowIndex);\n      return;\n    }\n    // clear old\n    clear(node);\n    node.dataset.agg = 'detail';\n    const canvas2 = this.selectCanvas();\n    node.appendChild(canvas2);\n    node.addEventListener('mouseenter', this.canvasMouseHandler.enter, PASSIVE);\n    this.renderRow(canvas2, node, rowIndex);\n  }\n\n  private updateCanvasBody() {\n    this.updateCanvasRule();\n    super.forEachRow((row, index) => {\n      if (EngineRanking.isCanvasRenderedRow(row)) {\n        this.renderRow(row.firstElementChild! as HTMLCanvasElement, row, index);\n      }\n    });\n  }\n\n  private toRowMeta(rowIndex: number) {\n    const provider = this.renderCtx.provider;\n    const topNGetter = (group: IGroup) => provider.getTopNAggregated(this.ranking, group);\n    return toRowMeta(this.renderCtx.getRow(rowIndex), provider.getAggregationStrategy(), topNGetter);\n  }\n\n  private updateCanvasRule() {\n    this.style.updateRule(`renderCanvas${this.tableId}`, `.${cssClass(`low-c${this.tableId}`)}`, {\n      transform: `translateX(${this.currentCanvasShift}px)`,\n      width: `${this.currentCanvasWidth}px`,\n    });\n  }\n\n  protected updateShifts(top: number, left: number) {\n    super.updateShifts(top, left);\n\n    const width = this.visibleRenderedWidth();\n    if (left === this.currentCanvasShift && width === this.currentCanvasWidth) {\n      return;\n    }\n\n    this.currentCanvasShift = left;\n    this.currentCanvasWidth = width;\n    this.updateCanvasBody();\n  }\n\n  private recycleCanvas(canvas: HTMLCanvasElement) {\n    if (this.loadingCanvas.has(canvas)) {\n      for (const a of this.loadingCanvas.get(canvas)!) {\n        a.render.abort();\n      }\n      this.loadingCanvas.delete(canvas);\n    } else if (!canvas.classList.contains(cssClass('loading-c'))) {\n      this.canvasPool.push(canvas);\n    }\n  }\n\n  enableHighlightListening(enable: boolean) {\n    if (this.highlightHandler.enabled === enable) {\n      return;\n    }\n\n    this.highlightHandler.enabled = enable;\n\n    if (enable) {\n      this.body.addEventListener('mouseleave', this.highlightHandler.leave, PASSIVE);\n      super.forEachRow((row) => {\n        row.addEventListener('mouseenter', this.highlightHandler.enter, PASSIVE);\n        this.rowFlags(row).highlight = true;\n      });\n      return;\n    }\n\n    this.body.removeEventListener('mouseleave', this.highlightHandler.leave);\n\n    super.forEachRow((row) => {\n      row.removeEventListener('mouseenter', this.highlightHandler.enter);\n      this.rowFlags(row).highlight = false;\n    });\n  }\n\n  private updateHoveredRow(row: HTMLElement, hover: boolean) {\n    const isCanvas = EngineRanking.isCanvasRenderedRow(row);\n    if (isCanvas !== hover) {\n      return; // good nothing to do\n    }\n    const index = Number.parseInt(row.dataset.index!, 10);\n    this.updateRow(row, index, hover ? 'high' : 'low');\n  }\n\n  protected forEachRow(callback: (row: HTMLElement, rowIndex: number) => void, inplace = false) {\n    const adapter = (row: HTMLElement, rowIndex: number) => {\n      if (EngineRanking.isCanvasRenderedRow(row)) {\n        // skip canvas\n        return;\n      }\n      callback(row, rowIndex);\n    };\n    return super.forEachRow(adapter, inplace);\n  }\n\n  updateSelection(selectedDataIndices: { has(i: number): boolean }) {\n    super.forEachRow((node: HTMLElement, rowIndex: number) => {\n      if (this.renderCtx.isGroup(rowIndex)) {\n        this.updateRow(node, rowIndex);\n      } else {\n        // fast pass for item\n        this.selection.update(node, selectedDataIndices);\n      }\n    }, true);\n  }\n\n  updateColumnWidths() {\n    // update the column context in place\n    (this._context as any).column = nonUniformContext(\n      this._context.columns.map((w) => w.width),\n      100,\n      COLUMN_PADDING\n    );\n    super.updateColumnWidths();\n    const { columns } = this.context;\n    //no data update needed since just width changed\n    columns.forEach((column) => {\n      if (column instanceof MultiLevelRenderColumn) {\n        column.updateWidthRule(this.style);\n      }\n      column.renderers = this.ctx.createRenderer(column.c);\n    });\n    this.events.fire(EngineRanking.EVENT_WIDTH_CHANGED);\n  }\n\n  private computeShiftedIndex(index: number) {\n    const columns = this.context.columns;\n    // may not match if not all left columns are shown\n    let leftOffset = 0;\n    let indexOffset = 0;\n    // shift frozen ones\n    for (let frozenIndex of this.visibleColumns.frozen) {\n      if (frozenIndex >= this.visibleColumns.first) {\n        break;\n      }\n      leftOffset += columns[frozenIndex].width + COLUMN_PADDING;\n      indexOffset--;\n    }\n    // shift visible before\n    indexOffset += this.visibleColumns.first;\n    for (let i = this.visibleColumns.first; i < index; ++i) {\n      leftOffset += columns[i].width + COLUMN_PADDING;\n    }\n    return {\n      leftOffset,\n      indexOffset,\n    };\n  }\n\n  private updateColumn(index: number) {\n    const columns = this.context.columns;\n    const column = columns[index];\n    if (!column) {\n      return false;\n    }\n    const { leftOffset, indexOffset } = this.computeShiftedIndex(index);\n\n    super.forEachRow((row, rowIndex) => {\n      if (EngineRanking.isCanvasRenderedRow(row)) {\n        this.updateCanvasCell(row.firstElementChild! as HTMLCanvasElement, row, rowIndex, column, leftOffset);\n        return;\n      }\n      this.updateCellImpl(column, row.children[index - indexOffset] as HTMLElement, rowIndex);\n    });\n    return true;\n  }\n\n  private updateCellImpl(column: RenderColumn, before: HTMLElement, rowIndex: number) {\n    if (!before) {\n      return; // race condition\n    }\n    const r = this.updateCell(before, rowIndex, column);\n    let after: HTMLElement;\n    if (isAsyncUpdate(r)) {\n      after = this.handleCellReady(r.item, r.ready, column.index);\n    } else {\n      after = r;\n    }\n    if (before === after || !after) {\n      return;\n    }\n    this.initCellClasses(after, column.id);\n    before.parentElement!.replaceChild(after, before);\n  }\n\n  private initCellClasses(node: HTMLElement, id: string) {\n    node.dataset.id = id;\n    node.classList.add(engineCssClass('td'), this.style.cssClasses.td, engineCssClass(`td-${this.tableId}`));\n  }\n\n  destroy() {\n    super.destroy();\n    this.style.deleteRule(`hoverOnly${this.tableId}`);\n    this.style.deleteRule(`renderCanvas${this.tableId}`);\n    this.ranking.flatColumns.forEach((c) => EngineRanking.disableListener(c));\n  }\n\n  groupData(): (IGroupItem | IGroupData)[] {\n    const groups = this.ranking.getGroups();\n    const provider = this.ctx.provider;\n    const strategy = provider.getAggregationStrategy();\n    const alwaysShowGroup = isAlwaysShowingGroupStrategy(strategy);\n\n    const r: (IGroupItem | IGroupData)[] = [];\n\n    if (groups.length === 0) {\n      return r;\n    }\n\n    const pushItem = (group: IOrderedGroup, dataIndex: number, i: number) => {\n      r.push({\n        group,\n        dataIndex,\n        relativeIndex: i,\n      });\n    };\n\n    if (groups.length === 1 && groups[0].name === defaultGroup.name) {\n      const group = groups[0];\n      const l = group.order.length;\n      for (let i = 0; i < l; ++i) {\n        pushItem(group, group.order[i], i);\n      }\n      return r;\n    }\n\n    const roots = groupRoots(groups);\n\n    const pushGroup = (group: IOrderedGroup | Readonly<IGroupParent>) => {\n      const n = provider.getTopNAggregated(this.ranking, group);\n\n      // all are IOrderedGroup since propagated\n      const ordered = group as IOrderedGroup;\n      const groupParent = group as IGroupParent;\n\n      if (n === 0 || alwaysShowGroup) {\n        r.push(ordered);\n      }\n\n      if (n !== 0 && Array.isArray(groupParent.subGroups) && groupParent.subGroups.length > 0) {\n        for (const g of groupParent.subGroups) {\n          pushGroup(g as IOrderedGroup | Readonly<IGroupParent>);\n        }\n        return;\n      }\n\n      const l = n < 0 ? ordered.order.length : Math.min(n, ordered.order.length);\n      for (let i = 0; i < l; ++i) {\n        pushItem(ordered, ordered.order[i], i);\n      }\n    };\n\n    for (const root of roots) {\n      pushGroup(root);\n    }\n\n    return r;\n  }\n\n  render(data: (IGroupItem | IGroupData)[], rowContext: IExceptionContext) {\n    const previous = this._context;\n    const previousData = this.data;\n    this.data = data;\n\n    this.columns.forEach((c, i) => {\n      c.index = i;\n      c.renderers = this.ctx.createRenderer(c.c);\n    });\n    this._context = Object.assign(\n      {\n        columns: this.columns,\n        column: nonUniformContext(\n          this.columns.map((w) => w.width),\n          100,\n          COLUMN_PADDING\n        ),\n      },\n      rowContext\n    );\n\n    if (!this.bodyScroller) {\n      // somehow not part of dom\n      return;\n    }\n    this.events.fire(EngineRanking.EVENT_RECREATE);\n    return super.recreate(this.roptions.animation ? lineupAnimation(previous, previousData, this.data) : undefined);\n  }\n\n  setHighlight(dataIndex: number) {\n    this.highlight = dataIndex;\n    const old = this.body.querySelector(`[data-i].${engineCssClass('highlighted')}`);\n    if (old) {\n      old.classList.remove(engineCssClass('highlighted'));\n    }\n    if (dataIndex < 0) {\n      return false;\n    }\n    const item = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\n    if (item) {\n      item.classList.add(engineCssClass('highlighted'));\n    }\n    return item != null;\n  }\n\n  findNearest(dataIndices: number[]) {\n    // find the nearest visible data index\n    // first check if already visible\n    const index = dataIndices.find((d) => Boolean(this.body.querySelectorAll(`[data-i=\"${d}\"]`)));\n    if (index != null) {\n      return index; // visible one\n    }\n    const visible = this.visible;\n    const lookFor = new Set(dataIndices);\n    let firstBeforePos = -1;\n    let firstAfterPos = -1;\n    for (let i = visible.first; i >= 0; --i) {\n      const d = this.data[i];\n      if (!isGroup(d) && lookFor.has(d.dataIndex)) {\n        firstBeforePos = i;\n        break;\n      }\n    }\n    for (let i = visible.last; i < this.data.length; ++i) {\n      const d = this.data[i];\n      if (!isGroup(d) && lookFor.has(d.dataIndex)) {\n        firstAfterPos = i;\n        break;\n      }\n    }\n\n    if (firstBeforePos < 0 && firstBeforePos < 0) {\n      return -1; // not found at all\n    }\n    const nearestPos =\n      firstBeforePos >= 0 && visible.first - firstBeforePos < firstAfterPos - visible.last\n        ? firstBeforePos\n        : firstAfterPos;\n    return (this.data[nearestPos] as IGroupItem).dataIndex;\n  }\n\n  scrollIntoView(dataIndex: number) {\n    const item = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\n    if (item) {\n      item.scrollIntoView(true);\n      return true;\n    }\n    const index = this.data.findIndex((d) => !isGroup(d) && d.dataIndex === dataIndex);\n    if (index < 0) {\n      return false; // part of a group?\n    }\n\n    const posOf = () => {\n      const c = this._context;\n      if (c.exceptions.length === 0 || index < c.exceptions[0].index) {\n        // fast pass\n        return index * c.defaultRowHeight;\n      }\n      const before = c.exceptions\n        .slice()\n        .reverse()\n        .find((d) => d.index <= index);\n      if (!before) {\n        return -1;\n      }\n      if (before.index === index) {\n        return before.y;\n      }\n      const regular = index - before.index - 1;\n      return before.y2 + regular * c.defaultRowHeight;\n    };\n    const pos = posOf();\n    if (pos < 0) {\n      return false;\n    }\n    const scroller = this.bodyScroller;\n    if (!scroller) {\n      return false;\n    }\n    const top = scroller.scrollTop;\n    scroller.scrollTop = Math.min(pos, scroller.scrollHeight - scroller.clientHeight);\n    this.onScrolledVertically(scroller.scrollTop, scroller.clientHeight, top < scroller.scrollTop);\n\n    const found = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\n    if (found) {\n      found.scrollIntoView(true);\n      return true;\n    }\n    return false;\n  }\n\n  getHighlight() {\n    const item = this.body.querySelector<HTMLElement>(`[data-i]:hover, [data-i].${engineCssClass('highlighted')}`);\n    if (item) {\n      return Number.parseInt(item.dataset.i!, 10);\n    }\n    return this.highlight;\n  }\n\n  private createCol(c: Column, index: number) {\n    const col =\n      isMultiLevelColumn(c) && !c.getCollapsed()\n        ? new MultiLevelRenderColumn(c, index, this.renderCtx, this.roptions.flags)\n        : new RenderColumn(c, index, this.renderCtx, this.roptions.flags);\n\n    c.on(`${Column.EVENT_WIDTH_CHANGED}.body`, () => {\n      // replace myself upon width change since we renderers are allowed to\n      col.renderers = this.ctx.createRenderer(c);\n      this.delayedUpdateColumnWidths();\n    });\n    const debounceUpdate = debounce(() => {\n      const valid = this.updateColumn(col.index);\n      if (!valid) {\n        EngineRanking.disableListener(c); // destroy myself\n      }\n    }, 25);\n    c.on([`${Column.EVENT_RENDERER_TYPE_CHANGED}.body`, `${Column.EVENT_GROUP_RENDERER_TYPE_CHANGED}.body`], () => {\n      // replace myself upon renderer type change\n      col.renderers = this.ctx.createRenderer(c);\n      debounceUpdate();\n    });\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    c.on(`${Column.EVENT_DIRTY_HEADER}.body`, function (this: IEventContext) {\n      const valid = that.updateHeaderOf(col.c);\n      if (!valid) {\n        EngineRanking.disableListener(c); // destroy myself\n      }\n    });\n    c.on(suffix('.body', Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_CACHES), () => {\n      // replace myself upon renderer type change\n      col.renderers = this.ctx.createRenderer(c);\n      const valid = this.updateHeaderOf(col.c);\n      if (!valid) {\n        EngineRanking.disableListener(c); // destroy myself\n      }\n    });\n    c.on(`${Column.EVENT_DIRTY_VALUES}.body`, debounceUpdate);\n\n    if (isMultiLevelColumn(c)) {\n      c.on(`${StackColumn.EVENT_COLLAPSE_CHANGED}.body`, () => {\n        // rebuild myself from scratch\n        EngineRanking.disableListener(c); // destroy myself\n        const index = col.index;\n        const replacement = this.createCol(c, index);\n        replacement.index = index;\n        this.columns.splice(index, 1, replacement);\n        this.delayedUpdateAll();\n      });\n      if (!c.getCollapsed()) {\n        (col as MultiLevelRenderColumn).updateWidthRule(this.style);\n        c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.body`, () => {\n          (col as MultiLevelRenderColumn).updateWidthRule(this.style);\n        });\n        c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.bodyUpdate`, debounceUpdate);\n      }\n    }\n\n    return col;\n  }\n\n  private static isCanvasRenderedRow(row: HTMLElement) {\n    return (\n      row.classList.contains(cssClass('low')) &&\n      row.childElementCount >= 1 &&\n      row.firstElementChild!.nodeName.toLowerCase() === 'canvas'\n    );\n  }\n\n  private static disableListener(c: Column) {\n    c.on(`${Column.EVENT_WIDTH_CHANGED}.body`, null);\n    c.on(\n      suffix(\n        '.body',\n        Column.EVENT_RENDERER_TYPE_CHANGED,\n        Column.EVENT_GROUP_RENDERER_TYPE_CHANGED,\n        Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_LABEL_CHANGED\n      ),\n      null\n    );\n    c.on(`${Ranking.EVENT_DIRTY_HEADER}.body`, null);\n    c.on(`${Ranking.EVENT_DIRTY_VALUES}.body`, null);\n\n    if (!isMultiLevelColumn(c)) {\n      return;\n    }\n    c.on(`${StackColumn.EVENT_COLLAPSE_CHANGED}.body`, null);\n    c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.body`, null);\n    c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.bodyUpdate`, null);\n  }\n}\n","import type { ILineUpFlags } from '../config';\nimport type { Column, IGroupData, IGroupItem } from '../model';\nimport type { IDataProvider } from '../provider';\nimport type { IImposer, IRenderContext, ISummaryRenderer } from '../renderer';\nimport type DialogManager from './dialogs/DialogManager';\nimport type { IDialogContext } from './dialogs';\n\nexport interface IUIOptions {\n  /**\n   * whether to show this action as a shortcut action\n   * @default 'menu'\n   */\n  mode:\n    | 'menu'\n    | 'menu+shortcut'\n    | 'shortcut'\n    | ((col: Column, mode: 'sidePanel' | 'header') => 'menu' | 'menu+shortcut' | 'shortcut');\n\n  /**\n   * order hint for sorting actions\n   * @default 50\n   */\n  order: number;\n\n  featureLevel: 'basic' | 'advanced';\n  featureCategory: 'ranking' | 'model' | 'ui';\n}\n\nexport interface IOnClickHandler {\n  (col: Column, evt: MouseEvent, ctx: IRankingHeaderContext, level: number, viaShortcut: boolean): any;\n}\n\nexport interface IToolbarAction {\n  title: string;\n\n  enabled?(col: Column): boolean;\n\n  onClick: IOnClickHandler;\n\n  options: Partial<IUIOptions>;\n}\n\nexport interface IToolbarDialogAddonHandler {\n  elems: string | (HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement)[];\n  reset(): void;\n  submit(): boolean | undefined;\n  cancel(): void;\n}\n\nexport interface IToolbarDialogAddon {\n  title: string;\n\n  order: number;\n\n  append(\n    col: Column,\n    node: HTMLElement,\n    dialog: IDialogContext,\n    ctx: IRankingHeaderContext\n  ): IToolbarDialogAddonHandler;\n}\n\nexport interface IRenderInfo {\n  type: string;\n  label: string;\n}\n\nexport interface IRankingHeaderContextContainer {\n  readonly idPrefix: string;\n  readonly document: Document;\n  readonly provider: IDataProvider;\n\n  readonly dialogManager: DialogManager;\n\n  asElement(html: string): HTMLElement;\n  sanitize(text: string): string;\n\n  resolveToolbarActions(col: Column, keys: string[]): IToolbarAction[];\n  resolveToolbarDialogAddons(col: Column, keys: string[]): IToolbarDialogAddon[];\n\n  readonly flags: ILineUpFlags;\n\n  getPossibleRenderer(col: Column): { item: IRenderInfo[]; group: IRenderInfo[]; summary: IRenderInfo[] };\n\n  summaryRenderer(co: Column, interactive: boolean, imposer?: IImposer): ISummaryRenderer;\n\n  readonly caches: {\n    toolbar: Map<string, IToolbarAction[]>;\n    toolbarAddons: Map<string, IToolbarDialogAddon[]>;\n  };\n}\n\nexport interface IRankingBodyContext extends IRankingHeaderContextContainer, IRenderContext {\n  isGroup(index: number): boolean;\n\n  getGroup(index: number): IGroupData;\n\n  getRow(index: number): IGroupItem;\n}\n\nexport declare type IRankingHeaderContext = Readonly<IRankingHeaderContextContainer>;\n\nexport declare type IRankingContext = Readonly<IRankingBodyContext>;\n\nexport enum EMode {\n  ITEM = 'item',\n  BAND = 'band',\n}\n","import { IExceptionContext, ITableSection, range } from 'lineupengine';\nimport { IGroupData, IGroupItem, IOrderedGroup, isGroup, Ranking } from '../model';\nimport { aria, cssClass, engineCssClass, SLOPEGRAPH_WIDTH } from '../styles';\nimport { IRankingHeaderContextContainer, EMode } from './interfaces';\nimport { forEachIndices, filterIndices } from '../model/internal';\n\ninterface ISlope {\n  isSelected(selection: { has(dataIndex: number): boolean }): boolean;\n\n  update(path: SVGPathElement, width: number): void;\n\n  readonly dataIndices: number[];\n}\n\nclass ItemSlope implements ISlope {\n  constructor(private readonly left: number, private readonly right: number, public readonly dataIndices: number[]) {}\n\n  isSelected(selection: { has(dataIndex: number): boolean }) {\n    return this.dataIndices.length === 1\n      ? selection.has(this.dataIndices[0])\n      : this.dataIndices.some((s) => selection.has(s));\n  }\n\n  update(path: SVGPathElement, width: number) {\n    path.setAttribute('data-i', String(this.dataIndices[0]));\n    path.setAttribute('class', cssClass('slope'));\n    path.setAttribute('d', `M0,${this.left}L${width},${this.right}`);\n  }\n}\n\nclass GroupSlope implements ISlope {\n  constructor(\n    private readonly left: [number, number],\n    private readonly right: [number, number],\n    public readonly dataIndices: number[]\n  ) {}\n\n  isSelected(selection: { has(dataIndex: number): boolean }) {\n    return this.dataIndices.some((s) => selection.has(s));\n  }\n\n  update(path: SVGPathElement, width: number) {\n    path.setAttribute('class', cssClass('group-slope'));\n    path.setAttribute('d', `M0,${this.left[0]}L${width},${this.right[0]}L${width},${this.right[1]}L0,${this.left[1]}Z`);\n  }\n}\n\ninterface IPos {\n  start: number;\n  heightPerRow: number;\n  rows: number[]; // data indices\n  offset: number;\n  ref: number[];\n  group: IOrderedGroup;\n}\n\nexport interface ISlopeGraphOptions {\n  mode: EMode;\n}\n\nexport default class SlopeGraph implements ITableSection {\n  readonly node: SVGSVGElement;\n\n  private leftSlopes: ISlope[][] = [];\n  // rendered row to one ore multiple slopes\n  private rightSlopes: ISlope[][] = [];\n  private readonly pool: SVGPathElement[] = [];\n\n  private scrollListener: ((act: { top: number; height: number }) => void) | null = null;\n\n  readonly width = SLOPEGRAPH_WIDTH;\n  readonly height = 0;\n\n  private current: {\n    leftRanking: Ranking;\n    left: (IGroupItem | IGroupData)[];\n    leftContext: IExceptionContext;\n    rightRanking: Ranking;\n    right: (IGroupItem | IGroupData)[];\n    rightContext: IExceptionContext;\n  } | null = null;\n\n  private chosen = new Set<ISlope>();\n  private chosenSelectionOnly = new Set<ISlope>();\n\n  private _mode: EMode = EMode.ITEM;\n\n  constructor(\n    public readonly header: HTMLElement,\n    public readonly body: HTMLElement,\n    public readonly id: string,\n    private readonly ctx: IRankingHeaderContextContainer,\n    options: Partial<ISlopeGraphOptions> = {}\n  ) {\n    this.node = header.ownerDocument!.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    this.node.innerHTML = `<g transform=\"translate(0,0)\"></g>`;\n    header.classList.add(cssClass('slopegraph-header'));\n    this._mode = options.mode === EMode.BAND ? EMode.BAND : EMode.ITEM;\n    this.initHeader(header);\n    body.classList.add(cssClass('slopegraph'));\n    this.body.style.height = `1px`;\n    body.appendChild(this.node);\n  }\n\n  init() {\n    this.hide(); // hide by default\n\n    const scroller = this.body.parentElement! as any;\n\n    //sync scrolling of header and body\n    // use internals from lineup engine\n    const scroll = scroller.__le_scroller__;\n    let old: { top: number; height: number } = scroll.asInfo();\n    scroll.push(\n      'animation',\n      (this.scrollListener = (act: { top: number; height: number }) => {\n        if (Math.abs(old.top - act.top) < 5) {\n          return;\n        }\n        old = act;\n        this.onScrolledVertically(act.top, act.height);\n      })\n    );\n  }\n\n  private initHeader(header: HTMLElement) {\n    const active = cssClass('active');\n    header.innerHTML = `<i title=\"Item\" class=\"${this._mode === EMode.ITEM ? active : ''}\">${aria('Item')}</i>\n        <i title=\"Band\" class=\"${this._mode === EMode.BAND ? active : ''}\">${aria('Band')}</i>`;\n\n    const icons = Array.from(header.children) as HTMLElement[];\n    icons.forEach((n: HTMLElement, i) => {\n      n.onclick = (evt) => {\n        evt.preventDefault();\n        evt.stopPropagation();\n        if (n.classList.contains(active)) {\n          return;\n        }\n        this.mode = i === 0 ? EMode.ITEM : EMode.BAND;\n        icons.forEach((d, j) => d.classList.toggle(active, j === i));\n      };\n    });\n  }\n\n  get mode() {\n    return this._mode;\n  }\n\n  set mode(value: EMode) {\n    if (value === this._mode) {\n      return;\n    }\n    this._mode = value;\n    if (this.current) {\n      this.rebuild(\n        this.current.leftRanking,\n        this.current.left,\n        this.current.leftContext,\n        this.current.rightRanking,\n        this.current.right,\n        this.current.rightContext\n      );\n    }\n  }\n\n  get hidden() {\n    return this.header.classList.contains(engineCssClass('loading'));\n  }\n\n  set hidden(value: boolean) {\n    this.header.classList.toggle(engineCssClass('loading'), value);\n    this.body.classList.toggle(engineCssClass('loading'), value);\n  }\n\n  hide() {\n    this.hidden = true;\n  }\n\n  show() {\n    const was = this.hidden;\n    this.hidden = false;\n    if (was) {\n      this.revalidate();\n    }\n  }\n\n  destroy() {\n    this.header.remove();\n    if (this.scrollListener) {\n      //sync scrolling of header and body\n      // use internals from lineup engine\n      const scroll = (this.body.parentElement! as any).__le_scroller__;\n      scroll.remove(this.scrollListener);\n    }\n    this.body.remove();\n  }\n\n  rebuild(\n    leftRanking: Ranking,\n    left: (IGroupItem | IGroupData)[],\n    leftContext: IExceptionContext,\n    rightRanking: Ranking,\n    right: (IGroupItem | IGroupData)[],\n    rightContext: IExceptionContext\n  ) {\n    this.current = { leftRanking, left, leftContext, right, rightRanking, rightContext };\n\n    const lookup: Map<number, IPos> = this.prepareRightSlopes(right, rightContext);\n    this.computeSlopes(left, leftContext, lookup);\n\n    this.revalidate();\n  }\n\n  private computeSlopes(left: (IGroupItem | IGroupData)[], leftContext: IExceptionContext, lookup: Map<number, IPos>) {\n    const mode = this.mode;\n    const fakeGroups = new Map<IOrderedGroup, ISlope[]>();\n\n    const createFakeGroup = (first: number, group: IOrderedGroup) => {\n      let count = 0;\n      let height = 0;\n      // find all items in this group, assuming that they are in order\n      for (let i = first; i < left.length; ++i) {\n        const item = left[i];\n        if (isGroup(item) || (item as IGroupItem).group !== group) {\n          break;\n        }\n        count++;\n        height += leftContext.exceptionsLookup.get(i) || leftContext.defaultRowHeight;\n      }\n\n      const padded = height - leftContext.padding(first + count - 1);\n\n      const gr = group;\n\n      return { gr, padded, height };\n    };\n\n    let acc = 0;\n    this.leftSlopes = left.map((r, i) => {\n      let height = leftContext.exceptionsLookup.get(i) || leftContext.defaultRowHeight;\n      let padded = height - 0; //leftContext.padding(i);\n      const slopes: ISlope[] = [];\n      const start = acc;\n\n      // shift by item height\n      acc += height;\n\n      let offset = 0;\n\n      const push = (s: ISlope, right: IPos, common = 1, heightPerRow = 0) => {\n        // store slope in both\n        slopes.push(s);\n        forEachIndices(right.ref, (r) => this.rightSlopes[r].push(s));\n\n        // update the offset of myself and of the right side\n        right.offset += common * right.heightPerRow;\n        offset += common * heightPerRow;\n      };\n\n      let gr: IGroupData;\n\n      if (isGroup(r)) {\n        gr = r;\n      } else {\n        const item = r as IGroupItem;\n        const dataIndex = item.dataIndex;\n        const right = lookup.get(dataIndex);\n\n        if (!right) {\n          // no match\n          return slopes;\n        }\n        if (mode === EMode.ITEM) {\n          const s = new ItemSlope(start + padded / 2, right.start + right.offset + right.heightPerRow / 2, [dataIndex]);\n          push(s, right);\n          return slopes;\n        }\n\n        if (fakeGroups.has(item.group)) {\n          // already handled by the first one, take the fake slopes\n          return fakeGroups.get(item.group)!;\n        }\n\n        const fakeGroup = createFakeGroup(i, item.group);\n        gr = fakeGroup.gr;\n        height = fakeGroup.height;\n        padded = fakeGroup.padded;\n        fakeGroups.set(item.group, slopes);\n      }\n\n      // free group items to share\n      const free = new Set(gr.order);\n\n      const heightPerRow = padded / gr.order.length;\n\n      forEachIndices(gr.order, (d: number) => {\n        if (!free.has(d)) {\n          return; // already handled\n        }\n        free.delete(d);\n        const right = lookup.get(d);\n        if (!right) {\n          return; // no matching\n        }\n        // find all of this group\n        const intersection = filterIndices(right.rows, (r) => free.delete(r));\n        intersection.push(d); //self\n\n        const common = intersection.length;\n        let s: ISlope;\n        if (common === 1) {\n          s = new ItemSlope(start + offset + heightPerRow / 2, right.start + right.offset + right.heightPerRow / 2, [\n            d,\n          ]);\n        } else if (mode === EMode.ITEM) {\n          // fake item\n          s = new ItemSlope(\n            start + offset + (heightPerRow * common) / 2,\n            right.start + right.offset + (right.heightPerRow * common) / 2,\n            intersection\n          );\n        } else {\n          s = new GroupSlope(\n            [start + offset, start + offset + heightPerRow * common],\n            [right.start + right.offset, right.start + right.offset + right.heightPerRow * common],\n            intersection\n          );\n        }\n        push(s, right, common, heightPerRow);\n      });\n      return slopes;\n    });\n  }\n\n  private prepareRightSlopes(right: (IGroupItem | IGroupData)[], rightContext: IExceptionContext) {\n    const lookup = new Map<number, IPos>();\n    const mode = this.mode;\n\n    const fakeGroups = new Map<IOrderedGroup, IPos>();\n    let acc = 0;\n\n    this.rightSlopes = right.map((r, i) => {\n      const height = rightContext.exceptionsLookup.get(i) || rightContext.defaultRowHeight;\n      const padded = height - 0; //rightContext.padding(i);\n      const start = acc;\n      acc += height;\n      const slopes: ISlope[] = [];\n\n      const base = {\n        start,\n        offset: 0,\n        ref: [i],\n      };\n      if (isGroup(r)) {\n        const p = Object.assign(base, {\n          rows: Array.from(r.order),\n          heightPerRow: padded / r.order.length,\n          group: r,\n        });\n\n        forEachIndices(r.order, (ri) => lookup.set(ri, p));\n        return slopes;\n      }\n      // item\n      const item = r as IGroupItem;\n      const dataIndex = r.dataIndex;\n\n      let p = Object.assign(base, {\n        rows: [dataIndex],\n        heightPerRow: padded,\n        group: item.group,\n      });\n\n      if (mode === EMode.ITEM) {\n        lookup.set(dataIndex, p);\n        return slopes;\n      }\n      // forced band mode\n      // merge with the 'ueber' band\n      if (!fakeGroups.has(item.group)) {\n        p.heightPerRow = height; // include padding\n        // TODO just support uniform item height\n        fakeGroups.set(item.group, p);\n      } else {\n        // reuse old\n        p = fakeGroups.get(item.group)!;\n        p.rows.push(dataIndex);\n        p.ref.push(i);\n      }\n      lookup.set(dataIndex, p);\n      return slopes;\n    });\n\n    return lookup;\n  }\n\n  private revalidate() {\n    if (!this.current || this.hidden) {\n      return;\n    }\n    const p = this.body.parentElement!;\n    this.onScrolledVertically(p.scrollTop, p.clientHeight);\n  }\n\n  highlight(dataIndex: number) {\n    const highlight = engineCssClass('highlighted');\n    const old = this.body.querySelector(`[data-i].${highlight}`);\n    if (old) {\n      old.classList.remove(highlight);\n    }\n    if (dataIndex < 0) {\n      return false;\n    }\n    const item = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\n    if (item) {\n      item.classList.add(highlight);\n    }\n    return item != null;\n  }\n\n  private onScrolledVertically(scrollTop: number, clientHeight: number) {\n    if (!this.current) {\n      return;\n    }\n\n    // which lines are currently shown\n    const { leftContext, rightContext } = this.current;\n    const left = range(\n      scrollTop,\n      clientHeight,\n      leftContext.defaultRowHeight,\n      leftContext.exceptions,\n      leftContext.numberOfRows\n    );\n    const right = range(\n      scrollTop,\n      clientHeight,\n      rightContext.defaultRowHeight,\n      rightContext.exceptions,\n      rightContext.numberOfRows\n    );\n\n    const start = Math.min(left.firstRowPos, right.firstRowPos);\n    const end = Math.max(left.endPos, right.endPos);\n\n    // move to right position\n    this.body.style.transform = `translate(0, ${start.toFixed(0)}px)`;\n    this.body.style.height = `${(end - start).toFixed(0)}px`;\n    this.node.firstElementChild!.setAttribute('transform', `translate(0,-${start.toFixed(0)})`);\n\n    this.chosen = this.choose(left.first, left.last, right.first, right.last);\n    this.render(this.chosen, this.chooseSelection(left.first, left.last, this.chosen));\n  }\n\n  private choose(\n    leftVisibleFirst: number,\n    leftVisibleLast: number,\n    rightVisibleFirst: number,\n    rightVisibleLast: number\n  ) {\n    // assume no separate scrolling\n\n    const slopes = new Set<ISlope>();\n    for (let i = leftVisibleFirst; i <= leftVisibleLast; ++i) {\n      for (const s of this.leftSlopes[i]) {\n        slopes.add(s);\n      }\n    }\n    for (let i = rightVisibleFirst; i <= rightVisibleLast; ++i) {\n      for (const s of this.rightSlopes[i]) {\n        slopes.add(s);\n      }\n    }\n    return slopes;\n  }\n\n  private chooseSelection(leftVisibleFirst: number, leftVisibleLast: number, alreadyVisible: Set<ISlope>) {\n    const slopes = new Set<ISlope>();\n    // ensure selected slopes are always part of\n    const p = this.ctx.provider;\n\n    if (p.getSelection().length === 0) {\n      return slopes;\n    }\n\n    const selectionLookup = { has: (dataIndex: number) => p.isSelected(dataIndex) };\n\n    // try all not visible ones\n    for (let i = 0; i < leftVisibleFirst; ++i) {\n      for (const s of this.leftSlopes[i]) {\n        if (s.isSelected(selectionLookup) && !alreadyVisible.has(s)) {\n          slopes.add(s);\n        }\n      }\n    }\n    for (let i = leftVisibleLast + 1; i < this.leftSlopes.length; ++i) {\n      for (const s of this.leftSlopes[i]) {\n        if (s.isSelected(selectionLookup) && !alreadyVisible.has(s)) {\n          slopes.add(s);\n        }\n      }\n    }\n    return slopes;\n  }\n\n  private updatePath(\n    p: SVGPathElement,\n    g: SVGGElement,\n    s: ISlope,\n    width: number,\n    selection: { has(dataIndex: number): boolean }\n  ) {\n    s.update(p, width);\n    (p as any).__data__ = s; // data binding\n    const selected = s.isSelected(selection);\n    p.classList.toggle(cssClass('selected'), selected);\n    if (selected) {\n      g.appendChild(p); // to put it on top\n    }\n  }\n\n  private render(visible: Set<ISlope>, selectionSlopes: Set<ISlope>) {\n    const g = this.node.firstElementChild! as SVGGElement;\n    const width = g.ownerSVGElement!.getBoundingClientRect()!.width;\n    const paths = this.matchLength(visible.size + selectionSlopes.size, g);\n\n    const p = this.ctx.provider;\n    const selectionLookup = { has: (dataIndex: number) => p.isSelected(dataIndex) };\n\n    // update paths\n    let i = 0;\n    const updatePath = (s: ISlope) => {\n      this.updatePath(paths[i++], g, s, width, selectionLookup);\n    };\n\n    visible.forEach(updatePath);\n    selectionSlopes.forEach(updatePath);\n  }\n\n  private addPath(g: SVGGElement) {\n    const elem = this.pool.pop();\n    if (elem) {\n      g.appendChild(elem);\n      return elem;\n    }\n\n    const path = g.ownerDocument!.createElementNS('http://www.w3.org/2000/svg', 'path');\n    path.onclick = (evt) => {\n      // d3 style\n      const s: ISlope = (path as any).__data__;\n      const p = this.ctx.provider;\n      const ids = s.dataIndices;\n      if (evt.ctrlKey) {\n        ids.forEach((id) => p.toggleSelection(id, true));\n      } else {\n        // either unset or set depending on the first state\n        const isSelected = p.isSelected(ids[0]!);\n        p.setSelection(isSelected ? [] : ids);\n      }\n    };\n    g.appendChild(path);\n    return path;\n  }\n\n  private matchLength(slopes: number, g: SVGGElement) {\n    const paths = Array.from(g.children) as SVGPathElement[];\n    for (let i = slopes; i < paths.length; ++i) {\n      const elem = paths[i];\n      this.pool.push(elem);\n      elem.remove();\n    }\n\n    for (let i = paths.length; i < slopes; ++i) {\n      paths.push(this.addPath(g));\n    }\n    return paths;\n  }\n\n  updateSelection(selectedDataIndices: Set<number>) {\n    const g = this.node.firstElementChild! as SVGGElement;\n    const paths = Array.from(g.children) as SVGPathElement[];\n\n    const openDataIndices = new Set(selectedDataIndices);\n\n    if (selectedDataIndices.size === 0) {\n      // clear\n      for (const p of paths) {\n        const s: ISlope = (p as any).__data__;\n        p.classList.toggle(cssClass('selected'), false);\n        if (this.chosenSelectionOnly.has(s)) {\n          p.remove();\n        }\n      }\n      this.chosenSelectionOnly.clear();\n      return;\n    }\n\n    for (const p of paths) {\n      const s: ISlope = (p as any).__data__;\n      const selected = s.isSelected(selectedDataIndices);\n      p.classList.toggle(cssClass('selected'), selected);\n      if (!selected) {\n        if (this.chosenSelectionOnly.delete(s)) {\n          // was only needed because of the selection\n          p.remove();\n        }\n        continue;\n      }\n\n      g.appendChild(p); // to put it on top\n      // remove already handled\n      s.dataIndices.forEach((d) => openDataIndices.delete(d));\n    }\n\n    if (openDataIndices.size === 0) {\n      return;\n    }\n\n    // find and add missing slopes\n    const width = g.ownerSVGElement!.getBoundingClientRect()!.width;\n    for (const ss of this.leftSlopes) {\n      for (const s of ss) {\n        if (this.chosen.has(s) || this.chosenSelectionOnly.has(s) || !s.isSelected(openDataIndices)) {\n          // not visible or not selected -> skip\n          continue;\n        }\n        // create new path for it\n        this.chosenSelectionOnly.add(s);\n        const p = this.addPath(g);\n        this.updatePath(p, g, s, width, openDataIndices);\n      }\n    }\n  }\n}\n","import { IGroupData, IGroupItem, isGroup } from '../model';\nimport type { IExceptionContext } from 'lineupengine';\nimport { cssClass, SELECTED_COLOR } from '../styles';\nimport { everyIndices } from '../model/internal';\n\ninterface ISelectionBlock {\n  rawY: number;\n  y: number;\n  height: number;\n  firstRow: IGroupItem | IGroupData;\n}\n\nfunction isGroupSelected(group: IGroupData, selection: Set<number>) {\n  let selected = 0;\n  let unselected = 0;\n  const total = group.order.length;\n  everyIndices(group.order, (i) => {\n    const s = selection.has(i);\n    if (s) {\n      selected++;\n    } else {\n      unselected++;\n    }\n    if (selected * 2 > total || unselected * 2 > total) {\n      // more than half already, can abort already decided\n      return false;\n    }\n    return true;\n  });\n\n  // more than 50%\n  return selected * 2 > total;\n}\n\nconst INDICATOR_WIDTH = 4;\n\nexport default class SelectionIndicator {\n  readonly node: HTMLElement;\n  readonly canvas: HTMLCanvasElement;\n\n  private selection: Set<number>;\n  private data: readonly (IGroupItem | IGroupData)[];\n  private rowContext: IExceptionContext;\n  private blocks: ISelectionBlock[] = [];\n\n  constructor(private readonly scrollerNode: HTMLElement) {\n    const node = scrollerNode.ownerDocument.createElement('div');\n    this.node = node;\n    node.classList.add(cssClass('selection-indicator'));\n    const canvas = scrollerNode.ownerDocument.createElement('canvas');\n    node.appendChild(canvas);\n    this.canvas = canvas;\n    this.canvas.width = INDICATOR_WIDTH;\n\n    this.canvas.addEventListener('click', (e) => {\n      this.onClick(e.clientY - this.canvas.getBoundingClientRect().top);\n    });\n  }\n\n  private toSelectionBlocks(\n    data?: readonly (IGroupItem | IGroupData)[],\n    rowContext?: IExceptionContext,\n    selection?: Set<number>,\n    height?: number\n  ): ISelectionBlock[] {\n    if (!data || !rowContext || !selection || selection.size === 0 || !height) {\n      return [];\n    }\n    if (height > rowContext.totalHeight) {\n      // all rows visible\n      return [];\n    }\n\n    const posOf = (index: number) => {\n      if (rowContext.exceptions.length === 0 || index < rowContext.exceptions[0].index) {\n        // fast pass\n        return index * rowContext.defaultRowHeight;\n      }\n      const before = rowContext.exceptions\n        .slice()\n        .reverse()\n        .find((d) => d.index <= index);\n      if (!before) {\n        return -1;\n      }\n      if (before.index === index) {\n        return before.y;\n      }\n      const regular = index - before.index - 1;\n      return before.y2 + regular * rowContext.defaultRowHeight;\n    };\n    const blocks: ISelectionBlock[] = [];\n    let currentBlock: ISelectionBlock | null = null;\n    let currentBlockLastIndex = -1;\n    data.forEach((row, i) => {\n      const isSelected = isGroup(row) ? isGroupSelected(row, selection) : selection.has(row.dataIndex);\n      if (!isSelected) {\n        return;\n      }\n      if (currentBlock && currentBlockLastIndex + 1 === i) {\n        // concat the selection block\n        currentBlock.height += rowContext.exceptionsLookup.get(i) ?? rowContext.defaultRowHeight;\n        currentBlockLastIndex = i;\n        return;\n      }\n      // create a new block\n      currentBlock = {\n        firstRow: row,\n        height: rowContext.exceptionsLookup.get(i) ?? rowContext.defaultRowHeight,\n        y: 0,\n        rawY: posOf(i),\n      };\n      blocks.push(currentBlock);\n      currentBlockLastIndex = i;\n    });\n\n    // scale blocks\n    const scaleFactor = height / rowContext.totalHeight;\n    for (const block of blocks) {\n      block.y = block.rawY * scaleFactor;\n      block.height = Math.max(1, block.height * scaleFactor);\n    }\n    return blocks;\n  }\n\n  updateData(data: readonly (IGroupItem | IGroupData)[], rowContext: IExceptionContext) {\n    this.data = data;\n    this.rowContext = rowContext;\n    this.render();\n  }\n\n  updateSelection(selection: Set<number>) {\n    this.selection = selection;\n    this.render();\n  }\n\n  private onClick(y: number) {\n    if (!this.blocks || this.blocks.length === 0 || !this.rowContext) {\n      return;\n    }\n    const block = this.blocks.find((d) => y >= d.y && y <= d.y + d.height);\n    if (!block) {\n      return;\n    }\n    const targetY = block.rawY - this.rowContext.defaultRowHeight;\n    this.scrollerNode.scrollTo({\n      behavior: 'auto',\n      top: Math.max(targetY, 0),\n    });\n  }\n\n  private render() {\n    const height = this.scrollerNode.offsetHeight;\n    this.canvas.height = height;\n    if (!this.selection || !this.data || !this.rowContext) {\n      return;\n    }\n    this.blocks = this.toSelectionBlocks(this.data, this.rowContext, this.selection, height);\n    this.node.classList.toggle(cssClass('some-selection'), this.blocks.length > 0);\n    if (this.blocks.length === 0) {\n      return;\n    }\n    const ctx = this.canvas.getContext('2d');\n    ctx.resetTransform();\n    ctx.clearRect(0, 0, INDICATOR_WIDTH, height);\n    ctx.fillStyle = SELECTED_COLOR;\n    for (const block of this.blocks) {\n      ctx.fillRect(0, block.y, INDICATOR_WIDTH, block.height);\n    }\n  }\n}\n","import { GridStyleManager, MultiTableRowRenderer, nonUniformContext } from 'lineupengine';\nimport type { ILineUpFlags, ILineUpOptions } from '../config';\nimport { AEventDispatcher, IEventListener, round, suffix } from '../internal';\nimport { Column, IGroupData, IGroupItem, isGroup, Ranking, IGroup } from '../model';\nimport { DataProvider } from '../provider';\nimport { isSummaryGroup, groupEndLevel } from '../provider/internal';\nimport type { IImposer, IRenderContext } from '../renderer';\nimport { chooseGroupRenderer, chooseRenderer, chooseSummaryRenderer, getPossibleRenderer } from '../renderer/renderers';\nimport { cssClass, engineCssClass } from '../styles';\nimport DialogManager from './dialogs/DialogManager';\nimport domElementCache, { createSanitizer } from './domElementCache';\nimport EngineRanking, { IEngineRankingContext } from './EngineRanking';\nimport { EMode, IRankingHeaderContext, IRankingHeaderContextContainer } from './interfaces';\nimport SlopeGraph from './SlopeGraph';\nimport type { ADialog } from './dialogs';\nimport SelectionIndicator from './SelectionIndicator';\n\n/**\n * emitted when the highlight changes\n * @asMemberOf EngineRenderer\n * @param dataIndex the highlighted data index or -1 for none\n * @event\n */\nexport declare function highlightChanged(dataIndex: number): void;\n\n/**\n * emitted a dialog is opened\n * @asMemberOf EngineRenderer\n * @param dialog the opened dialog\n * @event\n */\nexport declare function dialogOpenedER(dialog: ADialog): void;\n/**\n * emitted a dialog is closed\n * @asMemberOf EngineRenderer\n * @param dialog the closed dialog\n * @param action the action how the dialog was closed\n * @event\n */\nexport declare function dialogClosedER(dialog: ADialog, action: 'cancel' | 'confirm'): void;\n\nexport default class EngineRenderer extends AEventDispatcher {\n  static readonly EVENT_HIGHLIGHT_CHANGED = EngineRanking.EVENT_HIGHLIGHT_CHANGED;\n  static readonly EVENT_DIALOG_OPENED = DialogManager.EVENT_DIALOG_OPENED;\n  static readonly EVENT_DIALOG_CLOSED = DialogManager.EVENT_DIALOG_CLOSED;\n\n  protected readonly options: Readonly<ILineUpOptions>;\n\n  readonly node: HTMLElement;\n  private readonly table: MultiTableRowRenderer;\n  private readonly rankings: EngineRanking[] = [];\n  private readonly slopeGraphs: SlopeGraph[] = [];\n\n  readonly ctx: IRankingHeaderContextContainer & IRenderContext & IEngineRankingContext;\n\n  private readonly updateAbles: ((ctx: IRankingHeaderContext) => void)[] = [];\n  private zoomFactor = 1;\n  readonly idPrefix;\n\n  private enabledHighlightListening = false;\n  readonly selectionIndicator: SelectionIndicator;\n\n  constructor(protected data: DataProvider, parent: HTMLElement, options: Readonly<ILineUpOptions>) {\n    super();\n    this.options = options;\n\n    this.idPrefix = this.options.instanceId\n      ? `lu-${this.options.instanceId}`\n      : `lu-${Math.random().toString(36).slice(-8).substring(0, 3)}`;\n\n    this.node = parent.ownerDocument!.createElement('main');\n    this.node.id = this.idPrefix;\n    // FIXME inline\n    this.node.classList.toggle(cssClass('whole-hover'), options.expandLineOnHover);\n    parent.appendChild(this.node);\n\n    const dialogManager = new DialogManager({\n      doc: parent.ownerDocument!,\n      livePreviews: options.livePreviews,\n      onDialogBackgroundClick: options.onDialogBackgroundClick,\n    });\n    this.forward(\n      dialogManager,\n      ...suffix('.main', EngineRenderer.EVENT_DIALOG_OPENED, EngineRenderer.EVENT_DIALOG_CLOSED)\n    );\n\n    parent.appendChild(dialogManager.node);\n    this.ctx = {\n      idPrefix: this.idPrefix,\n      document: parent.ownerDocument!,\n      provider: data,\n      tasks: data.getTaskExecutor(),\n      dialogManager,\n      resolveToolbarActions: (col, keys) => this.options.resolveToolbarActions(col, keys, this.options.toolbarActions),\n      resolveToolbarDialogAddons: (col, keys) =>\n        this.options.resolveToolbarDialogAddons(col, keys, this.options.toolbarDialogAddons),\n      flags: this.options.flags as ILineUpFlags,\n      asElement: domElementCache(parent.ownerDocument!),\n      sanitize: createSanitizer(parent.ownerDocument!),\n      renderer: (col: Column, imposer?: IImposer) => {\n        const r = chooseRenderer(col, this.options.renderers);\n        return r.create!(col, this.ctx, imposer);\n      },\n      groupRenderer: (col: Column, imposer?: IImposer) => {\n        const r = chooseGroupRenderer(col, this.options.renderers);\n        return r.createGroup!(col, this.ctx, imposer);\n      },\n      summaryRenderer: (col: Column, interactive: boolean, imposer?: IImposer) => {\n        const r = chooseSummaryRenderer(col, this.options.renderers);\n        return r.createSummary!(col, this.ctx, interactive, imposer);\n      },\n      createRenderer(col: Column, imposer?: IImposer) {\n        const single = this.renderer(col, imposer);\n        const group = this.groupRenderer(col, imposer);\n        const summary = options.summaryHeader ? this.summaryRenderer(col, false, imposer) : null;\n        return {\n          single,\n          group,\n          summary,\n          singleId: col.getRenderer(),\n          groupId: col.getGroupRenderer(),\n          summaryId: col.getSummaryRenderer(),\n          singleTemplate: null,\n          groupTemplate: null,\n          summaryTemplate: null,\n        };\n      },\n      getPossibleRenderer: (col: Column) => getPossibleRenderer(col, this.options.renderers, this.options.canRender),\n      colWidth: (col: Column) => (!col.isVisible() ? 0 : col.getWidth()),\n      caches: {\n        toolbar: new Map(),\n        toolbarAddons: new Map(),\n      },\n    };\n\n    this.table = new MultiTableRowRenderer(this.node, this.idPrefix);\n\n    {\n      // helper object for better resizing experience\n      const footer = this.table.node.querySelector(`.${engineCssClass('body')} .${engineCssClass('footer')}`)!;\n      const copy = footer.cloneNode(true) as HTMLElement;\n      copy.classList.add(cssClass('resize-helper'));\n      footer!.insertAdjacentElement('afterend', copy);\n    }\n    {\n      // selection indicator\n      const body = this.table.node.querySelector<HTMLElement>(`.${engineCssClass('body')}`)!;\n      this.selectionIndicator = new SelectionIndicator(body);\n      parent.insertBefore(this.selectionIndicator.node, this.node);\n    }\n\n    //apply rules\n    {\n      this.style.addRule(\n        'lineup_rowPadding0',\n        `\n        .${this.style.cssClasses.tr}`,\n        {\n          marginTop: `${options.rowPadding}px`,\n        }\n      );\n\n      for (let level = 0; level < 4; ++level) {\n        this.style.addRule(\n          `lineup_groupPadding${level}`,\n          `\n        .${this.style.cssClasses.tr}[data-meta~=last${level === 0 ? '' : level}]`,\n          {\n            marginBottom: `${options.groupPadding * (level + 1)}px`,\n          }\n        );\n      }\n\n      this.style.addRule(\n        'lineup_rowPaddingAgg0',\n        `\n        .${cssClass('agg-level')}::after`,\n        {\n          top: `-${options.rowPadding}px`,\n        }\n      );\n      for (let level = 1; level <= 4; ++level) {\n        this.style.addRule(\n          `lineup_rowPaddingAgg${level}`,\n          `\n        .${cssClass('agg-level')}[data-level='${level}']::after`,\n          {\n            top: `-${options.rowPadding + options.groupPadding}px`,\n          }\n        );\n      }\n\n      // FIXME flat\n      this.style.addRule(\n        'lineup_rotation',\n        `\n       #${this.idPrefix}.${cssClass('rotated-label')} .${cssClass('label')}.${cssClass('rotated')}`,\n        {\n          transform: `rotate(${-this.options.labelRotation}deg)`,\n        }\n      );\n\n      const toDisable: string[] = [];\n      if (!this.options.flags.advancedRankingFeatures) {\n        toDisable.push('ranking');\n      }\n      if (!this.options.flags.advancedModelFeatures) {\n        toDisable.push('model');\n      }\n      if (!this.options.flags.advancedUIFeatures) {\n        toDisable.push('ui');\n      }\n      if (toDisable.length > 0) {\n        this.style.addRule(\n          'lineup_feature_disable',\n          `\n        ${toDisable.map((d) => `.${cssClass('feature')}-${d}.${cssClass('feature-advanced')}`).join(', ')}`,\n          {\n            display: 'none !important',\n          }\n        );\n      }\n    }\n\n    this.initProvider(data);\n  }\n\n  get style(): GridStyleManager {\n    return this.table.style;\n  }\n\n  zoomOut() {\n    this.zoomFactor = Math.max(this.zoomFactor - 0.1, 0.5);\n    this.updateZoomFactor();\n    this.update();\n  }\n\n  zoomIn() {\n    this.zoomFactor = Math.min(this.zoomFactor + 0.1, 2.0);\n    this.updateZoomFactor();\n    this.update();\n  }\n\n  private updateZoomFactor() {\n    const body = this.node.querySelector<HTMLElement>('main')!;\n    body.style.fontSize = `${this.zoomFactor * 100}%`;\n  }\n\n  pushUpdateAble(updateAble: (ctx: IRankingHeaderContext) => void) {\n    this.updateAbles.push(updateAble);\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        EngineRenderer.EVENT_HIGHLIGHT_CHANGED,\n        EngineRenderer.EVENT_DIALOG_OPENED,\n        EngineRenderer.EVENT_DIALOG_CLOSED,\n      ]);\n  }\n\n  on(type: typeof EngineRenderer.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\n  on(type: typeof EngineRenderer.EVENT_DIALOG_OPENED, listener: typeof dialogOpenedER | null): this;\n  on(type: typeof EngineRenderer.EVENT_DIALOG_CLOSED, listener: typeof dialogClosedER | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  setDataProvider(data: DataProvider) {\n    this.takeDownProvider();\n\n    this.data = data;\n    (this.ctx as any).provider = data;\n    (this.ctx as any).tasks = data.getTaskExecutor();\n\n    this.initProvider(data);\n  }\n\n  private takeDownProvider() {\n    this.data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.body`, null);\n    this.data.on(`${DataProvider.EVENT_ADD_RANKING}.body`, null);\n    this.data.on(`${DataProvider.EVENT_REMOVE_RANKING}.body`, null);\n    this.data.on(`${DataProvider.EVENT_GROUP_AGGREGATION_CHANGED}.body`, null);\n    this.data.on(`${DataProvider.EVENT_SHOWTOPN_CHANGED}.body`, null);\n    this.data.on(`${DataProvider.EVENT_JUMP_TO_NEAREST}.body`, null);\n    this.data.on(`${DataProvider.EVENT_BUSY}.body`, null);\n\n    this.rankings.forEach((r) => this.table.remove(r));\n    this.rankings.splice(0, this.rankings.length);\n    this.slopeGraphs.forEach((s) => this.table.remove(s));\n    this.slopeGraphs.splice(0, this.slopeGraphs.length);\n  }\n\n  private initProvider(data: DataProvider) {\n    data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.body`, () => this.updateSelection(data.getSelection()));\n    data.on(`${DataProvider.EVENT_ADD_RANKING}.body`, (ranking: Ranking) => {\n      this.addRanking(ranking);\n    });\n    data.on(`${DataProvider.EVENT_REMOVE_RANKING}.body`, (ranking: Ranking) => {\n      this.removeRanking(ranking);\n    });\n    data.on(`${DataProvider.EVENT_GROUP_AGGREGATION_CHANGED}.body`, (ranking: Ranking) => {\n      this.update(this.rankings.filter((r) => r.ranking === ranking));\n    });\n    data.on(`${DataProvider.EVENT_SHOWTOPN_CHANGED}.body`, () => {\n      this.update(this.rankings);\n    });\n    data.on(`${DataProvider.EVENT_JUMP_TO_NEAREST}.body`, (indices: number[]) => {\n      this.setHighlightToNearest(indices, true);\n    });\n\n    (this.ctx as any).provider = data;\n\n    this.data.getRankings().forEach((r) => this.addRanking(r));\n  }\n\n  private updateSelection(dataIndices: number[]) {\n    const s = new Set(dataIndices);\n    this.rankings.forEach((r) => r.updateSelection(s));\n\n    this.slopeGraphs.forEach((r) => r.updateSelection(s));\n\n    this.selectionIndicator.updateSelection(s);\n  }\n\n  private updateHist(ranking?: EngineRanking, col?: Column) {\n    if (!this.options.summaryHeader) {\n      return;\n    }\n    const rankings = ranking ? [ranking] : this.rankings;\n\n    for (const r of rankings) {\n      if (col) {\n        // single update\n        r.updateHeaderOf(col);\n      } else {\n        r.updateHeaders();\n      }\n    }\n    this.updateUpdateAbles();\n  }\n\n  private addRanking(ranking: Ranking) {\n    if (this.rankings.length > 0) {\n      // add slope graph first\n      const s = this.table.pushSeparator(\n        (header, body) =>\n          new SlopeGraph(header, body, `${ranking.id}S`, this.ctx, {\n            mode: this.options.defaultSlopeGraphMode === 'band' ? EMode.BAND : EMode.ITEM,\n          })\n      );\n      this.slopeGraphs.push(s);\n    }\n\n    const r = this.table.pushTable(\n      (header, body, tableId, style) =>\n        new EngineRanking(ranking, header, body, tableId, style, this.ctx, {\n          animation: this.options.animated,\n          customRowUpdate: this.options.customRowUpdate || (() => undefined),\n          levelOfDetail: this.options.levelOfDetail || (() => 'high'),\n          flags: this.options.flags as ILineUpFlags,\n        })\n    );\n    r.on(EngineRanking.EVENT_WIDTH_CHANGED, () => {\n      this.updateRotatedHeaderState();\n      this.table.widthChanged();\n    });\n    r.on(EngineRanking.EVENT_UPDATE_DATA, () => this.update([r]));\n    r.on(EngineRanking.EVENT_RECREATE, () => this.updateUpdateAbles());\n    this.forward(r, EngineRanking.EVENT_HIGHLIGHT_CHANGED);\n    if (this.enabledHighlightListening) {\n      r.enableHighlightListening(true);\n    }\n\n    ranking.on(suffix('.renderer', Ranking.EVENT_ORDER_CHANGED), () => this.updateHist(r));\n\n    this.rankings.push(r);\n    this.update([r]);\n  }\n\n  private updateRotatedHeaderState() {\n    if (this.options.labelRotation === 0) {\n      return;\n    }\n    const l = this.node.querySelector(`.${cssClass('label')}.${cssClass('rotated')}`);\n    this.node.classList.toggle(cssClass('rotated-label'), Boolean(l));\n  }\n\n  private removeRanking(ranking: Ranking | null) {\n    if (!ranking) {\n      // remove all\n      this.rankings.splice(0, this.rankings.length);\n      this.slopeGraphs.splice(0, this.slopeGraphs.length);\n      this.table.clear();\n      return;\n    }\n    const index = this.rankings.findIndex((r) => r.ranking === ranking);\n    if (index < 0) {\n      return; // error\n    }\n    const section = this.rankings.splice(index, 1)[0]!;\n    const slope = this.slopeGraphs.splice(index === 0 ? index : index - 1, 1)[0];\n    this.table.remove(section);\n    if (slope) {\n      this.table.remove(slope);\n    }\n  }\n\n  update(rankings: EngineRanking[] = this.rankings) {\n    // visible and has parent = part of dom\n    rankings = rankings.filter((d) => !d.hidden && d.body.parentElement!);\n    if (rankings.length === 0) {\n      return;\n    }\n\n    const round2 = (v: number) => round(v, 2);\n    const rowPadding = round2(this.zoomFactor * this.options.rowPadding!);\n    const groupPadding = round2(this.zoomFactor * this.options.groupPadding!);\n\n    const heightsFor = (ranking: Ranking, data: (IGroupItem | IGroupData)[]) => {\n      if (this.options.dynamicHeight) {\n        const impl = this.options.dynamicHeight(data, ranking);\n        const f = (v: number | any, d: any) => (typeof v === 'number' ? v : v(d));\n        if (impl) {\n          return {\n            defaultHeight: round2(this.zoomFactor * impl.defaultHeight),\n            height: (d: IGroupItem | IGroupData) => round2(this.zoomFactor * f(impl.height, d)),\n            padding: (d: IGroupItem | IGroupData) => round2(this.zoomFactor * f(impl.padding, d)),\n          };\n        }\n      }\n      const item = round2(this.zoomFactor * this.options.rowHeight!);\n      const group = round2(this.zoomFactor * this.options.groupHeight!);\n      return {\n        defaultHeight: item,\n        height: (d: IGroupItem | IGroupData) => (isGroup(d) ? group : item),\n        padding: rowPadding,\n      };\n    };\n\n    for (const r of rankings) {\n      const grouped = r.groupData();\n\n      // inline with creating the groupData\n      const { height, defaultHeight, padding } = heightsFor(r.ranking, grouped);\n\n      const strategy = this.data.getAggregationStrategy();\n      const topNGetter = (group: IGroup) => this.data.getTopNAggregated(r.ranking, group);\n\n      // inline and create manually for better performance\n      const rowContext = nonUniformContext(grouped.map(height), defaultHeight, (index) => {\n        const pad = typeof padding === 'number' ? padding : padding(grouped[index] || null);\n        const v = grouped[index];\n\n        if (index < 0 || !v || (isGroup(v) && isSummaryGroup(v, strategy, topNGetter))) {\n          return pad;\n        }\n        return pad + groupPadding * groupEndLevel(v, topNGetter);\n      });\n      r.render(grouped, rowContext);\n\n      if (r === this.rankings[0]) {\n        // first ranking\n        this.selectionIndicator.updateData(grouped, rowContext);\n      }\n    }\n\n    this.updateSlopeGraphs(rankings);\n\n    this.updateUpdateAbles();\n    this.updateRotatedHeaderState();\n    this.table.widthChanged();\n  }\n\n  private updateUpdateAbles() {\n    for (const u of this.updateAbles) {\n      u(this.ctx);\n    }\n  }\n\n  private updateSlopeGraphs(rankings: EngineRanking[] = this.rankings) {\n    const indices = new Set(rankings.map((d) => this.rankings.indexOf(d)));\n\n    for (let i = 0; i < this.slopeGraphs.length; ++i) {\n      const s = this.slopeGraphs[i];\n      if (s.hidden) {\n        return;\n      }\n      const left = i;\n      const right = i + 1;\n      if (!indices.has(left) && !indices.has(right)) {\n        return;\n      }\n      const leftRanking = this.rankings[left];\n      const rightRanking = this.rankings[right];\n      s.rebuild(\n        leftRanking.ranking,\n        leftRanking.currentData,\n        leftRanking.context,\n        rightRanking.ranking,\n        rightRanking.currentData,\n        rightRanking.context\n      );\n    }\n  }\n\n  setHighlight(dataIndex: number, scrollIntoView: boolean) {\n    const found = this.rankings.map((r) => r.setHighlight(dataIndex));\n    this.fire(EngineRenderer.EVENT_HIGHLIGHT_CHANGED, dataIndex);\n    if (this.rankings.length === 0 || dataIndex < 0) {\n      return false;\n    }\n    if (!scrollIntoView) {\n      return found[0]!;\n    }\n    return this.rankings[0].scrollIntoView(dataIndex);\n  }\n\n  setHighlightToNearest(dataIndices: number[], scrollIntoView: boolean) {\n    if (this.rankings.length === 0) {\n      return false;\n    }\n    const nearest = this.rankings[0].findNearest(dataIndices);\n    if (nearest >= 0) {\n      return this.setHighlight(nearest, scrollIntoView);\n    }\n    return false;\n  }\n\n  getHighlight() {\n    for (const ranking of this.rankings) {\n      const h = ranking.getHighlight();\n      if (h >= 0) {\n        return h;\n      }\n    }\n    return -1;\n  }\n\n  enableHighlightListening(enable: boolean) {\n    for (const ranking of this.rankings) {\n      ranking.enableHighlightListening(enable);\n    }\n    this.enabledHighlightListening = enable;\n  }\n\n  destroy() {\n    this.takeDownProvider();\n    this.table.destroy();\n    this.node.remove();\n  }\n}\n","import type { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\nimport APopup from './APopup';\n\n/** @internal */\nexport default class ChooseRankingDialog extends APopup {\n  constructor(private readonly items: HTMLElement[], dialog: IDialogContext) {\n    super(dialog);\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('more-options'), cssClass('choose-options'));\n    for (const item of this.items) {\n      node.appendChild(item);\n    }\n  }\n}\n","import { clear, AEventDispatcher, IEventListener } from '../../internal';\nimport { cssClass } from '../../styles';\n\nexport interface IItem {\n  id: string;\n  text: string;\n}\n\nexport interface IGroupSearchItem<T extends IItem> {\n  text: string;\n  children: (T | IGroupSearchItem<T>)[];\n}\n\nfunction isItem<T extends IItem>(v: T | IGroupSearchItem<T>): v is T {\n  return (v as T).id !== undefined;\n}\n\nexport interface ISearchBoxOptions<T extends IItem> {\n  doc: Document;\n\n  formatItem(item: T | IGroupSearchItem<T>, node: HTMLElement): void;\n\n  placeholder: string;\n}\n\n/**\n * @asMemberOf SearchBox\n * @event\n */\nexport declare function select(item: any): void;\n\nexport default class SearchBox<T extends IItem> extends AEventDispatcher {\n  static readonly EVENT_SELECT = 'select';\n  private static readonly SEARCH_ITEM_SELECTOR = `.${cssClass('search-item')}:not(.${cssClass('hidden')})`;\n\n  private readonly options: Readonly<ISearchBoxOptions<T>> = {\n    formatItem: (item, node) => {\n      node.textContent = item.text;\n    },\n    doc: document,\n    placeholder: 'Select...',\n  };\n\n  readonly node: HTMLElement;\n  private search: HTMLInputElement;\n  private body: HTMLElement;\n\n  private readonly itemTemplate: HTMLElement;\n  private readonly groupTemplate: HTMLElement;\n\n  private values: (T | IGroupSearchItem<T>)[] = [];\n\n  constructor(options: Partial<ISearchBoxOptions<T>> = {}) {\n    super();\n    Object.assign(this.options, options);\n\n    this.node = this.options.doc.createElement('div');\n    this.node.classList.add(cssClass('search'));\n    this.node.innerHTML = `<input class=\"${cssClass('search-input')}\" type=\"search\">\n    <ul class=\"${cssClass('search-list')}\"></ul>`;\n\n    this.search = this.node.firstElementChild! as HTMLInputElement;\n    this.search.placeholder = this.options.placeholder;\n    this.body = this.node.lastElementChild! as HTMLElement;\n\n    this.search.onfocus = () => this.focus();\n    this.search.onblur = () => this.blur();\n    this.search.oninput = () => this.filter();\n    this.search.onkeydown = (evt) => this.handleKey(evt);\n\n    this.itemTemplate = this.options.doc.createElement('li');\n    this.itemTemplate.classList.add(cssClass('search-item'));\n    this.itemTemplate.innerHTML = `<span></span>`;\n    this.groupTemplate = this.options.doc.createElement('li');\n    this.groupTemplate.classList.add(cssClass('search-group'));\n    this.groupTemplate.innerHTML = `<span></span><ul></ul>`;\n  }\n\n  get data() {\n    return this.values;\n  }\n\n  set data(data: (T | IGroupSearchItem<T>)[]) {\n    this.values = data;\n    clear(this.body);\n    this.buildDialog(this.body, this.values);\n  }\n\n  private buildDialog(node: HTMLElement, values: (T | IGroupSearchItem<T>)[]) {\n    for (const v of values) {\n      let li: HTMLElement;\n      if (isItem(v)) {\n        li = this.itemTemplate.cloneNode(true) as HTMLElement;\n        li.onmousedown = (evt) => {\n          // see https://stackoverflow.com/questions/10652852/jquery-fire-click-before-blur-event#10653160\n          evt.preventDefault();\n        };\n        li.onclick = () => this.select(v);\n        li.onmouseenter = () => (this.highlighted = li);\n        li.onmouseleave = () => (this.highlighted = null);\n        node.appendChild(li);\n      } else {\n        li = this.groupTemplate.cloneNode(true) as HTMLElement;\n        this.buildDialog(li.lastElementChild! as HTMLElement, (v as IGroupSearchItem<T>).children);\n        node.appendChild(li);\n      }\n      const item = li.firstElementChild! as HTMLElement;\n      this.options.formatItem(v, item);\n    }\n  }\n\n  private handleKey(evt: KeyboardEvent) {\n    switch (evt.key) {\n      case 'Escape':\n        this.search.blur();\n        break;\n      case 'Enter':\n        const h = this.highlighted;\n        if (h) {\n          h.click();\n        } else {\n          evt.preventDefault();\n        }\n        break;\n      case 'ArrowUp':\n        this.highlightPrevious();\n        break;\n      case 'ArrowDown':\n        this.highlightNext();\n        break;\n    }\n  }\n\n  private select(item: T) {\n    this.search.value = ''; // reset\n    this.search.blur();\n    this.fire(SearchBox.EVENT_SELECT, item);\n  }\n\n  focus() {\n    this.body.style.width = `${this.search.offsetWidth}px`;\n    this.highlighted = this.body.querySelector<HTMLElement>(SearchBox.SEARCH_ITEM_SELECTOR) || null;\n    this.node.classList.add(cssClass('search-open'));\n  }\n\n  private get highlighted() {\n    return (this.body.getElementsByClassName(cssClass('search-highlighted'))[0] as HTMLElement) ?? null;\n  }\n\n  private set highlighted(value: HTMLElement | null) {\n    const old = this.highlighted;\n    if (old === value) {\n      return;\n    }\n    if (old) {\n      old.classList.remove(cssClass('search-highlighted'));\n    }\n    if (value) {\n      value.classList.add(cssClass('search-highlighted'));\n    }\n  }\n\n  private highlightNext() {\n    const h = this.highlighted;\n    if (!h || h.classList.contains(cssClass('hidden'))) {\n      this.highlighted = this.body.querySelector<HTMLElement>(SearchBox.SEARCH_ITEM_SELECTOR) || null;\n      return;\n    }\n\n    const items = Array.from(this.body.querySelectorAll<HTMLElement>(SearchBox.SEARCH_ITEM_SELECTOR));\n    const index = items.indexOf(h);\n    this.highlighted = items[index + 1] || null;\n  }\n\n  private highlightPrevious() {\n    const h = this.highlighted;\n    const items = Array.from(this.body.querySelectorAll<HTMLElement>(SearchBox.SEARCH_ITEM_SELECTOR));\n\n    if (!h || h.classList.contains(cssClass('hidden'))) {\n      this.highlighted = items[items.length - 1] || null;\n      return;\n    }\n    const index = items.indexOf(h);\n    this.highlighted = items[index - 1] || null;\n  }\n\n  private blur() {\n    this.search.value = '';\n    // clear filter\n    this.filterResults(this.body, '');\n    this.node.classList.remove(cssClass('search-open'));\n  }\n\n  private filter() {\n    const empty = this.filterResults(this.body, this.search.value.toLowerCase());\n    this.body.classList.toggle(cssClass('search-empty'), empty);\n  }\n\n  private filterResults(node: HTMLElement, text: string) {\n    if (text === '') {\n      // show all\n      (Array.from(node.getElementsByClassName(cssClass('hidden'))) as HTMLElement[]).forEach((d: HTMLElement) =>\n        d.classList.remove(cssClass('hidden'))\n      );\n      return false;\n    }\n    const children = Array.from(node.children);\n    children.forEach((d) => {\n      const content = d.firstElementChild!.innerHTML.toLowerCase();\n      let hidden = !content.includes(text);\n      if (d.classList.contains(cssClass('search-group'))) {\n        const ul = d.lastElementChild! as HTMLElement;\n        const allChildrenHidden = this.filterResults(ul, text);\n        hidden = hidden && allChildrenHidden;\n      }\n      d.classList.toggle(cssClass('hidden'), hidden);\n    });\n\n    return children.every((d) => d.classList.contains(cssClass('hidden')));\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([SearchBox.EVENT_SELECT]);\n  }\n\n  on(type: typeof SearchBox.EVENT_SELECT, listener: typeof select | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n}\n","import type { Ranking } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class RenameRankingDialog extends ADialog {\n  private readonly before: string;\n\n  constructor(private readonly ranking: Ranking, dialog: IDialogContext) {\n    super(dialog, {\n      livePreview: 'rename',\n    });\n    this.before = ranking.getLabel();\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('dialog-rename'));\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n      <input type=\"text\" value=\"${this.dialog.sanitize(\n        this.ranking.getLabel()\n      )}\" required autofocus placeholder=\"name\">`\n    );\n  }\n\n  protected reset() {\n    this.findInput('input[type=\"text\"]').value = this.before;\n  }\n\n  protected cancel() {\n    this.ranking.setLabel(this.before);\n  }\n\n  protected submit() {\n    const newValue = this.findInput('input[type=\"text\"]').value;\n    this.ranking.setLabel(newValue);\n    return true;\n  }\n}\n","import type { Ranking } from '../../model';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport { dialogContext, IDialogContext } from './ADialog';\nimport RenameRankingDialog from './RenameRankingDialog';\nimport { cssClass } from '../../styles';\nimport { actionCSSClass } from '../header';\nimport APopup from './APopup';\n\n/** @internal */\nexport default class MoreRankingOptionsDialog extends APopup {\n  constructor(private readonly ranking: Ranking, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\n    super(dialog, {\n      autoClose: true,\n    });\n  }\n\n  private addIcon(node: HTMLElement, title: string, onClick: (evt: MouseEvent) => void) {\n    const sanitized = this.ctx.sanitize(title);\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<i title=\"${sanitized}\" class=\"${actionCSSClass(title)}\"><span>${sanitized}</span> </i>`\n    );\n    const i = node.lastElementChild as HTMLElement;\n    i.onclick = (evt) => {\n      evt.stopPropagation();\n      onClick(evt);\n    };\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('more-options'));\n    this.addIcon(node, 'Rename', (evt) => {\n      evt.stopPropagation();\n      evt.preventDefault();\n      const dialog = new RenameRankingDialog(this.ranking, dialogContext(this.ctx, this.level + 1, evt as any));\n      dialog.open();\n    });\n    this.addIcon(node, 'Remove', (evt) => {\n      evt.stopPropagation();\n      evt.preventDefault();\n      this.destroy('confirm');\n      this.ctx.provider.removeRanking(this.ranking);\n    });\n  }\n}\n","import type { Column } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport type { IToolbarDialogAddon, IRankingHeaderContext, IToolbarDialogAddonHandler } from '../interfaces';\n\n/** @internal */\nexport default class AddonDialog extends ADialog {\n  private readonly handlers: IToolbarDialogAddonHandler[] = [];\n\n  constructor(\n    private readonly column: Column,\n    private readonly addons: IToolbarDialogAddon[],\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext,\n    private readonly onClick?: () => void\n  ) {\n    super(dialog);\n  }\n\n  protected build(node: HTMLElement) {\n    for (const addon of this.addons) {\n      this.node.insertAdjacentHTML('beforeend', `<strong>${this.ctx.sanitize(addon.title)}</strong>`);\n      this.handlers.push(addon.append(this.column, node, this.dialog, this.ctx));\n    }\n  }\n\n  protected submit(): boolean {\n    for (const handler of this.handlers) {\n      if (handler.submit() === false) {\n        return false;\n      }\n    }\n    if (this.onClick) {\n      this.onClick();\n    }\n    return true;\n  }\n\n  protected cancel() {\n    for (const handler of this.handlers) {\n      handler.cancel();\n    }\n  }\n\n  protected reset() {\n    for (const handler of this.handlers) {\n      handler.reset();\n    }\n  }\n}\n","import { clear } from '../../internal';\nimport { Column, Ranking, categoryOf, isSortingAscByDefault, ISortCriteria, isSupportType } from '../../model';\nimport { aria, cssClass } from '../../styles';\nimport AddonDialog from '../dialogs/AddonDialog';\nimport { actionCSSClass, updateHeader } from '../header';\nimport type { IRankingHeaderContext, IToolbarDialogAddon } from '../interfaces';\nimport { getToolbarDialogAddons, isGroupAble, isGroupSortAble, isSortAble } from '../toolbarResolvers';\nimport SearchBox, { ISearchBoxOptions } from './SearchBox';\nimport { dialogContext } from '../dialogs';\n\ninterface IColumnItem {\n  col: Column;\n  id: string;\n  text: string;\n}\n/**\n * @internal\n */\nexport default class Hierarchy {\n  readonly node: HTMLElement;\n  readonly groupAdder: SearchBox<IColumnItem>;\n  readonly sortAdder: SearchBox<IColumnItem>;\n  readonly groupSortAdder: SearchBox<IColumnItem>;\n\n  constructor(private readonly ctx: IRankingHeaderContext, document: Document) {\n    this.node = document.createElement('aside');\n    this.node.classList.add(cssClass('hierarchy'), cssClass('feature-advanced'), cssClass('feature-ranking'));\n    this.node.innerHTML = `\n      <section class=\"${cssClass('group-hierarchy')}\">\n      </section>\n      <section class=\"${cssClass('sort-hierarchy')}\">\n      </section>\n      <section class=\"${cssClass('sort-groups-hierarchy')}\">\n      </section>\n    `;\n    const options: Partial<ISearchBoxOptions<IColumnItem>> = {\n      doc: document,\n      placeholder: 'Add Sort Criteria...',\n      formatItem: (item: IColumnItem, node: HTMLElement) => {\n        node.classList.add(cssClass('typed-icon'));\n        node.dataset.typeCat = categoryOf(item.col).name;\n        node.dataset.type = item.col.desc.type;\n\n        const summary = item.col.getMetaData().summary || item.col.description;\n        node.classList.toggle(cssClass('searchbox-summary-entry'), Boolean(summary));\n        if (summary) {\n          const label = node.ownerDocument.createElement('span');\n          if (item.col.desc.labelAsHTML) {\n            label.innerHTML = item.text;\n          } else {\n            label.textContent = item.text;\n          }\n          node.appendChild(label);\n          const desc = node.ownerDocument.createElement('span');\n          if (item.col.desc.summaryAsHTML) {\n            label.innerHTML = summary;\n          } else {\n            label.textContent = summary;\n          }\n          node.appendChild(desc);\n        } else if (item.col.desc.labelAsHTML) {\n          node.innerHTML = item.text;\n        } else {\n          node.textContent = item.text;\n        }\n      },\n    };\n    this.groupAdder = new SearchBox(\n      Object.assign({}, options, {\n        placeholder: 'Add Grouping Criteria...',\n      })\n    );\n    this.groupSortAdder = new SearchBox(\n      Object.assign({}, options, {\n        placeholder: 'Add Grouping Sort Criteria...',\n      })\n    );\n    this.sortAdder = new SearchBox(options);\n  }\n\n  update(ranking: Ranking | null) {\n    if (!ranking) {\n      this.node.style.display = 'none';\n      return;\n    }\n    this.node.style.display = null;\n    this.renderGroups(ranking, this.node.firstElementChild! as HTMLElement);\n    this.renderSorting(ranking, this.node.children[1]! as HTMLElement);\n    this.renderGroupSorting(ranking, this.node.lastElementChild! as HTMLElement);\n  }\n\n  private render<T>(\n    node: HTMLElement,\n    items: T[],\n    toColumn: (item: T) => Column,\n    extras: (item: T, node: HTMLElement) => void,\n    addonKey: string,\n    onChange: (item: T, delta: number) => void\n  ) {\n    const cache = new Map((Array.from(node.children) as HTMLElement[]).map((d) => [d.dataset.id, d]));\n    clear(node);\n\n    items.forEach((d) => {\n      const col = toColumn(d);\n      const item = cache.get(col.id);\n      if (item) {\n        node.appendChild(item);\n        updateHeader(item, col, 0);\n        return;\n      }\n      const addons = getToolbarDialogAddons(col, addonKey, this.ctx);\n\n      node.insertAdjacentHTML(\n        'beforeend',\n        `<div data-id=\"${col.id}\" class=\"${cssClass('toolbar')} ${cssClass('hierarchy-entry')}\">\n      <div class=\"${cssClass('label')} ${cssClass('typed-icon')}\"> </div>\n      ${addons.length > 0 ? `<i title=\"Customize\" class=\"${actionCSSClass('customize')}\">${aria('Customize')}</i>` : ''}\n      <i title=\"Move Up\" class=\"${actionCSSClass('Move Up')}\">${aria('Move Up')}</i>\n      <i title=\"Move Down\" class=\"${actionCSSClass('Move Down')}\">${aria('Move Down')}</i>\n      <i title=\"Remove from hierarchy\" class=\"${actionCSSClass('Remove')}\">${aria('Remove from hierarchy')}</i>\n      </div>`\n      );\n      const last = node.lastElementChild! as HTMLElement;\n      last.firstElementChild!.textContent = col.label;\n\n      function prevent(evt: Event) {\n        evt.preventDefault();\n        evt.stopPropagation();\n      }\n\n      last.querySelector<HTMLElement>('i[title=\"Move Down\"]')!.onclick = (evt) => {\n        prevent(evt);\n        onChange(d, +1);\n      };\n      last.querySelector<HTMLElement>('i[title=\"Move Up\"]')!.onclick = (evt) => {\n        prevent(evt);\n        onChange(d, -1);\n      };\n      last.querySelector<HTMLElement>('i[title^=Remove]')!.onclick = (evt) => {\n        prevent(evt);\n        onChange(d, 0);\n      };\n\n      if (addons.length > 0) {\n        last.querySelector<HTMLElement>('i[title=Customize]')!.onclick = (evt) => {\n          prevent(evt);\n          this.customize(col, addons, evt as any);\n        };\n      }\n\n      extras(d, last);\n\n      updateHeader(last, col, 0);\n    });\n  }\n\n  private renderGroups(ranking: Ranking, node: HTMLElement) {\n    const groups = ranking.getGroupCriteria();\n\n    if (groups.length === 0) {\n      clear(node);\n      return;\n    }\n\n    const click = (col: Column, delta: number) => {\n      if (delta === 0) {\n        col.groupByMe();\n        return;\n      }\n      const current = col.isGroupedBy();\n      col.findMyRanker()!.groupBy(col, current + delta);\n    };\n\n    const addButton = (_: Column, last: HTMLElement) => {\n      last.insertAdjacentHTML(\n        'afterbegin',\n        `<i title=\"Group\" class=\"${actionCSSClass('group')}\" data-group=\"true\">${aria('Group')}</i>`\n      );\n    };\n\n    this.render(node, groups, (d) => d, addButton, 'group', click);\n    this.addGroupAdder(ranking, groups, node);\n  }\n\n  private renderSorting(ranking: Ranking, node: HTMLElement) {\n    const sortCriterias = ranking.getSortCriteria();\n\n    if (sortCriterias.length === 0) {\n      clear(node);\n      return;\n    }\n\n    const click = ({ col }: ISortCriteria, delta: number) => {\n      const current = col.isSortedByMe();\n      if (!isFinite(delta)) {\n        col.sortByMe(current.asc === 'desc', current.priority);\n        return;\n      }\n      if (delta === 0) {\n        col.sortByMe(current.asc === 'asc', -1);\n        return;\n      }\n      col.sortByMe(current.asc === 'asc', current.priority! + delta);\n    };\n\n    const addButton = (s: ISortCriteria, last: HTMLElement) => {\n      last.insertAdjacentHTML(\n        'afterbegin',\n        `\n      <i title=\"Sort\" class=\"${actionCSSClass('sort')}\" data-sort=\"${s.asc ? 'asc' : 'desc'}\">${aria(\n          'Toggle Sorting'\n        )}</i>`\n      );\n      last.querySelector<HTMLElement>('i[title=Sort]')!.onclick = (evt) => {\n        evt.preventDefault();\n        evt.stopPropagation();\n        click(s, Number.POSITIVE_INFINITY);\n      };\n    };\n\n    this.render(node, sortCriterias, (d) => d.col, addButton, 'sort', click);\n\n    this.addSortAdder(ranking, sortCriterias, node);\n  }\n\n  private renderGroupSorting(ranking: Ranking, node: HTMLElement) {\n    const sortCriterias = ranking.getGroupSortCriteria();\n\n    if (sortCriterias.length === 0) {\n      clear(node);\n      return;\n    }\n\n    const click = ({ col }: ISortCriteria, delta: number) => {\n      const current = col.isGroupSortedByMe();\n      if (!isFinite(delta)) {\n        col.groupSortByMe(current.asc === 'desc', current.priority);\n        return;\n      }\n      if (delta === 0) {\n        col.groupSortByMe(current.asc === 'asc', -1);\n        return;\n      }\n      col.groupSortByMe(current.asc === 'asc', current.priority! + delta);\n    };\n\n    const addButton = (s: ISortCriteria, last: HTMLElement) => {\n      last.insertAdjacentHTML(\n        'afterbegin',\n        `\n      <i title=\"Sort Group\" class=\"${actionCSSClass('sort-groups')}\" data-sort=\"${s.asc ? 'asc' : 'desc'}\">${aria(\n          'Toggle Sorting'\n        )}</i>`\n      );\n      last.querySelector<HTMLElement>('i[title=\"Sort Group\"]')!.onclick = (evt) => {\n        evt.preventDefault();\n        evt.stopPropagation();\n        click(s, Number.POSITIVE_INFINITY);\n      };\n    };\n\n    this.render(node, sortCriterias, (d) => d.col, addButton, 'sortGroup', click);\n\n    this.addGroupSortAdder(ranking, sortCriterias, node);\n  }\n\n  private addAdder(\n    adder: SearchBox<IColumnItem>,\n    ranking: Ranking,\n    addonKey: string,\n    current: Column[],\n    node: HTMLElement,\n    check: (col: Column) => boolean,\n    onSelect: (col: Column) => void\n  ) {\n    const used = new Set(current);\n\n    adder.data = ranking.children\n      .filter((col) => !isSupportType(col) && !used.has(col) && check(col))\n      .map((col) => ({ col, id: col.id, text: col.label }));\n\n    adder.on(SearchBox.EVENT_SELECT, (item: IColumnItem) => {\n      const addons = getToolbarDialogAddons(item.col, addonKey, this.ctx);\n      if (addons.length > 0) {\n        this.customize(item.col, addons, adder.node, () => onSelect(item.col));\n      } else {\n        onSelect(item.col);\n      }\n    });\n\n    if (adder.data.length <= 0) {\n      return;\n    }\n\n    const wrapper = node.ownerDocument!.createElement('footer');\n    wrapper.appendChild(adder.node);\n    wrapper.classList.add(cssClass('hierarchy-adder'));\n    node.appendChild(wrapper);\n  }\n\n  private addSortAdder(ranking: Ranking, sortCriterias: ISortCriteria[], node: HTMLElement) {\n    this.addAdder(\n      this.sortAdder,\n      ranking,\n      'sort',\n      sortCriterias.map((d) => d.col),\n      node,\n      (d) => isSortAble(d, this.ctx),\n      (col) => {\n        ranking.sortBy(col, isSortingAscByDefault(col), sortCriterias.length);\n      }\n    );\n  }\n\n  private addGroupAdder(ranking: Ranking, groups: Column[], node: HTMLElement) {\n    this.addAdder(\n      this.groupAdder,\n      ranking,\n      'group',\n      groups,\n      node,\n      (d) => isGroupAble(d, this.ctx),\n      (col) => {\n        ranking.groupBy(col, groups.length);\n      }\n    );\n  }\n\n  private addGroupSortAdder(ranking: Ranking, sortCriterias: ISortCriteria[], node: HTMLElement) {\n    this.addAdder(\n      this.groupSortAdder,\n      ranking,\n      'sortGroup',\n      sortCriterias.map((d) => d.col),\n      node,\n      (d) => isGroupSortAble(d, this.ctx),\n      (col) => {\n        ranking.groupSortBy(col, isSortingAscByDefault(col), sortCriterias.length);\n      }\n    );\n  }\n\n  private customize(col: Column, addons: IToolbarDialogAddon[], attachment: HTMLElement, onClick?: () => void) {\n    const dialog = new AddonDialog(col, addons, dialogContext(this.ctx, 0, attachment), this.ctx, onClick);\n    dialog.open();\n  }\n}\n","import { Column, isMapAbleColumn, NumberColumn } from '../../model';\nimport type { IAbortAblePromise } from '../../provider';\nimport type { ISummaryRenderer } from '../../renderer';\nimport { cssClass, engineCssClass } from '../../styles';\nimport { createShortcutMenuItems, updateHeader } from '../header';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport { suffix } from '../../internal';\n\n/** @internal */\nexport default class SidePanelEntryVis {\n  readonly node: HTMLElement;\n  private summary: ISummaryRenderer;\n  private summaryUpdater: IAbortAblePromise<void> | null = null;\n\n  constructor(public readonly column: Column, private ctx: IRankingHeaderContext, document: Document) {\n    this.node = document.createElement('article');\n    this.node.classList.add(cssClass('side-panel-entry'));\n    this.node.dataset.colId = column.id;\n    this.node.dataset.type = column.desc.type;\n\n    this.summary = ctx.summaryRenderer(column, true);\n\n    this.column.on(suffix('.panel', NumberColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_HEADER), () => {\n      this.update();\n    });\n    this.column.on(suffix('.panel', Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_CACHES), () => {\n      this.recreateSummary();\n    });\n    this.init();\n    this.update();\n  }\n\n  private init() {\n    this.node.innerHTML = `\n      <header class=\"${cssClass('side-panel-entry-header')}\">\n        <div class=\"${cssClass('side-panel-labels')}\">\n          <span class=\"${cssClass('label')} ${cssClass('typed-icon')} ${cssClass('side-panel-label')}\"></span>\n          <span class=\"${cssClass('sublabel')} ${cssClass('side-panel-sublabel')}\"></span>\n        </div>\n        <div class=\"${cssClass('toolbar')} ${cssClass('side-panel-toolbar')}\"></div>\n      </header>`;\n    createShortcutMenuItems(\n      this.node.querySelector<HTMLElement>(`.${cssClass('toolbar')}`),\n      0,\n      this.column,\n      this.ctx,\n      'sidePanel',\n      false\n    );\n    this.appendSummary();\n  }\n\n  update(ctx: IRankingHeaderContext = this.ctx) {\n    this.ctx = ctx;\n    updateHeader(this.node, this.column);\n    this.updateSummary();\n  }\n\n  private updateSummary() {\n    const summaryNode = this.node.querySelector<HTMLElement>(`.${cssClass('summary')}`)!;\n    if (this.summaryUpdater) {\n      this.summaryUpdater.abort();\n      summaryNode.classList.remove(engineCssClass('loading'));\n      this.summaryUpdater = null;\n    }\n    const r = this.summary.update(summaryNode);\n    if (!r) {\n      return;\n    }\n\n    this.summaryUpdater = r;\n    summaryNode.classList.add(engineCssClass('loading'));\n    r.then((a) => {\n      if (typeof a === 'symbol') {\n        return;\n      }\n      summaryNode.classList.remove(engineCssClass('loading'));\n    });\n  }\n\n  private appendSummary() {\n    const summary = this.ctx.asElement(this.summary.template);\n    summary.classList.add(\n      cssClass('summary'),\n      cssClass('side-panel-summary'),\n      cssClass('renderer'),\n      cssClass(`renderer-${this.column.getSummaryRenderer()}`)\n    );\n    summary.dataset.renderer = this.column.getSummaryRenderer();\n    summary.dataset.interactive = isMapAbleColumn(this.column).toString();\n    this.node.appendChild(summary);\n  }\n\n  private recreateSummary() {\n    // remove old summary\n    this.node.removeChild(this.node.querySelector(`.${cssClass('summary')}`)!);\n\n    this.summary = this.ctx.summaryRenderer(this.column, true);\n    this.appendSummary();\n    this.updateSummary();\n  }\n\n  destroy() {\n    this.column.on(\n      suffix(\n        '.panel',\n        NumberColumn.EVENT_FILTER_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED,\n        Column.EVENT_DIRTY_CACHES\n      ),\n      null\n    );\n    this.node.remove();\n  }\n}\n","import { clear, suffix } from '../../internal';\nimport { Ranking, isSupportType } from '../../model';\nimport { aria, cssClass } from '../../styles';\nimport MoreRankingOptionsDialog from '../dialogs/MoreRankingOptionsDialog';\nimport { actionCSSClass } from '../header';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport { dialogContext } from '../dialogs';\nimport Hierarchy from './Hierarchy';\nimport type { ISidePanelOptions } from './SidePanel';\nimport SidePanelEntryVis from './SidePanelEntryVis';\n\n/** @internal */\nexport default class SidePanelRanking {\n  readonly header: HTMLElement;\n  readonly dropdown: HTMLElement;\n  readonly node: HTMLElement;\n\n  private readonly hierarchy: Hierarchy | null;\n  private readonly entries = new Map<string, SidePanelEntryVis>();\n\n  constructor(\n    public readonly ranking: Ranking,\n    private ctx: IRankingHeaderContext,\n    document: Document,\n    private readonly options: Readonly<ISidePanelOptions>\n  ) {\n    this.node = document.createElement('section');\n    this.header = document.createElement('div');\n    this.dropdown = document.createElement('div');\n\n    this.node.classList.add(cssClass('side-panel-ranking'));\n    this.header.classList.add(cssClass('side-panel-ranking-header'), cssClass('side-panel-ranking-label'));\n    this.dropdown.classList.add(cssClass('side-panel-ranking-label'));\n\n    this.dropdown.innerHTML = `<span></span><i class=\"${actionCSSClass('more')}\" title=\"More …\">${aria('More …')}</i>`;\n    this.header.innerHTML = this.dropdown.innerHTML;\n    this.header.firstElementChild.textContent = ranking.getLabel();\n    (this.header.lastElementChild! as HTMLElement).onclick = (this.dropdown.lastElementChild! as HTMLElement).onclick =\n      (evt) => {\n        evt.stopPropagation();\n        evt.preventDefault();\n        const dialog = new MoreRankingOptionsDialog(ranking, dialogContext(ctx, 1, evt), ctx);\n        dialog.open();\n      };\n\n    this.hierarchy = this.options.hierarchy ? new Hierarchy(ctx, document) : null;\n\n    this.init();\n  }\n\n  private init() {\n    this.node.innerHTML = `<main class=\"${cssClass('side-panel-ranking-main')}\"></main>`;\n    if (this.hierarchy) {\n      this.node.insertBefore(this.hierarchy.node, this.node.firstChild);\n    }\n\n    if (this.hierarchy) {\n      this.ranking.on(\n        suffix(\n          '.panel',\n          Ranking.EVENT_GROUP_CRITERIA_CHANGED,\n          Ranking.EVENT_SORT_CRITERIA_CHANGED,\n          Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED\n        ),\n        () => {\n          this.updateHierarchy();\n        }\n      );\n    }\n    this.ranking.on(\n      suffix('.panel', Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_REMOVE_COLUMN, Ranking.EVENT_MOVE_COLUMN),\n      () => {\n        this.updateList();\n        this.updateHierarchy();\n      }\n    );\n    this.ranking.on(suffix('.panel', Ranking.EVENT_LABEL_CHANGED), () => {\n      this.dropdown.firstElementChild!.textContent = this.header.firstElementChild!.textContent =\n        this.ranking.getLabel();\n    });\n  }\n\n  get active() {\n    return this.node.classList.contains(cssClass('active'));\n  }\n\n  set active(value: boolean) {\n    this.node.classList.toggle(cssClass('active'), value);\n    this.header.classList.toggle(cssClass('active'), value);\n    this.dropdown.classList.toggle(cssClass('active'), value);\n    if (value) {\n      return;\n    }\n    this.updateList();\n    this.updateHierarchy();\n  }\n\n  update(ctx: IRankingHeaderContext) {\n    this.ctx = ctx;\n    this.updateList();\n    this.updateHierarchy();\n  }\n\n  private updateHierarchy() {\n    if (!this.hierarchy || !this.active) {\n      return;\n    }\n    this.hierarchy.update(this.ranking);\n  }\n\n  private updateList() {\n    if (!this.active) {\n      return;\n    }\n    const node = this.node.querySelector('main')!;\n    const columns = this.ranking.flatColumns.filter((d) => !isSupportType(d));\n\n    if (columns.length === 0) {\n      clear(node);\n      this.entries.forEach((d) => d.destroy());\n      this.entries.clear();\n      return;\n    }\n\n    const currentEntries = new Map(this.entries);\n    this.entries.clear();\n\n    columns.forEach((col, i) => {\n      const existing = currentEntries.get(col.id);\n      if (existing) {\n        existing.update(this.ctx);\n        if (node.children[i] !== existing.node) {\n          // change node order if it doesn't match\n          node.appendChild(existing.node);\n        }\n        this.entries.set(col.id, existing);\n        currentEntries.delete(col.id);\n        return;\n      }\n\n      const entry = new SidePanelEntryVis(col, this.ctx, node.ownerDocument!);\n      node.insertBefore(entry.node, node.children[i]);\n      this.entries.set(col.id, entry);\n    });\n\n    currentEntries.forEach((d) => {\n      d.node.remove();\n      d.destroy();\n    });\n  }\n\n  destroy() {\n    this.header.remove();\n    this.node.remove();\n    this.ranking.on(\n      suffix(\n        '.panel',\n        Ranking.EVENT_GROUP_CRITERIA_CHANGED,\n        Ranking.EVENT_SORT_CRITERIA_CHANGED,\n        Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED,\n        Ranking.EVENT_ADD_COLUMN,\n        Ranking.EVENT_MOVE_COLUMN,\n        Ranking.EVENT_REMOVE_COLUMN,\n        Ranking.EVENT_LABEL_CHANGED\n      ),\n      null\n    );\n\n    this.entries.forEach((d) => d.destroy());\n    this.entries.clear();\n  }\n}\n","import { suffix } from '../../internal';\nimport {\n  categoryOfDesc,\n  IColumnCategory,\n  createAggregateDesc,\n  createGroupDesc,\n  createImpositionDesc,\n  createNestedDesc,\n  createRankDesc,\n  createReduceDesc,\n  createScriptDesc,\n  createSelectionDesc,\n  createStackDesc,\n  IColumnDesc,\n  Ranking,\n} from '../../model';\nimport { DataProvider, IDataProvider } from '../../provider';\nimport { aria, cssClass } from '../../styles';\nimport ChooseRankingDialog from '../dialogs/ChooseRankingDialog';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport { dialogContext } from '../dialogs';\nimport SearchBox, { IGroupSearchItem, ISearchBoxOptions } from './SearchBox';\nimport SidePanelRanking from './SidePanelRanking';\nimport { format } from 'd3-format';\nimport { setText } from '../../renderer/utils';\n\nexport interface IColumnWrapper {\n  desc: IColumnDesc;\n  category: IColumnCategory;\n  id: string;\n  text: string;\n}\n\nfunction isWrapper(item: IColumnWrapper | IGroupSearchItem<IColumnWrapper>): item is IColumnWrapper {\n  return (item as IColumnWrapper).desc != null;\n}\n\nexport interface ISidePanelOptions extends Partial<ISearchBoxOptions<IColumnWrapper>> {\n  additionalDescs: IColumnDesc[];\n  chooser: boolean;\n  hierarchy: boolean;\n  collapseable: boolean | 'collapsed';\n}\n\nexport default class SidePanel {\n  private readonly options: ISidePanelOptions = {\n    additionalDescs: [\n      createStackDesc('Weighted Sum'),\n      createScriptDesc('Scripted Formula'),\n      createNestedDesc('Nested'),\n      createReduceDesc(),\n      createImpositionDesc(),\n      createRankDesc(),\n      createSelectionDesc(),\n      createGroupDesc(),\n      createAggregateDesc(),\n    ],\n    chooser: true,\n    hierarchy: true,\n    placeholder: 'Add Column...',\n    formatItem: (item: IColumnWrapper | IGroupSearchItem<IColumnWrapper>, node: HTMLElement) => {\n      const w: IColumnWrapper = isWrapper(item) ? item : (item.children[0] as IColumnWrapper);\n      node.dataset.typeCat = w.category.name;\n      node.classList.add(cssClass('typed-icon'));\n      if (isWrapper(item)) {\n        node.dataset.type = w.desc.type;\n      }\n      if (node.parentElement) {\n        node.parentElement.classList.add(cssClass('feature-model'));\n        node.parentElement.classList.toggle(cssClass('feature-advanced'), w.category.featureLevel === 'advanced');\n        node.parentElement.classList.toggle(cssClass('feature-basic'), w.category.featureLevel === 'basic');\n\n        if (isWrapper(item)) {\n          const summary = w.desc.summary || w.desc.description;\n          node.classList.toggle(cssClass('searchbox-summary-entry'), Boolean(summary));\n          if (summary) {\n            const label = node.ownerDocument.createElement('span');\n            if (w.desc.labelAsHTML) {\n              label.innerHTML = w.desc.label;\n            } else {\n              label.textContent = w.desc.label;\n            }\n            node.appendChild(label);\n            const desc = node.ownerDocument.createElement('span');\n            if (w.desc.summaryAsHTML) {\n              desc.innerHTML = summary;\n            } else {\n              desc.textContent = summary;\n            }\n            node.appendChild(desc);\n            return undefined;\n          }\n        }\n      }\n      if (isWrapper(item) && item.desc.labelAsHTML) {\n        node.innerHTML = item.text;\n      } else {\n        setText(node, item.text);\n      }\n    },\n    collapseable: true,\n  };\n\n  readonly node: HTMLElement;\n  private readonly search: SearchBox<IColumnWrapper> | null;\n  private chooser: HTMLElement | null = null;\n  private readonly descs: IColumnWrapper[] = [];\n  private data: IDataProvider;\n  private readonly rankings: SidePanelRanking[] = [];\n\n  constructor(private ctx: IRankingHeaderContext, document: Document, options: Partial<ISidePanelOptions> = {}) {\n    Object.assign(this.options, options);\n\n    this.node = document.createElement('aside');\n    this.node.classList.add(cssClass('side-panel'));\n\n    this.search = this.options.chooser ? new SearchBox<IColumnWrapper>(this.options) : null;\n\n    this.data = ctx.provider;\n    this.init();\n    this.update(ctx);\n  }\n\n  private init() {\n    this.node.innerHTML = `\n      <aside class=\"${cssClass('stats')}\"></aside>\n      <header class=\"${cssClass('side-panel-rankings')}\">\n        <i class=\"${cssClass('action')}\" title=\"Choose …\">${aria('Choose …')}</i>\n      </header>\n      <main class=\"${cssClass('side-panel-main')}\"></main>\n    `;\n\n    {\n      const choose = this.node.querySelector<HTMLElement>('header > i');\n      choose.onclick = (evt) => {\n        evt.stopPropagation();\n        const dialog = new ChooseRankingDialog(\n          this.rankings.map((d) => d.dropdown),\n          dialogContext(this.ctx, 1, evt)\n        );\n        dialog.open();\n      };\n    }\n\n    if (this.options.collapseable) {\n      this.node.insertAdjacentHTML(\n        'beforeend',\n        `<div class=\"${cssClass('collapser')}\" title=\"Collapse Panel\">${aria('Collapse Panel')}</div>`\n      );\n      const last = this.node.lastElementChild as HTMLElement;\n      last.onclick = () => (this.collapsed = !this.collapsed);\n      this.collapsed = this.options.collapseable === 'collapsed';\n    }\n    this.initChooser();\n    this.changeDataStorage(null, this.data);\n  }\n\n  private initChooser() {\n    if (!this.search) {\n      return;\n    }\n    this.chooser = this.node.ownerDocument!.createElement('header');\n    this.chooser.appendChild(this.chooser.ownerDocument!.createElement('form'));\n    this.chooser.classList.add(cssClass('side-panel-chooser'));\n    this.chooser.firstElementChild!.appendChild(this.search.node);\n    this.search.on(SearchBox.EVENT_SELECT, (panel: IColumnWrapper) => {\n      const col = this.data.create(panel.desc);\n      if (!col) {\n        return;\n      }\n      const a = this.active;\n      if (a) {\n        a.ranking.push(col);\n      }\n    });\n  }\n\n  private get active() {\n    return this.rankings.find((d) => d.active);\n  }\n\n  private changeDataStorage(old: IDataProvider | null, data: IDataProvider) {\n    if (old) {\n      old.on(\n        suffix(\n          '.panel',\n          DataProvider.EVENT_ADD_RANKING,\n          DataProvider.EVENT_REMOVE_RANKING,\n          DataProvider.EVENT_ADD_DESC,\n          DataProvider.EVENT_REMOVE_DESC,\n          DataProvider.EVENT_CLEAR_DESC,\n          DataProvider.EVENT_ORDER_CHANGED,\n          DataProvider.EVENT_SELECTION_CHANGED\n        ),\n        null\n      );\n    }\n    this.data = data;\n\n    const wrapDesc = (desc: IColumnDesc) => ({\n      desc,\n      category: categoryOfDesc(desc, data.columnTypes),\n      id: `${desc.type}@${desc.label}`,\n      text: desc.label,\n    });\n    this.descs.splice(\n      0,\n      this.descs.length,\n      ...data\n        .getColumns()\n        .filter((d) => d.visible !== false)\n        .concat(this.options.additionalDescs)\n        .map(wrapDesc)\n    );\n\n    data.on(`${DataProvider.EVENT_ADD_DESC}.panel`, (desc: IColumnDesc) => {\n      if (desc.visible !== false) {\n        this.descs.push(wrapDesc(desc));\n        this.updateChooser();\n      }\n    });\n\n    data.on(`${DataProvider.EVENT_CLEAR_DESC}.panel`, () => {\n      this.descs.splice(0, this.descs.length);\n      this.updateChooser();\n    });\n\n    data.on(`${DataProvider.EVENT_REMOVE_DESC}.panel`, (desc: IColumnDesc) => {\n      if (desc.visible !== false) {\n        const index = this.descs.findIndex((d) => d.desc === desc);\n        if (index >= 0) {\n          this.descs.splice(index, 1);\n          this.updateChooser();\n        }\n      }\n    });\n\n    data.on(suffix('.panel', DataProvider.EVENT_SELECTION_CHANGED, DataProvider.EVENT_ORDER_CHANGED), () => {\n      this.updateStats();\n    });\n\n    data.on(suffix('.panel', DataProvider.EVENT_ADD_RANKING), (ranking: Ranking, index: number) => {\n      this.createEntry(ranking, index);\n      this.makeActive(index);\n    });\n\n    data.on(suffix('.panel', DataProvider.EVENT_REMOVE_RANKING), (_: Ranking, index: number) => {\n      if (index < 0) {\n        // remove all\n        this.rankings.splice(0, this.rankings.length).forEach((d) => d.destroy());\n        this.node.querySelector('header')!.dataset.count = '0';\n        this.makeActive(-1);\n        return;\n      }\n      const r = this.rankings.splice(index, 1)[0];\n      this.node.querySelector('header')!.dataset.count = String(this.rankings.length);\n      r.destroy();\n      if (r.active) {\n        this.makeActive(this.rankings.length === 0 ? -1 : Math.max(index - 1, 0));\n      }\n    });\n\n    this.rankings.splice(0, this.rankings.length).forEach((d) => d.destroy());\n    data.getRankings().forEach((d, i) => {\n      this.createEntry(d, i);\n    });\n    if (this.rankings.length > 0) {\n      this.makeActive(0);\n    }\n\n    this.updateStats();\n  }\n\n  private createEntry(ranking: Ranking, index: number) {\n    const entry = new SidePanelRanking(ranking, this.ctx, this.node.ownerDocument!, this.options);\n\n    const header = this.node.querySelector('header')!;\n    const main = this.node.querySelector('main')!;\n\n    header.insertBefore(entry.header, header.children[index + 1]); // for the action\n    header.dataset.count = String(this.rankings.length + 1);\n\n    entry.header.onclick = (evt) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n      this.makeActive(this.rankings.indexOf(entry));\n    };\n    entry.dropdown.onclick = entry.header.onclick = (evt) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n      this.ctx.dialogManager.removeAboveLevel(0);\n      this.makeActive(this.rankings.indexOf(entry));\n    };\n\n    main.insertBefore(entry.node, main.children[index]);\n\n    this.rankings.splice(index, 0, entry);\n  }\n\n  get collapsed() {\n    return this.node.classList.contains(cssClass('collapsed'));\n  }\n\n  set collapsed(value: boolean) {\n    this.node.classList.toggle(cssClass('collapsed'), value);\n    if (value) {\n      return;\n    }\n    this.updateChooser();\n    this.updateStats();\n    this.updateRanking();\n  }\n\n  private makeActive(index: number) {\n    this.rankings.forEach((d, i) => (d.active = index === i));\n\n    const active = this.active;\n    if (active && this.chooser) {\n      active.node.insertAdjacentElement('afterbegin', this.chooser);\n      // scroll to body\n      const parent = this.node.closest<HTMLElement>(`.${cssClass()}`)!;\n      const body = parent ? parent.querySelector(`article[data-ranking=\"${active.ranking.id}\"]`) : null;\n      if (body) {\n        body.scrollIntoView();\n      }\n    }\n    this.updateRanking();\n  }\n\n  private updateRanking() {\n    const active = this.active;\n    if (active && !this.collapsed) {\n      active.update(this.ctx);\n    }\n  }\n\n  update(ctx: IRankingHeaderContext) {\n    const bak = this.data;\n    this.ctx = ctx;\n    if (ctx.provider !== bak) {\n      this.changeDataStorage(bak, ctx.provider);\n    }\n    this.updateChooser();\n    this.updateStats();\n\n    const active = this.active;\n    if (active) {\n      active.update(ctx);\n    }\n  }\n\n  private updateStats() {\n    if (this.collapsed) {\n      return;\n    }\n    const stats = this.node.querySelector<HTMLElement>(`.${cssClass('stats')}`);\n    const s = this.data.getSelection();\n    const r = this.data.getFirstRanking();\n    const f = format(',d');\n    const visible = r ? r.getGroups().reduce((a, b) => a + b.order.length, 0) : 0;\n    const total = this.data.getTotalNumberOfRows();\n    stats.innerHTML = `Showing <strong>${f(visible)}</strong> of ${f(total)} items${\n      s.length > 0 ? `; <span>${f(s.length)} selected</span>` : ''\n    }${\n      visible < total\n        ? ` <i class=\"${cssClass('action')} ${cssClass('action-filter')} ${cssClass(\n            'stats-reset'\n          )}\" title=\"Reset filters\"><span>Reset</span></i>`\n        : ''\n    }`;\n\n    const resetButton = stats.querySelector<HTMLElement>(`.${cssClass('stats-reset')}`);\n    if (!resetButton) {\n      return;\n    }\n    resetButton.onclick = (evt) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n      this.data.clearFilters();\n    };\n  }\n\n  destroy() {\n    this.node.remove();\n    if (!this.data) {\n      return;\n    }\n    this.rankings.forEach((d) => d.destroy());\n    this.rankings.length = 0;\n    this.data.on(\n      suffix('.panel', DataProvider.EVENT_ADD_RANKING, DataProvider.EVENT_REMOVE_RANKING, DataProvider.EVENT_ADD_DESC),\n      null\n    );\n  }\n\n  private static groupByType(entries: IColumnWrapper[]): { text: string; children: IColumnWrapper[] }[] {\n    const map = new Map<IColumnCategory, IColumnWrapper[]>();\n    entries.forEach((entry) => {\n      if (!map.has(entry.category)) {\n        map.set(entry.category, [entry]);\n      } else {\n        map.get(entry.category)!.push(entry);\n      }\n    });\n    return Array.from(map)\n      .map(([key, value]) => {\n        return {\n          text: key.label,\n          order: key.order,\n          children: value.sort((a, b) => a.text.localeCompare(b.text)),\n        };\n      })\n      .sort((a, b) => a.order - b.order);\n  }\n\n  private updateChooser() {\n    if (!this.search || this.collapsed) {\n      return;\n    }\n    this.search.data = SidePanel.groupByType(this.descs);\n  }\n}\n","import { ILineUpOptions, defaultOptions } from '../config';\nimport { merge, suffix } from '../internal';\nimport type { DataProvider } from '../provider';\nimport { cssClass } from '../styles';\nimport { ALineUp } from './ALineUp';\nimport EngineRenderer from './EngineRenderer';\nimport SidePanel from './panel/SidePanel';\n\nexport default class LineUp extends ALineUp {\n  static readonly EVENT_SELECTION_CHANGED = ALineUp.EVENT_SELECTION_CHANGED;\n  static readonly EVENT_DIALOG_OPENED = ALineUp.EVENT_DIALOG_OPENED;\n  static readonly EVENT_DIALOG_CLOSED = ALineUp.EVENT_DIALOG_CLOSED;\n  static readonly EVENT_HIGHLIGHT_CHANGED = ALineUp.EVENT_HIGHLIGHT_CHANGED;\n\n  private readonly renderer: EngineRenderer | null;\n  private readonly panel: SidePanel | null;\n\n  private readonly options = defaultOptions();\n\n  constructor(node: HTMLElement, data: DataProvider, options: Partial<ILineUpOptions> = {}) {\n    super(node, data, options && options.ignoreUnsupportedBrowser === true);\n\n    merge(this.options, options);\n\n    if (this.options.copyableRows) {\n      this.addCopyListener();\n    }\n\n    if (!this.isBrowserSupported) {\n      this.renderer = null;\n      this.panel = null;\n      return;\n    }\n\n    this.node.classList.add(cssClass());\n\n    this.renderer = new EngineRenderer(data, this.node, this.options);\n    if (this.options.sidePanel) {\n      this.panel = new SidePanel(this.renderer.ctx, this.node.ownerDocument!, {\n        collapseable: this.options.sidePanelCollapsed ? 'collapsed' : true,\n        hierarchy: this.options.hierarchyIndicator && this.options.flags.advancedRankingFeatures,\n      });\n      this.renderer.pushUpdateAble((ctx) => this.panel!.update(ctx));\n      this.node.insertBefore(this.panel.node, this.node.firstChild);\n    } else {\n      this.panel = null;\n    }\n    this.forward(\n      this.renderer,\n      ...suffix(\n        '.main',\n        EngineRenderer.EVENT_HIGHLIGHT_CHANGED,\n        EngineRenderer.EVENT_DIALOG_OPENED,\n        EngineRenderer.EVENT_DIALOG_CLOSED\n      )\n    );\n  }\n\n  destroy() {\n    this.node.classList.remove(cssClass());\n    if (this.renderer) {\n      this.renderer.destroy();\n    }\n    if (this.panel) {\n      this.panel.destroy();\n    }\n    super.destroy();\n  }\n\n  update() {\n    if (this.renderer) {\n      this.renderer.update();\n    }\n  }\n\n  setDataProvider(data: DataProvider, dump?: any) {\n    super.setDataProvider(data, dump);\n    if (!this.renderer) {\n      return;\n    }\n    this.renderer.setDataProvider(data);\n    this.update();\n    if (this.panel) {\n      this.panel.update(this.renderer.ctx);\n    }\n  }\n\n  setHighlight(dataIndex: number, scrollIntoView = true) {\n    return this.renderer != null && this.renderer.setHighlight(dataIndex, scrollIntoView);\n  }\n\n  getHighlight() {\n    return this.renderer ? this.renderer.getHighlight() : -1;\n  }\n\n  protected enableHighlightListening(enable: boolean) {\n    if (this.renderer) {\n      this.renderer.enableHighlightListening(enable);\n    }\n  }\n}\n","import { IGroupData, IGroupItem, isGroup } from '../../model';\nimport { groupEndLevel, ITopNGetter } from '../../provider/internal';\n\nexport interface IRule {\n  apply(\n    data: (IGroupData | IGroupItem)[],\n    availableHeight: number,\n    selection: Set<number>,\n    topNGetter: ITopNGetter\n  ): IRuleInstance;\n\n  levelOfDetail(item: IGroupData | IGroupItem, height: number): 'high' | 'low';\n}\n\nexport interface IRuleInstance {\n  item: number | ((item: IGroupItem) => number);\n  group: number | ((group: IGroupData) => number);\n  violation?: string;\n}\n\nexport function spaceFillingRule(config: { groupHeight: number; rowHeight: number; groupPadding: number }) {\n  function levelOfDetail(item: IGroupData | IGroupItem, height: number): 'high' | 'low' {\n    const group = isGroup(item);\n    const maxHeight = group ? config.groupHeight : config.rowHeight;\n    if (height >= maxHeight * 0.9) {\n      return 'high';\n    }\n    return 'low';\n  }\n\n  function itemHeight(\n    data: (IGroupData | IGroupItem)[],\n    availableHeight: number,\n    selection: Set<number>,\n    topNGetter: ITopNGetter\n  ) {\n    const visibleHeight = availableHeight - config.rowHeight - 5; // some padding for hover\n    const items = data.filter((d) => !isGroup(d)) as IGroupItem[];\n    const groups = data.length - items.length;\n    const selected = items.reduce((a, d) => a + (selection.has(d.dataIndex) ? 1 : 0), 0);\n    const unselected = items.length - selected;\n    const groupSeparators = items.reduce((a, d) => a + groupEndLevel(d, topNGetter), 0);\n\n    if (unselected <= 0) {\n      // doesn't matter since all are selected anyhow\n      return { height: config.rowHeight, violation: '' };\n    }\n    const available =\n      visibleHeight - groups * config.groupHeight - groupSeparators * config.groupPadding - selected * config.rowHeight;\n\n    const height = Math.floor(available / unselected); // round to avoid sub pixel issues\n    if (height < 1) {\n      return {\n        height: 1,\n        violation: `Not possible to fit all rows on the screen.`,\n      };\n    }\n    // clamp to max height\n    if (height > config.rowHeight) {\n      return {\n        height: config.rowHeight,\n        violation: '',\n      };\n    }\n    return { height, violation: '' };\n  }\n\n  return {\n    apply: (\n      data: (IGroupData | IGroupItem)[],\n      availableHeight: number,\n      selection: Set<number>,\n      topNGetter: ITopNGetter\n    ) => {\n      const { violation, height } = itemHeight(data, availableHeight, selection, topNGetter);\n\n      const item = (item: IGroupItem) => {\n        if (selection.has(item.dataIndex)) {\n          return config.rowHeight;\n        }\n        return height;\n      };\n      return { item, group: config.groupHeight, violation };\n    },\n    levelOfDetail,\n  } as IRule;\n}\n","import type { GridStyleManager } from 'lineupengine';\nimport type { ILineUpOptions } from '../../config';\nimport { debounce, AEventDispatcher, IEventListener, suffix } from '../../internal';\nimport { IGroupData, IGroupItem, isGroup, Ranking, IGroup } from '../../model';\nimport { DataProvider } from '../../provider';\nimport type { IRenderContext } from '../../renderer';\nimport type { IEngineRankingContext } from '../EngineRanking';\nimport EngineRenderer from '../EngineRenderer';\nimport type { IRankingHeaderContext, IRankingHeaderContextContainer } from '../interfaces';\nimport type { IRule } from './rules';\nimport type { ADialog } from '../dialogs';\n\n/**\n * emitted when the highlight changes\n * @asMemberOf TaggleRenderer\n * @param dataIndex the highlighted data index or -1 for none\n * @event\n */\nexport declare function highlightChanged(dataIndex: number): void;\n/**\n * emitted a dialog is opened\n * @asMemberOf TaggleRenderer\n * @param dialog the opened dialog\n * @event\n */\nexport declare function dialogOpened(dialog: ADialog): void;\n/**\n * emitted a dialog is closed\n * @asMemberOf TaggleRenderer\n * @param dialog the closed dialog\n * @param action the action how the dialog was closed\n * @event\n */\nexport declare function dialogClosed(dialog: ADialog, action: 'cancel' | 'confirm'): void;\n\nexport interface ITaggleOptions {\n  violationChanged(rule: IRule | null, violation: string): void;\n\n  rowPadding: number;\n}\n\nexport default class TaggleRenderer extends AEventDispatcher {\n  static readonly EVENT_HIGHLIGHT_CHANGED = EngineRenderer.EVENT_HIGHLIGHT_CHANGED;\n  static readonly EVENT_DIALOG_OPENED = EngineRenderer.EVENT_DIALOG_OPENED;\n  static readonly EVENT_DIALOG_CLOSED = EngineRenderer.EVENT_DIALOG_CLOSED;\n\n  private isDynamicLeafHeight = false;\n\n  private rule: IRule | null = null;\n  private levelOfDetail: ((rowIndex: number) => 'high' | 'low') | null = null;\n  private readonly resizeListener = () => debounce(() => this.update(), 100);\n  private readonly renderer: EngineRenderer;\n\n  private readonly options: Readonly<ITaggleOptions> = {\n    violationChanged: () => undefined,\n    rowPadding: 2,\n  };\n\n  constructor(\n    public data: DataProvider,\n    parent: HTMLElement,\n    options: Partial<ITaggleOptions> & Readonly<ILineUpOptions>\n  ) {\n    super();\n    Object.assign(this.options, options);\n\n    this.renderer = new EngineRenderer(\n      data,\n      parent,\n      Object.assign({}, options, {\n        dynamicHeight: (data: (IGroupData | IGroupItem)[], ranking: Ranking) => {\n          const r = this.dynamicHeight(data, ranking);\n          if (r) {\n            return r;\n          }\n          return options.dynamicHeight ? options.dynamicHeight(data, ranking) : null;\n        },\n        levelOfDetail: (rowIndex: number) => (this.levelOfDetail ? this.levelOfDetail(rowIndex) : 'high'),\n      })\n    );\n\n    this.data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.rule`, () => {\n      if (this.isDynamicLeafHeight) {\n        this.update();\n      }\n    });\n    this.forward(\n      this.renderer,\n      ...suffix(\n        '.main',\n        EngineRenderer.EVENT_HIGHLIGHT_CHANGED,\n        EngineRenderer.EVENT_DIALOG_OPENED,\n        EngineRenderer.EVENT_DIALOG_CLOSED\n      )\n    );\n\n    window.addEventListener('resize', this.resizeListener, {\n      passive: true,\n    });\n  }\n\n  get style(): GridStyleManager {\n    return this.renderer.style;\n  }\n\n  get ctx(): IRankingHeaderContextContainer & IRenderContext & IEngineRankingContext {\n    return this.renderer.ctx;\n  }\n\n  pushUpdateAble(updateAble: (ctx: IRankingHeaderContext) => void) {\n    this.renderer.pushUpdateAble(updateAble);\n  }\n\n  private dynamicHeight(data: (IGroupData | IGroupItem)[], ranking: Ranking) {\n    if (!this.rule) {\n      this.levelOfDetail = null;\n      this.options.violationChanged(null, '');\n      return null;\n    }\n\n    const availableHeight = this.renderer ? this.renderer.node.querySelector('main')!.clientHeight : 100;\n    const topNGetter = (group: IGroup) => this.data.getTopNAggregated(ranking, group);\n    const instance = this.rule.apply(data, availableHeight, new Set(this.data.getSelection()), topNGetter);\n\n    this.isDynamicLeafHeight = typeof instance.item === 'function';\n\n    this.options.violationChanged(this.rule, instance.violation || '');\n\n    const height = (item: IGroupItem | IGroupData) => {\n      if (isGroup(item)) {\n        return typeof instance.group === 'number' ? instance.group : instance.group(item);\n      }\n      return typeof instance.item === 'number' ? instance.item : instance.item(item);\n    };\n\n    this.levelOfDetail = (rowIndex: number) => {\n      const item = data[rowIndex];\n      return this.rule ? this.rule.levelOfDetail(item, height(item)) : 'high';\n    };\n\n    // padding is always 0 since included in height\n    // const padding = (item: IGroupData | IGroupItem | null) => {\n    //   if (!item) {\n    //     item = data[0];\n    //   }\n    //   const lod = this.rule ? this.rule.levelOfDetail(item, height(item)) : 'high';\n    //   return lod === 'high' ? 0 : 0; // always 0 since\n    // };\n\n    return {\n      defaultHeight: typeof instance.item === 'number' ? instance.item : NaN,\n      height,\n      padding: 0,\n    };\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        TaggleRenderer.EVENT_HIGHLIGHT_CHANGED,\n        TaggleRenderer.EVENT_DIALOG_OPENED,\n        TaggleRenderer.EVENT_DIALOG_CLOSED,\n      ]);\n  }\n\n  on(type: typeof TaggleRenderer.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\n  on(type: typeof TaggleRenderer.EVENT_DIALOG_OPENED, listener: typeof dialogOpened | null): this;\n  on(type: typeof TaggleRenderer.EVENT_DIALOG_CLOSED, listener: typeof dialogClosed | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  zoomOut() {\n    this.renderer.zoomOut();\n  }\n\n  zoomIn() {\n    this.renderer.zoomIn();\n  }\n\n  switchRule(rule: IRule | null) {\n    if (this.rule === rule) {\n      return;\n    }\n    this.rule = rule;\n    this.update();\n  }\n\n  getRule(): IRule | null {\n    return this.rule;\n  }\n\n  destroy() {\n    this.renderer.destroy();\n    window.removeEventListener('resize', this.resizeListener);\n  }\n\n  update() {\n    this.renderer.update();\n  }\n\n  setDataProvider(data: DataProvider) {\n    if (this.data) {\n      this.data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.rule`, null);\n    }\n    this.data = data;\n    this.data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.rule`, () => {\n      if (this.isDynamicLeafHeight) {\n        this.update();\n      }\n    });\n    this.renderer.setDataProvider(data);\n    this.update();\n  }\n\n  setHighlight(dataIndex: number, scrollIntoView: boolean) {\n    return this.renderer.setHighlight(dataIndex, scrollIntoView);\n  }\n\n  getHighlight() {\n    return this.renderer.getHighlight();\n  }\n\n  enableHighlightListening(enable: boolean) {\n    this.renderer.enableHighlightListening(enable);\n  }\n}\n","import type { GridStyleManager } from 'lineupengine';\nimport { defaultOptions } from '../../config';\nimport type { ITaggleOptions } from '../../config';\nimport { merge, suffix } from '../../internal';\nimport type { DataProvider } from '../../provider';\nimport { cssClass, engineCssClass } from '../../styles';\nimport { ALineUp } from '../ALineUp';\nimport SidePanel from '../panel/SidePanel';\nimport { spaceFillingRule, IRule } from './rules';\nimport TaggleRenderer from './TaggleRenderer';\n\nexport default class Taggle extends ALineUp {\n  static readonly EVENT_SELECTION_CHANGED = ALineUp.EVENT_SELECTION_CHANGED;\n  static readonly EVENT_DIALOG_OPENED = ALineUp.EVENT_DIALOG_OPENED;\n  static readonly EVENT_DIALOG_CLOSED = ALineUp.EVENT_DIALOG_CLOSED;\n  static readonly EVENT_HIGHLIGHT_CHANGED = ALineUp.EVENT_HIGHLIGHT_CHANGED;\n\n  private readonly spaceFilling: HTMLElement | null;\n  private readonly renderer: TaggleRenderer | null;\n  private readonly panel: SidePanel | null;\n  private readonly spaceFillingRule: IRule;\n\n  private readonly options = defaultOptions();\n\n  constructor(node: HTMLElement, data: DataProvider, options: Partial<ITaggleOptions> = {}) {\n    super(node, data, options && options.ignoreUnsupportedBrowser === true);\n    merge(this.options, options);\n    merge(this.options, {\n      violationChanged: (_rule: any, violation?: string) => this.setViolation(violation),\n    });\n\n    if (this.options.copyableRows) {\n      this.addCopyListener();\n    }\n    this.spaceFillingRule = spaceFillingRule(this.options);\n\n    if (!this.isBrowserSupported) {\n      this.spaceFilling = null;\n      this.renderer = null;\n      this.panel = null;\n      return;\n    }\n\n    this.node.classList.add(cssClass(), cssClass('taggle'));\n\n    this.renderer = new TaggleRenderer(data, this.node, this.options);\n\n    if (this.options.sidePanel) {\n      this.panel = new SidePanel(this.renderer.ctx, this.node.ownerDocument!, {\n        collapseable: this.options.sidePanelCollapsed ? 'collapsed' : true,\n        hierarchy: this.options.hierarchyIndicator && this.options.flags.advancedRankingFeatures,\n      });\n      this.renderer.pushUpdateAble((ctx) => this.panel!.update(ctx));\n      this.node.insertBefore(this.panel.node, this.node.firstChild);\n      this.panel.node.insertAdjacentHTML(\n        'afterbegin',\n        `<div class=\"${cssClass('rule-button-chooser')} ${cssClass('feature-advanced')} ${cssClass(\n          'feature-ui'\n        )}\"><label>\n            <input type=\"checkbox\">\n            <span>Overview</span>\n            <div class=\"${cssClass('rule-violation')}\"></div>\n          </label></div>`\n      );\n      this.spaceFilling = this.panel.node.querySelector<HTMLElement>(`.${cssClass('rule-button-chooser')}`)!;\n      const input = this.spaceFilling.querySelector<HTMLInputElement>('input');\n      input.onchange = () => {\n        setTimeout(() => {\n          this.setOverviewMode(!this.isOverviewMode());\n        });\n      };\n    } else {\n      this.panel = null;\n      this.spaceFilling = null;\n    }\n    if (this.options.overviewMode) {\n      this.setOverviewMode(true);\n    }\n    this.forward(\n      this.renderer,\n      ...suffix(\n        '.main',\n        TaggleRenderer.EVENT_HIGHLIGHT_CHANGED,\n        TaggleRenderer.EVENT_DIALOG_OPENED,\n        TaggleRenderer.EVENT_DIALOG_CLOSED\n      )\n    );\n  }\n\n  isOverviewMode() {\n    return this.renderer?.getRule() === this.spaceFillingRule;\n  }\n\n  setOverviewMode(overviewMode: boolean) {\n    if (!this.renderer) {\n      return;\n    }\n    this.updateLodRules(overviewMode);\n    this.renderer.switchRule(overviewMode ? this.spaceFillingRule : null);\n    if (this.spaceFilling) {\n      this.spaceFilling.classList.toggle(cssClass('chosen'), overviewMode);\n      this.spaceFilling.querySelector<HTMLInputElement>('input')!.checked = overviewMode;\n    }\n  }\n\n  private updateLodRules(overviewMode: boolean) {\n    if (!this.renderer) {\n      return;\n    }\n    updateLodRules(this.renderer.style, overviewMode, this.options);\n  }\n\n  private setViolation(violation?: string) {\n    violation = violation || '';\n    if (!this.spaceFilling) {\n      return;\n    }\n    this.spaceFilling.classList.toggle(cssClass('violated'), Boolean(violation));\n    const elem = this.spaceFilling.querySelector(`.${cssClass('rule-violation')}`)!;\n    if (!violation) {\n      elem.textContent = '';\n    } else {\n      elem.innerHTML = violation.replace(/\\n/g, '<br>');\n    }\n  }\n\n  destroy() {\n    this.node.classList.remove(cssClass(), cssClass('taggle'));\n    if (this.renderer) {\n      this.renderer.destroy();\n    }\n    if (this.panel) {\n      this.panel.destroy();\n    }\n    super.destroy();\n  }\n\n  update() {\n    if (this.renderer) {\n      this.renderer.update();\n    }\n  }\n\n  setHighlight(dataIndex: number, scrollIntoView = true) {\n    return this.renderer != null && this.renderer.setHighlight(dataIndex, scrollIntoView);\n  }\n\n  getHighlight() {\n    return this.renderer ? this.renderer.getHighlight() : -1;\n  }\n\n  protected enableHighlightListening(enable: boolean) {\n    if (this.renderer) {\n      this.renderer.enableHighlightListening(enable);\n    }\n  }\n\n  setDataProvider(data: DataProvider, dump?: any) {\n    super.setDataProvider(data, dump);\n    if (!this.renderer) {\n      return;\n    }\n    this.renderer.setDataProvider(data);\n    this.update();\n    this.panel!.update(this.renderer.ctx);\n  }\n}\n\nexport function updateLodRules(style: GridStyleManager, overviewMode: boolean, options: Readonly<ITaggleOptions>) {\n  if (!overviewMode) {\n    style.deleteRule('taggle_lod_rule');\n    style.deleteRule('lineup_rowPadding1');\n    style.deleteRule('lineup_rowPadding2');\n    return;\n  }\n\n  style.updateRule(\n    'taggle_lod_rule',\n    `\n  .${engineCssClass('tr')}.${cssClass('low')}[data-agg=detail]:hover`,\n    {\n      /* show regular height for hovered rows in low + medium LOD */\n      height: `${options.rowHeight}px !important`,\n    }\n  );\n\n  style.updateRule(\n    'lineup_rowPadding1',\n    `\n  .${engineCssClass('tr')}.${cssClass('low')}`,\n    {\n      marginTop: '0',\n    }\n  );\n\n  // no margin for hovered low level row otherwise everything will be shifted down and the hover is gone again\n  // .${engineCssClass('tr')}.${cssClass('low')}:hover,\n\n  // padding in general and for hovered low detail rows + their afterwards\n  style.updateRule(\n    'lineup_rowPadding2',\n    `\n  .${engineCssClass('tr')}.${cssClass('low')}.${engineCssClass('highlighted')},\n  .${engineCssClass('tr')}.${cssClass('selected')},\n  .${engineCssClass('tr')}.${cssClass('low')}:hover + .${engineCssClass('tr')}.${cssClass('low')},\n  .${engineCssClass('tr')}.${cssClass('low')}.${engineCssClass('highlighted')} + .${engineCssClass('tr')}.${cssClass(\n      'low'\n    )},\n  .${engineCssClass('tr')}.${cssClass('selected')} + .${engineCssClass('tr')}.${cssClass('low')}`,\n    {\n      marginTop: `${options.rowPadding}px !important`,\n    }\n  );\n}\n","import type { IArrayDesc, IColumnDesc } from '../../model';\n\nexport default class ColumnBuilder<T extends IColumnDesc = IColumnDesc> {\n  protected readonly desc: T;\n\n  constructor(type: string, column: string) {\n    this.desc = { column, type, label: column ? column[0].toUpperCase() + column.slice(1) : type } as any;\n  }\n\n  /**\n   * column label\n   */\n  label(label: string) {\n    this.desc.label = label;\n    return this;\n  }\n  htmlLabel(label: string) {\n    this.desc.label = label;\n    this.desc.labelAsHTML = true;\n    return this;\n  }\n\n  /**\n   * hide this column by default\n   */\n  hidden() {\n    this.desc.visible = false;\n    return this;\n  }\n\n  /**\n   * column summary text (subtitle)\n   */\n  summary(summary: string) {\n    this.desc.summary = summary;\n    return this;\n  }\n  htmlSummary(label: string) {\n    this.desc.summary = label;\n    this.desc.summaryAsHTML = true;\n    return this;\n  }\n\n  /**\n   * column description\n   */\n  description(description: string) {\n    this.desc.description = description;\n    return this;\n  }\n\n  /**\n   * sets the frozen state of this column, i.e is sticky to the left side when scrolling horizontally\n   */\n  frozen() {\n    this.desc.frozen = true;\n    return this;\n  }\n\n  /**\n   * specify the renderer to used for this column\n   * @param {string} renderer within a cell\n   * @param {string} groupRenderer within an aggregated cell\n   * @param {string} summaryRenderer within the summary in the header and side panel\n   */\n  renderer(renderer?: string, groupRenderer?: string, summaryRenderer?: string) {\n    if (renderer) {\n      this.desc.renderer = renderer;\n    }\n    if (groupRenderer) {\n      this.desc.groupRenderer = groupRenderer;\n    }\n    if (summaryRenderer) {\n      this.desc.summaryRenderer = summaryRenderer;\n    }\n    return this;\n  }\n\n  /**\n   * specify a custom additional attribute for the description\n   * @param {string} key the property key\n   * @param value its value\n   */\n  custom(key: string, value: any) {\n    (this.desc as any)[key] = value;\n    return this;\n  }\n\n  /**\n   * sets the default width of the column\n   */\n  width(width: number) {\n    this.desc.width = width;\n    return this;\n  }\n\n  /**\n   * sets the column color in case of numerical columns\n   * @deprecated use colorMapping in the number case instead\n   */\n  color(_color: string) {\n    return this;\n  }\n\n  /**\n   * converts the column type to be an array type, supports only base types: boolean, categorical, date, number, and string\n   * @param {string[] | number} labels labels to use for each array item or the expected length of an value\n   */\n  asArray(labels?: string[] | number) {\n    console.assert(['boolean', 'categorical', 'date', 'number', 'string', 'link'].includes(this.desc.type!));\n    this.desc.type += 's';\n    const a = this.desc as IArrayDesc;\n    if (Array.isArray(labels)) {\n      a.labels = labels;\n      a.dataLength = labels.length;\n    } else if (typeof labels === 'number') {\n      a.dataLength = labels;\n    }\n    return this;\n  }\n\n  /**\n   * converts the column type to be a map type, supports only base types: categorical, date, number, and string\n   */\n  asMap() {\n    console.assert(['categorical', 'date', 'number', 'string', 'link'].includes(this.desc.type!));\n    this.desc.type += 'Map';\n    return this;\n  }\n\n  /**\n   * build the column description\n   */\n  build(_data: any[]): T {\n    return this.desc as any;\n  }\n}\n\n/**\n * build a column of a given type\n * @param {string} type column type\n * @param {string} column column which contains the associated data\n * @returns {ColumnBuilder<IColumnDesc>}\n */\nexport function buildColumn(type: string, column: string) {\n  return new ColumnBuilder(type, column);\n}\n","import type { IDynamicHeight, ITaggleOptions, ILivePreviewOptions } from '../config';\nimport type { IGroupData, IGroupItem, Ranking } from '../model';\nimport type Column from '../model';\nimport type { ICellRendererFactory, ERenderMode } from '../renderer';\nimport type { IToolbarAction, IToolbarDialogAddon } from '../ui';\n\n/**\n * builder for LineUp/Taggle instance\n */\nexport default class LineUpBuilder {\n  protected readonly options: Partial<ITaggleOptions> = {\n    renderers: {},\n    toolbarActions: {},\n    toolbarDialogAddons: {},\n    flags: {},\n  };\n\n  /**\n   * option to enable/disable animated transitions\n   * @default true\n   */\n  animated(enable: boolean) {\n    this.options.animated = enable;\n    return this;\n  }\n\n  livePreviews(options: Partial<ILivePreviewOptions>) {\n    this.options.livePreviews = options;\n    return this;\n  }\n\n  /**\n   * option to rotate labels on demand in narrow columns\n   * @param rotation rotation in degrees\n   * @default 0 - disabled\n   */\n  labelRotation(rotation: number) {\n    this.options.labelRotation = rotation;\n    return this;\n  }\n\n  /**\n   * option to enable/disable the side panel\n   * @param {boolean} enable enable flag\n   * @param {boolean} collapsed whether collapsed by default\n   */\n  sidePanel(enable: boolean, collapsed = false) {\n    this.options.sidePanel = enable;\n    this.options.sidePanelCollapsed = collapsed;\n    return this;\n  }\n\n  /**\n   * show the sorting and grouping hierarchy indicator in the side panel\n   * @param {boolean} enable enable flag\n   */\n  hierarchyIndicator(enable: boolean) {\n    this.options.hierarchyIndicator = enable;\n    return this;\n  }\n\n  /**\n   * option to specify the default slope graph mode\n   * @default 'item'\n   */\n  defaultSlopeGraphMode(mode: 'item' | 'band') {\n    this.options.defaultSlopeGraphMode = mode;\n    return this;\n  }\n\n  /**\n   * option to enable/disable showing a summary (histogram, ...) in the header\n   * @default true\n   */\n  summaryHeader(enable: boolean) {\n    this.options.summaryHeader = enable;\n    return this;\n  }\n\n  /**\n   * option to enforce that the whole row is shown upon hover without overflow hidden\n   * @default false\n   */\n  expandLineOnHover(enable: boolean) {\n    this.options.expandLineOnHover = enable;\n    return this;\n  }\n\n  /**\n   * option to enable overview mode by default, just valid when building a Taggle instance\n   * @returns {this}\n   */\n  overviewMode() {\n    this.options.overviewMode = true;\n    return this;\n  }\n\n  /**\n   * option to ignore unsupported browser check - at own risk\n   * @returns {this}\n   */\n  ignoreUnsupportedBrowser() {\n    this.options.ignoreUnsupportedBrowser = true;\n    return this;\n  }\n\n  /**\n   * register a new renderer factory function\n   * @param id the renderer id\n   * @param factory factory class implementing the renderer\n   */\n  registerRenderer(id: string, factory: ICellRendererFactory) {\n    this.options.renderers![id] = factory;\n    return this;\n  }\n\n  /**\n   * custom function whether the given renderer should be allowed to render the give colum in the given mode\n   */\n  canRender(canRender: (type: string, renderer: ICellRendererFactory, col: Column, mode: ERenderMode) => boolean) {\n    this.options.canRender = canRender;\n    return this;\n  }\n\n  /**\n   * register another toolbar action which can be used within a model class\n   * @param id toolbar id\n   * @param action\n   */\n  registerToolbarAction(id: string, action: IToolbarAction) {\n    this.options.toolbarActions![id] = action;\n    return this;\n  }\n\n  /**\n   * register another toolbar action which can be sued within a model class\n   * @param id  dialog id\n   * @param addon addon description\n   */\n  registerToolbarDialogAddon(id: string, addon: IToolbarDialogAddon) {\n    this.options.toolbarDialogAddons![id] = addon;\n    return this;\n  }\n\n  /**\n   * height and padding of a row\n   * @default 18 and 2\n   */\n  rowHeight(rowHeight: number, rowPadding = 2) {\n    this.options.rowHeight = rowHeight;\n    this.options.rowPadding = rowPadding;\n    return this;\n  }\n\n  /**\n   * height and padding of an aggregated group in pixel\n   * @default 40 and 5\n   */\n  groupRowHeight(groupHeight: number, groupPadding = 5) {\n    this.options.groupHeight = groupHeight;\n    this.options.groupPadding = groupPadding;\n    return this;\n  }\n\n  /**\n   * custom function to compute the height of a row (group or item)\n   * @param {(data: (IGroupItem | IGroupData)[], ranking: Ranking) => (IDynamicHeight | null)} callback\n   */\n  dynamicHeight(callback: (data: (IGroupItem | IGroupData)[], ranking: Ranking) => IDynamicHeight | null) {\n    this.options.dynamicHeight = callback;\n    return this;\n  }\n\n  /**\n   * disables advanced ranking features (sort by, group by, sorting hierarchy, ...)\n   */\n  disableAdvancedRankingFeatures() {\n    this.options.flags!.advancedRankingFeatures = false;\n    return this;\n  }\n\n  /**\n   * disables advanced model features (add combine column, data mapping, edit pattern, ...)\n   */\n  disableAdvancedModelFeatures() {\n    this.options.flags!.advancedModelFeatures = false;\n    return this;\n  }\n\n  /**\n   * disables advanced ui features (change visualization, color mapping)\n   */\n  disableAdvancedUIFeatures() {\n    this.options.flags!.advancedUIFeatures = false;\n    return this;\n  }\n\n  /**\n   * identifier for this LineUp instance. by default a random id is generated.\n   * @default random string\n   */\n  instanceId(instanceId: string) {\n    this.options.instanceId = instanceId;\n    return this;\n  }\n}\n","import {\n  Column,\n  CompositeColumn,\n  Ranking,\n  ReduceColumn,\n  StackColumn,\n  createAggregateDesc,\n  createGroupDesc,\n  createImpositionBoxPlotDesc,\n  createImpositionDesc,\n  createImpositionsDesc,\n  createNestedDesc,\n  createRankDesc,\n  createReduceDesc,\n  createScriptDesc,\n  createSelectionDesc,\n  createStackDesc,\n  EAdvancedSortMethod,\n  IColumnDesc,\n  ISortCriteria,\n} from '../model';\nimport type { DataProvider } from '../provider';\n\nexport interface IImposeColumnBuilder {\n  type: 'impose';\n  column: string;\n  label?: string;\n  colorColumn: string;\n}\n\nexport interface INestedBuilder {\n  type: 'nested';\n  label?: string;\n  columns: string[];\n}\n\nexport interface IWeightedSumBuilder {\n  type: 'weightedSum';\n  columns: string[];\n  label?: string;\n  weights: number[];\n}\n\nexport interface IReduceBuilder {\n  type: 'min' | 'max' | 'mean' | 'median';\n  columns: string[];\n  label?: string;\n}\n\nexport interface IScriptedBuilder {\n  type: 'script';\n  code: string;\n  columns: string[];\n  label?: string;\n}\n\n/**\n * builder for a ranking\n */\nexport class RankingBuilder {\n  private static readonly ALL_MAGIC_FLAG = '*';\n\n  private readonly columns: (\n    | string\n    | { desc: IColumnDesc | ((data: DataProvider) => IColumnDesc); columns: string[]; post?: (col: Column) => void }\n  )[] = [];\n  private readonly sort: { column: string; asc: boolean }[] = [];\n  private readonly groupSort: { column: string; asc: boolean }[] = [];\n  private readonly groups: string[] = [];\n\n  /**\n   * specify another sorting criteria\n   * @param {string} column the column name optionally with encoded sorting separated by colon, e.g. a:desc\n   * @param {boolean | \"asc\" | \"desc\"} asc ascending or descending order\n   */\n  sortBy(column: string, asc: boolean | 'asc' | 'desc' = true) {\n    if (column.includes(':')) {\n      // encoded sorting order\n      const index = column.indexOf(':');\n      asc = column.slice(index + 1) as 'asc' | 'desc';\n      column = column.slice(0, index);\n    }\n    this.sort.push({ column, asc: asc === true || String(asc)[0] === 'a' });\n    return this;\n  }\n\n  /**\n   * specify grouping criteria\n   * @returns {this}\n   */\n  groupBy(...columns: (string | string[])[]) {\n    for (const col of columns) {\n      if (Array.isArray(col)) {\n        this.groups.push(...col);\n      } else {\n        this.groups.push(col);\n      }\n    }\n    return this;\n  }\n\n  /**\n   * specify another grouping sorting criteria\n   * @param {string} column the column name optionally with encoded sorting separated by colon, e.g. a:desc\n   * @param {boolean | \"asc\" | \"desc\"} asc ascending or descending order\n   */\n  groupSortBy(column: string, asc: boolean | 'asc' | 'desc' = true) {\n    if (column.includes(':')) {\n      // encoded sorting order\n      const index = column.indexOf(':');\n      asc = column.slice(index + 1) as 'asc' | 'desc';\n      column = column.slice(0, index);\n    }\n    this.groupSort.push({ column, asc: asc === true || String(asc)[0] === 'a' });\n    return this;\n  }\n\n  /**\n   * add another column to this ranking, identified by column name or label. magic names are used for special columns:\n   * <ul>\n   *     <li>'*' = all columns</li>\n   *     <li>'_*' = all support columns</li>\n   *     <li>'_aggregate' = aggregate column</li>\n   *     <li>'_selection' = selection column</li>\n   *     <li>'_group' = group column</li>\n   *     <li>'_rank' = rank column</li>\n   * </ul>\n   * In addition build objects for combined columns are supported.\n   * @param {string | IImposeColumnBuilder | INestedBuilder | IWeightedSumBuilder | IReduceBuilder | IScriptedBuilder} column\n   */\n  column(\n    column: string | IImposeColumnBuilder | INestedBuilder | IWeightedSumBuilder | IReduceBuilder | IScriptedBuilder\n  ) {\n    if (typeof column === 'string') {\n      switch (column) {\n        case '_aggregate':\n          return this.aggregate();\n        case '_selection':\n          return this.selection();\n        case '_group':\n          return this.group();\n        case '_rank':\n          return this.rank();\n        case '_*':\n          return this.supportTypes();\n        case '*':\n          return this.allColumns();\n      }\n      this.columns.push(column);\n      return this;\n    }\n    const label = column.label || null;\n    // builder ish\n    switch (column.type) {\n      case 'impose':\n        return this.impose(label, column.column, column.colorColumn);\n      case 'min':\n      case 'max':\n      case 'median':\n      case 'mean':\n        console.assert(column.columns.length >= 2);\n        return this.reduce(label, column.type as any, column.columns[0], column.columns[1], ...column.columns.slice(2));\n      case 'nested':\n        console.assert(column.columns.length >= 1);\n        return this.nested(label, column.columns[0], ...column.columns.slice(1));\n      case 'script':\n        return this.scripted(label, column.code, ...column.columns);\n      case 'weightedSum':\n        console.assert(column.columns.length >= 2);\n        console.assert(column.columns.length === column.weights.length);\n        const mixed: (string | number)[] = [];\n        column.columns.slice(2).forEach((c, i) => {\n          mixed.push(c);\n          mixed.push(column.weights[i + 2]);\n        });\n        return this.weightedSum(\n          label,\n          column.columns[0],\n          column.weights[0],\n          column.columns[1],\n          column.weights[1],\n          ...mixed\n        );\n    }\n  }\n\n  /**\n   * add an imposed column (numerical column colored by categorical column) to this ranking\n   * @param {string | null} label optional label\n   * @param {string} numberColumn numerical column reference\n   * @param {string} colorColumn categorical column reference\n   */\n  impose(label: string | null, numberColumn: string, colorColumn: string) {\n    this.columns.push({\n      desc: (data) => {\n        const base = data.getColumns().find((d) => d.label === numberColumn || (d as any).column === numberColumn);\n        switch (base ? base.type : '') {\n          case 'boxplot':\n            return createImpositionBoxPlotDesc(label ? label : undefined);\n          case 'numbers':\n            return createImpositionsDesc(label ? label : undefined);\n          default:\n            return createImpositionDesc(label ? label : undefined);\n        }\n      },\n      columns: [numberColumn, colorColumn],\n    });\n    return this;\n  }\n\n  /**\n   * add a nested / group composite column\n   * @param {string | null} label optional label\n   * @param {string} column first element of the group enforcing not empty ones\n   * @param {string} columns additional columns\n   */\n  nested(label: string | null, column: string, ...columns: string[]) {\n    this.columns.push({\n      desc: createNestedDesc(label ? label : undefined),\n      columns: [column].concat(columns),\n    });\n    return this;\n  }\n\n  /**\n   * @param {IColumnDesc} desc the composite column description\n   * @param {string} columns additional columns to add as children\n   */\n  composite(desc: IColumnDesc, ...columns: string[]) {\n    this.columns.push({\n      desc,\n      columns,\n    });\n    return this;\n  }\n\n  /**\n   * add a weighted sum / stack column\n   * @param {string | null} label optional label\n   * @param {string} numberColumn1 the first numerical column\n   * @param {number} weight1 its weight (0..1)\n   * @param {string} numberColumn2 the second numerical column\n   * @param {number} weight2 its weight (0..1)\n   * @param {string | number} numberColumnAndWeights alternating column weight references\n   */\n  weightedSum(\n    label: string | null,\n    numberColumn1: string,\n    weight1: number,\n    numberColumn2: string,\n    weight2: number,\n    ...numberColumnAndWeights: (string | number)[]\n  ) {\n    const weights = [weight1, weight2].concat(numberColumnAndWeights.filter((_, i) => i % 2 === 1) as number[]);\n    this.columns.push({\n      desc: createStackDesc(label ? label : undefined),\n      columns: [numberColumn1, numberColumn2].concat(numberColumnAndWeights.filter((_, i) => i % 2 === 0) as string[]),\n      post: (col) => {\n        (col as StackColumn).setWeights(weights);\n      },\n    });\n    return this;\n  }\n\n  /**\n   * add reducing column (min, max, median, mean, ...)\n   * @param {string | null} label optional label\n   * @param {EAdvancedSortMethod} operation operation to apply (min, max, median, mean, ...)\n   * @param {string} numberColumn1 first numerical column\n   * @param {string} numberColumn2 second numerical column\n   * @param {string} numberColumns additional numerical columns\n   */\n  reduce(\n    label: string | null,\n    operation: EAdvancedSortMethod,\n    numberColumn1: string,\n    numberColumn2: string,\n    ...numberColumns: string[]\n  ) {\n    this.columns.push({\n      desc: createReduceDesc(label ? label : undefined),\n      columns: [numberColumn1, numberColumn2].concat(numberColumns),\n      post: (col) => {\n        (col as ReduceColumn).setReduce(operation);\n      },\n    });\n    return this;\n  }\n\n  /**\n   * add a scripted / formula column\n   * @param {string | null} label optional label\n   * @param {string} code the JS code see ScriptColumn for details\n   * @param {string} numberColumns additional script columns\n   */\n  scripted(label: string | null, code: string, ...numberColumns: string[]) {\n    this.columns.push({\n      desc: Object.assign(createScriptDesc(label ? label : undefined), { script: code }),\n      columns: numberColumns,\n    });\n    return this;\n  }\n\n  /**\n   * add a selection column for easier multi selections\n   */\n  selection() {\n    this.columns.push({\n      desc: createSelectionDesc(),\n      columns: [],\n    });\n    return this;\n  }\n\n  /**\n   * add a group column to show the current group name\n   */\n  group() {\n    this.columns.push({\n      desc: createGroupDesc(),\n      columns: [],\n    });\n    return this;\n  }\n\n  /**\n   * add an aggregate column to this ranking to collapse/expand groups\n   */\n  aggregate() {\n    this.columns.push({\n      desc: createAggregateDesc(),\n      columns: [],\n    });\n    return this;\n  }\n\n  /**\n   * add a ranking column\n   */\n  rank() {\n    this.columns.push({\n      desc: createRankDesc(),\n      columns: [],\n    });\n    return this;\n  }\n\n  /**\n   * add suporttypes (aggregate, rank, selection) to the ranking\n   */\n  supportTypes() {\n    return this.aggregate().rank().selection();\n  }\n\n  /**\n   * add all columns to this ranking\n   */\n  allColumns() {\n    this.columns.push(RankingBuilder.ALL_MAGIC_FLAG);\n    return this;\n  }\n\n  build(data: DataProvider): Ranking {\n    const r = data.pushRanking();\n    const cols = data.getColumns();\n\n    const findDesc = (c: string) => cols.find((d) => d.label === c || (d as any).column === c);\n\n    const addColumn = (c: string) => {\n      const desc = findDesc(c);\n      if (desc) {\n        return data.push(r, desc) != null;\n      }\n      console.warn('invalid column: ', c);\n      return false;\n    };\n\n    this.columns.forEach((c) => {\n      if (c === RankingBuilder.ALL_MAGIC_FLAG) {\n        cols.forEach((col) => data.push(r, col));\n        return;\n      }\n      if (typeof c === 'string') {\n        addColumn(c);\n        return;\n      }\n      const col = data.create(typeof c.desc === 'function' ? c.desc(data) : c.desc)!;\n      r.push(col);\n      c.columns.forEach((ci) => {\n        const d = findDesc(ci);\n        const child = d ? data.create(d) : null;\n        if (!child) {\n          console.warn('invalid column: ', ci);\n          return;\n        }\n        (col as CompositeColumn).push(child);\n      });\n      if (c.post) {\n        c.post(col);\n      }\n    });\n\n    const children = r.children;\n    {\n      const groups: Column[] = [];\n      this.groups.forEach((column) => {\n        const col = children.find((d) => d.desc.label === column || (d as any).desc.column === column);\n        if (col) {\n          groups.push(col);\n          return;\n        }\n        const desc = findDesc(column);\n        if (!desc) {\n          console.warn('invalid group criteria column: ', column);\n          return;\n        }\n        const col2 = data.push(r, desc);\n        if (col2) {\n          groups.push(col2);\n          return;\n        }\n        console.warn('invalid group criteria column: ', column);\n      });\n      if (groups.length > 0) {\n        r.setGroupCriteria(groups);\n      }\n    }\n    {\n      const sorts: ISortCriteria[] = [];\n      this.sort.forEach(({ column, asc }) => {\n        const col = children.find((d) => d.desc.label === column || (d as any).desc.column === column);\n        if (col) {\n          sorts.push({ col, asc });\n          return;\n        }\n        const desc = findDesc(column);\n        if (!desc) {\n          console.warn('invalid sort criteria column: ', column);\n          return;\n        }\n        const col2 = data.push(r, desc);\n        if (col2) {\n          sorts.push({ col: col2, asc });\n          return;\n        }\n        console.warn('invalid sort criteria column: ', column);\n      });\n      if (sorts.length > 0) {\n        r.setSortCriteria(sorts);\n      }\n    }\n    {\n      const sorts: ISortCriteria[] = [];\n      this.groupSort.forEach(({ column, asc }) => {\n        const col = children.find((d) => d.desc.label === column || (d as any).desc.column === column);\n        if (col) {\n          sorts.push({ col, asc });\n          return;\n        }\n        const desc = findDesc(column);\n        if (!desc) {\n          console.warn('invalid group sort criteria column: ', column);\n          return;\n        }\n        const col2 = data.push(r, desc);\n        if (col2) {\n          sorts.push({ col: col2, asc });\n          return;\n        }\n        console.warn('invalid group sort criteria column: ', column);\n      });\n      if (sorts.length > 0) {\n        r.setGroupSortCriteria(sorts);\n      }\n    }\n    return r;\n  }\n}\n\n/**\n * creates a new instance of a ranking builder\n * @returns {RankingBuilder}\n */\nexport function buildRanking() {\n  return new RankingBuilder();\n}\n","import type { ICategoricalColumnDesc, ICategory } from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\nimport { cleanCategories } from '../../provider/utils';\nimport { resolveValue } from '../../internal';\n\nexport default class CategoricalColumnBuilder extends ColumnBuilder<ICategoricalColumnDesc> {\n  constructor(column: string) {\n    super('categorical', column);\n  }\n\n  /**\n   * converts this type to an ordinal column type, such that categories are mapped to numbers\n   */\n  asOrdinal() {\n    this.desc.type = 'ordinal';\n    return this;\n  }\n\n  /**\n   * specify the categories of this categorical column\n   * @param {(string | Partial<ICategory>)[]} categories\n   */\n  categories(categories: (string | Partial<ICategory>)[]) {\n    this.desc.categories = categories;\n    return this;\n  }\n\n  /**\n   * converts this type to a set column, i.e. multiple unique category in a value\n   * @param {string} separator optional separator separating a string value\n   */\n  asSet(separator?: string) {\n    if (separator) {\n      (this.desc as any).separator = separator;\n    }\n    this.desc.type = 'set';\n    return this;\n  }\n\n  private derive(data: any[]) {\n    // derive categories\n    const categories = new Set<string>();\n    const isSet = this.desc.type === 'set';\n    const separator = (this.desc as any).separator || ';';\n    const val = (vi: any) => {\n      if (typeof vi === 'string' && vi !== '') {\n        return vi;\n      }\n      if (vi != null && typeof vi.value === 'string' && vi.value !== '') {\n        return vi.value;\n      }\n      return null;\n    };\n    const col = (this.desc as any).column;\n    data.forEach((d) => {\n      const v = resolveValue(d, col);\n      if (Array.isArray(v)) {\n        v.forEach((vi) => categories.add(val(vi)));\n      } else if (v != null && v !== '') {\n        const vs: string[] = isSet ? [v.toString()] : v.toString().split(separator);\n        vs.forEach((vi) => categories.add(val(vi)));\n      }\n    });\n    this.categories(cleanCategories(categories));\n  }\n\n  build(data: any[]): ICategoricalColumnDesc {\n    if (!this.desc.categories) {\n      this.derive(data);\n    }\n    return super.build(data);\n  }\n}\n\n/**\n * build a categorical column type\n * @param {string} column column which contains the associated data\n * @param {(string | Partial<ICategory>)[]} categories optional category definition\n * @returns {CategoricalColumnBuilder}\n */\nexport function buildCategoricalColumn(column: string, categories?: (string | Partial<ICategory>)[]) {\n  const r = new CategoricalColumnBuilder(column);\n  if (categories) {\n    r.categories(categories);\n  }\n  return r;\n}\n","import { min, max, resolveValue } from '../../internal';\nimport type { EAdvancedSortMethod, ESortMethod, INumberColumnDesc, ITypedDump } from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\nimport type { IScriptMappingFunctionType } from '../../model/MappingFunction';\n\nexport default class NumberColumnBuilder extends ColumnBuilder<INumberColumnDesc> {\n  constructor(column: string) {\n    super('number', column);\n  }\n\n  /**\n   * defines the mapping for this number column to normalize the data\n   * @param {\"linear\" | \"sqrt\" | \"pow1.1\" | \"pow2\" | \"pow3\"} type mapping type\n   * @param {[number | null, number | null]} domain input data domain [min, max]\n   * @param {[number , number]} range optional output domain [0, 1]\n   */\n  mapping(\n    type: 'linear' | 'sqrt' | 'pow1.1' | 'pow2' | 'pow3',\n    domain: [number | null, number | null],\n    range?: [number, number]\n  ) {\n    if (type === 'linear') {\n      this.desc.domain = domain;\n      if (range) {\n        this.desc.range = range;\n      }\n      return this;\n    }\n    this.desc.map = {\n      type,\n      domain,\n      range: range ?? [0, 1],\n    };\n    return this;\n  }\n\n  /**\n   * sets the column color in case of numerical columns\n   * @deprecated use colorMapping instead\n   */\n  color(color: string) {\n    return this.colorMapping(color);\n  }\n\n  colorMapping(type: string | ((v: number) => string) | ITypedDump) {\n    this.desc.colorMapping = type;\n    return this;\n  }\n\n  /**\n   * d3-format to use for formatting\n   * @param format d3-format\n   */\n  numberFormat(format: string) {\n    this.desc.numberFormat = format;\n    return this;\n  }\n\n  /**\n   * defines a script to normalize the data, see ScriptedMappingFunction for details\n   * @param {string} code the code to execute\n   * @param {[number , number]} domain the input data domain [min, max]\n   */\n  scripted(code: string | IScriptMappingFunctionType, domain: [number, number]) {\n    this.desc.map = { domain, code, type: 'script' };\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   * @param {string[] | number} labels labels to use for each array item or the expected length of an value\n   * @param {EAdvancedSortMethod} sort sorting criteria when sorting by this column\n   */\n  asArray(labels?: string[] | number, sort?: EAdvancedSortMethod) {\n    if (sort) {\n      (this.desc as any).sort = sort;\n    }\n    return super.asArray(labels);\n  }\n\n  /**\n   * @inheritDoc\n   * @param {EAdvancedSortMethod} sort sorting criteria when sorting by this column\n   */\n  asMap(sort?: EAdvancedSortMethod) {\n    if (sort) {\n      (this.desc as any).sort = sort;\n    }\n    return super.asMap();\n  }\n\n  /**\n   * converts type to a boxplot column type\n   * @param {ESortMethod} sort sorting criteria when sorting by this column\n   */\n  asBoxPlot(sort?: ESortMethod) {\n    if (sort) {\n      (this.desc as any).sort = sort;\n    }\n    this.desc.type = 'boxplot';\n    return this;\n  }\n\n  private derive(data: any[]): [number, number] {\n    const col = (this.desc as any).column;\n\n    const asArray = (v: any, extra: string) => {\n      const vs: number[] = [];\n      (Array.isArray(v) ? v : [v]).forEach((vi) => {\n        if (typeof vi === 'number' && !Number.isNaN(vi)) {\n          vs.push(vi);\n        }\n        if (vi != null && typeof vi.value === 'number' && !Number.isNaN(vi.value)) {\n          vs.push(vi.value);\n        }\n        if (vi != null && typeof vi[extra] === 'number' && !Number.isNaN(vi[extra])) {\n          vs.push(vi[extra]);\n        }\n      });\n      return vs;\n    };\n\n    const minValue = min(data, (d) => {\n      const v = resolveValue(d, col);\n      const vs: number[] = asArray(v, 'min');\n      return vs.length === 0 ? Number.POSITIVE_INFINITY : min(vs);\n    });\n    const maxValue = max(data, (d) => {\n      const v = resolveValue(d, col);\n      const vs: number[] = asArray(v, 'max');\n      return vs.length === 0 ? Number.NEGATIVE_INFINITY : max(vs);\n    });\n    return [minValue, maxValue];\n  }\n\n  build(data: any[]): INumberColumnDesc {\n    if (!this.desc.map && !this.desc.domain) {\n      // derive domain\n      this.mapping('linear', this.derive(data));\n    } else {\n      const d = this.desc.domain || this.desc.map!.domain;\n      if (Number.isNaN(d[0]) || d[0] == null || Number.isNaN(d[1]) || d[1] == null) {\n        const ext = this.derive(data);\n        if (Number.isNaN(d[0]) || d[0] == null) {\n          d[0] = ext[0];\n        }\n        if (Number.isNaN(d[1]) || d[1] == null) {\n          d[1] = ext[1];\n        }\n      }\n    }\n    return super.build(data);\n  }\n}\n\n/**\n * builds numerical column builder\n * @param {string} column column which contains the associated data\n * @param {[number | null, number | null]} domain domain (min, max) of this column\n * @returns {NumberColumnBuilder}\n */\nexport function buildNumberColumn(column: string, domain?: [number | null, number | null]) {\n  const r = new NumberColumnBuilder(column);\n  if (domain) {\n    r.mapping('linear', domain);\n  }\n  return r;\n}\n","import type { EAlignment, ILinkColumnDesc } from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\n\nexport default class StringColumnBuilder extends ColumnBuilder<ILinkColumnDesc> {\n  constructor(column: string) {\n    super('string', column);\n  }\n\n  /**\n   * makes the text editable within a cell and switches to the annotate type\n   */\n  editable() {\n    this.desc.type = 'annotate';\n    return this;\n  }\n\n  /**\n   * changes the alignment of the column\n   */\n  alignment(align: EAlignment) {\n    this.desc.alignment = align;\n    return this;\n  }\n\n  /**\n   * allow html text as values\n   */\n  html() {\n    this.desc.escape = false;\n    return this;\n  }\n\n  /**\n   * provide a pattern with which the value will be wrapped, use <code>${value}</code> for the current and and <code>${item}</code> for the whole item\n   * @param {string} pattern pattern to apply\n   * @param {string[]} templates optional templates for patterns to provide in the edit pattern dialog\n   */\n  pattern(pattern: string, templates?: string[]) {\n    this.desc.type = 'link';\n    this.desc.pattern = pattern;\n    if (templates) {\n      this.desc.patternTemplates = templates;\n    }\n    return this;\n  }\n}\n\n/**\n * builds a string column builder\n * @param {string} column column which contains the associated data\n * @returns {StringColumnBuilder}\n */\nexport function buildStringColumn(column: string) {\n  return new StringColumnBuilder(column);\n}\n","import type { IDateColumnDesc } from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\n\nexport default class DateColumnBuilder extends ColumnBuilder<IDateColumnDesc> {\n  constructor(column: string) {\n    super('date', column);\n  }\n\n  /**\n   * specify the format and parsing d3-time pattern to convert Date to strings and vise versa\n   * @param {string} format d3-time-format pattern\n   * @param {string} parse optional different parsing pattern\n   */\n  format(format: string, parse?: string) {\n    this.desc.dateFormat = format;\n    if (parse) {\n      this.desc.dateParse = parse;\n    }\n    return this;\n  }\n}\n\n/**\n * builds a date column builder\n * @param {string} column column which contains the associated data\n * @returns {DateColumnBuilder}\n */\nexport function buildDateColumn(column: string) {\n  return new DateColumnBuilder(column);\n}\n","import type { IHierarchyColumnDesc, IPartialCategoryNode } from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\n\nexport default class HierarchyColumnBuilder extends ColumnBuilder<IHierarchyColumnDesc> {\n  constructor(column: string) {\n    super('hierarchy', column);\n  }\n\n  /**\n   * specify the underlying hierarchy of this column\n   * @param {IPartialCategoryNode} hierarchy\n   * @param {string} hierarchySeparator specify the character to separate levels (default dot)\n   */\n  hierarchy(hierarchy: IPartialCategoryNode, hierarchySeparator?: string) {\n    this.desc.hierarchy = hierarchy;\n    if (hierarchySeparator) {\n      this.desc.hierarchySeparator = hierarchySeparator;\n    }\n    return this;\n  }\n\n  build(data: any[]): IHierarchyColumnDesc {\n    console.assert(Boolean(this.desc.hierarchy));\n    return super.build(data);\n  }\n}\n\n/**\n * build a hierarchical column builder\n * @param {string} column column which contains the associated data\n * @param {IPartialCategoryNode} hierarchy\n * @returns {HierarchyColumnBuilder}\n */\nexport function buildHierarchicalColumn(column: string, hierarchy?: IPartialCategoryNode) {\n  const r = new HierarchyColumnBuilder(column);\n  if (hierarchy) {\n    r.hierarchy(hierarchy);\n  }\n  return r;\n}\n","import type { IActionColumnDesc, IAction, IGroupAction } from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\n\nexport default class ActionsColumnBuilder extends ColumnBuilder<IActionColumnDesc> {\n  constructor() {\n    super('actions', '');\n  }\n\n  /**\n   * adds another action\n   * @param action the action\n   */\n  action(action: IAction) {\n    return this.actions([action]);\n  }\n\n  /**\n   * adds multiple actions\n   * @param actions list of actions\n   */\n  actions(actions: IAction[]) {\n    if (!this.desc.actions) {\n      this.desc.actions = [];\n    }\n    this.desc.actions!.push(...actions);\n    return this;\n  }\n\n  /**\n   * adds another action that is shown in group rows\n   * @param action the action\n   */\n  groupAction(action: IGroupAction) {\n    return this.groupActions([action]);\n  }\n\n  /**\n   * add multiple group actions that are shown in group rows\n   * @param actions list of actions\n   */\n  groupActions(actions: IGroupAction[]) {\n    if (!this.desc.groupActions) {\n      this.desc.groupActions = [];\n    }\n    this.desc.groupActions!.push(...actions);\n    return this;\n  }\n}\n\n/**\n * builds a actions column builder\n * @returns {ActionsColumnBuilder}\n */\nexport function buildActionsColumn() {\n  return new ActionsColumnBuilder();\n}\n","import type { IBooleanColumnDesc } from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\n\nexport default class BooleanColumnBuilder extends ColumnBuilder<IBooleanColumnDesc> {\n  constructor(column: string) {\n    super('boolean', column);\n  }\n\n  trueMarker(marker: string) {\n    this.desc.trueMarker = marker;\n    return this;\n  }\n\n  falseMarker(marker: string) {\n    this.desc.falseMarker = marker;\n    return this;\n  }\n}\n\n/**\n * builds a boolean column builder\n * @param {string} column column which contains the associated data\n * @returns {BooleanColumnBuilder}\n */\nexport function buildBooleanColumn(column: string) {\n  return new BooleanColumnBuilder(column);\n}\n","import type { IColumnDesc, IColumnConstructor } from '../model';\nimport {\n  DataProvider,\n  LocalDataProvider,\n  deriveColors,\n  deriveColumnDescriptions,\n  IDataProviderOptions,\n  ILocalDataProviderOptions,\n  IAggregationStrategy,\n} from '../provider';\nimport { LineUp, Taggle } from '../ui';\nimport ColumnBuilder from './column/ColumnBuilder';\nimport LineUpBuilder from './LineUpBuilder';\nimport { RankingBuilder } from './RankingBuilder';\n\nexport * from './column';\nexport * from './RankingBuilder';\n\n/**\n * builder for a LocalDataProvider along with LineUp configuration options\n */\nexport class DataBuilder extends LineUpBuilder {\n  private readonly columns: (IColumnDesc | ((data: any[]) => IColumnDesc))[] = [];\n  private readonly providerOptions: Partial<ILocalDataProviderOptions & IDataProviderOptions> = {\n    columnTypes: {},\n  };\n\n  private readonly rankBuilders: ((data: DataProvider) => void)[] = [];\n  private _deriveColors = false;\n\n  constructor(private readonly data: Record<string, unknown>[]) {\n    super();\n  }\n\n  /**\n   * use the schedulded task executor to asynchronously compute aggregations\n   */\n  scheduledTaskExecutor() {\n    this.providerOptions.taskExecutor = 'scheduled';\n    return this;\n  }\n\n  /**\n   * when using a top-n strategy how many items should be shown\n   */\n  showTopN(n: number) {\n    this.providerOptions.showTopN = n;\n    return this;\n  }\n\n  /**\n   * change the aggregation strategy that should be used when grouping by a column\n   */\n  aggregationStrategy(strategy: IAggregationStrategy) {\n    this.providerOptions.aggregationStrategy = strategy;\n    return this;\n  }\n\n  /**\n   * whether to propagate a collapse operation to its children\n   * @default true\n   */\n  propagateAggregationState(value: boolean) {\n    this.providerOptions.propagateAggregationState = value;\n    return this;\n  }\n\n  /**\n   * allow just a single selection\n   */\n  singleSelection() {\n    this.providerOptions.singleSelection = true;\n    return this;\n  }\n\n  /**\n   * allow multiple selections\n   */\n  multiSelection() {\n    this.providerOptions.singleSelection = false;\n    return this;\n  }\n\n  /**\n   * filter all rankings by all filters in LineUp\n   */\n  filterGlobally() {\n    this.providerOptions.filterGlobally = true;\n    return this;\n  }\n\n  /**\n   * triggers to derive the column descriptions for the given data\n   * @param {string} columns optional enforced order of columns\n   */\n  deriveColumns(...columns: (string | string[])[]) {\n    const cols = [].concat(...columns);\n    for (const c of deriveColumnDescriptions(this.data, { columns: cols })) {\n      this.columns.push(c);\n    }\n    return this;\n  }\n\n  /**\n   * tirggers to assign colors for the given descriptions\n   */\n  deriveColors() {\n    this._deriveColors = true;\n    return this;\n  }\n\n  /**\n   * register another column type to this data provider\n   * @param {string} type unique type id\n   * @param {IColumnConstructor} clazz column class\n   */\n  registerColumnType(type: string, clazz: IColumnConstructor) {\n    this.providerOptions.columnTypes![type] = clazz;\n    return this;\n  }\n\n  /**\n   * push another column description to this data provider\n   * @param {IColumnDesc | ColumnBuilder} column column description or builder instance\n   */\n  column(column: IColumnDesc | ColumnBuilder | ((data: any[]) => IColumnDesc)) {\n    this.columns.push(column instanceof ColumnBuilder ? column.build.bind(column) : column);\n    return this;\n  }\n\n  /**\n   * restores a given ranking dump\n   * @param dump dump as created using '.dump()'\n   */\n  restore(dump: any) {\n    this.rankBuilders.push((data) => data.restore(dump));\n    return this;\n  }\n\n  /**\n   * add the default ranking (all columns) to this data provider\n   * @param {boolean} addSupportTypes add support types, too, default: true\n   */\n  defaultRanking(addSupportTypes = true) {\n    this.rankBuilders.push((data) => data.deriveDefault(addSupportTypes));\n    return this;\n  }\n\n  /**\n   * add another ranking to this data provider\n   * @param {((data: DataProvider) => void) | RankingBuilder} builder ranking builder\n   */\n  ranking(builder: ((data: DataProvider) => void) | RankingBuilder) {\n    this.rankBuilders.push(builder instanceof RankingBuilder ? builder.build.bind(builder) : builder);\n    return this;\n  }\n\n  /**\n   * builds the data provider itself\n   * @returns {LocalDataProvider}\n   */\n  buildData() {\n    // last come survived separated by label to be able to override columns\n    const columns: IColumnDesc[] = [];\n    const contained = new Set<string>();\n    for (const col of this.columns) {\n      const c = typeof col === 'function' ? col(this.data) : col;\n      const key = `${c.type}@${c.label}`;\n      if (!contained.has(key)) {\n        columns.push(c);\n        contained.add(key);\n        continue;\n      }\n      const oldPos = columns.findIndex((d) => key === `${d.type}@${d.label}`);\n      columns.splice(oldPos, 1, c); // replace with new one\n    }\n    if (this._deriveColors) {\n      deriveColors(columns);\n    }\n    const r = new LocalDataProvider(this.data, columns, this.providerOptions);\n    if (this.rankBuilders.length === 0) {\n      this.defaultRanking();\n    }\n    this.rankBuilders.forEach((builder) => builder(r));\n    return r;\n  }\n\n  /**\n   * builds LineUp at the given parent DOM node\n   * @param {HTMLElement} node parent DOM node to attach\n   * @returns {LineUp}\n   */\n  build(node: HTMLElement) {\n    return new LineUp(node, this.buildData(), this.options);\n  }\n\n  /**\n   * builds Taggle at the given parent DOM node\n   * @param {HTMLElement} node parent DOM node to attach\n   * @returns {Taggle}\n   */\n  buildTaggle(node: HTMLElement) {\n    return new Taggle(node, this.buildData(), this.options);\n  }\n}\n\n/**\n * creates a new builder instance for the given data\n * @param {Record<string, unknown>[]} arr data to visualize\n * @returns {DataBuilder}\n */\nexport function builder(arr: Record<string, unknown>[]) {\n  return new DataBuilder(arr);\n}\n\n/**\n * build a new Taggle instance in the given node for the given data\n * @param {HTMLElement} node DOM node to attach to\n * @param {any[]} data data to visualize\n * @param {string[]} columns optional enforced column order\n * @returns {Taggle}\n */\nexport function asTaggle(node: HTMLElement, data: any[], ...columns: string[]): Taggle {\n  return builder(data).deriveColumns(columns).deriveColors().defaultRanking().buildTaggle(node);\n}\n\n/**\n * build a new LineUp instance in the given node for the given data\n * @param {HTMLElement} node DOM node to attach to\n * @param {any[]} data data to visualize\n * @param {string[]} columns optional enforced column order\n * @returns {LineUp}\n */\nexport function asLineUp(node: HTMLElement, data: any[], ...columns: string[]): LineUp {\n  return builder(data).deriveColumns(columns).deriveColors().defaultRanking().build(node);\n}\n","import { extent, resolveValue } from '../../internal';\nimport type {\n  IActionColumnDesc,\n  IArrayDesc,\n  IBooleanColumnDesc,\n  ICategoricalColumnDesc,\n  IColumnDesc,\n  IDateColumnDesc,\n  IHierarchyColumnDesc,\n  ILinkColumnDesc,\n  INumberColumnDesc,\n} from '../../model';\nimport type {\n  IBuilderAdapterActionsColumnDescProps,\n  IBuilderAdapterBooleanColumnDescProps,\n  IBuilderAdapterCategoricalColumnDescProps,\n  IBuilderAdapterColumnDescProps,\n  IBuilderAdapterDateColumnDescProps,\n  IBuilderAdapterHierarchyColumnDescProps,\n  IBuilderAdapterNumberColumnDescProps,\n  IBuilderAdapterStringColumnDescProps,\n} from './interfaces';\n\nexport function build<T extends IBuilderAdapterColumnDescProps>(props: T, _data?: any[]): IColumnDesc {\n  const { column } = props;\n  const desc = {\n    column,\n    type: props.type,\n    label: column ? column[0].toUpperCase() + column.slice(1) : props.type,\n  } as any;\n\n  (\n    [\n      'label',\n      'description',\n      'frozen',\n      'width',\n      'renderer',\n      'groupRenderer',\n      'summaryRenderer',\n      'visible',\n      'fixed',\n    ] as (keyof IBuilderAdapterColumnDescProps)[]\n  ).forEach((key) => {\n    if (props.hasOwnProperty(key)) {\n      desc[key] = props[key];\n    }\n  });\n\n  if (props.custom) {\n    // merge custom attributes\n    Object.assign(desc, props.custom);\n  }\n\n  if (props.asMap) {\n    console.assert(['categorical', 'date', 'number', 'string', 'link'].includes(desc.type!));\n    desc.type += 'Map';\n  }\n\n  if (props.asArray != null) {\n    console.assert(['boolean', 'categorical', 'date', 'number', 'string', 'link'].includes(desc.type!));\n    desc.type += 's';\n    const a = desc as IArrayDesc;\n    const labels = props.asArray;\n    if (Array.isArray(labels)) {\n      a.labels = labels;\n      a.dataLength = labels.length;\n    } else if (typeof labels === 'number') {\n      a.dataLength = labels;\n    }\n  }\n\n  return desc as any;\n}\n\nexport function buildCategorical(\n  props: IBuilderAdapterCategoricalColumnDescProps,\n  data: any[]\n): ICategoricalColumnDesc {\n  const desc: any = build({ ...props, type: 'categorical' });\n\n  if (props.asOrdinal) {\n    desc.type = 'ordinal';\n  }\n  if (props.missingCategory) {\n    desc.missingCategory = props.missingCategory;\n  }\n  if (props.asSet) {\n    if (typeof props.asSet === 'string') {\n      (desc as any).separator = props.asSet;\n    }\n    desc.type = 'set';\n  }\n\n  if (!props.categories) {\n    // derive categories\n    const categories = new Set(data.map((d) => resolveValue(d, (desc as any).column) as string));\n    desc.categories = Array.from(categories).sort();\n  } else {\n    desc.categories = props.categories;\n  }\n  return desc;\n}\n\nexport function buildDate(props: IBuilderAdapterDateColumnDescProps): IDateColumnDesc {\n  const desc: any = build({ ...props, type: 'date' });\n\n  (['dateFormat', 'dateParse'] as const).forEach((key) => {\n    if (props.hasOwnProperty(key)) {\n      desc[key] = props[key];\n    }\n  });\n  return desc;\n}\n\nexport function buildHierarchy(props: Partial<IBuilderAdapterHierarchyColumnDescProps>): IHierarchyColumnDesc {\n  const desc: any = build({ ...(props as any), type: 'hierarchy' });\n\n  (['hierarchy', 'hierarchySeparator'] as const).forEach((key) => {\n    if (props.hasOwnProperty(key)) {\n      desc[key] = props[key];\n    }\n  });\n  return desc;\n}\n\nexport function buildNumber(props: IBuilderAdapterNumberColumnDescProps, data: any[]): INumberColumnDesc {\n  const desc: any = build({ ...props, type: 'number' });\n\n  const domain = props.domain ? props.domain : extent(data, (d) => resolveValue(d, (desc as any).column) as number);\n\n  if (props.hasOwnProperty('color')) {\n    desc.colorMapping = props.color;\n  }\n  (['sort', 'colorMapping'] as const).forEach((key) => {\n    if (props.hasOwnProperty(key)) {\n      desc[key] = props[key];\n    }\n  });\n  if (props.scripted) {\n    desc.map = { domain, code: props.scripted, type: 'script' };\n  } else if (!props.mapping || props.mapping === 'linear') {\n    desc.domain = domain;\n    if (props.range) {\n      desc.range = props.range;\n    }\n  } else {\n    desc.map = {\n      type: props.mapping,\n      domain,\n      range: props.range || [0, 1],\n    };\n  }\n  return desc;\n}\n\nexport function buildString(props: IBuilderAdapterStringColumnDescProps): ILinkColumnDesc {\n  const desc: any = build({ ...props, type: 'string' });\n\n  (['pattern', 'patternTemplate', 'alignment'] as const).forEach((key) => {\n    if (props.hasOwnProperty(key)) {\n      desc[key] = props[key];\n    }\n  });\n  if (props.editable) {\n    desc.type = 'annotate';\n  }\n  if (props.pattern) {\n    desc.type = 'link';\n  }\n  if (props.html) {\n    desc.escape = false;\n  }\n  return desc;\n}\n\nexport function buildBoolean(props: IBuilderAdapterBooleanColumnDescProps): IBooleanColumnDesc {\n  const desc: any = build({ ...props, type: 'boolean' });\n\n  (['trueMarker', 'falseMarker'] as const).forEach((key) => {\n    if (props.hasOwnProperty(key)) {\n      desc[key] = props[key];\n    }\n  });\n  return desc;\n}\n\nexport function buildActions(props: IBuilderAdapterActionsColumnDescProps): IActionColumnDesc {\n  const desc: any = build({ ...props, type: 'actions' });\n\n  (['actions', 'groupActions'] as const).forEach((key) => {\n    if (props.hasOwnProperty(key)) {\n      desc[key] = props[key];\n    }\n  });\n  return desc;\n}\n","import type { Ranking } from '../../model';\nimport type { LocalDataProvider } from '../../provider';\nimport {\n  INestedBuilder,\n  IReduceBuilder,\n  IScriptedBuilder,\n  IWeightedSumBuilder,\n  buildRanking as buildRankingImpl,\n} from '../RankingBuilder';\nimport type {\n  IBuilderAdapterImposeColumnProps,\n  IBuilderAdapterNestedColumnProps,\n  IBuilderAdapterRankingProps,\n  IBuilderAdapterReduceColumnProps,\n  IBuilderAdapterScriptColumnProps,\n  IBuilderAdapterSupportColumnProps,\n  IBuilderAdapterWeightedSumColumnProps,\n} from './interfaces';\n\n/*\n * build the column description\n */\nexport function buildRanking(props: IBuilderAdapterRankingProps, data: LocalDataProvider): Ranking {\n  const r = buildRankingImpl();\n\n  if (props.sortBy) {\n    const s = Array.isArray(props.sortBy) ? props.sortBy : [props.sortBy];\n    s.forEach((si) => {\n      if (typeof si === 'string') {\n        r.sortBy(si);\n      } else {\n        r.sortBy(si.column, si.asc);\n      }\n    });\n  }\n  if (props.groupBy) {\n    const s = Array.isArray(props.groupBy) ? props.groupBy : [props.groupBy];\n    r.groupBy(...s);\n  }\n  if (props.columns) {\n    props.columns.forEach((c) => r.column(c));\n  }\n  return r.build(data);\n}\n\nexport function buildGeneric(props: { column: '*' | string }) {\n  return props.column;\n}\n\nexport function buildImposeRanking(props: IBuilderAdapterImposeColumnProps) {\n  return Object.assign(\n    {\n      type: 'impose',\n    },\n    props\n  );\n}\n\nexport function buildNestedRanking(props: IBuilderAdapterNestedColumnProps, children: string[]) {\n  const r: INestedBuilder = {\n    type: 'nested',\n    columns: children,\n  };\n  if (props.label) {\n    r.label = props.label;\n  }\n  return r;\n}\n\nexport function buildWeightedSumRanking(\n  props: IBuilderAdapterWeightedSumColumnProps,\n  children: { column: string; weight: number }[]\n) {\n  const r: IWeightedSumBuilder = {\n    type: 'weightedSum',\n    columns: children.map((d) => d.column),\n    weights: children.map((d) => d.weight),\n  };\n  if (props.label) {\n    r.label = props.label;\n  }\n  return r;\n}\n\nexport function buildReduceRanking(props: IBuilderAdapterReduceColumnProps, children: string[]) {\n  const r: IReduceBuilder = {\n    type: props.type,\n    columns: children,\n  };\n  if (props.label) {\n    r.label = props.label;\n  }\n  return r;\n}\n\nexport function buildScriptRanking(props: IBuilderAdapterScriptColumnProps, children: string[]) {\n  const r: IScriptedBuilder = {\n    type: 'script',\n    code: props.code,\n    columns: children,\n  };\n  if (props.label) {\n    r.label = props.label;\n  }\n  return r;\n}\n\nexport function buildSupportRanking(props: IBuilderAdapterSupportColumnProps) {\n  return `_${props.type}`;\n}\n\nexport function buildAllColumnsRanking() {\n  return '*';\n}\n","export { equal } from '../../internal';\n\nexport function isTypeInstance(clazz: any, superClass: any) {\n  let c = clazz;\n  while (c && c !== superClass) {\n    c = c.__proto__;\n  }\n  return c === superClass;\n}\n\nexport function pick<T extends Record<string, unknown>>(obj: T, keys: (keyof T)[]): Pick<T, keyof T> {\n  const r: Pick<T, keyof T> = {} as any;\n  keys.forEach((k) => {\n    if (obj.hasOwnProperty(k)) {\n      r[k] = obj[k];\n    }\n  });\n  return r;\n}\n\nexport function isSame<T extends Record<string, unknown>>(\n  current: T,\n  changed: (prop: keyof T) => boolean,\n  props: (keyof T)[]\n) {\n  if (props.every((p) => !changed(p))) {\n    return null;\n  }\n  return pick(current, props);\n}\n","import type { IBuilderAdapter, IBuilderAdapterProps, IBuilderAdapterRankingProps, IChangeDetecter } from './interfaces';\nimport type { IColumnDesc } from '../../model';\nimport {\n  deriveColors,\n  deriveColumnDescriptions,\n  IDataProviderOptions,\n  ILocalDataProviderOptions,\n  LocalDataProvider,\n} from '../../provider';\nimport { LineUp, Taggle } from '../../ui';\nimport { buildRanking } from './ranking';\nimport { equal, isSame, pick } from './utils';\n\nconst providerOptions: (keyof IDataProviderOptions | keyof ILocalDataProviderOptions)[] = [\n  'singleSelection',\n  'filterGlobally',\n  'columnTypes',\n  'taskExecutor',\n  'jumpToSearchResult',\n];\nconst lineupOptions: (keyof IBuilderAdapterProps)[] = [\n  'animated',\n  'sidePanel',\n  'sidePanelCollapsed',\n  'hierarchyIndicator',\n  'defaultSlopeGraphMode',\n  'summaryHeader',\n  'expandLineOnHover',\n  'overviewMode',\n  'renderers',\n  'canRender',\n  'toolbarActions',\n  'toolbarDialogAddons',\n  'rowHeight',\n  'rowPadding',\n  'groupHeight',\n  'groupPadding',\n  'dynamicHeight',\n  'labelRotation',\n  'ignoreUnsupportedBrowser',\n  'livePreviews',\n];\n\ninterface IRankingContext {\n  builders: IBuilderAdapterRankingProps[];\n  restore: any;\n  derive: boolean;\n  supportTypes: boolean;\n}\n\ninterface IColumnContext {\n  columns: IColumnDesc[];\n  deriveColumns: boolean;\n  deriveColumnNames: string[];\n  deriveColors: boolean;\n}\n\nexport class Adapter {\n  private data: LocalDataProvider | null = null;\n  private instance: LineUp | Taggle | null = null;\n\n  private prevRankings: IRankingContext | null = null;\n  private prevColumns: IColumnContext | null = null;\n  private prevHighlight: number | null = null;\n\n  private readonly onSelectionChanged = (indices: number[]) => {\n    if (this.props.onSelectionChanged && !equal(this.props.selection, indices)) {\n      this.props.onSelectionChanged(indices);\n    }\n  };\n\n  private readonly onHighlightChanged = (highlight: number) => {\n    const prev = this.prevHighlight != null ? this.prevHighlight : -1;\n    if (prev === highlight) {\n      return;\n    }\n    this.prevHighlight = highlight;\n    if (this.props.onHighlightChanged) {\n      this.props.onHighlightChanged(highlight);\n    }\n  };\n\n  constructor(private readonly adapter: IBuilderAdapter) {}\n\n  private get props() {\n    return this.adapter.props();\n  }\n\n  componentDidMount() {\n    this.data = this.buildProvider();\n    this.instance = this.adapter.createInstance(this.data, pick(this.props, lineupOptions));\n    this.instance.on(LineUp.EVENT_HIGHLIGHT_CHANGED, this.onHighlightChanged);\n  }\n\n  private resolveColumnDescs(data: any[]): IColumnContext {\n    const columns = this.adapter.columnDescs(data);\n    const deriveColumns = columns.length === 0 || Boolean(this.props.deriveColumns);\n    const deriveColumnNames = Array.isArray(this.props.deriveColumns) ? this.props.deriveColumns : [];\n    const deriveColors = Boolean(this.props.deriveColors);\n    return {\n      columns,\n      deriveColors,\n      deriveColumns,\n      deriveColumnNames,\n    };\n  }\n\n  private resolveRankings(): IRankingContext {\n    const builders = this.adapter.rankingBuilders();\n\n    return {\n      builders,\n      restore: this.props.restore,\n      derive: (builders.length === 0 && !this.props.restore) || Boolean(this.props.defaultRanking),\n      supportTypes: this.props.defaultRanking !== 'noSupportTypes',\n    };\n  }\n\n  private buildColumns(data: any[], ctx: IColumnContext) {\n    this.prevColumns = ctx;\n    const columns = ctx.columns.map((d) => Object.assign({}, d)); // work on copy\n    if (ctx.deriveColumns) {\n      const labels = new Set(columns.map((d) => `${d.type}@${d.label}`));\n      const derived = deriveColumnDescriptions(data, { columns: ctx.deriveColumnNames });\n      for (const derive of derived) {\n        if (labels.has(`${derive.type}@${derive.label}`)) {\n          // skip same name\n          continue;\n        }\n        columns.push(derive);\n      }\n    }\n    if (ctx.deriveColors) {\n      deriveColors(columns);\n    }\n    return columns;\n  }\n\n  private buildRankings(data: LocalDataProvider, rankings: IRankingContext) {\n    data.clearRankings();\n    this.prevRankings = rankings;\n    if (rankings.derive) {\n      data.deriveDefault(rankings.supportTypes);\n    }\n    if (rankings.restore) {\n      data.restore(rankings.restore);\n    }\n    rankings.builders.forEach((b) => buildRanking(b, data!));\n  }\n\n  private buildProvider() {\n    const columns = this.buildColumns(this.props.data, this.resolveColumnDescs(this.props.data));\n    const data = new LocalDataProvider(this.props.data, columns, pick(this.props, providerOptions));\n\n    this.buildRankings(data, this.resolveRankings());\n\n    data.setSelection(this.props.selection || []);\n    data.on(LocalDataProvider.EVENT_SELECTION_CHANGED, this.onSelectionChanged);\n\n    return data;\n  }\n\n  private updateLineUp(changeDetector: IChangeDetecter, providerChanged: boolean) {\n    // check lineup instance properties\n    const changedLineUpOptions = isSame(this.props, changeDetector, lineupOptions);\n    if (!changedLineUpOptions) {\n      if (providerChanged) {\n        this.instance!.setDataProvider(this.data!);\n      }\n\n      if (providerChanged || (this.props.highlight != null && this.prevHighlight !== this.props.highlight)) {\n        this.prevHighlight = this.props.highlight == null ? -1 : this.props.highlight;\n        this.instance!.on(LineUp.EVENT_HIGHLIGHT_CHANGED, null);\n        this.instance!.setHighlight(this.prevHighlight);\n        this.instance!.on(LineUp.EVENT_HIGHLIGHT_CHANGED, this.onHighlightChanged);\n        return true;\n      }\n      return false;\n    }\n    // recreate lineup\n    if (this.instance) {\n      this.instance.destroy();\n    }\n    this.instance = this.adapter.createInstance(this.data!, changedLineUpOptions);\n\n    this.prevHighlight = this.props.highlight == null ? -1 : this.props.highlight;\n    this.instance!.setHighlight(this.prevHighlight);\n    this.instance!.on(LineUp.EVENT_HIGHLIGHT_CHANGED, this.onHighlightChanged);\n    return true;\n  }\n\n  private updateProvider(changeDetector: IChangeDetecter) {\n    const changedProviderOptions = isSame(this.props, changeDetector, providerOptions);\n    if (changedProviderOptions || !this.data || changeDetector('data')) {\n      // big change start from scratch\n      this.data = this.buildProvider();\n      return true;\n    }\n\n    const rankings = this.resolveRankings();\n    const columns = this.resolveColumnDescs(this.props.data);\n    const columnsChanged = !equal(this.prevColumns, columns);\n    if (columnsChanged) {\n      const descs = this.buildColumns(this.props.data, columns);\n      this.data.clearColumns();\n      descs.forEach((d) => this.data!.pushDesc(d));\n    }\n\n    if (columnsChanged || !equal(rankings, this.prevRankings)) {\n      this.buildRankings(this.data, rankings);\n    }\n\n    this.data.on(LocalDataProvider.EVENT_SELECTION_CHANGED, null);\n    this.data.setSelection(this.props.selection || []);\n    this.data.on(LocalDataProvider.EVENT_SELECTION_CHANGED, this.onSelectionChanged);\n    return false;\n  }\n\n  componentDidUpdate(changeDetector: IChangeDetecter) {\n    const providerChanged = this.updateProvider(changeDetector);\n    this.updateLineUp(changeDetector, providerChanged);\n    // this.instance!.update();\n  }\n\n  componentWillUnmount() {\n    if (this.instance) {\n      this.instance.destroy();\n      this.instance = null;\n    }\n    this.data = null;\n  }\n}\n","import type Column from './Column';\nimport ValueColumn from './ValueColumn';\nimport type { IValueColumnDesc } from './interfaces';\n\nexport * from './annotations';\nexport { isMissingValue, isUnknown, FIRST_IS_NAN, FIRST_IS_MISSING, missingGroup } from './missing';\nexport * from './interfaces';\nexport * from './ICategoricalColumn';\nexport * from './INumberColumn';\nexport * from './IDateColumn';\nexport * from './IArrayColumn';\n\nexport { toCategories } from './internalCategorical';\n\nexport { ScaleMappingFunction, ScriptMappingFunction, mappingFunctions } from './MappingFunction';\nexport { DEFAULT_CATEGORICAL_COLOR_FUNCTION, ReplacementColorMappingFunction } from './CategoricalColorMappingFunction';\nexport {\n  CustomColorMappingFunction,\n  DEFAULT_COLOR_FUNCTION,\n  SequentialColorFunction,\n  DivergentColorFunction,\n  UnknownColorFunction,\n  QuantizedColorFunction,\n  SolidColorFunction,\n} from './ColorMappingFunction';\n\nexport { default as ActionColumn } from './ActionColumn';\nexport * from './ActionColumn';\nexport { default as AggregateGroupColumn } from './AggregateGroupColumn';\nexport * from './AggregateGroupColumn';\nexport { default as AnnotateColumn } from './AnnotateColumn';\nexport * from './AnnotateColumn';\nexport { default as ArrayColumn } from './ArrayColumn';\nexport * from './ArrayColumn';\nexport { default as BooleanColumn } from './BooleanColumn';\nexport * from './BooleanColumn';\nexport { default as BooleansColumn } from './BooleansColumn';\nexport * from './BooleansColumn';\nexport { default as BoxPlotColumn } from './BoxPlotColumn';\nexport * from './BoxPlotColumn';\nexport { default as CategoricalColumn } from './CategoricalColumn';\nexport * from './CategoricalColumn';\nexport { default as CategoricalMapColumn } from './CategoricalMapColumn';\nexport * from './CategoricalMapColumn';\nexport { default as CategoricalsColumn } from './CategoricalsColumn';\nexport * from './CategoricalsColumn';\nexport { default, default as Column, DEFAULT_COLOR } from './Column';\n// no * export\nexport { default as CompositeColumn } from './CompositeColumn';\n// no * export\nexport { default as CompositeNumberColumn } from './CompositeNumberColumn';\nexport * from './CompositeNumberColumn';\nexport { default as DateColumn } from './DateColumn';\nexport * from './DateColumn';\nexport { default as DatesColumn } from './DatesColumn';\nexport * from './DatesColumn';\nexport { default as DatesMapColumn } from './DatesMapColumn';\nexport * from './DatesMapColumn';\nexport { default as GroupColumn } from './GroupColumn';\nexport * from './GroupColumn';\nexport { default as HierarchyColumn } from './HierarchyColumn';\nexport * from './HierarchyColumn';\nexport { default as ImpositionBoxPlotColumn } from './ImpositionBoxPlotColumn';\nexport * from './ImpositionBoxPlotColumn';\nexport { default as ImpositionCompositeColumn } from './ImpositionCompositeColumn';\nexport * from './ImpositionCompositeColumn';\nexport { default as ImpositionCompositesColumn } from './ImpositionCompositesColumn';\nexport * from './ImpositionCompositesColumn';\nexport { default as LinkColumn } from './LinkColumn';\nexport * from './LinkColumn';\nexport { default as LinkMapColumn } from './LinkMapColumn';\nexport * from './LinkMapColumn';\nexport { default as LinksColumn } from './LinksColumn';\nexport * from './LinksColumn';\nexport { default as MapColumn } from './MapColumn';\nexport * from './MapColumn';\nexport { default as MultiLevelCompositeColumn } from './MultiLevelCompositeColumn';\nexport * from './MultiLevelCompositeColumn';\nexport { default as NestedColumn } from './NestedColumn';\nexport * from './NestedColumn';\nexport { default as NumberColumn } from './NumberColumn';\nexport * from './NumberColumn';\nexport { default as NumberMapColumn } from './NumberMapColumn';\nexport * from './NumberMapColumn';\nexport { default as NumbersColumn } from './NumbersColumn';\nexport * from './NumbersColumn';\nexport { default as OrdinalColumn } from './OrdinalColumn';\nexport * from './OrdinalColumn';\nexport { default as RankColumn } from './RankColumn';\nexport * from './RankColumn';\nexport { default as Ranking, EDirtyReason } from './Ranking';\n// no * export\nexport { default as ReduceColumn } from './ReduceColumn';\nexport * from './ReduceColumn';\nexport { default as ScriptColumn } from './ScriptColumn';\nexport * from './ScriptColumn';\nexport { default as SelectionColumn } from './SelectionColumn';\nexport * from './SelectionColumn';\nexport { default as SetColumn } from './SetColumn';\nexport * from './SetColumn';\nexport { default as StackColumn } from './StackColumn';\nexport * from './StackColumn';\nexport { default as StringColumn } from './StringColumn';\nexport * from './StringColumn';\nexport { default as StringsColumn } from './StringsColumn';\nexport * from './StringsColumn';\nexport { default as StringMapColumn } from './StringMapColumn';\nexport * from './StringMapColumn';\nexport { default as ValueColumn } from './ValueColumn';\n// no * export\n\n/**\n * defines a new column type\n * @param name\n * @param functions\n * @returns {CustomColumn}\n */\nexport function defineColumn<T>(name: string, functions: any = {}): typeof Column {\n  class CustomColumn extends ValueColumn<T> {\n    constructor(id: string, desc: IValueColumnDesc<T>, ...args: any[]) {\n      super(id, desc);\n      if (typeof this.init === 'function') {\n        this.init(id, desc, ...args);\n      }\n    }\n\n    init(..._args: any[]) {\n      // dummy\n    }\n  }\n\n  CustomColumn.prototype.toString = () => name;\n  CustomColumn.prototype = Object.assign(CustomColumn.prototype, functions);\n\n  return CustomColumn;\n}\n","import Column, { IColumnDesc, IDataRow, Ranking, defaultGroup, IndicesArray, IOrderedGroup } from '../model';\nimport ACommonDataProvider from './ACommonDataProvider';\nimport type { IDataProviderOptions } from './interfaces';\nimport { DirectRenderTasks } from './DirectRenderTasks';\nimport type { IRenderTasks } from '../renderer';\n\n/**\n * interface what the server side has to provide\n */\nexport interface IServerData {\n  /**\n   * sort the dataset by the given description\n   * @param ranking\n   */\n  sort(ranking: Ranking): Promise<IndicesArray>;\n\n  /**\n   * returns a slice of the data array identified by a list of indices\n   * @param indices\n   */\n  view(indices: number[]): Promise<any[]>;\n\n  /**\n   * returns a sample of the values for a given column\n   * @param column\n   */\n  mappingSample(column: any): Promise<number[]>;\n\n  /**\n   * return the matching indices matching the given arguments\n   * @param search\n   * @param column\n   */\n  search(search: string | RegExp, column: any): Promise<number[]>;\n}\n\nexport interface IRemoteDataProviderOptions {\n  /**\n   * maximal cache size (unused at the moment)\n   */\n  maxCacheSize: number;\n}\n\nfunction createIndex2Pos(order: IndicesArray) {\n  const index2pos: number[] = [];\n  for (let i = 0; i < order.length; ++i) {\n    index2pos[order[i]] = i + 1;\n  }\n  return index2pos;\n}\n\n/**\n * a remote implementation of the data provider\n */\nexport default class RemoteDataProvider extends ACommonDataProvider {\n  private readonly ooptions: IRemoteDataProviderOptions = {\n    maxCacheSize: 1000,\n  };\n\n  private readonly cache = new Map<number, Promise<IDataRow>>();\n\n  constructor(\n    private server: IServerData,\n    columns: IColumnDesc[] = [],\n    options: Partial<IRemoteDataProviderOptions & IDataProviderOptions> = {}\n  ) {\n    super(columns, options);\n    Object.assign(this.ooptions, options);\n  }\n\n  getTotalNumberOfRows() {\n    // TODO not correct\n    return this.cache.size;\n  }\n\n  getTaskExecutor(): IRenderTasks {\n    // FIXME\n    return new DirectRenderTasks();\n  }\n\n  sort(\n    ranking: Ranking\n  ):\n    | Promise<{ groups: IOrderedGroup[]; index2pos: IndicesArray }>\n    | { groups: IOrderedGroup[]; index2pos: IndicesArray } {\n    //use the server side to sort\n    return this.server\n      .sort(ranking)\n      .then((order) => ({ groups: [Object.assign({ order }, defaultGroup)], index2pos: createIndex2Pos(order) }));\n  }\n\n  private loadFromServer(indices: number[]) {\n    return this.server.view(indices).then((view) => {\n      //enhance with the data index\n      return view.map((v, i) => {\n        const dataIndex = indices[i];\n        return { v, dataIndex };\n      });\n    });\n  }\n\n  view(indices: number[]): Promise<any[]> {\n    if (indices.length === 0) {\n      return Promise.resolve([]);\n    }\n    const base = this.fetch([indices])[0];\n    return Promise.all(base).then((rows) => rows.map((d) => d.v));\n  }\n\n  private computeMissing(orders: number[][]): number[] {\n    const union = new Set<number>();\n    const unionAdd = union.add.bind(union);\n    orders.forEach((order) => order.forEach(unionAdd));\n\n    // removed cached\n    this.cache.forEach((_v, k) => union.delete(k));\n\n    if (this.cache.size + union.size > this.ooptions.maxCacheSize) {\n      // clean up cache\n    }\n    // const maxLength = Math.max(...orders.map((o) => o.length));\n    return Array.from(union);\n  }\n\n  private loadInCache(missing: number[]) {\n    if (missing.length === 0) {\n      return;\n    }\n    // load data and map to rows;\n    const v = this.loadFromServer(missing);\n    missing.forEach((_m, i) => {\n      const dataIndex = missing[i];\n      this.cache.set(\n        dataIndex,\n        v.then((loaded) => ({ v: loaded[i], i: dataIndex }))\n      );\n    });\n  }\n\n  fetch(orders: number[][]): Promise<IDataRow>[][] {\n    const toLoad = this.computeMissing(orders);\n    this.loadInCache(toLoad);\n\n    return orders.map((order) => order.map((i) => this.cache.get(i)!));\n  }\n\n  getRow(index: number) {\n    if (this.cache.has(index)) {\n      return this.cache.get(index)!;\n    }\n    this.loadInCache([index]);\n    return this.cache.get(index)!;\n  }\n\n  mappingSample(col: Column): Promise<number[]> {\n    return this.server.mappingSample((col as any).desc.column);\n  }\n\n  searchAndJump(search: string | RegExp, col: Column) {\n    this.server.search(search, (col as any).desc.column).then((indices) => {\n      this.jumpToNearest(indices);\n    });\n  }\n}\n","/**\n * main module of LineUp.js containing the main class and exposes all other modules\n */\n\nimport type { IColumnDesc } from './model';\nimport { DataProvider, LocalDataProvider, ILocalDataProviderOptions } from './provider';\nimport { LineUp, Taggle } from './ui';\nimport type { ILineUpOptions, ITaggleOptions } from './config';\n\nexport * from './builder';\nexport * from './config';\nexport * from './internal/mathInterfaces';\nexport * from './model';\nexport * from './provider';\nexport * from './renderer';\nexport * from './ui';\nexport { LineUp as default } from './ui';\n\nexport function createLocalDataProvider(\n  data: any[],\n  columns: IColumnDesc[],\n  options: Partial<ILocalDataProviderOptions> = {}\n) {\n  return new LocalDataProvider(data, columns, options);\n}\n\n/**\n *\n * @param container the html element lineup should be built in\n * @param data {DataProvider} the data provider\n * @param config {Partial<ILineUpOptions>} lineup configuration overrides\n * @returns {LineUp} the created lineup instance\n */\nexport function createLineUp(container: HTMLElement, data: DataProvider, config: Partial<ILineUpOptions> = {}) {\n  return new LineUp(container, data, config);\n}\n\nexport function createTaggle(container: HTMLElement, data: DataProvider, config: Partial<ITaggleOptions> = {}) {\n  return new Taggle(container, data, config);\n}\n","// eslint-disable-next-line import/no-webpack-loader-syntax\nimport '!file-loader?name=schema.4.0.0.json!./provider/schema.json';\nimport './style.scss';\nexport * from './';\nexport { default } from './';\n\ndeclare const __VERSION__: string;\ndeclare const __BUILD_ID__: string;\ndeclare const __LICENSE__: string;\n\n/**\n * LineUp version\n * @type {string}\n */\nexport const version = __VERSION__;\n/**\n * LineUp unique build id\n * @type {string}\n */\nexport const buildId = __BUILD_ID__;\n/**\n * LineUp license type\n * @type {string}\n */\nexport const license = __LICENSE__;\n"],"names":["root","factory","exports","module","define","amd","globalThis","equal","a","b","constructor","length","i","keys","Array","isArray","RegExp","source","flags","valueOf","Object","prototype","toString","hasOwnProperty","call","key","uid","HASH_UNDEFINED","reIsDeepProp","reIsPlainProp","reLeadingDot","rePropName","reEscapeChar","reIsHostCtor","freeGlobal","global","freeSelf","self","Function","arrayProto","funcProto","objectProto","coreJsData","maskSrcKey","exec","IE_PROTO","funcToString","objectToString","reIsNative","replace","Symbol","splice","Map","getNative","nativeCreate","symbolProto","undefined","symbolToString","Hash","entries","index","this","clear","entry","set","ListCache","MapCache","assocIndexOf","array","value","other","getMapData","map","type","data","__data__","object","getValue","isObject","pattern","tag","isFunction","result","e","isHostObject","test","func","toSource","baseIsNative","has","get","pop","push","stringToPath","memoize","string","isSymbol","baseToString","match","number","quote","toKey","resolver","TypeError","memoized","args","arguments","apply","cache","Cache","isObjectLike","path","defaultValue","isKey","baseGet","Reflect","exporter","makeExporter","target","previous","defineProperty","configurable","writable","hasOwn","supportsSymbol","toPrimitiveSymbol","toPrimitive","iteratorSymbol","iterator","supportsCreate","create","supportsProto","__proto__","downLevel","HashMap","MakeDictionary","functionPrototype","getPrototypeOf","usePolyfill","process","env","_Map","cacheSentinel","arraySentinel","MapIterator","values","selector","_index","_keys","_values","_selector","next","done","throw","error","return","_cacheKey","_cacheIndex","enumerable","_find","delete","size","getKey","getEntry","insert","indexOf","_","CreateMapPolyfill","_Set","Set","_map","add","Metadata","WeakMap","rootKey","CreateUniqueKey","_key","table","GetOrCreateWeakMapTable","CreateUUID","FillRandomBytes","buffer","Math","random","Uint8Array","crypto","getRandomValues","msCrypto","offset","byte","toLowerCase","CreateWeakMapPolyfill","GetOrCreateMetadataMap","O","P","Create","targetMetadata","IsUndefined","metadataMap","OrdinaryHasMetadata","MetadataKey","OrdinaryHasOwnMetadata","parent","OrdinaryGetPrototypeOf","IsNull","OrdinaryGetMetadata","OrdinaryGetOwnMetadata","OrdinaryDefineOwnMetadata","MetadataValue","OrdinaryMetadataKeys","ownKeys","OrdinaryOwnMetadataKeys","parentKeys","_i","ownKeys_1","_a","parentKeys_1","obj","method","GetMethod","IsCallable","IsObject","GetIterator","k","IteratorStep","nextValue","IteratorClose","Type","x","ToPrimitive","input","PreferredType","hint","exoticToPrim","toString_1","toString_2","OrdinaryToPrimitive","ToPropertyKey","argument","ToString","IsArray","IsConstructor","V","f","proto","prototypeProto","__","decorators","propertyKey","attributes","decorated","decorator","DecorateConstructor","descriptor","DecorateProperty","metadataKey","metadataValue","IsPropertyKey","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","definition","o","prop","r","toStringTag","isSeqEmpty","seq","every","isIndicesAble","it","Uint16Array","Uint32Array","Float32Array","Int8Array","Int16Array","Int32Array","Float64Array","filters","_length","l","forEach","filter","callback","LazyFilter","concat","LazyMap1","outer","valid","v","some","reduce","initial","acc","j","mapV","map12","LazyMap2","ALazyMap","map23","LazyMap3","map34","iterable","_arr","from","arr","lazySeq","LazySeq","seqs","shift","s","MAX_WORKER_THREADS","max","navigator","hardwareConcurrency","blob","workers","cleanUpWorkerTimer","workerTaskCounter","cleanUpWorker","toFree","findIndex","tasks","worker","terminate","finishedTask","w","Worker","refs","checkOutWorker","clearTimeout","emptyWorker","find","setTimeout","pushStats","refData","refIndices","indices","Promise","resolve","receiver","msg","removeEventListener","stats","addEventListener","assign","postMessage","transferAbles","toResult","setRef","ref","broadCast","deleteRef","startsWith","deleteRefs","getNumberOfBins","ceil","log","LN2","min","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","extent","empty","fill","quantile","NaN","floor","median","slice","sort","pushAll","vs","GAUSSIAN_CONST","sqrt","PI","boxplotBuilder","fixedLength","kdePoints","sum","missing","kdePointCount","isNaN","pushAndSave","invalid","mean","count","whiskerHigh","whiskerLow","outlier","q1","q3","buildImpl","iqr","left","right","variance","len","computeVariance","reversedOutliers","reverse","points","bandwidth","toSampleVariance","pow","nrd","computePoint","u","exp","step","p","computeKDE","build","buildArr","numberStatsBuilder","domain","numberOfBins","hist","x0","binWidth","x1","bin1","binN","low","high","center","toBin","maxBin","computeGranularity","histGranularity","getFullYear","minYear","maxYear","Date","getTime","getMonth","getDate","setDate","setMonth","pushDateHist","dateStatsBuilder","template","byDay","templateHist","h","categoricalStatsBuilder","categories","m","cat","name","stringStatsBuilder","topN","t","byFrequency","localeCompare","unique","round","precision","scale","similar","delta","abs","isPromiseLike","then","createIndexArray","dataSize","toIndexArray","maxDataIndex","joinIndexArrays","groups","total","createLike","g","asc","desc","sortComplex","comparators","lookup","dateValueCache2Value","categoricalValueCache2Value","sortWorkerMain","workerSelf","resolveRefs","msgHandlers","sortOrders","order","dateStats","ii","categoricalStats","cats","numberStats","boxplotStats","stringStats","evt","createWorkerBlob","sources","lastIndexOf","join","Blob","URL","createObjectURL","equalArrays","ai","fixCSS","id","node","lastChild","removeChild","arrs","getSortLabel","String","noop","dispatch","Error","Dispatch","parseTypenames","typenames","types","trim","split","c","on","typename","T","copy","that","suffix","prefix","events","createEventList","listenerEvents","listeners","forwarder","fireImpl","primaryType","origin","listener","listenersChanged","Boolean","_type","_active","fire","context","forward","unforward","supportType","for","category","SupportType","metadata","SortByDefault","isSortingAscByDefault","col","clazz","hasMetadata","label","featureLevel","categorical","date","composite","support","Categories","Category","getSortType","categoryOf","toolbar","dialogAddons","isSupportType","getMetadata","categoryOfDesc","models","ECompareValueType","defaultGroup","color","othersGroup","isGroup","item","group","isMultiLevelColumn","getCollapsed","DEFAULT_COLOR","width","renderer","groupRenderer","summaryRenderer","visible","summary","description","fixed","frozen","assignNewId","idGenerator","fqid","fqpath","Column","EVENT_WIDTH_CHANGED","EVENT_LABEL_CHANGED","EVENT_METADATA_CHANGED","EVENT_VISIBILITY_CHANGED","EVENT_SUMMARY_RENDERER_TYPE_CHANGED","EVENT_RENDERER_TYPE_CHANGED","EVENT_GROUP_RENDERER_TYPE_CHANGED","EVENT_DIRTY","EVENT_DIRTY_HEADER","EVENT_DIRTY_VALUES","EVENT_DIRTY_CACHES","getWidth","hide","setVisible","show","isVisible","getVisible","flatten","_levelsToGo","_padding","setWidth","setWidthImpl","setMetaData","bak","getMetaData","sortByMe","ascending","priority","findMyRanker","sortBy","groupByMe","toggleGrouping","isGroupedBy","getGroupCriteria","toggleMySorting","toggleSorting","isSortedByMeImpl","ranker","criterias","isSortedByMe","getSortCriteria","groupSortByMe","groupSortBy","toggleMyGroupSorting","toggleGroupSorting","isGroupSortedByMe","getGroupSortCriteria","removeMe","remove","attach","detach","insertAfterMe","insertAfter","insertBeforeMe","insertBefore","nextSibling","at","previousSibling","dump","toDescRef","getRenderer","getGroupRenderer","getSummaryRenderer","restore","_factory","rendererType","getLabel","row","_row","getExportValue","format","getColor","toCompareValue","_valueCache","toCompareValueType","UINT8","toCompareGroupValue","_rows","toCompareGroupValueType","STRING","isFiltered","clearFilter","setRenderer","setGroupRenderer","setSummaryRenderer","markDirty","FLAT_ALL_COLUMNS","accessor","loaded","lazyLoaded","onDataUpdate","ValueColumn","EVENT_DATA_LOADED","isLoaded","getRaw","setLoaded","RENDERER_LOADING","isMapAbleColumn","getMapping","isNumberColumn","getNumber","ESortMethod","EAdvancedSortMethod","isBoxPlotColumn","getBoxPlotData","isNumbersColumn","getNumbers","_children","CompositeColumn","EVENT_FILTER_CHANGED","EVENT_ADD_COLUMN","EVENT_MOVE_COLUMN","EVENT_REMOVE_COLUMN","levelsToGo","padding","children","child","canJustAddNumbers","insertImpl","move","old","moveImpl","oldIndex","moveAfter","moveBefore","removeImpl","specifier","colors","list","addAll","console","assert","deleteAll","act","callbackfn","thisArg","integrateDefaults","defaults","typed","patternFunction","joinGroups","parents","gparents","unshift","subGroups","duplicateGroup","clone","isGroupParent","toGroupID","groupRoots","roots","MAX_COLORS","colorPool","mapIndices","everyIndices","forEachIndices","chooseUIntByDataLength","dataLength","UINT32","UINT16","styles","getStyle","SELECTED_COLOR","COLUMN_PADDING","parseInt","FILTERED_OPACITY","parseFloat","DASH","height","UPSET","inactive","DOT","opacity","opacitySingle","TICK","BOX_PLOT","box","stroke","AGGREGATE","strokeWidth","levelOffset","levelWidth","SLOPEGRAPH_WIDTH","CSS_PREFIX","RESIZE_SPACE","RESIZE_ANIMATION_DURATION","AGGREGATION_LEVEL_WIDTH","engineCssClass","aria","text","EAggregationState","createAggregateDesc","AggregateGroupColumn","EVENT_AGGREGATE","isAggregated","ranking","setAggregated","EXPAND","COLLAPSE","DEFAULT_CATEGORICAL_COLOR_FUNCTION","toJSON","eq","ReplacementColorMappingFunction","restoreCategoricalColorMapping","isMissingValue","isUnknown","FIRST_IS_MISSING","missingGroup","toCategory","nextColor","compareCategory","aNull","bNull","toCategories","isEmptyFilter","filterMissing","isEqualCategoricalFilter","al","arrayEquals","isCategoryIncluded","filterObj","includes","currentFilter","categoryOrder","colorMapping","CategoricalColumn","rows","sValue","categoryNames","sortCategories","EVENT_COLOR_MAPPING_CHANGED","getCategory","getCategories","getValues","getLabels","getMap","getMapLabel","getSet","iterCategory","categoricalColorMappingFunction","getColorMapping","setColorMapping","mapping","valueCache","getFilter","setFilter","was","FLOAT_ASC","_group","mostFrequent","topCat","topCount","findMostFrequent","toGroupCompareCategoryValue","FLOAT","current","separator","SetColumn","getSortedSet","normalize","sv","getColors","mode","cardinality","EDirtyReason","sortCriteria","groupColumns","groupSortCriteria","columns","dirtyOrder","reason","Ranking","EVENT_DIRTY_ORDER","dirtyOrderSortDirty","SORT_CRITERIA_DIRTY","dirtyOrderGroupDirty","GROUP_CRITERIA_DIRTY","dirtyOrderGroupSortDirty","GROUP_SORT_CRITERIA_DIRTY","dirtyOrderFiltering","FILTER_CHANGED","index2pos","EVENT_GROUPS_CHANGED","EVENT_GROUP_CRITERIA_CHANGED","EVENT_GROUP_SORT_CRITERIA_CHANGED","EVENT_COLUMN_VISIBILITY_CHANGED","EVENT_SORT_CRITERIA_CHANGED","EVENT_ORDER_CHANGED","setLabel","setGroups","dirtyReason","oldGroups","unifyGroups","offsets","subarray","subs","gi","getRank","dataIndex","getOrder","getOrderLength","getGroups","getFlatGroups","traverse","sortColumn","help","setGroupCriteria","restoreSortCriteria","dumped","setSortCriteria","setGroupSortCriteria","getPrimarySortCriteria","toggleSortingLogic","newSort","defaultAsc","newGroupings","hierarchyLogic","groupBy","equalCriteria","COLUMN_SORT_DIRTY","triggerResort","column","cols","groupColumn","COLUMN_GROUP_DIRTY","autoAdaptAggregationColumn","targetWidth","COLUMN_GROUP_SORT_DIRTY","triggerGroupResort","sortCriterias","bakMulti","FORWARD_COLUMN_EVENTS","oldValue","newValue","reference","findByPath","isSortCriteria","sortCriteriaChanged","isGroupSortCriteria","groupSortCriteriaChanged","newGrouping","isGroupColumn","removed","idOrFilter","flatColumns","clearFilters","bi","debounce","timeToDelay","choose","tm","ctx","createRankDesc","RankColumn","createSelectionDesc","SelectionColumn","EVENT_SELECT","setValue","setImpl","setValues","setterAll","setter","toggleValue","BINARY","isSelected","SELECTED_GROUP","NOT_SELECTED_GROUP","aL","bL","createActionDesc","actions","groupActions","compare","ActionColumn","EAlignment","EStringGroupCriteriaType","currentGroupCriteria","alignment","escape","StringColumn","EVENT_GROUPING_CHANGED","groupCriteria","regex","FILTER_MISSING","ff","groupValue","annotations","AnnotateColumn","EVENT_VALUE_CHANGED","trueMarker","GROUP_TRUE","falseMarker","GROUP_FALSE","BooleanColumn","getCategoryOfBoolean","_dataLength","originalLabels","labels","_d","ArrayColumn","BooleansColumn","formatDecimalParts","toExponential","coefficient","prefixExponent","re","formatSpecifier","FormatSpecifier","align","sign","symbol","zero","comma","exponent","toFixed","toLocaleString","toPrecision","formatRounded","toUpperCase","formatPrefix","prefixes","locale","grouping","thousands","identity","substring","currencyPrefix","currency","currencySuffix","decimal","numerals","formatNumerals","percent","minus","nan","newFormat","formatTypes","formatType","maybeSuffix","valuePrefix","valueSuffix","valueNegative","out","i1","i0","formatTrim","charCodeAt","Infinity","e10","e5","e2","start","stop","ticks","tickIncrement","isFinite","r0","r1","power","LN10","lo","hi","mid","ascendingComparator","ascendingBisect","bisector","bisectRight","extend","Color","darker","brighter","reI","reN","reP","reHex","reRgbInteger","reRgbPercent","reRgbaInteger","reRgbaPercent","reHslPercent","reHslaPercent","named","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","color_formatHex","rgb","formatHex","color_formatRgb","formatRgb","rgbn","Rgb","rgba","hsla","rgbConvert","rgb_formatHex","hex","rgb_formatRgb","Hsl","hslConvert","hsl","hsl2rgb","m1","m2","basis","t1","v0","v1","v2","v3","t2","t3","channels","displayable","formatHsl","linear","nogamma","constant","rgbGamma","y","exponential","gamma","end","rgbSpline","spline","rgbBasis","genericArray","nb","na","setTime","reA","reB","am","bm","bs","lastIndex","q","one","ArrayBuffer","isView","DataView","unit","bimap","range","interpolate","d0","d1","polymap","bisect","clamp","unknown","transformer","transform","untransform","piecewise","output","rescale","invert","rangeRound","continuous","initRange","transformLog","transformExp","transformLogn","transformExpn","pow10","reflect","loggish","logs","pows","base","E","log10","log2","logp","powp","z","tickFormat","nice","interval","linearish","step0","step1","tickStep","precisionPrefix","precisionRound","precisionFixed","prestep","maxIter","transformPow","transformSqrt","transformSquare","powish","toScale","isSame","fixDomain","getRange","ScaleMappingFunction","code","value_min","value_max","value_range","value_domain","mi","ma","ScriptMappingFunction","restoreMapping","mappingFunction","mappingFunctions","script","pow2","pow3","DEFAULT_FORMATTER","toCompareBoxPlotValue","getSortMethod","getBoxPlotNumber","getRawBoxPlotData","noNumberFilter","isEqualNumberFilter","isNumberIncluded","isDummyNumberFilter","restoreNumberFilter","filterAccuracy","numberFormat","currentGroupThresholds","groupSortMethod","original","deriveMapping","colorMappingFunction","NumberColumn","getNumberFormat","minMax","getRawValue","stratifyThresholds","stratifyThreshholds","EVENT_MAPPING_CHANGED","EVENT_SORTMETHOD_CHANGED","raw","iterNumber","iterRawNumber","getRawNumber","sortMethod","getOriginalMapping","setMapping","getGroupThresholds","setGroupThresholds","threshold","thresholdIndex","setSortMethod","BoxPlotColumn","byKey","MapColumn","CategoricalMapColumn","kv","parseValue","getCategoryMap","CategoricalsColumn","t0","newInterval","floori","offseti","field","durationSecond","durationMinute","durationHour","durationDay","durationWeek","utcWeekday","setUTCDate","getUTCDate","getUTCDay","setUTCHours","utcSunday","utcMonday","utcTuesday","utcWednesday","utcThursday","utcFriday","utcSaturday","utcDay","weekday","getDay","setHours","getTimezoneOffset","sunday","monday","tuesday","wednesday","thursday","friday","saturday","day","year","setFullYear","utcYear","setUTCMonth","setUTCFullYear","getUTCFullYear","localDate","H","M","S","L","utcDate","UTC","newDate","timeFormat","timeParse","pads","numberRe","percentRe","requoteRe","pad","requote","formatRe","names","formatLookup","parseWeekdayNumberSunday","parseWeekdayNumberMonday","parseWeekNumberSunday","U","parseWeekNumberISO","parseWeekNumberMonday","W","parseFullYear","parseYear","parseZone","Z","parseQuarter","parseMonthNumber","parseDayOfMonth","parseDayOfYear","parseHour24","parseMinutes","parseSeconds","parseMilliseconds","parseMicroseconds","parseLiteralPercent","parseUnixTimestamp","Q","parseUnixTimestampSeconds","formatDayOfMonth","formatHour24","getHours","formatHour12","formatDayOfYear","formatMilliseconds","getMilliseconds","formatMicroseconds","formatMonthNumber","formatMinutes","getMinutes","formatSeconds","getSeconds","formatWeekdayNumberMonday","formatWeekNumberSunday","dISO","formatWeekNumberISO","formatWeekdayNumberSunday","formatWeekNumberMonday","formatYear","formatYearISO","formatFullYear","formatFullYearISO","formatZone","formatUTCDayOfMonth","formatUTCHour24","getUTCHours","formatUTCHour12","formatUTCDayOfYear","formatUTCMilliseconds","getUTCMilliseconds","formatUTCMicroseconds","formatUTCMonthNumber","getUTCMonth","formatUTCMinutes","getUTCMinutes","formatUTCSeconds","getUTCSeconds","formatUTCWeekdayNumberMonday","dow","formatUTCWeekNumberSunday","UTCdISO","formatUTCWeekNumberISO","formatUTCWeekdayNumberSunday","formatUTCWeekNumberMonday","formatUTCYear","formatUTCYearISO","formatUTCFullYear","formatUTCFullYearISO","formatUTCZone","formatLiteralPercent","formatUnixTimestamp","formatUnixTimestampSeconds","locale_dateTime","dateTime","locale_date","locale_time","time","locale_periods","periods","locale_weekdays","days","locale_shortWeekdays","shortDays","locale_months","months","locale_shortMonths","shortMonths","periodRe","periodLookup","weekdayRe","weekdayLookup","shortWeekdayRe","shortWeekdayLookup","monthRe","monthLookup","shortMonthRe","shortMonthLookup","formats","utcFormats","parses","parseSpecifier","charAt","newParse","week","parse","X","utcFormat","utcParse","formatLocale","month","hour","minute","second","shiftFilterDateDay","setMinutes","setSeconds","setMilliseconds","toDateGroup","grouper","granularity","centuryP","circular","century","decadeP","decade","chooseAggregatedDate","dates","currentGrouper","dateFormat","DEFAULT_DATE_FORMAT","dateParse","DateColumn","getFormatter","iterDate","isDateIncluded","DOUBLE_ASC","getDateGrouper","setDateGrouper","EDateSort","DatesColumn","getDates","av","compute","DatesMapColumn","getDateMap","EGroupSortMethod","createGroupDesc","GroupColumn","COUNT","currentMaxDepth","currentLeaves","currentLeavesNameCache","currentLeavesPathCache","hierarchySeparator","hierarchy","initHierarchy","currentNode","computeLeaves","updateCaches","HierarchyColumn","EVENT_CUTOFF_CHANGED","maxDepth","cutOffNode","findName","getCutOff","setCutOff","leaves","visit","depth","resolveInnerNodes","queue","isHierarchical","deriveHierarchy","scheme","ramp","radians","degrees","A","B","C","D","ED","EB","BC_DA","cubehelixConvert","Cubehelix","bl","atan2","cubehelix","hue","cubehelixGamma","cosh","cos","sinh","sin","cubehelixLong","warm","cool","ts","magma","inferno","plasma","SequentialColorFunction","FUNCTIONS","interpolateBlues","interpolateGreens","interpolateGreys","interpolateOranges","interpolatePurples","interpolateReds","interpolateCool","interpolateCubehelixDefault","interpolateWarm","interpolatePlasma","interpolateMagma","interpolateViridis","interpolateInferno","interpolateYlOrRd","interpolateYlOrBr","interpolateBuGn","interpolateBuPu","interpolateGnBu","interpolateOrRd","interpolatePuBuGn","interpolatePuBu","interpolatePuRd","interpolateRdPu","interpolateYlGnBu","interpolateYlGn","interpolateRainbow","DivergentColorFunction","interpolateBrBG","interpolatePRGn","interpolatePiYG","interpolatePuOr","interpolateRdBu","interpolateRdGy","interpolateRdYlBu","interpolateRdYlGn","interpolateSpectral","UnknownColorFunction","SolidColorFunction","steps","perStep","quantize","QuantizedColorFunction","CustomColorMappingFunction","DEFAULT_COLOR_FUNCTION","createImpositionDesc","ImpositionCompositeColumn","wrapper","rest","NumbersColumn","vi","getRawNumbers","CENTER","createImpositionBoxPlotDesc","ImpositionBoxPlotColumn","createImpositionsDesc","ImpositionCompositesColumn","CompositeNumberColumn","createReduceDesc","ReduceColumn","selected","EVENT_REDUCE_CHANGED","getReduce","setReduce","createStackDesc","showNestedSummaries","collapsed","adaptChange","adaptWidthChange","StackColumn","weights","getWeights","EVENT_COLLAPSE_CHANGED","EVENT_WEIGHTS_CHANGED","EVENT_MULTI_LEVEL_CHANGED","setCollapsed","isShowNestedSummaries","weight","full","oldWeight","factor","widths","guess","setWeights","COLLAPSED_RENDERER","MultiLevelCompositeColumn","createNestedDesc","NestedColumn","NumberMapColumn","OrdinalColumn","DEFAULT_SCRIPT","createScriptDesc","allFactory","_all","byName","byID","byIndex","ScriptColumn","EVENT_SCRIPT_CHANGED","setScript","getScript","clean","raws","ColumnContext","ColumnWrapper","LazyColumnWrapper","getMapValue","StringMapColumn","StringsColumn","patternTemplates","LinkColumn","setPattern","EVENT_PATTERN_CHANGED","getPattern","getLink","href","transformValue","alt","getLinkMap","LinkMapColumn","LinksColumn","getLinks","ABORTED","thenFactory","loader","isAborted","abort","onfulfilled","_onrejected","loadedOrAborted","res","abortAble","aborted","aborter","race","abortAbleAll","all","values_1","isAbortAble","candidate","isAsyncUpdate","update","ready","SCHEMA_REF","isComplexAccessor","resolveValue","rowComplexGetter","rowGetter","rowGuessGetter","cleanCategories","isEmpty","deriveBaseType","options","warn","datePattern","treatAsCategorical","categoricalThreshold","deriveColumnDescriptions","config","first","existing","exclude","selectColumns","foundRow","primitive","mapAll","vii","sameLength","hasDifferentSizes","deriveType","toLabel","deriveColors","DEFAULT_EXPORT_OPTIONS","newline","header","quoteChar","verboseColumnHeaders","createCSVExporter","addHeader","addRow","exportRanking","opts","exportTable","columnsOrRanking","map2Object","rangeSelection","provider","rankingId","relIndex","ctrlKey","getRankings","selection","getSelection","nearest","distance","setSelection","promiseLike","isAlwaysShowingGroupStrategy","strategy","toItemMeta","relativeIndex","groupParents","meta","prev","prevMeta","groupEndLevel","topNGetter","last","isSummaryGroup","toDirtyReason","UNKNOWN","SORT_CRITERIA_CHANGED","GROUP_CRITERIA_CHANGED","GROUP_SORT_CRITERIA_CHANGED","mergeDirtyOrderContext","currentReason","nextReason","combined","rankings","aggregations","columnTypes","colorMappingFunctionTypes","mappingFunctionTypes","singleSelection","showTopN","aggregationStrategy","propagateAggregationState","aggregate","annotate","boolean","booleans","boxplot","categoricalMap","categoricals","dateMap","imposition","impositionBoxPlot","impositions","nested","numbers","numberMap","ordinal","rank","stack","stringMap","strings","link","linkMap","links","quantized","custom","colorMappingFunctions","typeFactory","createTypeFactory","fromDescRef","fixDesc","instantiateColumn","patchColumn","typeName","createColorMappingFunction","getTypeFactory","ADataProvider","EVENT_DATA_CHANGED","EVENT_BUSY","EVENT_SHOWTOPN_CHANGED","EVENT_ADD_RANKING","EVENT_REMOVE_RANKING","EVENT_SELECTION_CHANGED","EVENT_ADD_DESC","EVENT_CLEAR_DESC","EVENT_JUMP_TO_NEAREST","EVENT_GROUP_AGGREGATION_CHANGED","pushRanking","cloneRanking","insertRanking","fireBusy","busy","takeSnapshot","hasString","hasColumn","toClone","FORWARD_RANKING_EVENTS","triggerReorder","paths","removeDuplicates","level","real","unifyParents","initAggregateState","removeRanking","cleanUpRanking","clearRankings","getFirstRanking","getLastRanking","ensureOneRanking","destroy","_ranking","nextId","select","deselect","selectAll","deselectAll","getAggregationState","setAggregationState","cleanDesc","dumpColumn","restoreColumn","bind","$schema","descRef","restoreRanking","object2Map","deriveDefault","addSupportType","getColumns","getTopNAggregated","EXPAND_TOP_N","setTopNAggregated","unaggregateParents","changed","getAggregationStrategy","changedParents","aggregateAllOf","aggregateAll","state","getShowTopN","setShowTopN","jumpToNearest","selectAllOf","clearSelection","toggleSelection","additional","selectedRows","view","dataImpl","exportSelection","getRow","EVENT_REMOVE_DESC","injectAccessor","rankingIndex","nextRankingId","pushDesc","clearColumns","removeDesc","ignoreBeingUsed","isUsed","findDesc","missingBinary","missingUInt16","missingUInt32","missingInt8","missingInt16","missingInt32","missingFloat","missingFloatAsc","missingString","toCompareLookUp","rawLength","INT8","INT16","INT32","DOUBLE","createSetter","missingCount","isSorting","valueCaches","criteria","ri","pushValues","free","ANOTHER_ROUND","oneShotIterator","calc","wrappee","onrejected","taskId","runTasks","deadline","task","didTimeout","timeRemaining","requestAnimationFrame","reSchedule","ww","requestIdleCallback","pushMulti","abortOrDummy","isAbortedOrDummy","abortAll","clearIdleCallback","onfullfilled","taskNow","TaskNow","taskLater","TaskLater","tasksAll","_joined","valueCacheData","stringTopNCount","byOrder","byOrderAcc","builder","orders","MultiIndices","currentChunkSize","chunkCounter","actOrder","builderForEach","resolveDomain","statsBuilder","dacc","setValueCacheData","name2index","categoricalValueCacheBuilder","dirtyColumn","sortDirect","lookups","setData","dirtyRanking","preCompute","preComputeData","preComputeCol","copyData2Summary","copyCache","fromPrefix","cacheKey","_singleCall","groupCompare","rg","groupRows","_col","groupExampleRows","groupBoxPlotStats","summaryBoxPlotStatsD","groupNumberStats","summaryNumberStatsD","groupCategoricalStats","summaryCategoricalStatsD","groupDateStats","summaryDateStatsD","groupStringStats","summaryStringStatsD","summaryBoxPlotStats","summaryNumberStats","summaryCategoricalStats","summaryDateStats","summaryStringStats","cached","dataNumberStats","dataBoxPlotStats","dataCategoricalStats","dataDateStats","dataStringStats","creator","dontCache","ARenderTasks","isMapColumn","endsWith","isArrayColumn","isCategoricalLikeColumn","isSetColumn","isCategoricalColumn","isCategoricalsColumn","isCategory","isDateColumn","isDatesColumn","WorkerTaskScheduler","checker","orderedGroups","multi","chainCopy","chainKey","chain","joined","canAbort","isValidCacheEntry","subTask","created","valueCacheKey","singleCall","indexArray","toTransfer","_data","ooptions","filterGlobally","jumpToSearchResult","taskExecutor","mapToDataRow","_dataRows","toRows","DirectRenderTasks","ScheduleRenderTasks","reorderAll","getTotalNumberOfRows","getTaskExecutor","dataChanged","clearData","appendData","trackRanking","addKey","removeKey","loadedKey","removeCol","addCol","dataLoaded","resolveFilter","noSorting","createSorter","needsFiltering","needsGrouping","needsSorting","groupOrder","CompareLookup","pushGroup","groupKey","groupCaches","filterCaches","toGroup","fc","before","sortGroup","groupLookup","singleGroup","sortTask","groupSortTask","groupC","sortGroups","enforceSorting","groupIndices","reasons","needsGroupSorting","isSortedBy","isGroupedSortedBy","sortedGroups","viewRaw","viewRawRows","mappingSample","searchAndJump","search","ERenderMode","DENSE_HISTOGRAM","MIN_LABEL_WIDTH","GUESSED_ROW_HEIGHT","noRenderer","setText","textContent","querySelectorAll","forEachChild","matchColumns","childElementCount","dataset","columnId","rendererId","idsAndRenderer","idAndRenderer","childNode","querySelector","asElement","classList","appendChild","innerHTML","wideEnough","wideEnoughCat","adaptTextColorToBgColorCache","adaptTextColorToBgColor","bgColor","adaptDynamicColorToBgColor","title","adapt","style","innerText","span","ownerDocument","createElement","uniqueId","idCounter","exampleText","examples","multiLevelGridCSSClass","idPrefix","colorOf","adaptColorCache","BIG_MARK_LIGHTNESS_FACTOR","SMALL_MARK_LIGHTNESS_FACTOR","adaptColor","lightnessFactor","saturationFactor","hslColor","canRender","SUMMARY","sanitize","className","icon","ni","onclick","event","preventDefault","stopPropagation","action","createGroup","createSummary","matchNodes","addTopN","doc","renderGroups","isRow","isLeafGroup","alwaysShowGroup","isSummary","hasTopN","hasTopNStrategy","lastParent","isLastGroup","toggle","isCollapsed","isFirst","isShowAll","childTopN","nextState","isDummyGroup","render","fillStyle","fillRect","filterMissingMarkup","bakMissing","filterMissingNumberMarkup","findFilterMissing","getElementsByClassName","previousElementSibling","updateFilterMissingNumberMarkup","element","getElementsByTagName","disabled","lastElementChild","renderMissingValue","dashX","dashY","renderMissingDOM","renderMissingCanvas","interactiveSummary","form","isRegex","isInputFocused","checked","onchange","oninput","onfocus","onblur","onsubmit","actCol","interactive","filterToString","StringCellRenderer","dl","matchDataList","matches","firstElementChild","imposer","valueHint","renderValue","CELL","colWidth","bar","backgroundColor","groupTitle","summaryTitle","_mode","DefaultCellRenderer","BOXPLOT","MAPPED_BOXPLOT","computeLabel","sortedByMe","renderDOMBoxPlot","scaled","topPadding","strokeStyle","beginPath","rect","moveTo","lineTo","renderBoxPlot","isMissing","_interactive","mappedSummary","rawSummary","hasRange","whiskers","nextElementSibling","leftWhisker","rightWhisker","display","outliers","numOutliers","insertAdjacentElement","toHeatMapColor","valueColor","matchBins","filterUpdate","matchedBins","interactiveHist","staticSummary","showLabels","bins","createBin","lastBin","bin","insertAdjacentHTML","gHist","inner","gCount","relY","background","setCategoricalFilter","markFilter","included","contained","parentElement","createContext","cellDimension","mover","offsetX","getContext","canvas","clearRect","onmousemove","onmouseleave","maps","toMostFrequentCategoricals","templateRows","stackedBar","selectedCol","gBins","flexGrow","_context","radiusPercentage","availableHeight","getCanvasRenderer","pi2","radius","GUESSES_GROUP_HEIGHT","save","globalAlpha","arc","getDOMRenderer","dots","tmp","top","getSingleDOMRenderer","sanitizedLabel","dot","formatter","DotCellRenderer","seq1","seq2","ConcatSequence","concatSeq","_ctx","normalized","templateRow","ANumbersCellRenderer","_hist","getWindow","window","defaultView","isElement","Element","isHTMLElement","HTMLElement","isShadowRoot","ShadowRoot","getBoundingClientRect","includeScale","scaleX","scaleY","offsetHeight","offsetWidth","bottom","getWindowScroll","win","scrollLeft","pageXOffset","scrollTop","pageYOffset","getNodeName","nodeName","getDocumentElement","document","documentElement","getWindowScrollBarX","getComputedStyle","isScrollParent","_getComputedStyle","overflow","overflowX","overflowY","getCompositeRect","elementOrVirtualElement","offsetParent","isFixed","isOffsetParentAnElement","offsetParentIsScaled","isElementScaled","scroll","clientLeft","clientTop","getLayoutRect","clientRect","offsetLeft","offsetTop","getParentNode","assignedSlot","parentNode","host","getScrollParent","body","listScrollParents","_element$ownerDocumen","scrollParent","isBody","visualViewport","updatedList","isTableElement","getTrueOffsetParent","position","getOffsetParent","isFirefox","userAgent","css","perspective","contain","willChange","getContainingBlock","auto","basePlacements","viewport","popper","variationPlacements","placement","modifierPhases","modifiers","visited","modifier","requires","requiresIfExists","dep","depModifier","DEFAULT_OPTIONS","areValidElements","_len","popperGenerator","generatorOptions","_generatorOptions","_generatorOptions$def","defaultModifiers","_generatorOptions$def2","defaultOptions","fn","pending","orderedModifiers","modifiersData","elements","effectCleanupFns","isDestroyed","instance","setOptions","setOptionsAction","cleanupModifierEffects","scrollParents","contextElement","merged","phase","orderModifiers","enabled","_ref3","_ref3$options","effect","cleanupFn","forceUpdate","_state$elements","rects","reset","_state$orderedModifie","_state$orderedModifie2","_options","onFirstUpdate","passive","getBasePlacement","getVariation","getMainAxisFromPlacement","computeOffsets","_ref","basePlacement","variation","commonX","commonY","mainAxis","unsetSides","mapToStyles","_ref2","_Object$assign2","popperRect","gpuAcceleration","adaptive","roundOffsets","_offsets$x","_offsets$y","hasX","hasY","sideX","sideY","heightProp","widthProp","_Object$assign","commonStyles","_ref4","dpr","devicePixelRatio","roundOffsetsByDPR","removeAttribute","setAttribute","initialStyles","margin","arrow","property","attribute","hash","getOppositePlacement","matched","getOppositeVariationPlacement","contains","rootNode","getRootNode","isSameNode","rectToClientRect","getClientRectFromMixedType","clippingParent","html","clientWidth","clientHeight","getViewportRect","getInnerBoundingClientRect","winScroll","scrollWidth","scrollHeight","direction","getDocumentRect","mergePaddingObject","paddingObject","expandToHashMap","hashMap","detectOverflow","_options$placement","_options$boundary","boundary","_options$rootBoundary","rootBoundary","_options$elementConte","elementContext","_options$altBoundary","altBoundary","_options$padding","altContext","clippingClientRect","mainClippingParents","clippingParents","clipperElement","getClippingParents","firstClippingParent","clippingRect","accRect","getClippingRect","referenceClientRect","popperOffsets","popperClientRect","elementClientRect","overflowOffsets","offsetData","multiply","axis","within","_options$mainAxis","checkMainAxis","_options$altAxis","altAxis","checkAltAxis","_options$tether","tether","_options$tetherOffset","tetherOffset","isBasePlacement","referenceRect","tetherOffsetValue","normalizedTetherOffsetValue","offsetModifierState","_offsetModifierState$","mainSide","altSide","additive","minLen","maxLen","arrowElement","arrowRect","arrowPaddingObject","arrowPaddingMin","arrowPaddingMax","arrowLen","minOffset","maxOffset","arrowOffsetParent","clientOffset","offsetModifierValue","tetherMax","preventedOffset","_offsetModifierState$2","_mainSide","_altSide","_offset","_min","_max","isOriginSide","_offsetModifierValue","_tetherMin","_tetherMax","_preventedOffset","withinMaxClamp","_state$modifiersData$","toPaddingObject","minProp","maxProp","endDiff","startDiff","clientSize","centerToReference","axisProp","centerOffset","_options$element","getSideOffsets","preventedOffsets","isAnySideFullyClipped","side","_options$scroll","_options$resize","resize","_ref5","_options$gpuAccelerat","_options$adaptive","_options$roundOffsets","_options$offset","invertDistance","skidding","distanceAndSkiddingToXY","_data$state$placement","_skip","specifiedFallbackPlacements","fallbackPlacements","_options$flipVariatio","flipVariations","allowedAutoPlacements","preferredPlacement","oppositePlacement","getExpandedFallbackPlacements","placements","_options$allowedAutoP","allowedPlacements","overflows","computeAutoPlacement","checksMap","makeFallbackChecks","firstFittingPlacement","_basePlacement","isStartVariation","isVertical","mainVariationSide","altVariationSide","checks","check","_loop","fittingPlacement","preventOverflow","referenceOverflow","popperAltOverflow","referenceClippingOffsets","popperEscapeOffsets","isReferenceHidden","hasPopperEscaped","dialogContext","attachment","currentTarget","manager","dialogManager","dialog","livePreview","popup","toggleDialog","cancelSubDialogs","autoClose","showLivePreviews","livePreviews","enableLivePreviews","submitter","submit","equals","appendDialogButtons","open","removeLike","closest","boundariesElement","focus","triggerSubmit","cancel","removeAboveLevel","checkValidity","findInput","cleanUp","triggerDialogClosed","ioptions","valueAsNumber","dragHandle","handle","container","onStart","onDrag","onEnd","minDelta","ueberElement","toContainerRelative","elem","handleShift","mouseMove","clientX","mouseUp","onmousedown","filteredColor","histogramTemplate","guessedBins","histogramUpdate","unfiltered","nodes","mappingHintTemplate","mappingHintUpdate","filteredHistTemplate","filterMin","filterMax","formatRaw","initFilter","minHint","maxHint","minValue","parseRaw","maxValue","minImpl","edit","shiftKey","ondblclick","maxImpl","button","px","unpercent","getHistDOMRenderer","updateFilter","fContext","createFilterContext","createFilterInfo","dialogCtx","maxLevel","backgroundImage","src","image","Image","onload","single","aggregatedIndex","createData","stacked","GROUP","toWait","missingWeight","ci","cNode","gridColumnStart","stackShift","cr","translate","callbacks","sorted","aMissing","bMissing","numberCompare","medianIndex","AAggregatedGroupRenderer","rr","summaries","grouped","sample","dummyBin","groupedHist","LinkCellRenderer","more","updateLinkList","createTextNode","rel","insertAdjacentText","renderTable","keyNode","valueNode","createFixed","TableCellRenderer","createFixedGroup","groupByKey","valueA","example","LinkMapCellRenderer","fromTSpan","toTSpan","unselected","unchecked","createDOMContext","SetCellRenderer","posX","line","moveNext","yPos","repeat","matchRows","calculateSetPath","catindexes","UpSetCellRenderer","hasTrueValues","CANVAS_HEIGHT","tooltipPrefix","VerticalBarCellRenderer","xpos","chosen","valueAsDate","dummyDomain","now","DEFAULT_FILTERED_COLOR","updateBin","dataBins","dd","createViolinTemplate","fillColor","renderViolin","isMapped","mappedHelper","_sort","svg","xScale","yScale","halfH","pathF","pathB","point","computePath","iqrLine","medianLine","meanLine","tick","perElem","defaultCellRenderer","renderers","brightness","catdistributionbar","circle","default","heatmap","catheatmap","histogram","datehistogram","interleaving","loading","mapbars","sparkline","stringhist","upset","verticalbar","violin","cattick","sets","schemeCategory10","schemeAccent","schemeDark2","schemePastel1","schemePastel2","schemeSet1","schemeSet2","schemeSet3","updateStats","someMode","noFilter","joint","items","currentGroup","currentSummary","getPossibleRenderer","createTemplate","wrapped","gradient","isCustom","applyColor","s0","s1","dm1","toColor","content","toggles","customs","updateColor","updateSelectedColor","continuouos","continuouos2","quantized2","steps2","updateGradients","steppedGradient","di","stepSize","half","hasDnDType","available","dataTransfer","typesToCheck","dndTransferStorage","isEdgeDnD","updateDropEffect","dT","effectAllowed","copyDnD","dropEffect","dropAble","mimeTypes","onDrop","onDragOver","canDrop","getData","mime","sortActions","getFullToolbar","caches","toolbarIcon","getOwnMetadata","getAllToolbarActions","possible","resolveToolbarActions","getToolbar","advancedModelFeatures","featureCategory","advancedRankingFeatures","advancedUIFeatures","getToolbarDialogAddons","cacheAddon","toolbarAddons","getAllToolbarDialogAddons","resolveToolbarDialogAddons","actionCSSClass","addIconDOM","showLabel","isActionMode","setHighlightColumn","onClick","updateIconState","groupedBy","active","colId","addIcon","createToolbarMenuItems","setTextOrEmpty","condition","asHTML","createHeader","dragAble","mergeDropAble","rearrangeAble","resizeable","extraPrefix","extra","labelAsHTML","summaryAsHTML","createShortcutMenuItems","toggleToolbarIcons","onDragStart","onDragEnd","draggable","payload","over","JSON","stringify","MIMETYPE_PREFIX","dragAbleColumn","merger","resolveDrop","alternative","mergeImpl","mergeWith","numberlike","draginfo","placer","widthFactor","toInsertParent","rearrangeDropAble","sizeHelper","currentFooterTransformation","originalWidth","dragWidth","updateHeader","minWidth","subLabel","typeCat","updateMoreDialogIcons","willAutoHide","shortcuts","hybrids","moreEntries","defaultVisibleClientWidth","rotated","toggleRotatedHeader","availableWidth","shortCuts","moreIcon","needMore","createChildren","summaryNode","innerNodes","innerNodePaths","setCustomValidity","newNode","newNodeIndex","maxDepthText","handler","applyFilter","rerender","prepareRender","createDateFilter","templates","handlers","addon","strong","append","updateDisabled","disable","elems","sortOrder","adapter","unnormalizeRaw","normalizeRaw","common","updated","openDialog","MappingLineDialog","handled","destroyed","trigger","mappingLines","mappingAdapter","updateLines","computeScale","rawDomain","scaleType","others","bb","MappingLine","copyMapping","createMappings","selectedIndex","updateDomainWarning","patchedDomain","warningNode","originalDomain","showWarning","getAttribute","createNumberFilter","sortMethods","methods","checkbox","toInput","inputs","updateBar","distributeWeights","missingIndices","validWeights","buttons","reportValidity","guessRemoveFilter","filtered","guessedRemoved","ui","uiDialog","dialogClass","extraArgs","isAscByDefault","sortGroupBy","rename","vis","_evt","removeAll","toggleCompressExpand","mcol","toolbarActions","compress","expand","filterNumber","filterDate","filterString","filterSelection","filterCategorical","filterOrdinal","colorMapped","colorMappedCategorical","cutoff","editMapping","editPattern","editWeights","compositeContained","splitCombined","invertSelection","ss","uiSortMethod","toolbarDialogAddons","sortNumber","sortNumbers","sortBoxPlot","sortDates","groupNumber","isThreshold","thresholds","groupString","valueRadioButton","startsWithRadioButton","regexRadioButton","showOrHideTextarea","newType","groupDate","labelRotation","summaryHeader","animated","expandLineOnHover","sidePanel","sidePanelCollapsed","hierarchyIndicator","defaultSlopeGraphMode","overviewMode","groupSort","onDialogBackgroundClick","rowHeight","groupHeight","groupPadding","rowPadding","levelOfDetail","customRowUpdate","dynamicHeight","disableFrozenColumns","ignoreUnsupportedBrowser","copyableRows","instanceId","merge","bKeys","to","pack","ar","BrowserInfo","version","os","NodeInfo","platform","SearchBotDeviceInfo","bot","BotInfo","ReactNativeInfo","SEARCHBOT_OS_REGEX","userAgentRules","operatingSystemRules","parseUserAgent","ua","matchedRule","browser","uaMatch","matchUserAgent","versionParts","createVersionParts","detectOS","searchBotMatch","getUnsupportedBrowserError","info","product","fVersion","escKeyListener","which","removeLast","openDialogs","backdrop","DialogManager","EVENT_DIALOG_CLOSED","EVENT_DIALOG_OPENED","setHighlight","mask","area","clipPath","webkitClipPath","clearHighlight","takeDown","setUp","EAnimationMode","ignoreIncompatibleBrowser","highlightListeners","isBrowserSupported","ALineUp","EVENT_HIGHLIGHT_CHANGED","setDataProvider","dataIndices","enableHighlightListening","_enable","addCopyListener","csv","clipboardData","defaultPhases","delay","nodeY","actNode","animation","SHOW","HIDE","UPDATE_REMOVE","KeyFinder","_this","lastFilled","key2index","exceptions","findValidStart","posByKey","pos","fillCacheTillKey","defaultRowHeight","fillCache","heightOf","exceptionsLookup","exceptionHeightOf","returnDefault","numberOfRows","positions","defaultMode","ScrollHandler","sync","timer","handleAnimationImpl","handleAnimation","handleTimeouts","asInfo","isWaiting","_b","addScroll","scrollElement","__le_scroller__","isScrollEventWaiting","scroller","EScrollResult","RowHeightException","nonUniformContext","rowHeights","actualDefaultRowHeight","mostFrequentValue","totalHeight","paddedHeight","between","heightExceptions","firstRowPos","endPos","y2","offset2","indexShift","offsetShift","shifted2","lastPos","heightExceptions_1","firstException","lastException","updateFrozen","oldLast","added","PREFIX","CSS_CLASS_LOADING","CSS_CLASS_FROZEN","CSS_CLASS_HIDDEN","CSS_CLASS_MULTI","CSS_CLASS_EVEN","CSS_CLASS_SHIFTED","CSS_CLASS_SCROLLBAR_TESTER","CSS_CLASS_TR","CSS_CLASS_TH","CSS_CLASS_TD","CSS_CLASS_SCROLLING","CSS_CLASS_ROW_ANIMATION","isLoadingCell","ARowRenderer","pool","loadingPool","forcedFirst","forcedLast","visibleFirstRowPos","scrollListener","lastScrollInfo","abortAnimation","async","minScrollDelta","mixins","scrollingHint","batchSize","striped","viewportOversize","createAdapter","MixinClass","fragment","createDocumentFragment","addMixin","addAtBeginning","addAtBottom","removeFromBeginning","removeFromBottom","updateOffset","bodyScroller","scrollOffset","scrollTotal","sizer","tagName","firstChild","init","isGoingDown","onScrolledVertically","recreate","removeScroll","updateRow","createRow","selectProxy","proxy","recycle","abortResult","replaceChild","ex","exceptionHeight","perform","toRecycle","forEachRow","inPlace","fromBeginning","updateSizer","setTransform","bodySizer","recreateAnimated","recreatePure","clearPool","previousKey","cur","currentKey","rows_1","UPDATE","UPDATE_CREATE","nodeYCurrentHeight","nextPos","prevHeight","animate","phases","previousFinder","currentFinder","activeAnimation","currentTimer","actPhase","executePhase","anim","run","dummyAnimation","previousHeight","currentHeight","curr","noAnimationChange","revalidate","shiftTop","scrollResult","onScrolledImpl","onScrolled","shiftLast","currentDelta","shiftFirst","currentFirstRow","NONE","toAdd","SOME","toAddBottom","ALL","SOME_TOP","SOME_BOTTOM","manipulate","toRecycle_1","anyElem","__transform__","assignStyles","targetObj","plain","hyphen","setProperty","StyleManager","rules","testVerifyTimeout","verifySheet","sheet","cssRules","selectorText","deleteRule","rule","insertRule","cssRule","getSheetRule","addRule","updateRule","stored","extendStatics","setPrototypeOf","tableIds","tableId","thead","tbody","tr","th","td","tableCSSClasses","ids","GridStyleManager","_super","cssClasses","headerScroller","measureScrollbar","borderRight","frozenShift","selectors","updateColumns","ruleNames","cssSelectors","thStyles","tdStyles","MultiTableRowRenderer","htmlId","sections","columnPadding","cleanHTMLId","main","isGoingRight","onScrolledHorizontally","scrollEnd","headerFooter","bodyFooter","maxHeight","pushTable","extras","pushSeparator","section","widthChanged","createSanitizer","textNode","nodeValue","PrefetchMixin","prefetchTimeout","cleanupTimeout","prefetchRows","cleanUpRows","prefetchDown","nextLast","prefetchUp","syncFrozen","triggerPrefetch","prefetchDownPossible","prefetchUpPossible","isLast","op","cleanUpTop","newFirst","cleanUpBottom","newLast","triggerCleanUp","ACellAdapter","mixinClasses","cellPool","visibleColumns","visibleFirstColumnPos","horizontallyShifted","columnAdapter","createColumnAdapter","columnMixins","columnFragment","leftShift","addColumnMixin","addColumnAtStart","addColumnAtEnd","removeColumnFromStart","removeColumnFromEnd","updateColumnOffset","onScrolledHorizontallyImpl","removeCellFromStart","recycleCell","removeCellFromEnd","removeFrozenCells","columnIndices","columnIndices_1","columnIndex","removeFrozenColumns","removeAllColumns","includingFrozen","removeAllCells","frozen_1","selectProxyCell","columnObj","pooled","updateCell","createCell","updateShiftedState","handleCellReady","selectCell","rowIndex","addCellAtStart","cell","insertFrozenCells","columnIndices_2","insertFrozenColumns","addCellAtEnd","updateHeaders","fragment_1","document_1","ids_1","firstColumnPos","id_1","mergeColumns","updateImpl","cell_1","byId","idNode","updateShiftedStates","shifted","headers","bodies","headers_1","bodies_1","headers_2","_c","bodies_2","shiftingChanged","ACellTableSection","LocalCell","mixinClass","hidden","onVisibilityChanged","updateShifts","_left","_visible","wasHidden","updateColumnWidths","oldLeft","toGroupLookup","item2groupIndex","group2firstItemIndex","singleRenderer","singleTemplate","cloneNode","singleId","groupTemplate","groupId","summaryTemplate","summaryId","hasSummaryLine","oldRenderer","currentRenderer","oldGroup","getGroup","chainAbortAble","renderCell","mapper","mapped","mc","updateNested","matchChildren","cc","updateWidthRule","gridTemplateColumns","sub","hr","showHint","startNode","elementFromPoint","clientY","endNode","xShift","yShift","SelectionManager","EVENT_SELECT_RANGE","startIndex","endIndex","sy","ey","MIN_DISTANCE","selectRange","updateState","selectedDataIndices","RankingEvents","EVENT_UPDATE_DATA","EVENT_RECREATE","PASSIVE","roptions","loadingCanvas","highlight","canvasPool","currentCanvasShift","currentCanvasWidth","canvasMouseHandler","hoveredRows","unhover","enter","leave","updateHoveredRow","EngineRanking","isCanvasRenderedRow","highlightHandler","delayedUpdate","updateBody","delayedUpdateAll","updateAll","delayedUpdateColumnWidths","hiddenOffset","shiftedIndex","createCol","reindex","disableListener","shiftedOld","_oldValue","renderCtx","currentRowHeight","uniformContext","createRenderer","visibility","updateCanvasRule","updateColumnSummaryFlag","_document","createCellHandled","initCellClasses","selectCanvas","rowFlags","rowany","__lu__","visibleRenderedWidth","pushLazyRedraw","renderRow","imageSmoothingEnabled","domColumns","renderCellImpl","visibleElements","firstDOM","updateCellImpl","updateCanvasCell","me","needDOM","updateHeaderOf","toRowMeta","agg","hoverLod","computedLod","wasLow","wasGroup","recycleCanvas","canvas2","updateCanvasBody","enable","hover","inplace","updateSelection","computeShiftedIndex","leftOffset","indexOffset","frozenIndex","updateColumn","after","groupData","pushItem","ordered","groupParent","rowContext","previousData","currentData","prevHelper","currHelper","currentRowIndex","referenceIndex","appearPosition","_previousFinder","previousRowIndex","removePosition","lineupAnimation","findNearest","lookFor","firstBeforePos","firstAfterPos","nearestPos","scrollIntoView","regular","posOf","found","getHighlight","debounceUpdate","replacement","EMode","leftSlopes","rightSlopes","chosenSelectionOnly","ITEM","createElementNS","BAND","initHeader","icons","rebuild","leftRanking","leftContext","rightRanking","rightContext","prepareRightSlopes","computeSlopes","fakeGroups","padded","slopes","gr","heightPerRow","ItemSlope","fakeGroup","createFakeGroup","intersection","filterIndices","GroupSlope","chooseSelection","leftVisibleFirst","leftVisibleLast","rightVisibleFirst","rightVisibleLast","alreadyVisible","selectionLookup","updatePath","selectionSlopes","ownerSVGElement","matchLength","addPath","openDataIndices","scrollerNode","blocks","toSelectionBlocks","currentBlock","currentBlockLastIndex","isGroupSelected","firstRow","rawY","scaleFactor","block","updateData","targetY","scrollTo","behavior","resetTransform","slopeGraphs","updateAbles","zoomFactor","enabledHighlightListening","helper","EngineRenderer","chooseRenderer","chooseGroupRenderer","chooseSummaryRenderer","footer","selectionIndicator","marginTop","marginBottom","toDisable","initProvider","zoomOut","updateZoomFactor","zoomIn","fontSize","pushUpdateAble","updateAble","takeDownProvider","addRanking","setHighlightToNearest","updateHist","updateUpdateAbles","updateRotatedHeaderState","slope","round2","defaultHeight","heightsFor","updateSlopeGraphs","formatItem","placeholder","blur","onkeydown","handleKey","itemTemplate","buildDialog","li","isItem","onmouseenter","highlighted","click","highlightPrevious","highlightNext","SearchBox","SEARCH_ITEM_SELECTOR","filterResults","ul","allChildrenHidden","sanitized","addons","groupAdder","groupSortAdder","sortAdder","renderSorting","renderGroupSorting","toColumn","addonKey","onChange","prevent","customize","addGroupAdder","addSortAdder","addGroupSortAdder","addAdder","adder","onSelect","used","summaryUpdater","recreateSummary","appendSummary","updateSummary","dropdown","updateHierarchy","updateList","currentEntries","isWrapper","additionalDescs","chooser","collapseable","descs","initChooser","changeDataStorage","panel","wrapDesc","updateChooser","createEntry","makeActive","updateRanking","resetButton","groupByType","SidePanel","spaceFillingRule","visibleHeight","groupSeparators","violation","itemHeight","isDynamicLeafHeight","resizeListener","violationChanged","TaggleRenderer","switchRule","getRule","_rule","setViolation","spaceFilling","setOverviewMode","isOverviewMode","updateLodRules","htmlLabel","htmlSummary","_color","asArray","asMap","buildColumn","ColumnBuilder","rotation","registerRenderer","registerToolbarAction","registerToolbarDialogAddon","groupRowHeight","disableAdvancedRankingFeatures","disableAdvancedModelFeatures","disableAdvancedUIFeatures","supportTypes","allColumns","impose","colorColumn","scripted","weightedSum","numberColumn","numberColumn1","weight1","numberColumn2","weight2","numberColumnAndWeights","post","operation","numberColumns","RankingBuilder","ALL_MAGIC_FLAG","addColumn","col2","buildRanking","asOrdinal","asSet","derive","isSet","val","buildCategoricalColumn","CategoricalColumnBuilder","asBoxPlot","ext","buildNumberColumn","NumberColumnBuilder","editable","buildStringColumn","StringColumnBuilder","buildDateColumn","DateColumnBuilder","buildHierarchicalColumn","HierarchyColumnBuilder","groupAction","buildActionsColumn","ActionsColumnBuilder","marker","buildBooleanColumn","BooleanColumnBuilder","providerOptions","rankBuilders","_deriveColors","scheduledTaskExecutor","multiSelection","deriveColumns","registerColumnType","defaultRanking","addSupportTypes","buildData","oldPos","buildTaggle","DataBuilder","asTaggle","asLineUp","props","buildCategorical","missingCategory","buildDate","buildHierarchy","buildNumber","buildString","buildBoolean","buildActions","si","buildGeneric","buildImposeRanking","buildNestedRanking","buildWeightedSumRanking","buildReduceRanking","buildScriptRanking","buildSupportRanking","buildAllColumnsRanking","isTypeInstance","superClass","pick","lineupOptions","prevRankings","prevColumns","prevHighlight","onSelectionChanged","onHighlightChanged","componentDidMount","buildProvider","createInstance","resolveColumnDescs","columnDescs","deriveColumnNames","resolveRankings","builders","rankingBuilders","buildColumns","buildRankings","updateLineUp","changeDetector","providerChanged","changedLineUpOptions","updateProvider","columnsChanged","componentDidUpdate","componentWillUnmount","defineColumn","functions","CustomColumn","createIndex2Pos","server","maxCacheSize","loadFromServer","fetch","computeMissing","union","unionAdd","_v","loadInCache","_m","toLoad","createLocalDataProvider","createLineUp","createTaggle","buildId","license"],"sourceRoot":""}