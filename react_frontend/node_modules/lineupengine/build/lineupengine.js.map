{"version":3,"file":"lineupengine.js","mappings":"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","sources":["webpack://lineupengine/webpack/universalModuleDefinition","webpack://lineupengine/webpack/bootstrap","webpack://lineupengine/webpack/runtime/define property getters","webpack://lineupengine/webpack/runtime/hasOwnProperty shorthand","webpack://lineupengine/webpack/runtime/make namespace object","webpack://lineupengine/./src/abortAble.ts","webpack://lineupengine/./src/animation/KeyFinder.ts","webpack://lineupengine/./src/animation/index.ts","webpack://lineupengine/./src/internal/index.ts","webpack://lineupengine/./src/internal/scroll.ts","webpack://lineupengine/./src/logic.ts","webpack://lineupengine/./src/mixin/IMixin.ts","webpack://lineupengine/./src/styles/index.ts","webpack://lineupengine/./src/ARowRenderer.ts","webpack://lineupengine/./src/style/StyleManager.ts","webpack://lineupengine/./src/style/GridStyleManager.ts","webpack://lineupengine/./src/table/internal/ACellAdapter.ts","webpack://lineupengine/./src/ACellRenderer.ts","webpack://lineupengine/./src/mixin/PrefetchMixin.ts","webpack://lineupengine/./src/table/ACellTableSection.ts","webpack://lineupengine/./src/table/MultiTableRowRenderer.ts","webpack://lineupengine/./src/bundle.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"lineupengine\"] = factory();\n\telse\n\t\troot[\"lineupengine\"] = factory();\n})(globalThis, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export function isPromiseLike(p: PromiseLike<unknown> | unknown): p is PromiseLike<unknown> {\n  return p != null && typeof (p as PromiseLike<unknown>).then === 'function';\n}\n\n/**\n * a promise like object that has an abort method\n */\nexport interface IAbortAblePromiseBase<T> extends PromiseLike<T> {\n  then<TResult1 = T, TResult2 = never>(\n    onfulfilled?: ((value: T) => TResult1 | PromiseLike<TResult1>) | undefined | null,\n    onrejected?: ((reason: unknown) => TResult2 | PromiseLike<TResult2>) | undefined | null\n  ): IAbortAblePromiseBase<TResult1 | TResult2>;\n  /**\n   * abort the promise when possible\n   */\n  abort(): void;\n  /**\n   * whether this promise was aborted\n   */\n  isAborted(): boolean;\n}\n\n/**\n * a promise like object that has an abort method and return the ABORTED symbol in case it was\n */\nexport declare type IAbortAblePromise<T> = IAbortAblePromiseBase<T | symbol>;\nexport declare type IAAP<T> = IAbortAblePromise<T>;\n\n/**\n * an update result with an item and a promise when the update has been done\n */\nexport interface IAsyncUpdate<T> {\n  item: T;\n  ready: IAbortAblePromise<void>;\n}\n\n/**\n * the symbol returned when the promise was aborted\n */\nexport const ABORTED = Symbol('aborted');\n\nfunction thenFactory<T>(loader: PromiseLike<T | symbol>, isAborted: () => boolean, abort: () => void) {\n  function then<TResult1 = T | symbol, TResult2 = never>(\n    onfulfilled?: ((value: T | symbol) => TResult1 | PromiseLike<TResult1>) | undefined | null,\n    _onrejected?: ((reason: unknown) => TResult2 | PromiseLike<TResult2>) | undefined | null\n  ): IAbortAblePromiseBase<TResult1 | TResult2> {\n    const fullfiller = loader.then((loaded) => {\n      const loadedOrAborted = isAborted() ? ABORTED : loaded;\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const res = onfulfilled ? onfulfilled(loadedOrAborted) : (loadedOrAborted as unknown as any);\n\n      if (isPromiseLike(res)) {\n        return res.then((r) => {\n          return isAborted() ? ABORTED : r;\n        });\n      }\n      return isAborted() ? ABORTED : res;\n    });\n    return {\n      then: thenFactory(fullfiller, isAborted, abort),\n      abort,\n      isAborted,\n    };\n  }\n  return then;\n}\n\n/**\n * abort able Promise wrapper, returns a promise which can be aborted, and trying to avoid executing therefore the wrapped promise\n * @param {Promise<T>} loader\n * @returns {any}\n */\nexport default function abortAble<T>(loader: PromiseLike<T>): IAAP<T> {\n  let aborted: ((v: symbol) => void) | null = null;\n  const isAborted = () => aborted === null;\n  const aborter = new Promise<symbol>((resolve) => {\n    aborted = resolve;\n  });\n  const abort = () => {\n    if (aborted == null) {\n      return;\n    }\n    aborted(ABORTED);\n    aborted = null;\n  };\n\n  const race = Promise.race<T | symbol>([aborter, loader]);\n\n  return {\n    then: thenFactory(race, isAborted, abort),\n    abort,\n    isAborted,\n  };\n}\n\nexport function abortAbleFetch(input: RequestInfo, init?: RequestInit): IAAP<Response> {\n  const controller = new AbortController();\n\n  const race = new Promise<Response | symbol>((resolve, reject) => {\n    const r = fetch(input, { signal: controller.signal, ...(init || {}) });\n    r.then(resolve);\n    r.catch((error) => {\n      if (error instanceof DOMException) {\n        resolve(ABORTED);\n      } else {\n        reject(error);\n      }\n    });\n  });\n\n  const abort = controller.abort.bind(controller);\n  const isAborted = () => controller.signal.aborted;\n\n  return {\n    then: thenFactory(race, isAborted, abort),\n    abort,\n    isAborted,\n  };\n}\n\nexport function abortAbleAll<T1, T2, T3, T4, T5, T6, T7, T8, T9, T10>(\n  values: [\n    T1 | IAAP<T1>,\n    T2 | IAAP<T2>,\n    T3 | IAAP<T3>,\n    T4 | IAAP<T4>,\n    T5 | IAAP<T5>,\n    T6 | IAAP<T6>,\n    T7 | IAAP<T7>,\n    T8 | IAAP<T8>,\n    T9 | IAAP<T9>,\n    T10 | IAAP<T10>\n  ]\n): IAAP<[T1, T2, T3, T4, T5, T6, T7, T8, T9, T10]>;\nexport function abortAbleAll<T1, T2, T3, T4, T5, T6, T7, T8, T9>(\n  values: [\n    T1 | IAAP<T1>,\n    T2 | IAAP<T2>,\n    T3 | IAAP<T3>,\n    T4 | IAAP<T4>,\n    T5 | IAAP<T5>,\n    T6 | IAAP<T6>,\n    T7 | IAAP<T7>,\n    T8 | IAAP<T8>,\n    T9 | IAAP<T9>\n  ]\n): IAAP<[T1, T2, T3, T4, T5, T6, T7, T8, T9]>;\nexport function abortAbleAll<T1, T2, T3, T4, T5, T6, T7, T8>(\n  values: [\n    T1 | IAAP<T1>,\n    T2 | IAAP<T2>,\n    T3 | IAAP<T3>,\n    T4 | IAAP<T4>,\n    T5 | IAAP<T5>,\n    T6 | IAAP<T6>,\n    T7 | IAAP<T7>,\n    T8 | IAAP<T8>\n  ]\n): IAAP<[T1, T2, T3, T4, T5, T6, T7, T8]>;\nexport function abortAbleAll<T1, T2, T3, T4, T5, T6, T7>(\n  values: [T1 | IAAP<T1>, T2 | IAAP<T2>, T3 | IAAP<T3>, T4 | IAAP<T4>, T5 | IAAP<T5>, T6 | IAAP<T6>, T7 | IAAP<T7>]\n): IAAP<[T1, T2, T3, T4, T5, T6, T7]>;\nexport function abortAbleAll<T1, T2, T3, T4, T5, T6>(\n  values: [T1 | IAAP<T1>, T2 | IAAP<T2>, T3 | IAAP<T3>, T4 | IAAP<T4>, T5 | IAAP<T5>, T6 | IAAP<T6>]\n): IAAP<[T1, T2, T3, T4, T5, T6]>;\nexport function abortAbleAll<T1, T2, T3, T4, T5>(\n  values: [T1 | IAAP<T1>, T2 | IAAP<T2>, T3 | IAAP<T3>, T4 | IAAP<T4>, T5 | IAAP<T5>]\n): IAAP<[T1, T2, T3, T4, T5]>;\nexport function abortAbleAll<T1, T2, T3, T4>(\n  values: [T1 | IAAP<T1>, T2 | IAAP<T2>, T3 | IAAP<T3>, T4 | IAAP<T4>]\n): IAAP<[T1, T2, T3, T4]>;\nexport function abortAbleAll<T1, T2, T3>(values: [T1 | IAAP<T1>, T2 | IAAP<T2>, T3 | IAAP<T3>]): IAAP<[T1, T2, T3]>;\nexport function abortAbleAll<T1, T2>(values: [T1 | IAAP<T1>, T2 | IAAP<T2>]): IAAP<[T1, T2]>;\nexport function abortAbleAll<T>(values: (T | IAAP<T>)[]): IAAP<T[]>;\n\n/**\n * similar to Promise.all but for abortAble\n */\nexport function abortAbleAll(values: unknown[]): IAAP<unknown[]> {\n  const loader = Promise.all(values);\n  let aborted: ((v: symbol) => void) | null = null;\n  const isAborted = () => aborted === null;\n  const aborter = new Promise<symbol>((resolve) => {\n    aborted = resolve;\n  });\n  const abort = () => {\n    if (aborted == null) {\n      return;\n    }\n    aborted(ABORTED);\n    for (const v of values) {\n      if (isAbortAble(v)) {\n        v.abort();\n      }\n    }\n    aborted = null;\n  };\n  const race = Promise.race<unknown | symbol>([aborter, loader]);\n\n  return {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    then: thenFactory(race, isAborted, abort) as any,\n    abort,\n    isAborted,\n  };\n}\n\n/**\n * checked whether the given argument is an abortable Promise\n * @param {IAbortAblePromise<any> | any} candidate\n * @returns {boolean}\n */\nexport function isAbortAble<T = unknown>(candidate: IAbortAblePromise<T> | T): candidate is IAbortAblePromise<T> {\n  return (\n    candidate != null &&\n    candidate &&\n    typeof (candidate as IAbortAblePromise<unknown>).then === 'function' &&\n    typeof (candidate as IAbortAblePromise<unknown>).abort === 'function'\n  );\n}\n\nexport function isAsyncUpdate<T>(update: T | void | undefined | null | IAsyncUpdate<T>): update is IAsyncUpdate<T> {\n  return update !== undefined && update !== null && update && isAbortAble((update as IAsyncUpdate<T>).ready);\n}\n\n/**\n * similar to Promise.resolve\n */\nexport function abortAbleResolveNow<T>(value: T): IAAP<T> {\n  function then<TResult1 = T | symbol, TResult2 = never>(\n    onfulfilled?: ((value: T | symbol) => TResult1 | PromiseLike<TResult1>) | undefined | null,\n    _onrejected?: ((reason: unknown) => TResult2 | PromiseLike<TResult2>) | undefined | null\n  ): IAbortAblePromiseBase<TResult1 | TResult2> {\n    const res = onfulfilled ? onfulfilled(value) : (value as unknown);\n    if (isAbortAble(res)) {\n      return res as unknown as IAbortAblePromiseBase<TResult1 | TResult2>;\n    }\n    if (isPromiseLike(res)) {\n      return abortAble(res) as unknown as IAbortAblePromiseBase<TResult1 | TResult2>;\n    }\n    return {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      then: abortAbleResolveNow(res as TResult1) as any,\n      abort: () => undefined,\n      isAborted: () => false,\n    };\n  }\n  return {\n    then,\n    abort: () => undefined,\n    isAborted: () => false,\n  };\n}\n","import { IExceptionContext } from '../logic';\n\n/**\n * utility class for optimized row context access\n */\nexport default class KeyFinder {\n  private readonly cache: number[] = [];\n\n  private lastFilled = 0;\n\n  private readonly key2index = new Map<string, number>();\n\n  /**\n   * constructor for fast key based row access\n   * @param {IExceptionContext} context context to use\n   * @param {(rowIndex: number) => string} key key function\n   */\n  constructor(public readonly context: IExceptionContext, public readonly key: (rowIndex: number) => string) {\n    this.context.exceptions.forEach((e) => {\n      this.cache[e.index] = e.y;\n      this.key2index.set(key(e.index), e.index);\n    });\n  }\n\n  private findValidStart(before: number) {\n    for (let i = before - 1; i >= 0; i -= 1) {\n      if (this.cache[i] !== undefined) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  /**\n   * returns the position of the given given or -1 if not found\n   * @param {string} key\n   */\n  posByKey(key: string): { index: number; pos: number } {\n    const index = this.key2index.get(key);\n    if (index != null) {\n      return { index, pos: this.pos(index) };\n    }\n    return this.fillCacheTillKey(key);\n  }\n\n  /**\n   * returns the position of the given index\n   * @param {number} index index to look for\n   */\n  pos(index: number): number {\n    if (this.context.exceptions.length === 0) {\n      // fast pass\n      return index * this.context.defaultRowHeight;\n    }\n    const cached = this.cache[index];\n    if (cached !== undefined) {\n      return cached;\n    }\n    // need to compute it\n    // find the starting point where to start counting\n    const start = this.findValidStart(index);\n    if (start < 0) {\n      this.fillCache(0, index, 0);\n    } else {\n      this.fillCache(start + 1, index, this.cache[start] + this.heightOf(start));\n    }\n    return this.cache[index];\n  }\n\n  private fillCache(\n    first: number,\n    last: number,\n    offset: number,\n    callback?: (index: number, key: string, pos: number) => void\n  ) {\n    if (last <= this.lastFilled) {\n      // everything already there\n      if (!callback) {\n        return;\n      }\n      for (let i = first; i <= last; i += 1) {\n        callback(i, this.key(i), this.cache[i]);\n      }\n      return;\n    }\n    let pos = offset;\n    for (let i = first; i <= last; i += 1) {\n      this.cache[i] = pos;\n      const key = this.key(i);\n      this.key2index.set(key, i);\n      if (callback) {\n        callback(i, key, pos);\n      }\n      pos += this.heightOf(i);\n    }\n  }\n\n  /**\n   * returns the height of the row identified by index\n   * @param {number} index\n   */\n  heightOf(index: number): number {\n    const lookup = this.context.exceptionsLookup;\n    return lookup.get(index) ?? this.context.defaultRowHeight;\n  }\n\n  /**\n   * see heightOf but ignores padding and optional null in case of default height\n   * @param {number} index row index\n   * @param {boolean} returnDefault return null if default height\n   * @returns {number}\n   */\n  exceptionHeightOf(index: number, returnDefault?: boolean): number | null;\n  exceptionHeightOf(index: number, returnDefault: true): number;\n  exceptionHeightOf(index: number, returnDefault = false): number | null {\n    const padding = this.context.padding(index);\n    const lookup = this.context.exceptionsLookup;\n    const entry = lookup.get(index);\n    if (entry != null) {\n      return entry - padding;\n    }\n    return returnDefault ? this.context.defaultRowHeight - padding : null;\n  }\n\n  /**\n   * padding of the given index\n   * @param {number} index\n   * @returns {number}\n   */\n  padding(index: number): number {\n    return this.context.padding(index);\n  }\n\n  private fillCacheTillKey(target: string) {\n    let pos = 0;\n    for (let i = this.lastFilled; i < this.context.numberOfRows; i += 1, this.lastFilled += 1) {\n      const c = this.cache[i];\n      if (c !== undefined) {\n        pos = c + this.heightOf(i);\n        continue;\n      }\n      // new one fill up\n      const key = this.key(i);\n      this.cache[i] = pos;\n      this.key2index.set(key, i);\n      if (key === target) {\n        return { index: i, pos };\n      }\n      pos += this.heightOf(i);\n    }\n    return { index: -1, pos: -1 };\n  }\n\n  /**\n   * computes the positions and keys for a range of given indices\n   * @param {number} first first row index\n   * @param {number} last last row index\n   * @param {number} offset pos offset for the first row index\n   * @param {(index: number, key: string, pos: number) => void} callback callback for each identified index\n   */\n  positions(\n    first: number,\n    last: number,\n    offset: number,\n    callback?: (index: number, key: string, pos: number) => void\n  ): void {\n    this.fillCache(first, last, offset, callback);\n  }\n}\n","import { IExceptionContext } from '../logic';\nimport KeyFinder from './KeyFinder';\n\nexport { default as KeyFinder } from './KeyFinder';\n\n/**\n * different row animation modes\n */\nexport enum EAnimationMode {\n  /**\n   * plain update existed both before and after\n   */\n  UPDATE,\n  /**\n   * exists both before and after but wasn't visible yet thus was created\n   */\n  UPDATE_CREATE,\n  /**\n   * exists both before and after is visible but not needed anymore and thus removed\n   */\n  UPDATE_REMOVE,\n  /**\n   * row appears\n   */\n  SHOW,\n  /**\n   * row disappears\n   */\n  HIDE,\n}\n\n/**\n * animated row item\n */\nexport interface IAnimationItem {\n  mode: EAnimationMode;\n  node: HTMLElement;\n  key: string;\n\n  /**\n   * previous context information\n   */\n  previous: {\n    index: number | -1;\n    y: number;\n    height: number | null;\n  };\n\n  /**\n   * position of the added node considering the previous height\n   */\n  nodeY: number;\n  /**\n   * position of the added node considering the current height\n   */\n  nodeYCurrentHeight: number;\n\n  /**\n   * current position\n   */\n  current: {\n    index: number | -1;\n    y: number;\n    height: number | null;\n  };\n}\n\nconst NO_CHANGE_DELTA = 1;\n\nexport function noAnimationChange(\n  { previous, mode, nodeY, current }: IAnimationItem,\n  previousHeight: number,\n  currentHeight: number\n): boolean {\n  // sounds like the same\n  const prev = previous.height == null ? previousHeight : previous.height;\n  const curr = current.height == null ? currentHeight : current.height;\n  return (\n    mode === EAnimationMode.UPDATE &&\n    Math.abs(previous.y - nodeY) <= NO_CHANGE_DELTA &&\n    Math.abs(prev - curr) <= NO_CHANGE_DELTA\n  );\n}\n\nexport interface IPhase {\n  readonly delay: number;\n\n  apply(item: Readonly<IAnimationItem>, previousFinder: KeyFinder, currentFinder: KeyFinder): void;\n}\n\nexport interface IAnimationContext {\n  readonly previous: IExceptionContext;\n\n  previousKey(previousRowIndex: number): string;\n\n  currentKey(currentRowIndex: number): string;\n\n  phases?: IPhase[];\n}\n\n/**\n * maximal duration of all animations + extra waiting before e.g. rows are really removed\n * @type {number}\n */\nconst MAX_ANIMATION_TIME = 1100;\n\nexport const defaultPhases = [\n  {\n    delay: 0, // before\n    apply({ mode, previous, nodeY, current, node }: Readonly<IAnimationItem>): void {\n      const actNode = node;\n      actNode.dataset.animation = EAnimationMode[mode].toLowerCase();\n      actNode.style.transform = `translate(0, ${previous.y - nodeY}px)`;\n      if (mode === EAnimationMode.SHOW) {\n        // already target height\n        actNode.style.height = current.height !== null ? `${current.height}px` : '';\n      } else {\n        // always set previous height for default height changes\n        actNode.style.height = `${previous.height}px`;\n      }\n      if (mode === EAnimationMode.SHOW) {\n        actNode.style.opacity = '0';\n      } else if (mode === EAnimationMode.HIDE) {\n        actNode.style.opacity = '1';\n      } else {\n        actNode.style.opacity = '';\n      }\n    },\n  },\n  {\n    delay: 10, // after some delay for the before phase have been applied visually\n    apply({ mode, current, nodeY, node }: Readonly<IAnimationItem>): void {\n      const actNode = node;\n      // null for added/update since already at the right position\n      actNode.style.transform =\n        mode === EAnimationMode.HIDE || mode === EAnimationMode.UPDATE_REMOVE\n          ? `translate(0, ${current.y - nodeY}px)`\n          : '';\n      if (mode !== EAnimationMode.HIDE) {\n        // keep height for removal\n        actNode.style.height = current.height !== null ? `${current.height}px` : '';\n      }\n      if (mode === EAnimationMode.SHOW) {\n        actNode.style.opacity = '1';\n      } else if (mode === EAnimationMode.HIDE) {\n        actNode.style.opacity = '0';\n      } else {\n        actNode.style.opacity = '';\n      }\n    },\n  },\n  {\n    delay: MAX_ANIMATION_TIME, // cleanup\n    apply({ node }: Readonly<IAnimationItem>): void {\n      const actNode = node;\n      delete actNode.dataset.animation;\n      actNode.style.opacity = '';\n      actNode.style.transform = '';\n    },\n  },\n];\n","export * from './scroll';\n\n/**\n * clear node clearing\n * @param node\n * @internal\n */\nexport function clear<T extends Node>(node: T): T {\n  while (node.lastChild) {\n    node.removeChild(node.lastChild);\n  }\n  return node;\n}\n","/* eslint-disable no-underscore-dangle */\nexport declare type IDelayedMode = number | 'animation' | 'sync';\n\nexport const defaultMode: IDelayedMode = 'animation'; // Boolean((<any>window).chrome) ? 'animation' : 0, // animation frame on chrome;\n\nexport interface IScrollInfo {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n}\n\ninterface IScrollHandler {\n  timer: number;\n  prev: IScrollInfo | null;\n  handler: ((act: IScrollInfo) => void)[];\n}\n\nfunction dummy(): IScrollHandler {\n  return {\n    handler: [],\n    prev: null,\n    timer: -1,\n  };\n}\n\nclass ScrollHandler {\n  private readonly sync = dummy();\n\n  private readonly animation = dummy();\n\n  private readonly numbers = new Map<number, IScrollHandler>();\n\n  // current: IScrollInfo;\n  // private prev: IScrollInfo | null = null;\n\n  get current() {\n    return this.asInfo();\n  }\n\n  constructor(private readonly node: HTMLElement) {\n    // this.current = this.asInfo();\n\n    node.addEventListener(\n      'scroll',\n      () => {\n        // this.current = this.asInfo();\n\n        // if (this.prev && (Math.abs(this.current.left - this.prev.left) + Math.abs(this.current.top - this.prev.top)) < 4) {\n        //   return;\n        // }\n        // this.prev = this.current;\n\n        if (this.sync.handler.length > 0) {\n          this.handle(this.sync);\n        }\n        this.handleAnimation();\n        this.handleTimeouts();\n      },\n      {\n        passive: true,\n      }\n    );\n  }\n\n  private handle(handler: IScrollHandler) {\n    const info = this.current;\n    if (handler.prev && Math.abs(info.left - handler.prev.left) + Math.abs(info.top - handler.prev.top) < 4) {\n      return;\n    }\n    // eslint-disable-next-line no-param-reassign\n    handler.prev = info;\n    for (const s of handler.handler) {\n      s(info);\n    }\n  }\n\n  private handleAnimation() {\n    if (this.animation.timer !== -1 || this.animation.handler.length === 0) {\n      return;\n    }\n    this.animation.timer = 1;\n    requestAnimationFrame(this.handleAnimationImpl);\n  }\n\n  private readonly handleAnimationImpl = () => {\n    if (this.animation.timer !== 1) {\n      return;\n    }\n    this.handle(this.animation);\n    this.animation.timer = -1;\n  };\n\n  private handleTimeouts() {\n    if (this.numbers.size === 0) {\n      return;\n    }\n\n    this.numbers.forEach((handler, n) => {\n      if (handler.handler.length === 0) {\n        return;\n      }\n      // eslint-disable-next-line no-param-reassign, no-restricted-globals\n      handler.timer = self.setTimeout(() => {\n        this.handle(handler);\n        // eslint-disable-next-line no-param-reassign\n        handler.timer = -1;\n      }, n);\n    });\n  }\n\n  asInfo(): IScrollInfo {\n    return {\n      left: this.node.scrollLeft,\n      top: this.node.scrollTop,\n      width: this.node.clientWidth,\n      height: this.node.clientHeight,\n    };\n  }\n\n  push(mode: IDelayedMode, handler: (act: IScrollInfo) => void) {\n    if (typeof mode === 'number') {\n      const entry = this.numbers.get(mode) ?? dummy();\n      entry.handler.push(handler);\n      this.numbers.set(mode, entry);\n    }\n\n    switch (mode) {\n      case 'sync':\n        this.sync.handler.push(handler);\n        break;\n      case 'animation':\n        this.animation.handler.push(handler);\n        break;\n    }\n  }\n\n  remove(handler: (act: IScrollInfo) => void) {\n    const test = [this.sync, this.animation].concat(Array.from(this.numbers.values()));\n\n    return test.some((d) => {\n      const index = d.handler.indexOf(handler);\n      if (index >= 0) {\n        d.handler.splice(index, 1);\n      }\n      return index >= 0;\n    });\n  }\n\n  isWaiting(mode: IDelayedMode) {\n    switch (mode) {\n      case 'animation':\n        return this.animation.timer >= 0;\n      case 'sync':\n        return false;\n      default:\n        return (this.numbers.get(mode)?.timer ?? -1) >= 0;\n    }\n  }\n}\n\n/**\n * @internal\n */\nexport function addScroll(\n  scrollElement: HTMLElement,\n  mode: IDelayedMode,\n  handler: (act: IScrollInfo) => void\n): IScrollInfo {\n  // hide in element to have just one real listener\n  const c = scrollElement as HTMLElement & { __le_scroller__?: ScrollHandler };\n  if (!c.__le_scroller__) {\n    c.__le_scroller__ = new ScrollHandler(scrollElement);\n  }\n  const s: ScrollHandler = c.__le_scroller__;\n  s.push(mode, handler);\n  return s.asInfo();\n}\n\n/**\n * @internal\n */\nexport function isScrollEventWaiting(scroller: HTMLElement, mode: IDelayedMode): boolean {\n  const c = scroller as HTMLElement & { __le_scroller__?: ScrollHandler };\n  if (!c.__le_scroller__) {\n    return false;\n  }\n  const s: ScrollHandler = c.__le_scroller__;\n  return s.isWaiting(mode);\n}\n\n/**\n * @internal\n */\nexport function removeScroll(scroller: HTMLElement, handler: (act: IScrollInfo) => void): void {\n  const c = scroller as HTMLElement & { __le_scroller__?: ScrollHandler };\n  if (c.__le_scroller__) {\n    c.__le_scroller__.remove(handler);\n  }\n}\n","/**\n * generic exception of a uniform space\n */\nexport interface IRowHeightException {\n  /**\n   * reference index\n   */\n  readonly index: number;\n  /**\n   * height of the element\n   */\n  readonly height: number;\n  /**\n   * starting y\n   */\n  readonly y: number;\n  /**\n   * ending y\n   */\n  readonly y2: number;\n}\n\nclass RowHeightException implements IRowHeightException {\n  constructor(public readonly index: number, public readonly y: number, public readonly height: number) {}\n\n  get y2() {\n    return this.y + this.height;\n  }\n}\n\n/**\n * similar to a map\n */\nexport interface IRowHeightExceptionLookup {\n  keys(): IterableIterator<number>;\n\n  get(index: number): number | undefined;\n\n  has(index: number): boolean;\n\n  readonly size: number;\n}\n\n/**\n * exception context for optimized non uniform height exceptions\n */\nexport interface IExceptionContext {\n  /**\n   * height exceptions as a list\n   */\n  readonly exceptions: IRowHeightException[];\n  /**\n   * lookup for the height of a given index, if not part of this map it has the default height\n   */\n  readonly exceptionsLookup: IRowHeightExceptionLookup;\n  /**\n   * number of rows\n   */\n  readonly numberOfRows: number;\n  /**\n   * default height of rows\n   */\n  readonly defaultRowHeight: number;\n  /**\n   * total height\n   */\n  readonly totalHeight: number;\n\n  /**\n   * padding between rows, however already included in all heights to have the precise numbers\n   */\n  readonly padding: (index: number) => number;\n}\n\n/**\n * creates a uniform exception context, i.e no exceptions all rows are of the same height\n * @param {number} numberOfRows\n * @param {number} currentRowHeight\n * @param {number} rowPadding padding between rows\n * @return {IExceptionContext}\n */\nexport function uniformContext(numberOfRows: number, rowHeight: number, rowPadding = 0): IExceptionContext {\n  const currentRowHeight = rowHeight + rowPadding;\n  const exceptionsLookup = {\n    keys: () => [].values(),\n    get: () => currentRowHeight,\n    has: () => false,\n    size: 0,\n  };\n  return {\n    exceptions: [],\n    exceptionsLookup,\n    totalHeight: numberOfRows * currentRowHeight,\n    numberOfRows,\n    defaultRowHeight: currentRowHeight,\n    padding: () => rowPadding,\n  };\n}\n\n/**\n * computes the most frequent value in a given array like\n * @param {} values\n * @return {number}\n */\nfunction mostFrequentValue(values: { forEach: (callback: (height: number, index: number) => void) => void }): number {\n  const lookup = new Map<number, number>();\n  values.forEach((value) => {\n    lookup.set(value, (lookup.get(value) || 0) + 1);\n  });\n  if (lookup.size === 0) {\n    return 20; // default value since it doesn't matter\n  }\n  // sort desc take first key and asc by the second in case of tie, it is optimized to have exceptions for higher rows less for big rows\n  const sorted = Array.from(lookup).sort((a, b) => {\n    if (a[1] !== b[1]) {\n      return b[1] - a[1];\n    }\n    return a[0] - b[0];\n  });\n  const mostFrequent = sorted[0][0];\n  if (mostFrequent === 0) {\n    // corner case\n    return sorted.length > 1 ? sorted[1][0] : 20; // all empty\n  }\n  return mostFrequent;\n}\n\n/**\n * creates a non uniform context based on the given array like heights\n * @param rowHeights array like to get the heights\n * @param {number} defaultRowHeight if not given the most frequent value will be used\n * @param {number} rowPadding padding between rows\n * @return {IExceptionContext}\n */\nexport function nonUniformContext(\n  rowHeights: {\n    forEach: (callback: (height: number, index: number) => void) => void;\n  },\n  defaultRowHeight = Number.NaN,\n  rowPadding: number | ((index: number) => number) = 0\n): IExceptionContext {\n  const exceptionsLookup = new Map<number, number>();\n  const exceptions: IRowHeightException[] = [];\n\n  const padding = typeof rowPadding === 'function' ? rowPadding : () => rowPadding as number;\n\n  let actualDefaultRowHeight = defaultRowHeight;\n  if (Number.isNaN(actualDefaultRowHeight)) {\n    actualDefaultRowHeight = mostFrequentValue(rowHeights);\n  }\n\n  actualDefaultRowHeight += padding(-1);\n\n  let prev = -1;\n  let acc = 0;\n  let totalHeight = 0;\n  let numberOfRows = 0;\n  rowHeights.forEach((height, index) => {\n    const paddedHeight = height + padding(index);\n    totalHeight += paddedHeight;\n    numberOfRows += 1;\n    if (paddedHeight === actualDefaultRowHeight) {\n      // regular\n      return;\n    }\n    exceptionsLookup.set(index, paddedHeight);\n    const between = (index - prev - 1) * actualDefaultRowHeight;\n    prev = index;\n    const y = acc + between;\n    acc = y + paddedHeight;\n    exceptions.push(new RowHeightException(index, y, paddedHeight));\n  });\n  return {\n    exceptionsLookup,\n    exceptions,\n    totalHeight,\n    defaultRowHeight: actualDefaultRowHeight,\n    numberOfRows,\n    padding,\n  };\n}\n\n/**\n * creates a random context with the given constraints\n * @param {number} numberOfRows\n * @param {number} defaultRowHeight\n * @param {number} minRowHeight\n * @param {number} maxRowHeight\n * @param {number} ratio around ratio percent will get a non uniform height\n * @param {number} seed random seed\n * @return {IExceptionContext}\n */\nexport function randomContext(\n  numberOfRows: number,\n  defaultRowHeight: number,\n  minRowHeight = 2,\n  maxRowHeight = defaultRowHeight * 10,\n  ratio = 0.2,\n  seed = Date.now()\n): IExceptionContext {\n  let actSeed = seed;\n  const random = () => {\n    const x = Math.sin(actSeed) * 10000;\n    actSeed += 1;\n    return x - Math.floor(x);\n  };\n\n  const getter = () => {\n    const coin = random();\n    if (coin < ratio) {\n      // non uniform\n      return minRowHeight + Math.round(random() * (maxRowHeight - minRowHeight));\n    }\n    return defaultRowHeight;\n  };\n  const forEach = (callback: (height: number, index: number) => void) => {\n    for (let index = 0; index < numberOfRows; index += 1) {\n      callback(getter(), index);\n    }\n  };\n  return nonUniformContext({ forEach }, defaultRowHeight);\n}\n\nexport interface IVisibleRange {\n  /**\n   * first visible index\n   */\n  readonly first: number;\n  /**\n   * last visible index\n   */\n  readonly last: number;\n  /**\n   * position of the first visible row in pixel\n   */\n  readonly firstRowPos: number;\n  /**\n   * position of the last visible row including its size\n   */\n  readonly endPos: number;\n}\n\n/**\n * computes the visible range\n * @param {number} scrollTop top scrolling\n * @param {number} clientHeight visible height\n * @param {number} rowHeight height of a row by default\n * @param {IRowHeightException[]} heightExceptions exceptions of this default height\n * @param {number} numberOfRows the number of rows\n * @return {IVisibleRange} the computed visible range\n */\nexport function range(\n  scrollTop: number,\n  clientHeight: number,\n  rowHeight: number,\n  heightExceptions: IRowHeightException[],\n  numberOfRows: number\n): IVisibleRange {\n  if (numberOfRows === 0) {\n    return { first: 0, last: -1, firstRowPos: 0, endPos: 0 };\n  }\n  if (numberOfRows === 1) {\n    return {\n      first: 0,\n      last: 0,\n      firstRowPos: 0,\n      endPos: heightExceptions.length === 0 ? rowHeight : heightExceptions[0].y2,\n    };\n  }\n  const offset = scrollTop;\n  const offset2 = offset + clientHeight;\n\n  function indexOf(pos: number, indexShift: number) {\n    return Math.min(numberOfRows - 1, indexShift + Math.max(0, Math.floor(pos / rowHeight)));\n  }\n\n  function calc(offsetShift: number, indexShift: number) {\n    const shifted = offset - offsetShift;\n    const shifted2 = offset2 - offsetShift;\n\n    const first = indexOf(shifted, indexShift);\n    const last = indexOf(shifted2, indexShift);\n\n    const firstRowPos = offsetShift + (first - indexShift) * rowHeight;\n    const endPos = offsetShift + (last + 1 - indexShift) * rowHeight;\n\n    // if (!isGuess) {\n    //  console.log(first, '@', firstRowPos, last, '#', end, offset, offset2, firstRowPos <= offset, offset2 <= end);\n    // }\n    // console.assert(\n    //   !isGuess || !(firstRowPos > offset || (endPos < offset2 && last < numberOfRows - 1)),\n    //   'error',\n    //   isGuess,\n    //   firstRowPos,\n    //   endPos,\n    //   offset,\n    //   offset2,\n    //   indexShift,\n    //   offsetShift\n    // );\n    return { first, last, firstRowPos, endPos };\n  }\n\n  const r = calc(0, 0);\n  if (heightExceptions.length === 0) {\n    // uniform\n    return r;\n  }\n  if (r.last < heightExceptions[0].index) {\n    // console.log('before the first exception = uniform with no shift');\n    // console.log(r.first, '@', r.firstRowPos, r.last, '#', r.end, offset, offset2, r.firstRowPos <= offset, offset2 <= r.end);\n    return r;\n  }\n  if (r.last === heightExceptions[0].index && heightExceptions[0].height > rowHeight) {\n    return Object.assign(r, { endPos: heightExceptions[0].y2 });\n  }\n\n  // the position where the exceptions ends\n  const lastPos = heightExceptions[heightExceptions.length - 1];\n  if (offset >= lastPos.y) {\n    const rest = calc(lastPos.y2, lastPos.index + 1);\n    if (offset < lastPos.y2) {\n      // include me\n      return Object.assign(rest, {\n        first: lastPos.index,\n        firstRowPos: lastPos.y,\n      });\n    }\n    return rest;\n  }\n  // we have some exceptions\n  const visible: IRowHeightException[] = [];\n  let closest = heightExceptions[0]; // closest before not in range\n  for (const item of heightExceptions) {\n    const { y, y2 } = item;\n    if (y >= offset2) {\n      break;\n    }\n    if (y2 <= offset) {\n      closest = item;\n      continue;\n    }\n    visible.push(item);\n  }\n\n  if (visible.length === 0) {\n    // console.log('we are in the between some exceptions and none are visible');\n    return calc(closest.y2, closest.index + 1); // skip myself\n  }\n\n  {\n    // console.log('we show at least one exception');\n    const firstException = visible[0];\n    const lastException = visible[visible.length - 1];\n\n    const first = Math.max(0, firstException.index - Math.max(0, Math.ceil((firstException.y - offset) / rowHeight)));\n    let last = lastException.index;\n    if (offset2 >= lastException.y2) {\n      last = indexOf(offset2 - lastException.y2, lastException.index + 1);\n    }\n    const firstRowPos = firstException.y - (firstException.index - first) * rowHeight;\n    const endPos = lastException.y2 + (last - lastException.index) * rowHeight;\n\n    // console.log(first, '@', firstRowPos, last, '#', end, offset, offset2, firstRowPos <= offset, offset2 <= end);\n\n    // console.assert(\n    //   firstRowPos <= offset && (endPos >= offset2 || last === numberOfRows - 1),\n    //   'error',\n    //   firstRowPos,\n    //   endPos,\n    //   offset,\n    //   offset2,\n    //   firstException,\n    //   lastException\n    // );\n    return { first, last, firstRowPos, endPos };\n  }\n}\n\nexport function frozenDelta(\n  current: number[],\n  target: number[]\n): { added: number[]; removed: number[]; common: number } {\n  const currentLength = current.length;\n  const targetLength = target.length;\n  if (currentLength === 0) {\n    return { added: target, removed: [], common: 0 };\n  }\n  if (targetLength === 0) {\n    return { added: [], removed: current, common: 0 };\n  }\n  if (currentLength === targetLength) {\n    // since sorted and left increasing true\n    return { added: [], removed: [], common: currentLength };\n  }\n  const removed = current.slice(Math.min(targetLength, currentLength));\n  const added = target.slice(Math.min(targetLength, currentLength));\n  return { added, removed, common: currentLength - removed.length };\n}\n\nexport function updateFrozen(\n  old: number[],\n  columns: { frozen: boolean }[],\n  first: number\n): { target: number[]; added: number[]; removed: number[] } {\n  const oldLast = old.length === 0 ? 0 : old[old.length - 1] + 1;\n  const added: number[] = [];\n  const removed: number[] = [];\n\n  for (let i = old.length - 1; i >= 0; i -= 1) {\n    const index = old[i];\n    if (index >= first) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      removed.push(old.pop()!);\n    } else {\n      // can stop since sorted and it will never happen again\n      break;\n    }\n  }\n  // added\n  for (let i = oldLast; i < first; i += 1) {\n    if (columns[i].frozen) {\n      added.push(i);\n      old.push(i);\n    }\n  }\n  return { target: old, added, removed };\n}\n","import type { IExceptionContext } from '../logic';\n\n/**\n * scrolling result\n */\nexport enum EScrollResult {\n  /**\n   * nothing has changed\n   */\n  NONE,\n  /**\n   * all rows needed to be recreated\n   */\n  ALL,\n  /**\n   * unknown\n   */\n  SOME,\n  /**\n   * some rows are added at the bottom\n   */\n  SOME_BOTTOM,\n  /**\n   * some rows are added at the top\n   */\n  SOME_TOP,\n}\n\n/**\n * adapter context for mixins to avoid public fields\n */\nexport interface IMixinAdapter {\n  readonly visible: {\n    // writable\n    first: number;\n    last: number;\n    forcedFirst: number;\n    forcedLast: number;\n  };\n  readonly visibleFirstRowPos: number;\n\n  readonly context: IExceptionContext;\n  readonly scrollOffset: number;\n  readonly scrollTotal: number;\n\n  addAtBeginning(from: number, to: number, frozenShift: number): void;\n\n  addAtBottom(from: number, to: number): void;\n\n  removeFromBeginning(from: number, to: number, frozenShift: number): void;\n\n  removeFromBottom(from: number, to: number): void;\n\n  updateOffset(firstRowPos: number): void;\n\n  /**\n   * triggers to sync frozen items\n   * @param {number} first\n   * @return {number} frozenShift\n   */\n  syncFrozen?(first: number): number;\n\n  isScrollEventWaiting(): boolean;\n}\n\nexport interface IMixin {\n  onScrolled(isGoingDown: boolean, scrollResult: EScrollResult): void;\n}\n\nexport interface IMixinClass {\n  new (adapter: IMixinAdapter, options?: unknown): IMixin;\n}\n","const PREFIX = 'le';\n\n/**\n * @internal\n * @param suffix suffix to suffix\n */\nexport function cssClass(suffix?: string): string {\n  if (!suffix) {\n    return PREFIX;\n  }\n  return `${PREFIX}-${suffix}`;\n}\n\nexport const CSS_CLASS_LOADING = cssClass('loading');\nexport const CSS_CLASS_FROZEN = cssClass('frozen');\nexport const CSS_CLASS_HIDDEN = cssClass('hidden');\nexport const CSS_CLASS_MULTI = cssClass('multi');\nexport const CSS_CLASS_EVEN = cssClass('even');\nexport const CSS_CLASS_SHIFTED = cssClass('shifted');\nexport const CSS_CLASS_SCROLLBAR_TESTER = cssClass('scrollbar-tester');\n\nexport const CSS_CLASS_HEADER = cssClass('header');\nexport const CSS_CLASS_BODY = cssClass('body');\nexport const CSS_CLASS_FOOTER = cssClass('footer');\n\nexport const CSS_CLASS_THEAD = cssClass('thead');\nexport const CSS_CLASS_TBODY = cssClass('tbody');\n\nexport const CSS_CLASS_TR = cssClass('tr');\nexport const CSS_CLASS_TH = cssClass('th');\nexport const CSS_CLASS_TD = cssClass('td');\n\nexport const CSS_CLASS_SCROLLING = cssClass('scrolling');\nexport const CSS_CLASS_ROW_ANIMATION = cssClass('row-animation');\n","import { ABORTED, IAbortAblePromise, isAbortAble } from './abortAble';\nimport {\n  defaultPhases,\n  EAnimationMode,\n  IAnimationContext,\n  IAnimationItem,\n  IPhase,\n  noAnimationChange,\n} from './animation';\nimport KeyFinder from './animation/KeyFinder';\nimport { addScroll, clear, defaultMode, IDelayedMode, IScrollInfo, removeScroll } from './internal';\nimport { isScrollEventWaiting } from './internal/scroll';\nimport { IExceptionContext, range } from './logic';\nimport { EScrollResult, IMixin, IMixinAdapter, IMixinClass } from './mixin';\nimport {\n  cssClass,\n  CSS_CLASS_EVEN,\n  CSS_CLASS_FOOTER,\n  CSS_CLASS_LOADING,\n  CSS_CLASS_ROW_ANIMATION,\n  CSS_CLASS_SCROLLING,\n  CSS_CLASS_TR,\n} from './styles';\n\nexport declare type IRowRenderContext = IExceptionContext;\n\nexport function isLoadingCell(node: HTMLElement): boolean {\n  return node.classList.contains(CSS_CLASS_LOADING);\n}\n\nexport interface IRowRendererOptions {\n  /**\n   * async update on scrolling\n   * animation -> use requestAnimationFrame\n   * sync -> execute within scroll listener\n   * {number} -> execute within this delay using setTimeout\n   * @default is chrome ? animation else 0\n   */\n  async: IDelayedMode;\n\n  /**\n   * minimal number of pixel the scrollbars has to move\n   * @default 10\n   */\n  minScrollDelta: number;\n\n  /**\n   * min number of rows that should be added or removed\n   * @default 10\n   */\n  batchSize: number;\n\n  /**\n   * number of pixels the viewport is virtually larger\n   * @default 200\n   */\n  viewportOversize: number;\n\n  /**\n   * class of mixins to use for optimized rendering\n   */\n  mixins: IMixinClass[];\n\n  /**\n   * add the scrolling hint class while scrolling to give a user feedback\n   */\n  scrollingHint: boolean;\n\n  /**\n   * whether background striping should be enabled\n   */\n  striped: boolean;\n}\n\n/**\n * base class for creating a scalable table renderer based on rows\n */\nexport abstract class ARowRenderer {\n  private readonly pool: HTMLElement[] = [];\n\n  private readonly loadingPool: HTMLElement[] = [];\n\n  private readonly loading = new WeakMap<HTMLElement, IAbortAblePromise<void>>();\n\n  private readonly fragment: DocumentFragment;\n\n  /**\n   * currently visible slice\n   */\n  protected readonly visible = {\n    first: 0,\n    forcedFirst: 0,\n    last: -1,\n    forcedLast: -1,\n  };\n\n  /**\n   * position of the first visible row in pixel\n   * @type {number}\n   */\n  protected visibleFirstRowPos = 0;\n\n  private readonly adapter: IMixinAdapter;\n\n  private readonly mixins: IMixin[];\n\n  private scrollListener: ((act: IScrollInfo) => void) | null = null;\n\n  protected lastScrollInfo: IScrollInfo | null = null;\n\n  private abortAnimation: () => void = () => undefined;\n\n  protected readonly options: Readonly<IRowRendererOptions> = {\n    async: defaultMode,\n    minScrollDelta: 10,\n    mixins: [],\n    scrollingHint: false,\n    batchSize: 10,\n    striped: false,\n    viewportOversize: 200,\n  };\n\n  constructor(protected readonly body: HTMLElement, options: Partial<IRowRendererOptions> = {}) {\n    this.adapter = this.createAdapter();\n    Object.assign(this.options, options);\n    this.mixins = this.options.mixins.map((MixinClass) => new MixinClass(this.adapter));\n\n    this.fragment = body.ownerDocument.createDocumentFragment();\n  }\n\n  protected abstract get idPrefix(): string;\n\n  /**\n   * register another mixin to this renderer\n   * @param {IMixinClass} MixinClass the mixin class to instantiate\n   * @param options optional constructor options\n   */\n  protected addMixin(MixinClass: IMixinClass, options?: unknown): void {\n    this.mixins.push(new MixinClass(this.adapter, options));\n  }\n\n  private createAdapter(): IMixinAdapter {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    return {\n      visible: this.visible,\n      addAtBeginning: (from, to) => this.addAtBeginning(from, to),\n      addAtBottom: this.addAtBottom.bind(this),\n      removeFromBeginning: (from, to) => this.removeFromBeginning(from, to),\n      removeFromBottom: this.removeFromBottom.bind(this),\n      updateOffset: this.updateOffset.bind(this),\n      isScrollEventWaiting: () => isScrollEventWaiting(this.bodyScroller, this.options.async),\n      get visibleFirstRowPos() {\n        return that.visibleFirstRowPos;\n      },\n      get context() {\n        return that.context;\n      },\n      get scrollOffset() {\n        return that.lastScrollInfo ? that.lastScrollInfo.top : 0;\n      },\n      get scrollTotal() {\n        return that.lastScrollInfo ? that.lastScrollInfo.height : that.bodyScroller.clientHeight;\n      },\n    };\n  }\n\n  /**\n   * get the scrolling container i.e. parent of the body element\n   * @returns {HTMLElement}\n   */\n  protected get bodyScroller(): HTMLElement {\n    return this.body.parentElement as HTMLElement;\n  }\n\n  protected get bodySizer(): HTMLElement {\n    const parent = this.bodyScroller;\n    const sizer = (Array.from(parent.children) as HTMLElement[]).find((d) => d.tagName.toLowerCase() === 'footer');\n    if (sizer) {\n      return sizer;\n    }\n    const s = parent.ownerDocument.createElement('footer');\n    s.classList.add(CSS_CLASS_FOOTER, cssClass(`footer-${this.idPrefix}`));\n    parent.insertBefore(s, parent.firstChild);\n    return s;\n  }\n\n  /**\n   * the current render context, upon change `recreate` the whole table\n   * @returns {IRowRenderContext}\n   */\n  protected abstract get context(): IRowRenderContext;\n\n  /**\n   * creates a new row\n   * @param {HTMLElement} node the node of the row\n   * @param {number} index the row index\n   * @returns {IAbortAblePromise<void> | void} either an abortable or nothing\n   */\n  protected abstract createRow(node: HTMLElement, index: number): IAbortAblePromise<void> | void;\n\n  /**\n   * updates a row\n   * @param {HTMLElement} node the node of the row\n   * @param {number} index the row index\n   * @returns {IAbortAblePromise<void> | void} either an abortable or nothing\n   */\n  protected abstract updateRow(node: HTMLElement, index: number): IAbortAblePromise<void> | void;\n\n  /**\n   * initializes the table and register the onscroll listener\n   * @returns {void} nothing\n   */\n  protected init(): void {\n    const scroller = this.bodyScroller;\n\n    let old = addScroll(\n      scroller,\n      this.options.async,\n      (this.scrollListener = (act) => {\n        this.lastScrollInfo = act;\n        if (\n          Math.abs(old.top - act.top) < this.options.minScrollDelta &&\n          Math.abs(old.height - act.height) < this.options.minScrollDelta\n        ) {\n          return;\n        }\n        const isGoingDown = act.top > old.top;\n        old = act;\n        this.onScrolledVertically(act.top, act.height, isGoingDown);\n        if (this.options.scrollingHint) {\n          this.body.classList.remove(CSS_CLASS_SCROLLING);\n        }\n      })\n    );\n    if (this.options.scrollingHint) {\n      addScroll(scroller, 'animation', () => this.body.classList.add(CSS_CLASS_SCROLLING));\n    }\n    this.recreate();\n  }\n\n  /**\n   * destroys this renderer and unregisters all event listeners\n   */\n  destroy(): void {\n    if (this.scrollListener) {\n      removeScroll(this.bodyScroller, this.scrollListener);\n    }\n    this.body.remove();\n  }\n\n  private static cleanUp(item: HTMLElement) {\n    // eslint-disable-next-line no-param-reassign\n    item.style.height = '';\n  }\n\n  private select(index: number): { item: HTMLElement; result: IAbortAblePromise<void> | void } {\n    let item: HTMLElement | undefined = this.pool.pop();\n    let result: IAbortAblePromise<void> | void;\n    if (item != null) {\n      result = this.updateRow(item, index);\n    } else {\n      item = this.loadingPool.pop();\n      if (item != null) {\n        item.classList.remove(CSS_CLASS_LOADING);\n        result = this.createRow(item, index);\n      } else {\n        item = this.body.ownerDocument.createElement('div');\n        item.classList.add(CSS_CLASS_TR, cssClass(`tr-${this.idPrefix}`));\n        result = this.createRow(item, index);\n      }\n    }\n    item.dataset.index = String(index);\n    if (this.options.striped) {\n      item.classList.toggle(CSS_CLASS_EVEN, index % 2 === 0);\n    }\n    return { item, result };\n  }\n\n  private selectProxy() {\n    let proxy = this.loadingPool.pop();\n    if (proxy == null) {\n      proxy = this.body.ownerDocument.createElement('div');\n      proxy.classList.add(CSS_CLASS_LOADING, CSS_CLASS_TR, cssClass(`tr-${this.idPrefix}`));\n    }\n    return proxy;\n  }\n\n  private recycle(item: HTMLElement) {\n    ARowRenderer.cleanUp(item);\n    // check if the original dom element is still being manipulated\n    const abort = this.loading.get(item);\n    if (abort != null) {\n      abort.abort();\n    } else {\n      this.pool.push(item);\n    }\n  }\n\n  private proxy(item: HTMLElement, result: IAbortAblePromise<void> | void) {\n    if (!isAbortAble(result)) {\n      return item;\n    }\n    const abort = result;\n    // lazy loading\n\n    const real = item;\n    const proxy = this.selectProxy();\n    // copy attributes\n    proxy.dataset.index = real.dataset.index;\n    proxy.style.height = real.style.height;\n\n    this.loading.set(proxy, abort);\n    abort.then(\n      (abortResult) => {\n        if (abortResult === ABORTED) {\n          // aborted can recycle the real one\n          ARowRenderer.cleanUp(real);\n          this.pool.push(real);\n        } else {\n          // fully loaded\n          this.body.replaceChild(real, proxy);\n        }\n        this.loading.delete(proxy);\n        ARowRenderer.cleanUp(proxy);\n        this.loadingPool.push(proxy);\n      },\n      () => {\n        // handle as aborted\n        // aborted can recycle the real one\n        ARowRenderer.cleanUp(real);\n        this.pool.push(real);\n\n        this.loading.delete(proxy);\n        ARowRenderer.cleanUp(proxy);\n        this.loadingPool.push(proxy);\n      }\n    );\n    return proxy;\n  }\n\n  private create(index: number) {\n    const { item, result } = this.select(index);\n\n    const { exceptionsLookup: ex, padding } = this.context;\n    const exceptionHeight = ex.get(index);\n    if (exceptionHeight != null) {\n      item.style.height = `${exceptionHeight - padding(index)}px`;\n    }\n\n    return this.proxy(item, result);\n  }\n\n  private removeAll(perform = true) {\n    const b = this.body;\n    if (!perform) {\n      return Array.from(b.children) as HTMLElement[];\n    }\n    const toRecycle: HTMLElement[] = [];\n    while (b.lastElementChild) {\n      const i = b.lastElementChild as HTMLElement;\n      b.removeChild(i);\n      this.recycle(i);\n      toRecycle.push(i);\n    }\n    return toRecycle;\n  }\n\n  /**\n   * triggers and visual update of all visible rows\n   */\n  protected update(): void {\n    const { first } = this.visible;\n    const { fragment } = this;\n    const items = Array.from(this.body.children) as HTMLElement[];\n    clear(this.body);\n    items.forEach((item: HTMLElement, i) => {\n      if (this.loading.has(item)) {\n        // still loading\n        fragment.appendChild(item);\n        return;\n      }\n      const abort = this.updateRow(item, i + first);\n\n      fragment.appendChild(this.proxy(item, abort));\n    });\n    this.body.appendChild(fragment);\n  }\n\n  /**\n   * utility to execute a function for each visible row\n   * @param {(row: HTMLElement, rowIndex: number) => void} callback callback to execute\n   * @param {boolean} inPlace whether the DOM changes should be performed in place instead of in a fragment\n   */\n  protected forEachRow(callback: (row: HTMLElement, rowIndex: number) => void, inPlace = false): void {\n    const rows = Array.from(this.body.children) as HTMLElement[];\n    const { fragment } = this;\n    if (!inPlace) {\n      clear(this.body);\n    }\n    rows.forEach((row: HTMLElement, index) => {\n      if (!isLoadingCell(row) && row.dataset.animation !== 'update_remove' && row.dataset.animation !== 'hide') {\n        // skip loading ones and temporary ones\n        callback(row, index + this.visible.first);\n      }\n      if (!inPlace) {\n        fragment.appendChild(row);\n      }\n    });\n    if (!inPlace) {\n      this.body.appendChild(fragment);\n    }\n  }\n\n  private removeFromBeginning(from: number, to: number, perform = true) {\n    return this.remove(from, to, true, perform);\n  }\n\n  private removeFromBottom(from: number, to: number, perform = true) {\n    return this.remove(from, to, false, perform);\n  }\n\n  private remove(from: number, to: number, fromBeginning: boolean, perform = true) {\n    if (to < from) {\n      return [];\n    }\n    const b = this.body;\n    const toRecycle: HTMLElement[] = [];\n    // console.log('remove', fromBeginning, (to - from) + 1, this.body.childElementCount - ((to - from) + 1));\n    let act = (fromBeginning ? b.firstChild : b.lastChild) as HTMLElement;\n    for (let i = from; i <= to; i += 1) {\n      const item = act;\n      act = (fromBeginning ? act.nextSibling : act.previousSibling) as HTMLElement;\n\n      if (perform) {\n        b.removeChild(item);\n        this.recycle(item);\n      }\n      toRecycle.push(item);\n    }\n    return toRecycle;\n  }\n\n  private addAtBeginning(from: number, to: number, perform = true) {\n    if (to < from) {\n      return null;\n    }\n    // console.log('add', (to - from) + 1, this.body.childElementCount + ((to - from) + 1));\n    const { fragment } = this;\n    if (from === to && perform) {\n      this.body.insertBefore(this.create(from), this.body.firstChild);\n      return null;\n    }\n    for (let i = from; i <= to; i += 1) {\n      fragment.appendChild(this.create(i));\n    }\n    if (perform) {\n      this.body.insertBefore(fragment, this.body.firstChild);\n    }\n    return fragment;\n  }\n\n  private addAtBottom(from: number, to: number, perform = true) {\n    if (to < from) {\n      return null;\n    }\n    // console.log('add_b', (to - from) + 1, this.body.childElementCount + ((to - from) + 1));\n    if (from === to && perform) {\n      this.body.appendChild(this.create(from));\n      return null;\n    }\n    const { fragment } = this;\n    for (let i = from; i <= to; i += 1) {\n      fragment.appendChild(this.create(i));\n    }\n    if (perform) {\n      this.body.appendChild(fragment);\n    }\n    return fragment;\n  }\n\n  protected updateOffset(firstRowPos: number): void {\n    this.visibleFirstRowPos = firstRowPos;\n\n    this.updateSizer(firstRowPos);\n  }\n\n  protected updateSizer(firstRowPos: number): void {\n    const { totalHeight } = this.context;\n    setTransform(this.body, 0, firstRowPos.toFixed(0));\n    setTransform(this.bodySizer, 0, Math.max(0, totalHeight - 1).toFixed(0));\n  }\n\n  /**\n   * removes all rows and recreates the table\n   * @param {IAnimationContext} ctx optional animation context to create a transition between the previous and the current tables\n   * @returns {void} nothing\n   */\n  protected recreate(ctx?: IAnimationContext): void {\n    this.abortAnimation();\n    if (ctx) {\n      return this.recreateAnimated(ctx);\n    }\n    return this.recreatePure();\n  }\n\n  private recreatePure() {\n    const { context } = this;\n\n    const scroller = this.bodyScroller;\n\n    // update first to avoid resetting scrollTop\n    this.updateOffset(0);\n\n    this.removeAll();\n    this.clearPool();\n\n    const { first, last, firstRowPos } = range(\n      scroller.scrollTop,\n      scroller.clientHeight,\n      context.defaultRowHeight,\n      context.exceptions,\n      context.numberOfRows\n    );\n\n    this.visible.first = first;\n    this.visible.forcedFirst = first;\n    this.visible.last = last;\n    this.visible.forcedLast = last;\n\n    if (first < 0) {\n      // empty\n      this.updateOffset(0);\n      return;\n    }\n    this.addAtBottom(first, last);\n    this.updateOffset(firstRowPos);\n  }\n\n  private recreateAnimated(ctx: IAnimationContext) {\n    const lookup = new Map<string, { n: HTMLElement; pos: number; i: number }>();\n    const prev = new KeyFinder(ctx.previous, ctx.previousKey);\n    const cur = new KeyFinder(this.context, ctx.currentKey);\n    const next = range(\n      this.bodyScroller.scrollTop,\n      this.bodyScroller.clientHeight,\n      cur.context.defaultRowHeight,\n      cur.context.exceptions,\n      cur.context.numberOfRows\n    );\n\n    {\n      const rows = Array.from(this.body.children) as HTMLElement[];\n      const old = { ...this.visible };\n      // store the current rows in a lookup and clear\n\n      clear(this.body);\n\n      prev.positions(old.first, Math.min(old.last, old.first + rows.length), this.visibleFirstRowPos, (i, key, pos) => {\n        const n = rows[i];\n        if (n) {\n          // shouldn't happen that it is not there\n          lookup.set(key, { n, pos, i });\n        }\n        // else {\n        //  console.error(i, key, pos, rows);\n        // }\n      });\n    }\n\n    this.visible.first = next.first;\n    this.visible.forcedFirst = next.first;\n    this.visible.last = next.last;\n    this.visible.forcedLast = next.last;\n\n    const { fragment } = this;\n    const animation: IAnimationItem[] = [];\n\n    let nodeY = next.firstRowPos;\n    cur.positions(next.first, next.last, next.firstRowPos, (i, key, pos) => {\n      let node: HTMLElement;\n      let mode: EAnimationMode = EAnimationMode.UPDATE;\n      let previous: {\n        index: number | -1;\n        y: number;\n        height: number;\n      };\n      const item = lookup.get(key);\n      if (item != null) {\n        // still visible\n        lookup.delete(key);\n\n        // update height\n\n        item.n.dataset.index = String(i);\n        node = this.proxy(item.n, this.updateRow(item.n, i));\n        previous = {\n          index: item.i,\n          y: item.pos,\n          height: prev.exceptionHeightOf(item.i, true),\n        };\n      } else {\n        // need a new row\n        const old = prev.posByKey(key);\n        // maybe not visible  before so keep in place\n        node = this.create(i);\n\n        mode = old.index < 0 ? EAnimationMode.SHOW : EAnimationMode.UPDATE_CREATE;\n        previous = {\n          index: old.index,\n          y: old.pos >= 0 ? old.pos : pos,\n          height: old.index < 0 ? cur.exceptionHeightOf(i, true) : prev.exceptionHeightOf(old.index, true),\n        };\n      }\n      animation.push({\n        node,\n        key,\n        mode,\n        previous,\n        nodeY,\n        nodeYCurrentHeight: pos,\n        current: {\n          index: i,\n          y: pos,\n          height: cur.exceptionHeightOf(i),\n        },\n      });\n      node.style.transform = `translate(0, ${nodeY - pos}px)`;\n      nodeY += previous.height + (previous.index < 0 ? cur.padding(i) : prev.padding(previous.index));\n\n      fragment.appendChild(node);\n    });\n\n    let nodeYCurrentHeight = next.endPos;\n    // items that are going to be removed\n    lookup.forEach((item, key) => {\n      // calculate their next position\n      const r = cur.posByKey(key);\n\n      // maybe not visible anymore, keep in place\n      const nextPos = r.pos >= 0 ? r.pos : item.pos;\n      const node = item.n;\n      // located at addedPos\n      // should end up at nextPos\n      // was previously at item.pos\n      node.style.transform = `translate(0, ${item.pos - nodeY}px)`;\n      fragment.appendChild(node);\n\n      const prevHeight = prev.exceptionHeightOf(item.i, true);\n\n      animation.push({\n        node: item.n,\n        key,\n        mode: r.index < 0 ? EAnimationMode.HIDE : EAnimationMode.UPDATE_REMOVE,\n        previous: {\n          index: item.i,\n          y: item.pos,\n          height: prevHeight,\n        },\n        nodeY,\n        nodeYCurrentHeight,\n        current: {\n          index: r.index,\n          y: nextPos,\n          height: r.index < 0 ? null : cur.exceptionHeightOf(r.index),\n        },\n      });\n      nodeYCurrentHeight +=\n        r.index < 0 ? cur.context.defaultRowHeight : cur.exceptionHeightOf(r.index, true) + cur.padding(r.index);\n      nodeY += prevHeight + prev.padding(item.i);\n    });\n\n    this.updateOffset(next.firstRowPos);\n\n    this.animate(animation, ctx.phases || defaultPhases, prev, cur, fragment);\n  }\n\n  private animate(\n    animation: IAnimationItem[],\n    phases: IPhase[],\n    previousFinder: KeyFinder,\n    currentFinder: KeyFinder,\n    fragment: DocumentFragment\n  ) {\n    let activeAnimation = animation;\n    if (activeAnimation.length <= 0) {\n      this.body.appendChild(fragment);\n      return;\n    }\n\n    let currentTimer = -1;\n    let actPhase = 0;\n\n    const executePhase = (phase: IPhase, items = activeAnimation) => {\n      items.forEach((anim) => phase.apply(anim, previousFinder, currentFinder));\n    };\n\n    const run = () => {\n      // dummy log for forcing dom update\n      // eslint-disable-next-line no-console\n      console.assert(activeAnimation[0].node.offsetTop >= 0, 'dummy log for forcing dom update');\n      executePhase(phases[actPhase]);\n      actPhase += 1;\n      // shifted by one since already added through ++\n      if (actPhase < phases.length) {\n        // schedule the next one\n        const next = phases[actPhase];\n        // eslint-disable-next-line no-restricted-globals\n        currentTimer = self.setTimeout(run, next.delay);\n        return;\n      }\n\n      // last one\n      const body = this.body.classList;\n      Array.from(body).forEach((v) => {\n        if (v.startsWith(cssClass()) && v.endsWith('-animation')) {\n          body.remove(v);\n        }\n      });\n      // clean up\n      activeAnimation.forEach(({ node, mode }) => {\n        if (mode !== EAnimationMode.UPDATE_REMOVE && mode !== EAnimationMode.HIDE) {\n          return;\n        }\n        node.remove();\n        // eslint-disable-next-line no-param-reassign\n        node.style.transform = '';\n        this.recycle(node);\n      });\n      this.abortAnimation = () => undefined;\n      currentTimer = -1;\n    };\n\n    // execute all phases having a delay of zero\n    while (phases[actPhase].delay === 0) {\n      executePhase(phases[actPhase]);\n      actPhase += 1;\n    }\n    // after the initial one\n    const { body } = this;\n    this.body.appendChild(fragment);\n\n    const dummyAnimation: IAnimationItem[] = [];\n    activeAnimation = activeAnimation.filter((d) => {\n      if (noAnimationChange(d, previousFinder.context.defaultRowHeight, currentFinder.context.defaultRowHeight)) {\n        dummyAnimation.push(d);\n        return false;\n      }\n      return true;\n    });\n\n    if (dummyAnimation.length > 0) {\n      // execute all phases for them\n      phases.slice(actPhase).forEach((phase) => executePhase(phase, dummyAnimation));\n    }\n\n    if (activeAnimation.length === 0) {\n      return;\n    }\n\n    body.classList.add(CSS_CLASS_ROW_ANIMATION);\n    new Set(activeAnimation.map((d) => d.mode)).forEach((mode) => {\n      // add class but map to UPDATE only\n      body.classList.add(cssClass(`${EAnimationMode[mode].toLowerCase().split('_')[0]}-animation`));\n    });\n\n    this.abortAnimation = () => {\n      if (currentTimer <= 0) {\n        return;\n      }\n      // abort by removing\n      clearTimeout(currentTimer);\n      currentTimer = -1;\n      // run the last phase\n      actPhase = phases.length - 1;\n      run();\n    };\n\n    // next tick such that DOM will be updated\n    // eslint-disable-next-line no-restricted-globals\n    currentTimer = self.setTimeout(run, phases[actPhase].delay);\n  }\n\n  /**\n   * clears the row pool used for faster creation\n   */\n  protected clearPool(): void {\n    // clear pool\n    this.pool.splice(0, this.pool.length);\n  }\n\n  /**\n   * triggers a revalidation of the current scrolling offset\n   */\n  protected revalidate(): void {\n    const scroller = this.bodyScroller;\n    this.onScrolledVertically(scroller.scrollTop, scroller.clientHeight, true);\n    this.updateOffset(this.visibleFirstRowPos);\n  }\n\n  /**\n   * scrolling vertically\n   * @param {number} scrollTop top scrolling\n   * @param {number} clientHeight visible height\n   * @param {boolean} isGoingDown hint whether the scrollTop increases\n   * @return {EScrollResult} full in case of a full rebuild or partial update\n   */\n  protected onScrolledVertically(scrollTop: number, clientHeight: number, isGoingDown: boolean): EScrollResult {\n    const shift = this.options.viewportOversize;\n\n    const shiftTop = Math.max(0, scrollTop - shift);\n\n    const scrollResult = this.onScrolledImpl(shiftTop, clientHeight + shift + (scrollTop - shiftTop));\n    for (const mixin of this.mixins) {\n      mixin.onScrolled(isGoingDown, scrollResult);\n    }\n    return scrollResult;\n  }\n\n  private shiftLast(current: number, currentDelta: number) {\n    const b = this.options.batchSize;\n    if (currentDelta >= b) {\n      return current;\n    }\n    const total = this.context.numberOfRows;\n    return Math.min(total - 1, current + (this.options.batchSize - currentDelta));\n  }\n\n  private shiftFirst(current: number, currentFirstRow: number, currentDelta: number) {\n    const b = this.options.batchSize;\n    if (currentDelta >= b || current <= 0) {\n      return { first: current, firstRowPos: currentFirstRow };\n    }\n    const first = Math.max(0, current - (this.options.batchSize - currentDelta));\n\n    const { exceptionsLookup, defaultRowHeight } = this.context;\n    let firstRowPos = currentFirstRow;\n    for (let i = first; i < current; i += 1) {\n      firstRowPos -= exceptionsLookup.get(i) ?? defaultRowHeight;\n    }\n    return { first, firstRowPos };\n  }\n\n  private onScrolledImpl(scrollTop: number, clientHeight: number): EScrollResult {\n    const { context } = this;\n    let { first, last, firstRowPos } = range(\n      scrollTop,\n      clientHeight,\n      context.defaultRowHeight,\n      context.exceptions,\n      context.numberOfRows\n    );\n\n    const { visible } = this;\n    visible.forcedFirst = first;\n    visible.forcedLast = last;\n\n    if (first - visible.first >= 0 && last - visible.last <= 0) {\n      // nothing to do\n      return EScrollResult.NONE;\n    }\n\n    let r: EScrollResult = EScrollResult.SOME;\n\n    let toRecycle: HTMLElement[] | undefined;\n    let toAdd: DocumentFragment | undefined | null;\n    let toAddBottom = false;\n\n    if (first > visible.last || last < visible.first) {\n      // no overlap, clean and draw everything\n      // console.log(`ff added: ${last - first + 1} removed: ${visibleLast - visibleFirst + 1} ${first}:${last} ${offset}`);\n      // removeRows(visibleFirst, visibleLast);\n\n      toRecycle = this.removeAll(false);\n      toAdd = this.addAtBottom(first, last, false);\n      toAddBottom = true;\n      r = EScrollResult.ALL;\n    } else if (first < visible.first) {\n      // some first rows missing and some last rows to much\n      // console.log(`up added: ${visibleFirst - first + 1} removed: ${visibleLast - last + 1} ${first}:${last} ${offset}`);\n      const toRemove = visible.last - (last + 1);\n      if (toRemove >= this.options.batchSize) {\n        toRecycle = this.removeFromBottom(last + 1, visible.last, false);\n      } else {\n        last = visible.last;\n      }\n\n      const shift = this.shiftFirst(first, firstRowPos, visible.first - 1 - first);\n      first = shift.first;\n      firstRowPos = shift.firstRowPos;\n      toAdd = this.addAtBeginning(first, visible.first - 1, false);\n      toAddBottom = false;\n      r = EScrollResult.SOME_TOP;\n    } else {\n      // console.log(`do added: ${last - visibleLast + 1} removed: ${first - visibleFirst + 1} ${first}:${last} ${offset}`);\n      // some last rows missing and some first rows to much\n      const toRemove = first - 1 - visible.first;\n      if (toRemove >= this.options.batchSize) {\n        toRecycle = this.removeFromBeginning(visible.first, first - 1, false);\n      } else {\n        first = visible.first;\n        firstRowPos = this.visibleFirstRowPos;\n      }\n\n      last = this.shiftLast(last, last - visible.last + 1);\n\n      toAdd = this.addAtBottom(visible.last + 1, last, false);\n      toAddBottom = true;\n      r = EScrollResult.SOME_BOTTOM;\n    }\n\n    visible.first = first;\n    visible.last = last;\n\n    this.updateOffset(firstRowPos);\n    this.manipulate(toRecycle, toAdd, toAddBottom);\n    return r;\n  }\n\n  private manipulate(\n    toRecycle: HTMLElement[] | undefined,\n    toAdd: DocumentFragment | undefined | null,\n    bottom: boolean\n  ) {\n    if (toRecycle) {\n      for (const item of toRecycle) {\n        item.remove();\n        this.recycle(item);\n      }\n    }\n    if (!toAdd) {\n      return;\n    }\n    if (bottom) {\n      this.body.appendChild(toAdd);\n    } else {\n      this.body.insertBefore(toAdd, this.body.firstChild);\n    }\n  }\n}\n\nexport default ARowRenderer;\n\nexport function setTransform(elem: HTMLElement, x: number | string, y: number | string): void {\n  const text = `translate(${x}px, ${y}px)`;\n  const anyElem = elem as { __transform__?: string };\n  // eslint-disable-next-line no-underscore-dangle\n  if (anyElem.__transform__ === text) {\n    return;\n  }\n  // eslint-disable-next-line no-underscore-dangle\n  anyElem.__transform__ = text;\n  // eslint-disable-next-line no-param-reassign\n  elem.style.transform = text;\n}\n","// import manually import './style.scss';\n\n/**\n * utility for custom generated CSS rules\n */\n\ninterface ICSSRule {\n  id: string;\n  selector: string;\n  style: Partial<CSSStyleDeclaration>;\n}\n\nfunction assignStyles(target: CSSStyleDeclaration, source: Record<string, unknown>) {\n  const targetObj = target as unknown as Record<string, unknown>;\n  for (const key of Object.keys(source)) {\n    const v = source[key] as string;\n\n    if (!v.endsWith(' !important')) {\n      if (targetObj[key] !== v) {\n        // eslint-disable-next-line no-param-reassign\n        targetObj[key] = v;\n      }\n      continue;\n    }\n\n    // handle special important case\n    const plain = v.slice(0, -' !important'.length);\n    if (targetObj[key] === plain) {\n      continue;\n    }\n    // eslint-disable-next-line no-param-reassign\n    targetObj[key] = plain;\n    // see https://gist.github.com/youssman/745578062609e8acac9f\n    const hyphen = key.replace(/([a-zA-Z])(?=[A-Z])/g, '$1-').toLowerCase();\n    target.setProperty(hyphen, plain, 'important');\n  }\n}\n\nexport default class StyleManager {\n  private readonly rules: ICSSRule[] = [];\n\n  private readonly node: HTMLStyleElement;\n\n  private testVerifyTimeout = -1;\n\n  /**\n   * the parent element to append this managed style\n   * @param {HTMLElement} root\n   */\n  constructor(root: HTMLElement) {\n    this.node = root.ownerDocument.createElement('style');\n    this.node.appendChild(root.ownerDocument.createTextNode('')); // for webkit?\n    root.appendChild(this.node);\n  }\n\n  destroy(): void {\n    this.node.remove();\n  }\n\n  private verifySheet() {\n    const { sheet } = this;\n    if (!sheet) {\n      if (this.testVerifyTimeout >= 0) {\n        return;\n      }\n      // test till attached\n      // eslint-disable-next-line no-restricted-globals\n      this.testVerifyTimeout = self.setTimeout(() => {\n        this.testVerifyTimeout = -1;\n        this.verifySheet();\n      }, 20);\n      return;\n    }\n    const rules = sheet.cssRules;\n    if (\n      rules.length === this.rules.length &&\n      this.rules.every((d, i) => (rules[i] as CSSStyleRule).selectorText === d.selector)\n    ) {\n      // same\n      return;\n    }\n\n    // console.warn('invalid sheet rules detected');\n\n    const l = rules.length;\n    for (let i = l - 1; i >= 0; i -= 1) {\n      sheet.deleteRule(i);\n    }\n\n    // create all\n    for (const rule of this.rules) {\n      const index = sheet.insertRule(`${rule.selector} {}`, sheet.cssRules.length);\n      const cssRule = sheet.cssRules[index] as CSSStyleRule;\n      rule.selector = cssRule.selectorText;\n      assignStyles(cssRule.style, rule.style);\n    }\n  }\n\n  private get sheet() {\n    return this.node.sheet as CSSStyleSheet | null;\n  }\n\n  private getSheetRule(index: number) {\n    const { sheet } = this;\n    return sheet ? (sheet.cssRules[index] as CSSStyleRule) : null;\n  }\n\n  /**\n   * add a custom css rule\n   * @param {string} id unique id of the rule for later identification\n   * @param {string} selector the css selector\n   * @param {Partial<CSSStyleDeclaration>} style the style attributes\n   * @returns {string} the id again\n   */\n  addRule(id: string, selector: string, style: Partial<CSSStyleDeclaration>): string | null {\n    this.verifySheet();\n    const { sheet } = this;\n    if (!sheet) {\n      // upon next update\n      this.rules.push({ id, selector, style });\n      return null;\n    }\n    const index = sheet.insertRule(`${selector} {}`, sheet.cssRules.length);\n    const rule = sheet.cssRules[index] as CSSStyleRule;\n    this.rules.push({ id, selector: rule.selectorText, style });\n    assignStyles(rule.style, style);\n    return id;\n  }\n\n  /**\n   * updates or add a rule, see @addRule\n   * @param {string} id unique id of the rule for later identification\n   * @param {string} selector the css selector\n   * @param {Partial<CSSStyleDeclaration>} style the style attributes\n   * @returns {string} the id again\n   */\n  updateRule(id: string, selector: string, style: Partial<CSSStyleDeclaration>): string | null {\n    this.verifySheet();\n    const index = this.rules.findIndex((d) => d.id === id);\n    if (index < 0) {\n      return this.addRule(id, selector, style);\n    }\n    const stored = this.rules[index];\n    stored.selector = selector;\n    stored.style = style;\n\n    const rule = this.getSheetRule(index);\n    if (rule) {\n      if (rule.selectorText.replace(/\\s/gm, '') !== selector.replace(/\\s/gm, '')) {\n        // ignoring white space\n        rule.selectorText = selector;\n        stored.selector = rule.selectorText;\n      }\n      assignStyles(rule.style, style);\n    }\n    return id;\n  }\n\n  /**\n   * deletes the given rule by id\n   * @param {string} id the rule to delete\n   */\n  deleteRule(id: string): void {\n    this.verifySheet();\n    const index = this.rules.findIndex((d) => d.id === id);\n    if (index < 0) {\n      return;\n    }\n    this.rules.splice(index, 1);\n    const { sheet } = this;\n    if (sheet) {\n      sheet.deleteRule(index);\n    }\n  }\n\n  /**\n   * get a list of all registered rule ids\n   */\n  protected get ruleNames(): string[] {\n    return this.rules.map((d) => d.id);\n  }\n}\n","import { addScroll } from '../internal';\nimport {\n  cssClass,\n  CSS_CLASS_BODY,\n  CSS_CLASS_FOOTER,\n  CSS_CLASS_HEADER,\n  CSS_CLASS_SCROLLBAR_TESTER,\n  CSS_CLASS_SHIFTED,\n  CSS_CLASS_TBODY,\n  CSS_CLASS_THEAD,\n} from '../styles';\nimport StyleManager from './StyleManager';\n\nexport function setTemplate(root: HTMLElement, id: string): HTMLElement {\n  const cleanId = id.startsWith('#') ? id.slice(1) : id;\n  // eslint-disable-next-line no-param-reassign\n  root.innerHTML = `\n  <header id=\"header-${cleanId}\" class=\"${CSS_CLASS_HEADER} ${cssClass(`header-${cleanId}`)}\">\n    <article class=\"${CSS_CLASS_THEAD} ${cssClass(`thead-${cleanId}`)}\"></article>\n  </header>\n  <main id=\"body-${cleanId}\" class=\"${CSS_CLASS_BODY} ${cssClass(`body-${cleanId}`)}\">\n    <footer class=\"${CSS_CLASS_FOOTER}\">&nbsp;</footer>\n    <article class=\"${CSS_CLASS_TBODY} ${cssClass(`tbody-${cleanId}`)}\"></article>\n  </main>`;\n  return root;\n}\n\n/**\n * column base interface\n */\nexport interface IColumn {\n  readonly index: number;\n  readonly id: string;\n  readonly width: number;\n  /**\n   * boolean flag whether when scrolling the column should be sticky\n   */\n  readonly frozen: boolean;\n}\n\ninterface ISelectors {\n  thead: string;\n  tbody: string;\n  tr: string;\n  th: string;\n  td: string;\n}\n\n/**\n * generates the HTML Ids used for the header and body article of a table\n * @param {string} tableId base table id\n * @param {boolean} asSelector flag whether to prepend with # for CSS selector\n * @return {ISelectors} the table ids used for header and body\n */\nexport function tableIds(tableId: string): { thead: string; tbody: string; tr: string; th: string; td: string } {\n  return {\n    thead: `thead-${tableId}`,\n    tbody: `tbody-${tableId}`,\n    tr: `tr-${tableId}`,\n    th: `th-${tableId}`,\n    td: `td-${tableId}`,\n  };\n}\n\nexport function tableCSSClasses(tableId: string): { thead: string; tbody: string; tr: string; th: string; td: string } {\n  const ids = tableIds(tableId);\n  return {\n    thead: cssClass(ids.thead),\n    tbody: cssClass(ids.tbody),\n    tr: cssClass(ids.tr),\n    th: cssClass(ids.th),\n    td: cssClass(ids.td),\n  };\n}\n\n/**\n * utility for custom generated CSS rules with a focus on dynamically generated grid layouts\n */\nexport default class GridStyleManager extends StyleManager {\n  readonly id: string;\n\n  readonly ids: ISelectors;\n\n  readonly cssClasses: ISelectors;\n\n  constructor(root: HTMLElement, id: string) {\n    super(root);\n    this.id = id.startsWith('#') ? id.slice(1) : id;\n\n    this.ids = tableIds(this.id);\n    this.cssClasses = tableCSSClasses(this.id);\n\n    const headerScroller = root.getElementsByTagName('header')[0] as HTMLElement;\n    const bodyScroller = root.getElementsByTagName('main')[0] as HTMLElement;\n\n    // async since style needs to be added to dom first\n    // eslint-disable-next-line no-restricted-globals\n    self.setTimeout(() => {\n      const { width } = measureScrollbar(root);\n      this.updateRule('__scrollBarFix2', `#header-${this.id} > article:last-of-type`, {\n        borderRight: `${width}px solid transparent`,\n      });\n    }, 20);\n\n    let old = headerScroller.scrollLeft;\n\n    // update frozen and sync header with body\n    addScroll(bodyScroller, 'animation', (act) => {\n      const newValue = act.left;\n      if (old !== newValue) {\n        headerScroller.scrollLeft = newValue;\n        old = newValue;\n      }\n      root.classList.toggle(CSS_CLASS_SHIFTED, act.left > 0);\n    });\n  }\n\n  /**\n   * updates the column widths and default row height for a table\n   * @param {number} defaultRowHeight\n   * @param {IColumn[]} columns\n   * @param {number} frozenShift shift frozen columns\n   * @param {string} tableId optional tableId in case of multiple tables within the same engine\n   * @param {string} unit\n   */\n  update(\n    defaultRowHeight: number,\n    columns: IColumn[],\n    padding: (index: number) => number,\n    frozenShift: number,\n    tableId: string,\n    unit = 'px'\n  ): void {\n    const ids = tableIds(tableId);\n    const selectors = tableCSSClasses(tableId);\n\n    const total = `${columns.reduce((a, b, i) => a + b.width + padding(i), 0)}${unit}`;\n\n    this.updateRule(`__heightsRule${selectors.tr}`, `.${selectors.tr}`, {\n      height: `${defaultRowHeight}px`,\n      width: total,\n    });\n\n    this.updateRule(`__heightsRule${selectors.tbody}`, `#${ids.tbody}`, {\n      width: total,\n    });\n\n    this.updateColumns(columns, padding, selectors, frozenShift, unit);\n  }\n\n  /**\n   * removes a given tableId if not needed anymore\n   * @param {string} tableId tableId to remove\n   */\n  remove(tableId: string): void {\n    const selectors = tableCSSClasses(tableId);\n    this.deleteRule(`__heightsRule${selectors.tr}`);\n    this.deleteRule(`__heightsRule${selectors.tbody}`);\n\n    const prefix = `__col${selectors.td}_`;\n    const rules = this.ruleNames.reduce((a, b) => a + (b.startsWith(prefix) ? 1 : 0), 0);\n    // reset\n    for (let i = 0; i < rules; i += 1) {\n      this.deleteRule(`${prefix}${i}`);\n    }\n  }\n\n  private updateColumns(\n    columns: IColumn[],\n    padding: (index: number) => number,\n    cssSelectors: ISelectors,\n    frozenShift: number,\n    unit = 'px'\n  ): void {\n    const prefix = `__col${cssSelectors.td}_`;\n    const rules = new Set(this.ruleNames.filter((d) => d.startsWith(prefix)));\n\n    let acc = 0;\n    columns.forEach((c, i) => {\n      const th = `.${cssSelectors.th}[data-id=\"${c.id}\"]`;\n      const thStyles: Partial<CSSStyleDeclaration> = {\n        width: `${c.width}${unit}`,\n      };\n      const td = `.${cssSelectors.td}[data-id=\"${c.id}\"]`;\n      const tdStyles: Partial<CSSStyleDeclaration> = {\n        transform: `translateX(${acc}${unit})`,\n        width: `${c.width}${unit}`,\n      };\n\n      if (c.frozen) {\n        thStyles.left = `${acc}px`;\n\n        this.updateRule(`${prefix}${td}F`, `.${cssSelectors.td}.${CSS_CLASS_SHIFTED}[data-id=\"${c.id}\"]`, {\n          transform: `translateX(0)`,\n          left: `${acc + frozenShift}${unit}`,\n        });\n        rules.delete(`${prefix}${td}F`);\n      }\n\n      this.updateRule(`${prefix}${th}`, th, thStyles);\n      rules.delete(`${prefix}${th}`);\n      this.updateRule(`${prefix}${td}`, td, tdStyles);\n      rules.delete(`${prefix}${td}`);\n      acc += c.width + padding(i);\n    });\n\n    rules.forEach((d) => this.deleteRule(d));\n  }\n}\n/**\n * measure the width and height of the scrollbars\n * based on Slick grid implementation\n * @param root\n */\nfunction measureScrollbar(root: HTMLElement) {\n  const body = root.ownerDocument?.body;\n  if (!body) {\n    return { width: 10, height: 10 };\n  }\n  body.insertAdjacentHTML('beforeend', `<div class=\"${CSS_CLASS_SCROLLBAR_TESTER}\"><div></div></div>`);\n  const elem = body.lastElementChild as HTMLElement;\n\n  const width = elem.offsetWidth - elem.clientWidth;\n  const height = elem.offsetHeight - elem.clientHeight;\n\n  elem.remove();\n\n  return { width, height };\n}\n","import { ABORTED, IAbortAblePromise, IAsyncUpdate, isAbortAble, isAsyncUpdate } from '../../abortAble';\nimport { isLoadingCell } from '../../ARowRenderer';\nimport { clear, IScrollInfo } from '../../internal';\nimport { isScrollEventWaiting } from '../../internal/scroll';\nimport { IExceptionContext, range, updateFrozen } from '../../logic';\nimport { EScrollResult, IMixin, IMixinAdapter, IMixinClass } from '../../mixin';\nimport { IColumn } from '../../style';\nimport GridStyleManager from '../../style/GridStyleManager';\nimport {\n  cssClass,\n  CSS_CLASS_FROZEN,\n  CSS_CLASS_LOADING,\n  CSS_CLASS_SHIFTED,\n  CSS_CLASS_TD,\n  CSS_CLASS_TH,\n} from '../../styles';\n\n// const debug = false;\n\nexport interface ICellAdapterRenderContext<T extends IColumn> extends IExceptionContext {\n  readonly column: IExceptionContext;\n  readonly columns: T[];\n}\n\nexport interface IVisibleColumns {\n  frozen: number[];\n  first: number;\n  forcedFirst: number;\n  last: number;\n  forcedLast: number;\n}\n\n/**\n * @internal\n */\nexport abstract class ACellAdapter<T extends IColumn> {\n  /**\n   * pool of cells per column\n   * @type {Array}\n   */\n  private readonly cellPool: HTMLElement[][] = [];\n\n  private readonly loading = new WeakMap<HTMLElement, IAbortAblePromise<void>>();\n\n  readonly visibleColumns: IVisibleColumns = {\n    frozen: [] as number[], // column indices that are visible even tho they would be out of range\n    first: 0,\n    forcedFirst: 0,\n    last: -1,\n    forcedLast: -1,\n  };\n\n  visibleFirstColumnPos = 0;\n\n  private horizontallyShifted = false;\n\n  private readonly columnAdapter: IMixinAdapter;\n\n  private readonly columnMixins: IMixin[];\n\n  private readonly columnFragment: DocumentFragment;\n\n  constructor(\n    protected readonly header: HTMLElement,\n    protected readonly style: GridStyleManager,\n    private readonly tableId: string,\n    mixinClasses: IMixinClass[] = []\n  ) {\n    this.columnAdapter = this.createColumnAdapter();\n    this.columnMixins = mixinClasses.map((MixinClass) => new MixinClass(this.columnAdapter));\n\n    this.columnFragment = header.ownerDocument.createDocumentFragment();\n  }\n\n  leftShift(): number {\n    const ctx = this.context;\n    const frozen = this.visibleColumns.frozen.reduce((a, d) => a + ctx.columns[d].width + ctx.column.padding(d), 0);\n    return this.visibleFirstColumnPos - frozen;\n  }\n\n  protected get headerScroller(): HTMLElement {\n    return this.header.parentElement as HTMLElement;\n  }\n\n  addColumnMixin(MixinClass: IMixinClass, options?: unknown): void {\n    this.columnMixins.push(new MixinClass(this.columnAdapter, options));\n  }\n\n  private createColumnAdapter(): IMixinAdapter {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    const r = {\n      visible: this.visibleColumns,\n      addAtBeginning: this.addColumnAtStart.bind(this),\n      addAtBottom: this.addColumnAtEnd.bind(this),\n      removeFromBeginning: this.removeColumnFromStart.bind(this),\n      removeFromBottom: this.removeColumnFromEnd.bind(this),\n      updateOffset: this.updateColumnOffset.bind(this),\n      scroller: this.headerScroller,\n      syncFrozen: this.syncFrozen.bind(this),\n      isScrollEventWaiting: () => isScrollEventWaiting(this.headerScroller, 'animation'),\n      get visibleFirstRowPos() {\n        return that.visibleFirstColumnPos;\n      },\n      get context() {\n        return that.context.column;\n      },\n      get scrollOffset() {\n        return that.lastScrollInfo ? that.lastScrollInfo.left : 0;\n      },\n      get scrollTotal() {\n        return that.lastScrollInfo ? that.lastScrollInfo.width : that.headerScroller.clientWidth;\n      },\n    };\n    return r;\n  }\n\n  init(): void {\n    const { context } = this;\n    this.style.update(\n      context.defaultRowHeight - context.padding(-1),\n      context.columns,\n      context.column.padding,\n      0,\n      this.tableId\n    );\n\n    context.columns.forEach(() => {\n      // init pool\n      this.cellPool.push([]);\n    });\n  }\n\n  onScrolledHorizontally(scrollLeft: number, clientWidth: number, isGoingRight: boolean): EScrollResult {\n    const scrollResult = this.onScrolledHorizontallyImpl(scrollLeft, clientWidth);\n    for (const mixin of this.columnMixins) {\n      mixin.onScrolled(isGoingRight, scrollResult);\n    }\n    return scrollResult;\n  }\n\n  /**\n   * the current render context, upon change `recreate` the whole table\n   * @returns {ICellRenderContext}\n   */\n  protected abstract get context(): ICellAdapterRenderContext<T>;\n\n  protected abstract get body(): HTMLElement;\n\n  protected abstract get lastScrollInfo(): IScrollInfo | null;\n\n  protected abstract createHeader(document: Document, column: T): HTMLElement | IAsyncUpdate<HTMLElement>;\n\n  protected abstract updateHeader(node: HTMLElement, column: T): HTMLElement | IAsyncUpdate<HTMLElement> | void;\n\n  protected abstract createCell(document: Document, index: number, column: T): HTMLElement | IAsyncUpdate<HTMLElement>;\n\n  protected abstract updateCell(\n    node: HTMLElement,\n    index: number,\n    column: T\n  ): HTMLElement | IAsyncUpdate<HTMLElement> | void;\n\n  protected abstract forEachRow(callback: (row: HTMLElement, rowIndex: number) => void): void;\n\n  private removeColumnFromStart(from: number, to: number, frozenShift: number = this.visibleColumns.frozen.length) {\n    this.forEachRow((row: HTMLElement) => {\n      this.removeCellFromStart(row, from, to, frozenShift);\n    });\n    // if (debug) {\n    //   this.verifyRows();\n    // }\n  }\n\n  private removeCellFromStart(row: HTMLElement, from: number, to: number, frozenShift: number) {\n    for (let i = from; i <= to; i += 1) {\n      const node = (frozenShift === 0 ? row.firstElementChild : row.children[frozenShift]) as HTMLElement;\n      node.remove();\n      this.recycleCell(node, i);\n    }\n    // if (debug) {\n    //   verifyRow(row, -1, this.context.columns);\n    // }\n  }\n\n  private removeColumnFromEnd(from: number, to: number) {\n    this.forEachRow((row: HTMLElement) => {\n      this.removeCellFromEnd(row, from, to);\n    });\n    // if (debug) {\n    //   this.verifyRows();\n    // }\n  }\n\n  private removeCellFromEnd(row: HTMLElement, from: number, to: number) {\n    for (let i = to; i >= from; i -= 1) {\n      const node = row.lastElementChild as HTMLElement;\n      node.remove();\n      this.recycleCell(node, i);\n    }\n    // if (debug) {\n    //   verifyRow(row, -1, this.context.columns);\n    // }\n  }\n\n  private removeFrozenCells(row: HTMLElement, columnIndices: number[], shift: number) {\n    for (const columnIndex of columnIndices) {\n      const node = row.children[shift] as HTMLElement;\n      node.remove();\n      this.recycleCell(node, columnIndex);\n    }\n    // if (debug) {\n    //   verifyRow(row, -1, this.context.columns);\n    // }\n  }\n\n  private removeFrozenColumns(columnIndices: number[], shift: number) {\n    this.forEachRow((row: HTMLElement) => {\n      this.removeFrozenCells(row, columnIndices, shift);\n    });\n    // if (debug) {\n    //   this.verifyRows();\n    // }\n  }\n\n  private removeAllColumns(includingFrozen: boolean) {\n    this.forEachRow((row: HTMLElement) => {\n      this.removeAllCells(row, includingFrozen);\n    });\n    // if (debug) {\n    //   this.verifyRows();\n    // }\n  }\n\n  private removeAllCells(row: HTMLElement, includingFrozen: boolean, shift = this.visibleColumns.first) {\n    const arr = Array.from(row.children) as HTMLElement[];\n    const { frozen } = this.visibleColumns;\n    clear(row);\n\n    if (includingFrozen || frozen.length === 0) {\n      for (const i of frozen) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.recycleCell(arr.shift()!, i);\n      }\n    } else {\n      // have frozen and keep them, so readd them\n      for (let i = 0; i < frozen.length; i += 1) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        row.appendChild(arr.shift()!);\n      }\n    }\n    arr.forEach((item, i) => {\n      this.recycleCell(item, i + shift);\n    });\n\n    // if (debug) {\n    //   verifyRow(row, -1, this.context.columns);\n    // }\n  }\n\n  private selectProxyCell(\n    row: number,\n    column: number,\n    columns: T[]\n  ): { item: HTMLElement; ready: IAbortAblePromise<void> | void } {\n    const pool = this.cellPool[column];\n    const columnObj = columns[column];\n\n    let item: HTMLElement;\n    let ready: IAbortAblePromise<void> | void;\n    const pooled = pool.pop();\n\n    const r = pooled\n      ? this.updateCell(pooled, row, columnObj) || pooled\n      : this.createCell(this.header.ownerDocument, row, columnObj);\n    if (isAsyncUpdate(r)) {\n      item = r.item;\n      ready = r.ready;\n    } else {\n      item = r;\n    }\n    if (item !== pooled) {\n      item.dataset.id = columnObj.id;\n      item.classList.add(CSS_CLASS_TD, this.style.cssClasses.td, cssClass(`td-${this.tableId}`));\n    }\n    this.updateShiftedState(item, columnObj);\n    return { item, ready };\n  }\n\n  handleCellReady(item: HTMLElement, ready: IAbortAblePromise<void>, column = -1): HTMLElement {\n    item.classList.add(CSS_CLASS_LOADING);\n    const abort = ready;\n    // lazy loading\n\n    this.loading.set(item, abort);\n    abort.then((result) => {\n      this.loading.delete(item);\n      item.classList.remove(CSS_CLASS_LOADING);\n      if (result === ABORTED && column >= 0) {\n        // aborted can recycle the real one\n        this.cellPool[column].push(item);\n      }\n    });\n    return item;\n  }\n\n  private selectCell(row: number, column: number, columns: T[]): HTMLElement {\n    const { item, ready } = this.selectProxyCell(row, column, columns);\n    if (!isAbortAble(ready)) {\n      return item;\n    }\n    return this.handleCellReady(item, ready, column);\n  }\n\n  protected updateShiftedState(node: HTMLElement, col: IColumn): void {\n    node.classList.toggle(CSS_CLASS_SHIFTED, col.frozen && this.horizontallyShifted);\n  }\n\n  recycleCell(item: HTMLElement, column = -1): void {\n    // check if the dom element is still being manipulated\n    const abort = this.loading.get(item);\n    if (abort != null) {\n      abort.abort();\n    } else if (!isLoadingCell(item) && column >= 0) {\n      this.cellPool[column].push(item);\n    }\n  }\n\n  private addColumnAtStart(from: number, to: number, frozenShift: number = this.visibleColumns.frozen.length) {\n    const { columns } = this.context;\n    this.forEachRow((row: HTMLElement, rowIndex: number) => {\n      this.addCellAtStart(row, rowIndex, from, to, frozenShift, columns);\n    });\n    // if (debug) {\n    //   this.verifyRows();\n    // }\n  }\n\n  private addCellAtStart(\n    row: HTMLElement,\n    rowIndex: number,\n    from: number,\n    to: number,\n    frozenShift: number,\n    columns: T[]\n  ) {\n    // if (debug) {\n    //   verifyRow(row, rowIndex, this.context.columns);\n    // }\n    for (let i = to; i >= from; i -= 1) {\n      const cell = this.selectCell(rowIndex, i, columns);\n      row.insertBefore(cell, frozenShift > 0 ? row.children[frozenShift] : row.firstChild);\n    }\n    // if (debug) {\n    //   verifyRow(row, rowIndex, this.context.columns);\n    // }\n  }\n\n  private insertFrozenCells(row: HTMLElement, rowIndex: number, columnIndices: number[], shift: number, columns: T[]) {\n    const before = row.children[shift];\n    for (const i of columnIndices) {\n      const cell = this.selectCell(rowIndex, i, columns);\n      if (before) {\n        row.insertBefore(cell, before);\n      } else {\n        row.appendChild(cell);\n      }\n    }\n  }\n\n  private insertFrozenColumns(columnIndices: number[], shift: number) {\n    const { columns } = this.context;\n    this.forEachRow((row: HTMLElement, rowIndex: number) => {\n      this.insertFrozenCells(row, rowIndex, columnIndices, shift, columns);\n    });\n  }\n\n  private addColumnAtEnd(from: number, to: number) {\n    const { columns } = this.context;\n    this.forEachRow((row: HTMLElement, rowIndex: number) => {\n      this.addCellAtEnd(row, rowIndex, from, to, columns);\n    });\n    // if (debug) {\n    //   this.verifyRows();\n    // }\n  }\n\n  // private verifyRows() {\n  //   const { columns } = this.context;\n  //   this.forEachRow((row, rowIndex) => verifyRow(row, rowIndex, columns));\n  // }\n\n  private addCellAtEnd(row: HTMLElement, rowIndex: number, from: number, to: number, columns: T[]) {\n    for (let i = from; i <= to; i += 1) {\n      const cell = this.selectCell(rowIndex, i, columns);\n      row.appendChild(cell);\n    }\n    // if (debug) {\n    //   verifyRow(row, rowIndex, this.context.columns);\n    // }\n  }\n\n  updateHeaders(): void {\n    const { columns } = this.context;\n    Array.from(this.header.children).forEach((node: Element, i) => {\n      const base = node as HTMLElement;\n      const col = columns[i];\n      const r = this.updateHeader(base, col);\n      let n: HTMLElement;\n      if (isAsyncUpdate(r)) {\n        n = this.handleCellReady(r.item, r.ready, -1);\n      } else {\n        n = r || base;\n      }\n      if (n === base) {\n        return;\n      }\n      n.dataset.id = col.id;\n      n.classList.add(CSS_CLASS_TH, this.style.cssClasses.th, cssClass(`th-${this.tableId}`));\n      this.header.replaceChild(base, n);\n    });\n  }\n\n  recreate(left: number, width: number): void {\n    const { context } = this;\n\n    this.style.update(\n      context.defaultRowHeight - context.padding(-1),\n      context.columns,\n      context.column.padding,\n      0,\n      this.tableId\n    );\n\n    this.clearPool();\n    // init pool\n    for (let i = this.cellPool.length; i < context.columns.length; i += 1) {\n      this.cellPool.push([]);\n    }\n\n    // create all header columns\n    {\n      const fragment = this.columnFragment;\n      const document = fragment.ownerDocument;\n\n      // create lookup cache to reuse headers\n      const ids = new Map<string, HTMLElement>();\n      while (this.header.lastChild) {\n        const c = this.header.lastChild as HTMLElement;\n        this.header.removeChild(c);\n        ids.set(c.dataset.id ?? '', c);\n      }\n\n      context.columns.forEach((col) => {\n        const existing = ids.get(col.id);\n        const r = existing ? this.updateHeader(existing, col) || existing : this.createHeader(document, col);\n        let n: HTMLElement;\n        if (isAsyncUpdate(r)) {\n          n = this.handleCellReady(r.item, r.ready, -1);\n        } else {\n          n = r;\n        }\n        if (n !== existing) {\n          n.dataset.id = col.id;\n          n.classList.add(CSS_CLASS_TH, this.style.cssClasses.th, cssClass(`th-${this.tableId}`));\n        }\n        fragment.appendChild(n);\n      });\n      this.header.appendChild(fragment);\n    }\n\n    const { first, last, firstRowPos } = range(\n      left,\n      width,\n      context.column.defaultRowHeight,\n      context.column.exceptions,\n      context.column.numberOfRows\n    );\n\n    this.visibleColumns.first = first;\n    this.visibleColumns.forcedFirst = first;\n    this.visibleColumns.last = last;\n    this.visibleColumns.forcedLast = last;\n\n    if (context.columns.some((c) => c.frozen)) {\n      const { target } = updateFrozen([], context.columns, first);\n      this.visibleColumns.frozen = target;\n    } else {\n      this.visibleColumns.frozen = [];\n    }\n    this.updateColumnOffset(firstRowPos);\n  }\n\n  clearPool(): void {\n    this.cellPool.forEach((p) => p.splice(0, p.length));\n  }\n\n  protected updateColumnOffset(firstColumnPos: number): void {\n    const changed = firstColumnPos !== this.visibleFirstColumnPos;\n    this.visibleFirstColumnPos = firstColumnPos;\n    if (changed) {\n      const { context } = this;\n      this.style.update(\n        context.defaultRowHeight - context.padding(-1),\n        context.columns,\n        context.column.padding,\n        0,\n        this.tableId\n      );\n    }\n  }\n\n  createRow(node: HTMLElement, rowIndex: number): void {\n    const { columns } = this.context;\n    const visible = this.visibleColumns;\n\n    if (visible.frozen.length > 0) {\n      for (const i of visible.frozen) {\n        const cell = this.selectCell(rowIndex, i, columns);\n        node.appendChild(cell);\n      }\n    }\n    for (let i = visible.first; i <= visible.last; i += 1) {\n      const cell = this.selectCell(rowIndex, i, columns);\n      node.appendChild(cell);\n    }\n  }\n\n  updateRow(node: HTMLElement, rowIndex: number): void {\n    const { columns } = this.context;\n    const visible = this.visibleColumns;\n\n    // columns may not match anymore if it is a pooled item a long time ago\n\n    switch (node.childElementCount) {\n      case 0:\n        if (visible.frozen.length > 0) {\n          this.insertFrozenCells(node, rowIndex, visible.frozen, 0, columns);\n        }\n        this.addCellAtEnd(node, rowIndex, visible.first, visible.last, columns);\n        break;\n      case 1: {\n        const old = node.firstElementChild as HTMLElement;\n        const id = old.dataset.id ?? '';\n        const columnIndex = columns.findIndex((c) => c.id === id);\n        node.removeChild(old);\n        if (columnIndex >= 0) {\n          this.recycleCell(old, columnIndex);\n        }\n\n        if (visible.frozen.length > 0) {\n          this.insertFrozenCells(node, rowIndex, visible.frozen, 0, columns);\n        }\n        this.addCellAtEnd(node, rowIndex, visible.first, visible.last, columns);\n        break;\n      }\n      default:\n        this.mergeColumns(node, rowIndex);\n        break;\n    }\n  }\n\n  private mergeColumns(node: HTMLElement, rowIndex: number) {\n    const { columns } = this.context;\n    const visible = this.visibleColumns;\n    const ids = new Map<string, HTMLElement>();\n\n    while (node.lastChild) {\n      const c = node.lastChild as HTMLElement;\n      node.removeChild(c);\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      ids.set(c.dataset.id!, c);\n    }\n\n    const updateImpl = (i: number) => {\n      const col = columns[i];\n      const existing = ids.get(col.id);\n      if (!existing) {\n        const cell = this.selectCell(rowIndex, i, columns);\n        node.appendChild(cell);\n        return;\n      }\n      ids.delete(col.id);\n      const r = this.updateCell(existing, rowIndex, col) || existing;\n      let cell: HTMLElement;\n      if (isAsyncUpdate(r)) {\n        cell = this.handleCellReady(r.item, r.ready, i);\n      } else {\n        cell = r;\n      }\n      if (cell && cell !== existing) {\n        cell.dataset.id = col.id;\n        cell.classList.add(CSS_CLASS_TD, this.style.cssClasses.td, cssClass(`td-${this.tableId}`));\n      }\n      this.updateShiftedState(cell, col);\n      node.appendChild(cell);\n    };\n\n    for (const frozen of visible.frozen) {\n      updateImpl(frozen);\n    }\n    for (let i = visible.first; i <= visible.last; i += 1) {\n      updateImpl(i);\n    }\n\n    if (ids.size === 0) {\n      return;\n    }\n\n    // recycle\n    const byId = new Map(columns.map((d, i) => [d.id, i]));\n    ids.forEach((idNode, key) => {\n      const index = byId.get(key);\n      if (index != null && index >= 0) {\n        this.recycleCell(idNode, index);\n      }\n    });\n  }\n\n  private updateShiftedStates() {\n    if (!this.context.columns.some((d) => d.frozen)) {\n      return;\n    }\n    const shifted = this.horizontallyShifted;\n    const clazz = CSS_CLASS_SHIFTED;\n    if (shifted) {\n      const headers = Array.from(this.header.querySelectorAll(`.${CSS_CLASS_FROZEN}:not(.${clazz})`));\n      const bodies = Array.from(this.body.querySelectorAll(`.${CSS_CLASS_FROZEN}:not(.${clazz})`));\n      for (const item of headers) {\n        item.classList.add(clazz);\n      }\n      for (const item of bodies) {\n        item.classList.add(clazz);\n      }\n    } else {\n      const headers = Array.from(this.header.querySelectorAll(`.${CSS_CLASS_FROZEN}.${clazz}`));\n      const bodies = Array.from(this.body.querySelectorAll(`.${CSS_CLASS_FROZEN}.${clazz}`));\n      for (const item of headers) {\n        item.classList.remove(clazz);\n      }\n      for (const item of bodies) {\n        item.classList.remove(clazz);\n      }\n    }\n  }\n\n  private syncFrozen(first: number) {\n    const { columns } = this.context;\n    const visible = this.visibleColumns;\n\n    if (!columns.some((d) => d.frozen)) {\n      return 0;\n    }\n    if (first === 0) {\n      if (visible.frozen.length > 0) {\n        this.removeFrozenColumns(visible.frozen, 0);\n        visible.frozen = [];\n      }\n      return 0;\n    }\n    const old = visible.frozen.length;\n    const { target, added, removed } = updateFrozen(visible.frozen, columns, first);\n    if (removed.length > 0) {\n      this.removeFrozenColumns(removed, old - removed.length);\n    }\n    if (added.length > 0) {\n      this.insertFrozenColumns(added, old - removed.length);\n    }\n    visible.frozen = target;\n    return target.length;\n  }\n\n  private onScrolledHorizontallyImpl(scrollLeft: number, clientWidth: number): EScrollResult {\n    const shiftingChanged = this.horizontallyShifted !== scrollLeft > 0;\n    this.horizontallyShifted = scrollLeft > 0;\n\n    const { column } = this.context;\n    const { first, last, firstRowPos } = range(\n      scrollLeft,\n      clientWidth,\n      column.defaultRowHeight,\n      column.exceptions,\n      column.numberOfRows\n    );\n\n    const visible = this.visibleColumns;\n    visible.forcedFirst = first;\n    visible.forcedLast = last;\n\n    if (first - visible.first >= 0 && last - visible.last <= 0) {\n      // nothing to do\n      if (shiftingChanged) {\n        this.updateShiftedStates();\n      }\n      return EScrollResult.NONE;\n    }\n\n    let r: EScrollResult = EScrollResult.SOME;\n\n    const frozenShift = this.syncFrozen(first);\n\n    if (first > visible.last || last < visible.first) {\n      // no overlap, clean and draw everything\n      // console.log(\n      //   `ff added: ${last - first + 1} removed: ${visible.last - visible.first + 1} ${first}:${last} ${frozenShift}`\n      // );\n      // removeRows(visibleFirst, visibleLast);\n      this.removeAllColumns(false);\n      // this.updateShiftedStates();\n      this.addColumnAtEnd(first, last);\n      r = EScrollResult.ALL;\n    } else if (first < visible.first) {\n      // some first rows missing and some last rows to much\n      // console.log(\n      //   `up added: ${visible.first - first + 1} removed: ${visible.last - last + 1} ${first}:${last} ${frozenShift}`\n      // );\n      this.removeColumnFromEnd(last + 1, visible.last);\n      this.updateShiftedStates();\n      this.addColumnAtStart(first, visible.first - 1, frozenShift);\n      r = EScrollResult.SOME_TOP;\n    } else {\n      // console.log(\n      //   `do added: ${last - visible.last + 1} removed: ${first - visible.first + 1} ${first}:${last} ${frozenShift}`\n      // );\n      // some last rows missing and some first rows to much\n      this.removeColumnFromStart(visible.first, first - 1, frozenShift);\n      this.updateShiftedStates();\n      this.addColumnAtEnd(visible.last + 1, last);\n      r = EScrollResult.SOME_BOTTOM;\n    }\n\n    visible.first = first;\n    visible.last = last;\n\n    this.updateColumnOffset(firstRowPos);\n\n    return r;\n  }\n}\n\n/**\n * @internal\n */\nexport default ACellAdapter;\n\n// function verifyRow(row: HTMLElement, index: number, columns: IColumn[]) {\n//   const cols = Array.from(row.children) as HTMLElement[];\n//   // sort incrementally\n//   if (cols.length <= 1) {\n//     return;\n//   }\n//   const colObjs = cols.map((c) => columns.find((d) => d.id === c.dataset.id));\n//   console.assert(\n//     colObjs.every((d) => Boolean(d)),\n//     'all columns must exist',\n//     index\n//   );\n//   console.assert(\n//     colObjs.every((d, i) => i === 0 || d.index >= colObjs[i - 1]!.index),\n//     'all columns in ascending order',\n//     index\n//   );\n//   console.assert(new Set(colObjs).size === colObjs.length, 'unique columns', colObjs);\n// }\n","/* eslint-disable class-methods-use-this */\n/* eslint-disable max-classes-per-file */\nimport { IAbortAblePromise, IAsyncUpdate } from './abortAble';\nimport { IAnimationContext } from './animation';\nimport { ARowRenderer, IRowRendererOptions, setTransform } from './ARowRenderer';\nimport { addScroll } from './internal';\nimport { EScrollResult, IMixinClass } from './mixin';\nimport { GridStyleManager, IColumn, setTemplate } from './style';\nimport { cssClass } from './styles';\nimport { ACellAdapter, ICellAdapterRenderContext, IVisibleColumns } from './table/internal/ACellAdapter';\n\nexport declare type ICellRenderContext<T extends IColumn> = ICellAdapterRenderContext<T>;\n\n/**\n * a @see ARowRenderer which manages multiple columns per row\n */\nexport abstract class ACellRenderer<T extends IColumn> extends ARowRenderer {\n  protected readonly style: GridStyleManager;\n\n  private readonly cell: ACellAdapter<T>;\n\n  constructor(protected readonly root: HTMLElement, htmlId: string, options: Partial<IRowRendererOptions> = {}) {\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    super(setTemplate(root, htmlId).querySelector<HTMLElement>('main > article')!, options);\n    root.classList.add(cssClass(), 'lineup-engine');\n\n    this.style = new GridStyleManager(this.root, htmlId);\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n\n    class LocalCell extends ACellAdapter<T> {\n      protected get context(): ICellAdapterRenderContext<T> {\n        return that.context;\n      }\n\n      protected get body() {\n        return that.body;\n      }\n\n      protected get lastScrollInfo() {\n        return that.lastScrollInfo;\n      }\n\n      protected createHeader(document: Document, column: T) {\n        return that.createHeader(document, column);\n      }\n\n      protected updateHeader(node: HTMLElement, column: T) {\n        return that.updateHeader(node, column);\n      }\n\n      protected createCell(document: Document, index: number, column: T) {\n        return that.createCell(document, index, column);\n      }\n\n      protected updateCell(node: HTMLElement, index: number, column: T) {\n        return that.updateCell(node, index, column);\n      }\n\n      protected updateColumnOffset(firstColumnPos: number) {\n        super.updateColumnOffset(firstColumnPos);\n        that.updateOffset(that.visibleFirstRowPos);\n      }\n\n      protected forEachRow(callback: (row: HTMLElement, rowIndex: number) => void) {\n        return that.forEachRow(callback);\n      }\n    }\n\n    this.cell = new LocalCell(this.header, this.style, this.style.id, options.mixins || []);\n  }\n\n  protected get idPrefix(): string {\n    return this.style.id;\n  }\n\n  /**\n   * get the header root element\n   */\n  protected get header(): HTMLElement {\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    return this.root.querySelector<HTMLElement>('header > article')!;\n  }\n\n  /**\n   * get the header scrolling element, i.e its parent\n   */\n  protected get headerScroller(): HTMLElement {\n    return this.root.getElementsByTagName('header')[0] as HTMLElement;\n  }\n\n  protected get visibleColumns(): IVisibleColumns {\n    return this.cell.visibleColumns;\n  }\n\n  protected get visibleFirstColumnPos(): number {\n    return this.cell.visibleFirstColumnPos;\n  }\n\n  /**\n   * add another column mixin\n   * @param {IMixinClass} mixinClass mixing class to instantiate\n   * @param options optional options\n   */\n  protected addColumnMixin(mixinClass: IMixinClass, options?: unknown): void {\n    this.cell.addColumnMixin(mixinClass, options);\n  }\n\n  /**\n   * initialized this renderer\n   */\n  protected init(): void {\n    this.cell.init();\n\n    const scroller = this.body.parentElement as HTMLElement;\n\n    let old = addScroll(scroller, this.options.async, (act) => {\n      if (\n        Math.abs(old.left - act.left) < this.options.minScrollDelta &&\n        Math.abs(old.width - act.width) < this.options.minScrollDelta\n      ) {\n        return;\n      }\n      const isGoingRight = act.left > old.left;\n      old = act;\n      this.onScrolledHorizontally(act.left, act.width, isGoingRight);\n    });\n\n    super.init();\n  }\n\n  destroy(): void {\n    super.destroy();\n    this.root.remove();\n  }\n\n  /**\n   * will be called when scrolled horizontally\n   * @param {number} scrollLeft\n   * @param {number} clientWidth\n   * @param {boolean} isGoingRight\n   * @returns {EScrollResult}\n   */\n  protected onScrolledHorizontally(scrollLeft: number, clientWidth: number, isGoingRight: boolean): EScrollResult {\n    return this.cell.onScrolledHorizontally(scrollLeft, clientWidth, isGoingRight);\n  }\n\n  /**\n   * the current render context, upon change `recreate` the whole table\n   * @returns {ICellRenderContext}\n   */\n  protected abstract get context(): ICellRenderContext<T>;\n\n  /**\n   * create a new header node for the given column\n   * @param {Document} document document to create nodes of\n   * @param {T} column the column to create the header for\n   * @returns {HTMLElement} the node representing the header\n   */\n  protected abstract createHeader(document: Document, column: T): HTMLElement | IAsyncUpdate<HTMLElement>;\n\n  /**\n   * updates the given header node with the given column\n   * @param {HTMLElement} node node to update\n   * @param {T} column the column to represents\n   * @returns {HTMLElement | void} an optional new replacement node for the header\n   */\n  protected abstract updateHeader(node: HTMLElement, column: T): HTMLElement | IAsyncUpdate<HTMLElement> | void;\n\n  /**\n   * create a new cell node fo the given row index and column\n   * @param {Document} document document the create nodes of\n   * @param {number} index the current row index\n   * @param {T} column the current column\n   * @returns {HTMLElement} the node representing the cell\n   */\n  protected abstract createCell(document: Document, index: number, column: T): HTMLElement | IAsyncUpdate<HTMLElement>;\n\n  /**\n   * updates the given cell node with the given row index and column\n   * @param {HTMLElement} node node to update\n   * @param {number} index row index to use\n   * @param {T} column column to use\n   * @returns {HTMLElement | void} an optional new replacement node for the header\n   */\n  protected abstract updateCell(\n    node: HTMLElement,\n    index: number,\n    column: T\n  ): HTMLElement | IAsyncUpdate<HTMLElement> | void;\n\n  /**\n   * trigger to update all headers\n   */\n  protected updateHeaders(): void {\n    this.cell.updateHeaders();\n  }\n\n  protected handleCellReady(item: HTMLElement, ready: IAbortAblePromise<void>, column = -1): HTMLElement {\n    return this.cell.handleCellReady(item, ready, column);\n  }\n\n  protected recycleCell(item: HTMLElement, column = -1): void {\n    this.cell.recycleCell(item, column);\n  }\n\n  /**\n   * triggers to update all column widths\n   */\n  protected updateColumnWidths(): void {\n    const { context } = this;\n    this.style.update(\n      context.defaultRowHeight - context.padding(-1),\n      context.columns,\n      context.column.padding,\n      0,\n      this.idPrefix\n    );\n  }\n\n  protected updateSizer(firstRowPos: number): void {\n    const ctx = this.context;\n    const { totalHeight } = ctx;\n    const totalWidth = ctx.column.totalHeight;\n\n    this.updateShifts(firstRowPos, this.cell.leftShift());\n    this.bodySizer.style.transform = `translate(${Math.max(0, totalWidth - 1).toFixed(0)}px, ${Math.max(\n      0,\n      totalHeight - 1\n    ).toFixed(0)}px)`;\n  }\n\n  protected updateShifts(top: number, _left: number): void {\n    setTransform(this.body, 0 /* left.toFixed(0) */, top.toFixed(0));\n  }\n\n  /**\n   * triggers to recreate the whole table\n   * @param {IAnimationContext} ctx optional animation context\n   */\n  protected recreate(ctx?: IAnimationContext): void {\n    const scroller = this.bodyScroller;\n    const oldLeft = scroller.scrollLeft;\n    this.cell.recreate(oldLeft, scroller.clientWidth);\n\n    super.recreate(ctx);\n    // restore left\n    scroller.scrollLeft = oldLeft;\n  }\n\n  protected clearPool(): void {\n    super.clearPool();\n    this.cell.clearPool();\n  }\n\n  protected createRow(node: HTMLElement, rowIndex: number): void {\n    this.cell.createRow(node, rowIndex);\n  }\n\n  protected updateRow(node: HTMLElement, rowIndex: number): void {\n    this.cell.updateRow(node, rowIndex);\n  }\n}\n\nexport default ACellRenderer;\n","import { range } from '../logic';\nimport { EScrollResult, IMixin, IMixinAdapter } from './IMixin';\n\nexport interface IPrefetchRendererOptions {\n  /**\n   * number of rows to prefetch\n   * @default 20\n   */\n  readonly prefetchRows: number;\n  /**\n   * number of rows extra before cleaning them up\n   * @default 10\n   */\n  readonly cleanUpRows: number;\n  /**\n   * delay to trigger a prefetch or clean up\n   * @default 200ms\n   */\n  readonly delay: number;\n}\n\n/**\n * mixin that prefetches rows depending on the scrolling direction for faster rendering\n */\nexport default class PrefetchMixin implements IMixin {\n  private prefetchTimeout = -1;\n\n  private cleanupTimeout = -1;\n\n  private readonly options: IPrefetchRendererOptions = {\n    prefetchRows: 20,\n    cleanUpRows: 10,\n    delay: 200,\n  };\n\n  constructor(private readonly adapter: IMixinAdapter, options?: Partial<IPrefetchRendererOptions>) {\n    Object.assign(this.options, options);\n    return this;\n  }\n\n  private prefetchDown() {\n    this.prefetchTimeout = -1;\n    if (this.adapter.isScrollEventWaiting()) {\n      return;\n    }\n    const { context } = this.adapter;\n    const nextLast = Math.min(this.adapter.visible.forcedLast + this.options.prefetchRows, context.numberOfRows - 1);\n    // add some rows in advance\n    if (\n      this.adapter.visible.last === nextLast &&\n      this.adapter.visible.last >= this.adapter.visible.forcedLast + this.options.prefetchRows\n    ) {\n      return;\n    }\n\n    this.adapter.addAtBottom(this.adapter.visible.last + 1, nextLast);\n    // console.log('prefetch', visibleFirst, visibleLast + 1, '=>', nextLast, ranking.children.length);\n    this.adapter.visible.last = nextLast;\n  }\n\n  private prefetchUp() {\n    this.prefetchTimeout = -1;\n    if (\n      this.adapter.isScrollEventWaiting() ||\n      this.adapter.visible.first <= this.adapter.visible.forcedFirst - this.options.prefetchRows\n    ) {\n      return;\n    }\n    const { context } = this.adapter;\n    const fakeOffset = Math.max(this.adapter.scrollOffset - this.options.prefetchRows * context.defaultRowHeight, 0);\n    const height = this.adapter.scrollTotal;\n    const { first, firstRowPos } = range(\n      fakeOffset,\n      height,\n      context.defaultRowHeight,\n      context.exceptions,\n      context.numberOfRows\n    );\n\n    if (first === this.adapter.visible.first) {\n      return;\n    }\n\n    const frozenShift = this.adapter.syncFrozen ? this.adapter.syncFrozen(first) : 0;\n\n    this.adapter.addAtBeginning(first, this.adapter.visible.first - 1, frozenShift);\n    // console.log('prefetch up ', visibleFirst, '=>', first, visibleLast, ranking.children.length);\n    this.adapter.visible.first = first;\n\n    this.adapter.updateOffset(firstRowPos);\n  }\n\n  private triggerPrefetch(isGoingDown: boolean) {\n    if (this.prefetchTimeout >= 0) {\n      clearTimeout(this.prefetchTimeout);\n    }\n\n    const prefetchDownPossible =\n      this.adapter.visible.last < this.adapter.visible.forcedLast + this.options.prefetchRows;\n    const prefetchUpPossible =\n      this.adapter.visible.first > this.adapter.visible.forcedFirst - this.options.prefetchRows;\n\n    const isLast = this.adapter.visible.last === this.adapter.context.numberOfRows;\n    const isFirst = this.adapter.visible.first === 0;\n\n    if ((isGoingDown && !prefetchDownPossible && !isLast) || (!isGoingDown && !prefetchUpPossible && !isFirst)) {\n      return;\n    }\n\n    // go down if we are already at the top, too\n    const op = isGoingDown || isFirst ? this.prefetchDown.bind(this) : this.prefetchUp.bind(this);\n\n    // eslint-disable-next-line no-restricted-globals\n    this.prefetchTimeout = self.setTimeout(op, this.options.delay);\n  }\n\n  private cleanUpTop(first: number) {\n    this.cleanupTimeout = -1;\n    if (this.adapter.isScrollEventWaiting()) {\n      return;\n    }\n    const newFirst = Math.max(0, first - this.options.cleanUpRows);\n\n    if (newFirst <= this.adapter.visible.first) {\n      return;\n    }\n\n    // console.log('cleanup top');\n    const frozenShift = this.adapter.syncFrozen ? this.adapter.syncFrozen(newFirst) : 0;\n\n    this.adapter.removeFromBeginning(this.adapter.visible.first, newFirst - 1, frozenShift);\n    const { context } = this.adapter;\n    // console.log('cleanup up ', visibleFirst, '=>', newFirst, visibleLast, ranking.children.length);\n    let shift = (newFirst - this.adapter.visible.first) * context.defaultRowHeight;\n    if (context.exceptions.length > 0) {\n      for (let i = this.adapter.visible.first; i < newFirst; i += 1) {\n        const ex = context.exceptionsLookup.get(i);\n        if (ex != null) {\n          shift += ex - context.defaultRowHeight;\n        }\n      }\n    }\n    this.adapter.visible.first = newFirst;\n    this.adapter.updateOffset(this.adapter.visibleFirstRowPos + shift);\n\n    this.prefetchDown();\n  }\n\n  private cleanUpBottom(last: number) {\n    this.cleanupTimeout = -1;\n    const newLast = last + this.options.cleanUpRows;\n    if (this.adapter.visible.last <= newLast) {\n      return;\n    }\n    // console.log('cleanup bottom');\n    this.adapter.removeFromBottom(newLast + 1, this.adapter.visible.last);\n    this.adapter.visible.last = newLast;\n\n    this.prefetchUp();\n  }\n\n  private triggerCleanUp(first: number, last: number, isGoingDown: boolean) {\n    if (this.cleanupTimeout >= 0) {\n      clearTimeout(this.cleanupTimeout);\n    }\n    if (\n      (isGoingDown && first - this.options.cleanUpRows <= this.adapter.visible.first) ||\n      (!isGoingDown && this.adapter.visible.last <= last + this.options.cleanUpRows)\n    ) {\n      return;\n    }\n\n    // eslint-disable-next-line no-restricted-globals\n    this.cleanupTimeout = self.setTimeout(\n      isGoingDown ? this.cleanUpTop.bind(this) : this.cleanUpBottom.bind(this),\n      this.options.delay,\n      isGoingDown ? first : last\n    );\n  }\n\n  onScrolled(isGoingDown: boolean, scrollResult: EScrollResult): void {\n    if (this.adapter.isScrollEventWaiting()) {\n      return;\n    }\n    if (scrollResult !== EScrollResult.ALL && this.options.cleanUpRows > 0) {\n      this.triggerCleanUp(this.adapter.visible.forcedFirst, this.adapter.visible.forcedLast, isGoingDown);\n    }\n    if (scrollResult !== EScrollResult.NONE && this.options.prefetchRows > 0) {\n      this.triggerPrefetch(isGoingDown);\n    }\n  }\n}\n","/* eslint-disable class-methods-use-this */\n/* eslint-disable max-classes-per-file */\nimport { IAbortAblePromise, IAsyncUpdate } from '../abortAble';\nimport { IAnimationContext } from '../animation';\nimport { ARowRenderer, IRowRendererOptions, setTransform } from '../ARowRenderer';\nimport { EScrollResult, IMixinClass } from '../mixin';\nimport { IColumn } from '../style';\nimport GridStyleManager from '../style/GridStyleManager';\nimport { CSS_CLASS_HIDDEN, CSS_CLASS_LOADING } from '../styles';\nimport { ACellAdapter, ICellAdapterRenderContext, IVisibleColumns } from './internal/ACellAdapter';\nimport { ITableSection } from './MultiTableRowRenderer';\n\nexport declare type ITableCellRenderContext<T extends IColumn> = ICellAdapterRenderContext<T>;\n\n/**\n * base class for a cell renderer as table section\n */\nexport abstract class ACellTableSection<T extends IColumn> extends ARowRenderer implements ITableSection {\n  private readonly cell: ACellAdapter<T>;\n\n  constructor(\n    public readonly header: HTMLElement,\n    public readonly body: HTMLElement,\n    protected readonly tableId: string,\n    protected readonly style: GridStyleManager,\n    options: Partial<IRowRendererOptions> = {}\n  ) {\n    super(body, options);\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n\n    class LocalCell extends ACellAdapter<T> {\n      protected get context(): ICellAdapterRenderContext<T> {\n        return that.context;\n      }\n\n      protected get body() {\n        return that.body;\n      }\n\n      protected get lastScrollInfo() {\n        return that.lastScrollInfo;\n      }\n\n      protected createHeader(document: Document, column: T) {\n        return that.createHeader(document, column);\n      }\n\n      protected updateHeader(node: HTMLElement, column: T) {\n        return that.updateHeader(node, column);\n      }\n\n      protected createCell(document: Document, index: number, column: T) {\n        return that.createCell(document, index, column);\n      }\n\n      protected updateColumnOffset(firstColumnPos: number) {\n        super.updateColumnOffset(firstColumnPos);\n        that.updateOffset(that.visibleFirstRowPos);\n      }\n\n      protected updateCell(node: HTMLElement, index: number, column: T) {\n        return that.updateCell(node, index, column);\n      }\n\n      protected forEachRow(callback: (row: HTMLElement, rowIndex: number) => void) {\n        return that.forEachRow(callback);\n      }\n    }\n\n    this.cell = new LocalCell(this.header, this.style, tableId, options.mixins || []);\n  }\n\n  protected addColumnMixin(mixinClass: IMixinClass, options?: unknown): void {\n    this.cell.addColumnMixin(mixinClass, options);\n  }\n\n  protected get idPrefix(): string {\n    return this.tableId;\n  }\n\n  abstract get id(): string;\n\n  get width(): number {\n    return this.context.column.totalHeight;\n  }\n\n  protected get visibleColumns(): IVisibleColumns {\n    return this.cell.visibleColumns;\n  }\n\n  protected get visibleFirstColumnPos(): number {\n    return this.cell.visibleFirstColumnPos;\n  }\n\n  get height(): number {\n    return this.context.totalHeight;\n  }\n\n  get hidden(): boolean {\n    return this.header.classList.contains(CSS_CLASS_LOADING);\n  }\n\n  set hidden(value: boolean) {\n    const old = this.hidden;\n    if (old === value) {\n      return;\n    }\n    this.header.classList.toggle(CSS_CLASS_LOADING, value);\n    this.body.classList.toggle(CSS_CLASS_LOADING, value);\n    this.header.classList.toggle(CSS_CLASS_HIDDEN, value);\n    this.body.classList.toggle(CSS_CLASS_HIDDEN, value);\n    this.onVisibilityChanged(!value);\n  }\n\n  protected updateSizer(firstRowPos: number): void {\n    this.updateShifts(firstRowPos, this.cell.leftShift());\n    // no sizer update since centrally managed\n  }\n\n  protected updateShifts(top: number, _left: number): void {\n    setTransform(this.body, 0 /* left.toFixed(0) */, top.toFixed(0));\n  }\n\n  /**\n   * hook when the visibility changes\n   * @param {boolean} _visible current visibility\n   */\n  protected onVisibilityChanged(_visible: boolean): void {\n    // hook\n  }\n\n  hide(): void {\n    this.hidden = true;\n  }\n\n  show(scrollLeft: number, clientWidth: number, isGoingRight: boolean): void {\n    const wasHidden = this.hidden;\n    this.hidden = false;\n    if (wasHidden) {\n      // full update\n      this.revalidate();\n    } else {\n      this.onScrolledHorizontally(scrollLeft, clientWidth, isGoingRight);\n    }\n  }\n\n  init(): void {\n    this.hide(); // hide by default\n    this.cell.init();\n    super.init();\n  }\n\n  destroy(): void {\n    super.destroy();\n    this.header.remove();\n    this.style.remove(this.tableId);\n  }\n\n  protected onScrolledVertically(scrollTop: number, clientHeight: number, isGoingDown: boolean): EScrollResult {\n    if (this.hidden) {\n      return EScrollResult.NONE;\n    }\n    return super.onScrolledVertically(scrollTop, clientHeight, isGoingDown);\n  }\n\n  protected onScrolledHorizontally(scrollLeft: number, clientWidth: number, isGoingRight: boolean): EScrollResult {\n    const r = this.cell.onScrolledHorizontally(scrollLeft, clientWidth, isGoingRight);\n    this.updateSizer(this.visibleFirstRowPos);\n    return r;\n  }\n\n  /**\n   * the current render context, upon change `recreate` the whole table\n   * @returns {ITableCellRenderContext}\n   */\n  protected abstract get context(): ITableCellRenderContext<T>;\n\n  /**\n   * create a new header node for the given column\n   * @param {Document} document document to create nodes of\n   * @param {T} column the column to create the header for\n   * @returns {HTMLElement} the node representing the header\n   */\n  protected abstract createHeader(document: Document, column: T): HTMLElement | IAsyncUpdate<HTMLElement>;\n\n  /**\n   * updates the given header node with the given column\n   * @param {HTMLElement} node node to update\n   * @param {T} column the column to represents\n   * @returns {HTMLElement | void} an optional new replacement node for the header\n   */\n  protected abstract updateHeader(node: HTMLElement, column: T): HTMLElement | IAsyncUpdate<HTMLElement> | void;\n\n  /**\n   * create a new cell node fo the given row index and column\n   * @param {Document} document document the create nodes of\n   * @param {number} index the current row index\n   * @param {T} column the current column\n   * @returns {HTMLElement} the node representing the cell\n   */\n  protected abstract createCell(document: Document, index: number, column: T): HTMLElement | IAsyncUpdate<HTMLElement>;\n\n  /**\n   * updates the given cell node with the given row index and column\n   * @param {HTMLElement} node node to update\n   * @param {number} index row index to use\n   * @param {T} column column to use\n   * @returns {HTMLElement | void} an optional new replacement node for the header\n   */\n  protected abstract updateCell(\n    node: HTMLElement,\n    index: number,\n    column: T\n  ): HTMLElement | IAsyncUpdate<HTMLElement> | void;\n\n  /**\n   * triggers updating the header\n   */\n  protected updateHeaders(): void {\n    this.cell.updateHeaders();\n  }\n\n  protected handleCellReady(item: HTMLElement, ready: IAbortAblePromise<void>, column = -1): HTMLElement {\n    return this.cell.handleCellReady(item, ready, column);\n  }\n\n  protected recycleCell(item: HTMLElement, column = -1): void {\n    this.cell.recycleCell(item, column);\n  }\n\n  /**\n   * trigger an update all all column widths\n   */\n  protected updateColumnWidths(): void {\n    const { context } = this;\n    this.style.update(\n      context.defaultRowHeight - context.padding(-1),\n      context.columns,\n      context.column.padding,\n      0,\n      this.tableId\n    );\n  }\n\n  protected recreate(ctx?: IAnimationContext): void {\n    const scroller = this.bodyScroller;\n    const oldLeft = scroller.scrollLeft;\n    this.cell.recreate(oldLeft, scroller.clientWidth);\n\n    super.recreate(ctx);\n    // restore left\n    scroller.scrollLeft = oldLeft;\n  }\n\n  protected clearPool(): void {\n    super.clearPool();\n    this.cell.clearPool();\n  }\n\n  protected createRow(node: HTMLElement, rowIndex: number): void {\n    this.cell.createRow(node, rowIndex);\n    node.classList.add(this.style.cssClasses.tr);\n  }\n\n  protected updateRow(node: HTMLElement, rowIndex: number): void {\n    this.cell.updateRow(node, rowIndex);\n  }\n}\n\nexport default ACellTableSection;\n","import { setTransform } from '../ARowRenderer';\nimport { addScroll, defaultMode, IDelayedMode } from '../internal';\nimport { GridStyleManager, tableCSSClasses, tableIds } from '../style';\nimport {\n  cssClass,\n  CSS_CLASS_BODY,\n  CSS_CLASS_FOOTER,\n  CSS_CLASS_HEADER,\n  CSS_CLASS_MULTI,\n  CSS_CLASS_TBODY,\n  CSS_CLASS_THEAD,\n} from '../styles';\n\n/**\n * basic interface of a table section\n */\nexport interface ITableSection {\n  readonly id: string;\n  readonly width: number;\n  readonly height: number;\n  readonly header: HTMLElement;\n  readonly body: HTMLElement;\n\n  init(): void;\n\n  /**\n   * show the section\n   * @param {number} left visible left margin\n   * @param {number} width visible width\n   * @param {boolean} isGoingRight whether it was a shift to the right\n   */\n  show(left: number, width: number, isGoingRight: boolean): void;\n\n  hide(): void;\n\n  destroy(): void;\n}\n\nexport interface ITableFactory<T extends ITableSection> {\n  (header: HTMLElement, body: HTMLElement, tableId: string, style: GridStyleManager, ...extras: unknown[]): T;\n}\n\nexport interface ISeparatorFactory<T extends ITableSection> {\n  (header: HTMLElement, body: HTMLElement, style: GridStyleManager, ...extras: unknown[]): T;\n}\n\nexport interface IMultiTableRowRendererOptions {\n  /**\n   * column padding to use between columns\n   * @default 0\n   */\n  columnPadding: number;\n  /**\n   * async update on scrolling\n   * animation -> use requestAnimationFrame\n   * sync -> execute within scroll listener\n   * {number} -> execute within this delay using setTimeout\n   * @default is chrome ? animation else 0\n   */\n  async: IDelayedMode;\n\n  /**\n   * minimal number of pixel the scrollbars has to move\n   * @default 30\n   */\n  minScrollDelta: number;\n}\n\n/**\n * manager of multiple columns separated by separators each an own row renderer\n */\nexport default class MultiTableRowRenderer {\n  readonly style: GridStyleManager;\n\n  private tableId = 0;\n\n  private readonly sections: ITableSection[] = [];\n\n  private readonly options: Readonly<IMultiTableRowRendererOptions> = {\n    columnPadding: 0,\n    async: defaultMode,\n    minScrollDelta: 30,\n  };\n\n  constructor(public readonly node: HTMLElement, htmlId: string, options: Partial<IMultiTableRowRendererOptions> = {}) {\n    Object.assign(this.options, options);\n    const cleanHTMLId = htmlId.startsWith('#') ? htmlId.slice(1) : htmlId;\n    // eslint-disable-next-line no-param-reassign\n    node.id = cleanHTMLId;\n    // eslint-disable-next-line no-param-reassign\n    node.innerHTML = `<header id=\"header-${cleanHTMLId}\" class=\"${CSS_CLASS_HEADER} ${cssClass(\n      `header-${cleanHTMLId}`\n    )}\">\n      <footer class=\"${CSS_CLASS_FOOTER} ${cssClass(`footer-${cleanHTMLId}`)}\">&nbsp;</footer>\n    </header>\n    <main id=\"body-${cleanHTMLId}\" class=\"${CSS_CLASS_BODY} ${cssClass(`body-${cleanHTMLId}`)}\">\n      <footer class=\"${CSS_CLASS_FOOTER}\">&nbsp;</footer>\n    </main>`;\n    node.classList.add(cssClass(), CSS_CLASS_MULTI, 'lineup-engine');\n\n    this.style = new GridStyleManager(this.node, cleanHTMLId);\n\n    let old = addScroll(this.main, this.options.async, (act) => {\n      if (\n        Math.abs(old.left - act.left) < this.options.minScrollDelta &&\n        Math.abs(old.width - act.width) < this.options.minScrollDelta\n      ) {\n        return;\n      }\n      const isGoingRight = act.left > old.left;\n      old = act;\n      this.onScrolledHorizontally(act.left, act.width, isGoingRight);\n    });\n  }\n\n  private update() {\n    this.onScrolledHorizontally(this.main.scrollLeft, this.main.clientWidth, false);\n\n    let offset = 0;\n    this.sections.forEach((s) => {\n      // eslint-disable-next-line no-param-reassign\n      s.body.style.left = `${offset}px`;\n      // eslint-disable-next-line no-param-reassign\n      s.header.style.left = `${offset}px`;\n      offset += s.width + this.options.columnPadding;\n    });\n  }\n\n  private onScrolledHorizontally(scrollLeft: number, clientWidth: number, isGoingRight: boolean) {\n    let offset = 0;\n    const scrollEnd = scrollLeft + clientWidth;\n    this.sections.forEach((s) => {\n      const end = offset + s.width;\n      if (end < scrollLeft || offset > scrollEnd) {\n        s.hide();\n      } else {\n        s.show(Math.max(0, scrollLeft - offset), Math.min(scrollEnd - offset, s.width), isGoingRight);\n      }\n\n      offset = end + this.options.columnPadding;\n    });\n\n    this.updateOffset();\n  }\n\n  private updateOffset() {\n    const headerFooter = this.header.getElementsByTagName('footer')[0];\n    const bodyFooter = this.main.getElementsByTagName('footer')[0];\n\n    const maxHeight = this.sections.reduce((acc, d) => Math.max(acc, d.height), 0);\n    const total = this.sections.reduce((a, c) => a + c.width + this.options.columnPadding, 0);\n\n    setTransform(headerFooter, total, 0);\n    setTransform(bodyFooter, total, maxHeight);\n  }\n\n  destroy(): void {\n    this.sections.forEach((d) => d.destroy());\n    this.node.remove();\n  }\n\n  private get doc(): Document {\n    return this.node.ownerDocument;\n  }\n\n  private get header() {\n    return this.node.getElementsByTagName('header')[0] as HTMLElement;\n  }\n\n  private get main() {\n    return this.node.getElementsByTagName('main')[0] as HTMLElement;\n  }\n\n  /**\n   * push another table to this instance\n   * @param {ITableFactory<T extends ITableSection>} factory factory for the table\n   * @param extras additional arguments to provide for the factory\n   * @returns {T} the table instance\n   */\n  pushTable<T extends ITableSection>(factory: ITableFactory<T>, ...extras: unknown[]): T {\n    const header = this.doc.createElement('article');\n    const body = this.doc.createElement('article');\n\n    const tableId = `${this.node.id}T${this.tableId}`;\n    this.tableId += 1;\n    const ids = tableIds(tableId);\n    const cssClasses = tableCSSClasses(tableId);\n\n    header.id = ids.thead;\n    header.classList.add(CSS_CLASS_THEAD, cssClasses.thead);\n    body.id = ids.tbody;\n    body.classList.add(CSS_CLASS_TBODY, cssClasses.tbody);\n    this.header.insertBefore(header, this.header.lastElementChild); // before the footer\n    this.main.appendChild(body);\n\n    const table = factory.call(this, header, body, tableId, this.style, ...extras);\n    table.init();\n    this.sections.push(table);\n    this.update();\n    return table;\n  }\n\n  /**\n   * push another separator to the manager\n   * @param {ISeparatorFactory<T extends ITableSection>} factory the factory to create the separator\n   * @param extras optional additional arguments\n   * @returns {T} the new created separator\n   */\n  pushSeparator<T extends ITableSection>(factory: ISeparatorFactory<T>, ...extras: unknown[]): T {\n    const header = this.doc.createElement('section');\n    const body = this.doc.createElement('section');\n    header.classList.add(cssClass('header-separator'));\n    body.classList.add(cssClass('separator'));\n    this.header.insertBefore(header, this.header.lastElementChild); // before the footer\n    this.main.appendChild(body);\n\n    const separator = factory.call(this, header, body, this.style, ...extras);\n    separator.init();\n    this.sections.push(separator);\n    this.update();\n    return separator;\n  }\n\n  /**\n   * removes a given table section\n   * @param {ITableSection} section section to remove\n   * @returns {boolean} successful flag\n   */\n  remove(section: ITableSection): boolean {\n    const index = this.sections.indexOf(section);\n    if (index < 0) {\n      return false;\n    }\n    this.sections.splice(index, 1);\n    section.destroy();\n    this.update();\n    return true;\n  }\n\n  clear(): void {\n    this.sections.splice(0, this.sections.length).forEach((s) => s.destroy());\n    this.update();\n  }\n\n  /**\n   * triggers and update because of a change in width of one or more table sections\n   */\n  widthChanged(): void {\n    this.update();\n  }\n}\n","import './style.scss';\n\nexport * from '.';\n\n// eslint-disable-next-line @typescript-eslint/naming-convention, no-underscore-dangle\ndeclare const __VERSION__: string;\n// eslint-disable-next-line @typescript-eslint/naming-convention, no-underscore-dangle\ndeclare const __BUILD_ID__: string;\n\nexport const version = __VERSION__;\nexport const buildId = __BUILD_ID__;\n"],"names":["root","factory","exports","module","define","amd","globalThis","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","isPromiseLike","p","then","ABORTED","thenFactory","loader","isAborted","abort","onfulfilled","_onrejected","loaded","loadedOrAborted","res","r","abortAble","aborted","aborter","Promise","resolve","race","abortAbleFetch","input","init","controller","AbortController","reject","fetch","signal","catch","error","DOMException","bind","abortAbleAll","values","all","v","isAbortAble","candidate","isAsyncUpdate","update","ready","abortAbleResolveNow","context","cache","lastFilled","key2index","Map","this","exceptions","forEach","e","index","y","set","findValidStart","before","i","undefined","posByKey","pos","fillCacheTillKey","length","defaultRowHeight","cached","start","fillCache","heightOf","first","last","offset","callback","exceptionsLookup","exceptionHeightOf","returnDefault","padding","entry","target","numberOfRows","c","positions","EAnimationMode","noAnimationChange","previousHeight","currentHeight","previous","mode","nodeY","current","prev","height","curr","UPDATE","Math","abs","defaultPhases","delay","apply","actNode","dataset","animation","toLowerCase","style","transform","SHOW","opacity","HIDE","UPDATE_REMOVE","clear","node","lastChild","removeChild","defaultMode","sync","handler","timer","numbers","handleAnimationImpl","handle","addEventListener","handleAnimation","handleTimeouts","passive","asInfo","info","left","top","s","requestAnimationFrame","size","n","self","setTimeout","scrollLeft","scrollTop","width","clientWidth","clientHeight","push","remove","concat","Array","from","some","d","indexOf","splice","isWaiting","addScroll","scrollElement","__le_scroller__","ScrollHandler","isScrollEventWaiting","scroller","EScrollResult","uniformContext","rowHeight","rowPadding","currentRowHeight","keys","has","totalHeight","nonUniformContext","rowHeights","Number","NaN","actualDefaultRowHeight","isNaN","lookup","sorted","sort","a","b","mostFrequent","mostFrequentValue","acc","paddedHeight","between","RowHeightException","randomContext","minRowHeight","maxRowHeight","ratio","seed","Date","now","actSeed","random","x","sin","floor","round","range","heightExceptions","firstRowPos","endPos","y2","offset2","indexShift","min","max","calc","offsetShift","shifted2","assign","lastPos","rest","visible","closest","item","firstException","lastException","ceil","frozenDelta","currentLength","targetLength","added","removed","common","slice","updateFrozen","old","columns","oldLast","pop","frozen","cssClass","suffix","CSS_CLASS_LOADING","CSS_CLASS_FROZEN","CSS_CLASS_HIDDEN","CSS_CLASS_MULTI","CSS_CLASS_EVEN","CSS_CLASS_SHIFTED","CSS_CLASS_SCROLLBAR_TESTER","CSS_CLASS_HEADER","CSS_CLASS_BODY","CSS_CLASS_FOOTER","CSS_CLASS_THEAD","CSS_CLASS_TBODY","CSS_CLASS_TR","CSS_CLASS_TH","CSS_CLASS_TD","CSS_CLASS_SCROLLING","CSS_CLASS_ROW_ANIMATION","isLoadingCell","classList","contains","body","options","pool","loadingPool","loading","WeakMap","forcedFirst","forcedLast","visibleFirstRowPos","scrollListener","lastScrollInfo","abortAnimation","async","minScrollDelta","mixins","scrollingHint","batchSize","striped","viewportOversize","adapter","createAdapter","map","MixinClass","fragment","ownerDocument","createDocumentFragment","addMixin","that","addAtBeginning","to","addAtBottom","removeFromBeginning","removeFromBottom","updateOffset","bodyScroller","scrollOffset","scrollTotal","parentElement","parent","sizer","children","find","tagName","createElement","add","idPrefix","insertBefore","firstChild","act","isGoingDown","onScrolledVertically","recreate","destroy","cleanUp","select","result","updateRow","createRow","String","toggle","selectProxy","proxy","recycle","ARowRenderer","real","abortResult","replaceChild","delete","create","ex","exceptionHeight","removeAll","perform","toRecycle","lastElementChild","items","appendChild","forEachRow","inPlace","rows","row","fromBeginning","nextSibling","previousSibling","updateSizer","setTransform","toFixed","bodySizer","ctx","recreateAnimated","recreatePure","clearPool","previousKey","cur","currentKey","next","UPDATE_CREATE","nodeYCurrentHeight","nextPos","prevHeight","animate","phases","previousFinder","currentFinder","activeAnimation","currentTimer","actPhase","executePhase","phase","anim","run","console","assert","offsetTop","startsWith","endsWith","dummyAnimation","filter","Set","split","clearTimeout","revalidate","shift","shiftTop","scrollResult","onScrolledImpl","onScrolled","shiftLast","currentDelta","total","shiftFirst","currentFirstRow","NONE","toAdd","SOME","toAddBottom","ALL","SOME_TOP","SOME_BOTTOM","manipulate","bottom","elem","text","anyElem","__transform__","assignStyles","source","targetObj","plain","hyphen","replace","setProperty","rules","testVerifyTimeout","createTextNode","verifySheet","sheet","cssRules","every","selectorText","selector","deleteRule","rule","insertRule","cssRule","getSheetRule","addRule","id","updateRule","findIndex","stored","setTemplate","cleanId","innerHTML","tableIds","tableId","thead","tbody","tr","th","td","tableCSSClasses","ids","cssClasses","headerScroller","getElementsByTagName","insertAdjacentHTML","offsetWidth","offsetHeight","measureScrollbar","borderRight","newValue","frozenShift","unit","selectors","reduce","updateColumns","prefix","ruleNames","cssSelectors","thStyles","tdStyles","header","mixinClasses","cellPool","visibleColumns","visibleFirstColumnPos","horizontallyShifted","columnAdapter","createColumnAdapter","columnMixins","columnFragment","leftShift","column","addColumnMixin","addColumnAtStart","addColumnAtEnd","removeColumnFromStart","removeColumnFromEnd","updateColumnOffset","syncFrozen","onScrolledHorizontally","isGoingRight","onScrolledHorizontallyImpl","removeCellFromStart","firstElementChild","recycleCell","removeCellFromEnd","removeFrozenCells","columnIndices","columnIndex","removeFrozenColumns","removeAllColumns","includingFrozen","removeAllCells","arr","selectProxyCell","columnObj","pooled","updateCell","createCell","updateShiftedState","handleCellReady","selectCell","col","rowIndex","addCellAtStart","cell","insertFrozenCells","insertFrozenColumns","addCellAtEnd","updateHeaders","base","updateHeader","existing","createHeader","firstColumnPos","changed","childElementCount","mergeColumns","updateImpl","byId","idNode","updateShiftedStates","shifted","clazz","headers","querySelectorAll","bodies","shiftingChanged","htmlId","querySelector","document","ACellAdapter","LocalCell","mixinClass","updateColumnWidths","totalWidth","updateShifts","_left","oldLeft","prefetchTimeout","cleanupTimeout","prefetchRows","cleanUpRows","prefetchDown","nextLast","prefetchUp","triggerPrefetch","prefetchDownPossible","prefetchUpPossible","isLast","isFirst","op","cleanUpTop","newFirst","cleanUpBottom","newLast","triggerCleanUp","hidden","onVisibilityChanged","_visible","hide","show","wasHidden","sections","columnPadding","cleanHTMLId","main","scrollEnd","end","headerFooter","bodyFooter","maxHeight","pushTable","doc","table","extras","pushSeparator","separator","section","widthChanged","version","buildId"],"sourceRoot":""}